(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1075:function(t,e,n){"use strict";n.r(e);n(148),n(85),n(44),n(43),n(45),n(86),n(87),n(34),n(151),n(90),n(24),n(25),n(17),n(88);var r=n(0),o=n.n(r),i=n(2),c=n(14),u=n(555),a=n(26),l=n(21),s=n(268),f=n(35),p=n(558),y=n(4),h=n.n(y),d=n(249),m=n(3);function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var c,u=t[Symbol.iterator]();!(r=(c=u.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(a){o=!0,i=a}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=k(t);if(e){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;return j(t)}(this,n)}}function j(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var P=Object(i.default)(a.a).withConfig({displayName:"PromotionsWidget__StyledLoginColumn",componentId:"sc-1lylwwn-0"})(["margin-bottom:0.5rem;"]),L=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(h,r["Component"]);var e,n,i,y=w(h);function h(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(t=y.call(this)).state={collection:[],filters:[],filteredCollection:[]},t.handleLoginModal=t.handleLoginModal.bind(j(t)),t.handleFilter=t.handleFilter.bind(j(t)),t.handleSort=t.handleSort.bind(j(t)),t}return e=h,(n=[{key:"componentDidMount",value:function(){var t=this;this.checkFailedLoginStatus(),this.fetchPromotions().then(function(e){return t.postFetchPromotions(e)})}},{key:"postFetchPromotions",value:function(t){var e=this;if(!Array.isArray(t))return!1;this.setPublicPromotions(t),this.checkLoginStatus().then(function(n){n.isLoggedIn?e.fetchLoggedInPromotions(n.prestige,t,n.nickName):e.setState({isLoggedIn:!1})})}},{key:"checkFailedLoginStatus",value:function(){var t=Object(m.c)();t.loginstatus&&"fail"===t.loginstatus&&this.setState({showOnePassLogin:!0})}},{key:"checkLoginStatus",value:function(){var t=this;return Object(d.b)(this.props.checkLoginUrl).then(function(e){if(e.isLoggedIn){var n=function(t){return{isLoggedIn:!0,nickName:e.nickName,prestige:t.prestige}};return t.fetchCustomerProfile().then(n).catch(n)}return{isLoggedIn:!1,prestige:!1}})}},{key:"setPublicPromotions",value:function(t){var e=t.filter(function(t){return"public"===t.type&&"all"===t.customerType});this.setState({collection:e},this.filterCollection)}},{key:"fetchLoggedInPromotions",value:function(t,e,n){var r=this,o=[this.fetchLMS(),this.fetchUnica()].map(function(t){return t.catch(function(){})});Promise.all(o).then(function(o){var i=v(o,2),c=i[0],u=i[1];r.showLoggedInPromotions(e,c&&c.voucherDetails,u&&u.campaigns,t,n)})}},{key:"fetchPromotions",value:function(){return fetch(this.props.serviceUrl,{credentials:"include"}).then(function(t){return t.json()})}},{key:"fetchLMS",value:function(){return fetch(this.props.lmsServiceUrl,{credentials:"include"}).then(function(t){return t.json()})}},{key:"fetchUnica",value:function(){return fetch(this.props.unicaServiceUrl,{credentials:"include"}).then(function(t){return t.json()})}},{key:"fetchCustomerProfile",value:function(){return fetch(this.props.custProfileUrl,{credentials:"include"}).then(function(t){return t.json()})}},{key:"filteredLmsPromotions",value:function(t,e){var n=(new Date).getTime(),r=e.reduce(function(t,e){return e.vouchers.find(function(t){return t.expiryTimeStamp>n})&&(t[e.code]=e),t},{});return t.filter(function(t){return"lms"===t.type&&r[t.id]})}},{key:"filteredUnicaPromotions",value:function(t,e){var n=(new Date).getTime(),r=e.reduce(function(t,e){return e.expiryTimeStamp>n&&(t[e.campaignId]=e),t},{});return t.filter(function(t){return"unica"===t.type&&r[t.id]})}},{key:"filteredUnicaDataById",value:function(t){var e=(new Date).getTime();return t.reduce(function(t,n){return n.expiryTimeStamp>e&&(t[n.campaignId]=n),t},{})}},{key:"filteredLmsDataById",value:function(t){var e=(new Date).getTime();return t.reduce(function(t,n){return n.vouchers.find(function(t){return t.expiryTimeStamp>e})&&(t[n.code]=n),t},{})}},{key:"showLoggedInPromotions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=this.filteredLmsDataById(e),c=this.filteredUnicaDataById(n),u=t.map(function(t){return"public"===t.type&&"all"===t.customerType?t:r&&"public"===t.type&&"all"!==t.customerType?t:"lms"===t.type&&i[t.id]?t:"unica"===t.type&&c[t.id]?t:void 0}).filter(Boolean),a=u.length>this.state.collection.length;this.setState({collection:u,isLoggedIn:!0,nickName:o,showPersonalisedMessage:a},this.filterCollection)}},{key:"filterCollection",value:function(){var t=this,e=this.state.collection.slice();0!==Object.keys(this.state.filters).length&&(e=e.filter(function(e){for(var n in t.state.filters)return e[n]&&-1!==e[n].indexOf(t.state.filters[n])})),this.setState({filteredCollection:e})}},{key:"handleFilter",value:function(t){this.setState({filters:t},this.filterCollection)}},{key:"handleSort",value:function(t){this.setState({sortBy:t},this.filterCollection)}},{key:"handleLoginModal",value:function(){this.setState(function(t){return{showOnePassLogin:!t.showOnePassLogin}})}},{key:"getGreeting",value:function(){var t=(new Date).getHours();return t>4&&t<12?"Good Morning":t>=12&&t<=17?"Good Afternoon":"Good Evening"}},{key:"render",value:function(){var t=this.props,e=t.loginText,n=t.descriptionText,r=t.filterLists,i=t.viewMoreText,y=t.headerText,h=t.filterCriteriaText,d=t.sortByText,m=t.loginUrl,g=t.personalizedDesc,v=t.emptyPersonalizedDesc,b=this.state,S=b.showPersonalisedMessage,O=b.filteredCollection,w=b.isLoggedIn,j=b.showOnePassLogin,k=b.nickName,L=this.getGreeting();return o.a.createElement("div",null,o.a.createElement(u.a,{filterLists:r,viewMoreText:i,filterCriteriaText:h,sortByText:d,ctaType:"anchor",collection:O,onFilter:this.handleFilter,onSort:this.handleSort},o.a.createElement(f.a,null,o.a.createElement(a.a,{sm:12},o.a.createElement(f.a,{bottom:"lg"},o.a.createElement(a.a,{sm:12,lg:3},o.a.createElement(l.g,{level:1},y)),o.a.createElement(P,{sm:12,lg:9},!1===w&&o.a.createElement(c.a,{onClick:this.handleLoginModal},e)))),o.a.createElement(a.a,{sm:12},!0===w&&o.a.createElement(f.a,null,o.a.createElement(a.a,{sm:12},o.a.createElement("p",null,L," ",k,","),o.a.createElement("p",null,S?g:v))),o.a.createElement(f.a,null,o.a.createElement(a.a,{sm:12},o.a.createElement("p",null,n)))))),o.a.createElement(s.a,{open:j,onClose:this.handleLoginModal},o.a.createElement(p.a,{loginUrl:m})))}}])&&S(e.prototype,n),i&&S(e,i),h}();u.a.propTypes={lmsServiceUrl:h.a.string,unicaServiceUrl:h.a.string,custProfileUrl:h.a.string,serviceUrl:h.a.string,filterLists:h.a.array,viewMoreText:h.a.string,headerText:h.a.string,descriptionText:h.a.string,filterCriteriaText:h.a.string,sortByText:h.a.string,loginText:h.a.string,loginUrl:h.a.string},e.default=L},249:function(t,e,n){"use strict";n(44),n(243),n(43),n(90),n(93),n(47),n(45),n(275),n(59),n(24),n(25),n(17),n(34),n(46);var r=function(t,e){return t.replace(/{([^{}]*)}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:""})},o=n(258),i=n(297),c=n.n(i);n(85),n(88),n(148);function u(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var l=function(t){return u(Array(t).keys())};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach(function(e){y(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"c",function(){return h}),n.d(e,"b",function(){return d}),n.d(e,"h",function(){return m}),n.d(e,"l",function(){return g}),n.d(e,"k",function(){return v}),n.d(e,"j",function(){return b}),n.d(e,"d",function(){return S}),n.d(e,"g",function(){return O}),n.d(e,"e",function(){return w}),n.d(e,"o",function(){return j}),n.d(e,"a",function(){return k}),n.d(e,"i",function(){return P}),n.d(e,"n",function(){return L}),n.d(e,"f",function(){return T}),n.d(e,"m",function(){return r});var h=function(){var t=new Date;return fetch("/online-api/cxf/sg-loginservice/checkLogin?time=".concat(t.getTime()),{credentials:"include"}).then(function(t){return t.json().then(function(e){return p({status:t.status},e)})})};function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/online-api/cxf/sg-loginservice/checkLogin";return fetch(t,{credentials:"include"}).then(function(t){return t.json()})}function m(t){return 0!==t.length}function g(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function v(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}function b(t,e){return Object.keys(t).filter(function(t){return e.indexOf(t)<0}).reduce(function(e,n){return Object.assign(e,y({},n,t[n]))},{})}var S=function(t){return(t=t.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)/)||[t]).length>1&&((t=t.slice(1))[5]=+t[0]<12?"am":"pm",t[0]=+t[0]%12||12),t.join("")};function O(){return void 0!==function(){for(var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.cookie).split(";"),e={},n=0;t.length>n;n++){var r=t[n].trim().split("=");Object.assign(e,y({},r[0],r[1]))}return e}()["cq-authoring-mode"]}function w(t,e){var n,r=arguments,o=this;return function(){var i=o,c=r;clearTimeout(n),n=setTimeout(function(){return t.apply(i,c)},e)}}var j=function(t){return/^[8-9][\d]{7}$/.test(t)},k=function(t,e){var n,r=p({},Object(o.a)(t),{},e);return n=r,0===Object.keys(n).length&&n.constructor===Object?t:"".concat(t.split("?")[0],"?").concat(g(r))},P=function(){return c()({customizeArray:function(t,e){return t.every(function(t){return t===Object(t)})&&e.every(function(t){return t===Object(t)})?(t.length>e.length?l(t.length):l(e.length)).map(function(){return{}}).map(function(n,r){var o=t[r]||{},i=e[r]||{};return c()(n,o,i)}):e},customizeObject:function(){}}).apply(void 0,arguments)},L=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=JSON.parse(t);if(n&&"object"===s(n))return n}catch(r){return e}},T=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(e).reduce(function(r,o){var i=n.length?n+".":"";return"object"!==s(e[o])||null===e[o]||Array.isArray(e[o])?r[i+o]=e[o]:Object.assign(r,t(e[o],i+o)),r},{})}},258:function(t,e,n){"use strict";n.d(e,"a",function(){return c});n(24),n(44),n(43),n(88),n(148),n(85),n(45),n(17),n(47),n(46);function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var c,u=t[Symbol.iterator]();!(r=(c=u.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(a){o=!0,i=a}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(t){var e=t,n={},i=t.indexOf("#");-1!==i&&(e=e.slice(0,i));var c=e.indexOf("?");if(-1===c)return{};if(!(e=(e=e.slice(c+1)).trim().replace(/^[?#&]/,"")))return n;var u,a=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=o(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return u=t.done,t},e:function(t){a=!0,c=t},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw c}}}}(e.split("&"));try{for(a.s();!(u=a.n()).done;){var l=r(u.value.replace(/\+/g," ").split("="),2),s=l[0],f=l[1];f=void 0===f?null:f,n[s]=f}}catch(p){a.e(p)}finally{a.f()}return n}},558:function(t,e,n){"use strict";n(44),n(43),n(45),n(17),n(86),n(87);var r=n(0),o=n.n(r),i=n(2),c=n(3);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=f(t);if(e){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=i.default.iframe.withConfig({displayName:"OnePassLogin__SCIFrame",componentId:"sc-5pftfn-0"})(["margin:0;width:100%;height:",";border:0;overflow:hidden;"],function(t){return t.loginStatus?"450px":"390px"}),y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(f,r["Component"]);var e,n,i,u=s(f);function f(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),t=u.call(this);var e=Object(c.c)();return t.state={loginUrl:"#",loginStatus:e.loginstatus?e.loginstatus:""},t}return e=f,(n=[{key:"componentDidMount",value:function(){var t=this.props.referenceUrl||window.location.href;Object(c.f)(t)||(t=window.location.origin+t);var e=Object(c.o)(window.location.origin+"/apps/springd/onepasssuccess",{target:t,origin:window.location.href}),n=Object(c.o)(this.props.loginUrl,{success_callback_url:e,loginstatus:this.state.loginStatus,view:"shop"});this.setState({loginUrl:n})}},{key:"render",value:function(){return o.a.createElement(p,{loginStatus:this.state.loginStatus,title:this.props.title,id:this.props.id,src:this.state.loginUrl,scrolling:"no",frameBorder:"0"})}}])&&a(e.prototype,n),i&&a(e,i),f}();y.defaultProps={id:"ssoLogin",title:"ssoLogin"},e.a=y}}]);
//# sourceMappingURL=PromotionsWidget.437ad4f7.js.map