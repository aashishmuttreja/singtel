define("businesswidget/repository/common/core/context/AppContext",["underscore","knockout"],function(a,b){"use strict";var c="$subscribe",d=function(){this.modules={},this.__historyData={}};return a.extend(d.prototype,{configData:{},create:function(a,b){return new a(b)},setHistoryData:function(a){this.__historyData=a},getHistoryData:function(a){return this.__historyData[a]},createVM:function(b,c,d){d=d||"";var e=d+(b.moduleID||a.uniqueId("module_")),f=this.getVM(e);if(!f&&(f=new b(c),f.__appContextId=e,f.shouldRegister()&&(this.modules[e]=f),f.shouldRestore()&&f.restoreData(e),f.shouldPersist())){var g=f.persistent;f.persistentSubscriptions={};for(var h=0,i=g.length;h<i;h++){var j=g[h],k=f.get(j,!0);if(k&&k.subscribe)f.persistentSubscriptions[j]=k.subscribe(this._handleChanges(f,e,j));else if(a.isObject(k)){var l=this._handleOnChanges(f,e,j),m=this._handleOffChanges(f,j,l),n={dispose:m};f.on("change:"+j,l),f.persistentSubscriptions[j]=n}}}return f},clear:function(b){var c=function(a){for(var b=a.persistent,c=0,d=b.length;c<d;c++){var e=b[c];a&&a.persistentSubscriptions&&a.persistentSubscriptions[e]&&a.persistentSubscriptions[e].dispose()}};if(arguments.length>0){var d=this.getVM(b);d&&(c(d),delete this.modules[b])}else a.each(this.modules,function(a){c(a)},this),this.modules=[]},_handleChanges:function(a,b,c){return function(d){a.persist(b,c,d)}},_handleOffChanges:function(a,b,c){return function(){a.off("change:"+b,c)}},_handleOnChanges:function(a,b,c){return function(d){a.persist(b,c,d.value)}},getVM:function(a){return this.modules[a]},getVmDefaultGroupId:function(a,b){return(a.getGroupId(b)||"")+b.moduleID},_getAsVM:function(b){var c=b;return a.isObject(b)&&b.isViewModel&&(c=b.__appContextId),this.getVM(c)},publish:function(b,c,d){var e=this.getVM(b);if(!e)throw new Error("ViewModel '"+b+"' is not instantiated for use yet.");c=a.pick(c,a.keys(e.get())),e.set(c),d&&e.handleAction(d)},subscribe:function(b,d){var e=function(a){return JSON.parse(JSON.stringify(a))},f=function(b,d,f){var g=e(a.omit(b.get(),"subViewModels")),h={action:f,data:g};return f===c?(h.changedAttributes=g,h.prevAttributes={},h.changedAttributes={}):"$change"===f&&(h.changedAttributes=e(d.changed),h.prevAttributes=e(a.omit(d.target.data.previousAttributes(),"subViewModels"))),h},g=this.getVM(b);if(!g)throw new Error("ViewModel '"+b+"' is not instantiated for use yet.");(!d.actions||a.indexOf(d.actions,"change")>-1)&&g.on("change",d.handler,d.context),d.events&&a.each(d.events,function(b,c,e){a.isArray(e)&&(c=b,b=null),b||(b={}),b.handler=b.handler||d.handler,b.context=b.context||d.context,g.on(c,b.handler,b.context)}),d.silent||a.bind(d.handler,d.context)(f(g,{},c))},getData:function(a,b,c,d){var e=this._getAsVM(a);if(!e)throw new Error("ViewModel '"+a+"' is not instantiated for use yet.");return e.get(b,c,d)},setData:function(a,b,c){var d=this._getAsVM(a);if(!d)throw new Error("ViewModel '"+a+"' is not instantiated for use yet.");d.set(b,c)},addDependentAction:function(a,c){var d=this._getAsVM(a);if(!d)throw new Error("ViewModel '"+a+"' is not instantiated for use yet.");if(d._dependentActions||(d._dependentActions={}),!d._dependentActions.hasOwnProperty(c)){var e={},f=b.observable(!0);e[c]={handler:function(){f.__hanlerCalled=!0,f(!f()),f.__hanlerCalled=!1},context:this},this.subscribe(a,{silent:!0,events:e}),d._dependentActions[c]=f}var g=d._dependentActions[c];return g(),!0===g.__hanlerCalled},setConfigData:function(a){this.configData=a},getConfigData:function(){return this.configData},getState:function(){var b,c,d=a.keys(this.modules),e={};if(d)for(var f=0;f<d.length;f++)b=d[f],c=window.sessionStorage.getItem(b)||"{}",e[b]=JSON.parse(c);return e},setState:function(b){var c,d,e,f=a.keys(this.modules);if(f)for(var g=0;g<f.length;g++)if(c=f[g],d=b[c]){e=a.keys(d);for(var h=0;h<e.length;h++)this.modules[c].set(e[h],d[e[h]])}},getDataFromState:function(a,b){var c=window.sessionStorage.getItem(a)||"{}";return JSON.parse(c)[b]},setHistoryState:function(b){var c,d,e,f=a.keys(this.modules);if(f)for(var g=0;g<f.length;g++)c=f[g],d=this.modules[c],e=b[c]||{},d.restoreFromUrl&&d.restoreFromUrl(e)},getHistoryState:function(){var b,c,d,e,f,g=a.keys(this.modules),h={};if(g)for(var i=0;i<g.length;i++)if(b=g[i],c=this.modules[b],d={},(e=c.historyAttrs)&&e.length>0){f=window.sessionStorage.getItem(b)||"{}",f=JSON.parse(f);for(var j=0;j<e.length;j++)d[e[j]]=c.get(e[j]);h[b]=d}return h}}),d}),define("init",["businesswidget/repository/common/core/context/AppContext"],function(a){"use strict";return{load:function(b,c,d,e){requirejs.onResourceLoad=function(a,b){var c=a.defined[b.id];"function"==typeof c&&(c.moduleID=b.id)},requirejs.appContext=requirejs.appContext||new a,requirejs.appContext.config=requirejs.appContext.config||e,c([b],function(a){d(a)})}}});