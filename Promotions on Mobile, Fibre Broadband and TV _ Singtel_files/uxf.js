define('jquery', function() { return $; });define("fixture",["l3_common.fixture"],function(){return{};});
define("l3_common.fixture",["core.fixture"],function(){return{};});
define("core.fixture",["fixture.dom","fixture.lightsaber"],function(){return{};});
define("fixture.object",["jquery"],function(){return{};});
define("fixture.string",["jquery"],function(){return{};});
define("fixture.dom",["jquery","fixture.string","fixture.object"],function(){return{};});
define("fixture.lightsaber",["jquery"],function(){return{};});
define("src/lightsaber.ui",function(){return{};});
define("src_web/lightsaber.library",function(){return{};});
define("jquery-orig",function(){return{};});
define("src/components/button/view/BaseButtonView",function(){return{};});
define("src/components/button/view/ButtonView",function(){return{};});
define("src/components/header/view/HeaderView",function(){return{};});
define("src/components/forminput/view/BaseFormElementView",function(){return{};});
define("src/components/forminput/view/FormElementTouchpointBaseView",function(){return{};});
define("src/components/forminput/view/InputTextView",function(){return{};});
define("src/components/forminput/view/InputTextAreaView",function(){return{};});
define("src/components/forminput/view/CheckboxView",function(){return{};});
define("src/components/forminput/view/RadioView",function(){return{};});
define("src_web/components/forminput/view/SelectView",function(){return{};});
define("src_web/components/forminput/view/WebSliderView",function(){return{};});
define("src/components/forminput/view/BaseSelectView",function(){return{};});
define("src/components/forminput/view/FlipSwitchView",function(){return{};});
define("src/components/forminput/view/BooleanView",function(){return{};});
define("src/components/forminput/view/FileLoaderView",function(){return{};});
define("src/components/searchinput/view/SearchInputViewBase",function(){return{};});
define("src/components/searchinput/view/SearchInputView",function(){return{};});
define("src/components/itemlist/view/BaseItemListView",function(){return{};});
define("src/components/itemlist/view/ItemListView",function(){return{};});
define("src/components/itemlist/view/GroupedItemListView",function(){return{};});
define("src/components/navbar/viewmodel/NavBarViewModel",function(){return{};});
define("src_web/components/navbar/view/NavBarView",function(){return{};});
define("src/components/navbar/viewmodel/SubNavBarViewModel",function(){return{};});
define("src_web/components/navbar/view/SubNavBarView",function(){return{};});
define("src/components/chart/view/ChartView",function(){return{};});
define("src_web/components/tabpanel/view/TabPanelView",function(){return{};});
define("src/components/proxy/viewmodel/ProxyViewModel",function(){return{};});
define("src/components/form/view/FormView",function(){return{};});
define("src/components/popup/view/PopupView",function(){return{};});
define("src/components/carousel/view/BaseCarouselView",function(){return{};});
define("src/components/carousel/view/CarouselView",function(){return{};});
define("src_web/components/application/view/Application",function(){return{};});
define("src_web/components/application/view/Module",function(){return{};});
define("src_web/components/application/view/Navigation",function(){return{};});
define("src_web/components/application/view/PopupModule",function(){return{};});
define("src/components/pagination/view/BasePaginationView",function(){return{};});
define("src/components/pagination/view/PaginationView",function(){return{};});
define("src_web/components/ftable/view/TableView",function(){return{};});
define("src/components/progressbar/view/ProgressBarView",function(){return{};});
define("src_web/components/accordion/view/AccordionView",function(){return{};});
define("src/components/autoComplete/view/AutoCompleteView",function(){return{};});
define("src_web/components/picker/view/PickerView",function(){return{};});
define("src_web/components/breadcrumbs/view/BreadcrumbsView",function(){return{};});
define("src/components/application/view/LoadingView",function(){return{};});
define("src/components/collectionView/view/CollectionView",function(){return{};});
define("src/components/wizard/view/WizardView",function(){return{};});
define("businesswidget/repository/common/view/GenericInputView/GenericInputTextView",function(){return{};});
define("careTopicsBinding",function(){return{};});
define("sync",function (){var a={version:"1.0.0",load:function(b,c,d,e){c([b],function(c){e.isBuild?d():"function"==typeof c?a.fetch(b,new c,d):d.error(new Error('Cannot instantiate: "'+b+'" module is not a constructor'))})},fetch:function(a,b,c){"function"==typeof b.fetchSync&&b.fetchSync({id:a})?c(b):"function"==typeof b.fetch?b.fetch({id:a,success:function(){c(b)},error:function(b,d){console&&console.log&&console.log('Fetching data from "'+a+'" failed. Got response: '+d),c(!1)}}):c.error(new Error('Cannot fetch data from "'+a+'". There is no `fetch()` method.'))},normalize:function(a,b){var c=a.indexOf("!");return(c>-1?a.substring(0,c)+"!":"")+b(a.substr(c+1))}};return a});
define("text",["module"],function (a){"use strict";function b(a,b){return void 0===a||""===a?b:a}function c(a,c,d,e){if(c===e)return!0;if(a===d){if("http"===a)return b(c,"80")===b(e,"80");if("https"===a)return b(c,"443")===b(e,"443")}return!1}var d,e,f,g,h,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],j=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,k=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,m=(l&&location.protocol&&location.protocol.replace(/\:/,""),l&&location.hostname,l&&(location.port||void 0),{}),n=a.config&&a.config()||{};return d={version:"2.0.15",strip:function(a){if(a){a=a.replace(j,"");var b=a.match(k);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:n.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;b<3;b+=1){c=i[b];try{a=new ActiveXObject(c)}catch(d){}if(a){i=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.lastIndexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return f!==-1&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1)):b=a,d=c||b,f=d.indexOf("!"),f!==-1&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,e,f){var g,h,i,j=d.xdRegExp.exec(a);return!j||(g=j[2],h=j[3],h=h.split(":"),i=h[1],h=h[0],(!g||g===b)&&(!h||h.toLowerCase()===e.toLowerCase())&&(!i&&!h||c(g,i,b,f)))},finishLoad:function(a,b,c,e){c=b?d.strip(c):c,n.isBuild&&(m[a]=c),e(c)},load:function(a,b,c,e){if(e&&e.isBuild&&!e.inlineText)return void c();n.isBuild=e&&e.isBuild;var f=d.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=b.toUrl(g);n.useXhr||d.useXhr;return 0===h.indexOf("empty:")?void c():void("json"===f.ext||"txt"===f.ext||"html"===f.ext?d.get(h,function(b){d.finishLoad(a,f.strip,b,c)},function(a){c.error&&c.error(a)}):b([g],function(a){d.finishLoad(f.moduleName+"."+f.ext,f.strip,a,c)}))},write:function(a,b,c,e){if(m.hasOwnProperty(b)){var f=d.jsEscape(m[b]);c.asModule(a+"!"+b,"define(function () { return '"+f+"';});\n")}},writeFile:function(a,b,c,e,f){var g=d.parseName(b),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=c.toUrl(g.moduleName+h)+".js";d.load(i,c,function(b){var c=function(a){return e(j,a)};c.asModule=function(a,b){return e.asModule(a,j,b)},d.write(a,i,c,f)},f)}},"node"===n.env||!n.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(e=require.nodeRequire("fs"),d.get=function(a,b,c){try{var d=e.readFileSync(a,"utf8");"\ufeff"===d[0]&&(d=d.substring(1)),b(d)}catch(f){c&&c(f)}}):"xhr"===n.env||!n.env&&d.createXhr()?d.get=function(a,b,c,e){var f,g=d.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);n.onXhr&&n.onXhr(g,a),g.onreadystatechange=function(d){var e,f;4===g.readyState&&(e=g.status||0,e>399&&e<600?(f=new Error(a+" HTTP status: "+e),f.xhr=g,c&&c(f)):b(g.responseText),n.onXhrComplete&&n.onXhrComplete(g,a))},g.send(null)}:"rhino"===n.env||!n.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?d.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===n.env||!n.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(f=Components.classes,g=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),h="@mozilla.org/windows-registry-key;1"in f,d.get=function(a,b){var c,d,e,i={};h&&(a=a.replace(/\//g,"\\")),e=new FileUtils.File(a);try{c=f["@mozilla.org/network/file-input-stream;1"].createInstance(g.nsIFileInputStream),c.init(e,1,0,!1),d=f["@mozilla.org/intl/converter-input-stream;1"].createInstance(g.nsIConverterInputStream),d.init(c,"utf-8",c.available(),g.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),d.readString(c.available(),i),d.close(),c.close(),b(i.value)}catch(j){throw new Error((e&&e.path||"")+": "+j)}}),d});
define("text!repository.config.json",function (){return'({\n    "touchPoint": "W",\n    "salesChannel": "SS",\n    "cm_rest_default_module": "rp-server",\n\n    "SelfServiceSC": ["SS"],\n    "CallCenterSC": ["CC"],\n    "RetailSC": ["RT"],\n\n    "cssBaseFile": "businesswidget/repository/common/css/style.css",\n    "repositorySA": true, // stand alone mode\n\n    "errorMessageHandling": true, // displays widget errors inside widgets\n    "throwErrorsToWidgetsConsumer": true, // delegates error object to widget consumer, works only if errorMessageHandling is true\n\n    "globalErrorHandlerAlert": false,\n\n    "restrictedNotificationChannels": ["SELFSERVICE"],\n\n    "authorizationTokenStorageKey": "LightsaberSessionToken",\n    "defaultLocale": "en_US",\n    "allowedLocales": ["en", "en-us", "fr", "fr-fr", "fr-ca", "zh", "de", "zh_tw", "de_de"],\n\n    "getLogicalDate": true,\n    "usageThreshold": 95,\n    "defaultImageForTopRecommnededItem": "businesswidget/repository/common/resources/commerce/web/images/S_Top-item_banner_view.jpg",\n    "defaultImageForBanner": "S_Top-item_banner_view.jpg",\n    "ADDRESS_DELIMITER": ",",\n    // 10 minutes expiration time\n    "logicalDateExpiration": 600000,\n\n\n    //BankAcccount\n    "bank.accountname": \'80\',\n    "bank.number": \'16\',\n    "bank.code": \'8\',\n    "bank.name": \'80\',\n    "bank.branchcode": \'8\',\n    //Creditcard\n    "credit.cardnumber": \'16\',\n    "credit.nameoncard": \'80\',\n    "CommerceCatalogRetrieveCategoriesModel.rff": "true",\n    "displayWidgetErrorDetailsControl": true,\n    "commonResourcesBaseUrl": "../../repository/common/resources/ux-bootstrap/",\n    //CompareItems\n    "maxItemsToCompare": 4,\n\n    //Anonymous Security\n    "anonymousSecurityKey": "anon_sec_key",\n\n    //Image Base\n    "imageBase": "businesswidget/repository/common/resources/images/",\n\n    //Itemlist widget stock availability\n    "itemList_stockAvailability_lower_threshold_value": 10,\n    "itemList_stockAvailability_upper_threshold_value": 100,\n\n    //Search widget stock availability\n    "search_stockAvailability_lower_threshold_value": 10,\n    "search_stockAvailability_upper_threshold_value": 100,\n\n    //top items widget\n    "defaultTopItemScreenArea.width": 385,\n    "defaultTopItemScreenArea.height": 250,\n    "displayedTopItem": 1,\n    "numberOfTopItems": 2,\n\n    //order confirmation widget\n    "defaultImagePath": "Thank_you.svg",\n\n    // NPC\n    "npcBusinessType.TVChannel": "TV_CHANNEL",\n    "npcBusinessType.TVPackage": "TV_PACKAGE",\n    "npcListType.TVPackages": "TP",\n    "npcListType.TVChannels": "CHNL",\n    "npcPropertyFormatType.TextBox": "TEXTBOX",\n    "npcAttachmentType.LVPIC": "LVPIC",\n    "npcAttachmentPurpose.MA": "MA",\n    "npcStepType.TVChannels": "ChC",\n    "npcStepType.TVPackages": "PaC",\n    "npcBusinessType.Device": "DEVICE",\n    "lobs": {\n        TV: "TV",\n        WS: "WS",\n        WL: "WL",\n        IN: "IN"\n    },\n    "salesChannelEnum": {\n        "SS": "SS",\n        "CC": "CC",\n        "RT": "RT"\n    }\n\n})'});
define("text!l3_common.repository.config.json",function (){return'({\n\t "cm_rest_default_module" : "rp-webapp-3-common"\n})\n\n'});
define("i18n",["module"],function (e){var f=e.config();return{version:"2.0.1",load:function(e,g,h,i){i=i||{},i.locale&&(f.locale=i.locale);var j,k,l,m=d.exec(e),n=m[1],o=m[4],p=m[5],q=o.split("-"),r=[],s={},t="";if(m[5]?(n=m[1],j=n+p):(j=e,p=m[4],o=f.locale,o||(o=f.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),q=o.split("-")),i.isBuild){for(r.push(j),b(g,"root",r,n,p),k=0;k<q.length;k++)l=q[k],t+=(t?"-":"")+l,b(g,t,r,n,p);g(r,function(){h()})}else g([j],function(b){var d,e=[];for(a("root",b,e,r,n,p),k=0;k<q.length;k++)d=q[k],t+=(t?"-":"")+d,a(t,b,e,r,n,p);g(r,function(){var a,d,f;for(a=e.length-1;a>-1&&e[a];a--)f=e[a],d=b[f],!0!==d&&1!==d||(d=g(n+f+"/"+p)),c(s,d);h(s)})})}}});
define("replace",["text","i18n"],function (){"use strict";function a(a,b,c){return a[b]||(a[b]=c)}var b={},c={},d={},e={"*":{}};return function(f,g){g||(g={});var h,i,j,k,l,m,n,o,p=e;for(h in f)if(!b[h]||d[h]||g.force){for(i=f[h],l=c[i]||i,p["*"][h]=l,k=(b[i]||[]).concat([i]),n=0,o=k.length;n<o;++n)a(p,k[n],{})[h]=h;if(j=d[h]){for(m=l,l=p["*"][h]=c[j]||j,n=0,o=k.length;n<o;++n)p["*"][k[n]]=l,c[k[n]]=l;for(o=b[h].length,k=b[h].concat(k),n=0;n<o;++n)a(p,k[n],{})[h]=m;delete d[h]}b[h]=k,!1===g.transitive||c[h]||(c[h]=l),g.mixin&&(d[h]=i)}else a(p,f[h],{})[h]=h;requirejs.config({map:p})}});
define("repository.lightsaber.custom.preload",function (){});
define("repository.lightsaber.custom",["replace","repository.lightsaber.custom.preload"],function() {});
define("preload.utils",function (){});
define("text!lightsaber.config.json",function (){return'({\n\t/**\n\t * Defines the defaults for ALL RESTDataSource resource.\n\t * \'REST data source\' block is used by core for the RESTDataSource defaults settings. \n\t * Add additional blocks for initializing specific RESTDataSource resources\n\t * with values different then core defaults. \n\t * possible values configured in the defaults block are protocol,host and port (only) \n\t */\n\t"REST data source" : {\n\t\t"defaults": {\n\t\t\t//"protocol" : "https",\n\t\t\t//"host" : "invpbg038.corp.amdocs.com",\n\t\t\t//"port" : 50251,\n\t\t\t"module" : "rp-server"\t\t\n\t\t}\n\t},\n\t\n\t"useFixture": false,\n\t\n\t"useDeviceEmulation" : true,\n\n\t"responsive": true,\n\n\t"imports" : {\n\t\t"hubImpl": true\n\t}\n\t\n\t\n    \n\n})\n'});
define("src/core/util/Utils",["jquery","underscore","backbone","knockout","knockout.mapping"],function (a,b,c,d,e){var f=/:\w+/g,g=/\*\w+/g,h=/[-[\]{}()+?.,\\^$|#\s]/g,i=function(){new Date("2014-01-01T00:00:00+00:00");return function(a){var b,c,d=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/,e=d.exec(a)||[];if(e[1]){b=e[1].split(/\D/);for(var f=0,g=b.length;f<g;f++)b[f]=parseInt(b[f],10)||0;return b[1]-=1,b=new Date(Date.UTC.apply(Date,b)),b.getDate()?(e[5]&&(c=60*parseInt(e[5],10),e[6]&&(c+=parseInt(e[6],10)),"+"==e[4]&&(c*=-1),c&&b.setUTCMinutes(b.getUTCMinutes()+c)),b):NaN}return new Date(a)}}(),j={configure:function(a,c,d){this.options&&(c=b.extend({},this.options,c));for(var e=0,f=d.length;e<f;e++){var g=d[e];b.isUndefined(c[g])||(a[g]=c[g])}a.options=c},guid:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},checkConfig:function(a,c){for(var d in a)if(b.isUndefined(c[a[d]]))throw"attribute '"+a[d]+"' was not found for validation '"+c.check+"'"},getValueByPath:function(a,c,f){var g,h,i,j;if(c&&"string"==typeof c){for(c=c.replace(/\[(\w+)\]/g,".$1"),c=c.replace(/^\./,""),g=c.split(".");g.length;){if(h=g.shift(),i=d.isObservable(a)?d.unwrap(a):a,!("object"==typeof i&&h in i))return;a=i[h]}return j=f?a:b.isObject(a)?e.toJS(a):d.unwrap(a)}},_getValueByPropPath:function(a,c,f,g){var h,i,j,k;if(c&&"string"==typeof c){for(c=c.replace(/\[(\w+)\]/g,".$1"),c=c.replace(/^\./,""),h=c.split(".");h.length;){if(i=h.shift(),j=d.isObservable(a)?d.unwrap(a):a,"object"!=typeof j)return;if(b.isArray(j)){for(var l=0;l<j.length;l++)if(b.has(j[l],f)&&j[l][f]===i){a=j[l];break}}else{if(!b.has(j,i))return;a=j[i]}}return k=g?a:b.isObject(a)?e.toJS(a):d.unwrap(a)}},setOrInitValueByPath:function(a,c,e,f){var g,h,i,j=a;if(c){g=c.split(".");for(var k=0,l=g.length;k<l;k++){if(h=g[k],k===l-1){if(!f){d.isObservable(j[h])?j[h](e):b.isObject(j[h])?j[h]=b.extend({},j[h],e):j[h]=e;break}if(b.isUndefined(j[h])){j[h]=e;break}b.isArray(j[h])?j[h]=b.extend([],e,j[h]):b.isObject(j[h])&&(j[h]=b.extend({},e,j[h])),i=j[h]}else b.isUndefined(j[h])&&(j[h]={});j=j[h]}}return i},setValueByPath:function(a,c,e,f){var g,h,i=a;if(c){g=c.split(".");for(var j=0,k=g.length;j<k;j++){if(h=g[j],j===k-1){d.isObservable(i)?i()[h]=e:d.isObservable(i[h])?d.isObservable(e)?i[h]=e:i[h](e):i[h]=e;break}d.isObservable(i)?i=i()[h]:b.isUndefined(i[h])?i[h]={}:i=i[h]}}},safeUnwrap:function(a){var b,c=d.computed(function(){b=e.toJS(a)});return c.dispose(),b},_normalizeVmKey:function(a){var b=a.split(":");return 2===b.length?["subViewModels",b[0].replace(/\./g,".subViewModels."),b[1]].join("."):a},asLiteral:function(a){var c,d=a;return b.isObject(a)?(d=a,this._objectPropsAsLiterals(d)):a!==!0&&a!==!1&&""!==a&&(c=Number(a),b.isNaN(c)||(d=c)),d},_objectPropsAsLiterals:function(a){var c=this;b.each(a,function(d,e){b.isObject(d)?c._objectPropsAsLiterals(d):a[e]=c.asLiteral(d)})},getFieldValue:function(a,c,d,e){var f=c[a],g=d[f];return b.isUndefined(g)&&c.invar&&(g=e.get(f)),g},getDate:i,extend:function(c,d){c=b.clone(c||{}),d=b.clone(d||{}),b.each(c,function(a,d){b.isFunction(a)&&this.prototype[d]&&n.test(a)&&a!=o&&(c[d]=l(a,this.prototype,d))},this),this.mergeProperties=this.mergeProperties?this.mergeProperties:{},b.extend(this.mergeProperties,{optionsMap:"merge"}),this.mergeProperties&&(b.each(this.mergeProperties,function(d,e){b.isArray(this.prototype[e])||b.isArray(c[e])?c[e]=b.union(this.prototype[e]||[],c[e]||[]):c[e]=a.extend(!0,{},this.prototype[e]||{},c[e]||{})},this),d.mergeProperties=b.extend({},d.mergeProperties||{},this.mergeProperties));var e=k.call(this,c,d);return e.postExtend&&e.postExtend(),e._super=this,e},routeToRegExp:function(a){return a=a.replace(h,"\\$&").replace(f,"([^/]+)").replace(g,"(.*?)"),new RegExp("^"+a+"$")},clone:function(a,c){return c?b.clone(a):JSON.parse(JSON.stringify(a))},extractParameters:function(a,b){return a.exec(b).slice(1)},create:function(d,e,f,g){var h,i,k,l,m,n,o=[],q=e===c.Model||e.prototype instanceof c.Model||e===c.Collection||e.prototype instanceof c.Collection,r=e===c.View||e.prototype instanceof c.View;for(q||(g=f),o.push(j.getMappedOptions(this,d,e,f)),this.hasOwnProperty("cust")&&this.cust[d]&&o.push(this.cust[d]),n=this.constructor.prototype;;){if(n.hasOwnProperty("cust")&&n.cust[d]&&o.push(n.cust[d]),!n.constructor._super)break;n=n.constructor._super.prototype}for(g&&o.push(g),l={},h=o.length-1;h>=0;--h)if(g=o[h],b.isFunction(g))l=g.call(this,l);else for(b.isArray(g)||(g=[{merge:g}]),i=0,k=g.length;i<k;++i)if(b.isFunction(g[i]))l=g[i].call(this,l);else for(m in g[i])switch(m){case"component":e=g[i][m];break;case"merge":a.extend(!0,l,g[i][m]);break;case"override_top":a.extend(l,g[i][m]);break;case"override":l=a.extend({},g[i][m]);break;case"delete":p(l,g[i][m])}var s,t=b.extend(l,{___parent:this,___id:d});if(q)s=new e(f,t);else{if(r){var u=!0;this.options.___processUnderscore!==!1&&this.getConfig("processUnderscore")!==!1||(u=!1),s=new e(b.extend(t,{___processUnderscore:u}))}else if(e.isViewModel&&requirejs.appContext){var v=j._getVmGroupId(this);s=requirejs.appContext.createVM(e,t,v(e))}else s=new e(t);j.mapMethods(s),this.___children=this.___children||[],this.___children.push(s),this.___children.hash=this.___children.hash||{},this.___children.hash[d]=s}return s},collectionComparator:function(a){function c(a){return parseFloat(a).toString()==a}if("asc"==this.sortOrder)return a.get(this.sortName);var d=a.get(this.sortName);return c(d)?-d:(d=d.toLowerCase(),d=d.split(""),d=b.map(d,function(a){return String.fromCharCode(-a.charCodeAt(0))}))},_base64Chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_base64regex:/[^A-Za-z0-9\+\/\=]/g,decode64:function(a){var b,c,d,e,f,g,h,i=new Array(Math.ceil(.75*a.length)),j=0,k=0;if(this._base64regex.exec(a))throw"invalid base64 characters in text input"+a;do e=this._base64Chars.indexOf(a.charAt(k++)),f=this._base64Chars.indexOf(a.charAt(k++)),g=this._base64Chars.indexOf(a.charAt(k++)),h=this._base64Chars.indexOf(a.charAt(k++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i[j++]=b,64!=g&&(i[j++]=c),64!=h&&(i[j++]=d);while(k<a.length);return i.length=j,i},stringify:function(a){return this.stringifyForIE8(a)},stringifyForIE8:function(b){if(null===b)return"null";var c=typeof b;if("undefined"!==c){if("number"===c||"boolean"===c)return""+b;if("string"===c)return a.quoteString(b);if("object"===c){if("function"==typeof b.toJSON)return a.toJSON(b.toJSON());if(b.constructor===Date){var d=b.getUTCMonth()+1,e=b.getUTCDate(),f=b.getUTCFullYear(),g=b.getUTCHours(),h=b.getUTCMinutes(),i=b.getUTCSeconds(),j=b.getUTCMilliseconds();return d<10&&(d="0"+d),e<10&&(e="0"+e),g<10&&(g="0"+g),h<10&&(h="0"+h),i<10&&(i="0"+i),j<100&&(j="0"+j),j<10&&(j="0"+j),'"'+f+"-"+d+"-"+e+"T"+g+":"+h+":"+i+"."+j+'Z"'}if(b.constructor===Array){for(var k=[],l=0;l<b.length;l++)k.push(a.toJSON(b[l])||"null");return"["+k.join(",")+"]"}for(var m,n,o=[],p=0;p<b.length;p++){if(c=typeof p,"number"===c)m='"'+p+'"';else{if("string"!==c)continue;m=a.quoteString(p)}c=typeof b[p],"function"!==c&&"undefined"!==c&&(n=a.toJSON(b[p]),o.push(m+":"+n))}return"{"+o.join(",")+"}"}}}},k=c.View.extend,l=function(a,c,d){var e=function(){var b,e=this._super;return this._super=c[d],b=a.apply(this,arguments),this._super=e,b};return b.extend(e,a),e.prototype=a.prototype,e},m=/sometext/.test(function(){}),n=m?/\b_super\b/:/.*/,o=m?l(function(){}).toString():"$",p=function(a,c){for(var d in c)d in a&&(b.isObject(c[d])&&b.isObject(a[d])?p(a[d],c[d]):delete a[d])};j.getMappedOptions=function r(c,d,e,f,g){if(b.isUndefined(g)&&(g={}),b.isUndefined(c))return g;if("optionsMap"in c){var h={},i=c.optionsMap[d];if(!b.isUndefined(i)){for(var k in i)if(c[k]){h[k]=h[k]||{};var l;for(var m in i[k]){var n=i[k][m];l=void 0,"config"===k&&(l=j.getValueByPath(c.getConfig(),n,!0)),b.isUndefined(l)&&(b.isObject(n)?l=n.value:b.isUndefined(c[k][n])?b.isUndefined(j.getValueByPath(f[k],m))?b.isUndefined(j.getValueByPath(e.prototype[k],m))||(l=j.getValueByPath(e.prototype[k],m)):l=j.getValueByPath(f[k],m):l=c[k][n]),b.isUndefined(l)||(h[k][m]=l)}}else{var f=i[k],o={};b.isObject(f)&&!b.isUndefined(f.value)&&1===b.keys(f).length?o=f.value:b.each(f,function(a,b){o[b]=a.value}),h[k]=o}a.extend(g,h)}}return b.isUndefined(c.___id)?g:r(c.___parent,c.___id+(d?"."+d:""),e,f,g)},j._getVmGroupId=function(a){return b.isUndefined(a)?function(){}:"getGroupId"in a?a.getGroupId.bind(a):j._getVmGroupId(a.___parent)};var q=function s(a,c,d){if(a)if(a.actionMap){var e=a.actionMap[d];if(e)for(var f in e)a[e[f]]=b.bind(c[f],c)}else d=a.___id+(d?"."+d:""),s(a.___parent,c,d)};return j.mapMethods=function(a){q(a,a)},j.isEventSupported=function(){function a(a){var b=a.split(":"),c=document.createElement(b[0]||"div");a="on"+b[1];var d=a in c;return d||(c.setAttribute(a,"return;"),d="function"==typeof c[a]),c=null,d}return a}(),j.Factory={create:j.create,getChildById:function(a){return this.___children.hash[a]}},j.Common={getPropertyByPrecedence:function(a,c){var d=c;return b.isUndefined(this.options[a])?b.isUndefined(this[a])||(d=this[a]):d=this.options[a],d}},j.FileUpload={getXhrOptions:function(a,c){var d=this._getFileObj(c,a),e=this._buildFormDataObj(d,a);return b.extend({data:e,contentType:!1},c)},submitDataAsForm:function(b,c){var d=this,e={readyState:0,getResponseHeader:function(a){return null},getAllResponseHeaders:function(){return null},setRequestHeader:function(a,b){return this},overrideMimeType:function(a){return this},statusCode:function(a){return this},abort:function(a){return this}},f=jQuery.Deferred(),g=jQuery.Callbacks("once memory");f.promise(e).complete=g.add,e.success=e.done;var h=a(this._getFileObj(c,b)),i=h.attr("id")+"_iframe",j=this._createIframe(i),k=this._createForm(i,h,b,c);return j.bind("load",function(){try{var a=d._getIframeContentAsJSON(i);c.success(a,200,e),f.resolveWith(this,[a])}catch(b){b.number===-2146828218&&c.error({})}k.remove(),j.remove()}),k.submit(),e},isFormDataSupported:function(){return window.FormData},_isFormDataObj:function(a){return this.isFormDataSupported()&&a instanceof FormData},_isFormDataElm:function(a){return a&&a.tagName&&"input"===a.tagName.toLowerCase()&&a.type&&"file"===a.type.toLowerCase()},_getFileObj:function(b,c){var d=b.file;if(!d){var e=this;a.each(c,function(a,b){if(e._isFormDataObj(b))return d=b,!1;if(e._isFormDataElm(b)){var c=b;if(e.isFormDataSupported()){d||(d=new FormData);for(var f=0;f<c.files.length;f++){var g=c.files[f];d.append(c.name,g,g.name)}}else d||(d=new Array),d.push(c)}return!0})}return d},hasFileToSubmit:function(c,d){if(d=b.extend({},d),d.file===!1)return!1;var e=this._isFormDataObj(d.file)||this._isFormDataElm(d.file),f=this;return a.each(c,function(a,b){return!f._isFormDataObj(b)&&!f._isFormDataElm(b)||(e=!0,!1)}),e},_buildFormDataObj:function(b,c){if(!this.isFormDataSupported()||!this._isFormDataObj(b))return null;var d=this;return a.each(c,function(a,c){d._isFormDataElm(c)||d._isFormDataObj(c)||b.append(a,c)}),b},_createIframe:function(b){var c=a('<iframe id="'+b+'" name="'+b+'" style="display:none;">');return c.appendTo(a("body")),c},_createForm:function(b,c,d,e){var f=a('<form method="post" enctype="multipart/form-data" action="'+e.url+'" target="'+b+'" style="display:none;"></form>');f.appendTo(a("body"));var g=c.clone();c.replaceWith(g),f.append(c);var h=this;return a.each(d,function(a,b){h._isFormDataElm(b)||f.append('<input type="hidden" name="'+a+'" value="'+b+'" />')}),e.headers&&a.each(e.headers,function(a,b){f.append('<input type="hidden" name="'+a+'" value="'+b+'" />')}),f},_getIframeContentAsJSON:function(a){var b=document.getElementById(a),c=b.contentDocument?b.contentDocument:b.contentWindow.document,d=null,e=c.body.innerHTML;c.body.firstChild&&"pre"==c.body.firstChild.nodeName.toLowerCase()&&(e=c.body.firstChild.firstChild.nodeValue);try{d=JSON.parse(e)}catch(f){d={}}return d}},j.HistoryStack=function(){var a=[],c=-1;return{push:function(d){c<a.length-1&&(a=b.first(a,c)),a.push(d),c=a.length-1},next:function(){return this.move(1)},prev:function(){return this.move(-1)},move:function(b){var d=c+b;if(!(d<0||d>=a.length))return c=d,a[c]},peek:function(b){var d=c+b;if(!(d<0||d>=a.length))return a[d]}}},j.KO={getCustomExtendedContextObservable:function(a,b,c){"undefined"==typeof c&&(c=2);var e=function(){return arguments.length>=c?b.apply(this,arguments):d.isObservable(a)?1===arguments.length?a(arguments[0]):a():a};return d.utils.extend(e,d.observable.fn),e}},j.loadModule=function(a,c){console.log(a+" load requested");var d={success:function(){console.log(a+" loaded successfully")},error:function(){console.log(a+" failed to loaded")}};c=b.extend(d,c),a=b.isArray(a)?a:[a],requirejs(a,c.success,c.error)},j});
define("src/core/resourceBundle/ResourceBundle",["underscore","src/core/util/Utils"],function (a,b){var c=function(a,b){this.availableBundles=a,b&&(this.currentBundle=this.availableBundles[b])};return a.extend(c,{extend:b.extend}),a.extend(c.prototype,{_generateFinalString:function(a,b){for(var c=a,d=0;d<b.length;d++)c=c.replace("{"+String(d)+"}",b[d]);return c},getString:function(a,b,c){var d=c?this.availableBundles[c]:this.currentBundle;if(!d)throw new Error("Current bundle is not defined");var e=d[a];return e&&b&&(e=this._generateFinalString(e,b)),e},getKeys:function(b){var c=bundleStr?this.availableBundles[bundleStr]:this.currentBundle;if(!c)throw new Error("Current bundle is not defined");return a.keys(c)},getValues:function(b){var c=bundleStr?this.availableBundles[bundleStr]:this.currentBundle;if(!c)throw new Error("Current bundle is not defined");return a.values(c)},create:b.create}),c});
define("src/core/dataSource/DataSource",["underscore","backbone","src/core/util/Utils"],function (a,b,c){var d=function(b){var c=this;this.sync=this.sync||function(a,b,d){return c[a].call(c,b,d)},a.bindAll(this,"mapModel"),this.initialize(b)},e={};return a.each(["create","read","update","delete"],function(a){e[a]=function(c,d){return b.sync.call(this,a,c,d)}}),a.extend(d,{extend:c.extend}),a.extend(d.prototype,b.Events,e,{initialize:function(a){},getSync:function(){return this.sync},defaults:{},prepareOptions:function(b){return a.extend({},{mapModel:this.mapModel},this.defaults,b||{})},attrMap:{id:"orig_id",orig_id:"id"},mapModel:function(a){var b={},c={};for(var d in this.attrMap)a.has(d)&&(c[this.attrMap[d]]=a.get(d),b[d]=void 0);a.set(b,{silent:!0,unset:!0}),a.set(c)},getProperties:function(){return{supportsPagination:!1,supportsSorting:!1,supportsFiltering:!1}},create:c.create}),d});
define("src/core/util/StorageUtil",["jquery","underscore"],function (a,b){var c={get:function(a){return j(this._s[a])},set:function(a,b){this._s[a]=i(b)},deleteKey:function(a){a?b.isArray(a)||(a=[a]):a=this.getKeys(),b.each(a,function(a){this._s.removeItem(a)},this)},getKeys:function(){return b.keys(this._s)},getStorageType:function(){return"local"},_isAvailable:function(){return"undefined"!=typeof Storage},_s:window.localStorage},d=b.defaults({getStorageType:function(){return"session"},_s:window.sessionStorage},c),e=b.defaults({getStorageType:function(){return"memory"},_isAvailable:function(){return!0},_s:{}},c),f={get:function(a){return j(l(a,this.isPersistent));
},set:function(a,b){k(a,i(b),this.isPersistent)},deleteKey:function(a){n(a,this.isPersistent)},getKeys:function(){return m(this.isPersistent)},getStorageType:function(){return"securedSessionCookie"},_isAvailable:function(){return!0}},g=b.defaults({isPersistent:!0,getStorageType:function(){return"securedPersistentCookie"}},f),h={_storageObjects:{memory:{storage:e},session:{storage:d},local:{storage:c},securedSessionCookie:{storage:f},securedPersistentCookie:{storage:g}},getStorage:function(a,c){b.isString(a)||(c=a,a="session");var d=c&&c.fallback||"memory";if(!this._storageObjects[a])throw"Storage type "+a+" is not supported";return b.isUndefined(this._storageObjects[a].isAvailable)&&(this._storageObjects[a].isAvailable=this._storageObjects[a].storage._isAvailable()),this._storageObjects[a].isAvailable?this._storageObjects[a].storage:this.getStorage(d)},setTestingMode:function(a){this.testingMode=a},get:function(a){return this.getStorage().get(a)},set:function(a,b){return this.getStorage().set(a,b)},deleteKey:function(a){return this.getStorage().deleteKey(a)},getKeys:function(){return this.getStorage().getKeys()},getStorageType:function(){return this.getStorage().getStorageType()}},i=function(a){return a=JSON.stringify(a)},j=function(a){return"undefined"===a?a=void 0:b.isString(a)&&(a=JSON.parse(a)),a},k=function(a,b,c){var d=(c?"p":"s")+a+"="+escape(b);if(c){var e=new Date;e.setFullYear(e.getFullYear()+1),d+=";expires="+e.toUTCString()}h.testingMode||(d+=";secure"),document.cookie=d},l=function(a,b){var c=document.cookie.match("(?:^|;) *"+(b?"p":"s")+a+"=([^;]*)(?:;|$)");if(c)return unescape(c[1])},m=function(a){var c=a?/\bp[^;=\s]+(?:(?==))/g:/\bs[^;=\s]+(?:(?==))/g,d=b.map(document.cookie.match(c),function(a){return a.slice(1)});return d},n=function(a,c){var d=new Date(0).toUTCString();a?b.isArray(a)||(a=[a]):a=m(c),b.each(a,function(a){document.cookie=(c?"p":"s")+a+"=; expires="+d})};return h});
define("src/core/dataSource/LocalStorageDataSource",["jquery","businesswidget/repository_l9_common/common/core/ImplStorageUtil","src/core/dataSource/DataSource","src/core/util/Utils"],function (a,b,c,d){var e=c.extend({_delimiter:"/",_pathRegEx:/^[/][\w-_.~/]*$/,create:function(a,b){var c=b&&b.url||f(a,"url");if(!c||!this._pathRegEx.test(c))return _.isFunction(b.error)&&b.error("URL is mandatory and restricted to URL scheme"),g;var e=a.id||b.id||d.guid();a.id||a.set(a.idAttribute,e),this._addToUrl(c,e);var i=a.toJSON();return this.storage.set(c+this._delimiter+e,i),_.isFunction(b.success)&&b.success(i,"OK"),h},read:function(a,b){var c,d,e=h,i=b&&b.url||f(a,"url");if(i&&this._pathRegEx.test(i)){if(b.id||a.id){var j=a.id?i:i+this._delimiter+b.id;c=this.storage.get(j)}else c=this._readAll(i);c||(d="not found")}else d="URL is mandatory and restricted to URL scheme";return d?(_.isFunction(b.error)&&b.error(d),e=g):_.isFunction(b.success)&&b.success(c,"OK"),e},update:function(a,b){var c=b&&b.url||f(a,"url");if(!c||!this._pathRegEx.test(c))return _.isFunction(b.error)&&b.error("URL is mandatory and restricted to URL scheme"),g;var d=a.toJSON();return this.storage.set(c,d),_.isFunction(b.success)&&b.success(d,"OK"),h},"delete":function(a,b){var c=b&&b.url||f(a,"url");if(c&&this._pathRegEx.test(c)){var d=c.lastIndexOf(this._delimiter),e=c.substring(0,d),i=c.substring(d+1),j=this.storage.get(e);return!j.children[i]&&b&&_.isFunction(b.error)?(b.error("not found"),g):(delete j.children[i],this.storage.set(e,j),this.storage.deleteKey(c),b&&_.isFunction(b.success)&&b.success(),h)}return g},localStorageSize:function(a){var b=this.storage.get(a);return b&&b.children&&_.size(b.children)},_addToUrl:function(a,b){a||(a=this._delimiter);var c=this.storage.get(a);if(c)c.children||(c.children={});else{if(a!==this._delimiter){var d=a.lastIndexOf(this._delimiter),e=a.substring(0,d),f=a.substring(d+1);this._addToUrl(e,f)}c={children:{}}}c.children[b]||(c.children[b]=!0,this.storage.set(a,c))},_readAll:function(a){var b=null,c=this.storage.get(a);if(c&&c.children&&!_.isEmpty(c.children)){b=[];for(var d in c.children){var e=this.storage.get(a+this._delimiter+d);e&&(delete e.children,b.push(e))}}return b}}),f=function(a,b){return a&&a[b]?_.isFunction(a[b])?a[b]():a[b]:null},g=a.Deferred().reject().promise(),h=a.Deferred().resolve().promise();return _.each([g,h],function(a){_.extend(a,{abort:function(){},readyState:4})}),e.prototype.storage=b.getStorage("local"),e});
define("src/core/model/Validator",["underscore","backbone","src/core/util/Utils"],function (a,b,c){var d=function(){};return d.prototype.defined=function(b,c,d){this.checkConf(["fieldName"],b);var e=this.getFieldValue("fieldName",b,c,d);if(a.isUndefined(e))return this.makeErrorObject(b,"value for '"+b.fieldName+"' should be defined",b.fieldName,e)},d.prototype.notEmpty=function(b,c,d){this.checkConf(["fieldName"],b);var e=this.getFieldValue("fieldName",b,c,d);if(a.isEmpty(e))return this.makeErrorObject(b,"value for '"+b.fieldName+"' should not be empty",b.fieldName,e)},d.prototype.type=function(b,c,d){this.checkConf(["fieldName","type"],b);var e=this.getFieldValue("fieldName",b,c,d),f=typeof e;if(!a.isUndefined(e)&&f!==b.type)return this.makeErrorObject(b,b.fieldName+"'s type should be "+b.type+", was "+f,b.fieldName,e)},d.prototype.lessThan=function(b,c,d){this.checkConf(["field1Name","field2Name"],b);var e=this.getFieldValue("field1Name",b,c,d);if(!a.isUndefined(e)){var f=Number(e);if(isNaN(f))return this.makeErrorObject(b,b.field1Name+"("+e+") should be a number",b.field1Name,e);var g=this.getFieldValue("field2Name",b,c,d);if(!a.isUndefined(g)){var h=Number(g);return isNaN(h)?this.makeErrorObject(b,b.field2Name+"("+g+") should be a number",b.field2Name,g):f>=h?this.makeErrorObject(b,b.field1Name+"("+f+") should be less than "+b.field2Name+"("+h+")",b.field1Name,e,b.field2Name,g):void 0}}},d.prototype.minLength=function(b,c,d){this.checkConf(["fieldName","min"],b);var e=this.getFieldValue("fieldName",b,c,d);if(!a.isUndefined(e))return!a.isString(e)||e.length<b.min?this.makeErrorObject(b,b.fieldName+"'s length should not be less than "+b.min+", was >"+e+"<",b.fieldName,e):void 0},d.prototype.length=function(b,c,d){this.checkConf(["fieldName"],b);var e=this.getFieldValue("fieldName",b,c,d);if(!a.isUndefined(e))return a.isString(e)?e.length>b.max?this.makeErrorObject(b,b.fieldName+"'s length should not be longer than "+b.max+", was >"+e+"<",b.fieldName,e):e.length<b.min?this.makeErrorObject(b,b.fieldName+"'s length should not be shorter than "+b.min+", was >"+e+"<",b.fieldName,e):void 0:this.makeErrorObject(b,b.fieldName+" should be a string",b.fieldName,e)},d.prototype.maxLength=function(b,c,d){this.checkConf(["fieldName","max"],b);var e=this.getFieldValue("fieldName",b,c,d);if(!a.isUndefined(e))return!a.isString(e)||e.length>b.max?this.makeErrorObject(b,b.fieldName+"'s length should not be longer than "+b.max+", was >"+e+"<",b.fieldName,e):void 0},d.prototype.min=function(b,c,d){this.checkConf(["fieldName","min"],b);var e=this.getFieldValue("fieldName",b,c,d);if(!a.isUndefined(e))return isNaN(e)||e<b.min?this.makeErrorObject(b,b.fieldName+" should be at least "+b.min+", was >"+e+"<",b.fieldName,e):void 0},d.prototype.max=function(b,c,d){this.checkConf(["fieldName","max"],b);var e=this.getFieldValue("fieldName",b,c,d);if(!a.isUndefined(e))return isNaN(e)||e>b.max?this.makeErrorObject(b,b.fieldName+" should be at most "+b.max+", was >"+e+"<",b.fieldName,e):void 0},d.prototype.regExp=function(a,b,c){this.checkConf(["fieldName","pattern"],a);var d=this.getFieldValue("fieldName",a,b,c);if(a.pattern instanceof RegExp||(a.pattern=new RegExp(a.pattern,a.modifiers)),!a.pattern.test(d)==!a.not)return this.makeErrorObject(a,a.fieldName+' does not match "'+a.pattern.source+'"',a.fieldName,d)},d.prototype.not=function(a,b,c){this.checkConf(["op"],a);var d=this[a.op.check](a.op,b,c);return d?void 0:this.makeErrorObject.apply(this,this.makeArgs(a,"NOT has failed",b))},d.prototype.and=function(a,b,c){this.checkConf(["op1","op2"],a);var d=this[a.op1.check](a.op1,b,c),e=this[a.op2.check](a.op2,b,c);return d||e?this.makeErrorObject.apply(this,this.makeArgs(a,"AND has failed",b)):void 0},d.prototype.or=function(a,b,c){this.checkConf(["op1","op2"],a);var d=this[a.op1.check](a.op1,b,c),e=this[a.op2.check](a.op2,b,c);return d&&e?this.makeErrorObject.apply(this,this.makeArgs(a,"OR has failed",b)):void 0},d.prototype.checkConf=function(b,c){for(var d in b)if(a.isUndefined(c[b[d]]))throw"configuration attribute '"+b[d]+"' was not found for validation '"+c.check+"'"},d.prototype.getFieldValue=function(b,c,d,e){var f=c[b],g=f.split(".");return a.reduce(g,function(a,b){return a?a[b]:void 0},d)},d.prototype.makeArgs=function(a,b,c){var d,e=[a,b];for(d in a.fieldNames)e.push(a.fieldNames[d]),e.push(c[a.fieldNames[d]]);return e},d.prototype.makeError=function(a,b,c,d){for(var e={},f=2;f<arguments.length;f+=2)e[arguments[f]]=arguments[f+1];return{source:"validation",status:"lightsaber.core."+a,statusText:b,attrs:e}},d.prototype.makeErrorObject=function(a,b,c,d){for(var e={},f=2;f<arguments.length;f+=2)e[arguments[f]]=arguments[f+1];var g=a.status?a.status:"lightsaber.core."+a.check;return{source:"validation",status:g,statusText:b,attrs:e,conf:a}},d.extend=c.extend,d});
define("src/core/model/ErrorHandler",["underscore","backbone","src/core/util/Utils"],function (a,b,c){var d=function(){};return d.handleError=function(a,b,c){d.lastResponse=b},d.extend=c.extend,d.prototype.create=c.create,d});
define("src/core/model/Model",["jquery","underscore","backbone","src/core/model/Validator","src/core/model/ErrorHandler","src/core/util/Utils"],function (a,b,c,d,e,f){var g=c.Model.extend({_validate:function(a,c){if(!this.validate||this.validations&&!this.validator)return!0;a=b.extend({},this.attributes,a);var d=this.validate(a,c);if(!d)return!0;if(c&&c.error)c.error(this,d,c);else if(!c.silent&&(this.trigger("error",this,d,c),this.trigger("invalid",this,d,b.extend(c||{},{validationError:d})),d.errors))for(var e=0;e<d.errors.length;e++)for(var f in d.errors[e].attrs)this.trigger("error:"+f,this,d.errors[e],c);return!1},validate:function(a,b){var c,d=[],e=[];if(this.validations){for(var f in this.validations)if(this._ensureCheck(this.validations[f],a,b)){var g=this.validator[this.validations[f].check].call(this.validator,this.validations[f],a,this);g&&(this._isWarning(b,this.validations[f])?e.push(g):d.push(g))}if(b&&delete b.api,d.length)c={source:"validation",status:"error",statusText:"operation has failed",errors:d,warnings:e};else if(e.length){var h={source:"validation",status:"warning",statusText:"operation has succeeded with warnings",warnings:e};if(b&&b.warning)b.warning(this,h,b);else{b._warningWasFound=!0,this.trigger("warning",this,h,b);for(var i=0;i<e.length;i++)for(var j in e[i].attrs)this.trigger("warning:"+j,this,e[i],b)}}}return c},_ensureCheck:function(a,c,d){if(d=d||{},a.onlyIf&&!a.onlyIf.call(c))return!1;var e=a.check;if(!e)throw"'check' attribute was not found on validation: "+JSON.stringify(a);var f=this.validator[e];if(!b.isFunction(f))throw"the specified 'check' ("+e+") is not a function";var g=d.hasOwnProperty("validateSetOnly")?d.validateSetOnly:this.options.validateSetOnly,h="set"!=d.api||!g;if(!h){var i=a.fieldName&&[a.fieldName]||a.fieldNames||[];h=0==i.length;for(var j=0;j<i.length&&!h;){var k=i[j++];if(h=c.hasOwnProperty(k),!h){var l=k.split(".");h=l.length>1&&b.reduce(l,function(a,b){return a?a[b]:void 0},c)}}}return h},_isWarning:function(a,c){var d=!1,e=a&&a.api;return c.warn&&(d=e?c.warn[e]||b.isUndefined(c.warn[e])&&c.warn.all:c.warn.all),d},set:function(a,d,e){var f;b.isObject(a)||null==a?(f=a,e=d):(f={},f[a]=d),f&&delete f.__EmptyObject__,e&&"set"===e.api||(e=b.defaults({api:"set"},e));var g=c.Model.prototype.set.call(this,f,e);if(!g)return g;var h=this;return b.each(f,function(a,b){a&&h.isBindable(a)&&a.on("all",function(a,c,d){h!==c&&(a=h.adjustEventName(a,b),h.trigger(a,c,d))})}),g},setDataSource:function(a,b){this.dataSource=a,this.setSync(a.getSync(),b)},getDataSource:function(){return this.dataSource},initialize:function(a,c){if(c=b.defaults({},c,this.options,{api:"init"}),c.url&&(this.urlRoot=c.url,delete this.url),this.validations){this.validator=new d;for(var e in this.validations){var f=this.validations[e].warn||{};b.defaults(f,{set:!0,save:!1}),this.validations[e].warn=f}}c.errorHandler&&(this.errorHandler=c.errorHandler),this.options=b.pick(c,"autoSnapshot","deepAutoSnapshot","validateSetOnly")},get:function(a){return a?c.Model.prototype.get.call(this,a):this.attributes},isValid:function(a){return this._validate(void 0,b.extend({api:"isValid"},a))},fetch:function(a){a=a?b.clone(a):{},void 0===a.parse&&(a.parse=!0);var d=this,e=a.success;return a.success=function(b){return!!d.set(d.parse(b,a),a)&&(e&&e(d,b,a),void d.trigger("sync",d,b,a))},c.wrapError(this,a),this.sync("read",this,a)},abortAjax:function(a){var c=this;this.xhrPool=b.filter(this.xhrPool,function(b){var d=!a||a.toUpperCase()===b.method.toUpperCase();return d&&(b.abort(),c.trigger("error",c,b),c.trigger("error:"+b.status,c,b)),d})},save:function(a,d,e){var f,g,h,i=this.attributes;if(null==a||"object"==typeof a?(f=a,e=d):(f={})[a]=d,e&&"save"===e.api||(e=b.defaults({api:"save"},e)),f&&(!e||!e.wait)&&!this.set(f,e))return!1;if(e=b.extend({validate:!0},e),!this._validate(f,e))return!1;f&&e.wait&&(this.attributes=b.extend({},i,f)),void 0===e.parse&&(e.parse=!0);var j=this,k=e.success;return e.success=function(a,c,d){e.xhr=d,j.attributes=i;var g=j.parse(a,e);return e.wait&&(g=b.extend(f||{},g)),!(b.isObject(g)&&!j.set(g,e))&&(k&&k(j,a,e),void j.trigger("sync",j,a,e))},c.wrapError(this,e),g=this.isNew()?"create":e.patch?"patch":"update","patch"===g&&(e.attrs=f),h=this.sync(g,this,e),f&&e.wait&&(this.attributes=i),h},destroy:function(a){a=a?b.clone(a):{};var d=this,e=a.success,f=function(){d.trigger("destroy",d,d.collection,a)};if(a.success=function(b){(a.wait||d.isNew())&&f(),e&&e(d,b,a),d.isNew()||d.trigger("sync",d,b,a)},this.isNew())return a.success(),!1;c.wrapError(this,a);var g=this.sync("delete",this,a);return a.wait||f(),g},takeSnapshot:function(b){this._snapshotAttributes=b?a.extend(!0,{},this.attributes):a.extend({},this.attributes)},revertToSnapshot:function(a){var b={silent:a};this.clear(b),this.set(this._snapshotAttributes,b)},setSync:function(a,d){if(!a||!b.isFunction(a))throw"setSync: sync should be a function";var e=this;this.sync=function(c,d,f){if(d.trigger("synching",d,f),this.currentErrorHandler!==this.errorHandler&&(this.currentErrorHandler&&this.off("error",this.currentErrorHandler),this.currentErrorHandler=this.errorHandler,this.on("error",this.currentErrorHandler)),f=b.defaults({},f,this.options),f.autoSnapshot){var g=f.success;f.success=function(){e.takeSnapshot(f.deepAutoSnapshot),g&&g.apply(void 0,arguments)}}var h=a(c,d,f);return d.xhrPool=d.xhrPool||[],d.xhrPool.push(h),h},d=d||{};var f=d.mapModel;f&&b.isFunction(f)&&f(this);var g=d.idAttribute;g&&b.isString(g)&&(this.idAttribute=g,this.id=c.Model.prototype.get.call(this,g))},isBindable:function(a){return a.on&&b.isFunction(a.on)},adjustEventName:function(a,b){var c=a.indexOf(":");return c!=-1&&(a=a.substring(0,c+1)+b+a.substring(c)),a},errorHandler:e.handleError,create:f.create},{postExtend:function(){this.pool={}},getInstance:function(a,c){var d=a[this.prototype.idAttribute];if(d){c&&"getInstance"===c.api||(c=b.defaults({api:"getInstance"},c));var e=this.findInstance(d);return e?e.set(a,c):(e=new this(a,c),this.getPool()[d]=e),e}},removeInstance:function(a){var b=this.findInstance(a);return delete this.getPool()[a],b},findInstance:function(a){return this.getPool()[a]},getPool:function(){return this.pool?this.pool:this.pool={}},setGlobalErrorHandler:function(a){this.prototype.errorHandler=a},unsetGlobalErrorHandler:function(){delete this.prototype.errorHandler}});return c.wrapError=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b)||(a.trigger("error",a,d,b),a.trigger("error:"+d.status,a,d,b))}},g.extend=f.extend,g});
define("src/core/util/Configuration",["src/core/model/Model","text!lightsaber.config.json"],function (Model,ConfigData){var Configuration=Model.extend({loadConfiguration:function(configData){"string"==typeof configData&&(configData=eval("("+configData+")")),this.set(configData)},loadCoreConfiguration:function(clearFirst){if(clearFirst===!0&&this.clear(),"string"==typeof ConfigData&&(ConfigData=eval("("+ConfigData+")")),requirejs.appContext){var configDataFromContext=requirejs.appContext.getConfigData();configDataFromContext&&(configDataFromContext.host&&(ConfigData["REST data source"].defaults.host=configDataFromContext.host),configDataFromContext.port&&(ConfigData["REST data source"].defaults.port=configDataFromContext.port),configDataFromContext.protocol&&(ConfigData["REST data source"].defaults.protocol=configDataFromContext.protocol),configDataFromContext.hasOwnProperty("useFixture")&&(ConfigData.useFixture=configDataFromContext.useFixture))}this.loadConfiguration(ConfigData)}}),configuration=new Configuration;return configuration.loadCoreConfiguration(),configuration});
define("src/core/dataSource/RESTDataSource",["jquery","underscore","backbone","src/core/util/Utils","src/core/util/Configuration"],function (a,b,c,d,e){var f=function(a){var c={create:{method:"POST",contentType:"application/json"},read:{method:"GET"},readPage:{method:"GET",supportsPagination:!1,supportsSorting:!1,supportsFiltering:!1,parse:k},update:{method:"PUT",contentType:"application/json"},"delete":{method:"DELETE"}};this.namedParam=a&&a.namedParam?a.namedParam:/:(\w+)/g,this.methods=b.extend({},a),delete this.methods.namedParam,b.each(c,function(a,c){this.methods[c]?b.defaults(this.methods[c],a):this.methods[c]=a},this),this.defaults=this.methods.defaults||{};var d=e.get("REST data source")||{};this.globalDefaults=d.defaults||{},this.initialize.apply(this,arguments)};f.prototype.sync=function(c,e,f){var g=this.methods[c]||h("method "+c+" is not defined");f=b.extend({},f);var i=this.getProperty("fullURL",g,f)||this.composeURL(g,e,f);this.lastUrl=i;var k=f.type||g.method||this.defaults.method||h("no HTTP method is defined for "+c),l=this.getProperty("dataType",g,f)||"json",m={type:k,dataType:l,url:i};m.headers=this.mergeProperty("headers",g,f),delete f.headers,m.contentType=this.getProperty("contentType",g,f),m.timeout=this.getProperty("timeout",g,f);var n=f.success,o=this;f.success=function(a,b,c){n&&n(o.parse(a,g,f),b,c)};var p=e.toJSON();if(d.FileUpload.hasFileToSubmit(p,f)){if(!d.FileUpload.isFormDataSupported()){var q=d.FileUpload.submitDataAsForm(p,b.extend(m,f));return q}f=d.FileUpload.getXhrOptions(p,f)}if(!f.data&&e){var r=this.getProperty("contentType",g,f);if("application/json"==r||"application/x-www-form-urlencoded"==r){m.contentType=r;var s=e.toJSON(),t=this.getProperty("payload",g,f);t&&(s=j.apply(s,t)),m.data=JSON.stringify(s)}"application/x-www-form-urlencoded"==r&&(m.data=m.data?{model:m.data}:void 0)}"GET"!==m.type&&(m.processData=!1);var u=a.ajax(b.extend(m,f));return e&&e.trigger("request",e,u,f),u},f.prototype.parse=function(a,c,d){var e=a,f=this.getProperty("parse",c,b.isFunction(d.parse)?d:{});return b.isFunction(f)&&(e=f(a)),e},f.prototype.setQueryParams=function(a){this.dynamicQueryParams=a},f.prototype.getProperties=function(){return{supportsPagination:this.methods.readPage.supportsPagination,supportsSorting:this.methods.readPage.supportsSorting,supportsFiltering:this.methods.readPage.supportsFiltering}},f.prototype.setFullURL=function(a,b){this.methods[a].fullURL=b},f.prototype.getSync=function(){return b.bind(this.sync,this)},f.prototype.composeURL=function(a,c,d){var e=this.getProperty("url",a,d)||g(c,"url");d.url&&delete d.url;var f=this.makeQueryParams(a,d);e=this.appendQueryString(e,f);var h=e.match(this.namedParam);if(h)for(var i=0;i<h.length;i++){var j=h[i].substring(1),k=d.params&&d.params[j]||a.params&&a.params[j]||c&&c.get(j)||this.defaults.params&&this.defaults.params[j]||this.globalDefaults.params&&this.globalDefaults.params[j];b.isString(k)&&"@"===k.charAt(0)?(k=k.substring(1),k=d[k]||c&&c.get(k)):b.isUndefined(k)&&(k=d[j]),e=e.replace(h[i],encodeURIComponent(k))}return e=this.prefixUrl(e,a,d)},f.prototype.makeQueryParams=function(a,c){var d={};if(c.pagination){var e=this.getProperty("names",a,c)||{pageStart:"indexOfFirst",pageSize:"pageSize"};d[e.pageStart]=c.pagination.pageStart,d[e.pageSize]=c.pagination.pageSize}for(var f in c.sorting)d[f]=c.sorting[f];for(f in c.filtering)d[f]=c.filtering[f];var g="qParams";return b.defaults(d,c[g],this.dynamicQueryParams,a[g],this.defaults[g],this.globalDefaults[g])},f.prototype.appendQueryParam=function(a,b){var c="";return b instanceof Array?1===b.length?c=this.appendQueryParam(a,b[0]):b.length>1&&(c=this.appendQueryParam(a,b.shift())+"&"+this.appendQueryParam(a,b)):c=a+"="+encodeURIComponent(b),c},f.prototype.appendQueryString=function(a,b){var c="";for(var d in b)c+=(c?"&":"")+this.appendQueryParam(d,b[d]);return a+(c?"?":"")+c},f.prototype.prefixUrl=function(a,b,c){var d="",e=this.getProperty("protocol",b,c)||window.location.protocol;d=e+(":"==e.charAt(e.length-1)?"":":")+"//";var f=this.getProperty("host",b,c)||window.location.hostname,g=this.getProperty("port",b,c)||window.location.port;d=d+f+(g?":"+g:"");var h=this.getProperty("module",b,c);return h&&(d+="/"+encodeURI(i(h))),d+="/"+i(a)},f.prototype.getProperty=function(a,b,c){return c[a]||b[a]||this.defaults[a]||this.globalDefaults[a]},f.prototype.mergeProperty=function(a,c,d){return b.defaults({},d[a],c[a],this.defaults[a],this.globalDefaults[a])},f.prototype.initialize=function(){};var g=function(a,c){return a&&a[c]?b.isFunction(a[c])?a[c]():a[c]:null},h=function(a){throw new Error(a)},i=function(a){var b="/"==a.charAt(0)?1:0,c=a.length-("/"==a.charAt(a.length-1)?1:0);return a.substring(b,c)},j=function(){var a={},c=this;return b.each(Array.prototype.slice.call(arguments,0),function(d){b.isUndefined(c[d])||(a[d]=c[d])}),b.isEmpty(a)?void 0:a},k=function(a){return{pageStart:a.indexOfFirst,pageSize:a.pageSize,totalSize:a.numberOfRows,hasMore:a.hasMore,data:a.data}};return f.extend=d.extend,f.prototype.create=d.create,f});
define("src/core/dataSource/LSRESTDataSource",["jquery","underscore","src/core/dataSource/RESTDataSource","businesswidget/repository_l9_common/common/core/ImplStorageUtil","src/core/util/Utils","src/core/util/Configuration"],function (a,b,c,d,e,f){var g=c.extend({lsSessionTokenAlias:f.get("lsSessionTokenAlias")||"LightsaberSessionToken",initialize:function(){if(!g.initialized){var b=this;a(window).bind("storage",function(a){a.key==b.lsSessionTokenAlias&&b.setToken(a.newValue)}),g.initialized=!0}},setToken:function(a,b){g.token!==a&&(g.token=a,b&&this.storage.set(this.lsSessionTokenAlias,a),g.trigger(g.TOKEN_UPDATE_EVENT,{token:a}))},getToken:function(){return g.token||(g.token=this.storage.get(this.lsSessionTokenAlias)),g.token},sync:function(a,d,e){e=b.extend({},e);var f=this,h=e.error;e.error=function(a,b){if(f.handleXhr(a),h){var c;try{c=JSON.parse(a.responseText)}catch(d){c=a.responseText}g.trigger(g.ERROR,{statusCode:a.status,data:c,xhr:a}),h(a,b)}};var i=e.success;return e.success=function(a,b,c){f.handleXhr(c),i&&i(a,b,c)},this.applySecurity(e),c.prototype.sync.call(this,a,d,e)},handleXhr:function(a){var b=a.getResponseHeader("uxfauthorization");b&&this.setToken("null"===b?void 0:b,!0)},applySecurity:function(a){var b=this.getToken();if(b){a.LSPassword&&(b+=" UXF_SecActionPSW:"+a.LSPassword,delete a.LSPassword);var c=a.headers||(a.headers={});c.authorization=b}else if(a.LSPassword)throw"Protected Lightsaber service requires a token"},getSync:function(){return b.bind(this.sync,this)},create:e.create});return g.extend=e.extend,g.prototype.storage=d.getStorage("session"),g.TOKEN_UPDATE_EVENT="tokenUpdated",g.ERROR="error",g.TOKEN_INVALID="tokenInvalid",g.TOKEN_EXPIRED="tokenExpired",b.extend(g,Backbone.Events),g});
define("src/core/model/RESTModel",["underscore","src/core/model/Model","src/core/dataSource/RESTDataSource","businesswidget/repository_l9_common/common/core/ImplLSRESTDataSource","src/core/util/Utils"],function (a,b,c,d,e){var f=b.extend({initialize:function(c,d){var e=a.defaults({},d&&d.rest,this.options&&this.options.rest);b.prototype.initialize.call(this,c,d),this.setRESTConfig(e)},setRESTConfig:function(a){var b=a&&a.unsecured?new c(a):new d(a);this.setDataSource(b)},setQueryParams:function(a){this.getDataSource().setQueryParams(a)},create:e.create});return f.extend=e.extend,f});
define("src/core/dataSource/RESTSession",["underscore","backbone","src/core/util/Utils","src/core/model/RESTModel"],function (a,b,c,d){var e=function(){};return e.init=function(){if(!this.model){var a={read:this.rest&&this.rest.login};this.model=new d(null,{rest:a})}},e.login=function(a,b,c){this.init(),this.model.set({user:a,password:b}),this.model.fetch(c)},e.logout=function(){this.init(),this.model.getDataSource().setToken(void 0,!0)},e.extend=c.extend,e.prototype.create=c.create,e});
define("src/core/model/Collection",["jquery","underscore","backbone","src/core/model/Model","src/core/dataSource/RESTDataSource","businesswidget/repository_l9_common/common/core/ImplLSRESTDataSource","src/core/model/ErrorHandler","src/core/util/Utils"],function (a,b,c,d,e,f,g,h){var i=c.Collection.extend({model:d,initialize:function(a,c){var d=b.defaults(c||{},this.options);d.rest&&this.setRESTConfig(d.rest),d.url&&(this.url=d.url),d.pagination&&(this.pagination={},this.reset(),this.setPagination(d.pagination)),d.sorting&&this.setSorting(d.sorting,!0),d.filtering&&this.setFiltering(d.filtering,!0),d.errorHandler&&(this.errorHandler=d.errorHandler),this.on("change",function(){this.hasModelChanged=!0},this),this.on("sort",function(a){this.trigger("reset",a)},this),this.added=0},add:function(a,d){var e=b.isArray(a)?a.length:1;if(0!==e&&a){if(d||(d={}),!d.isRest&&this.pagination&&this.pagination.all&&this.length!==this.pagination.all.length)throw"cannot add when holes exist";var f=d.at?d.at:this.models.length;if(d.isRest||(this.added+=e),c.Collection.prototype.add.call(this,a,d),this.serverPagination&&this.pagination)if(d.isRest||!d.at)for(var g=d.isRest?this.added+d.pageStart:this.pagination.all.length;0!==e--;)this.pagination.all[g]=this.at(f),g++,f++;else a=this.models.slice(f,f+e),Array.prototype.splice.apply(this.pagination.all,[d.at,0].concat(a))}},setDataSource:function(a,b){this.dataSource=a,a?(this.serverPagination=a.getProperties().supportsPagination,this.serverSorting=a.getProperties().supportsSorting,this._checkSortingCriteria(this.sorting)||(this.sorting=void 0),this._checkSortingCriteria(this.comparator)||(this.comparator=void 0),this.setSync(a.getSync(),b)):(this.serverPagination=void 0,this.serverSorting=void 0);var c=this.models;this.reset(null,{silent:!0}),this.add(c,{silent:!0})},getDataSource:function(){return this.dataSource},setAttribute:function(a,b){this.attributes||(this.attributes={}),this.attributes[a]=b},getAttribute:function(a){if(this.attributes)return this.attributes[a]},get:function(a){var d=b.isString(a)?this.getAttribute(a):void 0;return b.isUndefined(d)?c.Collection.prototype.get.call(this,a):d},setRESTConfig:function(a){var b=a&&a.unsecured?new e(a):new f(a);this.setDataSource(b)},setPagination:function(a){this.pagination||(this.pagination={}),b.isNumber(a.pageStart)&&(this.pagination.pageStart=a.pageStart),b.isNumber(a.pageSize)&&(this.pagination.pageSize=a.pageSize)},setSorting:function(a,c){if(!this._checkSortingCriteria(a))throw"sorting is not compatible with data source";var d=!a&&this.sorting;b.isFunction(a)?(this.comparator=a,this.sorting=void 0):(this.sorting=b.clone(a),this.comparator=void 0),this.serverSorting&&(d||this.sorting)&&!c&&this.fetch(),this.comparator&&this.sort()},getSorting:function(){return this.sorting?this.sorting:this.comparator},setFiltering:function(a,c){a||(this.filterator=void 0,this.filtering=void 0),b.isFunction(a)?this.filterator=a:this.filtering=b.clone(a),this.getDataSource()&&!c&&this.fetch()},getFiltering:function(){return this.filtering},setNextURL:function(a){return this.pagination.nextURL=a},setPrevURL:function(a){return this.pagination.prevURL=a},getProperties:function(){return this.dataSource.getProperties()},gotoRows:function(d,e,f){if(d<0&&(d=0),b.isNumber(e)||(f=e,e=this._getDefaultTo(d)),d>=e)throw'"from" should be less than "to"';if(this.pagination.maxIndex&&e>this.pagination.maxIndex+this.added)throw"requested rows are out of bounds";if(d>this.length&&this.added)throw"cannot goto when items were added";if(f=f?b.clone(f):{},this.pagination.pageStart=d,this.pagination.pageNum=Math.ceil((e-d)/this.pagination.pageSize-1),this.isPageAvailable(d,e))return f.success&&f.success(this,void 0),this.triggerDataReady(d,e-d),a.Deferred().resolve().promise();for(var g=d;g<e&&!b.isUndefined(this.serverPagination?this.pagination.all[g]:this.at(g));g++)d++;if(b.isUndefined(this.dataSource))throw"data source does not exist";var h;this.serverPagination?(h="readPage",f.pagination={pageStart:d-this.added,pageSize:e-d}):h="read";var i=this,j={orig:this.pagination.ver},k=f.success;return f.success=function(a,c,d){if(j.orig===i.pagination.ver){i.filterator&&(i.serverPagination?a.data=b.filter(a.data,i.filterator):a=b.filter(a,i.filterator)),i.serverPagination||(a={pageStart:0,pageSize:i.pagination.pageSize,totalSize:a.length,data:a}),a.totalSize?i.pagination.maxIndex=a.totalSize:b.isUndefined(a.hasMore)||(a.hasMore?i.pagination.maxIndex=a.pageStart+a.data.length+1:i.pagination.maxIndex=a.pageStart+a.data.length,i.pagination.hasMore=a.hasMore);var e={silent:!0,isRest:!0,pageStart:a.pageStart};i.add(a.data,e),i.length===a.data.length?i.trigger("reset",i):i.triggerDataReady(a.pageStart+i.added,a.data.length),k&&k(i,a.data,a)}},c.wrapError(i,f),this.serverSorting&&(f.sorting=this.sorting),f.filtering=this.filtering,this.sync.call(this,h,this,f)},gotoPage:function(a,b){var c=a*this.pagination.pageSize;return this.gotoRows(c,b)},updateOptionsWithFullURL:function(a,c){return b.isString(this.pagination[a])&&(c||(c={}),c.fullURL||(c.fullURL=this.pagination[a]),delete this.pagination[a]),c},next:function(a,c){var d=this.pagination.pageStart;return b.isNumber(a)?d+=this.pagination.pageSize*a:(c=a,d+=this.pagination.pageSize),c=this.updateOptionsWithFullURL("nextURL",c),this.gotoRows(d,c)},accNext:function(){var a=0,b=this.updateOptionsWithFullURL("nextURL"),c=this.getPageNum()+1,d=c*this.pagination.pageSize+this.pagination.pageSize;return d=Math.min(this.pagination.maxIndex,d),this.gotoRows(a,d,b)},prev:function(a,c){var d=this.pagination.pageStart;return b.isNumber(a)?d-=this.pagination.pageSize*a:(c=a,d-=this.pagination.pageSize),c=this.updateOptionsWithFullURL("prevURL",c),this.gotoRows(d,c)},accPrev:function(){var a=0,b=this.updateOptionsWithFullURL("prevURL"),c=this.getPageNum()+1,d=c*this.pagination.pageSize-this.pagination.pageSize;return d=Math.min(this.pagination.maxIndex,d),this.gotoRows(a,d,b)},fetch:function(a){return this.reset(void 0,{silent:!0}),a||(a={}),(this.serverSorting&&this.sorting||this.filtering)&&(this.serverSorting&&(a.sorting=this.sorting),a.filtering=this.filtering),a.reset=!0,this.pagination?this.gotoRows(0,a):c.Collection.prototype.fetch.call(this,a)},getPage:function(a){b.isUndefined(a)&&(a=0);var c=this.pagination?a*this.pagination.pageSize:0;return this.getRows(c)},getRows:function(a,b){var c;if(this.hasModelChanged&&(this.hasModelChanged=void 0,this.setSorting(this.getSorting())),this.pagination){var d=0===this.pagination.maxIndex;c=this.isPageAvailable(a,b,d)?this._makePage(a,b,d):{data:[],info:{totalSize:0}}}else c={data:this.models.slice(),info:{totalSize:this.length}};return c},isPageAvailable:function(a,c,d){b.isBoolean(c)&&(d=c,c=void 0),b.isNumber(c)||(c=this._getDefaultTo(a));var e=void 0;if(this.serverPagination){(a>=c||c>this.pagination.all.length&&!d)&&(e=!1);for(var f=a;void 0===e&&f<c;f++)b.isUndefined(this.pagination.all[f])&&!d?e=!1:!b.isUndefined(this.pagination.all[f])&&d&&(e=!0);void 0===e&&(e=!d)}else e=a<c&&(c<=this.models.length||d)||!this.getDataSource();return e},triggerDataReady:function(a,b){this.trigger("dataReady",{pageStart:a,pageNum:this.getPageNum(a),
pageSize:b},this)},reset:function(a,d){if(this.pagination){d||(d={});var e=d.silent;d.silent=!0}if(this.added=0,c.Collection.prototype.reset.call(this,a,d),this.pagination){if(b.isUndefined(this.pagination.ver)?this.pagination.ver=0:this.pagination.ver++,this.serverPagination){this.pagination.all=[];for(var f=0;f<this.length;f++)this.pagination.all[f]=this.at(f)}this.pagination.pageStart=0,b.isNumber(this.pagination.pageSize)||(this.pagination.pageSize=0),this.pagination.maxIndex=0,this.pagination.nextURL=void 0,this.pagination.prevURL=void 0,e||(this.trigger("reset",this,d),d.silent=e)}return this},isAccumelated:function(){return!(!this.pagination||!b.isNumber(this.pagination.pageStart))&&(0===this.pagination.pageStart&&this.pagination.pageNum>=1)},getPageNum:function(a){if(this.pagination){if(this.isAccumelated()&&b.isNumber(this.pagination.pageNum))return this.pagination.pageNum;var c=b.isUndefined(a)?this.pagination.pageStart:a;return Math.floor(c/this.pagination.pageSize)}return 0},sync:function(a,b,d){b.trigger("synching",b,d);var e=c.Collection.prototype.sync.call(this,a,b,d);return b.xhrPool=b.xhrPool||[],b.xhrPool.push(e),e},abortAjax:function(a){var c=this;this.xhrPool=b.filter(this.xhrPool,function(b){var d=!a||a.toUpperCase()===b.method.toUpperCase();return d&&(b.abort(),c.trigger("error",c,b),c.trigger("error:"+b.status,c,b)),d})},setSync:function(a,c){c||(c={});var d=function(b,c,d){return this.currentErrorHandler!==this.errorHandler&&(this.currentErrorHandler&&this.off("error",this.currentErrorHandler),this.currentErrorHandler=this.errorHandler,this.on("error",this.currentErrorHandler)),a(b,c,d)};this.sync=d,this.model.sync=d,this.model.idAttribute=c.idAttribute,b.each(this.models,function(b){b.setSync(a,c)}),c.idAttribute&&this.reset(this.models)},setPayload:function(a){this.payload=a},toJSON:function(){return this.payload?this.payload:c.Collection.prototype.toJSON.call(this)},getTotalPagesNumber:function(){var a=!b.isUndefined(this.pagination.hasMore)&&!this.pagination.hasMore||b.isUndefined(this.pagination.hasMore)&&this.pagination.maxIndex?Math.ceil((this.pagination.maxIndex+this.added)/this.pagination.pageSize):void 0;return a},getCurrentPageNumber:function(){return this.getPageNum()},hasPrev:function(a){!b.isUndefined(a)||(a=this.getPageNum());var c=void 0,c=b.isUndefined(this.pagination.maxIndex)?void 0:a>0&&(a-1)*this.pagination.pageSize<this.pagination.maxIndex+this.added;return c},hasNext:function(a){!b.isUndefined(a)||(a=this.getPageNum());var c=void 0;return c=b.isUndefined(this.pagination.maxIndex)?void 0:(a+1)*this.pagination.pageSize<this.pagination.maxIndex+this.added||this.pagination.hasMore!==!1&&void 0},_prepareModel:function(a,b){if(a instanceof c.Model)a.collection||(a.collection=this);else{var d=a;b.collection=this,a=new this.model(d,b),a._validate(a.attributes,b)||(a=!1)}return this.model.sync&&(a.sync=this.model.sync),this.model.idAttribute&&(a.idAttribute=this.model.idAttribute),a},_makePage:function(a,c,d){b.isBoolean(c)&&(d=c,c=void 0),b.isNumber(c)||(c=this._getDefaultTo(a));var e=this.serverPagination?this.pagination.all:this.models,f=b.reduce(e,function(d,e,f){return f>=a&&f<c&&!b.isUndefined(e)&&d.push(e),d},[]),g=this.getDataSource()&&!this.pagination.maxIndex?0:this.pagination.maxIndex+this.added;return{data:f,info:{pageStart:a,pageNum:this.getPageNum(a),pageSize:this.pagination.pageSize,totalSize:g,hasMore:this.pagination.hasMore,totalPages:Math.ceil(g/this.pagination.pageSize)}}},_getDefaultTo:function(a){if(this.pagination){var b=a+this.pagination.pageSize;this.pagination.maxIndex&&(b=Math.min(b,this.pagination.maxIndex+this.added))}else b=this.models.length;return b},_checkSortingCriteria:function(a){var c=!0;return!this.getDataSource()||b.isNull(a)||b.isUndefined(a)?c:c=this.serverPagination?this.serverSorting&&!b.isFunction(a)&&b.isObject(a):this.serverSorting?b.isObject(a):b.isFunction(a)},errorHandler:g.handleError,createComponent:h.create},{setGlobalErrorHandler:function(a){this.prototype.errorHandler=a},unsetGlobalErrorHandler:function(){delete this.prototype.errorHandler}});return i.extend=h.extend,i});
define("src/core/viewModel/ViewModelConstructor",["underscore","src/core/util/Utils","src/core/model/Model"],function (a,b,c){var d={visible:!0,enabled:!0},e=function(e){this.cid=a.uniqueId("vm"),e=e?a.clone(e):{},e.models=a.extend({},this.models,e.models),e.data=a.extend({},this.defaults,this.data,e.data),b.configure(this,e,["events","subViewModels"]),this.modelKeys=a.extend({},this.modelKeys,e.modelKeys),e.attrs&&(e.data=e.attrs),this._models=e.models,this._instantiateModels(e),this.delegateEvents(this._models),this.models=this._models||(this._models={}),this._initializeData(e),this.data.on("all",this._dataEventsHandler,this),this.config=new c(a.extend({},d,this.config,e.config||{})),this.config.on("all",this._configEventsHandler,this),this.dataBindings=[].concat(e.dataBindings||[],this.dataBindings),this.dataBindings=a.uniq(this.dataBindings,!1,function(a){var b;for(var c in a)if("options"!=c){b=c;break}return b}),this.subViewModels=a.extend({},e.subViewModels,this.subViewModels),this._instantiateSubViewModels(e),this._references=0,this.set("subViewModels",this.subViewModels),this.registerOnAjaxRelatedEvents(),this.initialize.apply(this,arguments),this._bindData()};return e});
define("src/core/formatter/DateFormatter",function (){var a=function(a){a&&a.resourceBundle&&(this.resourceBundle=a.resourceBundle)};a.prototype.format=function(a,b,c){var d=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,j=c?"getUTC":"get",k=a[j+"Date"](),l=a[j+"Day"](),m=a[j+"Month"](),n=a[j+"FullYear"](),o=a[j+"Hours"](),p=a[j+"Minutes"](),q=a[j+"Seconds"](),r=a[j+"Milliseconds"](),s=c?0:a.getTimezoneOffset(),t={d:k,dd:e(k),ddd:h(this.resourceBundle,l),dddd:h(this.resourceBundle,l,"long"),m:m+1,mm:e(m+1),mmm:i(this.resourceBundle,m),mmmm:i(this.resourceBundle,m,"long"),yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:e(o%12||12),H:o,HH:e(o),M:p,MM:e(p),s:q,ss:e(q),l:e(r,3),L:e(r>99?Math.round(r/10):r),tt:f(this.resourceBundle,o),TT:f(this.resourceBundle,o,"caps"),o:(s>0?"-":"+")+e(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:g(this.resourceBundle,k)};return b.replace(d,function(a){return a in t?t[a]:a.slice(1,a.length-1)})};var b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tueday","Wedesday","Thursday","Friday","Saturday"],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],d=["1st","2nd","3rd","4th","5th","6th","7th","8th","9th","10th","11th","12th","13th","14th","15th","16th","17th","18th","19th","20th","21st","22nd","23rd","24th","25th","26th","27th","28th","29th","30th","31th"],e=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a},f=function(a,b,c){var d=b<12?"am":"pm",e=j(a,d);return"caps"==c?e.toUpperCase():e},g=function(a,b){return j(a,d[b-1])},h=function(a,c,d){var e="long"==d?7+c:c;return j(a,b[e])},i=function(a,b,d){var e="long"==d?12+b:b;return j(a,c[e])},j=function(a,b){if(a){var c=a.getString(b);return"undefined"!=typeof c?c:b}return b};return a});
define("src/core/formatter/FormattersContainer",["src/core/util/Utils","src/core/util/Configuration","src/core/formatter/DateFormatter"],function (a,b,c){var d=function(){},e=function(a){return isNaN(a)||_.isString(a)&&(a=parseFloat(a)),a},f={absNumberFormatter:function(a){var c=this.getParams(),d=this.getResourceBundle(),f=b.get("defaultNumberOfDecimalsKey");d&&d.getString(f);a=e(a),_.isNumber(a)&&a<0&&(a=Math.abs(a));var g=c&&!isNaN(c.decimals)?c.decimals:c&&!isNaN(c.fixed)?c.fixed:d&&d.getString(f);str=isNaN(g)?new String(a):new String(Number(a).toFixed(g));var i=str.match(/(.*)\.(.*)$/,"$2")?str.replace(/(.*)\.(.*)$/,"$2"):"",j=d&&d.getString("thousandsSeparator")||",",k=d&&d.getString("decimalSeparator")||".",l=h(a).toString(),m=l.length,n=/^\d{4,}$/.test(l)?m%3:0,o=(n?l.slice(0,n)+j:"")+l.slice(n).replace(/(\d{3})(?=\d)/g,"$1"+j)+(i?k+i:"");return o},negativeSignFormatter:function(a){var b="";return a=e(a),a<0&&(b="-"),b},negativeSignLocation:function(){var a=this.getResourceBundle(),b=this.getParams();return b&&b.negativeLocation||a&&a.getString("negativeLocation")||"left"}},g={default_number_formatter:function(a){var b=f.absNumberFormatter.call(this,a),c=f.negativeSignFormatter.call(this,a),d=f.negativeSignLocation.call(this);return"right"===d||"r"===d?b+c:c+b},default_mask_formatter:function(a){var b=this.getResourceBundle(),c=this.getParams();if(b&&c.type){var d=b.getString(c.type);if(d)return String(a).replace(d[0],d[1])}return a},default_date_formatter:function(b){if(!_.isNull(b)&&!_.isUndefined(b)){var d=a.getDate(b);if("Invalid Date"!==d.toString()){var e=this.getResourceBundle();if(e){var f=this.getParams(),g=[this.getType()];f.type&&g.push(f.type),g.push("mask");var h=e.getString(g.join("_"))||e.getString(this.getType()+"_mask");if(h)return new c({resourceBundle:e}).format(d,h)}return d.toLocaleString()}}},default_currency_formatter:function(a){var b=this.getParams(),c=this.getResourceBundle(),d=f.negativeSignFormatter.call(this,a),e=f.negativeSignLocation.call(this),g=b&&b.hasOwnProperty("currencySpacer")?b.currencySpacer:c&&c.getString("currencySpacer")||"",h=b&&b.currency||c&&c.getString("currencySymbol")||"$",i=c&&c.getString("currencyLocation")||"left",j=f.absNumberFormatter.call(this,a),k="";if("right"===e||"r"===e)switch(i){case"right":case"r":k=j+h+g+d;break;case"absRight":k=j+d+g+h;break;default:k=h+g+j+d}else switch(i){case"right":case"r":case"absRight":k=d+j+g+h;break;case"absLeft":k=h+g+d+j;break;default:k=d+h+g+j}return k}};_.extend(d,{extend:a.extend}),_.extend(d.prototype,g);var h=function(a){var b=Math.floor(a<0?-a:a);return a<0?-b:b};return d});
define("src/core/formatter/Formatter",["underscore","backbone","src/core/util/Configuration","single!businesswidget/repository/common/util/CustomFormattersContainer"],function (a,b,c,d){var e=function(){};return e.prototype.format=function(b,e){var f=e.formatType;if("undefined"==typeof f)throw new Error("Format type must be specified");var g,h=c.get(f+"_formatter");g=h&&d[h]?h:"default_"+f+"_formatter";for(var i=a.extend(b,{getParams:function(){return e.formatParams||{}},getType:function(){return f}}),j=e.fields||[],k=[],l=0;l<j.length;l++)k.push(b.getVMData(j[l]));return d[g]?d[g].apply(i,k):k.join(",")},e.prototype.formatCurrentBindingContext=function(b,c,d){var e={fields:a.isArray(b)?b:[b]};return c&&(e.formatType=c),d&&(e.formatParams=d),this.format(this.bindContext,e)},e});
define("src/core/binding/Binding",["jquery","underscore","backbone","single!src/core/formatter/Formatter","knockout"],function (a,b,c,d,e){var f=function(){this.groups={},this.bindings={},this.counter=0};f.prototype.bindAll=function(a,b){var c=b||a&&a.dataBindings||[];for(var d in c){var e,f;for(var g in c[d])switch(g){case"options":break;default:e=g,f=c[d][g]}this.bind(a,e,f,c[d].options)}},f.prototype.bind=function(a,c,d,e){(b.isFunction(a)||b.isString(a))&&(e=d,d=c,c=a,a=null),e=b.extend({},e);var f=c,g=d;if(e.twoWay&&(!b.isString(c)||!b.isString(d)))throw"Two way binding can only be used for paths";if(e.setter){if(e.set)throw'Options "set" and "setter" should not both be provided';c=e.setter}if(b.isString(c))c=this.handleTargetPath(c,a,e);else if(!b.isFunction(c))throw"Target cannot be an expression";if(b.isString(d)?d=this.handlePath(d,a,e):b.isFunction(d)||(d=this.handleExpression(d.exp,a,e)),e.dependencySet&&e.dynamicDependency)throw"Either options.dependencySet or options.dynamicDependency can be set";this._bind(a,c,d,e),e.twoWay&&(delete e.dependencySet,delete e.setter,e.setOnBind=!1,delete e.targetField,delete e.targetObject,delete e.valueField,delete e.twoWay,this.bind(a,g,f,e))},f.prototype.unbind=function(a){if(a){for(var b in this.groups[a]){var c=this.groups[a][b];this.unbindDependencySet(this.bindings[c].dependencySet,this.bindings[c].handler),delete this.bindings[c]}delete this.groups[a]}else{for(var d in this.bindings)this.unbindDependencySet(this.bindings[d].dependencySet,this.bindings[d].handler);this.bindings={},this.groups={}}},f.prototype._bind=function(a,c,d,e){var f=this.counter++,g=h(e,!0),j=h(e,!1),k=i(e),l=b.defaults({error:g,warning:j},e);e.targetObject&&e.targetField&&k&&e.targetObject.on&&e.targetObject.on("error:"+e.targetField,k,this);var m=function(b,g,h){var i=this.calcValue(d,a,e,e.dynamicDependency);i.v!==this.bindings[f].v&&(this.bindings[f].v=i.v,l._warningWasFound=h&&h._warningWasFound,l._bound=!0,c.call(a,i.v,l),delete l._warningWasFound),e.dynamicDependency&&(this.handleDependencySet(i.dependencySet,m,this.bindings[f].dependencySet,this.bindings[f].handler),this.bindings[f].dependencySet=i.dependencySet)},n=e.dependencySet,o=this.calcValue(d,a,e,!n),p=n||o.dependencySet;0!==p.length&&e.setOnBind===!1||(e._bound=!0,c.call(a,o.v,e)),p.length>0&&(this.handleDependencySet(p,m),this.bindings[f]={},this.bindings[f].dependencySet=p,this.bindings[f].handler=m,this.bindings[f].v=o.v,e&&e.groupId&&(this.groups[e.groupId]||(this.groups[e.groupId]=[]),this.groups[e.groupId].push(f)))},f.prototype.handleTargetPath=function(a,c,d){var f=a.split(".");if(b.isEqual(f[0],"context")){if(b.isUndefined(d.context)||b.isUndefined(d.context[f[1]]))throw"When using context in path - options.context is mandatory"}else if(b.isNull(c))throw"When using this or models in path - default context is mandatory";var g,h="return ";switch(f[0]){case"this":g=c,h+="this";break;case"models":g=c.models,h+="this.models";break;case"subViewModels":g=c.subViewModels,h+="this.subViewModels";break;case"context":g=d.context,h+="options.context";break;default:f.unshift("this"),g=c,h+="this"}f.length>2&&"object"==typeof g.data&&g.data.__vmdata__&&(h+=".data",g=g.data);for(var i,j=1;j<f.length-1;j++){var k=f[j];e.isSubscribable(g[k])?(i=h,h+="."+k+"()",g=g[k]()):b.isFunction(g.get)?(i=h,h+='.get("'+k+'")',g=g.get(k)):(h+='["'+k+'"]',g=g[k])}k=f[j],d.targetField=d.targetField||k;var l=d.set||"set";return e.isSubscribable(g[k])?(i=h,h+="."+k+"(v)"):b.isFunction(g[l])?(i=h,h+="."+l+'("'+k+'", v, options)'):h+='["'+k+'"] = v',d.targetObject||(d.targetObject=i?new Function("options",i).call(c,d):void 0),new Function("v","options",h)},f.prototype.handlePath=function(a,c,d){var f=a.split(".");if(b.isEqual(f[0],"context")){if(b.isUndefined(d.context)||b.isUndefined(d.context[f[1]]))throw"When using context in path - options.context is mandatory"}else if(b.isNull(c))throw"When using this or models in path - default context is mandatory";var g,h=f[0];switch(f[0]){case"this":g=c;break;case"models":g=c.models;break;case"subViewModels":g=c.subViewModels,h="this.subViewModels";break;case"context":g=d.context;break;default:f.unshift("this"),g=c,h="this"}for(var i=1;i<f.length;i++){var j=f[i];if(!g)throw"Object does not exist";e.isSubscribable(g[j])?(h+="."+j+"()",i<f.length-1&&(g=g[j]())):b.isFunction(g.get)?(h+='.get("'+j+'")',i<f.length-1&&(g=g.get(j))):(h+='["'+j+'"]',i<f.length-1&&(g=g[j]))}return d.valueObject=g,d.valueField=j,this.handleExpression(h,c,d)},f.prototype.handleExpression=function(a,c,d){if(!b.isString(a)||0===a.length)throw"expression cannot not be empty";return new Function("context","models","return "+a)},f.prototype.calcValue=function(a,b,d,f){var g,h=c.Model.prototype.get,i=[];c.Model.prototype.get=function(a){return f&&i.push({bean:this,field:a}),h.call(this,a)};try{var j=function(){return g=a.call(b,d.context,b?b.models:null)},k=e.computed(j);k.isActive()&&i.push({KO:!0,subscribable:k})}finally{c.Model.prototype.get=h}return{v:g,dependencySet:i}},f.prototype.handleDependencySet=function(a,b,c,d){this.unbindDependencySet(c,d);for(var e in a)a[e].KO?a[e].subscription=a[e].subscribable.subscribe(b,this):a[e].bean.on("change:"+a[e].field,b,this)},f.prototype.unbindDependencySet=function(a,b){for(var c in a)a[c].KO?a[c].subscription.dispose():a[c].bean.off("change:"+a[c].field,b,this)},f.prototype.bindDOM=function(a){this.unbindDOM(a);var c="_"+a.cid,d={groupId:c};a.events||(a.events={});var e=this._handle(this,a,d);a.$root.attr("data-ls-bind")&&a.$root.each(e),a.$root.find("[data-ls-bind]").each(e),e=this._handleAttribute(a,d),a.$root.attr("data-ls-bind-attr")&&a.$root.each(e),a.$root.find("[data-ls-bind-attr]").each(e),b.isEmpty(a.events)||a.delegateEvents()},f.prototype.unbindDOM=function(a){var b="_"+a.cid;this.unbind(b),a.undelegateEvents()},f.prototype._handle=function(b,c,d){var e=this;return function(g){var h=a(this),i=f.getBindOptions(h.attr("data-ls-bind")),j=i.fields;switch(i.bindSetType){case"text":e._handleText(h,j[0],b,c,d,i);break;case"value":e._handleValue(h,j[0],b,c,d,i)}}},f.getBindOptions=function(a){var c=a.replace(/\s+/g,""),d={},e={},f=/.*?\((.*)?\)/;if(c.match(f)){var g=c.replace(f,"$1");b.each(g.split(","),function(a){var b=a.split(":");e[b[0]]=b[1]})}var h=/(.*?)\|(.*?)\(.*|(.*?)\|(.*?)/;c.match(h)&&(d.formatType=c.replace(h,"$2"));var i=/^(.*?):.*/;d.bindSetType=c.replace(i,"$1");var j=/.*?:(.*?)\|.*|.*?:(.*?)/,k=c.replace(j,"$1");return d.fields=k.split(","),b.extend(d,b.isEmpty(e)?{}:{formatParams:e})},f.prototype._handleAttribute=function(b,c){var d=function(a,b){return function(c){a.attr(b,c)}},e=this;return function(f){for(var g=a(this),h=g.attr("data-ls-bind-attr").replace(" ","").split(","),i=0;i<h.length;i++){var j=h[i].split(":"),k=e._getValue(j[1],b),l=d(g,j[0]);e._bind(b.viewModel,l,k,c)}}};var g=function(a,c,d){var e=b.clone(a);return e.statusText=a.statusText&&a.statusText.replace(d,c),e.attrs={},e.attrs[c]=a.attrs[d],e},h=function(a,c){return function(d,e,f){e&&"validation"===e.source&&f&&f.valueObject&&b.each(c?e.errors:e.warnings,function(b){if(b.conf.fieldName==f.targetField){var e=g(b,f.valueField,f.targetField),h=c?a.error:a.warning;h?h(d,e,f):f.valueObject.trigger((c?"bindingError:":"bindingWarning:")+f.valueField,f.valueObject,e,f)}})}},i=function(a){return a&&a.targetField&&a.valueObject&&a.valueField?function(b,c,d){var e=g(c,a.valueField,a.targetField);a.valueObject.trigger("bindingError:"+a.valueField,a.valueObject,e)}:void 0};f.prototype._getValue=function(a,b){var c=a.split("."),d=j(c[0],b);return d!==c[0]&&(a=a.replace(c[0],d)),this.handlePath(a,b.viewModel,{})},f.prototype._handleText=function(a,b,c,e,f,g){var h=function(b){var c=g.formatType?d.format(e.getBindContext(),g):b;a.text(c)},i=this._getValue(b,e);c._bind(e.viewModel,h,i,f)},f.prototype._handleValue=function(a,b,c,d,e){var f=function(b){a.val(b)},g=b.split("."),h=j(g[0],d),i=h!==g[0]?b.replace(g[0],h):b,k=this.handlePath(i,d.viewModel,{});c._bind(d.viewModel,f,k,e);var l='change [data-ls-bind*="value:'+b+'"]',m=this.handleTargetPath(i,d.viewModel,{});d.events[l]=function(){return m.call(d.viewModel,a.val())}};var j=function(a,b){var c;return(c=b.vmKeys["data."+a])?c:a};return f});
define("src/core/viewModel/BaseViewModel",["jquery","underscore","backbone","src/core/viewModel/ViewModelConstructor","src/core/util/Utils","src/core/binding/Binding","src/core/model/Model","src/core/model/Collection"],function (a,b,c,d,e,f,g,h){var i=/^\s*(\S*)\s*(\S*)?\s*$/,j=/{([^}]*)}/;return b.extend(d,{isViewModel:!0,extend:e.extend,mergeProperties:{config:"merge",defaults:"merge",models:"merge",viewModels:"merge",dataBindings:"merge"}}),b.extend(d.prototype,c.Events,{initialize:function(a){},defaults:{},config:{},dataBindings:[],coreEvents:{"error *":"dataError","all *":"errorHandler"},ajaxRegistry:[],registerOnAjaxRelatedEvents:function(){for(var a in this.models)(this.models[a]instanceof g||this.models[a]instanceof h)&&this.registerModalOnAjaxRelatedEvents(this,this.ajaxRegistry,this.models[a])},registerModalOnAjaxRelatedEvents:function(a,b,c){c.on("synching",function(c,d){b.push(this),1===b.length&&a.trigger("LoadingStart",{originator:this})}),c.on("sync",function(c,d,e){var f=b.indexOf(this);f>=0&&b.splice(f,1),0===b.length&&a.trigger("LoadingEnd",{originator:this})}),c.on("error",function(c,d,e){b.length=0,a.trigger("LoadingEnd",{originator:this,error:{code:d.status,message:d.statusText,resp:d}})})},mapValidationError:function(a,c){b.isEmpty(this.modelKeys)||(a.attrs=b.reduce(a.attrs,function(a,b,d){var e=this.modelKeys[c+"."+d];return a[e?e:d]=b,a},{},this))},_errorEventPattern:/^(error:|warning:)(.+)$/,errorHandler:function(c,d,e){var f=this._errorEventPattern.exec(c);if(f){if(b.isEmpty(this.modelKeys)||(e=a.extend(!0,{},e)),e&&"validation"===e.source){var g=d&&d.cid&&this._modelsMap[d.cid]?this._modelsMap[d.cid]:"*";this.mapValidationError(e,g);var h=this.modelKeys[g+"."+f[2]];h&&(c=f[1]+h)}this.trigger(c,d,e)}},dataError:function(c,d,e){if(b.isEmpty(this.modelKeys)||(d=a.extend(!0,{},d)),d&&"validation"===d.source){var f=c&&c.cid&&this._modelsMap[c.cid]?this._modelsMap[c.cid]:"*";if(d.errors)for(var g in d.errors)this.mapValidationError(d.errors[g],f);if(d.warnings)for(var g in d.warnings)this.mapValidationError(d.warnings[g],f)}this.trigger("error",c,d,e)},_instantiateModels:function(a){var c;for(var d in this._models)c=this._models[d],b.isFunction(c)?this._models[d]=this.create(b.uniqueId("_model"),c,{}):b.isArray(c)?this._models[d]=this.create(b.uniqueId("_model"),h,c):b.isObject(c)&&b.has(c,"id")&&b.has(c,"class")&&2===b.keys(c).length?this._models[d]=this.create(c.id,c["class"],{}):c instanceof g||c instanceof h||(this._models[d]=this.create(b.uniqueId("_model"),g,c));this._modelsMap={},this.modelKeys&&b.each(this._models,function(a,b){this._modelsMap[a.cid]=b},this)},_instantiateSubViewModels:function(a){},delegateEvents:function(a,c){if(a){b.isFunction(c)&&(c=c.call(this)),c=b.defaults({},c,this.events,this.coreEvents),this.undelegateEvents();var d=this._delegatedEvents={},e=this.defaultModel();for(var f in c){var g=c[f],h=g.match(j);if(h)g=b.bind(this._triggerWithoutModels,this,h[1]);else if(g=this[g],!g)throw new Error('Method "'+c[f]+'" does not exist');var k,l=f.match(i),m=l[1],n=l[2]||e;if("*"===n)k=b.values(a);else{if(!a[n])throw new Error('Model "'+n+'" does not exist');k=[a[n]]}b.each(k,function(a){if("*"!==n||b.isFunction(a.on)){a.on(m,g,this);var c=d[n]||(d[n]=[]);c.push({name:m,handler:g,producer:a})}},this)}}},_triggerWithoutModels:function(){var a=b.filter(arguments,function(a){return!(a instanceof g||a instanceof h)});this.trigger.apply(this,a)},undelegateEvents:function(a){var c;a?c=this._delegatedEvents[a]||[]:(c=b.flatten(b.values(this._delegatedEvents||{})),delete this._delegatedEvents);for(var d=0,e=c.length;d<e;++d){var f=c[d];f.producer.off(f.name,f.handler)}},_initializeData:function(a){var c=g,d=[].concat(a.validations||[],this.validations||[]);d.length&&(c=g.extend({validations:d})),this.data=new c(b.extend({},this.defaults,a.data))},_bindData:function(){this._binding=new f,this._binding.bindAll(this)},defaultModel:function(){var a=this._models&&b.keys(this._models);if(a&&1===a.length)return a[0]},setModel:function(a,b){throw new Error("ViewModel.setModel() is not supported.")},getModel:function(a){return this._models[a]},destroy:function(){this.off(),this.clean(),this.undelegateEvents(),this._binding.unbind(),this._unbindSubViewModelEvents()},_unbindSubViewModelEvents:function(){this.subViewModels&&b.each(this.subViewModels,function(a){a&&"function"==typeof a.off&&a.off(null,null,this)},this)},clean:function(){},addRef:function(){++this._references},retain:function(){return this.addRef.apply(this,arguments)},release:function(){--this._references},fetch:function(a){this.trigger("vm:ready")},handleUserAction:function(a){if(b.isUndefined(this[a])||!b.isFunction(this[a]))throw new Error("Unknown user action '"+a+"'.");this[a].apply(this,b.tail(arguments,1))},handleAction:function(a,c){if(!b.isString(a)&&b.isObject(a)&&this.subViewModels[a.vm]){var d=this.subViewModels[a.vm];return void d.handleAction.apply(d,b.union([a.key],b.rest(arguments)))}var e=this.getConfig("actions");e&&e[a]?e[a].apply(this,b.tail(arguments,1)):!b.isUndefined(this[a])&&b.isFunction(this[a])?this[a].apply(this,b.rest(arguments)):(arguments[0]="action:"+arguments[0],this.trigger.apply(this,arguments))},search:function(a){this.set("value",a),this.trigger("user:search",a)},click:function(){this.trigger("user:action",this.attr("action"))},set:function(a,c,d){if(a&&("config"===a||a.config))throw new Error("Lightsaber.Core.ViewModel.set(): `config` data attribute name is proibited");return b.isObject(a)&&a.key&&this.subViewModels[a.vm]?this.subViewModels[a.vm].set(a.key,c,d):!!this.data.set.apply(this.data,arguments)&&this},reset:function(){this.clear()},clear:function(){this.data&&this.data instanceof c.Model&&this.data.clear()},previous:function(){return this.data.previous.apply(this.data,arguments)},get:function(a){if("config"===a)throw new Error("Lightsaber.Core.ViewModel.get(): `config` data attribute name is proibited");var c;return b.isString(a)?c=this.data.get(a):b.isUndefined(a)?(c=this.data.toJSON(),delete c.subViewModels):b.isObject(a)&&this.subViewModels[a.vm]&&(c=this.subViewModels[a.vm].get(a.key)),c},setConfig:function(){return this.config.set.apply(this.config,arguments),this},getConfig:function(a){return 0===arguments.length?this.config.toJSON():this.config.get(a)},getData:function(){},_dataEventsHandler:function(a,b,c,d){var e={target:this},f=/^change:/.test(a);f&&(e.value=c),e.changed=b.changedAttributes&&b.changedAttributes(),e._warningWasFound=d&&d._warningWasFound,this.trigger(a,e)},_configEventsHandler:function(a,b,c){var d={target:this},e=/^change:/.test(a);e&&(d.value=c),b&&(d.changed={config:b.changedAttributes&&b.changedAttributes()}),a=a.replace(/^change/,"change:config"),this.trigger(a,d)},attr:function(a,c){var d,e,f;if(b.isArray(a)){for(d={},e=0,f=a.length;e<f;++e)d[a[e]]=this.get(a[e]);return d}if(b.isString(a)&&arguments.length>1||b.isObject(a))return this.set(a,c);if(b.isString(a))return this.get(a);throw new Error("Lightsaber.Core.ViewModel.attr(): invalid type of arguments")},getSubViewModel:function(a){return this.subViewModels&&this.subViewModels[a]},addSubViewModel:function(a,b){this.subViewModels[a]=b;var c=this.get("subViewModels"),d=c||{};d[a]=b,c?c[a]=b:this.set("subViewModels",d)},getDataBinding:function(){return this.dataBindings},createSubsetViewModel:function(a){a||(a={});var c=b.extend({},a.dataBindings?{dataBindings:a.dataBindings}:{},a.viewModel&&a.viewModel.settings?a.viewModel.settings:{}),e=new(a.viewModel&&a.viewModel.type||d)(c);return a.id&&(this.subViewModels||(this.subViewModels={}),this.subViewModels[a.id]=e),e},applySubsetBindings:function(a){if(!(a&&a.viewModelInstance&&a.viewModelInstance instanceof d))throw"No valid subset instance is provided.";var b=a.viewModelInstance,c=[].concat(b.dataBindings||[],a.dataBindings||[]);b._binding.bindAll(b,c),a.id&&(this.subViewModels||(this.subViewModels={}),this.subViewModels[a.id]=b)},shouldRegister:function(){return!0},shouldRestore:function(){return!1},shouldPersist:function(){return!1}},e.Factory,e.Common),d});
define("src/components/collection/viewmodel/CollectionViewModel",["underscore","jquery","businesswidget/repository/common/viewmodel/WidgetCoreBaseViewModel","src/core/model/Collection"],function (a,b,c,d){var e=c.extend({currentModel:null,viewModelType:"Collection",initialize:function(){this._initialize()},_initialize:function(){a.bindAll(this),this.currentModel=this._getModel(),this.currentModel&&(this.currentModel.on("reset",this._processDataReset,this),this.currentModel.on("error",this.error,this),this.currentModel.on("change",this._change,this),this.currentModel.on("add",this._add,this),this.currentModel.on("remove",this._remove,this),this.currentModel.on("dataReady",this._processDataReady,this),this.on("change:config:filterFunction",this.refresh),this.on("change:config:sortFieldName",this.refresh),this.on("change:config:sortFunction",this.refresh))},nextPage:function(a,b){this.currentModel.next(a,b)},previousPage:function(a,b){this.currentModel.prev(a,b)},gotoPage:function(a,b){this.currentModel.gotoPage(a,b)},setPageSize:function(b){a.isNumber(b)||(b=Number(b)),this.currentModel.pagination.pageSize=b,this.currentModel.gotoPage(0)},_setSorting:function(a){this.currentModel.setSorting(a)},config:{autoUpdate:!0,enabled:!0,visible:!0},add:function(b,c){null==this.currentModel.get(b.cid)&&(this.currentModel.add(b,a.extend({silent:!0},c)),this._add(b,this.currentModel,c))},_add:function(a,b,c){if(this.getConfig("autoUpdate")){var d=this.getData(a);null!=d&&this.trigger("items:added",d,c&&c.at)}},change:function(a){this.currentModel.get(a.cid)&&(this.currentModel.remove(a,{silent:!0}),this.currentModel.add(a,{silent:!0}),this._change(a))},_change:function(a){if(this.getConfig("autoUpdate")){var b=this.getData(a);null!=b&&this.trigger("items:changed",b)}},remove:function(a){this.currentModel.get(a.cid)&&(this.currentModel.remove(a,{silent:!0}),this._remove(a))},_remove:function(a){if(this.getConfig("autoUpdate")){var b=this.getData(a);null!=b&&this.trigger("items:removed",b)}},refresh:function(){this.trigger("items:refreshed",this.getData())},empty:function(){this.trigger("items:emptied")},_resetData:function(){this.currentModel.fetch()},getData:function(a){return this._getData(a)},getGroupedData:function(a){return null==a&&(a=this._getPage()),a.modelData&&null!=a.modelData.data?this._handleFullList(a.modelData):null!=a.data?this._handleFullList(a):this._handleItem(a)},isGroupedCollection:function(){var a=null!=this.getConfig("itemListName");return a||(a=null!=this.getConfig("groupFieldName"),a||(a=null!=this.getConfig("groupFunction"))),a},_getData:function(a){var b=this._getSortFunction(),c=this._getItemsId(this.currentModel);if(null==a||a.data){null==a&&(a=this._getPage());var e=null,f={idAttribute:c};return null!=a&&(this.currentModel.dataSource&&this.currentModel.dataSource.getProperties().supportsPagination?(e=new d(a.data).toJSON(),f.paginationInfo=a.info):(e=this._getFilteredDataJSON(a.data),e=this._getSortedDataJSON(e,b),null!=a.info.pageSize&&(f.paginationInfo=a.info))),null==e&&(e=[]),f.items=e,f}var e=this._getFilteredDataJSON([a]);if(null==e)return null;var g=e[0];if(null==b)return{item:g,idAttribute:c,modelData:a};var h=this._getPage();if(null==h.info.pageSize){var i=this._getFilteredDataJSON(h.data),j=this._getSortedIndex(i,g,b);return{item:g,idAttribute:c,sortedIndex:j,modelData:a}}},_getModel:function(){var a=this.defaultModel();return a?this.models[a]:null},_iterator:function(a){return a[this.getConfig("sortFieldName")]},_processDataReset:function(a){this._processData(a,"items:loaded")},_processDataReady:function(a){this._processData(a,"items:paginated")},_processData:function(a,b){var c=null,d=0;d=null!=a.pageNum?a.pageNum:0;var e=this._getPage(d);c=this.getData(e),c.modelData=e,this.trigger(b,c)},error:function(a,b){this.trigger("error",a,b)},_getFilteredDataJSON:function(b){if(null==b||0==b.length)return null;var c=this.getConfig("filterFunction");return c&&(b=a.filter(b,c)),0==b.length?null:new d(b).toJSON()},_getSortedDataJSON:function(b,c){return null==b||0==b.length?null:null!=c?a.sortBy(b,c):b},_getSortFunction:function(){var a=null;return this.getConfig("sortFunction")?a=this.getConfig("sortFunction"):this.getConfig("sortFieldName")&&(a=this._iterator),a},_getItemsId:function(a){var b=a.model.prototype.idAttribute?a.model.prototype.idAttribute:"id";return b},_getSortedIndex:function(b,c,d){var e=a.sortBy(b,d),f=a.map(e,d),g=d(c),h=a.sortedIndex(f,g);return h},_getSorting:function(){return this.currentModel.sorting},_getPagination:function(){return this.currentModel.pagination},_getPage:function(a){var b=this.currentModel.getPage(a);return b&&b.data&&this.set({items:b.data}),b},_handleItem:function(a){var b;if(b=null==a.item?this._getData(a):a,null!=b){if(this.getConfig("itemListName")){var c=this._getItemsId(this.currentModel),d=a.get(this.getConfig("itemListName"));null!=d&&d.length&&null!=d[0].models?itemsId=this._getItemsId(d[0]):itemsId="id";var e={group:b.item,itemsListName:this.getConfig("itemListName"),groupIdAttribute:c,idAttribute:itemsId,sortedIndex:b.sortedIndex};return e}var f=this._getGroupFunction(),g=f(b.item),h={
groupName:g,id:g,idAttribute:this._getItemsId(this.currentModel)},e=b;return e.group=h,e}return null},_handleFullList:function(a){var b=null,c=null,d=null,e=null;if(this.getConfig("itemListName")){c=this._getItemsId(this.currentModel),e=this.getConfig("itemListName");for(var f=0;f<a.data.length;f++){var g=a.data[0].get(e);null!=g&&g.length&&g.models&&(b=this._getItemsId(g))}null==b&&(b="id"),d=this._getData(a).items}else{b=this._getItemsId(this.currentModel),c=b;var h=null,i=null;d=[],e="items";for(var g=this._getData(a),j=this._getGroupFunction(),f=0;f<g.items.length;f++){var k=j(g.items[f]);k!=h&&(h=k,d[d.length]={groupName:h,id:h,items:[]},i=d[d.length-1].items),i[i.length]=g.items[f]}}var l={items:d,idAttribute:b,groupIdAttribute:c,itemsListName:e,paginationInfo:a.info};return l},_groupIterator:function(a){var b=a[this.getConfig("groupFieldName")];return null==b?"":b},_getGroupFunction:function(){var a=null;if(this.getConfig("groupFunction")?a=this.getConfig("groupFunction"):this.getConfig("groupFieldName")&&(a=this._groupIterator),null==a&&(a=this._getSortFunction(),null==a))throw"No grouping function has been defined";return a}});return e.mergeProperties={config:"merge"},e});
define("src/core/viewModel/ViewModel",["businesswidget/repository/common/viewmodel/WidgetCoreBaseViewModel","src/components/collection/viewmodel/CollectionViewModel","src/core/model/Collection"],function (a,b,c){var d=a.extend({_instantiateSubViewModels:function(a){var e;for(var f in this.subViewModels)e=this.subViewModels[f],_.isFunction(e)?this.subViewModels[f]=this.create(_.uniqueId("_viewmodel"),e,{}):_.isArray(e)?this.subViewModels[f]=this.create(_.uniqueId("_viewmodel"),b,{models:{data:new c(e)}}):_.isObject(e)&&_.has(e,"id")&&_.has(e,"class")&&2===_.keys(e).length?this.subViewModels[f]=this.create(e.id,e["class"],{}):e instanceof d||e instanceof b||(this.subViewModels[f]=this.create(_.uniqueId("_viewmodel"),d,e))}});return d});
define("src/core/knockout/ContentBinding",["jquery","underscore","knockout","src/core/util/Utils"],function (a,b,c,d){var e=function(){var a=new c.bindingProvider,b=function(a){return a.getAttribute&&a.getAttribute("data-content-id")},d=function(b,c){var d,e=a.getBindingsString(b,c);return b.getAttribute&&(d=b.getAttribute("data-content-id"),d&&(e='content: {id: "'+d+'"}, '+e)),e};this.nodeHasBindings=function(c){return!!b(c)||a.nodeHasBindings(c)},this.getBindings=function(b,c){var e=d(b,c)||a.getBindingsString(b,c);return e?a.parseBindingsString(e,c,b):null},this.getBindingAccessors=function(b,c){var e=d(b,c)||a.getBindingsString(b,c);return e?a.parseBindingsString(e,c,b,{valueAccessors:!0}):null}},f=function(){b.bindAll(this,"_base","init","update","_ascendToWidget","_findHandler")};return b.extend(f,{CustomBindingProvider:e,extend:d.extend}),b.extend(f.prototype,{_base:function(b,c,d,e,f){var g,h,i,j=this._findHandler(f),k=this._ascendToWidget(j.view),l=d().attr;k&&k.contentData&&(h=c(),h&&h.id&&(i=k.contentData[h.id],i&&(g=a(b),l&&l.src?g.attr("src",i):g.text(i))))},init:function(a,b,c,d,e){this._base(a,b,c,d,e)},update:function(a,b,c,d,e){this._base(a,b,c,d,e)},_ascendToWidget:function(a){var b;return a&&(!a.isBusinessWidget||a.isBusinessWidget&&!a.contentData?a.getParent&&(b=this._ascendToWidget(a.getParent())):b=a),b},_findHandler:function(a){var c;if(a)if(a.$data&&b.isObject(a.$data)&&"__viewhandler__"in a.$data||"__viewhandler__"in a)c=a.__viewhandler__||a.$data.__viewhandler__;else for(var d=0,e=a.$parents.length;d<e;d++)if(a.$parents[d]&&"__viewhandler__"in a.$parents[d]){c=a.$parents[d].__viewhandler__;break}return c}}),f});
define("src/core/knockout/ViewCustomBinding",["knockout","src/core/util/Utils"],function (a,b){var c=function(){_.bindAll(this,"init","_findHandler")};return _.extend(c,{extend:b.extend,mergeProperties:{data:"merge",config:"merge",defaults:"merge",models:"merge",dataBindings:"merge",mapping:"merge"}}),_.extend(c.prototype,{init:function(b,c,d,e,f){var g=this._findHandler(f),h=c(),i={};if(8===b.nodeType){var j=a.virtualElements.childNodes(b);j.length>1&&(i.template=!1,b=j[1])}else b.children&&b.children.length>0&&(i.template=!1,$(b.children).wrapAll("<div/>"),b=b.children[0]);return h&&h.name?i.name=h.name:i.name=h,h&&h.id?i.id=h.id:i.id=_.uniqueId("inline_"),h&&"undefined"!=typeof h.initVM?i.initVM=h.initVM:i.initVM=!0,g&&g(b,i,e,f),{controlsDescendantBindings:!0}},_findHandler:function(a){var b;if(a)if(a.$data&&_.isObject(a.$data)&&"__viewhandler__"in a.$data||"__viewhandler__"in a)b=a.__viewhandler__||a.$data.__viewhandler__;else for(var c=0,d=a.$parents.length;c<d;c++)if(a.$parents[c]&&"__viewhandler__"in a.$parents[c]){b=a.$parents[c].__viewhandler__;break}return b}}),c});
define("src/core/knockout/WidgetCustomBinding",["src/core/util/Utils","knockout"],function (a,b){var c=function(){_.bindAll(this,"init","_findHandler")};return _.extend(c,{extend:a.extend,mergeProperties:{data:"merge",config:"merge",defaults:"merge",models:"merge",dataBindings:"merge",mapping:"merge"}}),_.extend(c.prototype,{init:function(a,c,d,e,f){var g=this._findHandler(f),h=c(),i={};if("string"==typeof h&&(h={name:h}),i=_.extend({},h,i),8===a.nodeType){var j=b.virtualElements.childNodes(a);j.length>1&&(i.template=!1,a=j[1])}else a.children&&a.children.length>0&&(i.template=!1,$(a.children).wrapAll("<div/>"),a=a.children[0]);return g&&g(a,i,e,f),{controlsDescendantBindings:!0}},_findHandler:function(a){var b;if(a)if(a.$data&&_.isObject(a.$data)&&"__widgethandler__"in a.$data||"__widgethandler__"in a)b=a.__widgethandler__||a.$data.__widgethandler__;else for(var c=0,d=a.$parents.length;c<d;c++)if(a.$parents[c]&&"__widgethandler__"in a.$parents[c]){b=a.$parents[c].__widgethandler__;break}return b}}),c});
define("src/core/knockout/RBACustomBinding",["src/core/util/Utils"],function (a){var b=function(){_.bindAll(this,"init","_findHandler")};return _.extend(b,{extend:a.extend}),_.extend(b.prototype,{init:function(a,b,c,d,e){var f=this._findHandler(e),g=b(),h={id:g};f(a,h,d,e)},_findHandler:function(a){var b;if(a)if(a.$data&&_.isObject(a.$data)&&"__rbaHandler__"in a.$data||"__rbaHandler__"in a)b=a.__rbaHandler__||a.$data.__rbaHandler__;else for(var c=0,d=a.$parents.length;c<d;c++)if(a.$parents[c]&&"__rbaHandler__"in a.$parents[c]){b=a.$parents[c].__rbaHandler__;break}return b}}),b});
define("src/core/knockout/IE8Blame",["knockout"],function (a){if(a.utils.ieVersion<=11){var b,c=function(b,c,d){for(var e,f=b,g=a.virtualElements.nextSibling(c);f&&(e=f)!==g;)f=a.virtualElements.nextSibling(e),d(e,f)},d=function(b,d){if(b.length){var e=b[0],f=b[b.length-1],g=e.parentNode,h=a.bindingProvider.instance,i=h.preprocessNode;if(i){if(c(e,f,function(a,b){var c=a.previousSibling,d=i.call(h,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))}),b.length=0,!e)return;e===f?b.push(e):(b.push(e,f),a.utils.fixUpContinuousNodeArray(b,g))}c(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.applyBindings(d,b)}),c(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.memoization.unmemoizeDomNodeAndDescendants(b,[d])}),a.utils.fixUpContinuousNodeArray(b,g)}},e=function(b,c,e,f,g){var h=!1;switch(f){case"replaceChildren":a.virtualElements.setDomNodeChildren(b,c),h=!0;break;case"replaceNode":a.utils.replaceDomNodes(b,c),h=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+f)}h&&(d(c,e),g.afterRender&&a.dependencyDetection.ignore(g.afterRender,null,[c,e.$data]))},f=function(a,b,c,d,f){var g=window.setTimeout(function(){e(a,b,c,d,f),window.clearTimeout(g)},10)},g=0,h=!1,i=function(c,d,i,k,l){l=l||{};var m=c&&j(c),n=m&&m.ownerDocument,o=l.templateEngine||b;a.templateRewriting.ensureTemplateIsRewritten(i,o,n);var p=o.renderTemplate(i,k,l,n);return g<200&&!h?(g++,e(c,p,k,d,l)):(f(c,p,k,d,l),h=!0,g=0),p},j=function(a){return a.nodeType?a:a.length>0?a[0]:null};a.setTemplateEngine=function(c){if(void 0!=c&&!(c instanceof a.templateEngine))throw new Error("templateEngine must inherit from KO.templateEngine");b=c},a.renderTemplate=function(c,d,e,f,g){if(e=e||{},void 0==(e.templateEngine||b))throw new Error("Set a template engine before calling renderTemplate");if(g=g||"replaceChildren",f){var h=j(f),k=function(){return!h||!a.utils.domNodeIsAttachedToDocument(h)},l=h&&"replaceNode"==g?h.parentNode:h;return a.dependentObservable(function(){var b=d&&d instanceof a.bindingContext?d:new a.bindingContext(a.utils.unwrapObservable(d)),k="function"==typeof c?c(b.$data,b):c,l=i(f,g,k,b,e);"replaceNode"==g&&(f=l,h=j(f))},null,{disposeWhen:k,disposeWhenNodeIsRemoved:l})}return a.memoization.memoize(function(b){a.renderTemplate(c,d,e,b,"replaceNode")})},a.renderTemplateForEach=function(b,c,e,f,g){var h,j=function(a,c){h=g.createChildContext(a,e.as,function(a){a.$index=c});var d="function"==typeof b?b(a,h):b;return i(null,"ignoreTargetNode",d,h,e)},k=function(a,b,c){d(b,h),e.afterRender&&e.afterRender(b,a)};return a.dependentObservable(function(){var b=a.utils.unwrapObservable(c)||[];"undefined"==typeof b.length&&(b=[b]);var d=a.utils.arrayFilter(b,function(b){return e.includeDestroyed||void 0===b||null===b||!a.utils.unwrapObservable(b._destroy)});a.dependencyDetection.ignore(a.utils.setDomNodeChildrenFromArrayMapping,null,[f,d,j,e,k])},null,{disposeWhenNodeIsRemoved:f})};a.utils.domData.nextKey()}});
define("src/core/knockout/KOUnderscoreTemplateEngineIntegration",["src/core/util/Utils","knockout","knockout.mapping","knockout.validation"],function (a,b,c,d){b.underscoreTemplateEngine=function(){},b.underscoreTemplateEngine.prototype=b.utils.extend(new b.nativeTemplateEngine,{renderTemplate:function(d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u=function(a){_.extend(a,{i18n:e.$root.__getResourceBundle__,format:e.$root.__getFormatter__})};if(r=new b.templateSources.anonymousTemplate(d),s=r.text(),l=r.nodes(),f&&s&&/\S/.test(s)){if(f.path){t=s,m=e.$data,p=a.safeUnwrap(m);var n=b.unwrap(f.path),v='[data-template-path="'+n+'"]',w=$(l).find(v);return k=w.length>0?w.prop("outerHTML"):s,this.unwrapAugmentOptions(f),b.utils.parseHtmlFragment(k)}if(f.type){t=s,m=e.$data,p=a.safeUnwrap(m);var o=b.unwrap(f.type),x='[data-template-type="'+o+'"]',y=$(l).find(x);if(y.length>0)return k=y.prop("outerHTML"),this.unwrapAugmentOptions(f),b.utils.parseHtmlFragment(k)}}if(f&&s&&/\S/.test(s)&&!f.type)return t=s,m=e.$data,p=a.safeUnwrap(m),h=_.template(t),u(p),k=h(p),this.unwrapAugmentOptions(f),b.utils.parseHtmlFragment(k);if(f&&f.name)i=this.makeTemplateSource(d,g),j=_.template("<% with($data) { %>"+i.text()+"<% } %>"),k=j(e).replace(/\s+/g," ");else if(f&&f.path)m=e.$data,p=a.safeUnwrap(m),n=b.unwrap(f.path),requirejs.defined("tpl!"+n)?h=requirejs("tpl!"+n):(h=_.template(requirejs("text!"+n)),u(p)),k=h(p);else if(f&&f.module)m=e.$data,_.isFunction(f.module)?k=f.module(c.toJS(m)):"String"==typeof f.module&&(k=_.template(f.module,c.toJS(m)));else{if(!f||!f.type)throw new Error('Template binding doesn"t have correct "name" or "path" settings.');o=b.unwrap(f.type),h=e.$root.templates[o],m=e.$data,p=a.safeUnwrap(m),_.isFunction(h)?k=h(p):"string"==typeof h&&(u(p),k=_.template(h,p))}return f&&f.augment&&(f.data=f.data||{},q=b.unwrap(f.augment.path)||b.unwrap(f.augment.id),f.data.path=b.observable(q+"/"+b.unwrap(f.data.id))),b.utils.parseHtmlFragment(k)},unwrapAugmentOptions:function(a){if(a&&a.augment){a.data=a.data||{};var c=b.unwrap(a.augment.path)||b.unwrap(a.augment.id);a.data.path=b.observable(c+"/"+b.unwrap(a.data.id))}},createJavaScriptEvaluatorBlock:function(a){return"<%= "+a+" %>"}}),b.setTemplateEngine(new b.underscoreTemplateEngine)});
define("src/core/knockout/KnockoutPlugins",["module","jquery","underscore","knockout","knockout.mapping","knockout.validation","src/core/util/Utils","src/core/knockout/ContentBinding","src/core/knockout/ViewCustomBinding","src/core/knockout/WidgetCustomBinding","src/core/knockout/RBACustomBinding","src/core/formatter/DateFormatter","src/core/knockout/IE8Blame","src/core/knockout/KOUnderscoreTemplateEngineIntegration"],function (Module,$,_,KO,KOMapping,KOValidation,Utils,ContentBinding,ViewCustomBinding,WidgetCustomBinding,RBACustomBinding,DateFormatter){KO.subscribable.fn.unixDate=function(){var a,b=new DateFormatter,c=this,d=KO.computed({read:function(){var d=c();"string"==typeof d&&(d=parseInt(d,10));var e=new Date(d);return a=d?b.format(e,"yyyy-mm-dd"):""},write:function(b){a=new Date(b).getTime(),c(a)}});return d},KO.extenders.backup=function(a){var b=a.subscribe(function(c){a._backup=a.peek(),b.dispose()},null,"beforeChange");return a},KO.subscribable.fn.reset=function(){_.isUndefined(this._backup)||this(this._backup)},KO.bindingHandlers.logger={update:function(a,b,c){var d=KO.utils.domData.get(a,"_ko_logger")||0,e=KO.toJS(b()||c());KO.utils.domData.set(a,"_ko_logger",++d),window.console&&window.console.log&&console.log(d,a,e)}};var isCMS=requirejs.appContext&&requirejs.appContext.config&&requirejs.appContext.config.cms;isCMS&&(KO.bindingProvider.instance=new ContentBinding.CustomBindingProvider,KO.bindingHandlers.content=new ContentBinding),KO.bindingHandlers.text={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){var c,d,e;a.getAttribute?(e=a.innerText,c=a.getAttribute("data-content-id"),d=a.getAttribute("data-enrich-id"),isCMS&&(c||d)&&e&&"null"!==e||KO.utils.setTextContent(a,b())):KO.utils.setTextContent(a,b())}};var setElementName=function(a,b){if(a.name=b,KO.utils.ieVersion<=7)try{a.mergeAttributes(document.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}};KO.bindingHandlers.attr={update:function(element,valueAccessor,allBindings){var contentValue,enrichedDataValue,enrichedAttributes={};if(element.getAttribute){contentValue=element.getAttribute("data-content-id"),enrichedDataValue=element.getAttribute("data-enrich-id");try{eval("enrichedDataValue = "+enrichedDataValue)}catch(exception){}"object"==typeof enrichedDataValue&&(enrichedAttributes=_.invert(enrichedDataValue))}var value=KO.utils.unwrapObservable(valueAccessor())||{};KO.utils.objectForEach(value,function(a,b){b=KO.utils.unwrapObservable(b);var c=element.getAttribute(a);if(isCMS&&enrichedDataValue){if(enrichedAttributes[a]&&c&&"null"!==c)return}else if(isCMS&&"src"===a&&contentValue)return;var d=b===!1||null===b||void 0===b;d&&element.removeAttribute(a),KO.utils.ieVersion<=8&&a in attrHtmlToJavascriptMap?(a=attrHtmlToJavascriptMap[a],d?element.removeAttribute(a):element[a]=b):d||element.setAttribute(a,b.toString()),"name"===a&&setElementName(element,d?"":b.toString())})}};var i18n=function(a,b,c,d,e){var f,g,h,i=e.$root.__getResourceBundle__,j=i(),k=KO.unwrap(b());_.isObject(k)&&(f=KO.toJS(k.args),k=KO.unwrap(k.message)),g=j&&j.getString(k,f)?j.getString(k,f):k,_.isUndefined(g)&&(g=""),a.getAttribute?(h=a.innerText,contentValue=a.getAttribute("data-content-id"),enrichedDataValue=a.getAttribute("data-enrich-id"),isCMS&&(contentValue||enrichedDataValue)&&h&&"null"!==h||KO.utils.setTextContent(a,g)):KO.utils.setTextContent(a,g)};KO.bindingHandlers.i18n={init:i18n,update:i18n},KO.bindingHandlers.view=new ViewCustomBinding,KO.bindingHandlers.widget=new WidgetCustomBinding,KO.bindingHandlers.rba=new RBACustomBinding,KO.virtualElements.allowedBindings.view=!0,KO.virtualElements.allowedBindings.widget=!0,KO.virtualElements.allowedBindings.rba=!0,KO.observable.fn.apply=function(a){var b,c="."+this.peek();return b=_.isObject(a)?"uniqueId"in a?a.uniqueId+c:a.id+c:KO.isObservable(a)?a.peek()+c:_.isString(a)?a+c:_.uniqueId("id_")},KO.observable.fn.isArray=function(){return KO.isObservable(this)&&(this.hasOwnProperty("remove")||this.hasOwnProperty("mappedRemove"))},KO.observableArray.fn.size=function(){var a=this(),b=0;if(null==a||"undefined"==typeof a.length)return 0;for(var c=0,d=a.length;c<d;c++)a[c]._destroy!==!0&&b++;return b},KO.extenders.mask=function(a,b){var c=KO.computed({read:function(){return a()},write:function(c){a(c.replace(b))}}).extend({notify:"always"});return c},KO.extenders.lazy=function(a,b){var c=KO.computed({read:function(){return!c.loaded()&&b.callback&&b.context&&b.callback.call(b.context),a()},write:function(b){c.loaded(!0),a(b)},deferEvaluation:!0});return c.loaded=KO.observable(),c.refresh=function(){c.loaded(!1)},c},KO.extenders.process=function(a,b){var c=KO.computed({read:function(){var c;return b.callback&&b.context?c=b.callback.call(b.context,a):b.callback&&(c=b.callback(a)),c},write:function(b){a(b)},deferEvaluation:!0,disposeWhenNodeIsRemoved:b.node});return c};var _processActions=function(a){var b=[],c=KO.unwrap(a());if(_.isObject(c))for(var d in c)"args"!==d&&b.push({action:c[d],event:d,args:c.args});else _.isString(c)&&b.push({action:c,event:"click"});return b},action=function(a,b,c,d,e){var f=d.__handler__;f||(f=e.$root.__handler__);var g=_processActions(b);_.each(g,function(b){var c=KO.unwrap(b.action),g=$(a);g.off(b.event),d.__vmKeys__&&d.__vmKeys__["action."+c]&&(c=KO.unwrap(d.__vmKeys__["action."+c])),g.on(b.event,function(a){var g=KOMapping.toJS(d);delete g.__handler__,delete g.__ko_mapping__,delete g.__viewhandler__,delete g.__getResourceBundle__,f(c,a,g,d,e,b.args)})})};KO.bindingHandlers.action={init:action,update:action};var findPropInContext=function(a,b){var c;if(a)if(a.$data&&_.isObject(a.$data)&&b in a.$data||b in a)c=a[b]||a.$data[b];else for(var d=0,e=a.$parents.length;d<e;d++)if("object"==typeof a.$parents[d]&&b in a.$parents[d]){c=a.$parents[d][b];break}return c};KO.bindingHandlers.click={init:function(a,b,c,d,e){var f=findPropInContext(e,"__viewContextHandler__"),g=function(){var a={};return a.click=b()(f),a};return KO.bindingHandlers.event.init.call(this,a,g,c,d,e)}},KO.bindingHandlers.click.preprocess=function(a){return'function(newScopeFetcher){ if (typeof(newScopeFetcher) === "function") { with(newScopeFetcher()) { return '+a+"} } else { return "+a+"} }"};var eventHandler=function(a,b,c,d,e){var f=_processActions(function(){var a=b();if(_.isFunction(a)){var c=findPropInContext(e,"__viewContextHandler__");a=a(c)}return a}),g=$(a),h=function(a){return a+".view"};_.each(f,function(a){var b=KO.unwrap(a.action),f=d.__clickhandler__||e.$root.__clickhandler__,i=h(a.event);g.off(i),g.on(i,function(h){var i,j=KOMapping.toJS(d);try{_.isUndefined(f)?_.isUndefined(a.action)||(i=a.action(d,h,g,e,j)):i=f(a.args?{method:b,args:a.args}:b,g,j,d,e,h)}finally{i!==!0&&(h.preventDefault?h.preventDefault():h.returnValue=!1)}var k=c.get(a.event+"Bubble")!==!1;k||(h.cancelBubble=!0,h.stopPropagation&&h.stopPropagation())})})};KO.bindingHandlers.event={init:eventHandler,update:eventHandler},KO.bindingHandlers.event.preprocess=function(a){return'function(newScopeFetcher){ if (typeof(newScopeFetcher) === "function") { with(newScopeFetcher()) { return '+a+"} } else { return "+a+"} }"},KO.bindingHandlers.allowBindings={init:function(a,b){var c=KO.unwrap(b());return{controlsDescendantBindings:!c}}},KO.virtualElements.allowedBindings.allowBindings=!0,KO.bindingHandlers.file={init:function(a,b){KO.utils.registerEventHandler(a,"change",function(a){for(var c=a.target,d=new FormData,e=0;e<c.files.length;e++){var f=this.files[e];d.append(c.name,f,f.name)}KO.isObservable(b())&&b()(d),KO.utils.triggerEvent(c,"filesSelected")})}},KO.bindingHandlers.extendWith={init:function(a,b,c,d,e){var f=d.invoke;f||(f=e.$root.invoke);var g=KO.unwrap(b()),h={};h[g.name]=f(g.func,g.params);var i=e.extend(h);return KO.applyBindingsToDescendants(i,a),{controlsDescendantBindings:!0}}}});
define("src/core/viewModel/ObservableViewModel",["jquery","underscore","backbone","src/core/util/Utils","src/core/binding/Binding","src/core/model/Model","src/core/model/RESTModel","src/core/model/Collection","src/components/collection/viewmodel/CollectionViewModel","src/core/viewModel/ViewModel","businesswidget/repository_l9_common/common/core/ImplStorageUtil","knockout","knockout.mapping","knockout.validation","src/core/knockout/KnockoutPlugins"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=function(a){var c,d;this.options=a||{},this._populateModels(),c=this._getPropertyByPrecedence("mapping",{}),this._augmentMapping(c),this.observe=this._getPropertyByPrecedence("observe",!0),d=this._getPropertyByPrecedence("data",this.defaults),l.isObservable(d)?this.data=d:this.data=m.fromJS(d,c),this.config=this._getPropertyByPrecedence("config",{visible:!0,enabled:!0}),this.dataBindings=this._getPropertyByPrecedence("dataBindings",[]),this.data.__handler__=b.bind(this.handleAction,this),this.subViewModels||(this.subViewModels={}),this._instantiateSubViewModels(a),this._listenToModelChanges(),this.initialize.apply(this,arguments),this.data.__vmdata__=!0,this.data.invoke=b.bind(this.invoke,this),this._bindData(),this._initValidation(),this._processValidationPaths(),this._processRba(),delete this.data.__vmdata__};b.extend(o,{isViewModel:!0,extend:d.extend,mergeProperties:{data:"merge",config:"merge",defaults:"merge",models:"merge",dataBindings:"merge",mapping:"merge"}}),b.extend(o.prototype,c.Events,{initialize:function(){},config:{validationSettings:{insertMessages:!1,decorateInputElement:!0,errorsAsTitle:!1,errorElementClass:"is-invalid",errorMessageClass:"validationMessage",grouping:{deep:!0}}},defaults:{},processData:function(a){m.fromJS(a,this.data)},propagationMapping:{},propagate:function(a,b){this.propagationMapping[a]=b},abortAjax:function(a){b.each(this.models,function(b){b.abortAjax(a)})},ajaxRegistry:[],registerModalOnAjaxRelatedEvents:function(a,c,d){var e=[],f=function g(c,d){var e="";b.each(c,function(c){c.constructor===Array?g(c,d):(e+=0===e.length?c:":"+c,a.trigger.apply(a,b.union([e],d)))})};d.on("all",function(c,d){var e=b.values(a.models).indexOf(d),f=b.keys(a.models)[e],g=f+":"+c;a.propagationMapping[g]&&a.trigger(a.propagationMapping[g],d)}),d.on("synching",function(a,b){var d=Array.prototype.slice.call(arguments);c.push(this),1===c.length&&f(["loading","start"],d)}),d.on("sync",function(a,b,d){var g=Array.prototype.slice.call(arguments),h=c.indexOf(this);h>=0&&c.splice(h,1),0===c.length&&(e.length>0?f(["loading","error"],[e]):f(["loading","success"],g),e.length=0)}),d.on("error",function(a,b,d){var g=Array.prototype.slice.call(arguments);e.push(g);var h=c.indexOf(this);h>=0&&c.splice(h,1),0===c.length&&(f(["loading","error"],[e]),e.length=0)})},_listenToModelChanges:function(){var a=this.models;b.each(a,function(a,c){var d=b.bind(function(a){var b={models:{}};m.isMapped(a)&&(a=m.toJS(a)),b.models[c]=a,this.processData(b)},this),e=b.bind(function(a,b){d(b)},this);a.on&&(a.on("dataReady",e),a.on("reset",d)),(a instanceof f||a instanceof h)&&this.registerModalOnAjaxRelatedEvents(this,this.ajaxRegistry,a)},this)},_initValidation:function(){var a=this.getConfig("validationSettings");n.init(a,!0)},invoke:function(a){var b=Array.prototype.slice.call(arguments,1),c=this[a].apply(this,b);return c},getData:function(){},_augmentMapping:function(a){},augment:function(a,c,d){var e=this.get(!0);b.isObject(d)?e[a]=m.fromJS(c,d):b.isUndefined(d)&&(e[a]=c)},set:function(a,c,d){b.isBoolean(d)&&d?(d={},d.copy=[a]):b.isUndefined(d)?d={}:d._bound&&(d=d.mapping||{});var e,f=d.silent,g={};b.isObject(a)?(l.isObservable(a)?g=l.toJS(a):b.isObject(c)?(d=c,g=a):(d=l.utils.unwrapObservable(a).__ko_mapping__,g=d?m.toJS(a):a),delete g.__ko_mapping__,m.fromJS(g,d,this.data),this._triggerEvent({name:"change",prop:a})):(!b.isUndefined(this.data[a])&&l.isObservable(this.data[a])?this.data[a].isArray&&this.data[a].isArray()?m.fromJS(c,d[a],this.data[a]):(e=l.unwrap(this.data[a]),this.data[a](c)):(d.observe=d.observe||[],g[a]=c,m.fromJS(g,d,this.data)),f||e!==c&&this._triggerEvent({name:"change",prop:a,value:c}))},get:function(a,c,d){var e;return b.isBoolean(a)&&a?e=this._getWrapped():b.isObject(a)?e=this._getMapped(a):d?e=this._getSafeValue(a):b.isUndefined(c)?d||(a?b.isUndefined(this.data[a])||(e=m.toJS(this.data[a])):e=m.toJS(this.data)):e=this._getWrapped(a),e},_getSafeValue:function(a){return this.get(a,!0).peek()},setValueByPath:function(a,b,c){var e=this._getWrapped();d.setValueByPath(e,a,b,c)},getValueByPath:function(a,b){var c,e=this._getWrapped();return c=a?d.getValueByPath(e,a,b):this.get(b)},_getMapped:function(a){return m.toJS(this.data,a)},attr:function(a,c){var d,e,f;if(b.isArray(a)){for(d={},e=0,f=a.length;e<f;++e)d[a[e]]=this.get(a[e]);return d}return b.isString(a)&&arguments.length>1||b.isObject(a)?this.set(a,c):b.isString(a)?this.get(a):void 0},_getWrapped:function(a){var b;return b=a?this.data[a]:this.data},setConfig:function(a,b){this.config[a]=b,this._triggerEvent({name:"change",subname:"config",prop:a,value:b})},getConfig:function(a){var b;return b=a?this.config[a]:this.config},reset:function(){this.clear(),this.data.__handler__=b.bind(this.handleAction,this)},clear:function(){this.data={}},handleAction:function(a){var c,d;a&&b.isString(a)&&(c=this.getConfig("actions"),c&&(d=c[a],b.isString(d)&&(d=this[d])),d||(d=this[a]),d?d.apply(this,b.tail(arguments,1)):(this.trigger.apply(this,arguments),arguments[0]="action:"+arguments[0],this.trigger.apply(this,arguments)))},_createDataForEvent:function(a,b){var c={_warningWasFound:void 0,changed:{},target:this};return b?(c.value=b,c.changed[a]=b):c.changed=a,c},_triggerEvent:function(a){var c,d=this._createDataForEvent(a.prop,a.value),e=a.name;a.subname&&(e+=":"+a.subname,c=d.changed,d.changed={},d.changed[a.subname]=c),this.trigger(e,d),b.isObject(a.prop)?b.each(a.prop,function(b,c){d.value=a.prop[c],this.trigger(e+":"+c,d)},this):this.trigger(e+":"+a.prop,d)},_getPropertyByPrecedence:function(c,d){var e=d;return b.isUndefined(this.options[c])?b.isUndefined(this[c])||(e=this[c]):e=this.options[c],o.mergeProperties[c]&&(e=b.isArray(e)?b.union(d,this[c]||[],this.options[c]||[]):a.extend(!0,{},d,this[c],this.options[c])),e},getSubViewModel:function(a){var b;return this.subViewModels&&(b=this.subViewModels[a]),b},addSubViewModel:function(a,b){this.subViewModels=this.subViewModels||{},this.subViewModels[a]=b},getModel:function(a){return this.models[a]},create:d.create,coreEvents:{"error *":"dataError","all *":"errorHandler"},_errorEventPattern:/^(error:|warning:)(.+)$/,errorHandler:function(a,b,c){this._errorEventPattern.exec(a)&&this.trigger(a,b,c)},dataError:function(a,b,c){this.trigger("error",a,b,c)},_populateModels:function(){var a,d=this.models=b.defaults({},this.options.models,this.models);for(var e in d)a=d[e],b.isFunction(a)?d[e]=new a:b.isArray(a)?d[e]=new h(a):a instanceof c.Model||a instanceof c.Collection||(d[e]=new f(a));this.delegateEvents(d)},defaultModel:function(a){if(a=b.values(a||this.models||{}),a&&1===a.length)return a[0]},delegateEvents:function(a,c){if(a){b.isFunction(c)&&(c=c.call(this)),c=b.defaults({},c,this.events,this.coreEvents),this.undelegateEvents();var d=this._delegatedEvents={},e=this.defaultModel(a);b.each(c,function(f,g){var h,i=this[c[g]],j=g.match(p),k=j[1],l=j[2]||e;if("*"===l)h=b.values(a);else{if(!a[l])throw new Error('Model "'+l+'" does not exist');h=[a[l]]}b.each(h,function(a){if("*"!==l||b.isFunction(a.on)){a.on(k,i,this);var c=d[l]||(d[l]=[]);c.push({name:k,handler:i,producer:a})}},this)})}},undelegateEvents:function(a){var c;a?c=this._delegatedEvents[a]||[]:(c=b.flatten(b.values(this._delegatedEvents||{})),delete this._delegatedEvents);for(var d=0,e=c.length;d<e;++d){var f=c[d];f.producer.off(f.name,f.handler)}},dataBindings:[],_bindData:function(){this._binding=new e,this._binding.bindAll(this)},_instantiateSubViewModels:function(a){var c;for(var d in this.subViewModels)c=this.subViewModels[d],b.isFunction(c)?this.subViewModels[d]=this.create(b.uniqueId("_viewmodel"),c,{}):b.isArray(c)?this.subViewModels[d]=this.create(b.uniqueId("_viewmodel"),j,{models:{data:new h(c)}}):b.isObject(c)&&b.has(c,"id")&&b.has(c,"class")&&2===b.keys(c).length?this.subViewModels[d]=this.create(c.id,c["class"],{}):c instanceof i||c instanceof j||c instanceof o||(this.subViewModels[d]=this.create(b.uniqueId("_viewmodel"),i,c))},_processValidationPaths:function(){var a=this.getConfig("validations");b.each(a,this._processSinglePath,this)},_processSinglePath:function(a,c){b.each(a,function(a){this._processSingleValidation(a,c)},this)},_processSingleValidation:function(a,c){var d=this.getConfig("rules")||{},e=b.keys(a)[0],f=b.extend({},n.rules[e],d[e]),g={validation:f};g.validation.params=a[e];var h=this.getValueByPath(c,!0);h=h.extend(g),this.setValueByPath(c,h,!0)},_processRba:function(){var a=this.getConfig("rbaUrl");if(a){var b=this.getConfig("rbaRestModel"),c=b?new b(null,{url:a}):new g(null,{url:a}),d=this;return c.fetch({success:function(a,b){d.set(b)}})}},destroy:function(){this.off(),this.clean(),this.undelegateEvents(),this._binding.unbind(),this._unbindSubViewModelEvents()},_unbindSubViewModelEvents:function(){this.subViewModels&&b.each(this.subViewModels,function(a){a&&"function"==typeof a.off&&a.off(null,null,this)},this)},clean:function(){},shouldRegister:function(){return!0},shouldRestore:function(){return!0},shouldPersist:function(){return!0},persistent:[],_setValByPath:function(a,b,c){for(var d=b.split(".");d.length>1;){var e=d.shift();a.hasOwnProperty(e)||(a[e]={}),a=a[e]}a[d.shift()]=c},restoreData:function(a){for(var b,c,e=k.get(a)||{},f={},g=0,h=this.persistent.length;g<h;g++)b=this.persistent[g],c=d.getValueByPath(e,b),c&&this._setValByPath(f,b,c);this.set(f)},persist:function(a,b,c){for(var d=k.get(a)||{},e=b.split("."),f=d,g=0,h=e.length;g<h-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];f[e[e.length-1]]=c,k.set(a,d)}}),b.extend(o.prototype,{_manipulateCollectionData:function(a,c){return b.map(c,function(a){return a.toJSON?a.toJSON():a})},collectionMapper:function(a,b){this.addObservableCollection(b,a)},addObservableCollection:function(a,c){var d=this,e=this.data;e[c]=l.observableArray(),e[c].modelName=b.find(b.map(this.models,function(b,c){return a===b&&c}),function(a){return a}),e[c].bindPropName=c;var f=function(a){var b,f=a.getPageNum();if(a.isAccumelated()){var g=(f+1)*a.pagination.pageSize;g=Math.min(a.pagination.maxIndex,g),b=a.getRows(0,g)}else b=a.getPage(f);e[c](d._manipulateCollectionData(a,b.data))},g=function(a,b){f(b)};a.on&&(a.on("dataReady",g),a.on("reset",f))},getPagination:function(a){if(!(a&&a.items&&a.items.modelName&&a.items.bindPropName))throw"To create a pagination extension you must provide an item object that was created by calling addObservableCollection.";var b=this.models[a.items.modelName],d=a.items.bindPropName;if(!(b&&b instanceof c.Collection))throw"To create a pagination a valid collection object must be used";var e={prev:function(){b.prev()},next:function(){b.next()},accPrev:function(){b.accPrev()},accNext:function(){b.accNext()},pageNum:l.computed({read:function(){this.data[d]();return b.getPageNum()},write:function(a){"string"==typeof a&&(a=parseFloat(a)),b.gotoPage(a)},owner:this}),pageSize:l.computed(function(){this.data[d]();return b.pagination.pageSize},this),hasPrev:l.computed(function(){this.data[d]();return b.hasPrev()},this),hasNext:l.computed(function(){this.data[d]();return b.hasNext()},this),totalPages:l.computed(function(){this.data[d]();return b.getTotalPagesNumber()},this),totalSize:l.computed(function(){this.data[d]();return b.pagination.maxIndex},this),pageStart:l.computed(function(){this.data[d]();return b.pagination.pageStart},this)};return e}});var p=/^\s*(\S*)\s*(\S*)?\s*$/;return o});
define("src/core/application/WidgetInternalFlow",["jquery","underscore","src/core/util/Utils"],function (a,b,c){var d={ARGUMENTS:{MISSING:{VIEW_ROUTES:"You must initialize the class with a viewRoutes array.",WIDGET:"You must initialize the class with a widget object.",ID:"Each viewRoute must have an id defined.",UXF_POINT:"Each viewRoute must have a reference to a DOM elment using uxfPoint or el.",METHOD:"Incorrect method assignment. Please check your configuration"},DUPLICATE:{UXF_POINT:"Multiple el definition. Use uxfPoint or el not both.",ID:"You have created duplicate keys with the same amount. Please check id : ",DEFAULT:"Only 1 viewRoute per placeholder is allowed to be the default viewRoute.",NONE_DEFAULT:"All viewRoutes for a single placeholder are defiend as false. Please set one of them as true or as undefined."}},RELATION:{PLACEHOLDER:"Each placeholder must have a viewRoutes related to it.",
DOM:"Requesting to show a view that is not attached to any DOM element."},FLOW:{EXIT_METHOD:"Requesting to exit a method has no meaning. Please check your flow"}},e=function(){var a=document.createElement("p").style;return"transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a},f=function(a){var b=a.split("/:"),c=b.shift();return{key:c,params:b}},g=function(c,d){return a.extend({_digestHelper:a.extend(d,{paramsLength:d.params.length})},c,{toViewRoute:function(){var a=b.clone(this),c=b.reduce(this,function(a,c,d){return b.isFunction(c)&&a.push(d),a},[]);c.push("_digestHelper");var d=a._digestHelper.dynamicParamsValue,e=b.omit(a,c),f=a._digestHelper.params;return e.params=e.params||{},b.each(f,function(a,b){e.params[a]=d?d[b]:void 0}),e},setDynamicParamsValue:function(a){this._digestHelper.dynamicParamsValue=a}})},h=function(b){this.options=b||{},this.config=a.extend({},{viewRoutesKeySplitter:"#!"},b.config),this.initialize.apply(this,arguments)};return b.extend(h,{extend:c.extend,mergeProperties:{config:"merge"}}),b.extend(h.prototype,Backbone.Events,{initialize:function(){this._checkReceivedData(),this._digestViewRoute(),this._checkViewRoutesConfig()},_checkReceivedData:function(){if(this.viewRoutes=this.options.viewRoutes,this.myWidget=this.options.widget,!b.isArray(this.viewRoutes))throw d.ARGUMENTS.MISSING.VIEW_ROUTES;if(b.isUndefined(this.myWidget))throw d.ARGUMENTS.MISSING.WIDGET;b.isUndefined(this._digestViewRouteHash)&&(this._digestViewRouteHash={}),b.isUndefined(this._viewRouteHistory)&&(this._viewRouteHistory=new c.HistoryStack)},_digestViewRoute:function(){for(var a=0;a<this.viewRoutes.length;a++){var c=this.viewRoutes[a];if(b.isUndefined(c.id))throw d.ARGUMENTS.MISSING.ID;if(b.isUndefined(c.uxfPoint)&&b.isUndefined(c.el)&&b.isUndefined(c.method))throw d.ARGUMENTS.MISSING.UXF_POINT;if(!b.isUndefined(c.uxfPoint)&&!b.isUndefined(c.el))throw d.ARGUMENTS.DUPLICATE.UXF_POINT;c.el=c.el||'[data-uxf-point="'+c.uxfPoint+'"]';var e=new f(c.id);if(this._digestViewRouteHash.hasOwnProperty(e.key)){if(this._getDigestViewRoute(e))throw d.ARGUMENTS.MISSING.DUPLICATE.ID+c.id}else this._digestViewRouteHash[e.key]=[];var h=new g(c,e);this._digestViewRouteHash[e.key].push(h)}},_checkViewRoutesConfig:function(){var a=this._getPlaceholdersHash();return b.each(a,function(a){var c=this._getDefaultDigestViewRoute(a);if(b.isUndefined(c))throw d.RELATION.PLACEHOLDER},this),!0},_getDefaultDigestViewRoute:function(a){if(0===a.length)throw d.RELATION.PLACEHOLDER;var c=b.where(a,{isDefault:!0});if(c.length>1)throw d.ARGUMENTS.DUPLICATE.DEFAULT;if(0===c.length&&(c=b.where(a,{isDefault:void 0}),0===c.length))throw d.ARGUMENTS.DUPLICATE.NONE_DEFAULT;return c[0]},_getDigestViewRoute:function(a){var c=function(b){return b._digestHelper.paramsLength===a.params.length};return b.find(this._digestViewRouteHash[a.key],c)},_getDigestViewRoutesByKey:function(a){b.isString(a)&&(a=a.split(this.config.viewRoutesKeySplitter));var c=[];return b.each(a,function(a){var b=new f(a),d=this._getDigestViewRoute(b);d&&(d.setDynamicParamsValue(b.params),c.push(d))},this),c},_loadDigestViewRoute:function(a,c,d){b.isArray(a)||(a=[a]),b.each(a,function(a){this._loadSingleDigestViewRoute(a,c,d)},this),this.trigger("change:viewRoute",a)},_loadSingleDigestViewRoute:function(a,c,e){if(!b.isUndefined(a)){var f=a.toViewRoute();if(b.isString(f.method)){var g=this.myWidget[f.method]||this.myWidget.options[f.method];if(!b.isFunction(g))throw d.ARGUMENTS.MISSING.METHOD;var h=g.call(this.myWidget,f,c);h&&"object"==typeof h&&(this._buildViewRoutesConfig(f),h.options=h.options||{},h.options.animationConfig=f.animationConfig,h.options.viewRouteKey=f.id,h.options.routesParams=f.params,this._showView(h))}else this._loadViewRoute(f,c);b.isFunction(e)&&e(a)}},_exitDigestViewRoute:function(a,c,d){b.isArray(a)||(a=[a]),b.each(a,function(a){this._exitSingleDigestViewRoute(a,c,d)},this),this.trigger("change:viewRoute",a)},_exitSingleDigestViewRoute:function(a,c,e){if(!b.isUndefined(a)){var f=a.toViewRoute();if(b.isString(f.method)&&!this._viewRouteCache.hasOwnProperty(f.id))throw d.FLOW.EXIT_METHOD;var g=this._viewRouteCache[f.id];this._exitView(g),b.isFunction(e)&&e(a)}},_getPlaceholderDomUniqueName:function(a){var c=a.attr("data-uxf-point");return b.isUndefined(c)&&(c=a.attr("id")),c},_getPlaceholdersHash:function(){var a={};return b.each(this._digestViewRouteHash,function(c){b.each(c,function(c){var d=this.myWidget.$el.find(c.el),e=this._getPlaceholderDomUniqueName(d);b.isUndefined(a[e])&&(a[e]=[]),a[e].push(c)},this)},this),a},_addNoneCalledPlaceHoldersDefaultDigestViewRoutes:function(a){var c=this._getPlaceholdersHash(),d=function(c){return b.find(a,function(a){return a===c})};return b.each(c,function(c){b.find(c,d)||a.push(this._getDefaultDigestViewRoute(c))},this),a},_buildAnimationConfig:function(b){var c={time:1e3,enterClassName:"uxf-state-enter",exitClassName:"uxf-state-exit",refreshClassName:"uxf-state-refresh",displayClassName:"uxf-state-display",async:!0};return a.extend({},c,b)},_buildViewRoutesConfig:function(a){if(this._viewRouteCache||(this._viewRouteCache={}),this._placeholderViews||(this._placeholderViews={}),b.isUndefined(a.id)&&(a.id=b.uniqueId(this.cid)),b.isUndefined(a.el))throw d.RELATION.PLACEHOLDER;return a.hasOwnProperty("cached")||(a.cached=!1),a.hasOwnProperty("history")||(a.history=!0),a.animationConfig=this._buildAnimationConfig(a.animationConfig),a},_createView:function(a,b){var c=this.myWidget.$root&&this.myWidget.$root.length>0?this.myWidget.$root:this.myWidget.$el,d=this.myWidget.create(a.viewId||a.id,b,{viewModel:b.prototype.viewModel||this.myWidget.viewModel,cached:a.cached,history:a.history,el:c.find(a.el),animationConfig:a.animationConfig,viewRouteKey:a.id,routesParams:a.params});return d},_loadViewRoute:function(a,c){b.isUndefined(c)&&(c=!1),this._buildViewRoutesConfig(a);var d=this;requirejs([a.path],function(e){var f=d._viewRouteCache[a.id];(b.isUndefined(f)||!f.options.cached||c)&&(f=d._createView(a,e)),d._showView(f)})},_showView:function(a){var b=a.options.animationConfig;if(0===a.$el.length)throw d.RELATION.DOM;var c=this._getPlaceholderDomUniqueName(a.$el),e=this._placeholderViews[c];e===a?this._showDisplayedView(a,b):this._switchViews(e,a,c)},_exitView:function(a){var b=this._getPlaceholderDomUniqueName(a.$el),c=this._placeholderViews[b];this._switchViews(c,void 0,b)},_switchViews:function(a,c,d){a&&!a.options.cached&&delete this._viewRouteCache[a.options.viewRouteKey],this._viewRouteCache[c?c.options.viewRouteKey:a.options.viewRouteKey]=c,this._placeholderViews[d]=c;var e=c&&c.options.animationConfig,f=this;a?(this._exitAnimation(a,a.options.animationConfig,function(){!a.options.cached&&b.isFunction(a.destroy)&&a.destroy(),e&&!e.async&&f._enterAnimation(c,e)}),e&&e.async&&f._enterAnimation(c,e)):this._enterAnimation(c,e)},_showDisplayedView:function(a,c){b.isFunction(a.refresh)&&a.refresh(),this._enterAnimation(a,c,!0)},_enterAnimation:function(a,b,c,d){if(!a)return void(d&&d());var f=this,g=function(){a.removeClass(b.enterClassName).removeClass(b.refreshClassName).addClass(b.displayClassName),a.trigger("change:visible",{visible:!0}),f.trigger("change:visible",{visible:!0,view:a,viewRouteId:a.options.viewRouteKey}),d&&d.call(f,a)};e()?c?a.switchClass(b.refreshClassName,[b.enterClassName,b.exitClassName].join(" "),g):a.switchClass(b.enterClassName,[b.refreshClassName,b.exitClassName,b.displayClassName].join(" "),g):(a.removeClass(b.enterClassName).removeClass(b.exitClassName),c?a.addClass(b.refreshClassName,b.time,g):a.addClass(b.enterClassName,b.time,g))},_exitAnimation:function(a,b,c){var d=this;if(!a)return void(c&&c.call(d));var f=function(){a.trigger("change:visible",{visible:!1}),d.trigger("change:visible",{visible:!1,view:a,viewRouteId:a.options.viewRouteKey}),c&&c.call(d,a),a.removeClass(b.exitClassName)};e()?a.switchClass(b.exitClassName,[b.enterClassName,b.refreshClassName,b.displayClassName].join(" "),f):(a.removeClass(b.enterClassName).removeClass(b.refreshClassName).removeClass(b.displayClassName),a.addClass(b.exitClassName,b.time,f))},load:function(a,b){var c=this._getDigestViewRoutesByKey(a),d=this;this._loadDigestViewRoute(c,b,function(a){d._viewRouteHistory.push(a)})},exit:function(a,b){var c=this._getDigestViewRoutesByKey(a);this._exitDigestViewRoute(c,b)},navigate:function(a,b){var c=this._getDigestViewRoutesByKey(a);c=this._addNoneCalledPlaceHoldersDefaultDigestViewRoutes(c),this._loadDigestViewRoute(c,b),this._viewRouteHistory.push(c)},prev:function(){var a=this._viewRouteHistory.prev();this._loadDigestViewRoute(a,!1)},next:function(){var a=this._viewRouteHistory.next();this._loadDigestViewRoute(a,!1)},getCurrent:function(b){return b instanceof HTMLElement&&(b=a(b)),"object"==typeof b&&(b=this._getPlaceholderDomUniqueName(b)),b&&this._placeholderViews?this._placeholderViews[b]:this._placeholderViews}}),h});
define("src/core/view/View",["underscore","jquery","backbone","require","src/core/model/Model","src/core/model/RESTModel","src/core/viewModel/ViewModel","businesswidget/repository/common/viewmodel/WidgetBaseObservableViewModel","src/core/binding/Binding","src/core/util/Utils","single!src/core/formatter/Formatter","knockout","knockout.mapping","src/core/application/WidgetInternalFlow"],function (_,$,Backbone,require,Model,RESTModel,ViewModel,ObservableViewModel,Binding,Utils,Formatter,KO,KOMapping,WidgetInternalFlow){var commonConfig={autoRender:!0,autoRefresh:!1,rootCSS:""},actionsRegex=/action\.\b/,View=Backbone.View.extend({publicMethods:["remove","getResourceBundle","setTemplate","setId","setRootCSS","addClass","removeClass","toggleClass","hasClass","setConfig","getConfig"],config:{},placeholders:{},vmKeys:{},vmKeysChangeEvents:{},_isElProvided:!1,INNER_VIEW_ID_PREFIX:"uxf_view_",_configure:function(a){var b=this._isTemplateFalse(a);b&&this._configureTemplateFromHTML(a),this.template=a.template||this.template,this.optionsMap=a.optionsMap||this.optionsMap||{},this.vmKeysChangeEvents=_.extend({},this.vmKeysChangeEvents,a.vmKeysChangeEvents),a.attributes=_.extend({},this.attributes,a.attributes||{}),Backbone.View.prototype._configure.call(this,a),a=this.options,this.vmKeys=_.extend({},this.vmKeys,a.vmKeys||{}),this._config=new Model,a.scope&&this.setConfig("scope",a.scope),this.___id=a.___id,this.___parent=a.___parent;var c=$.extend(!0,{},commonConfig,this.config,a.config||{});c.tagName||(c.tagName=this.tagName),c.id||(c.id=this.id);var d=c.className||(c.className=this.className),e=c.el||this.el;if(c.el&&delete c.el,this.setConfig(c),e&&(this.el=e,this._isElProvided=!0),this._config.on("change",function(a){this.configChanged(a._changed)},this),d&&(this.attributes["class"]=d),this._initViewModel(a),this.insertMethod=a.insertMethod||c.insertMethod,_.bindAll(this,"_getLocaleString"),this._bindEvents(),delete this.model,this.subViews=_.extend(this.subViews||{},c.subViews||a.subViews),!_.isArray(this.subViews)){var f=[];_.each(this.subViews,function(a,b){f.push(a)},this),this.subViews=f}this._subViews={},this.binding=new Binding},_isTemplateFalse:function(a){var b=a.el||a.config&&a.config.el;if(b&&"#comment"!==b.nodeName){"string"!=typeof b&&b instanceof jQuery||(b=$(b),a.config&&a.config.el?a.config.el=b:a.el=b);var c=b instanceof jQuery?"attr":"getAttribute",d=a.config&&a.config.template===!1;return d||(d=b[c]("data-template"),d&&"false"===d&&(d=!0)),d}},getParent:function(){return this.___parent},_initViewModel:function(a){if(this.viewModel=a.viewModel||this.viewModel,!this.viewModel)throw new Error("viewModel property is required.")},_configureTemplateFromHTML:function(a){a.config=a.config||{},a.config.insertMethod="replace",a.insertMethod="replace";var b=a.config.el?a.config.el:a.el,c=b.find("[data-uxf-secondary-template]");if(c.length>0){var d=c[0].outerHTML;a.config.viewOptions=a.config.viewOptions?a.config.viewOptions:{},a.config.viewOptions.config?a.config.viewOptions.config.template=d:a.config.viewOptions.config={template:d},b.empty()}a.___processUnderscore===!1||a.config.processUnderscore===!1?a.config.template=b[0].outerHTML:a.config.template=_.unescape(b[0].outerHTML)},_getVMData:function(a){var b,c=this.vmKeys[a],d=c;return c||(d=a),b=this.viewModel.observe?this.viewModel.getValueByPath(d):this.viewModel.get(d)},_setVMData:function(a,b){var c=this.vmKeys[a],d=c;c||(d=a),this.viewModel.observe?this.viewModel.setValueByPath(d,b,!0):this.viewModel.set(d,b)},delegateVmAction:function(a,b){var c=this.vmKeys["action."+a];c?this.viewModel.handleAction.apply(this.viewModel,_.union([c],_.rest(arguments))):this.viewModel.handleAction.apply(this.viewModel,arguments)},_getVMConfig:function(a){var b=this.vmKeys[a];return b?this.viewModel.getConfig(b):this.viewModel.getConfig(a)},_bindEvents:function(){this.getConfig("autoRefresh")&&this.viewModel.on("change",this.onChange,this),this.viewModel.on("change:config:visible",this.onVisibleChange,this),this.viewModel.on("change:config:enabled",this.onEnableChange,this);for(var a in this.vmKeysChangeEvents){var b=this.vmKeysChangeEvents[a],c=this[b];c&&_.isFunction(c)&&this.viewModel.on("change:"+this.vmKeys[a],c,this)}},constructor:function(){var a=arguments[0]||{};this._preConstructor(a),this._createOrigEvents(a),Backbone.View.apply(this,arguments),this._postConstructor(a)},_createOrigEvents:function(a){var b=a.config||{};this.origEvents=_.extend({},this.events,b.events),b.events=null,this.events=null},_preConstructor:function(){},_postConstructor:function(){this.getConfig("autoRender")&&this.render()},render:function(){return this.augmentViewModel(),this.preRender(),this._buildRoot(),this._processRbaConfig(),this.binding.bindDOM(this),this._handleSubViews(),this._applyDataBindings(),this._handleDelegateEvents(),this.enhanceMarkup(),this._initInnerFlowArtifacts(),this.postRender(),this._processTemplateViews(),this},_handleDelegateEvents:function(){this.events=_.extend({},this.origEvents,this.events),delete this.origEvents,this.delegateEvents()},addViewModel:function(a,b,c){this.viewModels=this.viewModels||[],this.viewModels.push(c)},destroy:function(a){if(this.selfDestroy(a),this.subViews)for(var b in this.subViews)this.subViews[b].viewInstance&&this.subViews[b].viewInstance.destroy(),delete this.subViews[b].viewInstance,delete this.subViews[b];if(this._subViews)for(var b in this._subViews)this._subViews[b].instance&&this._subViews[b].instance.destroy(),delete this._subViews[b].instance,delete this._subViews[b];if(this.___children){for(var b=this.___children.length-1;b>=0;b--)this.___children[b]&&(this.___children[b].destroy(),delete this.___children[b]);delete this.___children}if(this.viewModels)for(var b=this.viewModels.length-1;b>=0;b--)this.viewModels[b]&&(this.viewModels[b].off(null,null,this),delete this.viewModels[b])},selfDestroy:function(a){this.binding.unbind(),a?Backbone.Events.off.call(this.viewModel,null,null,this):this.viewModel.off(null,null,this),this.root&&this.viewModel.observe&&KO.cleanNode(this.root),this.placeholders&&(this.placeholders=null),this.remove(),this.off(),this.undelegateEvents(),this.__parent=null},delegateEvents:function(a){if(!a&&!(a=_.result(this,"events")))return Backbone.View.prototype.delegateEvents.apply(this,arguments);for(var b in a){var c=a[b];_.isFunction(c)||(/action\.\b/.test(c)?(c=c.split(".")[1],a[b]=this._augmentSingleEvent(a,b,c)):c=this[a[b]])}return Backbone.View.prototype.delegateEvents.apply(this,arguments)},_augmentSingleEvent:function(a,b,c){return function(){this.delegateVmAction(c)}},remove:function(){var a=this.$el;return this.$el=this.$root?this.$root:this.$el,Backbone.View.prototype.remove.call(this),this.$el=a,this},_buildRoot:function(){var a=this.$('>[type="template/html"]');if(!this.templateAttr){var b=this;a.each(function(a,c){var d=$(c),e=d.data("uxf-template");void 0===e||"template"===e?b.template=d.html()||b[e]:b[e]&&"function"==typeof b[e]?b[e]=_.template(d.html())||b[e]:b[e]&&"string"==typeof b[e]&&(b[e]=d.html()||b[e]),d.remove()})}this.template?this._handleTemplate():this._createRootMarkup()},_applyDataBindings:function(){var a,b,c;if(this.root&&this.viewModel.observe&&!this.getConfig("cancelBinding")){KO.cleanNode(this.root);var d=this.viewModel.options.bindingContext,e=this._createContext(d);d?KO.applyBindingsToDescendants(e,this.el):(a=this.$root.parent(),b=this.$root,c=$("<div></div>").insertBefore(b),b.detach(),KO.applyBindings(e,this.root),c.replaceWith(b)),this._cleanContextArtifacts(e)}},_handleInlineView:function(a,b,c,d){var e,f,g=this.getConfig("scope")||this.scope,h=Utils.getValueByPath(g,b.name),i=this._createVMForInlineView(c,d,b);this._connectViewModels(i),"#comment"===a.nodeName?(e=_.extend({viewModel:i},b),f=this.create(b.id,h,{viewModel:i,config:e}),KO.virtualElements.prepend(a,f.root)):(e=_.extend({el:a,viewModel:i},b),this.create(b.id,h,{el:a,viewModel:i,config:e}))},_handleInlineWidgets:function(a,b,c,d){},_createVMForInlineView:function(a,b,c){var d=this.viewModel;if(c.initVM)var e=this.viewModel.constructor,d=new e({data:a,bindingContext:b});return d},_connectViewModels:function(a){this.viewModel.on("all",function(b,c){a.trigger(b,c)})},_createContext:function(a){var b=this._getKnockoutContext(a),c=_.bind(this._handleInlineView,this),d=_.bind(this._handleInlineWidgets,this);c.view=this,d.view=this,b.prototype=this._createContextPrototype(a);var e=new b(this.vmKeys,c,d);return e},_getKnockoutContext:function(a){var b=_.bind(this._clickHandler,this),c=_.bind(this._rbaHandler,this),d=_.bind(this.getResourceBundle,this),e=this._handleVMKeyForContext,f=this._getViewModelData(),g=(_.extend({},f,{}),{bindContext:_.extend(this.getBindContext(),{getVMData:function(a){return KO.isObservable(a)?a():a}})}),h=_.bind(Formatter.formatCurrentBindingContext,_.extend({},Formatter,g)),i=_.bind(Utils.KO.getCustomExtendedContextObservable,this),j=_.bind(function(a,b){var c=d();return c&&(a=c.getString(a,b)),(_.isUndefined(a)||_.isNull(a))&&(a=""),a},this),k=function(a){var b,c=Array.prototype.slice.call(arguments,1);return this[a]&&(b=this[a].apply(this,c)),b},l=_.bind(k,this),m=_.bind(function(){return this},this),n=function(a,f,g){this.__viewContextHandler__=m,this.__viewhandler__=f,this.__widgethandler__=g,this.__rbaHandler__=c,this.__clickhandler__=b,this.__vmKeys__=a,this.__getResourceBundle__=d,this.__getFormatter__=h,this.format=i(this.format,h),this.viewInvoke=i(this.viewInvoke,l,1),_.each(a,e,this),this.i18n=i(this.i18n,j)};return n.prototype=this._createContextPrototype(a),n},_createContextPrototype:function(a){var b,c=a,d=this.getConfig("vmPath");return a||(c=this.viewModel.get(!0)),d&&(b=this.viewModel.getValueByPath(d,!0),b.$root=c,c=b),c},_handleVMKeyForContext:function(a,b){var c,d=b.split(".");a=KO.unwrap(a),d&&d.length>1&&"data"===d[0]&&(c=Utils.getValueByPath(this,a,!0),c&&(this[d[1]]=KO.computed({read:function(){return KO.unwrap(c)},write:function(a){c(a)},deferEvaluation:!0})))},_cleanContextArtifacts:function(a){delete a.__vmKeys__},_clickHandler:function(a,b,c,d,e,f){var g;"object"==typeof a&&(g=a.args,a=a.method),"function"==typeof a?a.call(this,b,c,d,e,f,g):this[a](b,c,d,e,f,g)},_rbaHandler:function(a,b,c,d){this.placeholders=this.placeholders||{},b&&b.id&&(this.placeholders[b.id]={el:a,context:c,bindingContext:d})},_handleRBAData:function(a){_.each(a,this._loadRBAViewAndViewModel,this)},_loadRBAViewAndViewModel:function(a,b){var c=this.getConfig("rba")||{},d=this,e=c.view||"src/ui/dynamic/DynamicView",f=c.viewModel||"src/ui/dynamic/DynamicViewModel";"string"==typeof e&&"string"==typeof f?requirejs([e,f],function(c,e){d._createRBA(c,e,a,b)}):"string"==typeof e&&"function"==typeof f?requirejs([e],function(c){d._createRBA(c,f,a,b)}):"function"==typeof e&&"string"==typeof f?requirejs([f],function(c){d._createRBA(e,c,a,b)}):"function"==typeof e&&"function"==typeof f&&d._createRBA(e,f,a,b)},_createRBA:function(a,b,c,d){var e=this.getConfig("rba")||{},f=this.placeholders[d],g=this._createRBAViewModel(b,e,f,d);this._createRBAView(a,e,f,g,d),g.load(c,{})},_createRBAViewModel:function(a,b,c,d){var e=this.create(d,a,{});return e},_createRBAView:function(a,b,c,d,e){var f=_.pick(b,"configurator","builders","validators","resolvers","deps","validation","templates");f=_.isUndefined(f.configurator)?_.extend({},f):f.configurator;var g=this.getConfig("scope")||this.scope,h=this.create(e,a,{el:$(c.el),viewModel:d,config:{configurator:f,scope:g}});return h},_handleSubViews:function(){this.root&&this.subViews&&this.addSubView(this.subViews),this.trigger("subviews:added")},addSubView:function(a){if(a){if(_.isArray(a))return void _.each(a,function(a){this.addSubView(a)},this);if(this.root){var b=a.viewInstance;if(b){var c=a.insertMethod||(b._isElProvided?"replace":"append"),d=a.el;if(d){var e;(e=this.$(d)).length>0?this._insertElement(c,e,b.$el):d=null}d||this._insertSubView(b),b.enhanceMarkup(),this._subViews[b.cid]={el:d,insertMethod:c,instance:b}}else if(a.viewType||a.viewOptions)throw new Error("'viewType' + 'viewOptions' is no longer supported. Must pass 'viewInstance'")}else this.subViews.push(a)}},_handleTemplate:function(a){var b=this._createTemplateData(),c=this.getPopulatedTemplate(this.template,b);this.placeRoot(c,!!a),this._normalizeRootDomEl()},_normalizeRootDomEl:function(){this.$root.find("[data-ls-bind]").each(function(){$(this).attr("data-ls-bind",$(this).attr("data-ls-bind").replace(/\s/g,""))})},_createTemplateData:function(){return{}},getPopulatedTemplate:function(a,b,c){"string"==typeof a&&(a=_.template(a));var d=this.getTemplateData(b,c),e=a(d);return e},getTemplateData:function(a,b){_.isBoolean(a)||a instanceof ViewModel?(b=a,a={}):void 0===a&&(a={});var c=this._getViewModelData(b),d=_.extend({},c,a),e={bindContext:_.extend(this.getBindContext(),{getVMData:function(a){return Utils.getValueByPath(d,a)}})};return _.extend(d,{i18n:this._getLocaleString,format:_.bind(Formatter.formatCurrentBindingContext,_.extend({},Formatter,e))})},_getViewModelData:function(a){var b;b=_.isUndefined(a)||a===!0?this.viewModel.get():a===!1?{}:a.get();var c=this.getConfig("vmPath");c&&(b=Utils.getValueByPath(b,c));var d,e=null;for(var f in this.vmKeys)"data."==f.substring(0,5)&&(e=this.vmKeys[f],f!="data."+e&&(b[f.substring(5)]=this._getVMData(f)),null==b[e]&&null!=(d=this.getConfig(f))&&(b[e]=d));return b},_processTemplateViews:function(){if(!this.$root.data("uxf-processed")){var a=this.getConfig("scope")||this.scope,b=this.$root.data("uxf-view");b?this._processTemplateView(a,0,this.$root):this.$root.find("[data-uxf-view]").each(_.bind(this._processTemplateView,this,a))}},_processTemplateView:function(a,b,c){var d=$(c),e=d.data("uxf-processed");if(1!=e){d.attr("data-uxf-processed","true");var f=d.data("uxf-view"),g=this._getConfigForTemplateView(d),h=this._getViewModelForTemplateView(d,g,a),i=this._getVmKeysForTemplateView(d),j=this._getPath(a,f),k=d.data("uxf-view-id");k||(k=this.INNER_VIEW_ID_PREFIX+b),g.scope=$.extend({},this.scope,g.scope,this.getConfig("scope")),this.create(k,j,{config:g,viewModel:h,vmKeys:i})}},_getConfigForTemplateView:function($viewElement){var configName=$viewElement.data("uxf-config"),config;if("object"==typeof configName?config=configName:configName&&configName.indexOf("{")>=0?config=eval("("+configName+")")||{}:configName&&(config=this.getConfig(configName)),!config){var script=$viewElement.find('>[type="config/json"]');config=script&&1===script.length?eval("("+script.html()+")"):{},script.remove()}return config||(config={}),config.el=$viewElement,config},_getViewModelForTemplateView:function(a,b,c){var d,e=b.viewModel||a.data("uxf-viewmodel");return d=e&&"string"!=typeof e?b.viewModel:c&&c[e]?c[e]:e&&this.getConfig(e)&&!_.isString(this.getConfig(e))?this.getConfig(e):e&&this.getConfig(e)&&this.viewModel.getSubViewModel(this.getConfig(e))?this.viewModel.getSubViewModel(this.getConfig(e)):this.viewModel.getSubViewModel(e)?this.viewModel.getSubViewModel(e):this.viewModel},_getVmKeysForTemplateView:function($viewElement){var vmKeysStr=$viewElement.data("uxf-vmkeys"),vmKeys;return vmKeysStr&&vmKeysStr.indexOf("{")>=0&&(vmKeys=eval("("+vmKeysStr+")")||{}),vmKeys},_getPath:function(a,b){for(var c=b.split("."),d=0;d<c.length;d++)a=a[c[d]];return a},getResourceBundle:function(){var a=this.getConfig("resourceBundle")||this.viewModel.getConfig("resourceBundle");return a},_getLocaleString:function(a,b){return this.getResourceBundle().getString(a,b)},_createRootMarkup:function(){this._elInnerHtml=this.$el.html(),this.placeRoot(this._getNewRootElem()),this._elInnerHtml&&this.$root.append(this._elInnerHtml)},_getNewRootElem:function(){var a=document.createElement(this.getConfig("tagName")||"div");return a},_refresh:function(){this.root?this.template&&(this._handleTemplate("refresh"),this.binding.bindDOM(this),this._injectSubViews(),this.enhanceMarkup()):this.render()},_injectSubViews:function(){var a;for(var b in this._subViews)a=this._subViews[b],a.el?this._insertElement(a.insertMethod,this.$(a.el),a.instance.$el):this._insertSubView(a.instance)},_insertSubView:function(a){this.$root.append(a.el)},_insertElement:function(a,b,c){switch(!(b instanceof $)&&(b=$(b)),!(c instanceof $)&&(c=$(c)),a){case"append":b.append(c);break;case"prepend":b.prepend(c);break;case"replace":if(b&&b.get(0)&&this.getConfig("copyAttributes")!==!1)for(var d=_.clone(b.get(0).attributes),e=d.length,f=c.attr("class");e--;)"class"===d[e].name&&f&&!b.hasClass(f)&&(d[e].value+=" "+f),c.attr(d[e].name,d[e].value);b.replaceWith(c);break;case"html":b.html(c)}},postRender:function(){this._postRender()},_postRender:function(){},enhanceMarkup:function(){this._enhanceMarkup()},_enhanceMarkup:function(){},preRender:function(){this._preRender()},augmentViewModel:function(){},_preRender:function(){},attr:function(a,b){if(0===arguments.length)return _.clone(this.attributes);if(_.isString(a)){if(1===arguments.length)return this.attributes[a];this.attributes[a]=b,this.$root&&this.$root.attr(a,b)}else _.extend(this.attributes,a),this.$root&&this.$root.attr(a);return this},setConfig:function(a,b,c){if(this._setConfigGuard)return this;var d;return _.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b),c&&c.suppressSetters||(this._setConfigGuard=!0,d.template&&(d.template=this.setTemplate(d.template).template),d.root&&(d.root=this.setRoot(d.root).root),d.el&&(d.el=this.setElement(d.el).el),d.rootCSS&&(d.rootCSS=this.setRootCSS(d.rootCSS).rootCSS),d.id&&this.setId(d.id),this._setConfigGuard=!1),this._config.set(d,c),this},getConfig:function(a){return 0===arguments.length?this._config.toJSON():this._config.get(a)},configChanged:function(a){},setTemplate:function(a){return this.template=_.isFunction(a)?a:_.template(a),this.templateAttr=!0,this.setConfig({template:this.template},{suppressSetters:!0}),this},initTemplate:function(a){var b=this.getConfig(a);b||(b=this[a]),"function"==typeof b?this[a]=b:this[a]=_.template(b)},replaceElement:function(a,b){var c=$(a);if(this._isElProvided&&this.$el&&this.$el.get(0)&&this.getConfig("copyAttributes")!==!1)for(var d=_.clone(this.$el.get(0).attributes),e=d.length,f=c.attr("class");e--;)"class"===d[e].name&&f&&!this.$el.hasClass(f)&&(d[e].value+=" "+f),c.attr(d[e].name,d[e].value);return this._replaceElWithElement(a,b,c)},_replaceElWithElement:function(a,b,c){return this.$el.replaceWith(c),this.setElement(a,b)},setElement:function(a,b){return Backbone.View.prototype.setElement.apply(this,arguments),this.setConfig({el:void 0},{suppressSetters:!0,silent:!0}),this.setConfig({el:this.el},{suppressSetters:!0}),this},placeRoot:function(a,b,c){return this[b===!0?"replaceRoot":"setRoot"](a,c),!b&&this._handleRootRelation(),this},replaceRoot:function(a,b){return a=$(a),this._isElProvided?this.$root.replaceWith(a):this.replaceElement(a),this.setRoot(a,b)},setRoot:function(a,b){var c=b!==!1&&this.attr(),d=this.getConfig("id"),e=this.getConfig("rootCSS");return a=this._enhanceRootMarkup(a),"string"==typeof a&&(a=a.replace(/(\r\n|\n|\r)/gm,"")),this.$root=$(a),c&&this.$root.attr(c),c&&e&&this.$root.addClass(e),c&&d&&this.$root.attr({id:d}),this.root=this.$root[0],this._checkVisible(),this._checkEnable(),this.setConfig({root:this.root},{suppressSetters:!0}),this},_enhanceRootMarkup:function(a){return a},_handleRootRelation:function(){this._isElProvided&&"replace"!=this.insertMethod?this._insertElement(this.insertMethod||"append",this.$el,this.$root):this.replaceElement(this.root)},_checkVisible:function(){this.viewModel.getConfig("visible")===!1&&this.$root.hide()},_checkEnable:function(){this.viewModel.getConfig("enabled")===!1&&this.onEnableChange({value:!1})},setRootCSS:function(a){return this.$root&&(this.$root.removeClass(this.rootCSS),this.$root.addClass(a)),this.rootCSS=a,this.rootCSSPattern=new RegExp("\\b"+a+"\\b"),this.setConfig({rootCSS:a},{suppressSetters:!0}),this},setId:function(a){var b={id:a};return this.$root&&this.$root.attr(b),this.setConfig(b,{suppressSetters:!0}),this},addClass:function(a){return this.$root&&this.$root.addClass(a),this},removeClass:function(a){return a=a.replace(this.rootCSSPattern,""),this.$root&&this.$root.removeClass(a),this},toggleClass:function(a){return a=a.replace(this.rootCSSPattern,""),this.$root.toggleClass(a),this},hasClass:function(a){return this.$root.hasClass(a)},onChange:function(a){this._refresh()},onVisibleChange:function(a){this.$root&&(a.value===!0?this.$root.show():this.$root.hide())},onEnableChange:function(){},processRbaData:function(a,b){b=_.defaults({},b,this.options&&this.options.config&&this.options.config.rbaContext);var c=this.$root.find("[data-uxf-rba]");c.length>0?_.each(a,function(a,c){var d={},e={},f=[],g=a.viewID||"src/core/view/View";e.view=this._getObject(g,b),e.view||f.push(g),d.viewConfig=this._getObject("refs."+c+".viewConfig",b);var h=a.viewModelID||"src/core/viewModel/ViewModel";d.viewModel=this._getObject("refs."+c+".viewModel",b),d.viewModel||(e.viewModel=this._getObject(h,b),e.viewModel||f.push(h)),d.vmData=this._getObject("refs."+c+".vmData",b);var i=a.modelID||"src/core/model/Model";d.model=this._getObject("refs."+c+".model",b),d.model||(e.model=this._getObject(i,b),e.model||f.push(i));var j=a.templateID;d.template=this._getObject("refs."+c+".template",b),!d.template&&j&&f.push("text!"+j),this._processRba(a,c,f,e,d,b)},this):_.isEmpty(this.placeholders)||this._handleRBAData(a)},_processRba:function(a,b,c,d,e,f){var g=this;g.___children||(g.___children=[]),require(c,function(){var c=0,h=d.view?d.view:arguments[c++],i=d.viewModel||e.viewModel?d.viewModel:arguments[c++],j=d.model||e.model?d.model:arguments[c++],k=e.template||arguments[c++],l=e.model?e.model:new j(a.modelData,a.modelConfig),m={data:e.vmData||a.vmData,config:a.vmConfig,models:{}};m.models[a.vmModelName||"model"]=l,_.extend(m,a.vmOptions,f[b]?f[b].vmOptions:null);var n=e.viewModel?e.viewModel:new i(m),o=f&&f.el?$(f.el):g.$el,p=o.attr("data-uxf-rba")==b?o:o.find('[data-uxf-rba="'+b+'"]');if(p&&p.length){var q=_.extend({el:p,insertMethod:"append",autoRender:!0},a.viewConfig,e.viewConfig?e.viewConfig:{},k?{template:k}:{}),r=_.extend({config:q,viewModel:n},a.viewAttributes?{attributes:a.viewAttributes}:{},a.viewVmKeys?{vmKeys:a.viewVmKeys}:{},a.viewOptions,f[b]?f[b].viewOptions:null),s=new h(r);g.___children.push(s)}})},processRbaUrl:function(a,b,c){var d=c?new c(null,{url:a}):new RESTModel(null,{url:a}),e=this;return d.fetch({success:function(a,c){e.processRbaData(a.toJSON(),b),b&&b.callback&&b.callback(c),e.trigger("rba:loaded")}})},_processRbaConfig:function(){this.options&&this.options.config&&(this.options.config.rbaUrl?this.processRbaUrl(this.options.config.rbaUrl,null,this.options.config.rbaRestModel):this.options.config.rbaData&&this.processRbaData(this.options.config.rbaData))},_getObject:function(a,b){if(a&&b){var c=a.split(".");return _.reduce(c,function(a,b){return a?a[b]:void 0},b)}},getBindContext:function(){return _.extend(_getBindContext(this),this.getConfig("bindContext")||{})},switchClass:function(a,b,c){var d=this.$root;d.off("transitionend"),d.one("transitionend",function(){_.isFunction(c)&&c()});var e=_getElementStyles(d[0]);
d.removeClass(b).addClass(a);var f=d.css("transition-delay");return f=1e3*parseFloat(f),setTimeout(function(){var a=_getElementStyles(d[0]);$.isEmptyObject(_styleDifference(e,a))&&d.trigger("transitionend")},f+100),this},getGroupId:function(a){var b=this.options&&this.options.group||"";return _.isString(b)?(b.length>0&&(b+="."),b):b.hasOwnProperty(a.moduleID)?b[a.moduleID]+".":null},_initInnerFlowArtifacts:function(){if(!_.isUndefined(this.options.viewRoutes)||!_.isUndefined(this.viewRoutes)){this.options.viewRoutes=_.union(_.isUndefined(this.options.viewRoutes)?[]:this.options.viewRoutes,_.isUndefined(this.viewRoutes)?[]:this.viewRoutes),this._internalFlow=new WidgetInternalFlow($.extend(this.options,{widget:this}));var a=this;this._internalFlow.on("change:viewRoute",function(b){a.trigger("change:viewRoute",b)}),this._internalFlow.on("change:visible",function(b){b.visible?a.trigger("viewRoute:visible",b):a.trigger("viewRoute:inVisible",b)})}},viewRoutesLoad:function(a,b){this._internalFlow.load(a,b)},viewRoutesExit:function(a,b){this._internalFlow.exit(a,b)},viewRoutesNavigate:function(a,b){this._internalFlow.navigate(a,b)},viewRoutesPrev:function(){this._internalFlow.prev()},viewRoutesNext:function(){this._internalFlow.next()},getCurrentDisplayedViewRoute:function(a){return this._internalFlow.getCurrent(a)}});_.extend(View.prototype,Utils.Factory,Utils.Common);var _getBindContext=function(a){var b={getVMData:_.bind(a._getVMData,a),getResourceBundle:_.bind(a.getResourceBundle,a)};return b},_getElementStyles=function(a){var b,c,d=a.ownerDocument.defaultView?a.ownerDocument.defaultView.getComputedStyle(a,null):a.currentStyle,e={};if(d&&d.length&&d[0]&&d[d[0]])for(c=d.length;c--;)b=d[c],"string"==typeof d[b]&&(e[$.camelCase(b)]=d[b]);return e},_styleDifference=function(a,b){var c,d,e={},f={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1,transitionDuration:1,WebkitTransitionDuration:1,oTransitionDuration:1};for(c in b)d=b[c],a[c]!==d&&(f[c]||!$.fx.step[c]&&isNaN(parseFloat(d))||(e[c]=d));return e};return View.extend=Utils.extend,View.mergeProperties={scope:"merge",publicMethods:"merge",config:"merge",vmKeys:"merge",vmKeysChangeEvents:"merge"},View.getViewActions=function(){return this.prototype.publicMethods},View});
define("src/core/application/Application",["backbone","src/core/util/Utils","businesswidget/repository_l9_common/common/core/ImplStorageUtil"],function (a,b,c){"use srtict";var d=a.View.extend({constructor:function(b){this.areaCode=b.id||"lsapp",this.context=c.get(this.areaCode)||{},a.View.apply(this,arguments)},navigate:function(a,b){c.set(this.areaCode,this.context),this.options.router.navigate(a,b)},destroy:function(){},create:b.create});return d.extend=b.extend,d});
define("src/core/application/BusinessWidget",["jquery","underscore","src/core/view/View","src/core/util/Utils","src/core/util/Configuration","knockout"],function (a,b,c,d,e,f){var g=function(){return"function"==typeof this.viewModel?this.create("rootViewModel",this.viewModel,{}):this.viewModel},h=c.extend({isBusinessWidget:!0,getMetaData:function(){return metaData},actionMap:{},_configure:function(a){this.contentData=a.contentData,this.viewModel=g.call(this),this.executionContext=a.executionContext||{},this._super(a)},render:function(){return this._super(),this._processRules(),this},_buildRoot:function(){this._super(),this.getConfig("responsiveContainer")&&this._processResponsive()},_processResponsive:function(){var c,d=e.get("responsive")||{},f=this,g=d.wait||200;b.isArray(d.breakpoints)&&d.breakpoints.length>0&&(c=b.extend([],d.breakpoints),c.unshift(0),c.push(1/0),a(window).on("resize orientationchange load",b.throttle(function(){f._processViewportChange(c,d)},g)))},_processViewportChange:function(a,b){for(var c=this.$el.width(),d=a[0],e=a[a.length-1],f=0;f<a.length;f++)c>=a[f]&&a[f]>=d&&(d=a[f]),c<a[f]&&a[f]<e&&(e=a[f]);this._removeResponsiveClasses(b),this._addResponsiveClasses(d,e,b)},_addResponsiveClasses:function(a,b,c){var d=c.bottomBoundryPrefix,e=c.topBoundryPrefix;d&&a>0&&this.$el.addClass(d+a),e&&b<1/0&&this.$el.addClass(e+b)},_removeResponsiveClasses:function(a){this._removeResponsivePrefix(a.bottomBoundryPrefix),this._removeResponsivePrefix(a.topBoundryPrefix)},_removeResponsivePrefix:function(b){var c,d;if(b){var c=this.$el[0],d=c.className.split(" ").filter(function(a){return 0!==a.lastIndexOf(b,0)});c.className=a.trim(d.join(" "))}},loadMode:function(a){var b=this.modes[a];this._mode!==a&&b&&"function"==typeof this[b]&&(this._mode=a,this[b]())},_processRules:function(){var a=this.rules,b=requirejs.appContext;if(a&&b)for(var c=this,d=0,e=a.length;d<e;d++)f.computed(function(){var a=f.computedContext.isInitial(),d=c[this.evaluator](b,a);d&&c.trigger("outcome:"+this.outcome,this)},a[d])},getFromContext:function(a,b,c){var d;return this.executionContext&&this.executionContext.getModule&&a&&(d=this.executionContext.getModule(a)),!d&&b&&(d=this.create(a,b,c)),d},_handleInlineWidgets:function(a,c,d,e){var g,h,i,j;if(b.has(c,"path")&&b.has(c,"name"))g=requirejs(c.path),h=c.id||c.name;else{if(!b.has(c,"name"))throw new Error("Incorrect widget binding parameters: must inlcude either name or path AND name.");i=this.getConfig("scope")||this.scope,g=i[c.name],h=c.id||c.name}if("#comment"===a.nodeName){var j=this.create(h,g,{el:a,config:c});f.virtualElements.prepend(a,j.root)}else this.create(h,g,{el:a,config:c})},reload:function(){},clear:function(){}});return h});
define("src/core/hub/HubBaseTopic",["underscore","backbone","src/core/util/Utils","src/core/viewModel/ViewModel"],function (a,b,c,d){var e=d.extend({WRITE_ONLY:"pub",READ_ONLY:"sub",READ_WRITE:"pubsub",CHANGE_ACTION_NAME:"$change",SUBSCRIBE_ACTION_NAME:"$subscribe",initialize:function(a){this.options=a||{},this.mode=this.options.mode||this.mode||this.READ_WRITE,this.vmKeys=this.options.vmKeys},isWriteOnly:function(){return this.mode===this.WRITE_ONLY},isReadOnly:function(){return this.mode===this.READ_ONLY},destroy:function(){this.off()},unsubscribe:function(a,b){this.off(null,a,b)},publish:function(){},subscribe:function(){}});return e});
define("src/core/hub/HubTopic",["src/core/hub/HubBaseTopic","src/core/util/Utils"],function (a,b){var c={setViewModel:function(a){this.subViewModels=this.subViewModels||{},this.subViewModels.viewModel||(this.subViewModels.viewModel=a,c.createDataBindings.call(this),this._bindData())},generateTopicData:function(a,c){var d=b.clone(_.omit(this.get(),"subViewModels")),e={action:c,data:d};return c===this.SUBSCRIBE_ACTION_NAME?(e.changedAttributes=d,e.prevAttributes={},e.changedAttributes={}):c===this.CHANGE_ACTION_NAME&&(e.changedAttributes=b.clone(a.changed),e.prevAttributes=b.clone(_.omit(a.target.data.previousAttributes(),"subViewModels"))),e},parsePath:function(a){var b=a.indexOf(":")>-1;if(!b)return a;var c=a.split(":"),d=c[0].split("."),e=c[1];return"subViewModels."+d.join(".subViewModels.")+"."+e},createDataBindings:function(){this.dataBindings=[];var a,b={options:{twoWay:!this.isReadOnly()}};_.isUndefined(this.vmKeys)?_.each(_.keys(this.subViewModels.viewModel.get()),function(a){dataBinding={options:{twoWay:!this.isReadOnly()}},dataBinding[a]="subViewModels.viewModel."+a,this.dataBindings.push(dataBinding)},this):_.each(_.keys(this.vmKeys),function(d){if(0===d.indexOf("data.")){a=d.substring(5);var e=_.extend({},b);_.isString(this.vmKeys[d])?e[a]="subViewModels.viewModel."+c.parsePath.apply(this,[this.vmKeys[d]]):_.isObject(this.vmKeys[d])&&(e[a]=["subViewModels.viewModel.subViewModels",this.vmKeys[d].vm,this.vmKeys[d].key].join(".")),this.dataBindings.push(e)}},this)},getVmAction:function(a){return this.vmKeys?this.vmKeys["action."+a]:a},getTopicActions:function(){var a="action.",b=[];return _.each(_.keys(this.vmKeys||[]),function(c){0===c.indexOf(a)&&b.push(c.substring(a.length))}),b}},d=a.extend({viewModel:void 0,initialize:function(a){this._super(a),this.vmId=this.options.vmId,this.on("change",function(a){this.trigger("__change",c.generateTopicData.apply(this,[a,this.CHANGE_ACTION_NAME]))},this)},subscribe:function(a){requirejs([this.vmId],_.bind(function(b){var d;if(c.setViewModel.apply(this,[b]),(_.indexOf(a.actions,"change")>-1||!a.actions)&&this.on("__change",a.handler,a.context),this.vmKeys){d=a.actions?_.intersection(c.getTopicActions.call(this),a.actions):c.getTopicActions.call(this);var e;_.each(d,function(b){e=c.getVmAction.call(this,[b]),this.subViewModels.viewModel.on("action:"+e,function(a){var d=(_.omit(this.get(),"subViewModels"),c.generateTopicData.apply(this,[{},b]));d.args=a,this.trigger("__action:"+b,d)},this),this.on("__action:"+b,a.handler,a.context)},this)}if(!a.silent){_.omit(this.get(),"subViewModels");_.bind(a.handler,a.context)(c.generateTopicData.apply(this,[{},this.SUBSCRIBE_ACTION_NAME]))}},this))},publish:function(a,b){requirejs([this.vmId],_.bind(function(d){if(c.setViewModel.apply(this,[d]),a=_.pick(a,_.keys(this.get())),this.set(a),b){var e=c.getVmAction.apply(this,[b]);e&&this.subViewModels.viewModel.handleAction(e)}},this))},destroy:function(){this._super(),this.viewModel&&this.viewModel.off(null,null,this)}});return d});
define("src/core/hub/SecurityTopic",["src/core/hub/HubBaseTopic","businesswidget/repository_l9_common/common/core/ImplLSRESTDataSource"],function (a,b){var c=a.extend({TOKEN_UPDATED_EVENT:"tokenUpdated",TOKEN_TIMEOUT_EVENT:"tokenTimeout",initialize:function(a){this._super(a),b.on(b.TOKEN_UPDATE_EVENT,function(a){this.trigger(this.TOKEN_UPDATED_EVENT,{token:a.token})},this),b.on(b.ERROR,function(a){a.type=b.TOKEN_INVALID,this.trigger("error",a)},this)},subscribe:function(a){this.on(this.TOKEN_UPDATED_EVENT,a.handler,a.context)},publish:function(a){var c=!!_.isUndefined(a.persist)||a.persist;b.prototype.setToken(a.token,c)}});return c});
define("src/core/hub/ErrorTopic",["src/core/hub/HubBaseTopic"],function (a){var b=a.extend({publish:function(a){this.trigger("error",a)},subscribe:function(a){this.on("error",a.handler,a.context)}});return _.extend(b,{UNREGISTERED_TOPIC:"unregistered",REGISTERED_TOPIC:"registered",UNKONWN_PAYLOAD:"unkownPayload",INVALID_PAYLOAD:"invalidPayload",READ_ONLY_TOPIC:"readOnly",WRITE_ONLY_TOPIC:"writeOnly"}),b});
define("src/core/hub/BusinessWidgetHub",["underscore","backbone","src/core/hub/HubTopic","src/core/hub/SecurityTopic","src/core/hub/ErrorTopic"],function (a,b,c,d,e){var f=function(){this._initialize()};a.extend(f.prototype,{_topics:{},_initialize:function(){this._setTopic("error",new e),this._setTopic("security",new d);var a=this._getTopic("security");a.on("error",function(a){this.publish("error",a)},this)},_getTopic:function(a){return this._topics[a]},_setTopic:function(a,b){this._topics[a]=b},_removeTopic:function(a){var b=this._getTopic(a);b.destroy(),delete this._topics[a]},isTopicReadOnly:function(a){if(this.isRegistered(a)){var b=this._getTopic(a);return b.isReadOnly()}},isTopicWriteOnly:function(a){if(this.isRegistered(a)){var b=this._getTopic(a);return b.isWriteOnly()}},isRegistered:function(b){return!a.isUndefined(this._getTopic(b))},register:function(b,d){a.isArray(b)?a.each(b,function(a){this.register(a.name,a)},this):this.isRegistered(b)?this.publish("error",{type:e.REGISTERED_TOPIC,topicName:b}):this._setTopic(b,new c({mode:d.mode,vmId:d.vmId,vmKeys:d.vmKeys}))},unregister:function(b){if(a.isArray(b))for(var c=0;c<b.length;c++)this.unregister(b[c]);else this.isRegistered(b)&&this._removeTopic(b)},subscribe:function(a,b){if(this.isRegistered(a)){var c=this._getTopic(a);c.isWriteOnly()?this.publish("error",{type:e.WRITE_ONLY_TOPIC,topicName:a}):c.subscribe({handler:b.handler,context:b.context,actions:b.actions,silent:b.silent})}else this.publish("error",{type:e.UNREGISTERED_TOPIC,topicName:a})},unsubscribe:function(a,b){if(!this.isRegistered(a))return void this.publish("error",{type:e.UNREGISTERED_TOPIC,topicName:a});var c=b.context||null,d=b.handler||null,f=this._getTopic(a);f.unsubscribe(d,c)},publish:function(a,b,c){if(this.isRegistered(a)){var d=this._getTopic(a);d.isReadOnly()?this.publish("error",{type:e.READ_ONLY_TOPIC,topicName:a}):d.publish(b,c)}else this.publish("error",{type:e.UNREGISTERED_TOPIC,topicName:a})},bindTopics:function(b,c,d){var f=!1;if(a.each([b,c],function(a){this.isRegistered(a)||(this.publish("error",{type:e.UNREGISTERED_TOPIC,topicName:a}),f=!0)},this),!f){this._getTopic(b),this._getTopic(c);d&&d.bindings&&(this.subscribe(b,{handler:function(a){var b=a.changedAttributes,e=d.aToB?d.aToB:g;this.publish(c,e(b,d.bindings))},actions:["change"],silent:!0,context:this}),this.subscribe(c,{handler:function(c){var e=c.changedAttributes,f=d.bToA?d.bToA:g;this.publish(b,f(e,a.invert(d.bindings)))},actions:["change"],silent:!0,context:this}))}},reset:function(){a.each(a.keys(this._topics),function(a){this._removeTopic(a)},this),this._initialize()}},b.Events);var g=function(a,b){var c={};for(var d in a)b[d]&&(c[b[d]]=a[d]);return c};return new f});
define("src/core/controller/RulesAggregator",["underscore","src/core/util/Utils"],function (a,b){var c=function(a){return{}};return c});
define("src/core/controller/RulesExecutor",["underscore","src/core/util/Utils","src/core/controller/RulesAggregator"],function (a,b,c){var d=function(b){var d=[];if(b.rulesAggregators)for(var e=0;e<b.rulesAggregators.length;e++)d.push(new b.rulesAggregators[e](b));else d=[new c(b)];this.rulesAggregators=d,this.execute=function(b,c){var d,e=b;if(b.rules&&(d=b.rules,d&&d.length>0))for(var f=0;f<d.length;f++){var g=this._evaluateRule(d[f],b,c);if("string"==typeof g)e={target:g};else if("object"==typeof g)e=g;else{if(g&&d[f].target){e=d[f];break}g!==!1||a.isUndefined(d[f].onFalse)||(e=""===d[f].onFalse?{}:{target:d[f].onFalse})}}return e},this._evaluateRule=function(a,b,c){var d,e;if(a.condition)d=this._evaluateRuleCondition(a.condition);else if(a.conditionFunction)for(var f=0;f<this.rulesAggregators.length;f++)if(e=this.rulesAggregators[f],e[a.conditionFunction]){d=e[a.conditionFunction](b,c);break}return d},this._evaluateRuleCondition=function(a){return a}};return d});
define("src/core/controller/FlowManager",["jquery","underscore","backbone","src/core/util/Utils","businesswidget/repository_l9_common/common/core/ImplStorageUtil","src/core/controller/RulesExecutor","src/core/viewModel/ViewModel","src/core/dataSource/LocalStorageDataSource","src/core/model/Model"],function (a,b,c,d,e,f,g,h,i){var j=function(c){return{FLOW_NAMESPACE:"_flow",FLOW_CONFIG:/(.*?)(\[)(.*?)(\])(.*)/,MATCH_PATTERN:3,REPLACE_PATTERN:"$3",FLOW_MANAGER_ID:"flowmanager",vm:new g,router:c.router,options:c,targetAttribute:c.targetAttribute||"url",resetFlows:function(){this.flowsMap=null,this.flowPathConfig=null,this.currentPosition=null},registerFlow:function(a){a.targetAttribute||this.targetAttribute;this._createFlowsMap(a),this._initFlowState(a),this._createRouteObject(a)},_createFlowsMap:function(a){var b;this.flowsMap=this.flowsMap||{},this.flowsMap[a.id]=this.flowsMap[a.id]||{};for(var c=0;c<a.steps.length;c++)b=a.steps[c],this.flowsMap[a.id]=a,this.flowsMap[a.id].stepsMap=this.flowsMap[a.id].stepsMap||{},this.flowsMap[a.id].stepsMap[b.id]=b},_initFlowState:function(a){var b,c="start",d=this.flowsMap[a.id];for(this.flowPathConfig=this.flowPathConfig||{},this.flowPathConfig[a.id]=this.flowPathConfig[a.id]||{},this.flowPathConfig[a.id].steps=this.flowPathConfig[a.id].steps||[];;){if(b=d.actions[c],c="next",!b)break;"string"==typeof b?d=this.flowsMap[a.id].stepsMap[b]:"object"==typeof b&&(d=this.flowsMap[a.id].stepsMap[b.target]),this.flowPathConfig[a.id].steps.push(d)}},_createRouteObject:function(b){var c;if(a.mobile&&!b.responsive){var c;b.external&&(c={handler:function(a,b){return function(c,d,e,f){d.path=b.flowsMap[a.id].stepsMap[f][b.flowsMap[a.id].targetAttribute]}}(b,this)},this.router.registerSingleRoute(b.id+this.flowsMap[b.id].separator+":step",c,this.router.options))}else b.external&&(c={handler:function(b,c){return function(d,e,f,g){e.path=c.flowsMap[b.id].stepsMap[g][c.flowsMap[b.id].targetAttribute],f.queryParams&&(a.mobile&&!b.responsive?e.path="?"+f.queryParams+e.path:e.path+="?"+f.queryParams)}}(b,this)},this.router.registerSingleRoute(b.id+"/:step",c,this.router.options))},_gotoStep:function(b,c,d){var e,f,g;g=a.mobile?"_":"/";var h=this._getPosition();(c||h)&&(f={queryParams:"["+b.flowID+"/"+b.targetID+"]",fragment:b.fragment}),b.type?"navigate"===b.type?c&&b.start!==!1?this.router.navigate(b.flowID+g+b.targetID,f):(this.resetFlowData(),this.router.navigate(b.targetID,f)):"load"===b.type?b.context.load(b.targetID,{requested:!0}):b.context.load("["+b.flowID+"/"+b.targetID+"]",{requested:!0}):(e=this.flowsMap[b.flowID],e&&!e.external?b.context.load("["+b.flowID+"/"+b.targetID+"]",{requested:!0,replace:d}):(e&&e.responsive&&(g="/"),f.external=e&&e.external,this.router.navigate(b.flowID+g+b.targetID,f))),a.mobile&&(b.cleanupStep||this._setPosition(b)),this.flowPathConfig&&this.flowPathConfig[b.flowID]&&(this.flowPathConfig[b.flowID].currentPosition=b)},_removeParameter:function(a,b){var c=a.split("?");if(c.length>=2){for(var d=c.shift(),e=c.join("?"),f=encodeURIComponent(b)+"=",g=e.split(/[&;]/g),h=g.length;h-- >0;)g[h].lastIndexOf(f,0)!==-1&&g.splice(h,1);a=d+"?"+g.join("&")}return a},_startFlow:function(a,b){this._gotoStep(a,!0,b)},executeAction:function(a,c,d,e){var f,h,i;if(b.isUndefined(e)||(i=e.viewModel,h=e.replace),this.vm=i||this.vm||new g,a){if(f=this._decideAction(a,c,e),!f||b.isUndefined(f.targetID))return;f.context=d,this[f.action].call(this,f,h),this.vm.trigger("flow:"+f.event,f,this.flowPathConfig)}},_decideAction:function(b,c,d){var e,f,g,h,i,j={};if(h=this._getPosition()){var k,f=this.flowsMap[h.flowID].stepsMap[h.targetID];f.actions&&f.actions[b]?k=f.actions[b]:this.flowsMap[h.flowID].actions&&this.flowsMap[h.flowID].actions[b]&&(k=this.flowsMap[h.flowID].actions[b]),g=this.flowsMap[h.flowID]}else{if(!c)return;f=this.flowsMap[c].stepsMap[b],g=this.flowsMap[c]}switch(b){case"next":j.event="next",j.action="_gotoStep",e=this._decideRealTarget(k,g),j.targetID=e.target,j.type=e.type,j.flowID=h.flowID;break;case"prev":j.event="prev",j.action="_gotoStep",e=this._decideRealTarget(k,g),j.targetID=e.target,j.type=e.type,j.flowID=h.flowID;break;case"start":d&&(i=d.step),j.event="start",j.action="_startFlow",j.flowID=c,this.flowsMap[j.flowID].actions&&(k=i||this.flowsMap[j.flowID].actions[b]),e=this._decideRealTarget(k,g),j.targetID=e.target,j.type=e.type,j.start=e.start,j.reset=e.reset,j.targetID||(j.targetID=this.flowsMap[j.flowID].steps[0].id),this.resetFlowData(j.reset);break;case"goto":j.event="goto",j.action="_gotoStep",g.actions&&g.actions["goto"]&&g.actions["goto"].length>0&&(k=this._mergetGotoTargets(g.actions["goto"],k)),e=this._decideRealTarget(k,g,c),j.targetID=e.target,j.type=e.type,j.flowID=h.flowID;break;case"finish":j.event="finish",j.action="_gotoStep",j.flowID=h.flowID,this.flowsMap[j.flowID].actions&&(k=this.flowsMap[j.flowID].actions[b]),e=this._decideRealTarget(k,g),j.targetID=e.target,j.type=e.type,j.reset=e.reset,a.mobile&&(j.cleanupStep=!0),this.resetFlowData(j.reset);break;case"cancel":j.event="cancel",j.action="_gotoStep",j.flowID=h.flowID,this.flowsMap[j.flowID].actions&&(k=this.flowsMap[j.flowID].actions[b]),e=this._decideRealTarget(k,g),j.targetID=e.target,j.type=e.type,j.reset=e.reset,a.mobile&&(j.cleanupStep=!0),this.resetFlowData(j.reset);break;default:j.action=b,j.event=b,e=this._decideRealTarget(k,g),j.targetID=e.target,j.type=e.type}return j&&d&&d.fragment&&(j.fragment=d.fragment),j},_mergetGotoTargets:function(a,c){var d=b.union(c,a),e=b.uniq(d,!1,function(a){return a.target});return e},_decideRealTarget:function(a,c,d){var e={};if(d)if(b.isArray(a)){for(var f=0;f<a.length;f++)if(a[f].target===d){e=this._executeRule(a[f],c,d);break}}else e=this._executeRule(a,c,d);else"string"!=typeof a&&a||(e.target=a),"object"==typeof a&&(e=this._executeRule(a,c));return e},_executeRule:function(a,b,c){return this._initRulesExecutor(b),this.executor.execute(a,c)},_initRulesExecutor:function(a){var c,d,e,g;if(a&&a.rulesAggregator&&this.options.rulesAggregators){if(b.isArray(a.rulesAggregator)){d=[];for(var h=0;h<a.rulesAggregator.length;h++)e=this.options.rulesAggregators[a.rulesAggregator[h]],e&&d.push(e)}else d=[this.options.rulesAggregators[a.rulesAggregator]];d||(d=[this.options.rulesAggregators["default"]])}!this.executor&&this.options&&(b.isArray(d)?g=d:this.options.rulesAggregator&&(g=[this.options.rulesAggregator]),c={rulesAggregators:g,flowManager:this},this.options.rulesExecutor?"object"==typeof this.options.rulesExecutor?this.executor=this.options.rulesExecutor:this.executor=new this.options.rulesExecutor(c):this.executor=new f(c))},_resetPosition:function(){this.currentPosition=null},_setPosition:function(a){this.currentPosition={targetID:a.targetID,flowID:a.flowID}},_getPosition:function(){var b,c;if(a.mobile)b=this.currentPosition,b||(c=this.router.getHash().split("_"),c&&2===c.length&&(b={flowID:c[0],targetID:c[1]}));else if(!b){var d=function(a){var b=a.match(this.FLOW_CONFIG);return b&&b.length>this.MATCH_PATTERN?b[this.MATCH_PATTERN].split("/"):null}.bind(this);c=d(this.router.getDecodedHash()),(!c||c.length<2)&&(c=d(this.router.getQueryParams())),c&&2===c.length&&(b={flowID:c[0],targetID:c[1]})}return b},getPosition:function(){return this._getPosition()},_createModel:function(){if(!this.model){this.model=new i(null,{url:"/uxf"});var a=new h;a.storage=e.getStorage("session"),this.model.setDataSource(a)}},getFlowData:function(a){var b;return this.vm&&(this._createModel(),b=this.vm.get(a),b||(this.model.fetch({id:this.FLOW_MANAGER_ID}),b=this.model.get(a),b&&this.vm.set("key",b,{silent:!0}))),b},resetFlowData:function(b){a.mobile&&this._resetPosition(),b&&this.vm.clear(),this.model?(this.model.destroy(),this.model.clear()):this._createModel()},setFlowData:function(a,b,c){this.vm=this.vm||new g,this._createModel(),this.vm.set("key",b,{silent:!c}),this.model.set(a,b),this.model.save(void 0,{id:this.FLOW_MANAGER_ID})},deleteFlowData:function(a){this._createModel(),this.model.unset(a),this.model.save(void 0,{id:this.FLOW_MANAGER_ID})},getFlowState:function(a){var b=this.flowPathConfig;return a&&(b=b[a]),b},setViewModel:function(a){this.vm=a,this._createModel()},getViewModel:function(){return this._createModel(),this.vm},getFlowConfig:function(a){return this.flowsMap[a]},markStepAs:function(a,b){this.vm.trigger("flow:step:mark",b,a)},unmarkStepAs:function(a,b){this.vm.trigger("flow:step:unmark",b,a)}}};return j.storage=e.getStorage("session"),j.extend=d.extend,j});
define("src/core/controller/Router",["jquery","underscore","backbone","src/core/util/Utils","businesswidget/repository_l9_common/common/core/ImplStorageUtil","src/core/controller/FlowManager"],function (a,b,c,d,e,f){var g=c.Router.extend({initialize:function(a){this.key=b.uniqueId("lsKey_"),this._initFlowManager(a),this._init(a),this.registerRoutes(this.configuration.routes,a)},_init:function(b){this.configuration=a.extend(!0,{},b),this.configuration.routes=this.configuration.routes||{}},_initFlowManager:function(a){var b;this.fm||(b={router:this},a&&a.rulesExecutor&&(b.rulesExecutor=a.rulesExecutor),a&&a.rulesAggregators&&(b.rulesAggregators=a.rulesAggregators),a&&a.storageType&&(b.storageType=a.storageType),a&&a.flowManager?"object"==typeof a.flowManager?this.fm=a.flowManager:this.fm=new a.flowManager(b):this.fm=new f(b))},registerRoutes:function(a,b){var c;for(var d in a)c=a[d],this.registerSingleRoute(d,c,b)},registerSingleRoute:function(a,b,c){"string"==typeof b?b=c[b]&&"function"==typeof c[b]||this[b]?{handler:c[b]||this[b]}:{path:b}:"function"==typeof b&&(b={handler:b}),b.handler=("string"==typeof b.handler?c[b.handler]||this[b.handler]:b.handler)||function(){},b.regex=this._routeToRegExp(a),this.routes[a]=b},executeAction:function(a,b,c,d){this.fm&&this.fm.executeAction(a,b,c,d)},navigate:function(b,d){d=d||{},d=a.mobile?this._createRouteConfig(d):this._createRouteConfig(d,!0);var e=this._getRouteObject(b);if(d.valueObject&&this._setValueObject(d.key,d.valueObject),e){var f=d.external||e.external,g=this._extractParameters(e.regex,b);g.unshift(d),g.unshift(e),g.unshift(b);var h=e.handler.apply(this,g);!h&&e.path&&(f?(d.hash&&(e.path=e.path+"#"+d.hash.join("/#!/")),d.fragment&&(e.path=e.path+"#"+d.fragment),d.replace?window.location.replace(e.path):window.open(e.path,"_self")):c.history.fragment!==b&&c.Router.prototype.navigate(e.path,d))}else c.Router.prototype.navigate(b,d);this.trigger("route:"+b,g)},_createRouteConfig:function(b,c){var d=a.extend(!0,{},b);return void 0===d.trigger&&(d.trigger=!0),d.external=c,d},_getRouteObject:function(a){var b,c=this.routes[a];if(!c)for(var d in this.routes)if(b=this.routes[d],b.regex.test(a)){c=b;break}return c},_setValueObject:function(a,b){var c=a||this.key;b&&g.storage.set(c,b)},getValueObject:function(a,b){var c=a||this.key,d=g.storage.get(c);return d&&b&&g.storage.deleteKey(c),d},getQueryParams:function(){return window.location.search},getHash:function(){return c.history.getFragment()},getDecodedHash:function(){return decodeURIComponent(c.history.getFragment())},getFlowState:function(a){return this.fm.getFlowState(a)},getFlowData:function(a){return this.fm.getFlowData(a)},setFlowData:function(a,b){this.fm.setFlowData(a,b)},resetFlowData:function(){this.fm.resetFlowData()},deleteFlowData:function(a){return this.fm.deleteFlowData(a)},setViewModel:function(a){this.fm&&this.fm.setViewModel(a)},getViewModel:function(){return this.fm&&this.fm.getViewModel()},getFlowConfig:function(a){return this.fm&&this.fm.getFlowConfig(a)},markStepAs:function(a,b){this.fm&&this.fm.markStepAs(a,b)},unmarkStepAs:function(a,b){this.fm&&this.fm.unmarkStepAs(a,b)}});return c.History.prototype._updateHash=function(b,c,d){var e;"?"===c.charAt(0)?(e=c.split("#"),d?b.replace(b.toString().replace(/(javascript:|#|\?).*$/,"")+e[0]+"#"+e[1]):b.href=b.toString().replace(/(javascript:|#|\?).*$/,"")+e[0]+"#"+e[1]):d?b.replace(b.toString().replace(/(javascript:|#).*$/,"")+"#"+c):a.mobile?a.mobile.changePage("#"+c):b.hash=c},g.storage=e.getStorage("session"),g});
define("src/core/logger/Layout",["underscore"],function (a){var b=function(){a.extend(b.prototype,{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",urlKey:"url",getDataValues:function(a,b){var c=[[this.loggerKey,a.logger.name],[this.timeStampKey,a.timeStamp],[this.levelKey,a.level.name],[this.urlKey,window.location.href],[this.messageKey,b?a.getCombinedMessages():a.messages]];return c},format:function(a){var b=this.format(a);return b}})};return b});
define("src/core/logger/JSONLayout",["underscore","src/core/logger/Layout"],function (a,b){var c=function(a,b){var c="\r\n";this.readable=a,this.combineMessages=b,this.batchHeader=this.readable?"["+c:"[",this.batchFooter=this.readable?"]"+c:"]",this.batchSeparator=this.readable?","+c:",",this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?c:"",this.customFields=[]};return c.prototype=new b,a.extend(c.prototype,{isReadable:function(){return this.readable},isCombinedMessages:function(){return this.combineMessages},format:function(a){var b,c,d=this.getDataValues(a,this.combineMessages),e="\n{"+this.lineBreak;for(b=0,c=d.length-1;b<=c;b++)e+=this.tab+"'"+d[b][0]+"'"+this.colon+d[b][1],b<c&&(e+=","),e+=this.lineBreak;return e+="}"+this.lineBreak},getContentType:function(){return"application/json"}}),c});
define("src/core/logger/Level",["underscore"],function (a){var b=function(a,b){this.level=a,this.name=b};return a.extend(b.prototype,{toString:function(){return this.name},equals:function(a){return this.level===a.level},isGreaterOrEqual:function(a){return this.level>=a.level}}),b.ALL=new b(Number.MIN_VALUE,"ALL"),b.TRACE=new b(1e4,"TRACE"),b.DEBUG=new b(2e4,"DEBUG"),b.INFO=new b(3e4,"INFO"),b.WARN=new b(4e4,"WARN"),b.ERROR=new b(5e4,"ERROR"),b.FATAL=new b(6e4,"FATAL"),b.OFF=new b(Number.MAX_VALUE,"OFF"),b});
define("src/core/logger/Appender",["underscore","src/core/logger/Level"],function (a,b){var c=function(){};return a.extend(c.prototype,{doAppend:function(a){a.level.level>=b.DEBUG.level&&this.append(a)}}),c});
define("src/core/logger/TopicAppender",["underscore","src/core/logger/Appender","src/core/logger/Level","src/core/logger/Layout","src/core/logger/JSONLayout"],function (a,b,c,d,e){var f=function(a,b){var c=!0,d=this;a||(c=!1,console.log("Topic Cannot be undefined"));var e=[],f=[],g=null;this.getSessionId=function(){return g},this.setSessionId=function(a){g=a,this.layout.setCustomField("sessionid",g)},this.setLayout=function(a){this.layout=a,null!==g&&this.setSessionId(g)},this.getLayout=function(){return this.layout},this.append=function(g){function h(a){for(var b,c=[],e="";b=a.shift();)c.push(d.layout.format(b));return e=1===a.length?c.join(""):d.layout.batchHeader+c.join(d.layout.batchSeparator)+d.layout.batchFooter}function i(d){c&&b.publish(a.name,{logData:d})}e.push(g);var j=1;if(e.length>=j){for(var k,l=[];k=e.shift();)l.push(k);f.push(l)}for(var m;m=f.shift();)i(h(m))}};return f.prototype=new b,a.extend(f.prototype,{layout:new e,threshold:c.DEBUG,defaults:{timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,postVarName:"data",contentType:"application/json"},toString:function(){return"TopicAppender"}}),f});
define("src/core/logger/ModelAppender",["underscore","src/core/logger/Appender","src/core/logger/Layout","src/core/logger/JSONLayout","src/core/logger/Level"],function (a,b,c,d,e){var f=function(a){var b=this,c=!0;a||(c=!1,console.log("Model Cannot be undefined"));var d=this.defaults.timed,e=this.defaults.batchSize,f=this.defaults.timerInterval,g=this.defaults.sendAllOnUnload,h=null,i=[],j=[],k=!1,l=!1;this.getSessionId=function(){return h},this.setSessionId=function(a){h=a,this.layout.setCustomField("sessionid",h)},this.setLayout=function(a){this.layout=a,null!==h&&this.setSessionId(h)},this.getLayout=function(){return this.layout},this.isTimed=function(){return d},this.setTimed=function(a){d=a},this.getTimerInterval=function(){return f},this.setTimerInterval=function(a){f=a},this.getBatchSize=function(){return e},this.setBatchSize=function(a){e=a},this.isSendAllOnUnload=function(){return g},this.setSendAllOnUnload=function(a){g=a},this.preparePostData=function(a){for(var c,d=[],e="";c=a.shift();)d.push(b.layout.format(c));return e=1===a.length?d.join(""):b.layout.batchHeader+d.join(b.layout.batchSeparator)+b.layout.batchFooter},this.sendRequest=function(b){if(c){var d=new a({Object:b},{});d.save({})}},this.append=function(a){if(l||this.init(),c){i.push(a);var b=e;if(i.length>=b){for(var f,g=[];f=i.shift();)g.push(f);j.push(g),d||this.sendAll()}}},this.init=function(){if(l=!0,g){var a=window.onbeforeunload;window.onbeforeunload=function(){if(a&&this.oldBeforeUnload(),this.sendAllRemaining())return"Sending log messages"}}d&&this.scheduleSending()},this.scheduleSending=function(){var a=this;setTimeout(function(){a.sendAll()},f)},this.sendAll=function(){if(c){k=!0;for(var a;a=j.shift();)this.sendRequest(this.preparePostData(a));k=!1,d&&this.scheduleSending()}},this.sendAllRemaining=function(){var a=!1;if(c){for(var b,f=e,g=[];b=i.shift();)g.push(b),i.length>=f&&(j.push(g),g=[]);g.length>0&&j.push(g),a=j.length>0,d=!1,this.sendAll()}return a}};return f.prototype=new b,a.extend(f.prototype,{layout:new d,threshold:e.DEBUG,defaults:{timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/json"},toString:function(){return"ModelAppender"}}),f});
define("src/core/logger/ConsoleAppender",["underscore","src/core/logger/Appender","src/core/logger/Level","src/core/logger/Layout","src/core/logger/JSONLayout"],function (a,b,c,d,e){var f=function(){};return f.prototype=new b,a.extend(f.prototype,{layout:new e,threshold:c.DEBUG,setLayout:function(a){a instanceof d&&(f.prototype.layout=a)},append:function(a){var b,d=this,e=function(){var b=d.layout.format(a);return"string"==typeof b?[b]:b};if((b=window.console)&&b.log){var f,g=e();f=b.debug&&c.DEBUG.isGreaterOrEqual(a.level)?"debug":b.info&&c.INFO.equals(a.level)?"info":b.warn&&c.WARN.equals(a.level)?"warn":b.error&&a.level.isGreaterOrEqual(c.ERROR)?"error":"log",
b[f].apply?b[f].apply(b,g):b[f](g)}},group:function(a){window.console&&window.console.group&&window.console.group(a)},groupEnd:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},toString:function(){return"ConsoleAppender"}}),f});
define("src/core/logger/LoggingEvent",["underscore"],function (a){var b="\r\n",c=function(a,b,c,d){this.logger=a,this.timeStamp=b,this.level=c,this.messages=d};return a.extend(c.prototype,{getCombinedMessages:function(){return 1===this.messages.length?this.messages[0]:this.messages.join(b)}}),c});
define("src/core/logger/Logger",["src/core/logger/JSONLayout","src/core/logger/Appender","src/core/logger/TopicAppender","src/core/logger/ModelAppender","src/core/logger/ConsoleAppender","src/core/logger/Level","src/core/logger/LoggingEvent","underscore"],function (a,b,c,d,e,f,g,h){var i=function(){function i(h){this.name=h;var i=[],j=f.DEBUG;this.addAppender=function(a){i.push(a)},this.removeAppender=function(a){var b=[],c=[];b=i;for(var d=i.length-1;d>=0;d--)i[d]===a?b.pop():c.push(b.pop());i=c},this.removeAllAppenders=function(){var a=[];for(a=i;i.length>0;)a.pop();i=a};var k=!0;this.setEnabled=function(a){k=a},this.isEnabled=function(){return k},this.log=function(a,b){if(this.isEnabled()&&a.isGreaterOrEqual(this.getLevel())){var c,d=b.length-1,e=b[d];b.length>1&&(c=e,d--);for(var f=[],h=0;h<=d;h++)f[h]=b[h];var i=new g(this,new Date,a,f);this.callAppenders(i)}},this.callAppenders=function(a){for(var b=0,c=i.length;b<c;b++)i[b].doAppend(a)},this.setLevel=function(a){a instanceof f&&(j=a)},this.getLevel=function(){return j},this.group=function(a,b){if(this.isEnabled())for(var c=0,d=i.length;c<d;c++)i[c].group(a,b)},this.groupEnd=function(){if(this.isEnabled())for(var a=0,b=i.length;a<b;a++)i[a].groupEnd()},this.toString=function(){return"Logger["+this.name+"]"},this.Appender=b,this.Level=f,this.LoggingEvent=g,this.JsonLayout=a,this.ConsoleAppender=e,this.ModelAppender=d,this.TopicAppender=c}var j={},k=[];this.getLogger=function(a){if(!j[a]){var b=new i(a);j[a]=b,k.push(a)}return j[a]},h.extend(i.prototype,{trace:function(){this.log(f.TRACE,arguments)},debug:function(){this.log(f.DEBUG,arguments)},info:function(){this.log(f.INFO,arguments)},warn:function(){this.log(f.WARN,arguments)},error:function(){this.log(f.ERROR,arguments)},fatal:function(){this.log(f.FATAL,arguments)},isEnabledFor:function(a){return a.isGreaterOrEqual(this.getLevel())},isTraceEnabled:function(){return this.isEnabledFor(f.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(f.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(f.INFO)},isWarnEnabled:function(){return this.isEnabledFor(f.WARN)},isErrorEnabled:function(){return this.isEnabledFor(f.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(f.FATAL)}})};return i});
define("src/core/application/Bootstrap",["jquery","src/core/util/Utils","src/core/application/Application","src/core/controller/Router"],function (a,b,c,d){var e=function(a){this._init(a),this.init(a),this.createRouter(a),this.createApplication(a),this.postInit(a)};return _.extend(e,{extend:b.extend}),_.extend(e.prototype,{routes:{},modules:[],_init:function(){this.applicationConstructor=c},init:function(){},postInit:function(){},createRouter:function(){this.router=new d({routes:this.routes})},createApplication:function(){new this.applicationConstructor({router:this.router,modules:this.modules})}}),e});
define("src/core/application/ExecutionContext",["underscore","backbone","src/core/util/Utils"],function (a,b,c){var d="$change",e="$subscribe",f=function(a){this.options=a||{},this.modules={},this.createModules(this.options.modules)};return a.extend(f.prototype,c.Factory,{createModules:function(b){a.each(b,function(a,b){this.createModule(b,a.path,a.options)},this)},createModule:function(b,c,d){var e=requirejs(c);return"undefined"==typeof e?null:(this.modules[b]=this.create(a.uniqueId("module_"+b+"_"),e,d),this.modules[b])},getModule:function(a){return this.modules[a]},publish:function(b,c,d){var e=this.getModule(b);if(!e)throw new Error("Module '"+b+"' is not instantiated for use yet.");c=a.pick(c,a.keys(e.get())),e.set(c),d&&e.handleAction(d)},subscribe:function(b,f){var g=function(b,f,g){var h=c.clone(a.omit(b.get(),"subViewModels")),i={action:g,data:h};return g===e?(i.changedAttributes=h,i.prevAttributes={},i.changedAttributes={}):g===d&&(i.changedAttributes=c.clone(f.changed),i.prevAttributes=c.clone(a.omit(f.target.data.previousAttributes(),"subViewModels"))),i},h=this.getModule(b);if(!h)throw new Error("Module '"+b+"' is not instantiated for use yet.");(!f.actions||a.indexOf(f.actions,"change")>-1)&&h.on("change",f.handler,f.context),f.events&&a.each(f.events,function(b,c,d){a.isArray(d)&&(c=b,b=null),b||(b={}),b.handler=b.handler||f.handler,b.context=b.context||f.context,h.on(c,b.handler,b.context)}),f.silent||a.bind(f.handler,f.context)(g(h,{},e))}}),f});
define("src/core/application/ContextProvider",["underscore","src/core/application/ExecutionContext","src/core/util/Utils"],function (a,b,c){var d=function(a){this.options=a||{},this.modelConfigs=this.options.modules||{},this.createdContext={},this.envViewModel=null};return a.extend(d.prototype,c.Factory,{createExecutionContext:function(c){var d;return this.envViewModel||(this.envViewModel=this.createEnvViewModel(this.options.env)),a.isString(c)?this.createExecutionContext([c]):(a.isArray(c)&&(d=this.create(a.uniqueId("module_"),b,{}),a.each(c,function(a){var b=this.modelConfigs[a];if(b){var c=d.createModule(a,b.path,b.option);c.addSubViewModel&&c.addSubViewModel("env",this.envViewModel)}},this)),d)},createEnvViewModel:function(a){}}),d});
define("lightsaber.core",["underscore","backbone","src/core/util/Utils","src/core/resourceBundle/ResourceBundle","src/core/dataSource/DataSource","src/core/dataSource/LocalStorageDataSource","src/core/dataSource/RESTDataSource","businesswidget/repository_l9_common/common/core/ImplLSRESTDataSource","src/core/dataSource/RESTSession","src/core/model/ErrorHandler","src/core/model/Model","src/core/model/RESTModel","src/core/model/Validator","src/core/model/Collection","businesswidget/repository/common/viewmodel/WidgetCoreBaseViewModel","src/core/viewModel/ViewModel","businesswidget/repository/common/viewmodel/WidgetBaseObservableViewModel","src/components/collection/viewmodel/CollectionViewModel","src/core/view/View","src/core/binding/Binding","src/core/application/Application","businesswidget/repository/common/core/BusinessWidget","src/core/hub/BusinessWidgetHub","src/core/controller/Router","src/core/controller/FlowManager","src/core/util/Configuration","businesswidget/repository_l9_common/common/core/ImplStorageUtil","businesswidget/repository/common/util/CustomFormattersContainer","src/core/application/WidgetInternalFlow","src/core/logger/Logger","src/core/application/Bootstrap","src/core/application/ContextProvider"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F){var G={DataSource:e,LocalStorageDataSource:f,RESTDataSource:g,LSRESTDataSource:h,RESTSession:i,ErrorHandler:j,Model:k,RESTModel:l,Collection:n,Validator:m,View:s,BaseViewModel:o,ViewModel:p,ObservableViewModel:q,CollectionViewModel:r,DataBinding:t,Application:u,BusinessWidget:v,BusinessWidgetHub:w,Router:x,FlowManager:y,Utils:c,ResourceBundle:d,Configuration:z,StorageUtil:A,FormattersContainer:B,WidgetInternalFlow:C,Logger:D,Bootstrap:E,ContextProvider:F};return G});
define("src_web/lightsaber.components",["lightsaber.core","src/components/collection/viewmodel/CollectionViewModel","src/components/button/view/BaseButtonView","src/components/button/view/ButtonView","src/components/header/view/HeaderView","src/components/forminput/view/BaseFormElementView","src/components/forminput/view/FormElementTouchpointBaseView","businesswidget/repository/common/view/GenericInputView/GenericInputTextView","src/components/forminput/view/InputTextAreaView","src/components/forminput/view/CheckboxView","src/components/forminput/view/RadioView","src_web/components/forminput/view/SelectView","src_web/components/forminput/view/WebSliderView","src/components/forminput/view/BaseSelectView","src/components/forminput/view/FlipSwitchView","src/components/forminput/view/BooleanView","src/components/forminput/view/FileLoaderView","src/components/searchinput/view/SearchInputViewBase","src/components/searchinput/view/SearchInputView","src/components/itemlist/view/BaseItemListView","src/components/itemlist/view/ItemListView","src/components/itemlist/view/GroupedItemListView","src/components/navbar/viewmodel/NavBarViewModel","src_web/components/navbar/view/NavBarView","src/components/navbar/viewmodel/SubNavBarViewModel","src_web/components/navbar/view/SubNavBarView","src/components/chart/view/ChartView","src_web/components/tabpanel/view/TabPanelView","src/components/proxy/viewmodel/ProxyViewModel","src/components/form/view/FormView","src/components/popup/view/PopupView","src/components/carousel/view/BaseCarouselView","src/components/carousel/view/CarouselView","src_web/components/application/view/Application","src_web/components/application/view/Module","src_web/components/application/view/Navigation","src_web/components/application/view/PopupModule","src/components/pagination/view/BasePaginationView","src/components/pagination/view/PaginationView","src_web/components/ftable/view/TableView","src/components/progressbar/view/ProgressBarView","src_web/components/accordion/view/AccordionView","src/components/autoComplete/view/AutoCompleteView","src_web/components/picker/view/PickerView","src_web/components/breadcrumbs/view/BreadcrumbsView","src/components/application/view/LoadingView","src/components/collectionView/view/CollectionView","src/components/wizard/view/WizardView"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V){return{Core:a,ActionViewModel:a.ViewModel,GroupedCollectionViewModel:b,FormElementViewModel:a.ViewModel,ItemListViewModel:b,TabPanelViewModel:b,CarouselViewModel:b,FragmentModule:I,PageModule:I,BarChartViewModel:a.ViewModel,ChartViewModel:a.ViewModel,SearchInputViewModel:a.ViewModel,ButtonViewModel:a.ViewModel,HeaderViewModel:a.ViewModel,PageViewModel:a.ViewModel,ContainerViewModel:a.ViewModel,PopupViewModel:a.ViewModel,CollectionViewModel:b,BaseButtonView:c,ButtonView:d,HeaderView:e,BaseFormElView:f,BaseFormElementView:g,InputTextView:h,InputTextAreaView:i,CheckboxView:j,RadioView:k,SelectView:l,SliderView:m,BaseSelectView:n,FlipSwitchView:o,BooleanInputView:p,FileLoaderView:q,SearchInputViewBase:r,SearchInputView:s,BaseItemListView:t,ItemListView:u,GroupedItemListView:v,NavBarViewModel:w,NavBarView:x,SubNavBarView:z,SubNavBarViewModel:y,ChartView:A,BarChartView:A,TabPanelView:B,ProxyViewModel:C,FormView:D,PopupView:E,BaseCarouselView:F,CarouselView:G,Application:H,Module:I,Navigation:J,PopupModule:K,BasePaginationView:L,PaginationView:M,TableView:N,ProgressBarView:O,AccordionView:P,AutoCompleteView:Q,PickerView:R,BreadcrumbsView:S,LoadingView:T,CollectionView:U,WizardView:V}});
define("lightsaber",["src_web/lightsaber.components","src/lightsaber.ui","src_web/lightsaber.library","repository.lightsaber.custom","preload.utils","jquery.placeholder"],function (a,b){return a.UI=b,a});
define("businesswidget/repository_l9_common/common/core/Configuration",["businesswidget/repository_l3_common/common/core/Configuration","text!l9_common.repository.config.json"],function (a,b){return a.loadConfiguration(b),a});
define("businesswidget/repository_l9_common/common/utils/ImplCopySessionStorage",["replace","businesswidget/repository_l9_common/common/core/Configuration","lightsaber"],function (a,b,c){a({RepositoryGlobalErrorHandler:"businesswidget/repository_l9_common/common/core/ImplRepositoryGlobalErrorHandler"});var d=function(a){if(a||(a=window.event),a.newValue)if("getSessionStorage"==a.key)window.sessionStorage.length&&window.localStorage.setItem("sessionStorage",JSON.stringify(window.sessionStorage));else if("sessionStorage"!=a.key||window.sessionStorage.length)if("clearSessionStorage"===a.key){if("true"===a.newValue){for(var d=b.get("clearSecureTopicsList"),e=0;e<d.length;e++){var f=d[e];window.sessionStorage.removeItem(f)}window.localStorage.removeItem("clearSessionStorage")}}else"completeLogout"===a.key&&"true"===a.newValue&&(c.Core.BusinessWidgetHub.publish("ImplLogoutActionTopic",{},"logoutOtherTabs"),window.localStorage.removeItem("completeLogout"));else{if(a.newValue){var g=JSON.parse(a.newValue);for(key in g)window.sessionStorage.setItem(key,g[key])}window.localStorage.removeItem("sessionStorage")}};window.addEventListener?window.addEventListener("storage",d,!1):window.attachEvent("onstorage",d),sessionStorage.length&&sessionStorage.getItem("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel")||(window.localStorage.setItem("getSessionStorage",Date.now()),setTimeout(function(){var a=window.localStorage.getItem("sessionStorage");if(a){var b=JSON.parse(a);for(key in b)window.sessionStorage.setItem(key,b[key]);
window.localStorage.removeItem("sessionStorage")}},0))});
define("l9_common.care.custom",["replace","businesswidget/repository_l9_common/common/utils/ImplCopySessionStorage"],function() {});
define("businesswidget/repository_l9_common/common/model/AccountBalanceModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"/billing/customer/:customerId/account/:faId/billing-arrangement/:baId/get-balance",rest:{defaults:{method:"GET"}}},name:c.get("ERROR_CONST").GET_BALANCE})});
define("businesswidget/repository_l9_common/common/model/ImplSingleCallModel",["lightsaber","underscore","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({fetch:function(a){if(this.callToRestRequired())return this.otherPromises||(this.otherPromises=[]),this.restCallPromise=this._super(a),this.restCallPromise.then(b.bind(this.onRestCallSuccess,this),b.bind(this.onRestCallFailure,this)),this.restCallPromise;var c=$.Deferred();return c.then(function(a,b){a.success&&a.success(this,b,a)}.bind(this,a),function(a,b,c){a.error&&a.error(this,b,a)}.bind(this,a)),this.otherPromises.push(c),c},callToRestRequired:function(){return!this.restCallPromise||"pending"!==this.restCallPromise.state()},onRestCallSuccess:function(a,b,c){var d=this.otherPromises.length;if(d)for(var e=0;e<d;e++){var f=this.otherPromises.pop();f.resolve(a)}},onRestCallFailure:function(a,b){var c=this.otherPromises.length;if(c)for(var d=0;d<c;d++){var e=this.otherPromises.pop();e.reject(a,b)}}});return d});
define("businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel",["underscore","businesswidget/repository_l9_common/common/model/ImplSingleCallModel","Configuration"],function (a,b,c){return b.extend({options:{url:"billing/type/:type/id/:id/billing-entity",rest:{read:{method:"GET",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}},name:c.get("ERROR_CONST").BILLING_ENTITY,parse:function(b,d){if(b.ImplBillingAccountDetailsResponse.billingAccountDetails){var e=a.filter(b.ImplBillingAccountDetailsResponse.billingAccountDetails,function(a){return 88!=a.faStatus});b.ImplBillingAccountDetailsResponse.billingAccountDetails=e,a.each(b.ImplBillingAccountDetailsResponse.billingAccountDetails,function(b){b.faid=b.faId,b.deliveryMethod=b.billDeliveryMethod,b.isEasyMobile="Y"==b.easyMobileInd,b.nickName=b.nickName?b.nickName.trim():"Account Name",b.avatarImageId=b.avatarImageId||c.get("DEFAULT_AVATAR_ID"),b.billPassword&&""!==b.billPassword||(b.billPassword="Y"),delete b.easyMobileInd,delete b.faId,delete b.billDeliveryMethod,b.physicalAddress&&b.physicalAddress.city&&(b.physicalAddress.city=b.physicalAddress.city.toUpperCase()),b.subscribers=a.filter(b.subscribers,function(a){return a.subscriberType&&"EQMT"!==a.subscriberType});var d="CASH";"DD"===b.payMeansDetails.paymentMethod?d="GIRO":"CC"===b.payMeansDetails.paymentMethod&&(d="CARD"),b.payMeansDetails.payMeansMode=d}),e=b.ImplBillingAccountDetailsResponse.billingAccountDetails,e=a(e).sortBy(function(a){return["O"===a.baStatus?-1:1,a.nickName]}),b.ImplBillingAccountDetailsResponse.billingAccountDetails=e}return b},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a}})});
define("businesswidget/repository_l9_common/common/model/AccountBillsModel",["lightsaber","Configuration"],function (a,b){return a.Core.RESTModel.extend({options:{url:"customer/:id/accounts/billing-arrangement/:accountsID/get-billsList",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale"),numOfBills:6}}}},name:b.get("ERROR_CONST").BILL_LIST})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel",["underscore","init!lightsaber"],function (a,b){var c=b.Core.ObservableViewModel.extend({initialize:function(){this._super(),this.handleDependencies()},handleDependencies:function(){},empty:function(){for(var a=0;a<this.persistent.length;a++)void 0!==this.get(this.persistent[a])&&(this.set(this.persistent[a],null),console.log("Context Clean: "+this.persistent[a]+" : "+this.get(this.persistent[a])))}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel"],function (a,b,c,d){var e=c.extend({persistent:["ID","customerIds"],defaults:{ID:null,customerIds:null},initialize:function(){this._super(),this.on("change:customerIds",a.bind(this.deleteCookies,this))},deleteCookies:function(){this.get("customerIds")&&(document.cookie="orderValue=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/",document.cookie="orderActions=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/")},subViewModels:{coreCustomerInContextTopicViewModel:d},dataBindings:[{ID:"subViewModels.coreCustomerInContextTopicViewModel.ID",options:{twoWay:!0,setOnBind:!0}}]});return e});
define("businesswidget/repository_l9_common/common/model/AddressModel",["lightsaber","Configuration"],function (a,b){return a.Core.RESTModel.extend({options:{url:"sdp/address/:postalCode",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},name:b.get("ERROR_CONST").RETRIEVE_ADDRESS})});
define("businesswidget/repository_l9_common/common/model/ImplGetDocumentModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/amdd/document/:documentId/getDocument",rest:{defaults:{method:"GET"}}},name:c.get("ERROR_CONST").AMDD_DOC});return d});
define("businesswidget/repository_l9_common/common/model/GetFaidEasyMobileInfoModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/customer/:customerId/billing-accounts",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/addressWidgetViewModel",["knockout","lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/AddressModel","single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel"],function (a,b,c,d,e){return b.Core.ObservableViewModel.extend({persistent:[],models:{AddressModel:d},subViewModels:{individualInContextTopicViewModel:e},dataBindings:[{personId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!0}}],defaults:{postalCode:a.observable("").extend({pattern:{message:"Only numeric value allowed with 6 digits",params:/^(?=.*^(\d){6}$)/},required:!0}),floorAndUnitNotRequired:a.observable(!1),floorNo:a.observable("").extend({required:!1}),streetName:a.observable("").extend({required:!0}),houseNo:a.observable("").extend({required:!0}),unitNo:a.observable("").extend({required:!1}),SDPResponse:"",buildingName:"",postalCodeChangeIndicator:!1,flag:!1,errors:""},config:{actions:{retrieveAddress:function(){this.set("postalCodeChangeIndicator",!1),this.getAddress()}}},getAddress:function(){null==this.get("postalCode",!0).error()&&(this.models.AddressModel.set({postalCode:this.get("postalCode")}),this.models.AddressModel.fetch({success:c.bind(this._onRetrieveAddressSuccess,this),error:c.bind(this._onRetrieveAddressError,this)}))},_onRetrieveAddressError:function(a,b){if(b.responseText){var c=JSON.parse(b.responseText),d=c&&c.ErrorInfo&&c.ErrorInfo.backendErrorInfo;if(d){var e=d.split(":"),f=e[1].split(";");this.get("postalCode",!0).setError(f[1]||f[0])}}else if(b.statusText)return this.get("postalCode",!0).setError(b.statusText),!0},_onRetrieveAddressSuccess:function(a,b){var c=b.ImplSearchAddressResponse.geographicAddress[0];this.get("postalCode")===c.postCode&&(this.set("SDPResponse",b.ImplSearchAddressResponse.geographicAddress),this.get("postalCodeChangeIndicator")?this.checkUnitFloorNoIsValid():(this.set("streetName",c.streetName),this.set("houseNo",c.blockOrHouseNum),this.set("postalCode",c.postCode),this.set("floorNo",c.floor),this.set("unitNo",c.apartment),this.set("postalCodeChangeIndicator",!1)))},initialize:function(){c.bindAll(this,"checkUnitFloorNoIsValid","checkHouse_Block","showUnitFloorErrors"),this.set("errors",a.validation.group(this,{deep:!0})),this.set("postalCodeChangeIndicator",!0),this.get("floorAndUnitNotRequired",!0).subscribe(this._floorAndUnitNotRequiredChanged,this)},showUnitFloorErrors:function(){var a=this.get("SDPResponse");this.get("flag")||(this.get("floorNo")!=a[0].floor&&this.get("floorNo",!0).setError("please enter valid floor  no"),this.get("unitNo")!=a[0].room&&this.get("unitNo",!0).setError("please enter valid unit no"))},checkUnitFloorNoIsValid:function(){var a=this.get("SDPResponse");if(this.set("flag",!1),""!=a){if(this.get("postalCode")==a[0].postalCode){for(var b=0;b<a.length;b++)if(this.get("floorNo")==a[b].floor&&this.get("unitNo")==a[b].room)return this.set("flag",!0),!0;this.showUnitFloorErrors()}}else this.getAddress()},checkHouse_Block:function(){},_floorAndUnitNotRequiredChanged:function(a){a&&(this.set("floorNo",""),this.set("unitNo",""))}})});
define("businesswidget/repository_l9_common/common/model/EbillRegistrationPopUpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"ebill/contact-person/:contactId/registration-popup",rest:{read:{method:"GET"},create:{method:"POST",payload:["ImplEbillPopUpUserSelection"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel"],function (a,b,c,d){var e=c.extend({persistent:["barId","faId","accountName"],defaults:{barId:null,faId:null,accountName:null},subViewModels:{customerInContextTopicViewModel:d},handleDependencies:function(){this.subViewModels.customerInContextTopicViewModel.on("change:ID",a.bind(this.empty,this))}});return e});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["ID"],defaults:{ID:null}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["userId","nickName","nric","customerIdType","status","email","billPayer","familyName","newcustomer","mobileSubscriber","GTMUserData","isWorryFreeLogin","isWorryFreeFaVerfied"],defaults:{userId:null,nickName:"",nric:null,customerIdType:"",status:"",email:"",billPayer:"",GTMUserData:null,familyName:"",newcustomer:!1,mobile:null,broadband:null,tv:null,mobileSubscriber:null,isWorryFreeLogin:!1,isWorryFreeFaVerfied:!1},subViewModels:{}});return d});
define("businesswidget/repository_l9_common/common/model/UnbilledUsageSubscriberAccModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){
var d=b.extend({options:{url:"ebill/customer/:customerId/subscription/:subscriptionId/unbilled-usage-accumulators",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},name:c.get("ERROR_CONST").USAGE_ACCUMULATOR_VOICE,parse:function(a,b){return a.UnbilledUsageAccumulators.accumulators&&(a.UnbilledUsageAccumulators.accumulators=_.filter(a.UnbilledUsageAccumulators.accumulators,function(a){return"INTERNATIONAL"!==a.businessCategoryX8}),_.each(a.UnbilledUsageAccumulators.accumulators,function(a){"SINGTELWIFI"==a.businessCategoryX8&&(a.category="SINGTELWIFI",delete a.businessCategoryX8),"ROAMING"==a.businessCategoryX8?a.planTypeX8="Roaming":a.planTypeX8="Local"})),a}});return d});
define("businesswidget/repository_l9_common/common/model/UnbilledUsageAccumulatorsDataModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"ebill/customer/:customerId/subscription/:subscriptionId/unbilled-data-usage-accumulators",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},parse:function(a){var b=_.groupBy(a.UnbilledUsageAccumulators.accumulators,function(a){return"SECONDS"===a.unitOfMeasurement?"SECONDS":"OTHERS"});if(b.OTHERS&&(a.UnbilledUsageAccumulators.accumulators=b.OTHERS),b.SECONDS){var c=a.UnbilledUsageAccumulators.bonusDataUsageX8||[];a.UnbilledUsageAccumulators.bonusDataUsageX8=b.SECONDS.concat(c)}return a},name:c.get("ERROR_CONST").USAGE_ACCUMULATOR_DATA});return d});
define("businesswidget/repository_l9_common/common/model/GetDataUsageModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"dqms/get-data-usage",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}},parse:function(a){return _.each(a.ImplDQMSGetDataUsageOutput&&a.ImplDQMSGetDataUsageOutput.implSupplementaryLineUsage,function(a){a.originalPlanLimit=(a.planLimit/1073741824).toFixed(2)-0,a.planLimit=(a.planLimit/1073741824).toFixed(2)-0,a.toggle=a.planLimit>0,a.name=a.planName,a.usageRate2&&(a.timeVolumeX8=a.usageRate2),a.usageUnit||(a.usageUnit=2)}),_.each(a.ImplDQMSGetDataUsageOutput&&a.ImplDQMSGetDataUsageOutput.implDataUsage,function(a){a.usageType="DATA",a.name=a.planName,a.usageRate2&&(a.timeVolumeX8=a.usageRate2)}),_.each(a.ImplDQMSGetDataUsageOutput&&a.ImplDQMSGetDataUsageOutput.implDataStacking,function(a){a.usageUnit||(a.usageUnit=2)}),_.each(a.ImplDQMSGetDataUsageOutput&&a.ImplDQMSGetDataUsageOutput.implBonusDataUsage,function(a){a.usageType="DATA",a.planLimit=a.entitlement,a.name=a.planName,a.usageRate2&&(a.timeVolumeX8=a.usageRate2)}),_.each(a.ImplDQMSGetDataUsageOutput&&a.ImplDQMSGetDataUsageOutput.implFreeDayData,function(a){a.usageType="DATA",a.name=a.planName,a.priceSchemaID=a.planId.toString(),a.usageUnit||(a.usageUnit=2),a.usageRate2&&(a.timeVolumeX8=a.usageRate2)}),a}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/DqmsUnbilledDataUsageViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/GetDataUsageModel","Configuration"],function (a,b,c,d){var e=a.Core.ObservableViewModel.extend({models:{getDataUsageModel:c},subViewModels:{},dataBindings:[],defaults:{unbilledUsageVmStatus:"",aemConfigData:null},initialize:function(a){b.bindAll(this,"getDqmsDataUsage","getDataUsageSuccess","mapDataAccumulator","calculateUtilizedQuotaPercentage","setUnitBasedProperties","setAccumulatorProperties","filterAccumulators","mapUsageData"),this.set("unbilledUsageVmStatus","usageDataVmInitialized")},getDqmsDataUsage:function(a,c,d,e,f){var g={msisdn:a,planId:e,subscriberID:c},h=$.Deferred();return this.models.getDataUsageModel.save({ImplDQMSInput:g},{success:b.bind(this.getDataUsageSuccess,this,h,a,c,f,d),error:function(a){return function(b){a.resolve(null)}}(h)}),h},getDataUsageSuccess:function(a,b,c,d,e,f,g){var h,g=g.ImplDQMSGetDataUsageOutput;if(g&&1===g.responseCode){var i=g.implDataUsage,j=g.implSupplementaryLineUsage||[],k=g.implBonusDataUsage||[],l=g.implFreeDayData||[],m=g.implDataStacking||[],n=[],c=c.toString();i&&i.length>0&&(n=this.mapDataAccumulator(i,c,d,n)),k&&k.length>0&&(k=this.mapUsageData(k,!1)),j&&j.length>0&&(j=this.mapUsageData(j,!1)),m&&m.length>0&&(m=this.mapUsageData(m,!0)),l&&l.length>0&&(n=this.mapDataAccumulator(l,c,d,n)),h={accumulators:n,bonusDataUsage:k,supplementaryLineUsage:j,sponsoredData:m,freeDayData:l}}a.resolve(c,e,h)},mapDataAccumulator:function(a,c,e,f){var g=this.get("aemConfigData"),h=g.basePlansList.split(","),i=d.get("dataAccumulator").planType,j=g.dataInfinityXLiteList.split(",");return b.each(a,function(a){a.planTypeX8=i[a.planType]?i[a.planType]:"Roaming",this.setUnitBasedProperties(a);var d=this.filterAccumulators(c,e,a);b.contains(h,a.priceSchemaID)&&d&&f.push(a),b.contains(j,a.priceSchemaID)&&d&&(a.isAddon=!0,f.push(a))}.bind(this)),f},filterAccumulators:function(a,b,c){return c.chNodeId==b||c.subscriberID==a},mapUsageData:function(a,c){var e=d.get("dataAccumulator").planType;return b.each(a,function(a){a.planTypeX8=e[a.planType]?e[a.planType]:"Roaming",this.setUnitBasedProperties(a,c)}.bind(this)),a},setUnitBasedProperties:function(a,b){var c,e=d.get("dataAccumulator").usageUnit;switch(a.usageUnit){case 1:c=100,this.setAccumulatorProperties(a,e[a.usageUnit],c,b);break;case 2:case 3:case 5:case 6:c=1048576,this.setAccumulatorProperties(a,e[a.usageUnit],c,b);break;case 4:c=1,this.setAccumulatorProperties(a,e[a.usageUnit],c,b)}},setAccumulatorProperties:function(a,b,c,d){a.quota=0,a.type="RATE",a.planLimit?(a.quota=Number(a.planLimit/c),a.type="ALLOWANCE"):d&&(a.quota=31457281,a.type="ALLOWANCE"),a.unitOfMeasurement=b,a.volume=a.usage?Number(a.usage/c):0,a.utilizedQuotaPercentage=this.calculateUtilizedQuotaPercentage(a)},calculateUtilizedQuotaPercentage:function(a){var b=0;return a.volume&&a.quota&&a.quota>0&&(b=Number(Math.round(100*a.volume/a.quota))),b}});return e});
define("businesswidget/repository_l9_common/common/viewmodel/business/UnbilledUsageViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/UnbilledUsageSubscriberAccModel","businesswidget/repository_l9_common/common/model/UnbilledUsageAccumulatorsDataModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/business/DqmsUnbilledDataUsageViewModel","moment"],function (a,b,c,d,e,f,g,h){var i=a.Core.ObservableViewModel.extend({models:{UnbilledUsageSubscriberAccModel:c,UnbilledUsageAccumulatorsDataModel:d},subViewModels:{customerInContextTopicViewModel:e,dqmsUnbilledDataUsageViewModel:g},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{unbilledUsageVmStatus:"",unbilledUsageDataMap:{},currentUnbilledUsageData:"",unbilledUsageSummary:{},dataInfinityXLiteList:null,unbilledUsagePlansList:null,sponsoredCrOn:null},initialize:function(a){b.bindAll(this,"getUnbilledUsageDetails","onUsageSubscriberActSuccess","onUnbilledUsageDataSuccess","getTotalSponsoredDataUsage","processDqmsObj"),this.set("unbilledUsageVmStatus","usageDataVmInitialized")},getUnbilledUsageDetails:function(a,c,d,e,f,g){var h=$.Deferred();this.set("unbilledUsageVmStatus","usageDataLoading");var i=this.get("unbilledUsageDataMap");i[a]&&(i[a]=null,this.set("unbilledUsageDataMap",i));var j=$.Deferred();if(this.models.UnbilledUsageSubscriberAccModel.fetch({customerId:c,subscriptionId:a,success:b.bind(this.onUsageSubscriberActSuccess,this,a,f,c,j),error:function(a){return function(b){a.resolve(null)}}(j)}),this.get("sponsoredCrOn")){var k=this.subViewModels.dqmsUnbilledDataUsageViewModel,l={basePlansList:this.get("unbilledUsagePlansList"),dataInfinityXLiteList:this.get("dataInfinityXLiteList")};k.set("aemConfigData",l);var m=k.getDqmsDataUsage(e,a,c,g,f)}else{var m=$.Deferred();this.models.UnbilledUsageAccumulatorsDataModel.setQueryParams({serviceId:e}),this.getModel("UnbilledUsageAccumulatorsDataModel").fetch({customerId:c,subscriptionId:a,success:b.bind(this.onUnbilledUsageDataSuccess,this,a,f,c,m),error:function(a){return function(b){a.resolve(null)}}(m)})}return $.when.call(this,j,m).done(function(a,b){if(b&&a){this.get("sponsoredCrOn")&&this.processDqmsObj(b),this.calculateUnbilledUsageSummary(a[0]),console.log(a),console.log(b),this.set("unbilledUsageVmStatus","usageDataLoaded");var c=a[0],d=a[0],e=this.get("unbilledUsageSummary");return h.resolve(e[c],c,d)}return h.resolve(null)}.bind(this)),h},processDqmsObj:function(a){var c=this.get("unbilledUsageDataMap"),d=a[0],a=a[2];if(a){if(a.accumulators.length>0)if(c[d]){var e=this.addToAccumulator(a.accumulators);b.each(e,function(a,b){c=this.mergeUsageType(c,a,b,d)}.bind(this))}else c[d]={},c[d]=this.addToAccumulator(a.accumulators);if(a.bonusDataUsage.length>0){var f=this.createLRMap(a.bonusDataUsage);b.each(f,function(a,b){c[d][b].bonusDataUsage=new Object(a)})}if(a.supplementaryLineUsage.length>0&&(c[d].supplementaryLineUsage=a.supplementaryLineUsage),a.sponsoredData.length>0){var g=this.createLRMap(a.sponsoredData);b.each(g,function(a,b){c[d][b].sponsoredData=new Object(a)})}a.freeDayData.length>0&&(c[d].freeDayData=a.freeDayData),this.set("unbilledUsageDataMap",c),this.set("currentUnbilledUsageData",c[d])}},onUsageSubscriberActSuccess:function(a,c,d,e,f,g){var h=this,g=this.filterResponse(a,c,g),i=this.get("unbilledUsageDataMap"),a=a.toString();if(i[a]){var j=this.addToAccumulator(g.UnbilledUsageAccumulators.accumulators);b.each(j,function(b,c){i=h.mergeUsageType(i,b,c,a)})}else i[a]={},i[a]=this.addToAccumulator(g.UnbilledUsageAccumulators.accumulators);i[a].cycleStartDate=g.UnbilledUsageAccumulators.cycleStartDate,i[a].daysToNextBill=g.UnbilledUsageAccumulators.daysToNextBill,i[a].cycleEndDate=g.UnbilledUsageAccumulators.cycleEndDate,this.set("unbilledUsageDataMap",i),this.set("currentUnbilledUsageData",i[a]),e.resolve(a,d,i[a])},filterResponse:function(a,c,d){if(d.UnbilledUsageAccumulators&&d.UnbilledUsageAccumulators.accumulators){var e=b.filter(d.UnbilledUsageAccumulators.accumulators,function(b){return b.chNodeId==c||b.subscriptionId==a});d.UnbilledUsageAccumulators.accumulators=e}return d},addToAccumulator:function(a){var c={};return b.each(a,function(a){c[a.planTypeX8]={}}),b.each(a,function(a){var b=[];c[a.planTypeX8][a.usageType]&&(b=c[a.planTypeX8][a.usageType]?c[a.planTypeX8][a.usageType]:[]),b.push(a),c[a.planTypeX8][a.usageType]=b}),c},createLRMap:function(a){var c={};return b.each(a,function(a){c[a.planTypeX8]=[]}),b.each(a,function(a){var b=[];c[a.planTypeX8]&&(b=c[a.planTypeX8]?c[a.planTypeX8]:[]),b.push(a),c[a.planTypeX8]=b}),c},onUnbilledUsageDataSuccess:function(a,c,d,e,g,h){var i=this,h=this.filterResponse(a,c,h),j=this.get("unbilledUsageDataMap"),k=f.get("USAGE_INFINITY");if(k.DATA_INFITNITY_XLITE_FLAG&&h.UnbilledUsageAccumulators.accumulators&&h.UnbilledUsageAccumulators.allAccumulators){var l=[],m=i.get("dataInfinityXLiteList").split(",");b.each(h.UnbilledUsageAccumulators.allAccumulators,function(a){b.each(m,function(b){b==a.priceSchemaID&&(a.isAddon=!0,l.push(a))})}),h.UnbilledUsageAccumulators.accumulators=h.UnbilledUsageAccumulators.accumulators.concat(l)}var a=a.toString();if(j[a]){var n=this.addToAccumulator(h.UnbilledUsageAccumulators.accumulators);b.each(n,function(b,c){j=i.mergeUsageType(j,b,c,a)})}else j[a]={},j[a]=this.addToAccumulator(h.UnbilledUsageAccumulators.accumulators);if(h.UnbilledUsageAccumulators.bonusDataUsageX8){var o=i.createLRMap(h.UnbilledUsageAccumulators.bonusDataUsageX8);b.each(o,function(b,c){j[a][c].bonusDataUsage=new Object(b)})}j[a].supplementaryLineUsage=h.UnbilledUsageAccumulators.supplementaryLineUsageX8,this.set("unbilledUsageDataMap",j),this.set("currentUnbilledUsageData",j[a]),e.resolve(a,d,j[a])},mergeUsageType:function(a,c,d,e){return a[e][d]?b.each(c,function(c,f){a[e][d][f]?b.each(c,function(b,c){a[e][d][f].push(b)}):a[e][d][f]=c}):a[e][d]=c,a},calculateUnbilledUsageSummary:function(a){var c=this,d=f.get("USAGE_INFINITY"),e=this.get("unbilledUsageSummary");e[a]={};var g=this.get("unbilledUsageDataMap");b.each(g[a],function(b,f){"supplementaryLineUsage"==f?e[a][f]=b:"object"==typeof b?e[a][f]=d.ASPIRE_FLAG?c.sumAllUsageType(f,b)[f]:c.sumAllUnbilledUsageType(f,b)[f]:e[a][f]=b}),this.set("unbilledUsageSummary",e)},sumAllUnbilledUsageType:function(a,c){var d=this,e=f.get("USAGE_INFINITY"),g={},h=!1,i=this.get("dataInfinityXLiteList").split(",");return g[a]={},b.each(c,function(c,f){if(g[a][f]={},e.DATA_INFITNITY_XLITE_FLAG&&"Local"==a&&"DATA"==f){var j=b.find(c,function(a){if(i&&i.indexOf(a.priceSchemaID)>-1)return a}),k=b.find(c,function(a){return 3e3==a.priceSchemaID});j&&k&&(j.volume=j.volume-k.volume,j.utilizedQuotaPercentage=Math.floor(100*j.volume/k.quota),h=!0)}if(e.ASPIRE_FLAG||"Local"!=a||"DATA"!=f&&"bonusDataUsage"!=f||(g[a].combinedLocalUsage||(g[a].combinedLocalUsage=[]),g[a].combinedLocalUsage=d.getTotalLocalDataUsage(a,c,f,g[a].combinedLocalUsage,h)),d.get("sponsoredCrOn")&&"sponsoredData"===f&&(g[a].combinedSponsoredUsage||(g[a].combinedSponsoredUsage=[]),g[a].combinedSponsoredUsage=d.getTotalSponsoredDataUsage(a,c,f,g[a].combinedSponsoredUsage)),"bonusDataUsage"!==f&&"sponsoredData"!==f)if("Roaming"==a&&"DATA"==f)g[a][f]=[],b.each(c,function(b){var c=d.measurementUnitConversion(b.unitOfMeasurement,b.quota);"SGD"==c?g[a].payForUse?g[a].payForUse.push(b):(g[a].payForUse=[],g[a].payForUse.push(b)):g[a][f].push(b)});else if("Local"==a&&"DATA"==f)g[a][f]=[],b.each(c,function(h){var i=d.measurementUnitConversion(h.unitOfMeasurement,h.quota);if(e.ASPIRE_FLAG&&"DATA"==f&&h[e.FIELD_NAME]==e.INFINITY_PLAN_ID){var j=b.find(c,function(a){return a[e.FIELD_NAME]==e.BASE_PLAN_ID});j&&(h.volume=h.volume-j.volume,g[a].infinity=[h])}else"SINGTELWIFI"==h.category?g[a].singtelWifi?g[a].singtelWifi.push(h):(g[a].singtelWifi=[],g[a].singtelWifi.push(h)):"SGD"==i?g[a].payForUse?g[a].payForUse.push(h):(g[a].payForUse=[],g[a].payForUse.push(h)):h[e.FIELD_NAME]==e.INFINITY_PLAN_ID||g[a][f].push(h)});else{g[a][f].noOfUnits=c.length,g[a][f].quota=0,g[a][f].utilizedQuotaPercentage=0,g[a][f].remainingQuota=0,g[a][f].volume=0,g[a][f].subscriptionId=0,g[a][f].usageType=f;var l=0;b.each(c,function(b){var c=d.measurementUnitConversion(b.unitOfMeasurement,b.quota);g[a][f].quota+=c,"ALLOWANCE"==b.type&&(l+=b.volume),g[a][f].volume+=b.volume,g[a][f].subscriptionId=b.subscriptionId,"DATA"==g[a][f].usageType?g[a][f].unitOfMeasurement="MBYTES":"VOICE"==g[a][f].usageType?g[a][f].unitOfMeasurement="MINUTES":g[a][f].unitOfMeasurement="MESSAGING","RATE"==b.type&&(g[a][f].RATE=b)}),g[a][f].remainingQuota=g[a][f].quota-l,g[a][f].utilizedQuotaPercentage=d.calulateRemaingAndPercentageUsage(g[a][f].quota,g[a][f].volume)}else g[a][f]=c}),g},sumAllUsageType:function(a,c){var d=this,e={};return e[a]={},b.each(c,function(c,g){if("bonusDataUsage"!==g)if(e[a][g]={},"Roaming"==a&&"DATA"==g)e[a][g]=[],b.each(c,function(b){var c=d.measurementUnitConversion(b.unitOfMeasurement,b.quota);"SGD"==c?e[a].payForUse?e[a].payForUse.push(b):(e[a].payForUse=[],e[a].payForUse.push(b)):e[a][g].push(b)});else{e[a][g].noOfUnits=c.length,e[a][g].quota=0,e[a][g].utilizedQuotaPercentage=0,e[a][g].remainingQuota=0,e[a][g].volume=0,e[a][g].subscriptionId=0,e[a][g].usageType=g;var h=0;b.each(c,function(i){var j=d.measurementUnitConversion(i.unitOfMeasurement,i.quota),k=f.get("USAGE_INFINITY");e[a].ASPIRE_FLAG=!0;var k=f.get("USAGE_INFINITY");if(e[a].ASPIRE_FLAG=!0,"DATA"==g&&i[k.FIELD_NAME]==k.INFINITY_PLAN_ID){var l=b.find(c,function(a){return a[k.FIELD_NAME]==k.BASE_PLAN_ID});l&&(i.volume=i.volume-l.volume,e[a].infinity=[i])}else"SINGTELWIFI"==i.category?e[a].singtelWifi?e[a].singtelWifi.push(i):(e[a].singtelWifi=[],e[a].singtelWifi.push(i)):"SGD"==j?e[a].payForUse?e[a].payForUse.push(i):(e[a].payForUse=[],e[a].payForUse.push(i)):(e[a][g].quota+=j,"ALLOWANCE"==i.type&&(h+=i.volume),e[a][g].volume+=i.volume,e[a][g].subscriptionId=i.subscriptionId,"DATA"==e[a][g].usageType?e[a][g].unitOfMeasurement="MBYTES":"VOICE"==e[a][g].usageType?e[a][g].unitOfMeasurement="MINUTES":e[a][g].unitOfMeasurement="MESSAGING","RATE"==i.type&&(e[a][g].RATE=i))}),e[a][g].remainingQuota=e[a][g].quota-h,e[a][g].utilizedQuotaPercentage=d.calulateRemaingAndPercentageUsage(e[a][g].quota,e[a][g].volume)}else e[a][g]=c}),e},getTotalLocalDataUsage:function(a,c,d,e,g){var h=f.get("USAGE_INFINITY");if("DATA"==d){var i=b.find(c,function(a){return a[h.FIELD_NAME]==h.INFINITY_PLAN_ID}),j=b.find(c,function(a){return a[h.FIELD_NAME]==h.BASE_PLAN_ID});i&&j&&(i.volume=i.volume-j.volume,i.utilizedQuotaPercentage=Math.floor(100*i.volume/i.quota),c=b.filter(c,function(a){return a[h.FIELD_NAME]!=h.BASE_PLAN_ID}))}var k=this.getDefaultDataObject(c);if(e&&b.isNumber(e.volume)){var l={volume:e.volume+k.volume,quota:e.quota+k.quota,usageType:"DATA",isXLiteAddonPresent:g};return l.utilizedQuotaPercentage=Math.floor(100*l.volume/l.quota),l}return k.isXLiteAddonPresent=g,k},getTotalSponsoredDataUsage:function(a,c,d,e){var f=this.getDefaultDataObject(c),g=b.sortBy(c,function(a){var b=h(a.expiryDate,"dd-MMM-yyyy HH:mm").unix();return-b}.bind(this))[0];return f.expiryDate=g.expiryDate,f},getDefaultDataObject:function(a){var c=this,d=["GBYTES","KBYTES","BYTES","MBYTES"];a=b.filter(a,function(a){if(b.contains(d,a.unitOfMeasurement))return 0===a.quota?a:a.quota=c.measurementUnitConversion(a.unitOfMeasurement,a.quota)});var e={volume:b.reduce(a,function(a,b){return b.volume+a},0),quota:b.reduce(a,function(a,b){return b.quota+a},0),usageType:"DATA",isXLiteAddonPresent:!1};return e.utilizedQuotaPercentage=Math.floor(100*e.volume/e.quota),e},measurementUnitConversion:function(a,b){return"BYTES"==a?1024*b*1024:"KBYTES"==a?1024*b:"GBYTES"==a?b/1024:"SECONDS"==a?60*b:"SGDX8"==a?"SGD":b},calulateRemaingAndPercentageUsage:function(a,b){return 0===a&&(a=1),b/a*100}});return i});
define("businesswidget/repository_l9_common/common/model/UpdateDeliveryMethodModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/billing/customer/:customerId/account/:faId/billing-arrangement/:barId/updateDeliveryMethod",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplBillingDataInput"]}}},name:b.get("ERROR_CONST").UPDATE_DELIVERY})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel"],function (a,b,c,d){var e=c.extend({persistent:["userInfo","permissions"],defaults:{userInfo:null,permissions:null},subViewModels:{contactInContextTopicViewModel:d},dataBindings:[],handleDependencies:function(){this.subViewModels.contactInContextTopicViewModel.on("change:ID",a.bind(this.empty,this))}});return e});
define("businesswidget/repository_l9_common/common/model/UpdateBillingAddressModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/billing/billing-arrangement/:billingArrangementId/updateContactForBillingArrangement/",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplContactRoleBillArrangemntUpdateRequest"]}}},name:b.get("ERROR_CONST").UPDATE_BILLING_ADDRESS})});
define("businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/AccountBalanceModel","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","businesswidget/repository_l9_common/common/model/AccountBillsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","businesswidget/repository_l9_common/common/model/AddressModel","businesswidget/repository_l9_common/common/model/ImplGetDocumentModel","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/model/GetFaidEasyMobileInfoModel","single!businesswidget/repository_l9_common/common/viewmodel/addressWidgetViewModel","businesswidget/repository_l9_common/common/model/EbillRegistrationPopUpModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UnbilledUsageViewModel","businesswidget/repository_l9_common/common/model/UpdateDeliveryMethodModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateBillingAddressModel","Configuration"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){return a.Core.ObservableViewModel.extend({models:{AccountBalanceModel:c,AccountBillsModel:e,GetBillingAccountDetailedListModel:d,AddressModel:g,ImplGetDocumentModel:h,getFaidEasyMobileInfoModel:j,ebillRegistrationPopUpModel:l,updateDeliveryMethod:q,updateBillingAddressModel:s},subViewModels:{customerInContextTopicViewModel:f,addressWidgetViewModel:k,accountInContextTopicViewModel:m,contactInContextTopicViewModel:n,onePassTopicViewModel:o,UnbilledUsageViewModel:p,implUserContextTopicViewModel:r},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{type:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{selectedAccount:"subViewModels.accountInContextTopicViewModel.faId",options:{twoWay:!0,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{miniDesign:!1,customerId:null,contactId:null,barId:null,nric:null,type:null,selectedAccount:null,physicalAddress:"",billingAccountSummaryVmStatus:"",accounts:[],barNameValue:"",selectedAvatar:"",nickName:"",reasons:null,isCheked:!1,selectedReason:"",currentAccount:"",isGetBalance:!1,isGetBillsList:!1,includeLob:null,excludeLob:null,dateFormat:function(a){return i.getDateString(parseInt(a),!1,2)},byteArray:"",pdfBillNumber:"",CIAmts:[],CIErrorDetails:"",pdfDetails:null},accountsSetDeferred:$.Deferred(),initialize:function(){this._super(),b.bindAll(this,"initializeOtherWidgets","displayError","getCustomerType","getChangesAttributeFlag"),this.on("change:nric",this.fetchData,this),this.on("change:selectedAccount",this.setBarId,this),this.on("change:accounts",this.setBarId,this)},setBarId:function(){var a=this.get("selectedAccount"),c=this.get("accounts");a&&c&&b.find(c,function(b){if(b.faid===a)return this.subViewModels.accountInContextTopicViewModel.set("barId",b.billingAccountNumber),!0}.bind(this))},fetchData:function(a){var c=this.getCustomerType(this.subViewModels.onePassTopicViewModel.get("customerIdType"));return this.models.GetBillingAccountDetailedListModel.set("type",c),this.models.GetBillingAccountDetailedListModel.fetch({id:this.get("nric"),success:b.bind(this.BillingAccountDetailedListSuccess,this),error:b.bind(this.onAccountLoadFailure,this)}).then(function(a){this.accountsSetDeferred.resolve(this.get("accounts"))}.bind(this))},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a},onAccountLoadFailure:function(){this.set("billingAccountSummaryVmStatus","accountsFailed")},initializeOtherWidgets:function(){this.subViewModels.addressWidgetViewModel.on("saveChanges",this.saveData,this),this.trigger("loadAddressWidget")},getBillingPreferenceReasonSuccess:function(a,b){this.set("reasons",b.ImplEbillPopUpUserSelection)},saveData:function(){var a=this.subViewModels.addressWidgetViewModel;a.get("postalCode",!0).error()||a.get("unitNo",!0).error()||a.get("floorNo",!0).error()?this.displayError():this._updateCustomerData()},displayError:function(){0!=this.get("errors")().length&&this.get("errors").showAllMessages(!0)},updateAccountAddress:function(){var a=this.get("selectedAccount"),c=this.get("accounts"),d=b.find(c,function(b){return b.faid===a});d.acountUpdatesStatus="updateBilllingAddressRequested",this.get("accounts",c);var e=this.getUpdateAddressPayload(d);this.models.updateBillingAddressModel.setQueryParams({faid:d.faid});this.models.updateBillingAddressModel.save({billingArrangementId:d.billingAccountNumber,ImplContactRoleBillArrangemntUpdateRequest:e},{success:b.bind(this.onUpdateBillingAdressSuccess,this),error:b.bind(this.onUpdateBillingAdressFailure,this)})},onUpdateBillingAdressSuccess:function(a,c){var d=this.get("accounts"),e=a.get("billingArrangementId"),f=b.find(d,function(a){return a.billingAccountNumber===e}),g=a.get("ImplContactRoleBillArrangemntUpdateRequest").implPhysicalAddress;f.physicalAddress=g,f.physicalAddress.houseNumber=g.blockOrHouseNum,f.acountUpdatesStatus="updateBillingAddressSuccess",this.set("accounts",d)},onUpdateBillingAdressFailure:function(a,c){var d=this.get("accounts"),e=a.get("billingArrangementId"),f=b.find(d,function(a){return a.billingAccountNumber===e});f.acountUpdatesStatus="updateBillingAddressFailed",this.set("accounts",d),this.set("billingAccountSummaryVmStatus","error")},getUpdateAddressPayload:function(a){var b=a.newAddress,c={contactRoleName:"Primary",billingArrangementId:a.billingAccountNumber,implPhysicalAddress:{apartment:b.unitNo,blockOrHouseNum:b.blockOrHouseNum,room:b.blockOrHouseNum,buildingName:b.buildingName,floor:b.floorNo,postcode:b.postCode,unitNumber:b.unitNo,streetName:b.streetName,country:"SGP",state:"SNG",countryCode:"65"}};return t.get("IS_BLOCKORHOUSEADDR")&&(c.implPhysicalAddress.blockOrHouseAddr=b.blockOrHouseAddr||""),c},filterSubscriptions:function(a){var c=this.get("includeLob"),d=this.get("excludeLob");return c?b.each(a.ImplBillingAccountDetailsResponse.billingAccountDetails,function(a){a.subscribers=b.filter(a.subscribers,function(a){return c.indexOf(a.subscriberType)!==-1})}):d&&b.each(a.ImplBillingAccountDetailsResponse.billingAccountDetails,function(a){a.subscribers=b.filter(a.subscribers,function(a){return d.indexOf(a.subscriberType)===-1})}),a},BillingAccountDetailedListSuccess:function(a,c){c=this.filterSubscriptions(c);var d=this,e=c.ImplBillingAccountDetailsResponse.billingAccountDetails,f=b.find(e,function(a){return a.paInd}),g=this.subViewModels.implUserContextTopicViewModel.get("permissions");f&&!g.contactPermissions.ipa&&(g.contactPermissions.ipa=!0,setTimeout(function(){d.subViewModels.implUserContextTopicViewModel.set("permissions",g)},0));var h=[];e&&e.length&&(this.set("accounts",e),this.set("billingAccountSummaryVmStatus","accountsLoaded"),b.each(e,function(a){d.get("isGetBalance")&&h.push(d.models.AccountBalanceModel.fetch({customerId:a.customerId,faId:a.faid,baId:a.billingAccountNumber,success:b.bind(d.configureAccountBalance,d,a.faid),error:b.bind(d.onFailureAccountBalance,d,a.faid)})),d.get("isGetBillsList")&&h.push(d.models.AccountBillsModel.fetch({id:a.customerId,accountsID:a.billingAccountNumber,success:b.bind(d.configureAccountBillingList,d,a.billingAccountNumber)}))})),$.when.apply(null,h).done(function(){d.set("billingAccountSummaryVmStatus","accountsFaidSet")})},configureAccountBalance:function(a,c,d){var e=this.get("accounts");b.each(e,function(b){d.ImplAccountBalanceRestOutput.accountId==a&&b.faid==a&&(b.balanceAmount=d.ImplAccountBalanceRestOutput.balanceAmount,b.amountToPay=d.ImplAccountBalanceRestOutput.balanceAmount,b.dueDate=d.ImplAccountBalanceRestOutput.dueDate)}),this.set("accounts",e)},onFailureAccountBalance:function(a,c,d){var e=this.get("accounts");b.each(e,function(b){b.faid==a&&(b.balanceAmount="Error",b.amountToPay="Error",b.dueDate=!1)}),this.set("accounts",e)},configureAccountBillingList:function(a,c,d){var e=d.ImplBillsOutput.billList;if(e){var f=this.get("accounts");b.each(f,function(c){c.billingAccountNumber==a&&(c.billList=b.sortBy(e[c.billingAccountNumber],"billClosedDate").reverse()||[])}),this.set("accounts",f)}this.set("billingAccountSummaryVmStatus","accountsBillListSet")},onPDFLoadFailure:function(a,b){b?(b=JSON.parse(b.responseText),b=b&&b.ErrorInfo?b.ErrorInfo.backendErrorInfo:"",b.indexOf("BillIdNotFoundException")>-1?this.set("billingAccountSummaryVmStatus","pdfBillNotFound"):this.set("billingAccountSummaryVmStatus","pdfLoadFailure")):this.set("billingAccountSummaryVmStatus","pdfLoadFailure")},config:{actions:{payBills:function(a,b){this.set("billingAccountSummaryVmStatus","success"),this.set("selectedAccount",b.billingAccountNumber),this.handleAction("onPayBillPressed")},loadPdf:function(){this.set("billingAccountSummaryVmStatus","pdfLoading"),this.getModel("ImplGetDocumentModel").set({documentId:this.get("pdfBillNumber")});var a=this.get("pdfDetails");this.getModel("ImplGetDocumentModel").setQueryParams({detailedBillRequired:!!a&&!!a.detailedBill}),this.getModel("ImplGetDocumentModel").fetch({success:function(a,b){var c=b.ImplGetDocumentRestOutput.fileBytes;if(c){for(var d=Date.now()+"_"+this.get("pdfBillNumber")+".pdf",e="application/pdf",f=window.Blob||window.MozBlob||window.WebKitBlob,g=atob(c),h=g.length,i=new Uint8Array(h),j=0;j<h;j++)i[j]=g.charCodeAt(j);var k=new f([i],{type:e});if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(k,d);else{var l=window.URL||window.webkitURL,m=l.createObjectURL(k),n=document.createElement("a");if(navigator.userAgent.match("CriOS")){var o=new FileReader;o.onload=function(a){n.href=o.result,n.download=d,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},o.readAsDataURL(k)}else n.href=m,n.download=d,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else this.onPDFLoadFailure()}.bind(this),error:b.bind(this.onPDFLoadFailure,this)})},changeAddressPopUp:function(a,b){this.subViewModels.addressWidgetViewModel.set("postalCode",b.physicalAddress.postcode),this.subViewModels.addressWidgetViewModel.set("streetName",b.physicalAddress.streetName),this.subViewModels.addressWidgetViewModel.set("houseNo",b.physicalAddress.houseNumber),this.subViewModels.addressWidgetViewModel.set("floorNo",b.physicalAddress.floor),this.subViewModels.addressWidgetViewModel.set("unitNo",b.physicalAddress.unitNumber),b.physicalAddress.buildingName?this.subViewModels.addressWidgetViewModel.set("buildingName",b.physicalAddress.buildingName):this.subViewModels.addressWidgetViewModel.set("buildingName","")},barNameEditableToggle:function(a,b){"editBarName"==a.currentTarget.id&&this.set("barNameValue",b.name)},confirmBarNameBtn:function(a){var b=this.get("accounts");b[a.currentTarget.getAttribute("data-id")].name=this.get("barNameValue"),this.set("accounts",b),this.initializeOtherWidgets()},saveUserSelection:function(){var a={ImplEbillPopUpUserSelection:this.get("reasons")};this.models.ebillRegistrationPopUpModel.save({ImplEbillPopUpUserSelection:a},{success:function(a){console.log(a.ImplEbillPopUpUserSelectionUpdateResponse)}})},changeAvatarAndNickName:function(){var a={
deliveryMethod:this.get("currentAccount").deliveryMethod,barId:this.get("currentAccount").billingAccountNumber,billType:this.get("currentAccount").billType,avatarImageId:this.get("selectedAvatar"),nickName:"Account Name"==this.get("nickName")?"":this.get("nickName"),mcssBillPassword:this.get("currentAccount").billPassword};this.models.updateDeliveryMethod.setQueryParams({intFlowType:this.getChangesAttributeFlag(this.get("currentAccount"))}),this.models.updateDeliveryMethod.save({customerId:this.get("currentAccount").customerId,faId:this.get("currentAccount").faid,barId:a.barId,ImplBillingDataInput:a},{success:b.bind(this.updateDeliveryMethodSuccess,this),error:b.bind(this.updateDeliveryMethodError,this)})}}},updateDeliveryMethodSuccess:function(a,b){this.set("billingAccountSummaryVmStatus","changeAvatarAndNickNameSuccess")},updateDeliveryMethodError:function(a,b){this.set("billingAccountSummaryVmStatus","error")},updateResidentialAddressAction:function(a,b,c,d,e,f){this.subViewModels.addressWidgetViewModel.checkUnitFloorNoIsValid()},submitPreference:function(a,b,c,d,e){console.log(this.get("isCheked")),console.log(this.get("selectedReason"))},resetAddressFields:function(){this.set("streetName",""),this.set("houseNumber",""),this.set("floor",""),this.set("unitNumber","")},_updateCustomerData:function(){this.trigger("closePopUpWindow")},getChangesAttributeFlag:function(a){var c="",d=0,e=b.find(this.get("accounts"),function(b){return b.billingAccountNumber==a.billingAccountNumber});return e.nickName!=this.get("nickName")&&(c="nickName",d=1),e.avatarImageId!=this.get("selectedAvatar")&&(d=2,c="avatar"),2==d&&(c="avatarNickName"),c}})});
define("businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel",["lightsaber","businesswidget/repository_l9_common/common/model/ImplSingleCallModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({options:{url:"customer-management/contact-person/",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},read:{contentType:"application/json",payload:["[]"]},update:{contentType:"application/json",method:"PUT",payload:["ImplContactPerson"]}}},name:d.get("ERROR_CONST").CONTACT_PERSON_RW,parse:function(a,b){var c=a.ImplContactPersonOutput.implContactPerson;return c&&(c.address.postCode=c.address.postcode,delete c.address.postcode,c.phone&&(c.phone=c.phone.substr(c.phone.length-8,c.phone.length))),a},toJSON:function(){var a=c.clone(this.attributes);return a&&a.ImplContactPerson&&a.ImplContactPerson.address.postCode&&(a.ImplContactPerson.address.postcode=a.ImplContactPerson.address.postCode,delete a.ImplContactPerson.vip,delete a.ImplContactPerson.address.postCode),a}});return e});
define("businesswidget/repository_l9_common/common/model/UpdateEmailModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/anm/contact-person/:contactId/change_mail_verification",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplChangeContactSendEmailVerificationRequest"]}}},name:b.get("ERROR_CONST").UPDATE_EMAIL})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ApplicationInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","Configuration"],function (a,b,c,d){var e=c.extend({persistent:["locale","salesChannel"],defaults:{locale:d.get("locale"),salesChannel:d.get("salesChannel")},subViewModels:{},dataBindings:[],handleDependencies:function(){}});return e});
define("businesswidget/repository_l9_common/common/viewmodel/referenceData/BaseListReferenceViewModel",["underscore","lightsaber","businesswidget/repository/common/model/ChoiceListModel","businesswidget/repository_l9_common/common/viewmodel/contextTopics/ApplicationInContextTopicViewModel"],function (a,b,c,d){var e=b.Core.ObservableViewModel.extend({models:{choiceListModel:c},subViewModels:{applicationContextVM:d},dataBindings:[{locale:"subViewModels.applicationContextVM.locale",options:{twoWay:!1,setOnBind:!0}},{saleChannel:"subViewModels.applicationContextVM.saleChannel",options:{twoWay:!1,setOnBind:!0}}],defaults:{locale:null,response:[],options:[]},initialize:function(){a.bindAll(this,"_loadChoiceList"),this.on("change:locale",function(){var a=this.get("locale");null!=a&&this._loadChoiceList(a)}),this.models.choiceListModel.on("OnDataLoaded",function(){this.set("options",this.models.choiceListModel.getChoiceList()),this.set("response",this.models.choiceListModel.get("ChoiceListResponse",!0))},this)},_loadChoiceList:function(a){var b=this.getChoiceListType(),c=this.getChoiceListId(),d=this.isWithChildren();this.models.choiceListModel.addToQueryParameter(b,c,d),this.models.choiceListModel.setQueryParams({lo:a,sc:this.get("salesChannel")}),this.models.choiceListModel.fetch()}});return e});
define("businesswidget/repository_l9_common/common/viewmodel/referenceData/SalutationListReferenceViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/referenceData/BaseListReferenceViewModel"],function (a,b,c){var d=c.extend({persistent:[],getChoiceListType:function(){return"STANDARD"},getChoiceListId:function(){return"SALUTATION"},isWithChildren:function(){return!0}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/referenceData/GenderListReferenceViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/referenceData/BaseListReferenceViewModel"],function (a,b,c){var d=c.extend({persistent:[],getChoiceListType:function(){return"STANDARD"},getChoiceListId:function(){return"GENDER"},isWithChildren:function(){return!0}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel"],function (a,b,c,d){var e=c.extend({persistent:["personId","contactFirstName","contactLastName","contactFormattedName"],defaults:{personId:null,contactFirstName:null,contactLastName:null,contactFormattedName:null},subViewModels:{individualInContextTopicViewModel:d},dataBindings:[{personId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!0,setOnBind:!0}},{contactFirstName:"subViewModels.individualInContextTopicViewModel.contactFirstName",options:{twoWay:!0,setOnBind:!0}},{contactLastName:"subViewModels.individualInContextTopicViewModel.contactLastName",options:{twoWay:!0,setOnBind:!0}},{contactFormattedName:"subViewModels.individualInContextTopicViewModel.contactFormattedName",options:{twoWay:!0,setOnBind:!0}}],handleDependencies:function(){}});return e});
define("businesswidget/repository_l9_common/common/model/ImplSendNotificationModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/anm/send-notification",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplSendNotificationRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/CreateInteractionModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/contact-person/:contactId/interaction",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplCreateInteractionInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository_l9_common/common/model/CreateInteractionModel"],function (a,b,c,d,e,f,g){return a.Core.ObservableViewModel.extend({models:{implSendNotificationModel:e,viewUpdateCustomerProfileModel:f,createInteractionModel:g},subViewModels:{customerInContextTopicViewModel:c,contactInContextTopicViewModel:d},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,notificationVmStatus:null,topic:{reason1:"Billing",reason2:"RequestCopyBill",result:"NotApplicable",protocol:"SpringDigital"},contactDetails:null},initialize:function(){this.set("notificationVmStatus","emailVerificationInitialized")},sendMailToCustomer:function(a,b,c){var d=this,e=d.get("contactId");void 0!==e&null!==e&&(d.getModel("viewUpdateCustomerProfileModel").set("id",e),d.getModel("viewUpdateCustomerProfileModel").fetch({success:function(e,f){var g=f.ImplContactPersonOutput.implContactPerson;d.set("contactDetails",g),"undefined"!=typeof g.emailId&&null!==g.emailId&&""!==g.emailId?d.triggerMail(g.emailId,a,b,c,g.name):d.set("notificationVmStatus","mailFailed")},error:function(){d.set("notificationVmStatus","mailFailed")}}))},triggerMail:function(a,c,d,e,f){var g=this,h=b.find(d,function(a){return"customerName"==a.key});h=h?h.value=f:h;var i={ImplSendNotificationRequest:{target:[a],templateId:c,notificationChannel:"EMAIL",templateSimpleParameters:d,templateURLParameters:[]}};return e&&(i.ImplSendNotificationRequest.templateListParameters=e),g.getModel("implSendNotificationModel").save(i,{success:function(a,b){g.set("notificationVmStatus","mailSent")},error:function(a,b){g.set("notificationVmStatus","mailFailed")}})},getInteractionData:function(){var a=$.Deferred();return require(["text!businesswidget/repository_l9_common/common/config/interactionsetting.json"],function(b){a.resolve(JSON.parse(b))}),a.promise()},getKeyMapping:function(a,b){var c=/((<([\w| |.|/|-])*>))+/gi,d=a.match(c);for(var e in d)(d[e].indexOf("service no")>0||d[e].indexOf("mobile number")>0)&&(b[e]=b[e].slice(0,4)+" "+b[e].slice(4)),d[e].indexOf("date of birth")>0&&(b[e]=b[e]),a=a.replace(d[e],b[e]);return a},createInteraction:function(a,b,c){var d=this,b=b?b:d.get("topic"),e={title:a,medium:"Self Service",channel:"Web",notes:c,userId:"sa",direction:{value:"1"},endTime:(new Date).getTime()+9999,startTime:(new Date).getTime(),topic:[b],contactId:this.get("contactId")};this.models.createInteractionModel.save({contactId:this.get("contactId"),ImplCreateInteractionInput:e,success:function(a,b){b&&d.set("notificationVmStatus","createInteractionSuccess")},error:function(){d.set("notificationVmStatus","createInteractionFailed")}})}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository_l9_common/common/model/AddressModel","businesswidget/repository_l9_common/common/model/UpdateEmailModel","businesswidget/repository_l9_common/common/viewmodel/referenceData/SalutationListReferenceViewModel","businesswidget/repository_l9_common/common/viewmodel/referenceData/GenderListReferenceViewModel","businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","moment","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel"],function (a,b,c,d,e,f,g,h,i,j){
var k=a.Core.ObservableViewModel.extend({models:{viewUpdateCustomerProfileModel:c,addressModel:d,updateEmailModel:e},subViewModels:{individualInContextTopicViewModel:h,salutationListViewModel:f,genderListViewModel:g,notificationViewModel:j},dataBindings:[{"models.addressModel.postalCode":"contactInfoForUpdate.address.postCode",options:{twoWay:!1,setOnBind:!1}},{"models.viewUpdateCustomerProfileModel.id":"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{"models.updateEmailModel.contactId":"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{salutationOptions:"subViewModels.salutationListViewModel.options",options:{twoWay:!1,setOnBind:!0}},{genderOptions:"subViewModels.genderListViewModel.options",options:{twoWay:!1,setOnBind:!0}}],defaults:{updateCutomerProfileVmStatus:"",errors:{addressError:"",saveChangesError:""},vm_config:{MAX_SIZE:4e4},contactInfo:{birthDate:"",emailId:"",name:"",nationality:"",nickName:"",nricNumber:"",nricType:"",personGender:"",phone:"",address:{apartment:"",blockOrHouseNum:"",buildingName:"",city:"",countryCode:"",floor:"",postCode:"",streetName:"",unstructAddress:!1}},contactInfoForUpdate:{name:"",salutation:"",emailId:"",address:{floor:"",devName:"",blockOrHouseAddr:"",countryCode:"",state:"",unitDescription:"",postCode:"",unstructAddress:!0,houseNumber:"",apartment:"",blockOrHouseNum:"",addressType:"",streetName:"",buildingName:"",room:"",buildingClassification:"",unitNumber:"",city:"",floorAndUnitAddressMap:{},floorOptions:[]},nricType:"",birthDate:"",vip:!0,personGender:"",documentType:"",blacklistReason:"",nationality:"",nricNumber:"",phone:"",nickName:"",documentId:""},showError:!0},config:{actions:{save:function(){this.set("saveChangesError",""),this.set("viewUpdateCustomerProfileVmStatus","contactInfoUpdating");var a=this.get("contactInfoForUpdate");delete a.address.floorAndUnitAddressMap,delete a.address.floorOptions,delete a.phoneErrorMsg,delete a.emailIdErrorMsg;for(var b in a.implNotificationPreferences)"x_3_anm_channel_sms"===a.implNotificationPreferences[b].notificationChannel&&(a.implNotificationPreferences[b].notificationValue=a.phone);this.getModel("viewUpdateCustomerProfileModel").save({ImplContactPerson:a},{success:this.onSaveSuccess,error:this.onSaveError}),this.handleAction("saveStart")},retrieveAddress:function(){this.set("addressError",""),this.set("updateCutomerProfileVmStatus","retrieveAddressInProgress"),this.getModel("addressModel").fetch({success:this.onRetrieveAddressSuccess,error:this.onRetrieveAddressError}),this.handleAction("retrieveAddressStart")},reset:function(){this.set("contactInfoForUpdate",this.get("contactInfo")),this.set("addressError",""),this.set("saveChangesError","")},updateEmail:function(){var a=this;a.set("viewUpdateCustomerProfileVmStatus","EmailRequestSend");var c={newEmailAddress:this.getValueByPath("contactInfoForUpdate.emailId"),oldEmailAddress:this.getValueByPath("contactInfo.emailId"),contactName:this.getValueByPath("contactInfo.name"),gender:this.getValueByPath("contactInfo.personGender")};this.getModel("updateEmailModel").save({ImplChangeContactSendEmailVerificationRequest:c},{success:b.bind(a.onUpdateEmailRequestSuccess,a),error:b.bind(a.onUpdateEmailRequestFailure,a)})}}},initialize:function(){b.bindAll(this,"onSaveSuccess","onSaveError","onRetrieveAddressSuccess","onRetrieveAddressError","onFetchProfileSuccess","onFetchProfileError","createInteractionForDobChange");var a=this.getModel("viewUpdateCustomerProfileModel");a.on("change:id",this.loadCustomerProfile,this),window.myVm=this},onUpdateEmailRequestSuccess:function(a,b){this.set("viewUpdateCustomerProfileVmStatus","EmailRequestSendSuccessfully")},onUpdateEmailRequestFailure:function(a,b){this.set("viewUpdateCustomerProfileVmStatus","UnableToUpdateEmail")},_doGenderSaluatationMapping:function(){for(var a=this.get("contactInfoForUpdate"),b=this.get("salutationOptions"),c=this.get("genderOptions"),d=0;d<b.length&&this.get("showError");d++)if(a.salutation===b[d].ID&&this.get("showError"))for(var e=0;e<c.length&&this.get("showError");e++)b[d].choices[0].ID===c[e].ID&&(a.personGender=c[e].ID,this.set("contactInfoForUpdate",a),this.set("showError",!1));return this.get("contactInfoForUpdate")},onSaveSuccess:function(a,b){console.log("Save profile success"),this.createInteractionForDobChange(b.ImplContactPersonOutput.implContactPerson),this.set("viewUpdateCustomerProfileVmStatus","contactInfoUpdatedSuccessfully"),this.set("contactInfo",b.ImplContactPersonOutput.implContactPerson),this.set("contactInfoForUpdate",b.ImplContactPersonOutput.implContactPerson),this.set("updateCutomerProfileVmStatus","contactInfoUpdatedSuccessfully"),this.handleAction("saveProfileSuccess")},onSaveError:function(a,b){this.set("viewUpdateCustomerProfileVmStatus","contactInfoUpdateFailed"),this.set("updateCutomerProfileVmStatus","contactInfoUpdateFailed"),this.handleAction("saveProfileError")},onRetrieveAddressError:function(a,b){if(b.responseText){var c=JSON.parse(b.responseText),d=c&&c.ErrorInfo&&c.ErrorInfo.backendErrorInfo;if(d){var e=d.split(":"),f=e[1].split(";");this.set("addressError",f[1]||f[0])}}else b.statusText&&this.set("addressError",b.statusText);this.set("updateCutomerProfileVmStatus","retrieveAddressFailed"),this.handleAction("retrieveAddressError")},onRetrieveAddressSuccess:function(a,c){var d=c.ImplSearchAddressResponse.geographicAddress[0];this.set("allAvailableAddresses",c.ImplSearchAddressResponse);var e=c.ImplSearchAddressResponse.geographicAddress,f=[],g={};if(this.getValueByPath("contactInfoForUpdate.address.postCode")===d.postcode||this.getValueByPath("contactInfoForUpdate.address.postCode")===d.postCode){var h=this.get("contactInfoForUpdate");b.map(e,function(a){return{unit:a.unitNumber,floor:a.floor}});b.each(e,function(a){if(a.floor){var b=a.floor,c=b.split("-")[0].split("#")[1];if(void 0!==c&&f.push({value:c,text:c}),a.unitNumber){var d=a.unitNumber,e=d.split("-");e.length>1&&e[1].indexOf("{")<0&&void 0!==c&&(void 0===g[c]&&(g[c]=[]),g[c].push(e[1]))}}}),f=b.uniq(f,!1,function(a){return a.value}),d.floorAndUnitAddressMap=g,d.floorOptions=f,h.address=d,this.setValueByPath("contactInfoForUpdate.address",d),this.set("updateCutomerProfileVmStatus","retrieveAddressSuccessful"),this.handleAction("retrieveAddressSuccess")}},addressNameMap:{address2:"blockOrHouseNum",buildingName:"buildingName",floor:"floor",postalCode:"postCode",room:"apartment",street:"streetName"},mapNames:function(a,c){var d={};return b.each(a,function(a,b){b=c[b]||b,d[b]=a}),d},loadCustomerProfile:function(){var a=this.getModel("viewUpdateCustomerProfileModel");this.set("viewUpdateCustomerProfileVmStatus","loadingCustomerProfile"),a.has("id")&&""!=a.get("id")?(a.fetch({success:this.onFetchProfileSuccess,error:this.onFetchProfileError}),this.handleAction("loadProfileStart")):(a.clear({silent:!0}),this.set("errors",this.defaults.errors),this.set("contactInfo",this.defaults.contactInfo),this.set("contactInfoForUpdate",this.defaults.contactInfoForUpdate),this.handleAction("noProfileInContext"))},onFetchProfileSuccess:function(a,b){this.set("contactInfo",b.ImplContactPersonOutput.implContactPerson),this.set("contactInfoForUpdate",b.ImplContactPersonOutput.implContactPerson),this.set("viewUpdateCustomerProfileVmStatus","loadProfileSuccess")},onFetchProfileError:function(a,b){this.set("viewUpdateCustomerProfileVmStatus","customerProfileLoadingFailed"),console.log("fetch profile error")},createInteractionForDobChange:function(a){var b=this.get("contactInfo"),c=i(b.birthDate,"DDMMMMYYYY"),d=i(a.birthDate,"DDMMMMYYYY");i(d).isSame(c)||this.subViewModels.notificationViewModel.getInteractionData().then(function(c){var d,e,f,g=[];c=c.DOB_CHANGE,d=c.title,e=c.topic,g=[b.birthDate,a.birthDate],f=this.subViewModels.notificationViewModel.getKeyMapping(c.description,g),this.subViewModels.notificationViewModel.createInteraction(d,e,f)}.bind(this))}});return k});
define("businesswidget/repository_l9_common/common/viewmodel/business/addressWidgetViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/AddressModel"],function (a,b,c){return a.Core.ObservableViewModel.extend({models:{AddressModel:c},defaults:{postalCode:"",address:null,errorMessage:"",returnStatus:""},config:{actions:{retrieveAddress:function(){this.getAddress()}}},getAddress:function(){if(null!==this.get("postalCode")){this.set("returnStatus","addressRetrieveing"),this.set("errorMessage","");var a=$.Deferred();return this.models.AddressModel.set({postalCode:this.get("postalCode")}),this.models.AddressModel.fetch({success:b.bind(this._onRetrieveAddressSuccess,this,a),error:b.bind(this._onRetrieveAddressError,this,a)}),a}},_onRetrieveAddressError:function(a,b,c){if(c.responseText){var d=JSON.parse(c.responseText),e=(this.get("errors"),d&&d.ErrorInfo&&d.ErrorInfo.backendErrorInfo);if(e){var f=e.split(":"),g=f[1].split(";");f=g[1]||g[0],this.set("errorMessage",f)}}else c.statusText&&this.set("errorMessage",c.statusText);this.set("errorMessage","Failure"),this.set("returnStatus","Failure"),a.reject("Failure")},_onRetrieveAddressSuccess:function(a,c,d){this.set("returnStatus","settingAddress");var e=d.ImplSearchAddressResponse.geographicAddress,f=[],g={},h={},i=[];b.each(e,function(a){if(a.floor){var b=a.floor,c=b.split("-")[0].split("#")[1];if(void 0!==c&&i.push({value:c,text:c}),a.unitNumber){var d=a.unitNumber,e=d.split("-");e.length>1&&e[1].indexOf("{")<0&&void 0!==c&&(void 0===g[c]&&(g[c]=[]),g[c].push(e[1]))}}f.push(a.blockOrHouseNum),h.streetName=a.streetName,h.buildingName=a.buildingName,h.postalCode=a.postcode,h.buildingClassification=a.buildingClassification}),f=b.uniq(f),h.blockNumbers=f,i=b.uniq(i,!1,function(a){return a.value}),h.floorOptions=i,h.floorAndUnitAddressMap=g,h.postCode=this.get("postalCode"),this.set("address",h),this.set("errorMessage",""),this.set("returnStatus","Success"),a.resolve(h)},initialize:function(){b.bindAll(this,"getAddress","_onRetrieveAddressSuccess","_onRetrieveAddressError")}})});
define("businesswidget/repository_l9_common/common/model/viewServiceListModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"ecommerce/customer/:customerId/products",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},name:c.get("ERROR_CONST").ASSINGED_PRODUCTS});return d});
define("businesswidget/repository_l9_common/common/model/GetDqmsTokenModel",["businesswidget/repository/common/core/RESTModel","underscore"],function (a,b){return a.extend({options:{url:"customer/:customerId/contact-person/:contactId/dqms-token",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/viewServiceDetailModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"ecommerce/customer/:customerId/product/:productId",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale"),allParams:!0}}}},parse:function(a){if(a&&a.Product){var b=a.Product,c={catalogItemID:b.catalogItemID,links:b.links,id:b.id,status:b.status,parameters:b.parameters,pricePackages:b.pricePackages};b.services.push(c)}return a},name:c.get("ERROR_CONST").PRODUCT_DETAILS});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["productID","assignedProduct","serviceIdToOfferingIdMap"],defaults:{productID:null,assignedProduct:{id:null,subscriptionId:null},serviceIdToOfferingIdMap:null}});return d});
define("businesswidget/repository_l9_common/common/model/overUsedDetailsModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"/ebill/customer/:customerId/subscription/:subscriptionId/unbilled-events",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/SubscriptionInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/SubscriptionInContextViewModel"],function (a,b,c,d,e){var f=c.extend({persistent:["ID","reference","lobCode","status"],defaults:{ID:null,reference:null,lobCode:null,status:null},subViewModels:{customerInContextTopicViewModel:d,subscriptionInContextViewModel:e},dataBindings:[{ID:"subViewModels.subscriptionInContextViewModel.ID",options:{twoWay:!0,setOnBind:!0}},{reference:"subViewModels.subscriptionInContextViewModel.reference",options:{twoWay:!0,setOnBind:!0}},{lobCode:"subViewModels.subscriptionInContextViewModel.lobCode",options:{twoWay:!0,setOnBind:!0}},{status:"subViewModels.subscriptionInContextViewModel.status",options:{twoWay:!0,setOnBind:!0}}],handleDependencies:function(){this.subViewModels.customerInContextTopicViewModel.on("change:ID",a.bind(this.empty,this))}});return f});
define("businesswidget/repository_l9_common/common/viewmodel/business/OverUsedDetailsViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/overUsedDetailsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/SubscriptionInContextTopicViewModel"],function (a,b,c,d,e){var f=a.Core.ObservableViewModel.extend({models:{overUsedDetailsModel:c},subViewModels:{customerInContextTopicViewModel:d,subscriptionInContextViewModel:e},dataBindings:[],defaults:{overUsedDetailsStatus:"",eventsSorting:!0,unbilledEventsDataMap:{}},initialize:function(a){b.bindAll(this,"onFetchSuccess","getUnbilledUsageEvents"),this.set("overUsedDetailsStatus","overUsedDetailsVmInitialized")},getUnbilledUsageEvents:function(a,c,d,e){console.log("pageIndex",e);var f=$.Deferred(),g=this.get("unbilledEventsDataMap");if(g[c]&&(g[c].Local&&g[c].Local[d.type]||g[c].Roaming&&g[c].Roaming[d.type])&&1==e&&(g[c].Local[d.type]=[],g[c].Roaming[d.type]=[],g[c].itemsFetched=0),g&&g[c]&&g[c].Local){var h=g[c].Local[d.type];g[c].Local[d.type]=h?g[c].Local[d.type]:[]}if(g&&g[c]&&g[c].Roaming){var h=g[c].Roaming[d.type];g[c].Roaming[d.type]=h?g[c].Roaming[d.type]:[]}this.set("unbilledEventsDataMap",g),this.set("overUsedDetailsStatus","overUsedDetailsLoading");var i=this.getModel("overUsedDetailsModel");return i.setQueryParams({ut:d.type,sa:this.get("eventsSorting"),st:e,ps:10,isRoaming:d.isRoaming}),i.fetch({customerId:a,subscriptionId:c,success:b.bind(this.onFetchSuccess,this,c,d.isRoaming,f),error:function(a){return function(b){a.reject(c,b)}}(f)}),f.done(function(){return f}),f},onFetchSuccess:function(a,b,c,d,e){if(e&&e.Events&&e.Events.events.length>1){var f=this.get("unbilledEventsDataMap");f[a]||(f[a]={}),f[a]=this.createUnbilledEventMap(e.Events.events,a,b),f[a].totalResults=e.Events.totalResults,f[a].itemsFetched=f[a].itemsFetched?f[a].itemsFetched+e.Events.events.length:e.Events.events.length,this.set("unbilledEventsDataMap",f),this.set("overUsedDetailsStatus","overUsedDetailsLoaded"),c.resolve(a,f[a],e.Events.hasMore)}else e&&e.Events&&e.Events.hasMore&&c.resolve(a,null,e.Events.hasMore)},createUnbilledEventMap:function(a,c,d){var e=this.get("unbilledEventsDataMap"),f=this;return e[c]=e[c]?e[c]:{},e[c].Local=e[c].Local?e[c].Local:{},e[c].Roaming=e[c].Roaming?e[c].Roaming:{},b.each(a,function(a){"DATA"==a.usageType&&(a.volume=f.usageConversionToMB(a.volume,a.uom),a.uom="MBYTES"),d?(e[c].Roaming[a.usageType]=e[c].Roaming[a.usageType]?e[c].Roaming[a.usageType]:[],e[c].Roaming[a.usageType].push(a)):(e[c].Local[a.usageType]=e[c].Local[a.usageType]?e[c].Local[a.usageType]:[],e[c].Local[a.usageType].push(a))}),e[c]},usageConversionToMB:function(a,b){return"BYTES"==b?1024*a*1024:"KBYTES"==b?1024*a:"GBYTES"==b?a/1024:a}});return f});
define("businesswidget/repository_l9_common/common/model/ApplyVoucherModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/sdp/contact-person/:contactId/vouchers/manageVouchers",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplManageVoucherResInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/RetrieveVoucherModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/ecommerce/customer/:customerId/contact-person/:personId/vouchers",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},method:"GET"}}},name:b.get("ERROR_CONST").RETRIEVE_VOUCHERS,parse:function(a,b){if(a&&a.ImplVouchersResponse&&a.ImplVouchersResponse.vouchersX8){var c=a.ImplVouchersResponse.vouchersX8;c=_.map(c,function(a){return a.amountX8=a.amountX8/100,a}),a.ImplVouchersResponse.vouchersX8=c}return a}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/VoucherInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["selectedVouchers"],defaults:{selectedVouchers:null}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/VoucherViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/ApplyVoucherModel","businesswidget/repository_l9_common/common/model/RetrieveVoucherModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/VoucherInContextTopicViewModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{applyVoucherModel:c,retrieveVoucherModel:d},subViewModels:{customerInContextTopicViewModel:e,contactInContextTopicViewModel:f,voucherInContextTopicViewModel:g},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{personId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{selectedVouchers:"subViewModels.voucherInContextTopicViewModel.selectedVouchers",options:{twoWay:!0,setOnBind:!0}}],defaults:{vouchers:{},voucherList:[],selectedVouchers:null,checkVouchersStatus:"",checkVouchers:{flag:!0,voucherList:[{voucherX8:"",expiryDateX8:"",serviceNoX8:"",idX8:"",amountX8:"",voucherNoX8:"",descriptionX8:""}]},voucherVmStatus:"",subscriptionId:"",customerId:"",personId:"",mobile:[],selectedShoppingCartVouchers:null,reservedVouchersList:[]},initialize:function(){b.bindAll(this,"fetchAllVouchers","getAllVouchers","onFetchVoucherSuccess","onApplyVoucherSuccess","retrieveReserveVouchers"),this.set("voucherVmStatus","voucherViewModelInitialized"),this.voucherHandler=this.on("change:customerId change:personId",this.retriveAllVouchers)},getAllVouchers:function(){this.fetchAllVouchers(this.get("customerId"),this.get("personId"),this.get("subscriptionId"))},fetchAllVouchers:function(a,c,e){var f=this;f.deferred1=f.retrieveReserveVouchers(),f.deferred2=$.Deferred();var g=c?c:f.get("personId"),h=f.create("retrieveVoucherModel",d);return f.set("voucherVmStatus","VouchersBySubscriptionLoading"),void 0!==e&&""!==e&&h.setQueryParams({subscriberId:e?e:f.get("subscriptionId")}),h.fetch({customerId:a?a:f.get("customerId"),personId:g,success:b.bind(f.onFetchVoucherSuccess,f,f.deferred2),error:function(){return function(a){f.set("voucherVmStatus","failure"),f.deferred2.resolve(null)}}()}),$.when(f.deferred1,f.deferred2).done(function(a,b){a&&b&&f.set("voucherVmStatus","vouchersLoaded")}),f.deferred2},onFetchVoucherSuccess:function(a,c,d){var e=this.get("vouchers"),f=b.sortBy(d.ImplVouchersResponse.vouchersX8,"expiryDateX8");this.set("voucherList",f);var g=b.groupBy(f,function(a){return a.serviceNoX8||(a.serviceNoX8="other"),a.serviceNoX8});b.each(g,function(a,c){e[c]={};var a=b.sortBy(a,"expiryDateX8");a&&(e[c].voucherList=a,e[c].voucherValue=a[a.length-1].amountX8,e[c].earliestExpiryDate=a[a.length-1].expiryDateX8)});var h=[],i=[];if(i=g.other,b.each(g,function(a,c){if("other"!==c){var d={number:c,voucherList:b.sortBy(a,"issueDateX8")};h.push(d)}}),h.length>0&&b.each(h,function(a){"other"!==a.number&&i&&i.length>0&&b.each(i,function(b){a.voucherList.push(b)})}),i&&i.length>0){var j={number:"other",voucherList:b.sortBy(i,"issueDateX8")};h.push(j)}delete g.other,this.set("mobile",h),this.set("vouchers",e),a.resolve(e)},applyVoucher:function(){this.set("checkVouchersStatus","");var a=this.getModel("applyVoucherModel");a.set("contactId",this.get("personId")),a.save({ImplManageVoucherResInput:this.get("checkVouchers")},{success:this.onApplyVoucherSuccess,error:function(){console.log("Error Occured")}})},onApplyVoucherSuccess:function(a,b){this.set("checkVouchersStatus",b.ImplManageVoucherResOutput.manageVoucherStatus),this.trigger("vouchersApplied")},retriveAllVouchers:function(){var a=this;a.set("voucherList",[]);var b=a.get("customerId"),c=a.get("personId");b&&c&&(this.voucherHandler.off(),this.models.retrieveVoucherModel.fetch({customerId:b,personId:c,success:function(b,c){a.set("voucherList",c.ImplVouchersResponse.vouchersX8),a.set("voucherVmStatus","bannerVoucherLoaded")},error:function(){a.set("voucherVmStatus","bannerVoucherLoadingFailed")}}))},retrieveReserveVouchers:function(){var a=this,b=a.get("customerId"),c=$.Deferred();a.set("reservedVouchersList",[]);var e=a.get("personId");if(b&&e){var f=a.create("retrieveVoucherModel",d);f.setQueryParams({groupStatus:8}),f.fetch({customerId:b,personId:e,success:function(b,d){a.set("reservedVouchersList",d.ImplVouchersResponse.vouchersX8),a.set("voucherVmStatus","reservedVouchersLoaded"),c.resolve("done")},error:function(){a.set("voucherVmStatus","reservedVouchersFailed"),c.resolve("done")}})}return c}});return h});
define("businesswidget/repository_l9_common/common/model/ImplPendingProductsModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/ecommerce/customer/:customerId/retrieve-billing-offers",rest:{defaults:{contentType:"application/json",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},create:{method:"POST",payload:["ImplRetrieveBillingOffersInOrderInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/ImplPendingProductsViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/ImplPendingProductsModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{implPendingProductsModel:g},subViewModels:{customerInContextTopicViewModel:d,productInContextTopicViewModel:e,contactInContextTopicViewModel:f},dataBindings:[{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0
}},{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.implPendingProductsModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,assignedProductId:null,pendingProductsVMStatus:null,pendingProductsByCatlogId:{},salesFlow:!1},initialize:function(a){this._super(a),setTimeout(function(){this.set("pendingProductsVMStatus","PendingProductsInitialized")}.bind(this),0)},isAllDataAvailable:function(a,b){var c=this,d=c.get("salesFlow");if(d)this.set("assignedProductId",b),this.set("customerId",a);else{var e=this.subViewModels.productInContextTopicViewModel.get("assignedProduct")?this.subViewModels.productInContextTopicViewModel.get("assignedProduct").id:null;this.set("assignedProductId",e)}return this.get("customerId")&&this.get("assignedProductId")},initializePendingProductsMap:function(){this.set("pendingProductsByCatlogId",null),this.set("pendingProductsByCatlogId",{})},getPendingProducts:function(a,b){this.set("pendingProductsVMStatus","PendingProductsInProgress");var d=$.Deferred();if(this.isAllDataAvailable(a,b)){this.initializePendingProductsMap();var e={ImplRetrieveBillingOffersInOrderInput:{assignedProductID:[this.get("assignedProductId")]}},f=this.models.implPendingProductsModel;a&&f.set("customerId",a),f.save(e,{success:c.bind(this.onPendingProductSuccess,this),error:c.bind(this.onPendigProductsFailure,this)}).then(function(){d.resolve(this.get("pendingProductsByCatlogId"))}.bind(this),function(){d.resolve()}.bind(this))}return d},onPendingProductSuccess:function(a,b){this.set("pendingProductsVMStatus","PendingProductsSuccess");var c=this._getPendingProducts(b);this.set("pendingProductsByCatlogId",c),this.set("pendingProductsVMStatus","PendingProductsSet")},_getPendingProducts:function(a){var b=a.ImplRetrieveBillingOffersInOrderOutput&&a.ImplRetrieveBillingOffersInOrderOutput.pendingComponents,d=a.ImplRetrieveBillingOffersInOrderOutput&&a.ImplRetrieveBillingOffersInOrderOutput.pendingBillingOffers,e=c.object(c.map(b,function(a){return[a.catalogId,a]})),f=c.object(c.map(d,function(a){return[a.catalogId,a]}));return c.extend(e,f)},onPendigProductsFailure:function(){this.set("pendingProductsVMStatus","PendingProductsFailed")}});return h});
define("businesswidget/repository_l9_common/common/model/ImplRetrieveEasyMobileUnitsModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/ebill/customer/:customerId/subscription/:subscriptionId/unbilled-usage-easyMobile",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},method:"GET"}}},name:b.get("ERROR_CONST").EASY_MOB_ACCUMULATOR})});
define("businesswidget/repository_l9_common/common/model/SearchAddressinCRMModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"/customer-management/address",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/model/RetrieveNominationModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"ecommerce/customer/:customerId/retrieve-nominations",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},read:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/SetMobileShareChildLimitModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/set-mobile-share-child-limit",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetLocalAlertsHistoryModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/get-local-alerts-history",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}},parse:function(a){return a.ImplDQMSGetAlertsHistoryOutput&&a.ImplDQMSGetAlertsHistoryOutput.implAlertsHistory&&_.each(a.ImplDQMSGetAlertsHistoryOutput.implAlertsHistory,function(a){switch(a.type="local",a.alertMethod){case 1:a.alertMethod="SMS";break;case 2:a.alertMethod="Email";break;case 3:a.alertMethod="USSD"}}),a}})});
define("businesswidget/repository_l9_common/common/model/GetAlertOptionModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/get-alert-option",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/SetAlertOptionModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/set-alert-option",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSSetAlertOptionInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/SetLimitAlertSettingModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/set-limit-alert-setting",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSSetLimitAlertSettingInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetLimitAlertSettingModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/get-limit-alert-setting",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetUsageLimitMapModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/get-usage-limit",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetRoamingAlertsHistoryModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/dqms/get-alerts-history",rest:{defaults:{contentType:"application/json",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",payload:["ImplDQMSInput"]}}},parse:function(a){return a.ImplDQMSGetAlertsHistoryOutput&&a.ImplDQMSGetAlertsHistoryOutput.implAlertsHistory&&_.each(a.ImplDQMSGetAlertsHistoryOutput.implAlertsHistory,function(a){switch(a.type="roaming",a.alertMethod){case 1:a.alertMethod="SMS";break;case 2:a.alertMethod="Email";break;case 3:a.alertMethod="USSD"}}),a}})});
define("businesswidget/repository_l9_common/common/model/ImplRetrieveCIAmountsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/oms/customer/:customerId/service/:serviceId/retrieveCIAmt",rest:{defaults:{method:"GET",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/viewServiceDetailsViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository/common/util/BusinessHelper","single!businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/model/GetDqmsTokenModel","single!businesswidget/repository_l9_common/common/model/viewServiceDetailModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/UnbilledUsageViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/OverUsedDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/VoucherViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/ImplPendingProductsViewModel","single!businesswidget/repository_l9_common/common/model/ImplRetrieveEasyMobileUnitsModel","single!businesswidget/repository_l9_common/common/model/SearchAddressinCRMModel","single!businesswidget/repository_l9_common/common/model/RetrieveNominationModel","single!businesswidget/repository_l9_common/common/model/GetDataUsageModel","single!businesswidget/repository_l9_common/common/model/SetMobileShareChildLimitModel","single!businesswidget/repository_l9_common/common/model/GetLocalAlertsHistoryModel","single!businesswidget/repository_l9_common/common/model/GetAlertOptionModel","single!businesswidget/repository_l9_common/common/model/SetAlertOptionModel","single!businesswidget/repository_l9_common/common/model/SetLimitAlertSettingModel","single!businesswidget/repository_l9_common/common/model/GetLimitAlertSettingModel","single!businesswidget/repository_l9_common/common/model/GetUsageLimitMapModel","single!businesswidget/repository_l9_common/common/model/GetRoamingAlertsHistoryModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","businesswidget/repository_l9_common/common/model/ImplRetrieveCIAmountsModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){var F=a.Core.ObservableViewModel.extend({models:{viewServiceListModel:e,viewServiceDetailModel:g,getDqmsTokenModel:f,implRetrieveEasyMobileUnitsModel:q,searchAddressinCRMModel:r,retrieveNominationModel:s,getDataUsageModel:t,setMobileShareChildLimitModel:u,getLocalAlertsHistoryModel:v,getAlertOptionModel:w,setAlertOptionModel:x,setLimitAlertSettingModel:y,getLimitAlertSettingModel:z,getUsageLimitMapModel:A,getRoamingAlertsHistoryModel:B,cancelOrderModel:C,implRetrieveCIAmountsModel:E},subViewModels:{customerInContextTopicViewModel:i,accountInContextTopicViewModel:k,billingAccountSummaryViewModel:h,productInContextTopicViewModel:j,unbilledUsageViewModel:l,implPendingProductsViewModel:p,overUsedDetailsViewModel:m,voucherViewModel:n,contactInContextTopicViewModel:o,NotificationViewModel:D},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{faId:"subViewModels.accountInContextTopicViewModel.faId",options:{twoWay:!0,setOnBind:!0}},{productId:"subViewModels.productInContextTopicViewModel.productID",options:{twoWay:!0,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,services:{},bundles:{},options:null,miniDesign:!0,contactId:null,viewServiceDetailsVMStatus:null,currentCustomerId:null,currentSubscriptionId:null,currentServiceId:null,currentAccountId:null,usageLimitMap:null,updatedDataLimit:null,alertHistoryList:[],currentUsageType:null,chNodeId:null,supplementaryLineIds:[],filteredChildLines:null,supplementryLineUsageDetails:null,alertOptionsList:null,currentProductId:null,alertOptionData:null,limitAlertSettingData:null,currentPersonId:null,currentSubscriptionPlanId:null,productId:null,dqmsToken:null,customerIds:null,otherVouchers:{},islobTypeFBB:!1,suspensionTransactionId:null,bundleGlpProductDetails:null,CIAmts:[],CIErrorDetails:{},dataInfinityXLiteList:null,planId:null,unbilledUsagePlansList:null,sponsoredCrOn:null},config:{actions:{toggleService:function(a,b,c,d,e){e.collapsed(!e.collapsed()),e.details()||this.loadServiceDetails(e)},getUnbilledUsage:function(){var a=this.get("currentCustomerId"),b=this.get("currentSubscriptionId"),c=this.get("currentAccountId"),d=this.get("currentServiceId"),e=this.get("chNodeId"),f=this.get("planId");this.subViewModels.unbilledUsageViewModel.set({sponsoredCrOn:this.get("sponsoredCrOn"),unbilledUsagePlansList:this.get("unbilledUsagePlansList"),dataInfinityXLiteList:this.get("dataInfinityXLiteList")});var g=this.subViewModels.unbilledUsageViewModel.getUnbilledUsageDetails(b,a,c,d,e,f),h={subscriptionId:b,customerId:a,accountId:c,serviceId:d,vm:this},i=this.getAccountByFaid(c);if(i.isEasyMobile){var j=this.getEasyMobileTcUnits();$.when.call(this,g,j).done(function(a,b){var c=a?a[0]:null,d=b?b[0].ImplUnbilledEventsEasyMobileOutput:null;if(d&&d.easyMobileUnits){var e=d.easyMobileUnits[this.subscriptionId];if(e&&e.length){var f=e[0];f.talkTimeUnits&&f.dataUnits&&f.smsUnits&&(c.easyMobileTcUnits={voiceUnits:parseInt(f.talkTimeUnits,10),dataUnits:parseInt(f.dataUnits,10),smsUnits:parseInt(f.smsUnits,10)})}}var g=this.vm.addUsageDetailsToAccountSubscription(c,this.subscriptionId,this.accountId);this.vm.subViewModels.billingAccountSummaryViewModel.set("accounts",g)}.bind(h))}else g.done(function(a){var b=this.vm.addUsageDetailsToAccountSubscription(a,this.subscriptionId,this.accountId);this.vm.subViewModels.billingAccountSummaryViewModel.set("accounts",b)}.bind(h))},getUnbilledUsageEvents:function(){var a=this.get("currentCustomerId"),b=this.get("currentSubscriptionId"),c=this.get("currentUsageType"),d=this.get("currentAccountId"),e=this.get("currentPageIndex");e<this.get("vmPageIndex")&&(e=this.get("vmPageIndex")+1,this.set("currentPageIndex",e),this.set("vmPageIndex",e));var f=this.subViewModels.overUsedDetailsViewModel.getUnbilledUsageEvents(a,b,c,e),g={subscriptionId:b,customerId:a,accountId:d,usageType:c,vm:this};f.done(function(a,b,c){if(!b&&c){var d=this.vm.get("currentPageIndex");this.vm.set("currentPageIndex",d+1),this.vm.set("vmPageIndex",d+1),this.vm.handleAction("getUnbilledUsageEvents")}else{var e=this.vm.addUsageEventDetailsToAccountSubscription(b,this.subscriptionId,this.accountId,this.usageType);this.vm.subViewModels.billingAccountSummaryViewModel.set("accounts",e)}}.bind(g))},cancelSuspensionRequest:function(){var a=this;this.set("viewServiceDetailsVMStatus","CancelSuspensionRequestInProgress");var b=this.getModel("cancelOrderModel"),c=this.get("suspensionRequestData");b.set({customerId:this.get("currentCustomerId"),productOrderId:c.orderId,productOrderItemId:c.orderActionId}),b.setQueryParams({poi:[c.orderActionId]}),b.destroy({success:function(b,c){a.set("suspensionTransactionId",c),a.set("viewServiceDetailsVMStatus","CancelSuspensionRequestSuccess"),a.subViewModels.NotificationViewModel.getInteractionData().then(function(b){var c,d,e,f=[];b=b.TOS_VOL_CANCEL,c=b.title,d=b.topic,f=[a.get("currentServiceId")],e=a.subViewModels.NotificationViewModel.getKeyMapping(b.description,f),a.subViewModels.NotificationViewModel.createInteraction(c,d,e)}.bind(a))},error:function(b,c){a.set("viewServiceDetailsVMStatus","CancelSuspensionRequestFailed")}})},getProductDetails:function(){var a=this,b=this.get("currentCustomerId"),c=this.get("currentSubscriptionId"),d=this.get("currentAccountId"),e=this.get("currentProductId"),f=this.getAssignedProductBySubscriptionId(c,d),h=g.fetch({customerId:b,productId:e}),i=$.Deferred(),j=this.isContractDateRequiredFromGlp(f);j?i=this.getBundleGlpProductDetails(c,d,b):i.resolve([!1]),$.when(i,h).then(function(b,c){var d=b[0],e=c[0];return j?a.mergeBundleGlpAndBBServiceContractDetails(d,e):e}).then(function(f){var g={subscriptionId:c,accountId:d,customerId:b,productId:e};a.onProductDetailsReceived(c,d,f,g)}).fail(function(){a.onProductDetailsReceived(c,d,null,params)}),this.getPendingOrderDetails()},getAllVouchers:function(){var a=this.get("currentCustomerId"),b=this.get("currentServiceId"),c=this.get("currentAccountId"),d=this.get("currentPersonId"),e=this.subViewModels.voucherViewModel.fetchAllVouchers(a,d,b),f={subscriptionId:b,customerId:a,accountId:c,personId:d,vm:this};e.done(function(a){this.vm.set("otherVouchers",a?a.other:null);var b=this.vm.addVoucherDetailsToAccountSubscription(a,this.accountId);this.vm.subViewModels.billingAccountSummaryViewModel.set("accounts",b)}.bind(f))},getDqmsToken:function(){var a=this.get("customerId"),b=(this.get("contactId"),this.get("currentServiceId"));this.models.getDqmsTokenModel.fetch({customerId:a,contactId:"65"+b,success:c.bind(this.dqmsTokenSuccess,this),error:c.bind(this.dqmsTokenError,this)})},getDataUsage:function(){var a=this;a.set("viewServiceDetailsVMStatus","getDataUsageInitialized");var d={msisdn:a.get("currentServiceId"),planId:b.get("PLAN_ID").MOBILE_SHARE_CHILD};a.models.getDataUsageModel.save({ImplDQMSInput:d},{success:c.bind(a.getDataUsageSuccess,a),error:function(){a.set("viewServiceDetailsVMStatus","usageDataError")}})},retrieveCIAmt:function(){var a=this;a.models.implRetrieveCIAmountsModel.set({serviceId:a.get("currentServiceId"),customerId:a.get("customerId")}),a.models.implRetrieveCIAmountsModel.fetch({success:c.bind(a.retrieveCIAmtSuccess,a),error:c.bind(a.retrieveCIAmtFailure,a)})},setMobileShareChildLimit:function(){var a=this;a.set("viewServiceDetailsVMStatus","setMobileShareChildLimitInitialized");var b=[];c.each(this.get("filteredChildLines"),function(d){var e=$.Deferred(),f={msisdn:d.msisdn,limit:d.limit};a.models.setMobileShareChildLimitModel.save({ImplDQMSInput:f},{success:c.bind(a.setMobileShareChildLimitSuccess,a,d.msisdn,e),error:function(a){return function(){a.resolve()}}(e)}),b.push(e)}),$.when.apply(a,b).then(function(a){this.set("viewServiceDetailsVMStatus","setMobileShareChildLimitSuccess")}.bind(this))},getAlertHistory:function(){var a=this;a.set("viewServiceDetailsVMStatus","getAlertHistoryInitialized"),a.set("alertHistoryList",[]);var d=$.Deferred(),e=$.Deferred(),f={msisdn:a.get("currentServiceId"),startDate:new Date(Date.now()-2593542550),endDate:new Date,maxRecord:200};a.models.getLocalAlertsHistoryModel.save({ImplDQMSInput:f},{success:c.bind(a.getLocalAlertsHistorySuccess,a,d),error:function(){d.resolve(null)}}),f.planId=b.get("PLAN_ID").ROAMING,a.models.getRoamingAlertsHistoryModel.save({ImplDQMSInput:f},{success:c.bind(a.getRoamingAlertsHistorySuccess,a,e),error:function(){e.resolve(null)}}),$.when.call(this,d,e).done(function(a,b){a||b?this.set("viewServiceDetailsVMStatus","getAlertHistorySuccess"):this.set("viewServiceDetailsVMStatus","getAlertHistoryError")}.bind(this))},getLocalAlertOptions:function(){var a=b.get("PLAN_ID").LOCAL,c=this.getAlertOptions(),d=this.getLimitAlertSetting(a);$.when.call(this,c,d).done(function(a,b){a&&b?this.set("viewServiceDetailsVMStatus","getLocalAlertOptionsSuccess"):this.set("viewServiceDetailsVMStatus","getLocalAlertOptionsError")}.bind(this))},setLocalAlertOptions:function(){var a=this.setAlertOptions(),b=this.setLimitAlertSetting();$.when.call(this,a,b).done(function(a,b){a&&b?this.set("viewServiceDetailsVMStatus","setLocalAlertOptionsSuccess"):this.set("viewServiceDetailsVMStatus","setLocalAlertOptionsError")}.bind(this))},getRoamingAlertOptions:function(){var a=b.get("PLAN_ID").ROAMING,c=this.getAlertOptions(),d=this.getLimitAlertSetting(a),e=this.getUsageLimitMap();$.when.call(this,c,d,e).done(function(a,b,c){a&&b&&c?this.set("viewServiceDetailsVMStatus","getRoamingAlertOptionsSuccess"):this.set("viewServiceDetailsVMStatus","getRoamingAlertOptionsError")}.bind(this))},setRoamingAlertOptions:function(){var a=$.Deferred(),c=b.get("PLAN_ID").ROAMING,d=this.get("limitAlertSettingData")?this.get("limitAlertSettingData").implLimitAlertSettings[0]:[];a=d.isRoamingEnabled?this.setAlertOptions():a.resolve(!0);var e=this.setLimitAlertSetting(c);$.when.call(this,a,e).done(function(a,b){a&&b?this.set("viewServiceDetailsVMStatus","setRoamingAlertOptionsSuccess"):this.set("viewServiceDetailsVMStatus","setRoamingAlertOptionsError")}.bind(this))}}},getUsageLimitMap:function(){var a=this,d=$.Deferred();a.set("usageLimitMap",null),a.set("viewServiceDetailsVMStatus","getUsageLimitMapInitialized");var e={msisdn:a.get("currentServiceId"),planId:b.get("PLAN_ID").ROAMING};return a.models.getUsageLimitMapModel.save({ImplDQMSInput:e},{success:c.bind(a.getUsageLimitMapSuccess,a,d),error:function(){d.resolve(!1),a.set("viewServiceDetailsVMStatus","getUsageLimitMapError")}}),d},getUsageLimitMapSuccess:function(a,b,d){var e=this,d=d.ImplDQMSGetUsageLimitMapRestOutput;if(1==d.responseCode&&d.implUsageLimitMap){var f=c.map(d.implUsageLimitMap,function(a){var b={value:a.usageLimtID,title:e.convertCentsToDoller(a.usageLimitDesc)};return b});f[0].selected=!0,this.set("usageLimitMap",f),this.set("viewServiceDetailsVMStatus","getUsageLimitMapSuccess"),a.resolve(d.implUsageLimitMap)}else this.set("viewServiceDetailsVMStatus","getUsageLimitMapError"),a.resolve(!1)},convertCentsToDoller:function(a){return a?(a=parseInt(a)/100,"$"+a):"$0"},getAlertOptions:function(){var a=this,b=$.Deferred();a.set("viewServiceDetailsVMStatus","getAlertOptionsInitialized"),a.set("alertOptionsList",null),a.set("alertOptionData",null);var d={msisdn:a.get("currentServiceId")};return a.models.getAlertOptionModel.save({ImplDQMSInput:d},{success:c.bind(a.getAlertOptionsSuccess,a,b),error:function(){b.resolve(!1),a.set("viewServiceDetailsVMStatus","getAlertOptionsError")}}),b},getAlertOptionsSuccess:function(a,b,c){var c=c.ImplDQMSGetAlertOptionOutput;1==c.responseCode&&c.implAlertOption?(this.set("alertOptionData",c.implAlertOption[0]),this.set("viewServiceDetailsVMStatus","getAlertOptionsSuccess"),a.resolve(c.implAlertOption)):(this.set("viewServiceDetailsVMStatus","getAlertOptionsError"),a.resolve(!1))},setAlertOptions:function(){var a=this,b=$.Deferred();a.set("viewServiceDetailsVMStatus","setAlertOptionsInitialized");var d=a.get("alertOptionData");return!(!d||!d.emailErrorMsg)&&delete d.emailErrorMsg,!(!d||!d.altMobileNumErrorMsg)&&delete d.altMobileNumErrorMsg,d.msisdn=a.get("currentServiceId"),a.models.setAlertOptionModel.save({ImplDQMSSetAlertOptionInput:d},{success:c.bind(a.setAlertOptionsSuccess,a,b),error:function(){a.set("viewServiceDetailsVMStatus","setAlertOptionsError"),b.resolve(!1)}}),b},setAlertOptionsSuccess:function(a,b,c){var c=c.ImplDQMSSetAlertOptionOutput;1==c.responseCode?(this.set("viewServiceDetailsVMStatus","setAlertOptionsSuccess"),a.resolve(c)):(this.set("viewServiceDetailsVMStatus","setAlertOptionsError"),a.resolve(!1))},getLimitAlertSetting:function(a){var b=this,d=$.Deferred();b.set("viewServiceDetailsVMStatus","getLimitAlertSettingInitialized");var e={msisdn:b.get("currentServiceId")};return b.models.getLimitAlertSettingModel.save({ImplDQMSInput:e},{success:c.bind(b.getLimitAlertSettingSuccess,b,d),error:function(){b.set("viewServiceDetailsVMStatus","getLimitAlertSettingError"),d.resolve(!1)}}),d},getLimitAlertSettingSuccess:function(a,b,c){var c=c.ImplDQMSGetLimitAlertSettingOutput;if(1==c.responseCode&&c.implLimitAlertSettings){var d=c.implLimitAlertSettings[0].disableRoaming;c.implLimitAlertSettings[0].isRoamingEnabled=!d,this.set("limitAlertSettingData",c),this.set("viewServiceDetailsVMStatus","getLimitAlertSettingSuccess"),a.resolve(c.implLimitAlertSettings)}else this.set("viewServiceDetailsVMStatus","getLimitAlertSettingError"),a.resolve(!1)},setLimitAlertSetting:function(a){var b=this,d=$.Deferred();b.set("viewServiceDetailsVMStatus","setLimitAlertSettingInitialized");var e=b.get("limitAlertSettingData"),f=e.localDataSuspension?e.localDataSuspension:0,g={localDataSuspension:f,msisdn:b.get("currentServiceId"),planId:a,localWiFiSuspension:e.localWiFiSuspension};return e=c.extend(e.implLimitAlertSettings[0],g),e.disableRoaming=!e.isRoamingEnabled,e.disableRoaming&&delete e.usageLimitId,delete e.isRoamingEnabled,b.models.setLimitAlertSettingModel.save({ImplDQMSSetLimitAlertSettingInput:e},{success:c.bind(b.setLimitAlertSettingSuccess,b,d),error:function(){b.set("viewServiceDetailsVMStatus","setLimitAlertSettingError"),d.resolve(!1)}}),d},setLimitAlertSettingSuccess:function(a,b,c){var c=c.ImplDQMSOutput;1==c.responseCode?(this.set("viewServiceDetailsVMStatus","setLimitAlertSettingSuccess"),a.resolve(c)):(this.set("viewServiceDetailsVMStatus","setLimitAlertSettingError"),a.resolve(!1))},getLocalAlertsHistorySuccess:function(a,b,c){var c=c.ImplDQMSGetAlertsHistoryOutput;1==c.responseCode&&c.implAlertsHistory?(this.set("alertHistoryList",this.get("alertHistoryList").concat(c.implAlertsHistory)),a.resolve(c.implAlertsHistory)):a.resolve(null)},getRoamingAlertsHistorySuccess:function(a,b,c){var c=c.ImplDQMSGetAlertsHistoryOutput;1==c.responseCode&&c.implAlertsHistory?(this.set("alertHistoryList",this.get("alertHistoryList").concat(c.implAlertsHistory)),a.resolve(c.implAlertsHistory)):a.resolve(null)},getDataUsageSuccess:function(a,b){var d=this,b=b.ImplDQMSGetDataUsageOutput;if(1==b.responseCode&&b.implSupplementaryLineUsage&&b.implSupplementaryLineUsage.length>0){var e=c.filter(b.implSupplementaryLineUsage,function(a,b){return a.msisdn!=d.get("currentServiceId")});d.set("supplementryLineUsageDetails",e),d.set("viewServiceDetailsVMStatus","usageDataSuccess")}else d.set("viewServiceDetailsVMStatus","usageDataError")},retrieveCIAmtSuccess:function(a,b){b&&b.ImplRetrieveCIAmtOutput&&(b.ImplRetrieveCIAmtOutput.implCIAmtDetails&&this.subViewModels.billingAccountSummaryViewModel.set("CIAmts",b.ImplRetrieveCIAmtOutput.implCIAmtDetails),b.ImplRetrieveCIAmtOutput.implCIAmtErrorDetails&&this.subViewModels.billingAccountSummaryViewModel.set("CIErrorDetails",b.ImplRetrieveCIAmtOutput.implCIAmtErrorDetails))},retrieveCIAmtFailure:function(a,b){b&&b.ImplRetrieveCIAmtOutput&&b.ImplRetrieveCIAmtOutput.implCIAmtErrorDetails&&this.subViewModels.billingAccountSummaryViewModel.set("CIErrorDetails",b.ImplRetrieveCIAmtOutput.implCIAmtErrorDetails)},setMobileShareChildLimitSuccess:function(a,b,d,e){var e=e.ImplDQMSSetMobileShareChildLimitOutput;if(1==e.responseCode){var f=this.get("filteredChildLines"),g=c.find(f,function(b){return b.msisdn=a});g.isSaved=!0,this.set("filteredChildLines",f),b.resolve()}else b.resolve()},setAssignedProductsAddressIfNotPopulated:function(){var a=$.Deferred(),b=[],d=this.getValueByPath("bundles");c.each(d,function(a,d){c.each(a,function(a,e){var f=a.bundledServices;c.each(f,function(a,c){var f=a.address;if(f&&!f.postCode&&!f.postcode&&f.id){var g="bundles."+d+"."+e+".bundledServices."+c+".address",h={path:g,addressId:f.id};b.push(h)}})})});var e=this.getValueByPath("services");if(c.each(e,function(a,d){c.each(a,function(a,c){var e=a.address;if(e&&!e.postCode&&!e.postcode&&e.id){var f="services."+d+"."+c+".address",g={path:f,addressId:e.id};b.push(g)}})}),b.length){var f=c.pluck(b,"addressId"),g=this.models.searchAddressinCRMModel;g.setQueryParams({addressIds:f}),g.fetch().then(function(b,d){for(var e=0;e<b.length;e++){var f=b[e],g=d.HashMap[f.addressId];g&&(g=c.extend(g,{addressType:"physicalAddress",id:f.addressId}),this.setValueByPath(f.path,g))}a.resolve()}.bind(this,b),function(){a.resolve()})}else a.resolve();return a},getPendingOrderDetails:function(){var a=this.get("currentCustomerId"),b=this.get("currentSubscriptionId"),c=this.get("currentAccountId"),d=this.get("currentProductId"),e={subscriptionId:b,customerId:a,accountId:c,productId:d,vm:this},f=this.subViewModels.implPendingProductsViewModel.getPendingProducts();$.when(f).done(function(){var a=this.vm.subViewModels.implPendingProductsViewModel.get("pendingProductsByCatlogId");this.vm.setPendingOrderDetails(this.subscriptionId,this.accountId,this.productId,a)}.bind(e))},getEasyMobileTcUnits:function(){var a=this.get("currentCustomerId"),b=this.get("currentSubscriptionId");this.get("currentAccountId"),this.get("currentServiceId");return this.models.implRetrieveEasyMobileUnitsModel.fetch({customerId:a,subscriptionId:b})},dqmsTokenSuccess:function(a,b){b.ImplDQMSTokenDetails&&this.set("dqmsToken",b.ImplDQMSTokenDetails.token)},dqmsTokenError:function(a,b){this.set("dqmsToken","tokenError")},setPendingOrderDetails:function(a,b,d,e){var f=this.subViewModels.billingAccountSummaryViewModel.get("accounts"),g=c.find(f,function(a){return a.faid===b}),h=null;c.find(g.assignedProducts.bundles,function(b){return h=c.find(b.bundledServices,function(b){return b.subscriptionId===a})}),h||(h=c.find(g.assignedProducts.services,function(b){return b.subscriptionId===a})),h&&(h.pendingOrderMap=e,this.subViewModels.billingAccountSummaryViewModel.set("accounts",f))},getAssignedProductBySubscriptionId:function(a,b){var d=this.getAccountByFaid(b),e=null;return c.find(d.assignedProducts.bundles,function(b){return e=c.find(b.bundledServices,function(b){return b.subscriptionId===a})}),e||(e=c.find(d.assignedProducts.services,function(b){return b.subscriptionId===a})),e},isContractDateRequiredFromGlp:function(a){return a.bundle&&"BB"===a.lob},getBundleGlpProductDetails:function(a,b,d){var e=this.getAccountByFaid(b),f=c.find(e.assignedProducts.bundles,function(b){return service=c.find(b.bundledServices,function(b){return b.subscriptionId===a}),!!service}),h=g.fetch({customerId:d,productId:f.id});return h},mergeBundleGlpAndBBServiceContractDetails:function(a,b){return this.upadteContractCharForBB(b.Product.services),a&&c.each(a.Product.services,function(a){b.Product.services.push(a)}),b},upadteContractCharForBB:function(a){c.each(a,function(a){c.each(a.parameters,function(a){"8252"===a.catalogId&&(a.catalogId=a.catalogId+"_BB")}),a.containedServices&&this.upadteContractCharForBB(a.containedServices)}.bind(this))},onProductDetailsReceived:function(a,b,d,e){var f=(e.customerId,this.subViewModels.billingAccountSummaryViewModel.get("accounts")),g=c.find(f,function(a){return a.faid===b}),h=null;c.each(g.assignedProducts.bundles,function(b){h||(h=c.find(b.bundledServices,function(b){return b.subscriptionId===a}))}),h||(h=c.find(g.assignedProducts.services,function(b){return b.subscriptionId===a}));var i=d.Product;if(i?(i.isChildLine=this.setChildLineId(i),g.isEasyMobile&&(i.units=this.populateEasyMobileUnits(i.services)),i=c.extend(c.clone(h),i),h.keyLineIndX8&&(i.keyLineIndX8=!0),h.plan.catalogItemID!==i.plan.catalogItemID&&(h.plan=c.extend(h.plan,i.plan,{displayName:i.plan.catalogItemName,displayDescription:i.plan.catalogItemDescription}),h.productDetails=i)):i="productDetailsError",h.productDetails=i,"WL"===h.lob&&"ENRG"===h.subscrType){var j=c.find(i.services,function(a){return"Singtel Electricity Plan"===a.catalogItemName||"18606381"===a.catalogItemID});j&&(energyPlanName=c.find(j.parameters,function(a){return"Product Name"===a.name||"26763424"===a.catalogId}),energyPlanName&&(h.plan.catalogItemName=energyPlanName.valueName||h.plan.catalogItemName,h.plan.displayName=h.plan.catalogItemName))}this.subViewModels.billingAccountSummaryViewModel.set("accounts",f)},setChildLineId:function(a){for(var b=0;b<a.services.length;b++){var d=c.find(a.services[b].parameters,function(a){return"8517942"===a.catalogId});if(d)return!1}return!0},populateEasyMobileUnits:function(a){var d={};return c.each(a,function(a){a.catalogItemID==b.get("easyMobileCatalogItemID")&&c.each(a.parameters,function(a){a.catalogId==b.get("dataUnitsCatalogItemID")?d.dataUnits=parseInt(a.valueName):a.catalogId==b.get("smsUnitsCatalogItemID")?d.smsUnits=parseInt(a.valueName):a.catalogId==b.get("voiceUnitsCatalogItemID")&&(d.voiceUnits=parseInt(a.valueName))})}),d},getAccountByFaid:function(a){
var b=this.subViewModels.billingAccountSummaryViewModel.get("accounts"),d=c.find(b,function(b){return b.faid===a});return d},addUsageDetailsToAccountSubscription:function(a,b,d){var e=this.subViewModels.billingAccountSummaryViewModel.get("accounts"),f=c.find(e,function(a){return a.faid===d}),g=c.find(f.assignedProducts.bundle,function(a){return a.subscriptionId===b});return g||(g=c.find(f.assignedProducts.services,function(a){return a.subscriptionId===b})),g.usageSummary=a?a:"usageSummaryError",e},addUsageEventDetailsToAccountSubscription:function(a,b,d,e){var f=this.subViewModels.billingAccountSummaryViewModel.get("accounts"),g=c.find(f,function(a){return a.faid===d}),h=c.find(g.assignedProducts.bundle,function(a){return a.subscriptionId===b});return h||(h=c.find(g.assignedProducts.services,function(a){return a.subscriptionId===b})),h.unbilledUsageEvents=a,f},addVoucherDetailsToAccountSubscription:function(a,b){var d=this.subViewModels.billingAccountSummaryViewModel.get("accounts"),e=c.find(d,function(a){return a.faid===b});return c.each(e.assignedProducts.bundle,function(b){a&&a[b.serviceId]?b.voucherDetails=a[b.serviceId]:null==a&&(b.voucherDetails="voucherFetchError")}),c.each(e.assignedProducts.services,function(b){a&&a[b.serviceId]?b.voucherDetails=a[b.serviceId]:null==a&&(b.voucherDetails="voucherFetchError")}),d},initialize:function(b){var d=this;this._super(b),d.loadServiceDeferred=$.Deferred(),d.loadAccountsDeferred=$.Deferred(),$.when(d.loadServiceDeferred,d.loadAccountsDeferred).done(function(){d.setAssignedProducts(),d.set("viewServiceDetailsVMStatus","assignedProductsSet")}),a.Core.BusinessWidgetHub.subscribe("ActionsBillingAccountSummaryTopic",{handler:function(a){var b=a.action;if("$change"===b&&a.changedAttributes.billingAccountSummaryVmStatus&&("accountsFaidSet"===a.changedAttributes.billingAccountSummaryVmStatus||"accountsBillListSet"===a.changedAttributes.billingAccountSummaryVmStatus)&&!d.get("customerIds")){var e=d.subViewModels.billingAccountSummaryViewModel.get("accounts"),f=c.unique(c.pluck(e,"customerId"));d.set("customerIds",f),d.loadAccountsDeferred.resolve()}}}),this.on("change:customerIds",function(a){a&&d.loadServices(a)})},isAllDataAvailable:function(){return null!==this.get("customerId")},loadServices:function(){var a=this,b=[],d=this.get("customerIds");c.each(d,function(d){var e=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:d,success:c.bind(a.onLoadServicesSuccess,a,e,d),error:function(a){a.resolve()}.bind(a,e)}),b.push(e)}),$.when.apply(a,b).done(function(){var b=a.setAssignedProductsAddressIfNotPopulated(),c=a._setBundleType();$.when(b,c).done(function(){a.loadServiceDeferred.resolve()})})},_setBundleType:function(){var a=$.Deferred(),b=[],d=this.getValueByPath("bundles");if(c.each(d,function(a,d){c.each(a,function(a,e){var f=a.bundledServices;c.each(f,function(a,c){if("BB"===a.lob){var f="bundles."+d+"."+e+".bundleType",g={bundleTypePath:f,customerId:d,assignedProductId:a.id};b.push(g)}})})}),b.length){var e=c.map(b,function(a){var b=$.Deferred();return this.models.retrieveNominationModel.setQueryParams({product:a.assignedProductId}),this.models.retrieveNominationModel.fetch({customerId:a.customerId}).then(function(a,b,d){var e=d.ImplRetrieveNominationsRestOutput.nominationsOutput,f=(e.maxLinesForNominationX9,!!d.ImplRetrieveNominationsRestOutput.nominationsOutput.tvServiceIDX9);f?this.setValueByPath(b.bundleTypePath,"FEBP"):this.setValueByPath(b.bundleTypePath,"FHB");var g=c.find(e.nominationsDetailsX9,function(a){return a.keylineX9});if(g){var h=this.getValueByPath("services."+b.customerId);c.find(h,function(a,c){return a.serviceId===g.nominatedLineX9?(this.setValueByPath("services."+b.customerId+"."+c+".keyLineIndX8",!0),!0):this.getValueByPath("services."+b.customerId+"."+c+".keyLineIndX8")!==!0?(this.setValueByPath("services."+b.customerId+"."+c+".keyLineIndX8",!1),!1):void 0}.bind(this))}a.resolve()}.bind(this,b,a),function(){this.setValueByPath(a.bundleTypePath,"FHB"),b.resolve()}.bind(this,b,a)),b}.bind(this));$.when.apply(this,e).done(function(){a.resolve()})}else a.resolve();return a},onLoadServicesSuccess:function(a,b,d,e){this.set("viewServiceDetailsVMStatus","ServicesListFetched");var f=e.Products.products;c.each(f,function(a){a.collapsed=this.get("miniDesign")},this);var g=this.get("services"),h=this.get("bundles"),i=this.initBundles(f,b);g[b]=i.services,h[b]=i.bundle,this.set("services",g),this.set("bundles",h),a.resolve()},setAssignedProducts:function(){var a=(this.get("services"),this.subViewModels.billingAccountSummaryViewModel.get("accounts"));c.each(a,function(a){var b=this.mapProductToAccount(a);b&&(a.assignedProducts=b)}.bind(this)),this.subViewModels.billingAccountSummaryViewModel.set("accounts",a)},mapProductToAccount:function(a){var b=this,d={},e=this.mergeAccountSubscriptionAndServices(a.subscribers,b.get("services")[a.customerId]);e&&e.length>0&&(d.services=e);var f=!1,g=[];if(c.each(a.subscribers,function(d){var e=b.getValueByPath("bundles."+a.customerId)||!1;e&&c.each(e,function(a,b){var e=a.bundledServices;c.each(e,function(a){d.subscriberResourceVal===a.serviceId&&(f=!0,g.push(b))})})}),f){var h=c.filter(b.getValueByPath("bundles."+a.customerId),function(a,b){return c.contains(g,b)});h=c.map(h,function(b){var c=this.mergeAccountSubscriptionAndServices(a.subscribers,b.bundledServices);return c&&c.length>0&&(b.bundledServices=c),b}.bind(this)),d.bundles=h}return d},mergeAccountSubscriptionAndServices:function(a,b){var d=c.map(a,function(a){var d=c.find(b,function(b){return a.subscriberID&&b.subscriptionId&&a.subscriberID===b.subscriptionId});return d&&("WL"===d.lob&&"ENRG"===a.subscriberType&&(d.serviceId=a.subscriberResourceVal),d.reContractionDate=a.reContractionDate,d.primaryInd=a.primaryInd,d.activationDate=a.subscrActivationDate,d.subscrStatus=a.subscrStatus,d.subscrStatusChangeDate=a.subscrStatusChangeDate,d.subscrType=a.subscriberType),d});return d=c.filter(d,function(a){return a})},loadServiceDetails:function(a){this.getModel("viewServiceDetailModel").fetch({customerId:this.subViewModels.customerInContextTopicViewModel.ID,productId:a.id,success:function(b,c){a.details=c.Product,this.set("viewServiceDetailsVMStatus","Services Details fetched")}})},initBundles:function(a,b){var d=[],e=c.groupBy(a,function(a){return a.bundle?"bundle":"services"});if(e.bundle){var f=c.groupBy(e.bundle,"offeringInstanceId");e.bundle=c.map(f,function(a,b){var e=c.find(a,function(a){return"Bundle GLP"==a.spoName});if(e){var f=null,g=null;return a=c.filter(a,function(a){return"TV"===a.lob&&(g=a),"Bundle GLP"===a.spoName?(f=a,!1):!!a.lob}),g?f.bundleType="FEB":f.bundleType="FHB",f.bundledServices=a,f}return d=d.concat(a),!1}),e.bundle=c.filter(e.bundle,function(a){return a})}return e.services&&(e.services=e.services.concat(d),e.services=c.filter(e.services,function(a){return a.lob})),e}});return F});
define("businesswidget/repository_l9_common/common/model/SearchAvailableNumbersModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/sdp/manageResource/order/:orderId/order-item/:orderItemId/product-in-order/:productID/searchNumber",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},read:{method:"GET"},create:{method:"POST",payload:["ImplSearchAviableInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ReserveAndReleaseModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/ecommerce/order/:orderId/order-item-id/:orderItemId/product-in-order/:productID/reserve-resource",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},read:{method:"GET"},create:{method:"PUT",payload:["ImplReserveResourceNumberRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/CustomerAssignedProductTechnologyModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"commerce/customer-management/order/:orderId/order-action/:orderActionId/contact-person/:contactId/assigned-products-technology",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"],function (a,b,c,d,e){var f=c.extend({persistent:["orderId","productOrderID","productOrderReferenceNumber","isOrderAccepted","orderSubmissionStatus","productOrderItemID","methodType","accountId","emailNotificationRequired","orderMapped","barId","deliverAddress","billingAddress","productID","orderActions","customerID","updatedOrderActions","currentOrderActions","mobileFlow","contnueShoppingFlag","tvSubscription","contractList","freebiesFailed","promoRulesUpdated","promoOrderActions","isChangeUserScenario"],defaults:{orderId:null,productOrderID:null,productOrderReferenceNumber:null,isOrderAccepted:null,orderSubmissionStatus:null,productOrderItemID:null,methodType:null,accountId:null,emailNotificationRequired:null,orderMapped:null,barId:null,deliverAddress:null,billingAddress:null,productID:null,orderActions:null,customerID:null,updatedOrderActions:null,currentOrderActions:null,mobileFlow:null,contnueShoppingFlag:null,tvSubscriptionFlag:!0,contractList:null,freebiesFailed:null,promoRulesUpdated:!1,promoOrderActions:[],isChangeUserScenario:!1},initialize:function(){this._super(),this.on("change:productOrderReferenceNumber",this.resetDetails,this)},resetDetails:function(){this.set("isOrderAccepted",null),this.set("orderSubmissionStatus",null),this.set("orderMapped",null),this.set("emailNotificationRequired",null),this.set("contnueShoppingFlag",null)},subViewModels:{customerInContextTopicViewModel:d,productOrderTopicViewModel:e},dataBindings:[{productOrderID:"subViewModels.productOrderTopicViewModel.productOrderID",options:{twoWay:!0,setOnBind:!0}},{productOrderReferenceNumber:"subViewModels.productOrderTopicViewModel.productOrderReferenceNumber",options:{twoWay:!0,setOnBind:!0}}],handleDependencies:function(){},emptyTopic:function(){this.empty(),this.subViewModels.productOrderTopicViewModel.set("productOrderID",null),this.subViewModels.productOrderTopicViewModel.set("productOrderReferenceNumber",null)}});return f});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["deviceId","planId","relationId","numberType","isIppPlan","priceSchemaId","planType","packType","changeCartflag","miniCartChange","cisDetails","staffDetails","customerType","tradeInDetails","installationAddressID","mobileReContractFlag","mobilePortinFlag","tradeInFlag","reContractFlag","selectedOption","isBackClicked","selectedVouchers","recontractNumber","warehouseId","flowType","bbRelationIds","easyMobileId","tempDeviceId","priorityPhoneDetails","reservationIDs","cisRates","recontractBarId","allocationIDs","tvSourceOfferId","deviceResDetails","dwfmTokenId","isNewBar","addonDetails","dashPayment","hasYouthSilverPlans","hasCisStaff","installmentPayment","roiDetails","pgInfo","promoCode","postalCode","expressCheckoutOrderID","expressCheckoutRulesCompleted","expressCheckoutServiceID","selectPayment","blockOrderID","energyAddress","energyPlanName","customerExists","oneClickData","selectedPlanAddonDetails","isStoreScenario","isExpressRequired","skipOF","chargeableEmailDetails","gomoSkuId","selectedBillOption","portinNumber","promoCriteria","oldOfferId","comboPlan","isNewPP","installmentDuration","ippPlanName","isRemoveTVScenario"],defaults:{deviceId:null,planId:null,relationId:null,numberType:null,isIppPlan:!1,priceSchemaId:null,planType:null,packType:!1,changeCartflag:!1,cisDetails:null,staffDetails:null,customerType:null,tradeInDetails:null,installationAddressID:null,mobileReContractFlag:!1,mobilePortinFlag:!1,miniCartChange:!1,tradeInFlag:!1,reContractFlag:!1,selectedOption:null,isBackClicked:!1,selectedVouchers:null,recontractNumber:null,warehouseId:null,flowType:null,bbRelationIds:null,easyMobileId:null,tempDeviceId:null,priorityPhoneDetails:null,reservationIDs:null,cisRates:null,recontractBarId:null,allocationIDs:null,tvSourceOfferId:null,deviceResDetails:null,dwfmTokenId:null,isNewBar:!1,addonDetails:null,dashPayment:!1,hasYouthSilverPlans:!1,hasCisStaff:!1,installmentPayment:!1,roiDetails:null,selectedPlanAddonDetails:null,gomoSkuId:null,pgInfo:null,promoCode:null,postalCode:null,expressCheckoutOrderID:null,expressCheckoutRulesCompleted:!1,expressCheckoutServiceID:null,selectPayment:null,blockOrderID:null,energyAddress:null,energyPlanName:null,customerExists:!1,oneClickData:null,isStoreScenario:!1,isExpressRequired:!1,skipOF:!1,chargeableEmailDetails:null,selectedBillOption:null,portinNumber:null,promoCriteria:null,oldOfferId:null,comboPlan:null,isNewPP:!1,installmentDuration:null,ippPlanName:null,isRemoveTVScenario:null},emptyTopic:function(){this.empty()},continueShopping:function(){this.set("deviceId",null),this.set("planId",null),this.set("numberType",null),this.set("planType",null),this.set("relationId",null),this.set("priceSchemaId",null),this.set("tradeInDetails",null),this.set("tempDeviceId",null),this.set("deviceId",null),this.set("mobileReContractFlag",!1),this.set("mobilePortinFlag",!1),this.set("miniCartChange",!1),this.set("tradeInFlag",!1),this.set("isBackClicked",!1),this.set("selectedVouchers",null),this.set("recontractNumber",null),this.set("warehouseId",null),this.set("flowType",null),this.set("packType",null),this.set("priorityPhoneDetails",null),this.set("tvSourceOfferId",null),this.set("isNewBar",!1),this.set("addonDetails",null),this.set("bbRelationIds",null),this.set("hasYouthSilverPlans",!1),this.set("hasCisStaff",!1),this.set("installmentPayment",!1),this.set("postalCode",null),this.set("expressCheckoutOrderID",null),this.set("expressCheckoutRulesCompleted",!1),this.set("expressCheckoutServiceID",null),this.set("selectPayment",null),this.set("energyAddress",null),this.set("energyPlanName",null),this.set("customerExists",!1),this.set("oneClickData",null),this.set("selectedPlanAddonDetails",null),this.set("isStoreScenario",!1),this.set("isExpressRequired",!1),this.set("skipOF",!1),this.set("gomoSkuId",!1),this.set("selectedBillOption",null),this.set("portinNumber",null),this.set("promoCriteria",null),this.set("comboPlan",null),this.set("ippPlanName",null),this.set("isNewPP",!1),this.set("isIppPlan",!1),this.set("installmentDuration",null)}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["currentStepNumber","initialSteps","id","monthlyCharges","flowData","changeFlag","reverse"],defaults:{currentStepNumber:0,initialSteps:null,id:"",monthlyCharges:0,flowData:"",changeFlag:"",reverse:!1},emptyTopic:function(){this.empty()}});return d});
define("businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/commerce/contact-person/:contactId/customer/:customerId/product/:productId/submit-product-configuration",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},create:{method:"PUT",payload:["ImplSubmitProductConfigurationRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ValidateUniqueLogicalResourceModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/ordering/validate-bb",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplValidateUniqueLogicalResourceRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/CustomerProductOfferingInstanceModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product-offering/:productOfferingId/product-order",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},payload:["CreateNewOfferingConfigurationRequest"]}}}}),e=d.extend({});return e});
define("businesswidget/repository_l9_common/common/model/CustomerProductOfferingInstanceAnonymousModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/anonymous/product-offering/:productOfferingId/product-order",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},payload:["CreateNewOfferingConfigurationRequest"]}}}}),e=d.extend({});return e});
define("businesswidget/repository_l9_common/common/viewmodel/business/FreeMBBViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/CustomerProductOfferingInstanceModel","businesswidget/repository_l9_common/common/model/CustomerProductOfferingInstanceAnonymousModel","businesswidget/repository_l9_common/common/model/SearchAvailableNumbersModel","businesswidget/repository_l9_common/common/model/ReserveAndReleaseModel"],function (a,b,c,d,e,f,g,h,i){return a.Core.ObservableViewModel.extend({models:{productOfferingInstanceModel:f,productOfferingAnonymousModel:g,searchAvailableNumbersModel:h,reserveAndReleaseModel:i},subViewModels:{CustomerInContextTopicViewModel:d,orderInContextTopicViewModel:e},defaults:{tradeInDetails:null,tradeInVmStatus:""},initialize:function(){b.bindAll(this,"setHeaders","setDefaultQueryParams","createFreeMBBOrder","onProductOfferingInstanceError","processFreeMBBOrder","onFetchListofNumbersSuccess","returnSuccess")},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},createFreeMBBOrder:function(a,d,e,f,g,h){var i=this.subViewModels.orderInContextTopicViewModel,j=[],k=[],l="c"+Math.random().toString(36).substr(2,9);k.push({productSpecContainmentID:8363722,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:8022652,value:"3IN1"}]});var m,n=c.get("relaxInternetFilter");n?h&&(m={productSpecContainmentID:8363682,temporaryID:l,changedCharacteristics:[{characteristicID:9404583,value:"Yes"},{characteristicID:8622642,value:h}]}):(m={productSpecContainmentID:8363682,temporaryID:l,changedCharacteristics:[{characteristicID:12373511,value:"No"}]},h&&m.changedCharacteristics.push({characteristicID:9404583,value:"Yes"},{characteristicID:8622642,value:h})),m&&k.push(m);var o={changedContainedProducts:k};a&&d&&(j=[{productOfferingProductSpecID:f,temporaryID:l}],j[0].vendorCodeX8=d,j[0].dealerCodeX8=a,j[0].productChanges=o),payloadInput={returnConfiguration:"ALL",activityForConfiguration:null,runCompatibilityRules:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1},newProducts:j,productOrderID:g};var p=i.get("customerID");"undefined"!=typeof p&&null!==p?(this.models.productOfferingInstanceModel.set({customerId:p,productOfferingId:e}),this.models.productOfferingInstanceModel.save({CreateNewOfferingConfigurationRequest:payloadInput},{success:b.bind(this.processFreeMBBOrder,this),error:b.bind(this.onProductOfferingInstanceError,this)})):(this.models.productOfferingAnonymousModel.set({productOfferingId:e}),this.models.productOfferingAnonymousModel.save({CreateNewOfferingConfigurationRequest:payloadInput},{success:b.bind(this.processFreeMBBOrder,this),error:b.bind(this.onProductOfferingInstanceError,this)}))},onProductOfferingInstanceError:function(a,b,c){this.trigger("orderFailure")},processFreeMBBOrder:function(a,c,d){var e,f,g=c.CreateNewOfferingConfigurationResponse,h=this.subViewModels.orderInContextTopicViewModel.get("orderActions")||[],i=this.subViewModels.orderInContextTopicViewModel,j=(g.productOrderReferenceNumber,g.productOrderID);b.each(g.newProductsInNewOfferings,function(a){var b={productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productConfiguration.productSpecification.level,lob:a.productConfiguration.lineOfBusiness,planOnly:!0,flowType:"FIBER",orderType:a.productOrderItemType,isFreeMBB:!0};e=a.productOrderItemID,f=a.productID,h.push(b)}),i.set("orderActions",h);var k={type:"WIRELESS",numberOfResources:1,mobileBBRequired:!0},a=this.getModel("searchAvailableNumbersModel");a.set({orderId:j,orderItemId:e,productID:f}),a.save({ImplSearchAviableInput:k},{success:b.bind(this.onFetchListofNumbersSuccess,this,j,e,f),error:this.onProductOfferingInstanceError})},onFetchListofNumbersSuccess:function(a,b,c,d,e){var f=this;if("undefined"!=typeof e.ImplSearchAviableOutput){var g=e.ImplSearchAviableOutput.reservedNumbers,h=e.ImplSearchAviableOutput.signature,i={ImplReserveResourceNumberRequest:{resourceNumber:g.splice(0,1)[0],resourceType:"WIRELESS",numbersToBeReleased:g,signature:h}},d=f.getModel("reserveAndReleaseModel");d.set({orderId:a,orderItemId:b,productID:c}),d.setQueryParams({setFirstLoad:!0}),d.save(i,{success:f.returnSuccess,error:f.onProductOfferingInstanceError})}},returnSuccess:function(){this.trigger("dataSet")}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"],function (a,b,c,d){var e=a.Core.ObservableViewModel.extend({models:{getBillingAccountDetailedListModel:c},subViewModels:{OnePassTopicViewModel:d},defaults:{accounts:null},initialize:function(){b.bindAll(this,"getCustomerType","getBillingAccountDetails")},getBillingAccountDetails:function(){var a=this.subViewModels.OnePassTopicViewModel.get("nric"),c=this,d=$.Deferred();if(void 0!==typeof a&&""!==a&&null!==a){var e=c.subViewModels.OnePassTopicViewModel.get("customerIdType"),f=c.getCustomerType(e),g=c.getModel("getBillingAccountDetailedListModel");g.set("type",f),g.fetch({id:a,success:b.bind(c.billingAccountDetailedListSuccess,c,d),error:function(a){return function(b){c.set("accountsVmStatus","accuntsfailure"),a.reject("fail")}}(d)})}return d},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a},billingAccountDetailedListSuccess:function(a,c,d){for(var e=this,f=b.sortBy(d.ImplBillingAccountDetailsResponse.billingAccountDetails,"nickName"),g=0,h=0;h<f.length;h++)if("C"==f[h].baStatus&&g+h<f.length){var i=f.splice(h,1)[0];f[f.length++]=i,h--,g++}e.set("accounts",f),e.set("accountsVmStatus","accountsLoaded"),a.resolve(f)}});return e});
define("businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ObservableViewModel.extend({defaults:{storeContextDataVmStatus:"",deviceTopicValues:null,miniCartTopicValues:null,orderContextValues:null},initialize:function(){this._super(),this.set("storeContextDataVmStatus","vmInitialized")}})});
define("businesswidget/repository_l9_common/common/model/WorryFreeOtpSendModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree/otp/send",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplWorryFreeOTPInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/WorryFreeOtpVerifyModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree/otp/verify",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplWorryFreeOTPInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/WorryFreeOtpBillingActVerifyModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree/billingAccount/save/sendotp",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplWorryFreeOTPInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/WorryFreeDeleteModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree",rest:{"delete":{method:"DELETE"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["otpData","acceptorData"],defaults:{otpData:null,acceptorData:null},dataBindings:[],handleDependencies:function(){}});return d});
define("businesswidget/repository_l9_common/common/model/WorryFreeFtthLoginModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree/ftthlogin",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplWorryFreeOTPInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/WorryFreeAcceptorOtpSendModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree/otp/acceptor/send",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplWorryFreeOTPInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/WorryFreeAcceptorOtpVerifyModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/worryfree/otp/acceptor/verify",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplWorryFreeOTPInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/WorryFreeViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/model/WorryFreeOtpSendModel","single!businesswidget/repository_l9_common/common/model/WorryFreeOtpVerifyModel","single!businesswidget/repository_l9_common/common/model/WorryFreeOtpBillingActVerifyModel","single!businesswidget/repository_l9_common/common/model/WorryFreeDeleteModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/WorryFreeFtthLoginModel","single!businesswidget/repository_l9_common/common/model/WorryFreeAcceptorOtpSendModel","single!businesswidget/repository_l9_common/common/model/WorryFreeAcceptorOtpVerifyModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){
var q=a.Core.ObservableViewModel.extend({models:{worryFreeOtpSendModel:d,worryFreeOtpVerifyModel:e,worryFreeOtpBillingActVerifyModel:f,worryFreeDeleteModel:g,worryFreeFtthLoginModel:m,worryFreeAcceptorOtpSendModel:n,worryFreeAcceptorOtpVerifyModel:o},subViewModels:{worryFreeContextTopicViewModel:h,onePassTopicViewModel:i,individualInContextTopicViewModel:j,customerInContextTopicViewModel:k,contactInContextTopicViewModel:l,orderInContextTopicViewModel:p},defaults:{worryFreeVMStatus:null,otpInput:null,isOTPResend:!1,isWorryFreeLogin:!1},dataBindings:[{isWorryFreeLogin:"subViewModels.onePassTopicViewModel.isWorryFreeLogin",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){var a=this.isWorryFreePage();if(a){var b="businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel",c=window.sessionStorage.getItem(b);c&&(c=JSON.parse(c),c.isWorryFreeLogin&&(window.sessionStorage.setItem(b,"{}"),this.deleteWorryFreeWithTopics()))}this.set("worryFreeVMStatus","WorryFreeVMInitialized"),this.on("change:isWorryFreeLogin",this.onWorryFreeLoginChange,this)},onWorryFreeLoginChange:function(){var a=this.get("isWorryFreeLogin");a&&this.isWorryFreePage()&&this.deleteWorryFreeWithTopics()},deleteWorryFreeWithTopics:function(){return this.deleteWorryFree().then(function(){if(clearSecureTopicsList=c.get("clearCareTopicsList"),clearSecureTopicsList.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),clearSecureTopicsList.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"),clearSecureTopicsList.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),clearSecureTopicsList.length>0)for(var a=0;a<clearSecureTopicsList.length;a++){var b=clearSecureTopicsList[a];"businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"!==b&&window.sessionStorage.removeItem(b)}window.localStorage.removeItem("LightsaberSessionToken"),window.location.reload()}.bind(this))},isWorryFreePage:function(){var a=window.location.href,b=c.get("worryFreeStartPages");for(var d in b)if(a.indexOf(b[d])!==-1)return!0;return!1},sendWorryFreeOtp:function(){this.set("worryFreeVMStatus","WorryFreeSendOtpInit");var a=this.get("isOTPResend"),b=(this.get("otpInput"),this.models.worryFreeOtpSendModel);b.setQueryParams({cleanWorryFree:!a}),b.save({ImplWorryFreeOTPInput:this.getWorryFreePayload(1)},{success:function(a,b){var b=b&&b.ImplWorryFreeOTPOutput,c=this.get("isOTPResend");b&&b.newCustomer?this.set("worryFreeVMStatus","WorryFreeNewCustomer"):b&&!b.newCustomer&&c&&b.otpSend?this.set("worryFreeVMStatus","WorryFreeExistingCustomerReSendOTP"):b&&!b.newCustomer&&b.otpSend&&!b.facheckRequired?this.set("worryFreeVMStatus","WorryFreeExistingCustomer"):b&&!b.newCustomer&&!b.otpSend&&b.facheckRequired&&this.set("worryFreeVMStatus","WorryFreeOtpSendFACheckReequired"),this.set("isOTPResend",!1)}.bind(this),error:function(a,b){var c=b.responseJSON;if(c&&c.ErrorInfo&&"Exceed OTP limit"==c.ErrorInfo.errorCode)this.set("worryFreeVMStatus","WorryFreeOTPAttemptExceed");else{this.get("isOTPResend");this.set("worryFreeVMStatus","WorryFreeOtpSendFailed"),this.set("isOTPResend",!1)}}.bind(this)})},verifyWorryFreeOtp:function(){this.set("worryFreeVMStatus","WorryFreeOtpVerifyInit");var a=this.models.worryFreeOtpVerifyModel,b=this.get("otpInput");a.save({ImplWorryFreeOTPInput:this.getWorryFreePayload(2)},{success:function(a,d){var d=d&&d.ImplWorryFreeOTPOutput;if(d)if(d.otpVerified&&d.faverified){var e=this.subViewModels.onePassTopicViewModel.get("nric");if(e&&e.length>0&&e!==this.getValueByPath("otpInput.indentValue")){var f=c.get("clearCareTopicsList");if(f.length>0)for(var g=0;g<f.length;g++){var h=f[g];window.sessionStorage.removeItem(h)}this.subViewModels.orderInContextTopicViewModel.set("isChangeUserScenario",!0)}if("Passport Number"===b.indentType){var i=this.subViewModels.worryFreeContextTopicViewModel.get("acceptorData")||{};d.acceptorContactId&&(i.contactId=d.acceptorContactId),d.acceptorCustomerIds&&d.acceptorCustomerIds.length&&(i.customerIds=d.acceptorCustomerIds),this.setCustomerDataOnTopics(d);var j=this.subViewModels.worryFreeContextTopicViewModel.get("otpData"),k={contactId:d.contactId,customerId:d.customerIds[0]};j.passportDetails=k,this.subViewModels.worryFreeContextTopicViewModel.set("otpData",j),this.subViewModels.worryFreeContextTopicViewModel.set("acceptorData",i),d.acceptorNewCustomer?this.set("worryFreeVMStatus","AcceptorNewCustomer"):d.acceptorMobileSubscriberExist?this.set("worryFreeVMStatus","AcceptorMobileExists"):d.acceptorContactSubscriptionExists&&this.set("worryFreeVMStatus","AcceptorSubExists")}else this.setCustomerDataOnTopics(d),this.set("worryFreeVMStatus","WorryFreeLoginSuccess")}else d.otpVerified||d.otpSend||!d.facheckRequired?!d.otpVerified&&d.otpSend?this.set("worryFreeVMStatus","WorryFreeOTPVerificationFailed"):this.set("worryFreeVMStatus","WorryFreeVerificationFailed"):this.set("worryFreeVMStatus","WorryFreeFAVerificationFailed");else this.set("worryFreeVMStatus","WorryFreeVerificationFailed")}.bind(this),error:function(){this.set("worryFreeVMStatus","WorryFreeVerificationError")}.bind(this)})},verifyBillingActWorryFreeOtp:function(){this.set("worryFreeVMStatus","WorryFreeOtpBillingActVerifyInit");var a=(this.get("otpInput"),this.models.worryFreeOtpBillingActVerifyModel);a.save({ImplWorryFreeOTPInput:this.getWorryFreePayload(3)},{success:function(a,b){var b=b&&b.ImplWorryFreeOTPOutput;b&&b.otpSend?this.set("worryFreeVMStatus","WorryFreeFASavedAndOTPSent"):this.set("worryFreeVMStatus","WorryFreeFASavedAndOTPSentFailed")}.bind(this),error:function(a,b){response=b.responseJSON,response&&response.ErrorInfo&&"Exceed OTP limit"==response.ErrorInfo.errorCode?this.set("worryFreeVMStatus","WorryFreeFASavedAndOTPAttemptExceed"):this.set("worryFreeVMStatus","WorryFreeFASavedAndOTPSentError")}.bind(this)})},setAcceptorDataOnTopics:function(a){var b=this.subViewModels.worryFreeContextTopicViewModel.get("acceptorData")||{};a.contactId&&(b.contactId=a.contactId),a.customerIds&&a.customerIds.length&&(b.customerIds=a.customerIds),this.subViewModels.worryFreeContextTopicViewModel.set("acceptorData",b)},setCustomerDataOnTopics:function(a){var b=this.subViewModels.worryFreeContextTopicViewModel.get("otpData");a.contactId&&(this.subViewModels.contactInContextTopicViewModel.set("ID",a.contactId),this.subViewModels.individualInContextTopicViewModel.set("personId",a.contactId),b.contactId=a.contactId),a.customerIds&&a.customerIds.length&&(this.subViewModels.customerInContextTopicViewModel.set("ID",a.customerIds[0]),this.subViewModels.customerInContextTopicViewModel.set("customerIds",a.customerIds),b.customerIds=a.customerIds),this.subViewModels.worryFreeContextTopicViewModel.set("otpData",b)},deleteWorryFree:function(){this.set("worryFreeVMStatus","deleteWorryFreeInit");var a=$.Deferred();return this.subViewModels.worryFreeContextTopicViewModel.set("otpData",null),this.subViewModels.worryFreeContextTopicViewModel.set("acceptorData",null),this.models.worryFreeDeleteModel.set("id",""),this.models.worryFreeDeleteModel.destroy({async:!1,success:function(b,c){this.set("worryFreeVMStatus","deleteWorryFreeSuccess"),a.resolve()}.bind(this),error:function(){this.set("worryFreeVMStatus","deleteWorryFreeError"),a.resolve()}.bind(this)}),a},getWorryFreePayload:function(a){var b=this.get("otpInput");if(b){var c={mobileNumber:b.mobileNumber,indentType:b.indentType,indentValue:b.indentValue,lob:b.lob,type:b.type,acceptorIndentValue:b.acceptorIndentValue,acceptorIndentType:b.acceptorIndentType};switch(a){case 1:c.faCheckMandatory=b.faCheckMandatory;break;case 2:c.otp=b.otp;break;case 3:c.billingAccountNumber=b.billingAccountNumber;break;case 4:c.postalCode=b.postalcode,c.faCheckMandatory=!1}return this.subViewModels.worryFreeContextTopicViewModel.set("otpData",b),c}},sendWorryFreePostcode:function(){this.set("worryFreeVMStatus","WorryFreePostcodeInit"),this.models.worryFreeFtthLoginModel.save({ImplWorryFreeOTPInput:this.getWorryFreePayload(4)},{success:function(a,b){var b=b&&b.ImplWorryFreeOTPOutput;this.get("isOTPResend");b.otpVerified?(this.setCustomerDataOnTopics(b),this.set("worryFreeVMStatus","WorryFreeLoginSuccess")):b&&!b.contactExists?this.set("worryFreeVMStatus","WorryFreeFtthNricNotFound"):b&&b.contactExists&&b.customerExists&&!b.contactSubscriptionExists?this.set("worryFreeVMStatus","WorryFreePostCodeNotFound"):b&&b.contactExists&&b.customerExists&&b.contactSubscriptionExists&&!b.otpVerified?this.set("worryFreeVMStatus","WorryFreePostCodeNotFound"):this.set("worryFreeVMStatus","WorryFreeFtthLoginFailed")}.bind(this),error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo&&"Exceed OTP limit"==c.ErrorInfo.errorCode?this.set("worryFreeVMStatus","WorryFreePostcodeAttemptExceed"):this.set("worryFreeVMStatus","WorryFreeFtthLoginFailed")}.bind(this)})},sendAcceptorWorryFreeOtp:function(){var a=this,b=a.get("otpInput"),c={mobileNumber:b.acceptorMobileNumber,indentType:b.acceptorIndentType,indentValue:b.acceptorIndentValue,lob:b.lob},b=this.get("otpInput"),d=this.models.worryFreeAcceptorOtpSendModel;d.setQueryParams({cleanWorryFree:!0}),d.save({ImplWorryFreeOTPInput:c},{success:function(a,b){var b=b&&b.ImplWorryFreeOTPOutput,c=this.get("isOTPResend");b&&c&&b.otpSend&&!b.facheckRequired?this.set("worryFreeVMStatus","WorryFreeAcceptorReSendOTPSuccess"):b&&b.otpSend&&!b.facheckRequired?this.set("worryFreeVMStatus","WorryFreeAcceptorOTPSuccess"):b&&!b.otpSend&&b.facheckRequired&&this.set("worryFreeVMStatus","WorryFreeAcceptorOTPFailed")}.bind(this),error:function(a,b){var c=b.responseJSON;if(c&&c.ErrorInfo&&"Exceed OTP limit"==c.ErrorInfo.errorCode)this.set("worryFreeVMStatus","WorryFreeAcceptorOTPAttemptExceed");else{this.get("isOTPResend");this.set("worryFreeVMStatus","WorryFreeAcceptorOtpSendFailed"),this.set("isOTPResend",!1)}}.bind(this)})},verifyAcceptorWorryFreeOtp:function(){this.set("worryFreeVMStatus","verifyAcceptorWorryFreeOtp");var a=this.models.worryFreeAcceptorOtpVerifyModel,b=this.get("otpInput");if(b){var c={mobileNumber:b.acceptorMobileNumber,indentType:b.acceptorIndentType,indentValue:b.acceptorIndentValue,lob:b.lob,otp:b.prepaidOtpNumber,billingAccountNumber:b.acceptorAccountNumber};a.save({ImplWorryFreeOTPInput:c},{success:function(a,b){var b=b&&b.ImplWorryFreeOTPOutput;b?b.otpVerified&&b.faverified?(this.setCustomerDataOnTopics(b),this.set("worryFreeVMStatus","WorryFreeAcceptorLoginSuccess")):b.otpVerified||b.otpSend||!b.facheckRequired?!b.otpVerified&&b.otpSend?this.set("worryFreeVMStatus","WorryFreeOTPAcceptorVerificationFailed"):this.set("worryFreeVMStatus","WorryFreeAcceptorVerificationFailed"):this.set("worryFreeVMStatus","WorryFreeAcceptorFAVerificationFailed"):this.set("worryFreeVMStatus","WorryFreeAcceptorVerificationFailed")}.bind(this),error:function(){this.set("worryFreeVMStatus","WorryFreeAcceptorVerificationError")}.bind(this)})}}});return q});
define("businesswidget/repository_l9_common/common/model/SelfCollectNowRetrieveModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){function c(a){if(a.ImplEnquireAvailableStockResponse&&a.ImplEnquireAvailableStockResponse.implPOPStationDetails){var b=a.ImplEnquireAvailableStockResponse.implPOPStationDetails;b.length>0&&_.each(b,function(a){a.postalCode=a.PostCode,a.lat=a.latitude,a.lon=a.longitude,a.ZipCode=a.postalCode,a.slotCode="S4"})}return a}var d=b.extend({options:{url:"/sdp/lamp/enquireAvailableStock",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"POST",contentType:"application/json",payload:["ImplEnquireAvailableStockRequest"]}}},parse:c});return d});
define("businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/commerce/customer/:customerId/product-order/:productOrderId/quote",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["RetrieveQuoteRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestAnonymousModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/commerce/anonymous/product-order/:productOrderId/quote",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["RetrieveQuoteRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestCustomModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/commerce/customer/:customerId/product-order/:productOrderId/quote-with-address",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["RetrieveQuoteRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/MobileShareAllowanceModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/contact-person/:contactId/group-list",rest:{defaults:{method:"GET",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel",["lightsaber","Configuration","underscore","moment","businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestModel","businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestAnonymousModel","businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestCustomModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/MobileShareAllowanceModel"],function (a,b,c,d,e,f,g,h,i,j,k,l){return a.Core.ObservableViewModel.extend({models:{retrieveQuoteRequestModel:e,retrieveQuoteRequestAnonymousModel:f,retrieveQuoteRequestCustomModel:g,mobileShareAllowanceModel:l},subViewModels:{customerInContextTopicViewModel:h,orderInContextTopicViewModel:i,individualInContextTopicViewModel:j,deviceIdAndPlanIdInContextTopic:k},defaults:{orderData:null,shoppingCartVmStatus:"",address:null,minTenure:[],selectedDevices:null,selectedDevicesSku:null,selectedMobilePlans:null,selectedAddons:null,selectedTVPlans:null,selectedBundlePlans:null,allBillingOffers:null,selectedFVPlans:null,deposite:null,selectedPromotions:null,hasSim:!1,isShoppingCartFlag:!1,selectedFreebies:null,selectedAccessories:null,dashPayment:!1,existingLines:null,hasCisStaff:!1,hasYouthSilverPlans:!1,cartPurchaseDetails:{hasPurchasedSim:!1,hasPurchasedTablet:!1,hasPurchasedHandset:!1,hasTradeIn:!1,hasRecontract:!1,hasPurchasedAccessories:!1,hasPurchasedFreegifts:!1,isPortin:!1,isNewNumber:!1,brandsPurchased:[],msisdns:[],itemsInCart:0,hasPurchasedRG:!1,hasSharedEquipment:!1,isEasyMobileOrder:!1,barNumberX8:null,hasPurchasedWifi:!1},invalidPromo:!0,productDetails:[],negativeAmountOrderActions:[],gamerVasChanges:null,mobileShareOffers:["8517942","14308172","14317472","25972184","25988684","26019054"],simOnlyOffers:["10028151","18645001","18628721","13993801","14005551","18645501","26559124","19363071","19387011","19410951","19434891"],easyMobileComponentIds:["8494592","11621331","11633931","11615031"],selectedAccessoriesSkuIds:[],selectedDevicesSkuList:[],selectedFreebiesSkuList:[],selectedSimSkuList:[],barId:null,chargeableEmail:null,hasFreeMBB:!1,needsOnlyMBBDelivery:!1,premiumAddonDetails:[],mobileContentList:[]},initialize:function(a){c.bindAll(this,"loadShoppingCartData","createBundleComponentsForCart","createOrderDataObject","createOrderDataObjectMapping","createBundleObject","createItemObject","createCustomePropertiesForItem","getDevice","getSIM","populateSharedEquipment","getPlan","getService","calculateCheckoutPrice","getAddons","populateMobileObjects","populateOneTimeAndCheckoutPayment","populateBundleObjects","getPremiumAddons","populateVoiceObjects","populateBroadbandObjects","populateTVObjects","createContextTopic","populateMobileItem","createOrderObject","populateMobileContent","calculateMobileContentPrice","getNewlyAddedSimDetails","calculateInstallationPrice","populateMobileAccessories","populatePromoCodeAndCoupons","calculateOffSetPrice","getSimOnlyTabletAddon","populateChargeableEmailDetails","calculateMobileContentOneTimePrice","handleInstallmentSpecialPrice")},loadShoppingCartData:function(a,b,d,e){var f=this,g=$.Deferred(),h=f.subViewModels.orderInContextTopicViewModel.get();if("undefined"!=typeof h.productOrderID&&null!==h.productOrderID){var i,j=h.customerID||e,k={RetrieveQuoteRequest:{links:[],productOrderReferenceNumber:h.productOrderReferenceNumber,activityForConfiguration:b,returnQuoteData:{links:[],quotedItemsInd:!0,taxInformationInd:!0,configurationItemsInd:!0,returnRemovedItems:!0,crossProductDiscountsInd:!0}}};if("undefined"!=typeof j&&null!==j&&""!==j)if(a){k.RetrieveQuoteRequest.shouldCheckForGen3UpgradeEligibilityX8=!0,k.RetrieveQuoteRequest.activityForConfiguration="QuoteSDAllDiscounts",i=f.getModel("retrieveQuoteRequestCustomModel");var l=f.get("dashPayment");l&&i.setQueryParams({contactId:f.subViewModels.individualInContextTopicViewModel.get("personId"),cd:!0}),i.save(k,{customerId:j,productOrderId:h.productOrderID,success:c.bind(f._onRetrieveQuoteOrderSummarySuccess,f,g),error:c.bind(f._onRetrieveQuoteError,f,g)})}else i=f.getModel("retrieveQuoteRequestModel"),i.save(k,{customerId:j,productOrderId:h.productOrderID,success:c.bind(f._onRetrieveQuoteSuccess,f,g),error:c.bind(f._onRetrieveQuoteError,f,g)});else i=f.getModel("retrieveQuoteRequestAnonymousModel"),i.save(k,{productOrderId:h.productOrderID,success:c.bind(f._onRetrieveQuoteSuccess,f,g),error:c.bind(f._onRetrieveQuoteError,f,g)})}return g},_onRetrieveQuoteOrderSummarySuccess:function(a,b,c){var d=c.ImplCustomerProductOrderQuoteWithAddressOutput,e={deliveryAddress:d.deliveryAddress,billingAddress:d.billingAddress,isBlockOrder:d.isBlockOrder,isAmbassadorOrder:d.isAmbassadorOrder,isUpgradePromoOrder:d.isUpgradePromoOrder};"undefined"!=typeof d.installationAddress&&(e.installationAddress=d.installationAddress),"undefined"!=typeof d.singtelInstallationDate&&(e.installationDate=d.singtelInstallationDate),"undefined"!=typeof d.singtelTimeSlot&&(e.installationTime=d.singtelTimeSlot),"undefined"!=typeof d.netlinkTimeSlot&&(e.netlinkInstallationTime=d.netlinkTimeSlot),"undefined"!=typeof d.netlinkInstallationDate&&(e.netlinkInstallationDate=d.netlinkInstallationDate),"undefined"!=typeof d.deliveryStartDateAndTime&&(e.deliveryStartDateAndTime=d.deliveryStartDateAndTime),"undefined"!=typeof d.deliveryTimeSlot&&(e.deliveryTimeSlot=d.deliveryTimeSlot),"undefined"!=typeof d.serviceRequiredDate&&e.billingAddress&&(e.billingAddress.serviceRequiredDate=d.serviceRequiredDate),"undefined"!=typeof d.serviceRequiredDate&&e.deliveryAddress&&(e.deliveryAddress.serviceRequiredDate=d.serviceRequiredDate),this.set("address",e),this.set("barId",d.quoteInfo.order.barNumberX8),this.set("deposite",d.quoteInfo.order.totalDeposit.actualAmount),this.getAllBillingOfferId(d.quoteInfo.order),this.createBundleComponentsForCart(a,d.quoteInfo.order)},getAllBillingOfferId:function(a){var b=c.map(a.productOfferings,function(a,b){var d=a.productOrderItems?a.productOrderItems:[],e=c.pluck(d,"displayableItems");return e}),d=c.flatten(c.pluck(c.flatten(b),"displayableBillingOffers")),e=[];c.each(d,function(a){a&&a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&a.productSpecPricing.childPricingSchema.id&&e.push(a.productSpecPricing.childPricingSchema.id)}),this.set("allBillingOffers",e)},createContextTopic:function(a){var d=this,e=d.subViewModels.orderInContextTopicViewModel.get("orderActions"),f=d.subViewModels.orderInContextTopicViewModel;f.set("productOrderReferenceNumber",a.productOrderReferenceNumber);var g=a.productOfferings,h=[],i=d.get("mobileShareOffers");if("undefined"!=typeof g&&g.length>0){var j=[],k=d.get("simOnlyOffers");c.each(g,function(a){var g,l,m=a.bundle;if(m&&(l="FIBER"),a.productOrderItems&&a.productOrderItems.length>0){var n=!1;c.each(a.productOrderItems,function(a){h.push(a.productOrderItemID);var o=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("installationAddressID");if(!a.installationAddressID||"undefined"!=typeof o&&null!==o||d.subViewModels.deviceIdAndPlanIdInContextTopic.set("installationAddressID",a.installationAddressID),"TV"===a.lineOfBusiness||"FV"===a.lineOfBusiness&&!m?l="TV":"WS"===a.lineOfBusiness&&(c.contains(i,a.productOfferingID)?l="mobileSharePlan":c.contains(k,a.productOfferingID)?l="simOnlyPlan":c.contains(b.get("mbbOfferIds"),a.productOfferingID)&&(l="FIBER",n=!0)),"undefined"!=typeof g&&null!==g||(g=a.productOrderItemType),null===e||0===e.length)j.push({productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productSpecificationLevel,lob:a.lineOfBusiness,orderType:g,flowType:l,isFreeMBB:n});else{var p=!0,q=!1;c.each(e,function(b){b.productOrderItemID===a.productOrderItemID&&(b.orderType===g,!l||"undefined"!=typeof b.flowType&&null!==b.flowType||(b.flowType=l,q=!0),p=!1)}),p&&(e.push({productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productSpecificationLevel,lob:a.lineOfBusiness,orderType:g,flowType:l}),q=!0),q&&f.set("orderActions",e)}})}}),j.length>0?f.set("orderActions",j):h.length>0&&(e=d.subViewModels.orderInContextTopicViewModel.get("orderActions"),e=c.filter(e,function(a){return c.contains(h,a.productOrderItemID)}),f.set("orderActions",e))}},_onRetrieveQuoteSuccess:function(a,b,c){this.set("barId",c.RetrieveQuoteResponse.order.barNumberX8),this.createBundleComponentsForCart(a,c.RetrieveQuoteResponse.order)},_onRetrieveQuoteError:function(a,b,c){a.reject(c)},createBundleComponentsForCart:function(a,b){var c={};this.set("selectedDevices",c),this.set("selectedFreebies",null),this.set("selectedAccessories",null),this.set("negativeAmountOrderActions",[]),this.createContextTopic(b),this.createOrderDataObject(b),this.createOrderObject(a,b)},createOrderDataObject:function(a){var b={};if(void 0===b.order&&(b.order={bundle:[],mobile:[],tv:[],fv:[],sharedEquipment:[]}),void 0===b.paymentMethodFilters&&(b.paymentMethodFilters={}),void 0!=a){b.order.id=a.productOrderID;var c;a.productOfferings[0].totalOneTimeCalculatedPrice&&a.productOfferings[0].totalOneTimeCalculatedPrice.currency?c=a.productOfferings[0].totalOneTimeCalculatedPrice.currency:a.productOfferings[0].totalRecurringCalculatedPrice&&a.productOfferings[0].totalRecurringCalculatedPrice.currency&&(c=a.productOfferings[0].totalRecurringCalculatedPrice.currency),b.order.currency=c,b.order.status=a.status,b.order.referenceNumber=a.productOrderReferenceNumber,b.order.recurringPrice=a.totalRecurringCalculatedPrice,b.order=this.populateOneTimeAndCheckoutPayment(b.order,a)}return this.set("orderData",b),b},populateOneTimeAndCheckoutPayment:function(a,b){return a.recurringPrice={finalAmountIncludingTax:b.totalRecurringCalculatedPrice.finalAmountIncludingTax,finalAmount:b.totalRecurringCalculatedPrice.finalAmount,finalTaxAmount:b.totalRecurringCalculatedPrice.finalTaxAmount},a.oneTimePrice={finalAmountIncludingTax:b.totalOneTimeCalculatedPrice.finalAmountIncludingTax,finalAmount:b.totalOneTimeCalculatedPrice.finalAmount,finalTaxAmount:b.totalOneTimeCalculatedPrice.finalTaxAmount},a.checkoutPrice={finalAmountIncludingTax:0,finalAmount:0,finalTaxAmount:0},a},populateMobileItem:function(a,d,e,f,g){var h=this;f.lob="mobile";var i=!1,j="Singtel Mobile",k=h.get("mobileShareOffers");c.contains(k,a.productOfferingID)&&(j+="  (Mobile Share)"),f.categoryName=j,f.productOfferingID=a.productOfferingID,"undefined"!=typeof a.productServiceID&&(f.subscriptionId="+65 "+a.productServiceID,f.serviceId=a.productServiceID);var l,m=this.getDevice(a),n=m.devices,o=h.subViewModels.orderInContextTopicViewModel.get("orderActions"),p=!1,q=!1;c.each(o,function(b){b.productOrderItemID===a.productOrderItemID&&(b.isPPOrder&&(q=b.isPPOrder),p=b.planOnly)}),f.isPPOrder=q;var r=this.populateMobileObjects(a);f.ciTier=r.ciTier;var s=h.get("cartPurchaseDetails");if(n&&n.length>0){var t=h.get("negativeAmountOrderActions");c.each(n,function(b){b.checkoutPrice&&b.checkoutPrice.finalAmountIncludingTax<0&&!c.contains(t,a.productOrderItemID)&&t.push(a.productOrderItemID)}),h.set("negativeAmountOrderActions",t)}p?(f.planDetails=r.planDetails,n&&n.length>0&&(f.deviceDetails=n,"Tablet"===n[0].deviceType&&(i=!0,f.isTablet=!0,f.showTradein=!1,s.hasPurchasedTablet=!0),l=n[0].deviceProductId,s.hasPurchasedHandset=!0,m.ippTotalCharges&&m.ippCharges&&(f.ippTotalCharges=m.ippTotalCharges,f.ippCharges=m.ippCharges),m.ippChargesPenalty&&(f.ippChargesPenalty=m.ippChargesPenalty))):(n&&n.length>0&&(f.deviceDetails=n,"Tablet"===n[0].deviceType&&(i=!0,f.isTablet=!0,f.showTradein=!1,s.hasPurchasedTablet=!0),l=n[0].deviceProductId,s.hasPurchasedHandset=!0,m.ippTotalCharges&&m.ippCharges&&(f.ippTotalCharges=m.ippTotalCharges,f.ippCharges=m.ippCharges),m.ippChargesPenalty&&(f.ippChargesPenalty=m.ippChargesPenalty)),f.planDetails=r.planDetails),m.repaymentChanges&&(f.repaymentChanges=m.repaymentChanges),c.contains(b.get("mbbOfferIds"),a.productOfferingID)&&(f.isFreeMBB=!0,f.categoryName="Singtel Mobile Broadband",i=!0,f.showTradein=!1),r.isEasyMobileOrder&&(s.isEasyMobileOrder=!0),r.staffDiscount&&(f.staffDiscount=r.staffDiscount),r.penalityFees&&(f.penalityFees=r.penalityFees),r.deliveryDetails&&(f.deliveryDetails=r.deliveryDetails),r.cisDiscount&&(f.cisDiscount=r.cisDiscount,h.set("hasCisStaff",!0)),r.specialDiscounts&&(f.specialDiscounts=r.specialDiscounts),r.mainLineDetails&&(f.mainLineDetails=r.mainLineDetails),r.simDetails&&(f.simDetails=r.simDetails,s.hasPurchasedSim=!0),r.simRegisteration&&(f.simRegisteration=r.simRegisteration),r.serviceContractPenalty&&(f.serviceContractPenalty=r.serviceContractPenalty),r.promotions&&r.promotions.length>0&&(f.promotions=r.promotions),r.freeGifts&&r.freeGifts.length>0&&(f.freeGifts=r.freeGifts,s.hasPurchasedFreegifts=!0),r.tradeIn&&(f.tradeIn=r.tradeIn,f.showTradein=!1,s.hasTradeIn=!0),r.vouchers&&(f.vouchers=r.vouchers),r.mobileContents&&(f.mobileContents=r.mobileContents),r.mobileAccessories&&(f.accessories=r.mobileAccessories,s.hasPurchasedAccessories=!0),r.appleCare&&(f.appleCare=r.appleCare),a.productServiceID&&(f.number={details:"+65 "+a.productServiceID,oneTimePrice:{finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},recurringPrice:{finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},checkoutPrice:{finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0}},("Change"===a.productOrderItemType||"Change Ownership"===a.productOrderItemType||i)&&(f.number.noChange=!0)),"staff"===g&&(f.categoryName=f.categoryName+"  (Staff)"),f.isFreeMBB||(f.addons=r.addons),"Change"===a.productOrderItemType?(s.hasRecontract=!0,f.isRecon=!0):r.isPortin?(s.isPortin=!0,f.isPortin=!0):s.isNewNumber=!0;var u=[];r.freeGifts&&r.freeGifts.length>0&&c.each(r.freeGifts,function(a){a.productID&&u.push(a.productID)});var v=[];return r.mobileAccessories&&r.mobileAccessories.length>0&&c.each(r.mobileAccessories,function(a){a.productID&&v.push(a.productID)}),f.orderDetails={msisdn:a.productServiceID,simProductId:r.simProductId,productOrderItemType:a.productOrderItemType,orderActionId:a.productOrderItemID,deviceProductId:l,notFreeMBB:!f.isFreeMBB,freebiesIds:u,accessoriesIds:v},(r.simProductId||n&&n.length>0)&&(s.itemsInCart=s.itemsInCart+1),s.msisdns.push(a.productServiceID),h.set("cartPurchaseDetails",s),f},createItemObject:function(a,b,d,e){var f=this.createCustomePropertiesForItem(a);f.showTradein=!0;var g=a;f.productOrderItemID=g.productOrderItemID,f.productSpecificationLevel=g.productSpecificationLevel,f.productID=g.productID;var h=this,i=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");switch(g.lineOfBusiness){case"WS":f=h.populateMobileItem(g,b,d,f,i);break;case"FV":var j=g.productSpecificationLevel;if("S"===j){var k=this.populateVoiceObjects(g,g.productName,d);f.serviceDetails=k.serviceDetails,f.addons=k.addons,f.landlineNumber=k.landlineNumber,f.installationAddressID=g.installationAddressID,d||(f.lob="fv",f.subscriptionId=g.productServiceID,f.categoryName="Singtel Home Digital Line",f.fvPlanDetails="+65 "+k.fvPlanDetails,"staff"===i&&(f.categoryName=f.categoryName+"  (Staff)")),k.penalityFees&&(f.penalityFees=k.penalityFees)}else{var k=this.populateBundleObjects(g,b);f.serviceDetails=[],k.addons&&k.addons.length>0&&(f.addons=k.addons),k.serviceDetails&&c.each(k.serviceDetails,function(a){a.isPlan?f.broadBandPlanDetails=a:f.serviceDetails.push(a)}),k.penalityFees&&(f.penalityFees=k.penalityFees)}break;case"TV":f.lob="tv",f.categoryName="Singtel TV","staff"===i&&(f.categoryName=f.categoryName+"  (Staff)"),f.subscriptionId=g.productServiceID;var k=this.populateTVObjects(g);f.isRecon=k.isRecon,f.tvPlanDetails=k.tvPlanDetails,f.installationAddressID=g.installationAddressID,f.serviceDetails=k.serviceDetails,f.addons=k.addons,f.topup=k.topup,f.fibreInstallationCharges=k.fibreInstallationCharges,k.penalityFees&&(f.penalityFees=k.penalityFees),k.staffDiscount&&(f.staffDiscount=k.staffDiscount),k.specialDiscounts&&(f.specialDiscounts=k.specialDiscounts);break;case"BB":var k=this.populateBroadbandObjects(g);if(this.populateChargeableEmailDetails(k),f.isRecon=k.isRecon,f.addons=k.addons,k.premiumAddons&&k.premiumAddons.length>0){f.premiumAddons=k.premiumAddons;var l=this.get("cartPurchaseDetails");l.hasPurchasedWifi=!0,this.set("cartPurchaseDetails",l)}k.deliveryDetails&&(f.deliveryDetails=k.deliveryDetails),f.singnetId=k.singnetId||k.productServiceID,f.installationAddressID=g.installationAddressID,f.fibreInstallationCharges=k.fibreInstallationCharges,k.serviceDetails&&k.serviceDetails.length>0&&(f.serviceDetails=k.serviceDetails);break;default:f.lob="sharedEquipment";var k=this.populateSharedEquipment(g);k.netlinkInstallationCharges&&(f.netlinkInstallationCharges=k.netlinkInstallationCharges)}return f},createOrderObject:function(a,b){var d=this,e=d.get("mobileShareOffers"),f=c.find(b.productOfferings,function(a){var b=!1;if(!a.bundle){var d=c.find(a.productOrderItems,function(a){return c.contains(e,a.productOfferingID)});d&&(b=!0)}return b}),g=d.get("existingLines");if(!f||"undefined"!=typeof g&&null!==g)d.createOrderDataObjectMapping(a,b);else{var h=d.subViewModels.individualInContextTopicViewModel.get("personId");if("undefined"!=typeof h&&null!==h){var i=d.getModel("mobileShareAllowanceModel");i.setQueryParams({isMBB:!1}),i.fetch({contactId:h,success:function(e,f){var g=f.ImplGetGroupListOutput;"undefined"!=typeof g&&"undefined"!=typeof g.implCustomerGroupIdsList&&(c.each(g.implCustomerGroupIdsList,function(a){c.each(a.implGroupId,function(a){if("undefined"!=typeof a.implPlanDetails&&"undefined"!=typeof a.implPlanDetails.description&&(a.planDetailsdesc=a.implPlanDetails.description.split(",")),a.isBroadBand=!1,"undefined"!=typeof a.implPlanDetails&&"undefined"!=typeof a.implPlanDetails.name){var b=a.implPlanDetails.name;b&&b.toUpperCase().indexOf("BROADBAND")>-1&&(a.isBroadBand=!0)}})}),d.set("existingLines",g),d.createOrderDataObjectMapping(a,b))},error:c.bind(d._onRetrieveQuoteError,d,a)})}else d.createOrderDataObjectMapping(a,b)}},adjustIppCharges:function(a,b){var c=a.oneTimePrice,d=b.oneTimePrice,e=a.recurringPrice,f=b.recurringPrice;
a.ippTotalCharges&&a.ippCharges&&(c.finalAmount=c.finalAmount-a.ippTotalCharges.oneTimePrice.finalAmount,c.finalTaxAmount=c.finalTaxAmount-a.ippTotalCharges.oneTimePrice.finalTaxAmount,c.finalAmountIncludingTax=c.finalAmountIncludingTax-a.ippTotalCharges.oneTimePrice.finalAmountIncludingTax,a.oneTimePrice=c,d.finalAmount=d.finalAmount-a.ippTotalCharges.oneTimePrice.finalAmount,d.finalTaxAmount=d.finalTaxAmount-a.ippTotalCharges.oneTimePrice.finalTaxAmount,d.finalAmountIncludingTax=d.finalAmountIncludingTax-a.ippTotalCharges.oneTimePrice.finalAmountIncludingTax,b.oneTimePrice=d,e.finalAmount=e.finalAmount+a.ippCharges.recurringPrice.finalAmount,e.finalTaxAmount=e.finalTaxAmount+a.ippCharges.recurringPrice.finalTaxAmount,e.finalAmountIncludingTax=e.finalAmountIncludingTax+a.ippCharges.recurringPrice.finalAmountIncludingTax,a.recurringPrice=e,f.finalAmount=f.finalAmount+a.ippTotalCharges.recurringPrice.finalAmount,f.finalTaxAmount=f.finalTaxAmount+a.ippTotalCharges.recurringPrice.finalTaxAmount,f.finalAmountIncludingTax=f.finalAmountIncludingTax+a.ippTotalCharges.recurringPrice.finalAmountIncludingTax,b.recurringPrice=f)},createOrderDataObjectMapping:function(a,b){var d,e,f=this.get("orderData"),g=this;if(c.each(b.productOfferings,function(b){b.bundle?f.order.bundle.push(g.createBundleObject(b,a,f)):c.each(b.productOrderItems,function(b){var h=g.createItemObject(b,null,!1,a);if(h.productOrderItemType=b.productOrderItemType,"mobile"===h.lob){var i,j=h.deviceDetails,k=h.promotions;k&&(i={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},c.each(k,function(a){i=g.calculateCheckoutPrice(a,h,f,i,!0)}));var l,m=h.tradeIn;m&&(l={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},l=g.calculateCheckoutPrice(m,h,f,l,!0));var n,o=h.vouchers;o&&(n={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},c.each(o,function(a){n=g.calculateCheckoutPrice(a,h,f,n,!0)}));var p;j&&(p={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},c.each(j,function(a){p=g.calculateCheckoutPrice(a,h,f,p,!0)}));var q;h.accessories&&(q={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},c.each(h.accessories,function(a){q=g.calculateCheckoutPrice(a,h,f,q,!0)}));var r;h.appleCare&&(r={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},c.each(h.appleCare,function(a){r=g.calculateCheckoutPrice(a,h,f,r,!0)}));var s,t=h.repaymentChanges;t&&(s={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},s=g.calculateCheckoutPrice(t,h,f,s,!0));var u,v=h.deliveryDetails;v&&v.isImmediateCharge&&(u={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},u=g.calculateCheckoutPrice(v,h,f,u,!0));var w=h.mobileContents;if(w&&w.length>0){var x=g.get("mobileContentList");c.each(w,function(a){g.calculateMobileContentPrice(a,h,f),x&&x.length>0&&a.oneTimePrice&&0===a.oneTimePrice.finalAmountIncludingTax&&g.calculateMobileContentOneTimePrice(a,h,f,x)})}h.ippTotalCharges&&h.ippCharges&&g.adjustIppCharges(h,f.order);var y=h.checkoutPrice,z=f.order.checkoutPrice,A=g.calculateOffSetPrice(i,l,n,p,q,s,u,r);A&&A.finalAmountIncludingTax<0&&(y.finalAmount=y.finalAmount-A.finalAmount,y.finalTaxAmount=y.finalTaxAmount-A.finalTaxAmount,y.finalAmountIncludingTax=y.finalAmountIncludingTax-A.finalAmountIncludingTax,h.checkoutPrice=y,z.finalAmount=z.finalAmount-A.finalAmount,z.finalTaxAmount=z.finalTaxAmount-A.finalTaxAmount,z.finalAmountIncludingTax=z.finalAmountIncludingTax-A.finalAmountIncludingTax,f.order.checkoutPrice=z),y&&y.finalAmountIncludingTax<0&&(y.finalAmount=0,y.finalTaxAmount=0,y.finalAmountIncludingTax=0,h.checkoutPrice=y),z&&z.finalAmountIncludingTax<0&&(z.finalAmount=0,z.finalTaxAmount=0,z.finalAmountIncludingTax=0,f.order.checkoutPrice=z)}else"sharedEquipment"===h.lob&&(e=h.productOrderItemID,h.netlinkInstallationCharges&&(d=h.netlinkInstallationCharges));f.order[h.lob]&&f.order[h.lob].push(h)})}),f.order.bundle&&0===f.order.bundle.length?delete f.order.bundle:(d&&(f.order.bundle[0].netlinkInstallationCharges=d,g.calculateInstallationPrice(d,f.order.bundle[0]),d=null),e&&f.order.tv&&0===f.order.tv.length&&f.order.bundle[0].productOrderItemIDs.push(e)),f.order.mobile&&0===f.order.mobile.length&&delete f.order.mobile,f.order.tv&&0===f.order.tv.length?delete f.order.tv:(d&&(f.order.tv[0].netlinkInstallationCharges=d,g.calculateInstallationPrice(d,f.order.tv[0]),d=null),e&&f.order.bundle&&0===f.order.bundle.length&&(f.order.tv[0].productOrderItemIDs=f.order.tv[0].productOrderItemIDs||[],f.order.tv[0].productOrderItemIDs.push(f.order.tv[0].productOrderItemID),f.order.tv[0].productOrderItemIDs.push(e),f.order.tv[0].productOrderItemID=null)),f.order.fv&&0===f.order.fv.length&&delete f.order.fv,f.order.sharedEquipment&&delete f.order.sharedEquipment,f.order.mobile&&f.order.mobile.length>0){var h=g.get("hasFreeMBB"),i=g.get("needsOnlyMBBDelivery");if(c.find(f.order.mobile,function(a){if(a.isFreeMBB)return h=!0,!0}),h){var j=g.subViewModels.orderInContextTopicViewModel.get("orderActions"),k=g.getValueByPath("cartPurchaseDetails.hasPurchasedRG");c.find(j,function(a){if("Change"!==a.orderType&&("BB"===a.lob||"TV"===a.lob))return k=!1,!0}),!k&&h&&1===f.order.mobile.length&&(i=!0)}g.set("hasFreeMBB",h),g.set("needsOnlyMBBDelivery",i)}this.subViewModels.deviceIdAndPlanIdInContextTopic.set("hasCisStaff",this.get("hasCisStaff")),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("hasYouthSilverPlans",this.get("hasYouthSilverPlans")),this.set("orderData",f),a.resolve("SUCCESS")},calculateOffSetPrice:function(a,b,c,d,e,f,g,h){var i={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0};return b&&(d&&d.finalAmountIncludingTax>0&&(b.finalAmount=d.finalAmount+b.finalAmount,b.finalTaxAmount=d.finalTaxAmount+b.finalTaxAmount,b.finalAmountIncludingTax=d.finalAmountIncludingTax+b.finalAmountIncludingTax,b.finalAmountIncludingTax<0?(d.finalAmount=0,d.finalTaxAmount=0,d.finalAmountIncludingTax=0):(d.finalAmount=b.finalAmount,d.finalTaxAmount=b.finalTaxAmount,d.finalAmountIncludingTax=b.finalAmountIncludingTax)),f&&f.finalAmountIncludingTax>0&&b.finalAmountIncludingTax<0&&(b.finalAmount=f.finalAmount+b.finalAmount,b.finalTaxAmount=f.finalTaxAmount+b.finalTaxAmount,b.finalAmountIncludingTax=f.finalAmountIncludingTax+b.finalAmountIncludingTax,b.finalAmountIncludingTax<0?(f.finalAmount=0,f.finalTaxAmount=0,f.finalAmountIncludingTax=0):(f.finalAmount=b.finalAmount,f.finalTaxAmount=b.finalTaxAmount,f.finalAmountIncludingTax=b.finalAmountIncludingTax)),b&&b.finalAmountIncludingTax<0&&(i.finalAmount=i.finalAmount+b.finalAmount,i.finalTaxAmount=i.finalTaxAmount+b.finalTaxAmount,i.finalAmountIncludingTax=i.finalAmountIncludingTax+b.finalAmountIncludingTax)),a&&(d&&d.finalAmountIncludingTax>0&&(a.finalAmount=d.finalAmount+a.finalAmount,a.finalTaxAmount=d.finalTaxAmount+a.finalTaxAmount,a.finalAmountIncludingTax=d.finalAmountIncludingTax+a.finalAmountIncludingTax,a.finalAmountIncludingTax<0?(d.finalAmount=0,d.finalTaxAmount=0,d.finalAmountIncludingTax=0):(d.finalAmount=a.finalAmount,d.finalTaxAmount=a.finalTaxAmount,d.finalAmountIncludingTax=a.finalAmountIncludingTax)),f&&f.finalAmountIncludingTax>0&&a.finalAmountIncludingTax<0&&(a.finalAmount=f.finalAmount+a.finalAmount,a.finalTaxAmount=f.finalTaxAmount+a.finalTaxAmount,a.finalAmountIncludingTax=f.finalAmountIncludingTax+a.finalAmountIncludingTax,a.finalAmountIncludingTax<0?(f.finalAmount=0,f.finalTaxAmount=0,f.finalAmountIncludingTax=0):(f.finalAmount=a.finalAmount,f.finalTaxAmount=a.finalTaxAmount,f.finalAmountIncludingTax=a.finalAmountIncludingTax)),a&&a.finalAmountIncludingTax<0&&(i.finalAmount=i.finalAmount+a.finalAmount,i.finalTaxAmount=i.finalTaxAmount+a.finalTaxAmount,i.finalAmountIncludingTax=i.finalAmountIncludingTax+a.finalAmountIncludingTax)),c&&(d&&d.finalAmountIncludingTax>0&&(c.finalAmount=d.finalAmount+c.finalAmount,c.finalTaxAmount=d.finalTaxAmount+c.finalTaxAmount,c.finalAmountIncludingTax=d.finalAmountIncludingTax+c.finalAmountIncludingTax,c.finalAmountIncludingTax<0?(d.finalAmount=0,d.finalTaxAmount=0,d.finalAmountIncludingTax=0):(d.finalAmount=c.finalAmount,d.finalTaxAmount=c.finalTaxAmount,d.finalAmountIncludingTax=c.finalAmountIncludingTax)),e&&e.finalAmountIncludingTax>0&&c.finalAmountIncludingTax<0&&(c.finalAmount=e.finalAmount+c.finalAmount,c.finalTaxAmount=e.finalTaxAmount+c.finalTaxAmount,c.finalAmountIncludingTax=e.finalAmountIncludingTax+c.finalAmountIncludingTax,c.finalAmountIncludingTax<0?(e.finalAmount=0,e.finalTaxAmount=0,e.finalAmountIncludingTax=0):(e.finalAmount=c.finalAmount,e.finalTaxAmount=c.finalTaxAmount,e.finalAmountIncludingTax=c.finalAmountIncludingTax)),f&&f.finalAmountIncludingTax>0&&c.finalAmountIncludingTax<0&&(c.finalAmount=f.finalAmount+c.finalAmount,c.finalTaxAmount=f.finalTaxAmount+c.finalTaxAmount,c.finalAmountIncludingTax=f.finalAmountIncludingTax+c.finalAmountIncludingTax,c.finalAmountIncludingTax<0?(f.finalAmount=0,f.finalTaxAmount=0,f.finalAmountIncludingTax=0):(f.finalAmount=c.finalAmount,f.finalTaxAmount=c.finalTaxAmount,f.finalAmountIncludingTax=c.finalAmountIncludingTax)),g&&g.finalAmountIncludingTax>0&&c.finalAmountIncludingTax<0&&(c.finalAmount=g.finalAmount+c.finalAmount,c.finalTaxAmount=g.finalTaxAmount+c.finalTaxAmount,c.finalAmountIncludingTax=g.finalAmountIncludingTax+c.finalAmountIncludingTax,c.finalAmountIncludingTax<0?(g.finalAmount=0,g.finalTaxAmount=0,g.finalAmountIncludingTax=0):(g.finalAmount=c.finalAmount,g.finalTaxAmount=c.finalTaxAmount,g.finalAmountIncludingTax=c.finalAmountIncludingTax)),h&&h.finalAmountIncludingTax>0&&c.finalAmountIncludingTax<0&&(c.finalAmount=h.finalAmount+c.finalAmount,c.finalTaxAmount=h.finalTaxAmount+c.finalTaxAmount,c.finalAmountIncludingTax=h.finalAmountIncludingTax+c.finalAmountIncludingTax,c.finalAmountIncludingTax<0?(h.finalAmount=0,h.finalTaxAmount=0,h.finalAmountIncludingTax=0):(h.finalAmount=c.finalAmount,h.finalTaxAmount=c.finalTaxAmount,h.finalAmountIncludingTax=c.finalAmountIncludingTax))),d&&d.finalAmountIncludingTax<0&&(i.finalAmount=i.finalAmount+d.finalAmount,i.finalTaxAmount=i.finalTaxAmount+d.finalTaxAmount,i.finalAmountIncludingTax=i.finalAmountIncludingTax+d.finalAmountIncludingTax),c&&c.finalAmountIncludingTax<0&&(i.finalAmount=i.finalAmount+c.finalAmount,i.finalTaxAmount=i.finalTaxAmount+c.finalTaxAmount,i.finalAmountIncludingTax=i.finalAmountIncludingTax+c.finalAmountIncludingTax),i},calculateMobileContentPrice:function(a,b,c){var d=a.recurringPrice,e=b.recurringPrice,f=c.order.recurringPrice,g=a.actualAmount;g=g?Number(g):0;var h,i;h=0===g?0:7*g/107,i=g-h,d.finalAmount=d.finalAmount+i,d.finalTaxAmount=d.finalTaxAmount+h,d.finalAmountIncludingTax=d.finalAmountIncludingTax+g,a.recurringPrice=d,e.finalAmount=e.finalAmount+i,e.finalTaxAmount=e.finalTaxAmount+h,e.finalAmountIncludingTax=e.finalAmountIncludingTax+g,b.recurringPrice=e,f.finalAmount=f.finalAmount+i,f.finalTaxAmount=f.finalTaxAmount+h,f.finalAmountIncludingTax=f.finalAmountIncludingTax+g,c.order.recurringPrice=f},calculateMobileContentOneTimePrice:function(a,b,d,e){var f=a.oneTimePrice,g=b.oneTimePrice,h=d.order.oneTimePrice,i=c.find(e,function(b){return b.productSpecContainmentID===a.simpleProductSpecID&&b.onetimePrice&&b.onetimePrice.length>0&&b.onetimePriceWithoutGST&&b.onetimePriceWithoutGST.length>0});if(i){var j=Number(i.onetimePrice),k=Number(i.onetimePriceWithoutGST),l=j-k;f.finalAmount=f.finalAmount+k,f.finalTaxAmount=f.finalTaxAmount+l,f.finalAmountIncludingTax=f.finalAmountIncludingTax+j,a.oneTimePrice=f,g.finalAmount=g.finalAmount+k,g.finalTaxAmount=g.finalTaxAmount+l,g.finalAmountIncludingTax=g.finalAmountIncludingTax+j,b.oneTimePrice=g,h.finalAmount=h.finalAmount+k,h.finalTaxAmount=h.finalTaxAmount+l,h.finalAmountIncludingTax=h.finalAmountIncludingTax+j,d.order.oneTimePrice=h}},calculateInstallationPrice:function(a,b){var c=a.oneTimePrice;if(c){var d=b.oneTimePrice;d.finalAmount=d.finalAmount+c.finalAmount,d.finalTaxAmount=d.finalTaxAmount+c.finalTaxAmount,d.finalAmountIncludingTax=d.finalAmountIncludingTax+c.finalAmountIncludingTax}b.oneTimePrice=d;var e=b.checkoutPrice,f=a.checkoutPrice;f&&(e.finalAmount=e.finalAmount+f.finalAmount,e.finalTaxAmount=e.finalTaxAmount+f.finalTaxAmount,e.finalAmountIncludingTax=e.finalAmountIncludingTax+f.finalAmountIncludingTax),b.checkoutPrice=e;var g=a.recurringPrice,h=b.recurringPrice;g&&(h.finalAmount=h.finalAmount+g.finalAmount,h.finalTaxAmount=h.finalTaxAmount+g.finalTaxAmount,h.finalAmountIncludingTax=h.finalAmountIncludingTax+g.finalAmountIncludingTax),b.recurringPrice=h},calculateCheckoutPrice:function(a,b,c,d,e){var f=a.checkoutPrice;e&&(d.finalAmount=d.finalAmount+f.finalAmount,d.finalTaxAmount=d.finalTaxAmount+f.finalTaxAmount,d.finalAmountIncludingTax=d.finalAmountIncludingTax+f.finalAmountIncludingTax);var g=b.oneTimePrice;g.finalAmount=g.finalAmount-f.finalAmount,g.finalTaxAmount=g.finalTaxAmount-f.finalTaxAmount,g.finalAmountIncludingTax=g.finalAmountIncludingTax-f.finalAmountIncludingTax,b.oneTimePrice=g;var h=b.checkoutPrice;h.finalAmount=h.finalAmount+f.finalAmount,h.finalTaxAmount=h.finalTaxAmount+f.finalTaxAmount,h.finalAmountIncludingTax=h.finalAmountIncludingTax+f.finalAmountIncludingTax,b.checkoutPrice=h;var i=c.order.oneTimePrice;i.finalAmount=i.finalAmount-f.finalAmount,i.finalTaxAmount=i.finalTaxAmount-f.finalTaxAmount,i.finalAmountIncludingTax=i.finalAmountIncludingTax-f.finalAmountIncludingTax,c.order.oneTimePrice=i;var j=c.order.checkoutPrice;return j.finalAmount=j.finalAmount+f.finalAmount,j.finalTaxAmount=j.finalTaxAmount+f.finalTaxAmount,j.finalAmountIncludingTax=j.finalAmountIncludingTax+f.finalAmountIncludingTax,c.order.checkoutPrice=j,d},createBundleObject:function(a,b,d){var e=this.createCustomePropertiesForItem(a);e.lineofBusiness="Bundle",e.subscriptionId=a.id,e.isBundle=!0,e.categoryName=a.name;var f=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");"staff"===f&&(e.categoryName=e.categoryName+"  (Staff)"),e.broadBandPlanDetails={},e.serviceDetails=[],e.addons=[],e.productOrderItemIDs=[];var g,h=this;c.each(a.productOrderItems,function(c){if(e.productOrderItemIDs.push(c.productOrderItemID),"G"===c.productSpecificationLevel)g=h.createItemObject(c,a.name,!0,b),g.addons&&g.addons.length>0&&(e.addons=e.addons.concat(g.addons)),e.productOrderItemType=c.productOrderItemType;else if("BB"===c.lineOfBusiness){var d=h.createItemObject(c,a.name,!0,b);if(e.isRecon=d.isRecon,d.isRecon){var f=h.get("cartPurchaseDetails");f.hasRecontract=!0,h.set("cartPurchaseDetails",f)}e.productID=d.productID,d.broadBandPlanDetails&&(e.broadBandPlanDetails=d.broadBandPlanDetails),d.deliveryDetails&&(e.deliveryDetails=d.deliveryDetails),d.serviceDetails&&d.serviceDetails.length>0&&(e.serviceDetails=d.serviceDetails.concat(e.serviceDetails)),d.staffDiscount&&(d.staffDiscount=d.staffDiscount),d.premiumAddons&&d.premiumAddons.length>0&&(e.premiumAddons=d.premiumAddons),d.addons&&d.addons.length>0&&(e.addons=e.addons.concat(d.addons)),d.singnetId?e.subscriptionId=d.singnetId:d.productServiceID&&(e.subscriptionId=d.productServiceID),d.installationAddressID&&(e.installationAddressID=d.installationAddressID),d.netlinkInstallationCharges&&(e.netlinkInstallationCharges=d.netlinkInstallationCharges),d.fibreInstallationCharges&&(e.fibreInstallationCharges=d.fibreInstallationCharges)}else{var i=h.createItemObject(c,a.name,!0,b);i.broadBandPlanDetails&&(e.broadBandPlanDetails=i.broadBandPlanDetails),i.penalityFees&&(e.penalityFees=i.penalityFees),i.serviceDetails&&i.serviceDetails.length>0&&(e.serviceDetails=e.serviceDetails.concat(i.serviceDetails)),i.addons&&i.addons.length>0&&(e.addons=e.addons.concat(i.addons)),i.landlineNumber&&(e.landlineNumber=i.landlineNumber),i.installationAddressID&&(e.installationAddressID=i.installationAddressID)}}),g&&g.broadBandPlanDetails?e.broadBandPlanDetails=g.broadBandPlanDetails:delete e.broadBandPlanDetails,g&&g.penalityFees&&(e.penalityFees=g.penalityFees),g&&g.serviceDetails&&g.serviceDetails.length>0&&(e.serviceDetails=g.serviceDetails.concat(e.serviceDetails));var i,j=e.deliveryDetails;return j&&j.isImmediateCharge&&(i={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},i=h.calculateCheckoutPrice(j,e,d,i,!0)),e},createItemBundleObject:function(a){var b=this.createCustomePropertiesForItem(a);switch(b.serviceType=a.productName,a.lineOfBusiness){case"BB":b.serviceName="Fibre BroadBand",b.addons=this.getAddons(a);break;case"FV":b.serviceName="Land Line"}return b},createCustomePropertiesForItem:function(a,b,c,d){return"undefined"!=typeof d&&null!==d||(d={}),"undefined"!=typeof a.totalOneTimeCalculatedPrice&&null!==a.totalOneTimeCalculatedPrice||(a.totalOneTimeCalculatedPrice={}),"undefined"!=typeof a.totalRecurringCalculatedPrice&&null!==a.totalRecurringCalculatedPrice||(a.totalRecurringCalculatedPrice={}),b?(d.checkoutPrice={finalAmount:a.totalOneTimeCalculatedPrice.finalAmount||0,finalTaxAmount:a.totalOneTimeCalculatedPrice.finalTaxAmount||0,finalAmountIncludingTax:a.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0},d.oneTimePrice={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0}):(d.oneTimePrice={finalAmount:a.totalOneTimeCalculatedPrice.finalAmount||0,finalTaxAmount:a.totalOneTimeCalculatedPrice.finalTaxAmount||0,finalAmountIncludingTax:a.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0},"undefined"!=typeof d.checkoutPrice&&null!==d.checkoutPrice&&"undefined"!=typeof d.checkoutPrice.finalAmountIncludingTax&&null!==d.checkoutPrice.finalAmountIncludingTax||(d.checkoutPrice={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0})),d.recurringPrice={finalAmount:a.totalRecurringCalculatedPrice.finalAmount||0,finalTaxAmount:a.totalRecurringCalculatedPrice.finalTaxAmount||0,finalAmountIncludingTax:a.totalRecurringCalculatedPrice.finalAmountIncludingTax||0},c&&("oneTimePrice"===c&&d.oneTimePrice?d.oneTimePrice.finalAmountIncludingTax="Free":"checkoutPrice"===c&&d.checkoutPrice?d.checkoutPrice.finalAmountIncludingTax="Free":"recurringPrice"===c&&d.recurringPrice&&(d.recurringPrice.finalAmountIncludingTax="Free")),d.isImmediateCharge=a.isImmediateCharge,d},handleInstallmentSpecialPrice:function(a){var b={};return a.isRecurring?(b.recurringPrice={finalAmount:a.finalAmount||0,finalTaxAmount:a.finalTaxAmount||0,finalAmountIncludingTax:(a.finalAmount||0)+(a.finalTaxAmount||0)},b.oneTimePrice={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0}):(b.oneTimePrice={finalAmount:a.finalAmount||0,finalTaxAmount:a.finalTaxAmount||0,finalAmountIncludingTax:(a.finalAmount||0)+(a.finalTaxAmount||0)},b.recurringPrice={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0}),b.checkoutPrice={finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},b.isRecurring=a.isRecurring,b},getDevice:function(a){var b={devices:[]},d=this,e=c.find(a.displayableSimpleProductReferences,function(a){return"DEVICE"===a.businessType&&"AD"===a.action});if(e&&e.displayableBillingOffers&&e.displayableBillingOffers.length>0){var f=c.find(e.displayableBillingOffers,function(a){return"14253191"===a.productSpecPricing.childPricingSchema.id||"26208904"===a.productSpecPricing.childPricingSchema.id||"Device Repayment Charges Early CI"===a.productSpecPricing.childPricingSchema.name});if(f&&f.totalOneTimeCalculatedPrice&&f.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0){var g=this.createCustomePropertiesForItem(f,!0);g.name=f.name,b.repaymentChanges=g}var h,i=c.find(e.displayableBillingOffers,function(a){return"8428912"===a.productSpecPricing.childPricingSchema.id});i&&(h=this.createCustomePropertiesForItem(i,!0));var j,k,l,m=!0,n=e.name.split(" "),o="Mobile";if(e.displayableCharacteristics){var p=c.find(e.displayableCharacteristics,function(a){return"9012912"===a.productSpecCharacteristicID&&a.value&&a.value.toUpperCase().indexOf("TABLET")>-1});p&&(o="Tablet");var q,r,s;if(c.each(e.displayableCharacteristics,function(a){"8852"===a.productSpecCharacteristicID&&a.value?k=a.value:"8842"===a.productSpecCharacteristicID&&a.value?q=a:"8832"===a.productSpecCharacteristicID?l=a.value:"13897781"===a.productSpecCharacteristicID&&"Instalments"===a.value?r=!0:"8272"===a.productSpecCharacteristicID&&(s=a.value)}),q){j=q.value;var t=d.get("cartPurchaseDetails"),u=t.brandsPurchased||[];c.contains(u,j)||u.push(j),t.brandsPurchased=u,d.set("cartPurchaseDetails",t)}r&&c.each(e.displayableBillingOffers,function(a){if("14317881"===a.productSpecPricing.childPricingSchema.id)h=this.createCustomePropertiesForItem(ippCharges,!1,!1,h),m=!1;else if(a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0&&("14317891"===a.productSpecPricing.childPricingSchema.id||"Singtel Instalment Payment Plan Mobile"===a.name)){var e;a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices.length>0&&(a.oneTimeCalculatedPrices.length>1?(e=c.min(a.oneTimeCalculatedPrices,function(a){return a.finalAmount}),e.isRecurring=!0):(e=a.oneTimeCalculatedPrices[0],e.isRecurring=!1)),e.isRecurring&&(b.ippCharges=d.handleInstallmentSpecialPrice(e),b.ippCharges.title="("+s+" months, interest-free)",b.ippCharges.numberOfInstallment=s,b.ippTotalCharges=d.createCustomePropertiesForItem(a,!1))}})}"undefined"!=typeof h&&null!==h||(h=this.createCustomePropertiesForItem(e,!0)),h.colour=n.pop(),n.length>0&&(h.deviceSize=n.pop()),n.length>0&&(h.deviceName=n.join(" ")),h.deviceId=e.simpleProductSpecID,h.deviceProductId=e.productID,m===!1&&(h.ippFlag=!0),h.skuId=l,h.deviceType=o,h.brandName=j,h.modelName=k,b.devices.push(h);var v=d.get("selectedDevices")||{},w=[],x=d.get("selectedDevicesSkuList")||[],y=d.get("selectedDevicesSku")||{};x.push(h.skuId),w.push(e.simpleProductSpecID),v[a.productOrderItemID]=w,y[a.productOrderItemID]=x,d.set({selectedDevicesSku:y,selectedDevicesSkuList:x,selectedDevices:v})}b.repaymentChanges||!a.displayableItems||"Change"!==a.productOrderItemType&&"Change Ownership"!==a.productOrderItemType||c.each(a.displayableItems,function(a){if("12012"===a.productSpecContainmentID&&"RM"===a.action&&a.displayableBillingOffers){var e=c.find(a.displayableBillingOffers,function(a){return"Device Penalty Offer"===a.name&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0});if(e){var f=d.createCustomePropertiesForItem(e,!1);if(f.name=e.name,b.repaymentChanges&&b.repaymentChanges.name===f.name){var g=b.repaymentChanges;g.oneTimePrice.finalAmount=g.oneTimePrice.finalAmount+f.oneTimePrice.finalAmount,g.oneTimePrice.finalTaxAmount=g.oneTimePrice.finalTaxAmount+f.oneTimePrice.finalTaxAmount,g.oneTimePrice.finalAmountIncludingTax=g.oneTimePrice.finalAmountIncludingTax+f.oneTimePrice.finalAmountIncludingTax,b.repaymentChanges=g}else b.repaymentChanges=f}}});var e=c.filter(a.displayableSimpleProductReferences,function(a){return"DEVICE"===a.businessType&&("undefined"==typeof a.action||null===a.action||"RM"===a.action&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0)});return e&&e.length>0&&c.find(e,function(a){if(a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&(c.find(a.displayableBillingOffers,function(a){if("RM"===a.action&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0&&a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&("19226141"===a.productSpecPricing.childPricingSchema.id||"14317891"===a.productSpecPricing.childPricingSchema.id||"Singtel Instalment Payment Plan Mobile"===a.productSpecPricing.childPricingSchema.name||"Singtel Device Repayment Plan for RRP Device"===a.productSpecPricing.childPricingSchema.name))return b.ippChargesPenalty=d.createCustomePropertiesForItem(a,!1),b.ippChargesPenalty.title="Early Repayment Fee",!0}),b.ippChargesPenalty))return!0}),b},getPremiumAddons:function(a,b){var d=[],e=this,f=c.filter(a.displayableSimpleProductReferences,function(a){return a.action&&"AD"===a.action});if(f&&f.length>0){var g=!(f.length>1),h=e.get("premiumAddonDetails");c.each(f,function(a){var f=e.createCustomePropertiesForItem(a);f.productID=a.productID,f.parentProductID=a.parentProductID,f.simpleProductSpecID=a.simpleProductSpecID,f.name=a.name,f.productOrderItemID=b,f.removeParent=g;var i={};c.each(a.displayableCharacteristics,function(a){"13897781"===a.productSpecCharacteristicID&&"Instalments"===a.value?f.ippFlag=!0:"8832"===a.productSpecCharacteristicID?i.sku=a.value:"8822"===a.productSpecCharacteristicID&&(i.spsid=a.value)}),c.each(a.displayableBillingOffers,function(a){a.selected&&a.productSpecPricing&&(a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax||a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmountIncludingTax)&&a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&(f.offerID=a.productSpecPricing.childPricingSchema.id)}),d.push(f),i.sku&&(i.name=a.name,h.push(i))}),e.set("premiumAddonDetails",h)}return d},getSIM:function(a){var b=null,d=c.find(a,function(a){return"SIM"===a.name});return b=this.createCustomePropertiesForItem(d),b.simType="3IN1, Non-NFC",b},getPlan:function(a){var b=[],c=this.createCustomePropertiesForItem(a);return c.planName=a.productName,b.push(c),b},getService:function(a){var b=null,b=this.createCustomePropertiesForItem(a);return b.serviceName=a.productName,b},getAddons:function(a){var b=[];return c.each(a.displayableItems,function(a){"SIM"!==a.name&&b.push(a)}),b},populateMobileObjects:function(a){var e={addons:[],promotions:[],freeGifts:[]},f=this;if(a.displayableItems){var g,h=[],i=[],j=b.get("relaxInternetFilter"),k=f.get("mobileShareOffers"),l=[];for(var m in a.displayableItems){var n=c.find(a.displayableItems[m].displayableCharacteristics,function(a){return a.productSpecCharacteristicID===b.get("MIN_TENURE").WS});if(n){l.push(n.value);break}}if(l.length>0&&f.set("minTenure",l.concat(f.get("minTenure"))),j===!1&&(g=c.find(a.displayableItems,function(a){return"8363682"===a.productSpecContainmentID})),c.each(a.displayableItems,function(l){if("8363712"===l.productSpecContainmentID){var m=[];if(c.each(l.displayableBillingOffers,function(b){var d=f.getSimOnlyTabletAddon(b.productSpecPricing);if(b.selected&&b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax>0&&!d||b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&("11208051"===b.productSpecPricing.childPricingSchema.id||"18797601"===b.productSpecPricing.childPricingSchema.id))){var g=f.createCustomePropertiesForItem(b);g.planName=a.productName,g.planName&&(g.planName.toUpperCase().indexOf("YOUTH")>-1||g.planName.toUpperCase().indexOf("SILVER")>-1)&&f.set("hasYouthSilverPlans",!0),g.planId=a.productOfferingID,i.push(a.productOfferingID),c.contains(k,a.productOfferingID)&&(g.noChange=!0),m.push(g),e.planDetails=m}else if(b.selected){var j=f.createCustomePropertiesForItem(b);b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?j.name=b.recurringCalculatedPrices[0].description:j.name=b.name,j.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(j.offerID=b.productSpecPricing.childPricingSchema.id,j.techDescription=b.productSpecPricing.childPricingSchema.description);var n=!0;j.hideRemoveLink=n,j.productSpecPricingID=b.productSpecPricingID,j.productSpecContainmentID=l.productSpecContainmentID,j.parentProductSpecContainmentID=l.parentProductSpecContainmentID,j.parentProductID=l.parentProductID,j.productID=l.productID,j.lob="WS",j.productOrderItemID=a.productOrderItemID,e.addons.push(j),h.push(b.billingOfferID)}}),c.contains(k,a.productOfferingID)&&l.displayableCharacteristics&&l.displayableCharacteristics.length>0){var n,o=c.find(l.displayableCharacteristics,function(a){return"8518342"===a.productSpecCharacteristicID}),p=o.value,q=f.get("existingLines");if(q&&q.implCustomerGroupIdsList&&q.implCustomerGroupIdsList.length>0&&(c.each(q.implCustomerGroupIdsList,function(a){a&&a.implGroupId&&c.each(a.implGroupId,function(a){a&&a.groupId===p&&(n=a)})}),n)){var r={};r.oneTimePrice={finalAmount:0,finalAmountWithTax:0,finalAmountIncludingTax:0},r.recurringPrice={finalAmount:0,finalAmountWithTax:0,finalAmountIncludingTax:0},r.singtelMobile=n.mainLineMSISDN,r.planName=n.implPlanDetails.name,"Change"!==a.productOrderItemType&&"Change Ownership"!==a.productOrderItemType||(r.noChange=!0),e.mainLineDetails=r}}if(l.displayableItems&&l.displayableItems.length>0){var s=c.filter(l.displayableItems,function(a){return"11782"===a.productSpecContainmentID&&"RM"===a.action});s&&s.length>0&&c.each(s,function(a){var b=a.displayableBillingOffers;if(b&&b.length>0){var d=c.find(b,function(a){return"Service Contract Penalty"===a.name&&"RM"===a.action&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0});if(d){var g=f.createCustomePropertiesForItem(d);g.name=d.name,e.serviceContractPenalty=g}}})}}else if("8363722"===l.productSpecContainmentID&&f.getNewlyAddedSimDetails(l)){var m=null;m=f.createCustomePropertiesForItem(l);var t,u="3IN1, Non-NFC";c.each(l.displayableCharacteristics,function(a){"8022652"===a.productSpecCharacteristicID&&a.value?u=a.value:"8832"===a.productSpecCharacteristicID&&(t=a.value)}),m.simType=u,m.skuId=t||b.get("simSkuId"),e.simDetails=m;var v=l.productID;f.set("hasSim",!0);var w=f.get("selectedSimSkuList")||[];w.push(m.skuId),f.set("selectedSimSkuList",w),e.simProductId=v}else if("8363682"===l.productSpecContainmentID)l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(a){if(a.name.indexOf("Service Registration Fee")>-1){var b=f.createCustomePropertiesForItem(a);b.discountDetails="Service Registration Charge",e.simRegisteration=b}else if("Downgrade Penalty"===a.name&&(a.totalOneTimeCalculatedPrice.finalAmountIncludingTax||a.totalRecurringCalculatedPrice.finalAmountIncludingTax)){var b=f.createCustomePropertiesForItem(a);b.name="Penalty",e.penalityFees=b}else if(a.selected&&(a.name.indexOf("Delivery Charge Immediate")>-1||a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&("13970921"===a.productSpecPricing.childPricingSchema.id||"13970931"===a.productSpecPricing.childPricingSchema.id||"13970911"===a.productSpecPricing.childPricingSchema.id))&&a.totalOneTimeCalculatedPrice&&(a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0||0===a.totalOneTimeCalculatedPrice.finalAmountIncludingTax)||a.totalRecurringCalculatedPrice&&(a.totalRecurringCalculatedPrice.finalAmountIncludingTax>0||0===a.totalRecurringCalculatedPrice.finalAmountIncludingTax)){var b=f.createCustomePropertiesForItem(a,!0);b.deliveryType="Standard Delivery",b.isImmediateCharge=!0,b.discountDetails=a.name,e.deliveryDetails=b}else if(a.selected&&a.name.indexOf("Delivery Charge")>-1&&a.totalOneTimeCalculatedPrice&&(a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0||0===a.totalOneTimeCalculatedPrice.finalAmountIncludingTax)||a.totalRecurringCalculatedPrice&&(a.totalRecurringCalculatedPrice.finalAmountIncludingTax>0||0===a.totalRecurringCalculatedPrice.finalAmountIncludingTax)){var b=f.createCustomePropertiesForItem(a);b.deliveryType="Standard Delivery",b.discountDetails=a.name,b.isImmediateCharge=!1,e.deliveryDetails=b}}),l.displayableCharacteristics&&l.displayableCharacteristics.length>0&&c.each(l.displayableCharacteristics,function(a){"10005093"===a.productSpecCharacteristicID&&a.value&&"Y"===a.value?e.isPortin=!0:"8469052"===a.productSpecCharacteristicID&&a.value&&(e.ciTier=a.value)});else if("10381311"===l.productSpecContainmentID||"11337471"===l.productSpecContainmentID||"11344731"===l.productSpecContainmentID||"11343321"===l.productSpecContainmentID){var m=f.createCustomePropertiesForItem(l,!0);c.each(l.displayableCharacteristics,function(a){"10383541"===a.productSpecCharacteristicID&&(m.name=a.value)}),"undefined"!=typeof m.name&&null!==m.name||(m.name=l.name),e.promotions.push(m)}else if("12022"===l.productSpecContainmentID&&"AD"===l.action){var m=f.createCustomePropertiesForItem(l,!0,"recurringPrice");c.each(l.displayableCharacteristics,function(a){"8620482"===a.productSpecCharacteristicID?m.name=a.value:"8822"===a.productSpecCharacteristicID?m.freebieId=a.value:"8832"===a.productSpecCharacteristicID&&(m.skuId=a.value);
}),"undefined"!=typeof m.name&&null!==m.name||(m.name=l.name),m.displayAs="free",m.productID=l.productID,e.freeGifts.push(m);var x=f.get("selectedFreebies")||[],y=f.get("selectedFreebiesSkuList")||[];x.push({freebieId:m.freebieId,skuId:m.skuId,productOrderItemID:a.productOrderItemID,productID:m.productID,name:m.name}),y.push(m.skuId),f.set({selectedFreebiesSkuList:y,selectedFreebies:x})}else if("11952"===l.productSpecContainmentID){var m=f.createCustomePropertiesForItem(l,!0),z=l.displayableCharacteristics,A="",B="";z&&z.length>0&&c.each(z,function(a){"8842"===a.productSpecCharacteristicID&&(A=a.value),"8852"===a.productSpecCharacteristicID&&(B=a.value)}),m.tradeInName=A+" "+B,m.productID=l.productID,m.productOrderItemID=a.productOrderItemID,e.tradeIn=m}else if("11822"===l.productSpecContainmentID&&"RM"!==l.action){var m=f.createCustomePropertiesForItem(l);m.name=l.name,e.staffDiscount=m,l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(b){if(b.selected&&b.totalOneTimeCalculatedPrice&&0===b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax){var d=f.createCustomePropertiesForItem(b);b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?d.name=b.recurringCalculatedPrices[0].description:d.name=b.name,d.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(d.offerID=b.productSpecPricing.childPricingSchema.id,d.techDescription=b.productSpecPricing.childPricingSchema.description);var g=!1;if("AD"!==b.action)g=!0;else if(b.allowedActions){var i=c.find(b.allowedActions,function(a){return"RM"===a.type});i&&!i.allowed&&(g=!0)}d.hideRemoveLink=g,d.productSpecPricingID=b.productSpecPricingID,d.productSpecContainmentID=l.productSpecContainmentID,d.parentProductSpecContainmentID=l.parentProductSpecContainmentID,d.parentProductID=l.parentProductID,d.productID=l.productID,d.lob="WS",d.productOrderItemID=a.productOrderItemID,e.addons.push(d),h.push(b.billingOfferID)}})}else if("11762"===l.productSpecContainmentID||"CIS"===l.name)if("RM"!==l.action&&l.selected)if(l.displayableBillingOffers&&l.displayableBillingOffers.length>0)c.each(l.displayableBillingOffers,function(b){if(b.selected)if(b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&"8478572"===b.productSpecPricing.childPricingSchema.id){var d=f.createCustomePropertiesForItem(b);d.name=b.name,e.cisDiscount=d}else{var g=f.createCustomePropertiesForItem(b);b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?g.name=b.recurringCalculatedPrices[0].description:g.name=b.name,g.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(g.offerID=b.productSpecPricing.childPricingSchema.id,g.techDescription=b.productSpecPricing.childPricingSchema.description);var i=!1;if("AD"!==b.action)i=!0;else if(b.allowedActions){var j=c.find(b.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}g.hideRemoveLink=i,g.productSpecPricingID=b.productSpecPricingID,g.productSpecContainmentID=l.productSpecContainmentID,g.parentProductSpecContainmentID=l.parentProductSpecContainmentID,g.parentProductID=l.parentProductID,g.productID=l.productID,g.lob="WS",g.productOrderItemID=a.productOrderItemID,e.addons.push(g),h.push(b.billingOfferID)}});else{var m=f.createCustomePropertiesForItem(l);m.name=l.name,e.cisDiscount=m}else"RM"===l.action&&l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(b){if("RM"===b.action&&b.penalty&&b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax){var c=f.createCustomePropertiesForItem(b);b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?c.name=b.recurringCalculatedPrices[0].description:c.name=b.name,c.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(c.offerID=b.productSpecPricing.childPricingSchema.id,c.techDescription=b.productSpecPricing.childPricingSchema.description),c.hideRemoveLink=!0,c.productSpecPricingID=b.productSpecPricingID,c.productSpecContainmentID=l.productSpecContainmentID,c.parentProductSpecContainmentID=l.parentProductSpecContainmentID,c.parentProductID=l.parentProductID,c.productID=l.productID,c.lob="WS",c.productOrderItemID=a.productOrderItemID,e.addons.push(c)}});else if("9404693"===l.productSpecContainmentID){var m=f.createCustomePropertiesForItem(l);m.name=l.name,e.specialDiscounts=m}else if("9117142"===l.productSpecContainmentID){var C=[];c.each(l.displayableCharacteristics,function(b){if("8511922"!==b.productSpecCharacteristicID&&b.value&&b.value.indexOf(",")>-1){var d=b.value,e=d.split(","),f={name:"Voucher 1",checkoutPrice:{finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0},productOrderItemID:a.productOrderItemID};c.each(e,function(a){a.indexOf("amount=")>-1||a.indexOf("Amount=")>-1?f.checkoutPrice.finalAmountIncludingTax=-Number(a.substring(a.indexOf("=")+1)):a.indexOf("name=")>-1||a.indexOf("Name=")>-1?f.name=a.substring(a.indexOf("=")+1):(a.indexOf("voucherNo=")>-1||a.indexOf("VoucherNo=")>-1)&&(f.idX8=a.substring(a.indexOf("=")+1))}),C.push(f)}}),C.length>0&&(e.vouchers=C)}else if("9722"===l.productSpecContainmentID&&"RM"===l.action)l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(b){if("RM"===b.action&&b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax){var d=f.createCustomePropertiesForItem(b);d.lob="WS",b.oneTimeCalculatedPrices&&b.oneTimeCalculatedPrices.length>0&&b.oneTimeCalculatedPrices[0]&&b.oneTimeCalculatedPrices[0].description?d.name=b.oneTimeCalculatedPrices[0].description:d.name=b.name,d.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(d.offerID=b.productSpecPricing.childPricingSchema.id,d.techDescription=b.productSpecPricing.childPricingSchema.description),d.productSpecPricingID=b.productSpecPricingID,d.productSpecContainmentID=l.productSpecContainmentID,d.parentProductSpecContainmentID=l.parentProductSpecContainmentID,d.parentProductID=l.parentProductID,d.productID=l.productID,d.productOrderItemID=a.productOrderItemID;var g=!1;if("AD"!==b.action)g=!0;else if(b.allowedActions){var i=c.find(b.allowedActions,function(a){return"RM"===a.type});i&&!i.allowed&&(g=!0)}d.hideRemoveLink=g,e.addons.push(d),h.push(b.billingOfferID)}});else if("9732"===l.productSpecContainmentID)l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(b){if(b.selected){var d=f.createCustomePropertiesForItem(b);d.lob="WS",b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?d.name=b.recurringCalculatedPrices[0].description:d.name=b.name,d.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(d.offerID=b.productSpecPricing.childPricingSchema.id,d.techDescription=b.productSpecPricing.childPricingSchema.description),d.productSpecPricingID=b.productSpecPricingID,d.productSpecContainmentID=l.productSpecContainmentID,d.parentProductSpecContainmentID=l.parentProductSpecContainmentID,d.parentProductID=l.parentProductID,d.productID=l.productID,d.productOrderItemID=a.productOrderItemID;var g=!1;if("AD"!==b.action)g=!0;else if(b.allowedActions){var i=c.find(b.allowedActions,function(a){return"RM"===a.type});i&&!i.allowed&&(g=!0)}d.hideRemoveLink=g,e.addons.push(d),h.push(b.billingOfferID)}}),l.displayableItems&&l.displayableItems.length>0&&c.each(l.displayableItems,function(b){c.each(b.displayableBillingOffers,function(d){if(d.selected){var g=f.createCustomePropertiesForItem(d);g.lob="WS",d.recurringCalculatedPrices&&d.recurringCalculatedPrices.length>0&&d.recurringCalculatedPrices[0]&&d.recurringCalculatedPrices[0].description?g.name=d.recurringCalculatedPrices[0].description:g.name=d.name,g.billingOfferID=d.billingOfferID,d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&(g.offerID=d.productSpecPricing.childPricingSchema.id,g.techDescription=d.productSpecPricing.childPricingSchema.description),g.productSpecPricingID=d.productSpecPricingID,g.productSpecContainmentID=b.productSpecContainmentID,g.parentProductSpecContainmentID=b.parentProductSpecContainmentID,g.parentProductID=b.parentProductID,g.productID=b.productID,g.productOrderItemID=a.productOrderItemID;var i=!1;if("AD"!==d.action)i=!0;else if(d.allowedActions){var j=c.find(d.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}g.hideRemoveLink=i,e.addons.push(g),h.push(d.billingOfferID)}})});else if("12102"===l.productSpecContainmentID||"10026181"===l.productSpecContainmentID)l.displayableItems&&l.displayableItems.length>0&&c.each(l.displayableItems,function(b){(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax))&&b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(d){if(d.selected){var g=f.createCustomePropertiesForItem(d);g.lob="WS",d.recurringCalculatedPrices&&d.recurringCalculatedPrices.length>0&&d.recurringCalculatedPrices[0]&&d.recurringCalculatedPrices[0].description?g.name=d.recurringCalculatedPrices[0].description:g.name=d.name,g.billingOfferID=d.billingOfferID,d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&(g.offerID=d.productSpecPricing.childPricingSchema.id,g.techDescription=d.productSpecPricing.childPricingSchema.description),g.productSpecPricingID=d.productSpecPricingID,g.productSpecContainmentID=b.productSpecContainmentID,g.specialAddon=!1,g.parentProductSpecContainmentID=b.parentProductSpecContainmentID,g.parentProductID=b.parentProductID,g.productID=b.productID,g.productOrderItemID=a.productOrderItemID;var i=!1;if("AD"!==d.action)i=!0;else if(d.allowedActions){var j=c.find(d.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}g.hideRemoveLink=i,e.addons.push(g),h.push(d.billingOfferID)}})}),l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(b){if(b.selected){var d=f.createCustomePropertiesForItem(b);d.lob="WS",b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?d.name=b.recurringCalculatedPrices[0].description:d.name=b.name,d.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(d.offerID=b.productSpecPricing.childPricingSchema.id,d.techDescription=b.productSpecPricing.childPricingSchema.description),d.productSpecPricingID=b.productSpecPricingID,d.productSpecContainmentID=l.productSpecContainmentID,d.specialAddon=!1,d.parentProductSpecContainmentID=l.parentProductSpecContainmentID,d.parentProductID=l.parentProductID,d.productID=l.productID,d.productOrderItemID=a.productOrderItemID;var g=!1;if("AD"!==b.action)g=!0;else if(b.allowedActions){var i=c.find(b.allowedActions,function(a){return"RM"===a.type});i&&!i.allowed&&(g=!0)}d.hideRemoveLink=g,e.addons.push(d),h.push(b.billingOfferID)}});else if("Apple Care"===l.name){var D=[];c.each(l.displayableBillingOffers,function(b){if(b.selected){var c=f.createCustomePropertiesForItem(b,!0);c.name=b.name,c.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(c.offerID=b.productSpecPricing.childPricingSchema.id),c.productSpecContainmentID=l.productSpecContainmentID,c.productID=l.productID,c.productOrderItemID=a.productOrderItemID,D.push(c)}}),D.length>0&&(e.appleCare=D)}else if("17987931"===l.productSpecContainmentID)l.displayableBillingOffers&&l.displayableBillingOffers.length>0&&c.each(l.displayableBillingOffers,function(a){a.selected&&h.push(a.billingOfferID)});else if("14438091"===l.productSpecContainmentID&&"RM"===l.action)l.displayableItems&&l.displayableItems.length>0&&c.each(l.displayableItems,function(a){a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(b){if("RM"===b.action&&b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax){var d=f.createCustomePropertiesForItem(b);d.lob="WS",b.oneTimeCalculatedPrices&&b.oneTimeCalculatedPrices.length>0&&b.oneTimeCalculatedPrices[0]&&b.oneTimeCalculatedPrices[0].description?d.name=b.oneTimeCalculatedPrices[0].description:d.name=b.name,d.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(d.offerID=b.productSpecPricing.childPricingSchema.id,d.techDescription=b.productSpecPricing.childPricingSchema.description),d.productSpecPricingID=b.productSpecPricingID,d.productSpecContainmentID=a.productSpecContainmentID,d.parentProductSpecContainmentID=a.parentProductSpecContainmentID,d.parentProductID=a.parentProductID,d.productID=a.productID,d.productOrderItemID=a.productOrderItemID;var g=!1;if("AD"!==b.action)g=!0;else if(b.allowedActions){var i=c.find(b.allowedActions,function(a){return"RM"===a.type});i&&!i.allowed&&(g=!0)}d.hideRemoveLink=g,e.addons.push(d),h.push(b.billingOfferID)}})});else if(l.totalOneTimeCalculatedPrice&&l.totalOneTimeCalculatedPrice.finalAmountIncludingTax||l.totalRecurringCalculatedPrice&&(l.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===l.totalRecurringCalculatedPrice.finalAmountIncludingTax)){if("8472632"===l.productSpecContainmentID){var E=c.find(l.displayableCharacteristics,function(a){return 8242==a.productSpecCharacteristicID});E&&d().isAfter(d(E.value-0),"day")&&(l.displayableBillingOffers=[{}],console.log(E))}if(l.displayableBillingOffers&&l.displayableBillingOffers.length>0)c.each(l.displayableBillingOffers,function(b){var d=!0;if("18059161"===l.productSpecContainmentID&&l.selected&&b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&"13674081"===b.productSpecPricing.childPricingSchema.id&&(d=!1),d&&(b.selected||"RM"===b.action&&(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&b.totalRecurringCalculatedPrice.finalAmountIncludingTax))){var i=f.createCustomePropertiesForItem(b);i.lob="WS",b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?i.name=b.recurringCalculatedPrices[0].description:i.name=b.name,i.billingOfferID=b.billingOfferID,b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(i.offerID=b.productSpecPricing.childPricingSchema.id,i.techDescription=b.productSpecPricing.childPricingSchema.description),i.productSpecPricingID=b.productSpecPricingID,i.productSpecContainmentID=l.productSpecContainmentID,j===!1&&g&&"11982"===l.productSpecContainmentID?(i.specialAddon=!0,i.mainProductId=g.productID):i.specialAddon=!1,i.parentProductSpecContainmentID=l.parentProductSpecContainmentID,i.parentProductID=l.parentProductID,i.productID=l.productID,i.productOrderItemID=a.productOrderItemID;var k=!1;if("AD"!==b.action)k=!0;else if(b.allowedActions){var m=c.find(b.allowedActions,function(a){return"RM"===a.type});m&&!m.allowed&&(k=!0)}i.hideRemoveLink=k,e.addons.push(i),h.push(b.billingOfferID)}});else{var F=f.createCustomePropertiesForItem(l);F.name=l.name,F.billingOfferID=offer.billingOfferID,F.lob="WS",F.productSpecContainmentID=l.productSpecContainmentID,F.parentProductSpecContainmentID=l.parentProductSpecContainmentID,F.parentProductID=l.parentProductID,F.productID=l.productID,F.productOrderItemID=a.productOrderItemID,e.addons.push(F)}l.displayableItems&&l.displayableItems.length>0&&c.each(l.displayableItems,function(b){b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(d){if(d.selected){var i=f.createCustomePropertiesForItem(d);i.lob="WS",d.recurringCalculatedPrices&&d.recurringCalculatedPrices.length>0&&d.recurringCalculatedPrices[0]&&d.recurringCalculatedPrices[0].description?i.name=d.recurringCalculatedPrices[0].description:i.name=d.name,i.billingOfferID=d.billingOfferID,d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&(i.offerID=d.productSpecPricing.childPricingSchema.id,i.techDescription=d.productSpecPricing.childPricingSchema.description),i.productSpecPricingID=d.productSpecPricingID,i.productSpecContainmentID=b.productSpecContainmentID,j===!1&&g&&"11982"===b.productSpecContainmentID?(i.specialAddon=!0,i.mainProductId=g.productID):i.specialAddon=!1,i.parentProductSpecContainmentID=b.parentProductSpecContainmentID,i.parentProductID=b.parentProductID,i.productID=b.productID,i.productOrderItemID=a.productOrderItemID;var k=!1;if("AD"!==d.action)k=!0;else if(d.allowedActions){var l=c.find(d.allowedActions,function(a){return"RM"===a.type});l&&!l.allowed&&(k=!0)}i.hideRemoveLink=k,e.addons.push(i),h.push(d.billingOfferID)}})}),"18059161"===l.productSpecContainmentID&&l.selected&&f.populatePromoCodeAndCoupons(l)}"18059161"===l.productSpecContainmentID&&l.selected&&f.populatePromoCodeAndCoupons(l);var G=f.get("easyMobileComponentIds");c.contains(G,l.productSpecContainmentID)&&(e.isEasyMobileOrder=!0)}),h.length>0){var o=f.get("selectedAddons")||{};o[a.productOrderItemID]=h,f.set("selectedAddons",o)}if(i.length>0){var p=f.get("selectedMobilePlans")||{};p[a.productOrderItemID]=i,f.set("selectedMobilePlans",p)}}if(a.displayableSimpleProductReferences){var q=f.populateMobileContent(a);q&&q.length>0&&(e.mobileContents=q);var r=f.populateMobileAccessories(a);r&&r.length>0&&(e.mobileAccessories=r)}return e},getSimOnlyTabletAddon:function(a){var b=!1;return a&&a.childPricingSchema&&("26073454"===a.childPricingSchema.id||"BASIC"!==a.childPricingSchema.type)&&(b=!0),b},populatePromoCodeAndCoupons:function(a){var b=this;b.subViewModels.deviceIdAndPlanIdInContextTopic.set("couponDetails",null),a&&a.displayableCharacteristics&&a.displayableCharacteristics.length>0&&c.each(a.displayableCharacteristics,function(a){if("18059101"===a.productSpecCharacteristicID&&a.value){var c=a.value;if(c&&c.length>0){var d=c.split("@@@");if(d&&d.length>0){var e={code:d[0]};b.subViewModels.deviceIdAndPlanIdInContextTopic.set("pgInfo",e)}}}else if("18059091"===a.productSpecCharacteristicID&&a.value){var f=a.value;if(f&&f.length>0){var g=f.split("@@@");if(g&&g.length>1){var h={code:g[0],description:g[1]};b.subViewModels.deviceIdAndPlanIdInContextTopic.set("couponDetails",h),b.set("invalidPromo",!1)}}}else if("18059111"===a.productSpecCharacteristicID&&a.value){var f=a.value;if(f&&f.length>0){var i=b.get("invalidPromo");i!==!1&&b.set("invalidPromo",!0)}}})},populateMobileAccessories:function(a){var b=[],d=this.get("selectedAccessoriesSkuIds")||[],e=this;if(a.displayableSimpleProductReferences){var f=c.filter(a.displayableSimpleProductReferences,function(a){return a.selected&&"17987931"===a.productSpecContainmentID&&"RM"!==a.action});if(f&&f.length>0){var g=e.get("selectedAccessories")||[];c.each(f,function(f){var h=e.createCustomePropertiesForItem(f,!0);h.simpleProductSpecID=f.simpleProductSpecID,h.productID=f.productID,h.productSpecContainmentID=f.productSpecContainmentID,h.parentProductID=f.parentProductID,h.productOrderItemID=a.productOrderItemID,h.name=f.name,h.parentProductSpecContainmentID=f.parentProductSpecContainmentID,h.lob="WS";var i=!1;if("AD"!==f.action)i=!0;else if(f.allowedActions){var j=c.find(f.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}h.hideRemoveLink=i,c.each(f.displayableCharacteristics,function(a){"8822"===a.productSpecCharacteristicID?h.accessoryId=a.value:"8832"===a.productSpecCharacteristicID&&(h.skuId=a.value)}),g.push({accessoryId:h.accessoryId,skuId:h.skuId,productOrderItemID:a.productOrderItemID,productID:h.productID,name:h.name}),d.push(h.skuId),b.push(h)}),e.set({selectedAccessoriesSkuIds:d,selectedAccessories:g})}}return b},populateMobileContent:function(a){var b=[],d=this;if(a.displayableSimpleProductReferences){var e=c.filter(a.displayableSimpleProductReferences,function(a){return a.selected&&"10141011"===a.productSpecContainmentID&&"RM"!==a.action});e&&e.length>0&&c.each(e,function(e){var f=d.createCustomePropertiesForItem(e);f.simpleProductSpecID=e.simpleProductSpecID,f.productID=e.productID,f.productSpecContainmentID=e.productSpecContainmentID,f.parentProductID=e.parentProductID,f.productOrderItemID=a.productOrderItemID,f.name=e.name,f.productOrderItemID=a.productOrderItemID,f.parentProductSpecContainmentID=e.parentProductSpecContainmentID,f.lob="WS";var g=!1;if("AD"!==e.action)g=!0;else if(e.allowedActions){var h=c.find(e.allowedActions,function(a){return"RM"===a.type});h&&!h.allowed&&(g=!0)}f.hideRemoveLink=g,e.displayableCharacteristics&&c.each(e.displayableCharacteristics,function(a){"10048781"===a.productSpecCharacteristicID&&(f.actualAmount=a.value)}),b.push(f)})}return b},populateSharedEquipment:function(a){var b=this,d={};if(a.displayableItems&&c.each(a.displayableItems,function(a){"8930022"===a.productSpecContainmentID&&(a.totalOneTimeCalculatedPrice&&(a.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0===a.totalOneTimeCalculatedPrice.finalAmountIncludingTax)||a.totalRecurringCalculatedPrice&&(a.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===a.totalRecurringCalculatedPrice.finalAmountIncludingTax))&&a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(a){if(a.selected&&a.productSpecPricing&&(a.totalOneTimeCalculatedPrice&&(a.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0===a.totalOneTimeCalculatedPrice.finalAmountIncludingTax)||a.totalRecurringCalculatedPrice&&(a.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===a.totalRecurringCalculatedPrice.finalAmountIncludingTax))){var c=a.productSpecPricing.childPricingSchema;if("8860962"===c.id||"17892581"===c.id){var e=b.createCustomePropertiesForItem(a);e.discountDetails=a.name,d.netlinkInstallationCharges=e}}})}),"Change"!==a.productOrderItemType){var e=b.get("cartPurchaseDetails");e.hasSharedEquipment=!0,b.set("cartPurchaseDetails",e)}return d},getNewlyAddedSimDetails:function(a){var b=!1;c.find(a.displayableBillingOffers,function(a){if("AD"===a.action&&a.name.toUpperCase().indexOf("SIM CARD FEE")>-1)return b=!0,!0});return b||"AD"!==a.action||(b=!0),b},populateBundleObjects:function(a,b){var d={serviceDetails:[],addons:[]},e=[],f=this;if(a.displayableItems){var g=[];if(c.each(a.displayableItems,function(h){if("8854332"===h.productSpecContainmentID&&"Change"!==a.productOrderItemType){var i=f.createCustomePropertiesForItem(h);i.serviceName="Fibre Registration Fee",i.serviceType="Registration Charge",i.noChange=!0,i.serviceId=a.productOfferingID,e.push(i)}else if("9623073"===h.productSpecContainmentID||"9621163"===h.productSpecContainmentID||"9610793"===h.productSpecContainmentID||"9608393"===h.productSpecContainmentID||"12736541"===h.productSpecContainmentID||"9619263"===h.productSpecContainmentID||"Bundle Plan"===h.name)c.each(h.displayableBillingOffers,function(c){if(c.selected&&c.totalRecurringCalculatedPrice&&c.totalRecurringCalculatedPrice.finalAmountIncludingTax>0){var e=f.createCustomePropertiesForItem(c);e.serviceName="Fibre BroadBand",e.serviceType=b,e.serviceId=a.productOfferingID,e.isPlan=!0,d.serviceDetails.push(e)}else if(c.selected){var g=f.createCustomePropertiesForItem(c);c.recurringCalculatedPrices&&c.recurringCalculatedPrices.length>0&&c.recurringCalculatedPrices[0]&&c.recurringCalculatedPrices[0].description?g.name=c.recurringCalculatedPrices[0].description:g.name=c.name,g.productSpecPricingID=c.productSpecPricingID,g.lob="BB",g.productSpecContainmentID=h.productSpecContainmentID,g.parentProductSpecContainmentID=h.parentProductSpecContainmentID,g.parentProductID=h.parentProductID,g.productID=h.productID,g.productOrderItemID=a.productOrderItemID,g.billingOfferID=c.billingOfferID;var i=!0;c.productSpecPricing&&c.productSpecPricing.childPricingSchema&&(g.offerID=c.productSpecPricing.childPricingSchema.id),g.hideRemoveLink=i,d.addons.push(g)}}),g.push(a.productOfferingID),h.displayableItems&&h.displayableItems.length>0&&c.each(h.displayableItems,function(a){"8901522"===a.productSpecContainmentID&&"RM"===a.action&&a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(a){if(a&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0){var b=f.createCustomePropertiesForItem(a);b.name="Penalty",d.penalityFees=b}})});else if("8854312"===h.productSpecContainmentID&&"RM"!==h.action){var i=f.createCustomePropertiesForItem(h);i.serviceName=h.name,i.serviceType="Staff Discount",i.serviceId=a.productOfferingID,i.noChange=!0,d.serviceDetails.push(i)}else if("18082011"!==h.productSpecContainmentID&&"Campaign Discounts"!==h.name||"RM"===h.action){if(h.totalOneTimeCalculatedPrice&&h.totalOneTimeCalculatedPrice.finalAmountIncludingTax||h.totalRecurringCalculatedPrice&&(h.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===h.totalRecurringCalculatedPrice.finalAmountIncludingTax)){var i=f.createCustomePropertiesForItem(h);i.serviceName=h.name,i.serviceType=h.name,i.serviceId=a.productOfferingID,i.noChange=!0,d.serviceDetails.push(i),"18082011"===h.productSpecContainmentID&&h.selected&&f.populatePromoCodeAndCoupons(h)}}else h.displayableBillingOffers&&h.displayableBillingOffers.length>0&&c.each(h.displayableBillingOffers,function(b){if(b.selected&&"AD"===b.action&&"Campaign Discounts BO"!==b.name&&b.productSpecPricing&&"40057212"!==b.productSpecPricing.childPricingSchema.id){var c=f.createCustomePropertiesForItem(b);c.serviceName=b.name,c.serviceType=b.name,c.serviceId=a.productOfferingID,c.noChange=!0,d.serviceDetails.push(c)}}),f.populatePromoCodeAndCoupons(h)}),e&&e.length>0&&(d.serviceDetails=d.serviceDetails.concat(e)),g.length>0){var h=f.get("selectedBundlePlans")||{};h[a.productOrderItemID]=g,f.set("selectedBundlePlans",h)}}return d},populateVoiceObjects:function(a,d,e){var f={serviceDetails:[],addons:[]},g=this;if(a.displayableItems){var h=[],i=[],j=[];for(var k in a.displayableItems){var l=c.find(a.displayableItems[k].displayableCharacteristics,function(a){return a.productSpecCharacteristicID===b.get("MIN_TENURE").FV});if(l){j.push(l.value);break}}if(j.length>0&&g.set("minTenure",j.concat(g.get("minTenure"))),c.each(a.displayableItems,function(b){if("8613592"===b.productSpecContainmentID||"Fixed Voice Main"===b.name){var j;if(c.find(b.displayableCharacteristics,function(a){if("8609352"===a.productSpecCharacteristicID)return j=a.value,!0}),b.displayableBillingOffers)c.each(b.displayableBillingOffers,function(d){if(d&&d.productSpecPricing&&"8621582"===d.productSpecPricing.childPricingSchema.id){if(b.serviceID){var e=g.createCustomePropertiesForItem(d);e.serviceName="Land Line Number",e.serviceId=a.productOfferingID,e.details="+65 "+b.serviceID,"Change"===a.productOrderItemType&&(e.noChange=!0),f.landlineNumber=e}}else if(d.selected&&d.productSpecPricing&&"17893091"===d.productSpecPricing.childPricingSchema.id&&"Change"!==a.productOrderItemType){var e=g.createCustomePropertiesForItem(d);e.serviceName="NetLink Activation Charges",e.serviceType="Activation Charge",e.noChange=!0,e.serviceId=a.productOfferingID,f.serviceDetails.push(e)}else if(d.selected&&d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&"Fixed Voice Downgrade Penalty"!==d.productSpecPricing.childPricingSchema.name&&(d.totalOneTimeCalculatedPrice||d.totalOneTimeCalculatedPrice.finalAmountIncludingTax||d.totalRecurringCalculatedPrice||d.totalRecurringCalculatedPrice.finalAmountIncludingTax)){var i=g.createCustomePropertiesForItem(d);d.recurringCalculatedPrices&&d.recurringCalculatedPrices.length>0&&d.recurringCalculatedPrices[0]&&d.recurringCalculatedPrices[0].description?i.name=d.recurringCalculatedPrices[0].description:i.name=d.name,i.lob="FV",i.productSpecPricingID=d.productSpecPricingID,i.productSpecContainmentID=b.productSpecContainmentID,i.parentProductSpecContainmentID=b.parentProductSpecContainmentID,i.parentProductID=b.parentProductID,i.billingOfferID=d.billingOfferID,d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&(i.offerID=d.productSpecPricing.childPricingSchema.id),i.productID=b.productID,i.productOrderItemID=a.productOrderItemID;var j=!1;if("AD"!==d.action)j=!0;else if(d.allowedActions){var k=c.find(d.allowedActions,function(a){return"RM"===a.type});k&&!k.allowed&&(j=!0)}i.hideRemoveLink=j,f.addons.push(i),h.push(d.billingOfferID)}});else if(b.serviceID){var k=g.createCustomePropertiesForItem(b);k.serviceName="Land Line Number",k.serviceId=a.productOfferingID,k.details="+65 "+b.serviceID,"Change"===a.productOrderItemType&&(k.noChange=!0),f.landlineNumber=k}var l={productID:a.productID,serviceTechnology:j,serviceType:"FV"},m=g.get("productDetails");m.push(l),g.set("productDetails",m)}else if("8613372"===b.productSpecContainmentID){var k=g.createCustomePropertiesForItem(b);k.serviceName="Land Line",k.serviceType=d,k.serviceId=a.productOfferingID,k.noChange=!0,f.serviceDetails.push(k),e?b.displayableItems&&b.displayableItems.length>0&&c.each(b.displayableItems,function(a){"8613362"===a.productSpecContainmentID&&"RM"===a.action&&a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(a){if(a&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0){var b=g.createCustomePropertiesForItem(a);b.name="Penalty",f.penalityFees=b}})}):(f.fvPlanDetails=k,i.push(a.productOfferingID))}else if(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax)){if(b.displayableBillingOffers&&b.displayableBillingOffers.length>0)c.each(b.displayableBillingOffers,function(d){if(d.selected){var e=g.createCustomePropertiesForItem(d);d.recurringCalculatedPrices&&d.recurringCalculatedPrices.length>0&&d.recurringCalculatedPrices[0]&&d.recurringCalculatedPrices[0].description?e.name=d.recurringCalculatedPrices[0].description:e.name=d.name,e.lob="FV",e.productSpecPricingID=d.productSpecPricingID,e.productSpecContainmentID=b.productSpecContainmentID,e.parentProductSpecContainmentID=b.parentProductSpecContainmentID,e.parentProductID=b.parentProductID,e.productID=b.productID,e.billingOfferID=d.billingOfferID,d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&(e.offerID=d.productSpecPricing.childPricingSchema.id),e.productOrderItemID=a.productOrderItemID;var i=!1;if("AD"!==d.action)i=!0;else if(d.allowedActions){var j=c.find(d.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}e.hideRemoveLink=i,f.addons.push(e),h.push(d.billingOfferID)}});else{var n=g.createCustomePropertiesForItem(b);n.name=b.name,n.lob="FV",n.productSpecContainmentID=b.productSpecContainmentID,n.parentProductSpecContainmentID=b.parentProductSpecContainmentID,n.parentProductID=b.parentProductID,n.productID=b.productID,n.productOrderItemID=a.productOrderItemID,f.addons.push(n)}b.displayableItems&&b.displayableItems.length>0&&c.each(b.displayableItems,function(b){(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax))&&b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(d){if(d.selected){var e=g.createCustomePropertiesForItem(d);d.recurringCalculatedPrices&&d.recurringCalculatedPrices.length>0&&d.recurringCalculatedPrices[0]&&d.recurringCalculatedPrices[0].description?e.name=d.recurringCalculatedPrices[0].description:e.name=d.name,
e.lob="FV",e.productSpecPricingID=d.productSpecPricingID,e.productSpecContainmentID=b.productSpecContainmentID,e.parentProductSpecContainmentID=b.parentProductSpecContainmentID,e.parentProductID=b.parentProductID,e.productID=b.productID,e.billingOfferID=d.billingOfferID,d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&(e.offerID=d.productSpecPricing.childPricingSchema.id),e.productOrderItemID=a.productOrderItemID;var i=!1;if("AD"!==d.action)i=!0;else if(d.allowedActions){var j=c.find(d.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}e.hideRemoveLink=i,f.addons.push(e),h.push(d.billingOfferID)}})}),"18059171"===b.productSpecContainmentID&&b.selected&&g.populatePromoCodeAndCoupons(b)}"18059171"===b.productSpecContainmentID&&b.selected&&g.populatePromoCodeAndCoupons(b)}),i.length>0){var m=g.get("selectedFVPlans")||{};m[a.productOrderItemID]=i,g.set("selectedFVPlans",m)}if(h.length>0){var n=g.get("selectedAddons")||{};n[a.productOrderItemID]=h,g.set("selectedAddons",n)}}return f},populateBroadbandObjects:function(a){var d={addons:[],premiumAddons:[],serviceDetails:[]},e={productID:a.productID,serviceType:"BB"},f=this;if(a.displayableItems){var g,h=[],i=[],j=b.get("relaxInternetFilter"),k=[];for(var l in a.displayableItems){var m=c.find(a.displayableItems[l].displayableCharacteristics,function(a){return a.productSpecCharacteristicID===b.get("MIN_TENURE").BB});if(m){k.push(m.value);break}}if(k.length>0&&f.set("minTenure",k.concat(f.get("minTenure"))),j===!1&&(g=c.find(a.displayableItems,function(a){return"8363682"===a.productSpecContainmentID})),c.each(a.displayableItems,function(b){if(("18733721"===b.productSpecContainmentID||"Gamer GPN"===b.name)&&b.displayableBillingOffers&&b.displayableBillingOffers.length>0){var k=c.find(b.displayableBillingOffers,function(a){return a.selected&&("WTFast (Bundled)"===a.name||"18665201"===a.productSpecPricing.childPricingSchema.id)});k&&c.find(b.displayableCharacteristics,function(c){if("8798882"===c.productSpecCharacteristicID){var d={productID:b.productID,productOrderItemID:a.productOrderItemID,characteristicID:c.productSpecCharacteristicID,characteristicValue:c.value};f.set("gamerVasChanges",d)}})}if("8625412"===b.productSpecContainmentID){var l=c.find(b.displayableCharacteristics,function(a){return"8622642"===a.productSpecCharacteristicID});i.push(a.productOfferingID),l&&(d.singnetId=l.value)}else if("8625612"===b.productSpecContainmentID||"Broadband Main"===b.name){b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(b){if(b.selected&&b.productSpecPricing&&(b.totalOneTimeCalculatedPrice&&(b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0===b.totalOneTimeCalculatedPrice.finalAmountIncludingTax)||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax))){var c=b.productSpecPricing.childPricingSchema;if("8873082"===c.id){var e=f.createCustomePropertiesForItem(b);e.discountDetails=b.name,d.fibreInstallationCharges=e}else if("17893091"===c.id&&"Change"!==a.productOrderItemType){var g=f.createCustomePropertiesForItem(b);g.serviceName="NetLink Activation Charges",g.serviceType="Activation Charge",g.noChange=!0,g.serviceId=a.productOfferingID,d.serviceDetails.push(g)}else if(b.name.indexOf("Delivery Charge Immediate")>-1||"13970921"===c.id||"13970931"===c.id||"13970911"===c.id){var h=f.createCustomePropertiesForItem(b,!0);h.deliveryType="Standard Delivery",h.isImmediateCharge=!0,h.discountDetails=b.name,d.deliveryDetails=h}else if(b.name.indexOf("Delivery Charge")>-1){var h=f.createCustomePropertiesForItem(b);h.deliveryType="Standard Delivery",h.discountDetails=b.name,h.isImmediateCharge=!1,d.deliveryDetails=h}}});var m;c.find(b.displayableCharacteristics,function(a){if("8609352"===a.productSpecCharacteristicID)return m=a.value,!0}),e.serviceTechnology=m}else if("8704182"===b.productSpecContainmentID){if(b.displayableBillingOffers&&b.displayableBillingOffers.length>0){var n=!1,o=c.find(b.displayableCharacteristics,function(a){return"13897781"===a.productSpecCharacteristicID&&"Instalments"===a.value});o&&(n=!0),c.each(b.displayableBillingOffers,function(c){if(c.selected&&c.productSpecPricing&&(c.totalOneTimeCalculatedPrice&&(c.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0===c.totalOneTimeCalculatedPrice.finalAmountIncludingTax)||c.totalRecurringCalculatedPrice&&(c.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===c.totalRecurringCalculatedPrice.finalAmountIncludingTax))){var e=f.createCustomePropertiesForItem(c);e.name=c.name,e.billingOfferID=c.billingOfferID,c.productSpecPricing&&c.productSpecPricing.childPricingSchema&&(e.offerID=c.productSpecPricing.childPricingSchema.id),e.productID=b.productID,e.productOrderItemID=a.productOrderItemID,e.ippFlag=n,d.premiumAddons.push(e)}})}}else if("13051101"!==b.productSpecContainmentID&&"13051081"!==b.productSpecContainmentID&&"Additional RG"!==b.name&&"Additional AP"!==b.name||"AD"!==b.action){if("9622043"===b.productSpecContainmentID||"Internet Applications"===b.name||b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax)){if("8625602"===b.productSpecContainmentID||"Broadband Plan"===b.name){var m;c.find(b.displayableCharacteristics,function(a){if("8622962"===a.productSpecCharacteristicID)return m=a.value,!0}),e.networkSpeed=m}if(b.displayableBillingOffers&&b.displayableBillingOffers.length>0)c.each(b.displayableBillingOffers,function(e){if(e.selected){var i=f.createCustomePropertiesForItem(e);e.recurringCalculatedPrices&&e.recurringCalculatedPrices.length>0&&e.recurringCalculatedPrices[0]&&e.recurringCalculatedPrices[0].description?i.name=e.recurringCalculatedPrices[0].description:i.name=e.name,i.productSpecPricingID=e.productSpecPricingID,i.lob="BB",i.productSpecContainmentID=b.productSpecContainmentID,!g||j!==!1||"14396101"!==b.productSpecContainmentID&&"14396081"!==b.productSpecContainmentID&&"Internet Filter"!==b.name?i.specialAddon=!1:(i.specialAddon=!0,i.mainProductId=g.productID),i.parentProductSpecContainmentID=b.parentProductSpecContainmentID,i.parentProductID=b.parentProductID,i.productID=b.productID,i.productOrderItemID=a.productOrderItemID,i.billingOfferID=e.billingOfferID;var k=!1;if("AD"!==e.action)k=!0;else if(e.allowedActions){var l=c.find(e.allowedActions,function(a){return"RM"===a.type});l&&!l.allowed&&(k=!0)}e.productSpecPricing&&e.productSpecPricing.childPricingSchema&&(i.offerID=e.productSpecPricing.childPricingSchema.id),i.hideRemoveLink=k,i.action=e.action,d.addons.push(i),h.push(e.billingOfferID)}});else{var p=f.createCustomePropertiesForItem(b);p.name=b.name,p.productSpecContainmentID=b.productSpecContainmentID,p.parentProductSpecContainmentID=b.parentProductSpecContainmentID,p.parentProductID=b.parentProductID,p.productID=b.productID,p.lob="BB",p.productOrderItemID=a.productOrderItemID,d.addons.push(p)}b.displayableItems&&b.displayableItems.length>0&&c.each(b.displayableItems,function(b){(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax))&&b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(e){if(e.selected){var i=f.createCustomePropertiesForItem(e);e.recurringCalculatedPrices&&e.recurringCalculatedPrices.length>0&&e.recurringCalculatedPrices[0]&&e.recurringCalculatedPrices[0].description?i.name=e.recurringCalculatedPrices[0].description:i.name=e.name,i.productSpecPricingID=e.productSpecPricingID,i.lob="BB",i.productSpecContainmentID=b.productSpecContainmentID,!g||j!==!1||"14396101"!==b.productSpecContainmentID&&"14396081"!==b.productSpecContainmentID&&"Internet Filter"!==b.name?i.specialAddon=!1:(i.specialAddon=!0,i.mainProductId=g.productID),i.parentProductSpecContainmentID=b.parentProductSpecContainmentID,i.parentProductID=b.parentProductID,i.productID=b.productID,i.productOrderItemID=a.productOrderItemID,i.billingOfferID=e.billingOfferID;var k=!1;if("AD"!==e.action)k=!0;else if(e.allowedActions){var l=c.find(e.allowedActions,function(a){return"RM"===a.type});l&&!l.allowed&&(k=!0)}e.productSpecPricing&&e.productSpecPricing.childPricingSchema&&(i.offerID=e.productSpecPricing.childPricingSchema.id),i.hideRemoveLink=k,i.action=e.action,d.addons.push(i),h.push(e.billingOfferID)}})}),"18059181"!==b.productSpecContainmentID&&"Campaign Discounts"!==b.name||!b.selected||f.populatePromoCodeAndCoupons(b)}else if("8625602"===b.productSpecContainmentID||"Broadband Plan"===b.name){var m;c.find(b.displayableCharacteristics,function(a){if("8622962"===a.productSpecCharacteristicID)return m=a.value,!0}),e.networkSpeed=m}}else{var q=f.get("cartPurchaseDetails");q.hasPurchasedRG=!0,f.set("cartPurchaseDetails",q);var r=f.get("premiumAddonDetails"),s={};c.each(b.displayableCharacteristics,function(a){"8832"===a.productSpecCharacteristicID?s.sku=a.value:"8489052"===a.productSpecCharacteristicID?s.spsid=a.value:"8629512"===a.productSpecCharacteristicID&&(s.name=a.value)}),s.sku&&r.push(s),f.set("premiumAddonDetails",r)}"18059181"!==b.productSpecContainmentID&&"Campaign Discounts"!==b.name||!b.selected||f.populatePromoCodeAndCoupons(b)}),i.length>0){var n=f.get("selectedBBPlans")||{};n[a.productOrderItemID]=i,f.set("selectedBBPlans",n)}if(h.length>0){var o=f.get("selectedAddons")||{};o[a.productOrderItemID]=h,f.set("selectedAddons",o)}!a.productServiceID||"undefined"!=typeof d.singnetId&&null!==d.singnetId||(d.productServiceID=a.productServiceID);var p=f.get("productDetails");p.push(e),f.set("productDetails",p)}if(a.displayableSimpleProductReferences){var q=f.getPremiumAddons(a,a.productOrderItemID);q&&q.length>0&&(d.premiumAddons=d.premiumAddons.concat(q))}return"Change"===a.productOrderItemType&&(d.isRecon=!0),d},populateTVObjects:function(a){var d={addons:[],topup:[],serviceDetails:[]},e=this,f={productID:a.productID,serviceType:"TV"};if(a.displayableItems){var g=[],h=[],i=[];for(var j in a.displayableItems){var k=c.find(a.displayableItems[j].displayableCharacteristics,function(a){return a.productSpecCharacteristicID===b.get("MIN_TENURE").TV});if(k){i.push(k.value);break}}if(i.length>0&&e.set("minTenure",i.concat(e.get("minTenure"))),c.each(a.displayableItems,function(b){if("8635232"===b.productSpecContainmentID||"TV Main"===b.name){var i=b.displayableBillingOffers;if(i&&i.length>0){var j;if(c.each(i,function(b){if(b.selected&&b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&"9006942"===b.productSpecPricing.childPricingSchema.id)j=b;else if(b.selected&&b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&"17893091"===b.productSpecPricing.childPricingSchema.id&&"Change"!==a.productOrderItemType){var c=e.createCustomePropertiesForItem(b);c.serviceName="NetLink Activation Charges",c.serviceType="Activation Charge",c.noChange=!0,c.serviceId=a.productOfferingID,d.serviceDetails.push(c)}}),j){var k=e.createCustomePropertiesForItem(j);k.discountDetails=j.name,d.fibreInstallationCharges=k}}var l=b.displayableSimpleProductReferences;if(l&&l.length>0){var m=c.find(l,function(a){return"AD"===a.action||"UP"===a.action});"undefined"!=typeof m&&null!==m||(m=l[0]);var n=e.createCustomePropertiesForItem(m);n.serviceName="Singtel TV",n.serviceType=m.name,n.planId=m.simpleProductSpecID,d.tvPlanDetails=n,h.push(m.simpleProductSpecID)}else if(a.displayableSimpleProductReferences&&a.displayableSimpleProductReferences.length>0){var l=c.filter(a.displayableSimpleProductReferences,function(a){return"8635232"===a.parentProductSpecContainmentID&&("AD"===a.action||"UP"===a.action)});l&&l.length>0&&c.each(l,function(b){if("8861282"===b.productSpecContainmentID){var c=e.createCustomePropertiesForItem(b);c.serviceName="Singtel TV",c.serviceType=b.name,c.serviceId=a.productOfferingID,d.tvPlanDetails=c,h.push(b.simpleProductSpecID)}else if("12297251"===b.productSpecContainmentID){var f=e.createCustomePropertiesForItem(b);f.name=b.name,d.specialDiscounts=f}})}var o;c.find(b.displayableCharacteristics,function(a){if("8609352"===a.productSpecCharacteristicID)return o=a.value,!0}),f.serviceTechnology=o}else if("8861292"===b.productSpecContainmentID){if(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax){var p=e.createCustomePropertiesForItem(b);p.name="Penalty",d.penalityFees=p}else if(b.displayableBillingOffers&&b.displayableBillingOffers.length>0){var q=c.find(b.displayableBillingOffers,function(a){return a.penalty&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax});if(q){var p=e.createCustomePropertiesForItem(q);p.name="Penalty",d.penalityFees=p}}}else if("10797291"===b.productSpecContainmentID){var p=e.createCustomePropertiesForItem(b);p.hideRemoveLink=!1,p.name="Set Top Box",b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(a){a.selected&&"AD"!==a.action&&(p.hideRemoveLink=!0)}),b.displayableCharacteristics&&b.displayableCharacteristics.length>0&&c.each(b.displayableCharacteristics,function(a){"8631732"===a.productSpecCharacteristicID&&(p.name=a.value+" "+p.name)}),d.topup.push(p)}else if("8635162"===b.productSpecContainmentID&&"RM"!==b.action){var p=e.createCustomePropertiesForItem(b);p.name=b.name,d.staffDiscount=p}else if("8861282"===b.productSpecContainmentID){if("undefined"==typeof d.tvPlanDetails||null===d.tvPlanDetails){var n=e.createCustomePropertiesForItem(b);n.serviceName="Singtel TV",n.serviceType=n.name,n.serviceId=a.productOfferingID,d.tvPlanDetails=n,h.push(b.simpleProductSpecID||a.productOfferingID)}b.displayableItems&&b.displayableItems.length>0&&c.each(b.displayableItems,function(a){"8861292"===a.productSpecContainmentID&&"RM"===a.action&&a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(a){if(a&&a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0){var b=e.createCustomePropertiesForItem(a);b.name="Penalty",d.penalityFees=b}})})}else if(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax)){var k=e.createCustomePropertiesForItem(b);if(k.name=b.name,b.displayableBillingOffers&&b.displayableBillingOffers.length>0)c.each(b.displayableBillingOffers,function(f){if(f.selected){var h=e.createCustomePropertiesForItem(f);f.recurringCalculatedPrices&&f.recurringCalculatedPrices.length>0&&f.recurringCalculatedPrices[0]&&f.recurringCalculatedPrices[0].description?h.name=f.recurringCalculatedPrices[0].description:h.name=f.name,h.productSpecPricingID=f.productSpecPricingID,h.productSpecContainmentID=b.productSpecContainmentID,h.parentProductSpecContainmentID=b.parentProductSpecContainmentID,h.parentProductID=b.parentProductID,h.productID=b.productID,h.lob="TV",h.productOrderItemID=a.productOrderItemID;var i=!1;if("AD"!==f.action)i=!0;else if(f.allowedActions){var j=c.find(f.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}h.hideRemoveLink=i,f.productSpecPricing&&f.productSpecPricing.childPricingSchema&&(h.offerID=f.productSpecPricing.childPricingSchema.id),h.billingOfferID=f.billingOfferID,d.addons.push(h),g.push(f.billingOfferID)}});else{var k=e.createCustomePropertiesForItem(b);k.name=b.name,k.productSpecContainmentID=b.productSpecContainmentID,k.parentProductSpecContainmentID=b.parentProductSpecContainmentID,k.parentProductID=b.parentProductID,k.productID=b.productID,k.lob="TV",k.productOrderItemID=a.productOrderItemID,d.addons.push(k)}b.displayableItems&&b.displayableItems.length>0&&c.each(b.displayableItems,function(b){(b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.finalAmountIncludingTax||b.totalRecurringCalculatedPrice&&(b.totalRecurringCalculatedPrice.finalAmountIncludingTax||0===b.totalRecurringCalculatedPrice.finalAmountIncludingTax))&&b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&c.each(b.displayableBillingOffers,function(f){if(f.selected){var h=e.createCustomePropertiesForItem(f);f.recurringCalculatedPrices&&f.recurringCalculatedPrices.length>0&&f.recurringCalculatedPrices[0]&&f.recurringCalculatedPrices[0].description?h.name=f.recurringCalculatedPrices[0].description:h.name=f.name,h.productSpecPricingID=f.productSpecPricingID,h.productSpecContainmentID=b.productSpecContainmentID,h.parentProductSpecContainmentID=b.parentProductSpecContainmentID,h.parentProductID=b.parentProductID,h.productID=b.productID,h.lob="TV",h.productOrderItemID=a.productOrderItemID;var i=!1;if("AD"!==f.action)i=!0;else if(f.allowedActions){var j=c.find(f.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}h.hideRemoveLink=i,f.productSpecPricing&&f.productSpecPricing.childPricingSchema&&(h.offerID=f.productSpecPricing.childPricingSchema.id),h.billingOfferID=f.billingOfferID,d.addons.push(h),g.push(f.billingOfferID)}})}),"18059191"===b.productSpecContainmentID&&b.selected&&e.populatePromoCodeAndCoupons(b)}"18059191"===b.productSpecContainmentID&&b.selected&&e.populatePromoCodeAndCoupons(b)}),a.displayableSimpleProductReferences&&a.displayableSimpleProductReferences.length>0){var l=c.filter(a.displayableSimpleProductReferences,function(a){return(a.businessType="TV_PACKAGE")&&"8635232"!==a.parentProductSpecContainmentID});l&&l.length>0&&c.each(l,function(b){c.each(b.displayableBillingOffers,function(f){if(f.selected){var h=e.createCustomePropertiesForItem(f);f.recurringCalculatedPrices&&f.recurringCalculatedPrices.length>0&&f.recurringCalculatedPrices[0]&&f.recurringCalculatedPrices[0].description?h.name=f.recurringCalculatedPrices[0].description:h.name=f.name,h.productSpecPricingID=f.productSpecPricingID,h.productSpecContainmentID=b.productSpecContainmentID,h.parentProductSpecContainmentID=b.parentProductSpecContainmentID,h.parentProductID=b.parentProductID,h.productID=b.productID,h.lob="TV",h.productOrderItemID=a.productOrderItemID,h.billingOfferID=f.billingOfferID,f.productSpecPricing&&f.productSpecPricing.childPricingSchema&&(h.offerID=f.productSpecPricing.childPricingSchema.id);var i=!1;if("AD"!==f.action)i=!0;else if(f.allowedActions){var j=c.find(f.allowedActions,function(a){return"RM"===a.type});j&&!j.allowed&&(i=!0)}h.hideRemoveLink=i,d.addons.push(h),g.push(f.billingOfferID)}})})}if(h.length>0){var m=e.get("selectedTVPlans")||{};m[a.productOrderItemID]=h,e.set("selectedTVPlans",m)}if(g.length>0){var n=e.get("selectedAddons")||{};n[a.productOrderItemID]=g,e.set("selectedAddons",n)}}"Change"===a.productOrderItemType&&(d.isRecon=!0);var o=e.get("productDetails");return o.push(f),e.set("productDetails",o),d},populateChargeableEmailDetails:function(a){var b=this,d=b.get("chargeableEmail"),e=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if(a&&a.isRecon&&a.addons&&(d&&d.freeBillingOfferList||e&&e.freeEmailIdFlag))if(d&&d.freeBillingOfferList){var f=d.freeBillingOfferList,g=d.existingBoIds,h=c.find(a.addons,function(a){return c.contains(f,a.offerID)&&"AD"!==a.action}),i=!1;if(h&&g&&g.length>0&&(i=c.find(a.addons,function(a){return c.contains(g,a.offerID)&&"AD"!==a.action})),h&&!i){var e={freeEmailIdFlag:!0,productID:h.productID,productOrderItemID:h.productOrderItemID,productSpecContainmentID:h.productSpecContainmentID,isPresent:!0};b.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",e)}else b.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null)}else if(e&&e.freeEmailIdFlag){var h=c.find(a.addons,function(a){if("AD"!==a.action){var b=c.find(e.freeBOIDs,function(b){return b.freeBOID===a.offerID});if(b)return!0}});h&&(e.isPresent=!0,b.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",e))}else b.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null);else b.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null)}})});
define("businesswidget/repository_l9_common/common/model/SelfCollectReserveNowModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"/sdp/lamp/reserve",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"POST",contentType:"application/json",payload:["ImplReservationRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/SelfCollectNowRetrieveModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/model/SelfCollectReserveNowModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c,d,e,f){var g=a.Core.ObservableViewModel.extend({models:{selfCollectNowRetrieveModel:c,selfCollectNowReserveModel:e},subViewModels:{shoppingCartViewModel:d,orderInContextTopicViewModel:f},persistent:["collectNowData"],defaults:{selfCollectNowVmStatus:"",selfCollectNowInputInfo:{},selfCollectNowStoresList:null,collectNowData:null,skuList:[]},initialize:function(){b.bindAll(this,"handleAppointment","getSkuList","processCreateAppointment")},retrieveCollectNowStores:function(a){var c,d=this,e=d.getSkuList("all"),f=$.Deferred(),g=d.getModel("selfCollectNowRetrieveModel"),h=d.getValueByPath("selfCollectNowInputInfo.zone");return d.set("skuList",e),d.isErrorReq=!!b.isUndefined(a)||a,d.set("selfCollectNowVmStatus","fetchingData"),c={ImplEnquireAvailableStockRequest:{skuList:e}},h&&(c.ImplEnquireAvailableStockRequest.zone=h),g.save(c).then(function(a){"undefined"!=typeof a.ImplEnquireAvailableStockResponse&&a.ImplEnquireAvailableStockResponse.implPOPStationDetails?(d.isErrorReq&&(d.set("selfCollectNowStoresList",a.ImplEnquireAvailableStockResponse.implPOPStationDetails),d.set("selfCollectNowVmStatus","collectNowStoresRetrieved")),f.resolve("storeFound")):(d.isErrorReq&&d.set("selfCollectNowVmStatus","storeNotFound"),f.resolve("storeNotFound")),f.resolve("storeNotFound")},function(){d.isErrorReq&&d.set("selfCollectNowVmStatus","storeNotFound"),f.resolve("storeNotFound")}),f},createAppointment:function(){var a=this,b=$.Deferred(),c=a.cancelAppointment();return c.then(function(c){a.processCreateAppointment().then(function(){b.resolve()},function(){b.reject()})}),b},processCreateAppointment:function(){var a,b=this,c=this.getValueByPath("selfCollectNowInputInfo.selectedLocker");a={ImplReservationRequest:{skuList:b.get("skuList"),actionIndicator:"R",collectionPointType:c.collectionPointType,collectionPointCode:c.KioskId}};var d=$.Deferred();return b.handleAppointment(a).then(function(a){if(a&&a.ImplReservationResponse){var c=b.subViewModels.orderInContextTopicViewModel.get("orderActions"),e=b.getValueByPath("selfCollectNowInputInfo.selectedLocker");b.set("collectNowData",{lampTrackingID:a.ImplReservationResponse.lampTrackingID,imsi:a.ImplReservationResponse.imsi,imei:a.ImplReservationResponse.imei,trackingID:a.ImplReservationResponse.trackingID,orderActionIDX9:c[0].productOrderItemID,collectionPointType:e.collectionPointType,collectionPointCode:e.KioskId,skuList:b.get("skuList")}),b.set("selfCollectNowVmStatus","createAppointmentSuccess")}d.resolve()},function(){d.reject()}),d},cancelAppointment:function(){var a,b=this,c=this.get("collectNowData")||{},d=$.Deferred();return c&&c.lampTrackingID?(a={ImplReservationRequest:{skuList:c.skuList,actionIndicator:"C",collectionPointType:c.collectionPointType,collectionPointCode:c.KioskId,lampTrackingID:c.lampTrackingID}},b.handleAppointment(a).then(function(a){b.set("collectNowData",null),d.resolve()},function(){d.resolve()})):d.resolve(),d},extendAppointment:function(){var a,b=this,c=this.getValueByPath("selfCollectNowInputInfo.selectedLocker"),c=this.get("collectNowData")||{};return a={ImplReservationRequest:{skuList:c.skuList,actionIndicator:"K",collectionPointType:c.collectionPointType,collectionPointCode:c.KioskId,lampTrackingID:c.lampTrackingID}},b.handleAppointment(a).then(function(a){appointmentDeferred.resolve()},function(){appointmentDeferred.reject()}),appointmentDeferred},handleAppointment:function(a){this.set("selfCollectNowVmStatus","handleAppointment");var b=this.getModel("selfCollectNowReserveModel");return b.save(a)},getSkuList:function(a){var c=[],d=this.subViewModels.shoppingCartViewModel.get("selectedFreebiesSkuList")||[],e=this.subViewModels.shoppingCartViewModel.get("selectedDevicesSkuList")||[],f=this.subViewModels.shoppingCartViewModel.get("selectedAccessoriesSkuIds")||[],g=this.subViewModels.shoppingCartViewModel.get("selectedSimSkuList")||[],h=f.concat(d,g);switch(a){case"all":c=h.concat(e);break;case"device":c=e;break;case"others":c=h;break;case"accessory":c=f;break;case"freebie":c=d;break;case"sim":c=g}return c=b.filter(c,function(a){return a})}});return g});
define("businesswidget/repository_l9_common/common/model/SingtelStoreRetrieveTimeSlotsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/contact-person/:contactId/timeslots",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplEAppointmentTimeSlotsRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelAnonymousStoreRetrieveTimeSlotsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/anonymous/timeslots",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplEAppointmentTimeSlotsRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelStoreViewEAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/contact-person/:CONTACT_ID/view",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplViewAppointmentRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelStoreCancelEAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/contact-person/:CONTACT_ID/cancel",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplCancelAppointmentRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelStoreCreateEAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/contact-person/:contactId/create",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplCreateAppointmentRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelStoreConfirmEAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/contact-person/:CONTACT_ID/confirm",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplConfirmAppointmentRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelAnonymousStoreCreateEAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/anonymous/create",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplCreateAppointmentRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SingtelStoreEditEAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/eappointment/contact-person/:CONTACT_ID/edit",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplEditAppointmentRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/SingtelStoreRetrieveTimeSlotsModel","businesswidget/repository_l9_common/common/model/SingtelAnonymousStoreRetrieveTimeSlotsModel","businesswidget/repository_l9_common/common/model/SingtelStoreViewEAppointmentModel","businesswidget/repository_l9_common/common/model/SingtelStoreCancelEAppointmentModel","businesswidget/repository_l9_common/common/model/SingtelStoreCreateEAppointmentModel","businesswidget/repository_l9_common/common/model/SingtelStoreConfirmEAppointmentModel","businesswidget/repository_l9_common/common/model/SingtelAnonymousStoreCreateEAppointmentModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","moment","businesswidget/repository_l9_common/common/model/SingtelStoreEditEAppointmentModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=a.Core.ObservableViewModel.extend({models:{retrieveTimeSlotsModel:c,anonymousRetrieveTimeSlotsModel:d,viewEAppointmentModel:e,cancelEAppointmentModel:f,createEAppointmentModel:g,confirmEAppointmentModel:h,anonymousCreateEAppointmentModel:i,singtelStoreEditEAppointmentModel:p},subViewModels:{individualInContextTopicViewModel:j,onePassTopicViewModel:k,implUserContextTopicViewModel:l,orderTopicViewModel:m,customerTopicViewModel:n},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],persistent:["storeAptDetails","newAppointmentInput","newApptId","newApptState","existingApptId"],defaults:{storeEAppointmentSlots:null,singtelStoreAptVmStatus:"",contactId:null,selectedStoreDetails:{dealer:null,selectedStore:null,startDate:null,endDate:null,disabledSlots:null,leadDays:null,endDays:null},errorObj:null,existingApptId:null,newApptId:null,newApptState:null,storeAptDetails:{},newAppointmentInput:{apptId:null,apptState:null,externalId:null,customerId:null,customerIdType:null,dealerCode:null,siteId:null,startTimestamp:null,endTimestamp:null,transactionType:null,serviceType:null,source:null,name:null,contactNumber:null,contactEmail:null,reserveOnly:!0,reservationDetail:null,slotDesc:null},slots:[],reservePayload:"",exisitingAppointmentInput:null,viewAptData:[],newAptDetails:null,existingAptDetails:[],availableStore:[],hideStore:!1},initialize:function(){b.bindAll(this,"retrieveStoreTimeSlots","formatTimeSlots","reformatDate","retrieveExistingAppointment","mapAppointmentWithFsAppointment","createEShopStoreAppointment","anonymousRetrieveStoreTimeSlots","getRetrieveTimeSlotPayload","doRetrieveStoreTimeSlots","getCreateAppointmentPayload","checkStoreAvailablity","mapDeliveryAddress","confirmEshopAppointment","checkAndConfirmEAppointment","createECareStoreAppointment","showHideStore","isAptTimeValid");
},retrieveStoreTimeSlots:function(){var a=this,b=a.getModel("retrieveTimeSlotsModel");b.set("contactId",a.get("contactId")),a.doRetrieveStoreTimeSlots(b)},anonymousRetrieveStoreTimeSlots:function(){var a=this,b=a.getModel("anonymousRetrieveTimeSlotsModel");a.doRetrieveStoreTimeSlots(b)},getRetrieveTimeSlotPayload:function(){var a=this.get("selectedStoreDetails"),b={ImplEAppointmentTimeSlotsRequest:{startDate:a.startDate,endDate:a.endDate,dealerCode:a.dealer,siteId:a.siteId,disableSlots:a.disableSlots}};return b},doRetrieveStoreTimeSlots:function(a){var b=this,c=b.getRetrieveTimeSlotPayload();return b.set({storeEAppointmentSlots:null,singtelStoreAptVmStatus:"retrieveTimeSlots"}),a.save(c).then(function(a){return a&&a.ImplEAppointmentTimeSlotsResponse&&a.ImplEAppointmentTimeSlotsResponse.implEAppointmentTimeSlots?(b.formatTimeSlots(a.ImplEAppointmentTimeSlotsResponse.implEAppointmentTimeSlots),b.set("singtelStoreAptVmStatus","slotsRetrieved")):b.set("singtelStoreAptVmStatus","timeSlotsNotRetrieved"),a},function(){b.set("singtelStoreAptVmStatus","timeSlotsNotRetrieved")})},formatTimeSlots:function(a){var c={enabledDays:[],dateTimeSlots:{},dateTimeSlotsObj:{}},d=this,e=[];a.sort(function(a,b){return a.startDateTime-b.startDateTime}),b.each(a,function(a){a.slotDate=d.reformatDate(a.slotDate,"/"),e.push(a),b.contains(c.enabledDays,a.slotDate)||c.enabledDays.push(a.slotDate);var f=c.dateTimeSlots[a.slotDate],g=c.dateTimeSlotsObj[a.slotDate];"undefined"==typeof f&&(f=[],g=[]),g.push(b.extend({id:a.id,value:a.slotCode,title:a.slotDesc,text:a.slotDesc},a)),f.push(a.slotDesc),f=b.uniq(f),c.dateTimeSlots[a.slotDate]=f,c.dateTimeSlotsObj[a.slotDate]=g});var f=b.uniq(c.enabledDays);c.enabledDays=f,d.set({storeEAppointmentSlots:c,slots:e,singtelStoreAptVmStatus:"timeSlotsRetrieved"})},reformatDate:function(a,b){dArr=a.split(b);var c=parseInt(dArr[0]);c=c<10?"0"+c:c;var d=parseInt(dArr[1]);return d=d<10?"0"+d:d,dArr[2]+"-"+c+"-"+d},createECareStoreAppointment:function(){var a,b=this,c=b.get("newAppointmentInput"),d=b.get("contactId");"undefined"!=typeof d&&null!==d&&""!==d?(a=b.getModel("createEAppointmentModel"),a.set("contactId",d)):a=b.getModel("anonymousCreateEAppointmentModel");var e=b.getCreateAppointmentPayload(c);return b.doCreateAppointment(a,e)},createEShopStoreAppointment:function(){var a=this,c=a.subViewModels.implUserContextTopicViewModel.get("userInfo"),d=a.subViewModels.orderTopicViewModel.get("orderActions"),e=a.get("contactId"),f=(b.find(d,function(a){if("Change"===a.orderType&&"WS"===a.lob&&!a.isFreeMBB)return!0}),a.get("newAppointmentInput"));f.externalId=a.subViewModels.customerTopicViewModel.get("ID"),c&&c.contactDetails&&(f.contactNumber=c.contactDetails.phone);var g=a.getModel("createEAppointmentModel");g.set("contactId",e);var h=a.getCreateAppointmentPayload(f);return a.doCreateAppointment(g,h)},getCreateAppointmentPayload:function(a){var b={ImplCreateAppointmentRequest:{customerId:a.customerId,customerIdType:a.customerIdType,externalId:a.externalId,dealerCode:a.dealerCode,siteId:a.siteId,startTimestamp:a.startTimestamp,transactionType:a.transactionType,serviceType:a.serviceType,name:a.name,contactNumber:a.contactNumber,contactEmail:a.contactEmail,reserveOnly:a.reserveOnly,reservationDetail:a.reservationDetail,source:a.source}};return b},doCreateAppointment:function(a,b){var c=this;c.set("singtelStoreAptVmStatus","createAppointmentInProgress"),c.set("errorObj",null);var d=$.Deferred(),e=null;return a.save(b).then(function(a){if(a&&a.ImplEAppointmentResponse){if(e=c.getErrorObj(a.ImplEAppointmentResponse))c.set("errorObj",e),c.set("singtelStoreAptVmStatus","aptCreatedFailureWithError"),d.reject(e);else if(a.ImplEAppointmentResponse.appointment){var b=a.ImplEAppointmentResponse.appointment;c.set("newApptId",b.apptId),c.set("newApptState",b.apptState);var f=c.get("newAppointmentInput");f.apptId=b.apptId,f.apptState=b.apptState,b.slotDesc=f.slotDesc,c.set("newAppointmentInput",f),c.set("storeAptDetails",b),c.set("singtelStoreAptVmStatus","aptCreatedSuccess"),d.resolve(b)}}else e=c.onEappointmentApiFail("aptCreatedFailure"),d.reject(e)},function(){e=c.onEappointmentApiFail("aptCreatedFailure"),d.reject(e)}),d},onEappointmentApiFail:function(a,b){return errorObj={errorCode:b||"API_FAILURE",errorMessage:"Backend API Failed",sourceSystem:"EAPPOINTMENT"},this.set("errorObj",errorObj),this.set("singtelStoreAptVmStatus",a||"aptApiFailure"),errorObj},getErrorObj:function(a){var b=null;return a.errorInfo&&a.errorInfo.length&&(b=a.errorInfo[0]),b},retrieveExistingAppointment:function(){var a=this,b=$.Deferred(),c=a.get("exisitingAppointmentInput");return c?(model=a.getModel("viewEAppointmentModel"),contactId=a.get("contactId"),payload={ImplViewAppointmentRequest:{apptId:c.apptId||"",customerId:contactId,customerIdType:c.cusIdType,source:c.source}},a.set("singtelStoreAptVmStatus","retrieveAppointment"),model.set("CONTACT_ID",contactId),model.save(payload).then(function(c){if(c&&c.ImplViewAppointmentResponse&&c.ImplViewAppointmentResponse.appointments){var d=c.ImplViewAppointmentResponse.appointments,e=c.ImplViewAppointmentResponse.eShopEditMinTime,f=a.get("exisitingAppointmentInput");"eShop"===f.source&&(d=a.mapAppointmentWithFsAppointment(d,e)),a.set("existingAptDetails",d),a.set("singtelStoreAptVmStatus","aptRetrieved")}else a.set("singtelStoreAptVmStatus","aptNotRetrieved");b.resolve("success")},function(){a.set("singtelStoreAptVmStatus","aptNotRetrieved"),b.resolve("failure")})):b.resolve("success"),b},mapAppointmentWithFsAppointment:function(a,c){var d=this,e=[],f=!0;if(a&&a.length>0){var g=d.get("exisitingAppointmentInput");d.get("newAppointmentInput");f=d.showHideStore(a),a=b.filter(a,function(a){var b=d.isAptTimeValid(a,c);return a.source===g.source&&"confirmed"===a.apptState&&b}),a.length>0&&(a=d.checkStoreAvailablity(a),a.length>0&&b.each(a,function(a){var c=b.pluck(a.reservationDetail,"handsetReserved");e.push({deliveryOrderNo:a.deliveryOrderNo,purchasedItems:c,deliveryDate:a.slotDate||o(a.startTimestamp).format("DD/MM/YYYY"),deliveryTime:a.slotDesc,deliverySlotCode:a.site.shopCode,outletCode:a.site.dealerCode,slotId:"",slotType:"EA",deliveryAddress:d.mapDeliveryAddress(a.storeDetails),id:a.orderActionID,storeAptDetails:a})}))}else f=!1;return d.set("hideStore",f),e},isAptTimeValid:function(a,b){var c,d=Date.now();return c=d<=a.startTimestamp-60*b*1e3},showHideStore:function(a){var c=this.get("storeAptDetails"),d=!0;if(c&&c.apptId){var e=b.find(a,function(a){return c.apptId===a.apptId&"reserved"===a.apptState&&"reserved"===c.apptState});e&&(d=!1)}if(d){var f=Date.now(),g=b.find(a,function(a){return a.startTimestamp<f});g&&(d=!1)}return d},checkStoreAvailablity:function(a){var c=this.get("availableStores"),d=[];return c&&c.length>0&&b.each(a,function(a){var e=b.find(c,function(b){return a.site.dealerCode===b.mtposId});e&&(a.storeDetails=e,d.push(a))}),d},mapDeliveryAddress:function(a){return{blockOrHouseNum:a.name,streetName:a.street,buildingName:a.building,postcode:a.postalCode}},checkAndCancelEAppointment:function(){var a=this.get("storeAptDetails"),b=$.Deferred();return a&&a.apptId&&"reserved"===a.apptState?this.cancelStoreAppointment("eShop").then(function(a){b.resolve(a)},function(a){b.reject(a)}):b.resolve(null),b},cancelStoreAppointment:function(a){var b=this,c=b.get("storeAptDetails"),d=b.getModel("cancelEAppointmentModel"),e=$.Deferred(),f=b.get("contactId"),g={ImplCancelAppointmentRequest:{apptId:c.apptId,customerId:f,customerIdType:c.customerIdType,source:c.source}};b.set("singtelStoreAptVmStatus","cancelStoreAppointmentInProgress"),d.set("CONTACT_ID",f),a&&d.setQueryParams({source:a});var h=null;return d.save(g).then(function(a){if(a&&a.ImplEAppointmentResponse){if(h=b.getErrorObj(a.ImplEAppointmentResponse))b.set("errorObj",h),b.set("singtelStoreAptVmStatus","cancelAppointmentFailureWithError"),e.reject(h);else if(a.ImplEAppointmentResponse.appointment){var c=a.ImplEAppointmentResponse.appointment;if("cancelled"===c.apptState){b.set("newApptId",null),b.set("newApptState",null);var d=b.get("newAppointmentInput");d.apptId=null,d.apptState=null,b.set("newAppointmentInput",d),b.set("storeAptDetails",null),b.set("singtelStoreAptVmStatus","cancelAppointmentSuccess"),e.resolve(c)}else h=b.onEappointmentApiFail("cancelAppointmentFailure"),e.reject(h)}}else h=b.onEappointmentApiFail("cancelAppointmentFailure"),e.reject(h)},function(){h=b.onEappointmentApiFail("cancelAppointmentFailure"),e.reject(h)}),e},checkAndConfirmEAppointment:function(){var a=this.get("storeAptDetails"),b=$.Deferred();return a&&a.apptId&&"reserved"===a.apptState?this.confirmEshopAppointment().then(function(a){b.resolve(a)},function(a){b.reject(a)}):b.resolve(null),b},confirmEshopAppointment:function(){var a=this,b=a.subViewModels.implUserContextTopicViewModel.getValueByPath("userInfo.contactDetails"),c=a.get("storeAptDetails"),d=$.Deferred();if(c&&c.apptId&&"reserved"===c.apptState){var e=a.getModel("confirmEAppointmentModel"),f=a.get("contactId"),g={ImplConfirmAppointmentRequest:{apptId:c.apptId,customerId:c.customerId,customerIdType:c.customerIdType||c.cusIdType,source:c.source,name:c.name,contactNumber:b.phone,contactEmail:b.email}};a.set("singtelStoreAptVmStatus","confirmeStoreAppointmentInProgress"),e.set("CONTACT_ID",f);var h=null;e.save(g).then(function(b){if(b&&b.ImplEAppointmentResponse){if(h=a.getErrorObj(b.ImplEAppointmentResponse))a.set("errorObj",h),a.set("singtelStoreAptVmStatus","confirmAppointmentFailureWithError"),cancelAppointmentDeferred.reject(h);else if(b.ImplEAppointmentResponse.appointment){var c=b.ImplEAppointmentResponse.appointment;if("confirmed"===c.apptState){a.set("newApptId",null),a.set("newApptState",null);var e=a.get("newAppointmentInput");e.apptId=null,e.apptState=null,a.set("newAppointmentInput",e),a.set("storeAptDetails",null),a.set("singtelStoreAptVmStatus","confirmAppointmentSuccess"),d.resolve(c)}else h=a.onEappointmentApiFail("confirmAppointmentFailure"),cancelAppointmentDeferred.reject(h)}}else h=a.onEappointmentApiFail("confirmAppointmentFailure"),cancelAppointmentDeferred.reject(h)},function(){h=a.onEappointmentApiFail("confirmAppointmentFailure"),d.reject(h)})}else d.resolve(null);return d},updateExistingStoreAppointment:function(){var a=this,b=a.get("newAppointmentInput"),c=a.getModel("singtelStoreEditEAppointmentModel"),d=a.get("contactId"),e=$.Deferred(),f={ImplEditAppointmentRequest:{apptId:b.apptId,customerId:d,customerIdType:b.customerIdType,source:b.source,newStartTimestamp:b.newStartTimestamp,newSite:b.newSite,newDealerCode:b.newDealerCode}};a.set("singtelStoreAptVmStatus","updateExistingApptInProgress"),c.set("CONTACT_ID",d);var g=null;return c.save(f).then(function(c){if(c&&c.ImplEAppointmentResponse){if(g=a.getErrorObj(c.ImplEAppointmentResponse))a.set("errorObj",g),a.set("singtelStoreAptVmStatus","updateExistingApptFailureWithError"),e.reject(g);else if(c.ImplEAppointmentResponse.appointment){var d=c.ImplEAppointmentResponse.appointment;a.set("newApptId",d.apptId),a.set("newApptState",d.apptState),b.apptId=d.apptId,b.apptState=d.apptState,d.slotDesc=b.slotDesc,a.set("newAppointmentInput",b),a.set("storeAptDetails",d),a.set("singtelStoreAptVmStatus","apptUpdatedSuccess"),e.resolve(d)}}else g=a.onEappointmentApiFail("apptUpdatedFailure"),e.reject(g)},function(){g=a.onEappointmentApiFail("apptUpdatedFailure"),e.reject(g)}),e}});return q});
define("businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic",["underscore","lightsaber","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/WorryFreeViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b.Core.ObservableViewModel.extend({subViewModels:{orderInContextTopicViewModel:d,deviceIdAndPlanIdInContextTopic:e,miniCartInContextTopic:f,productOrderTopicViewModel:i,storeContextDataViewModel:j,onePassTopicViewModel:k,worryFreeViewModel:l,selfCollectNowViewModel:m,singtelStoreEAppointmentViewModel:n},models:{anonymousProductOrderProductOrderItemsModel:g,customerProductOrderProductOrderItemsModel:h},defaults:{clearMiniCartStatus:""},initialize:function(){a.bindAll(this,"clearAllTopics","setDefaultQueryParams","_cancelOrder","clearCurrentContextTopic","deleteCookie","onContinueShopping","clearAllTopicsAction"),Ractive.defaults.on("TriggerCancelOrder",function(a){this.cancelAnonymouseOrder(a)}.bind(this))},deleteCookie:function(){document.cookie="orderValue=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/",document.cookie="orderActions=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/",window.sessionStorage.removeItem("cookieCreated")},clearCurrentContextTopic:function(){var a=this;a.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),a.subViewModels.miniCartInContextTopic.emptyTopic()},clearAllTopicsAction:function(){this.clearAllTopics(!0)},cancelAnonymouseOrder:function(b){var c,d=this,e=d.subViewModels.orderInContextTopicViewModel.get(),f=e.productOrderID,g=[];a.each(e.currentOrderActions,function(a){g.push(a.productOrderItemID)}),g.length>0?(c=d.models.anonymousProductOrderProductOrderItemsModel,c.set("productOrderId",f),d.setDefaultQueryParams(c),c.setQueryParams({poi:g}),c.set("id",g),c.destroy({success:a.bind(d.cancelAnonymouseOrderSuccess,d,b),error:function(){b.resolve()}})):b.resolve()},cancelAnonymouseOrderSuccess:function(a,b,c){var d=[];if(this.subViewModels.orderInContextTopicViewModel.emptyTopic(),d.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic"),d.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"),d.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),d.length>0)for(var e=0;e<d.length;e++){var f=d[e];window.sessionStorage.removeItem(f)}a.resolve()},clearAllTopics:function(b,d){var e=this;e.set("clearMiniCartStatus","clearAllTopics");var f=e.subViewModels.orderInContextTopicViewModel.get();e.subViewModels.selfCollectNowViewModel.cancelAppointment(),e.subViewModels.singtelStoreEAppointmentViewModel.checkAndCancelEAppointment();var g=e.subViewModels.storeContextDataViewModel,h=e.subViewModels.deviceIdAndPlanIdInContextTopic.get(),i=e.subViewModels.miniCartInContextTopic.get();if(g.set("orderContextValues",f),g.set("deviceTopicValues",h),g.set("miniCartTopicValues",i),b){var j=c.get("clearAllTopics"),k="undefined"==typeof d||null===d?j:d;k&&e.processOutput(b)}else if(f.currentOrderActions&&f.currentOrderActions.length>0){var l,m=f.customerID,n=f.productOrderID,o=[];a.each(f.currentOrderActions,function(a){o.push(a.productOrderItemID)}),m?(l=e.models.customerProductOrderProductOrderItemsModel,l.set("customerId",m)):l=e.models.anonymousProductOrderProductOrderItemsModel,l.set("productOrderId",n),e.setDefaultQueryParams(l),l.setQueryParams({poi:o}),l.set("id",o),l.destroy({success:a.bind(e.processOutput,e,b),error:a.bind(e.setError,e)})}},cancelAnonymouseOrder:function(b){var c,d=self.subViewModels.orderInContextTopicViewModel.get(),e=d.productOrderID,f=[];a.each(d.orderActions,function(a){f.push(a.productOrderItemID)}),c=self.models.anonymousProductOrderProductOrderItemsModel,c.set("productOrderId",e),self.setDefaultQueryParams(c),c.setQueryParams({poi:f}),c.set("id",f),c.destroy({success:function(){var a=[];if(self.subViewModels.orderInContextTopicViewModel.emptyTopic(),a.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic"),a.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"),a.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),a.length>0)for(var c=0;c<a.length;c++){var d=a[c];window.sessionStorage.removeItem(d)}b.resolve()}(self),error:function(){b.resolve()}(b)})},_cancelOrder:function(){var b=this;b.set("clearMiniCartStatus","_cancelOrder");var c=b.subViewModels.orderInContextTopicViewModel.get();if(c.orderActions&&c.orderActions.length>0){var d,e=c.customerID,f=c.productOrderID,g=[];a.each(c.orderActions,function(a){g.push(a.productOrderItemID)}),e?(d=b.models.customerProductOrderProductOrderItemsModel,d.set("customerId",e)):d=b.models.anonymousProductOrderProductOrderItemsModel,d.set("productOrderId",f),b.setDefaultQueryParams(d),d.setQueryParams({poi:g}),d.set("id",g),d.destroy({success:a.bind(b.processOutput,b,!0),error:a.bind(b.processOutput,b,!0)})}},processOutput:function(b){var d=this.subViewModels.orderInContextTopicViewModel.get(),e=[],f=this.subViewModels.worryFreeViewModel.subViewModels.worryFreeContextTopicViewModel.get("otpData");if(f&&f.indentValue&&(this.subViewModels.worryFreeViewModel.deleteWorryFree(),e=c.get("clearCareTopicsList")),b){e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"),e.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplBreadcrumbTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel");var g=this.subViewModels.onePassTopicViewModel.get("newcustomer");g===!0&&(e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel")),window.localStorage.removeItem("LightsaberSessionToken")}else if(d.orderActions&&d.orderActions.length>0){var h=a.filter(d.orderActions,function(b){var c=a.find(d.currentOrderActions,function(a){return a.productOrderItemID===b.productOrderItemID});return!c});e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic"),e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"),e.push("businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel"),e.push("businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel"),h.length>0?(this.subViewModels.orderInContextTopicViewModel.set("orderActions",h),this.subViewModels.orderInContextTopicViewModel.set("currentOrderActions",null)):(e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),this.subViewModels.orderInContextTopicViewModel.emptyTopic())}if(window.localStorage.setItem("clearSessionStorage",!0),e.length>0)for(var i=0;i<e.length;i++){var j=e[i];window.sessionStorage.removeItem(j)}window.localStorage.removeItem("clearSessionStorage"),b?(this.set("clearMiniCartStatus","dataDeleted"),this.subViewModels.miniCartInContextTopic.emptyTopic(),this.subViewModels.orderInContextTopicViewModel.emptyTopic(),this.subViewModels.deviceIdAndPlanIdInContextTopic.emptyTopic()):this.set("clearMiniCartStatus","success")},setError:function(){this.set("clearMiniCartStatus","fail")},setDefaultQueryParams:function(b){var d=b.getDataSource().methods.defaults.qParams;d||(d={}),b.getDataSource().methods.defaults.qParams=a.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onContinueShopping:function(){this.set("clearMiniCartStatus","onContinueShopping"),this.subViewModels.productOrderTopicViewModel.set("contnueShoppingFlag",!0),this.subViewModels.selfCollectNowViewModel.set("collectNowData",null),this.subViewModels.productOrderTopicViewModel.set("currentOrderActions",null),this.subViewModels.orderInContextTopicViewModel.set("contnueShoppingFlag",!0),this.subViewModels.orderInContextTopicViewModel.set("currentOrderActions",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),this.subViewModels.miniCartInContextTopic.emptyTopic(),this.set("clearMiniCartStatus","continueShoppingCompleted")}});return o});
define("businesswidget/repository_l9_common/common/model/CheckServiceCoverageModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/sdp/check-service-coverage",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplPhysicalAddress"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/UpdateOrderNetworkCoverageModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/ecommerce/customer/:customerId/order/:orderId/check-coverage-update-order",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"POST",payload:["ImplUpdateOrderForCoverageCheckInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/UpdateOrderNetworkCoverageAnonymousModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/ecommerce/anonymous/order/:orderId/check-coverage-update-order",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"POST",payload:["ImplUpdateOrderForCoverageCheckInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c){return a.Core.ObservableViewModel.extend({defaults:{customerIdVmStatus:""},subViewModels:{deviceIdAndPlanIdInContextTopic:c},initialize:function(){this._super();b.bindAll(this,"getCustomerIdType","getDocumentType","getCustomerIdCode","getBuildingType","calculateSpecialDiscount","isDevicePromoApplicable","createPromoString","getCustomerIdTypeForFS","getSelectedAddonIDs"),this.set("customerIdVmStatus","vmInitialized")},getCustomerIdTypeForFS:function(a){var b="";switch(a){case"National Registration ID Card (NRIC)":b="National Registration ID Card (NRIC)";break;case"Foreign Identification Number (FIN)":b="Foreign Identification Number (FIN)";break;case"Foreigner Dependent Pass":b="Foreigner Dependent Pass";break;case"Foreigner Employment Pass":b="Foreigner Employment Pass";break;case"Foreigner S Pass":b="Foreigner S Pass";break;case"Foreigner Student Pass":b="Foreigner Student Pass";break;case"Foreigner Social Visit Pass":b="Foreigner Social Visit Pass";break;case"Foreigner Work Permit":b="Foreigner Work Permit";break;case"Diplomat":b="Diplomat";break;case"Entre Pass":b="EntrePass";break;case"Unique Entity Number (UEN)":b="BRN/UEN"}return b},getCustomerIdType:function(a){var b="";switch(a){case"2":b="National Registration ID Card (NRIC)";break;case"6":b="Foreign Identification Number (FIN)";break;case"532":b="Foreigner Dependent Pass";break;case"534":b="Foreigner Employment Pass";break;case"535":b="Foreigner S Pass";break;case"533":b="Foreigner Student Pass";break;case"536":b="Passport Number";break;case"531":b="Foreigner Social Visit Pass";break;case"530":b="Foreigner Work Permit";break;case"600":b="Diplomat";break;case"539":b="Entre Pass"}return b},getDocumentType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="National Registration Identity Card";break;case"FIN":a="FIN";break;case"Foreign Identification Number (FIN)":a="Foreign Identification Number";break;case"Foreigner Dependent Pass":a="Dependent Pass";break;case"Foreigner Employment Pass":a="Employment Pass";break;case"Foreigner S Pass":a="Special Pass";break;case"Foreigner Student Pass":a="Student Pass";break;case"Passport Number":a="Passport Number";break;case"Foreigner Social Visit Pass":a="Social Visit Pass / Long Term Visit Pass";break;case"Foreigner Work Permit":a="Work Permit";break;case"Diplomat":a="Diplomat Pass";break;case"Entre Pass":a="EntrePass";break;case"Non-diplomatic":a="Non Diplomat Pass";break;case"Unique Entity Number (UEN)":a="Unique Entity Number (UEN)"}return a},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a},getCustomerIdCode:function(a){var b="";switch(a){case"National Registration ID Card (NRIC)":b="2";break;case"Foreign Identification Number (FIN)":b="6";break;case"Foreigner Dependent Pass":b="532";break;case"Foreigner Employment Pass":b="534";break;case"Foreigner S Pass":b="535";break;case"Foreigner Student Pass":b="533";break;case"Passport Number":b="536";break;case"Foreigner Social Visit Pass":b="531";break;case"Foreigner Work Permit":b="530";break;case"Diplomat":b="600";break;case"Entre Pass":b="539"}return b},getBuildingType:function(a){var b="";switch(a){case"BLK":case"HDB":b="HDB";break;case"APT":case"COL":case"Residential":case"Other Residential":case"OTH":b="APT";break;case"LND":b="LND";break;default:b=a}return b},isDevicePromoApplicable:function(a,c){return b.contains(a,"All")||b.contains(a,c)},calculateSpecialDiscount:function(a,c,d,e,f,g,h,i){var j,k=this;if(a&&a.length>0){var l=b.find(a,function(a){var j=!0;if(b.contains(a.transType,e)||(j=!1),j&&i&&!a.tabletBrands&&!a.handsetBrands?j=!1:j&&"Tablet"===i&&c&&!k.isDevicePromoApplicable(a.tabletBrands,c)?j=!1:j&&"Mobile"===i&&c&&!k.isDevicePromoApplicable(a.handsetBrands,c)&&(j=!1),j&&a.dataX3InfintyScenario&&!f&&!g&&(j=!1),j&&!b.contains(a.customerType,h)&&(j=!1),j&&d&&a.planIds){var l=b.find(a.planIds,function(a){if("All"===a)return!0;if(a){var b=a.split("_");if(b&&b.length>0){var c=b[0],e=b[1];if(c===d||e===d)return!0}}});l||(j=!1)}return j});l&&(j=l.promoCode)}return j},createPromoString:function(a,b,c,d,e,f,g,h,i,j){var k="";if(a&&(k=k+"OFFERID="+a),b&&(k=k+"@@BRAND="+b),c&&(k=k+"@@MODEL="+c),d){var l="recon"===d?"RECON":"port-in"===d?"PORT-IN":"PROVIDE";if(k=k+"@@TRANSACTION_TYPE="+l,"RECON"===l){var m=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("oldOfferId");m&&(k=k+"@@SOURCE_PLAN="+this.subViewModels.deviceIdAndPlanIdInContextTopic.get("oldOfferId"))}}if(e&&(k=k+"@@CI_TIER="+e),f){var n="staff"===f?"STAFF":"cis"===f?"CIS":"PUBLIC";k=k+"@@SEGMENT="+n}else k+="@@SEGMENT=PUBLIC";g&&(k=k+"@@SUB_SEGMENT="+g),h&&h.length>0&&(k=k+"@@VAS="+h.join()),i&&(k=k+"@@COUPON="+i);var j=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo");return j&&j.code&&(k=k+"@@PICKNGO="+j.code),k&&""!==k&&(k="####"+k),a&&this.subViewModels.deviceIdAndPlanIdInContextTopic.set("promoCriteria",k),k},getPromoObject:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=[];if(a&&m.push({name:"OFFERID",value:a}),b&&m.push({name:"BRAND",value:b}),c&&m.push({name:"MODEL",value:c}),d){var n="recon"===d?"RECON":"port-in"===d?"PORT-IN":"PROVIDE";m.push({name:"TRANSACTION_TYPE",value:n})}e&&m.push({name:"CI_TIER",value:e});var o="PUBLIC";f&&(o="staff"===f?"STAFF":"cis"===f?"CIS":"PUBLIC"),m.push({name:"SEGMENT",value:o}),g&&m.push({name:"SUB_SEGMENT",value:g}),h&&h.length>0&&m.push({name:"VAS",value:h.join()}),i&&m.push({name:"COUPON",value:i});var j=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo");return j&&j.code&&m.push({name:"PICKNGO",value:j.code}),k&&(m.push({name:"TARGETED",value:k}),m.push({name:"Document_Type",value:l})),m},getSelectedAddonIDs:function(a,c){var d=this;return a&&a.length>0&&b.each(a,function(a){a.displayableBillingOffers&&b.each(a.displayableBillingOffers,function(a){a.selected&&"AD"===a.action&&c.push(a.productSpecPricing.childPricingSchema.id)}),a.displayableSimpleProductReferences&&a.displayableSimpleProductReferences.length>0&&b.each(a.displayableSimpleProductReferences,function(a){a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&b.each(a.displayableBillingOffers,function(a){a.selected&&"AD"===a.action&&c.push(a.productSpecPricing.childPricingSchema.id)}),a.selected&&"10141011"===a.productSpecContainmentID&&c.push(a.simpleProductSpecID)}),a.displayableItems&&a.displayableItems.length>0&&d.getSelectedAddonIDs(a.displayableItems,c)}),c},isLocalCustomer:function(a){var b=!1;return a&&(a.toUpperCase().startsWith("S")||a.toUpperCase().startsWith("T"))&&(b=!0),b}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/UpdateCoverageViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/CheckServiceCoverageModel","businesswidget/repository_l9_common/common/model/UpdateOrderNetworkCoverageModel","businesswidget/repository_l9_common/common/model/UpdateOrderNetworkCoverageAnonymousModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j){return a.Core.ObservableViewModel.extend({models:{checkServiceCoverageModel:c,updateOrderNetworkCoverageModel:d,updateOrderNetworkCoverageAnonymousModel:e},subViewModels:{individualInContextTopicViewModel:f,orderInContextTopicViewModel:g,deviceIdAndPlanIdInContextTopic:h,getCustomerIdValueViewModel:i,customerInContextTopicViewModel:j},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{address:null,result:null,coverageType:null,updateCoverageVmStatus:null,adslOrderActionId:null},initialize:function(a){b.bindAll(this,"onCheckServiceCoverage","checkCoverage","onCheckServiceCoverageSuccess","onFailure","_saveOrderData")},onCheckServiceCoverage:function(a){var b=$.Deferred(),c=this;return"undefined"!=typeof a&&null!==a?("undefined"!=typeof a.buildingClassification&&null!==a.buildingClassification||(a.buildingClassification="Others Residential"),
c.checkCoverage(a,b)):b.resolve("success"),b},checkCoverage:function(a,c){var d={ImplPhysicalAddress:{postcode:a.postCode||a.postcode,streetName:a.streetName,buildingClassification:a.buildingClassification,blockOrHouseNum:a.blockOrHouseNum||a.streetNumber}};if(a.apartment)d.ImplPhysicalAddress.unitNumber=a.apartment;else{var e=a.floorNo||a.floor,f=a.unitNo||a.apartment;e&&e.indexOf("#")>-1?d.ImplPhysicalAddress.unitNumber=e:f&&f.indexOf("#")>-1?d.ImplPhysicalAddress.unitNumber=f:e&&f&&(d.ImplPhysicalAddress.unitNumber="#"+e+"-"+f)}this.set("coverageType",a.buildingClassification),this.getModel("checkServiceCoverageModel").save(d,{success:b.bind(this.onCheckServiceCoverageSuccess,this,c),error:b.bind(this.onFailure,this,c)})},onFailure:function(a){a&&a.reject("Failure"),this.set("updateCoverageVmStatus","failure")},_saveOrderData:function(a,c){var d,e=$.Deferred(),f=this,g=this.subViewModels.orderInContextTopicViewModel.get("customerID")||this.subViewModels.customerInContextTopicViewModel.get("ID");g?(d=this.getModel("updateOrderNetworkCoverageModel"),d.set("customerId",g)):d=this.getModel("updateOrderNetworkCoverageAnonymousModel"),d.set("orderId",this.subViewModels.orderInContextTopicViewModel.get("productOrderID")),a.isBlockOrder&&this.subViewModels.deviceIdAndPlanIdInContextTopic.set("blockOrderID",this.subViewModels.orderInContextTopicViewModel.get("productOrderID"));var h={ImplUpdateOrderForCoverageCheckInput:{houseType:a.coverageType,coverageStatus:a.coverageStatus,coverageSubStatus:(a.coverageSubStatus||"Empty").replace(";",""),isBlockOrder:a.isBlockOrder}};return c&&(h.ImplUpdateOrderForCoverageCheckInput.adslOrderActionId=c),d.save(h,{success:b.bind(f.orderSuccess,f,e),error:b.bind(f.orderFailure,f,e)}),e},orderSuccess:function(a){var b=this;b.set("updateCoverageVmStatus","orderSuccesfull"),a.resolve("success")},orderFailure:function(a){a&&a.reject("Failure"),this.set("updateCoverageVmStatus","failure")},onCheckServiceCoverageSuccess:function(a,b,c){var d=c;if("undefined"!=typeof d.ImplCheckServiceCoverageRestOutput){var e=d.ImplCheckServiceCoverageRestOutput.coverageType,f=d.ImplCheckServiceCoverageRestOutput.coverageStatus,g=d.ImplCheckServiceCoverageRestOutput.coverageSubStatus,h=d.ImplCheckServiceCoverageRestOutput.buildingType,i=d.ImplCheckServiceCoverageRestOutput.singtelFibreAvailable;i&&(e="S3"),h?(h=this.subViewModels.getCustomerIdValueViewModel.getBuildingType(h),this.set("coverageType",h)):h=this.get("coverageType");var j={coverageType:h,coverageStatus:f,coverageSubStatus:g,isBlockOrder:"S1"!==e};a.resolve(j)}else a.reject("Failure"),this.set("updateCoverageVmStatus","failure")}})});
define("businesswidget/repository_l9_common/common/model/PickAndGoUpdateModel",["lightsaber","underscore","Configuration"],function (a,b,c){var d=a.Core.RESTModel.extend({options:{url:"/ecommerce/order/:orderId/pick-go",orderId:"orderId",rest:{create:{method:"PUT"},defaults:{contentType:"application/json",qParams:{lo:c.get("locale"),sc:c.get("salesChannel")},payload:["ImplUpdateOrderForPickNGoInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel",["lightsaber","underscore","Configuration","businesswidget/repository_l9_common/common/model/PickAndGoUpdateModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f){return a.Core.ObservableViewModel.extend({models:{pickAndGOUpdateModel:d},subViewModels:{orderInContextTopicViewModel:e,deviceIdAndPlanIdInContextTopic:f},defaults:{pickAndGoStatus:""},initialize:function(a){b.bindAll(this,"updateCode","setDefaultQueryParams")},updateCode:function(a,c){var d,e=this,f=$.Deferred(),g=e.getModel("pickAndGOUpdateModel");d="Y"===a.isWaiveRegFee&&a.regBO?a.regBO:"NA";var h;h="Y"===a.isWaiveSIMFee&&a.simBO?a.simBO:"NA";var i=!1,j=c;a.campaign&&a.parentLine&&(j=!0,i=!0);var k;j?g.setQueryParams({isCouponApply:j,isEncrypted:i}):k=a.partner?a.partner:"NA";var l={ImplUpdateOrderForPickNGoInput:{pickNgoSIM:h,pickNgoREG:d,partner:k,code:a.code||a.campaign,parentLine:a.parentLine,promoCode:a.promoCode}};return e.setDefaultQueryParams(g),g.save(l,{orderId:e.subViewModels.orderInContextTopicViewModel.get("productOrderID"),success:b.bind(e.onUpdateSuccess,e,f,c,a),error:b.bind(e.onUpdateFailure,e,f)}),f},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onUpdateSuccess:function(a,b,c,d,e){b||this.subViewModels.deviceIdAndPlanIdInContextTopic.set("pgInfo",c),a.resolve("pickAndGoUpdated")},onUpdateFailure:function(a,b,c){a.resolve("pickAndGoFailed")}})});
define("businesswidget/repository_l9_common/common/model/CustomerUpdateProductConfigurationCustomizedModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/ecommerce/customer/:customerId/order/:orderId/update-order-products",rest:{defaults:{contentType:"application/json"},create:{method:"POST",payload:["ImplUpdateOrderProductsRequest"]}}}});return b});
define("businesswidget/repository_l9_common/common/model/AnonymousProductConfigurationCustomizedModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/ecommerce/anonymous/order/:orderId/update-order-products",rest:{defaults:{contentType:"application/json"},create:{method:"POST",payload:["ImplUpdateOrderProductsRequest"]}}}});return b});
define("businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/model/CustomerUpdateProductConfigurationCustomizedModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository_l9_common/common/model/AnonymousProductConfigurationCustomizedModel"],function (a,b,c,d,e,f,g,h){return a.Core.ObservableViewModel.extend({models:{customerUPCModel:f,customerUPCCustomizedModel:d,anonymousUPCModel:g,anonymousUPCCustomizedModel:h},subViewModels:{orderInContextTopicViewModel:e},defaults:{upcStatus:""},initialize:function(a){b.bindAll(this,"_updateProductConfigurationCustomized","setHeaders","setDefaultQueryParams","updateOrderToRunRules","onUpdateOrderToRunRulesError","callUpdateOrder")},_updateProductConfigurationCustomized:function(a,c,d){var e=this,f=e.subViewModels.orderInContextTopicViewModel.get(),g=$.Deferred(),h=f.customerID;h?(model=e.getModel("customerUPCCustomizedModel"),model.set({customerId:h})):model=e.getModel("anonymousUPCCustomizedModel");var i={ImplUpdateOrderProductsRequest:{returnRemovedItems:!1,returnRemovedByReplaceItems:!1,settingsViewFilter:"FULL",stepsToRetrieve:[],stepsToValidate:[],attachmentTypes:[],runCompatibilityRules:c,activityForConfiguration:d||null,confirmationMessagesApproved:!1,saveIfCompatibilityRulesFailed:!1,addDefaultChildItemsImplicitly:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0},implUpdateOrderProductConfigurationList:a}};return model.set({orderId:f.productOrderID}),e.setHeaders(model),e.setDefaultQueryParams(model),model.setQueryParams({rp:!1,rpc:!1}),model.save(i,{success:b.bind(e.onCustomizedUpdateSuccess,e,g),error:b.bind(e.onCustomizedUpdateFailure,e,g)}),g},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:c.get("salesChannel")||d.sc})},onCustomizedUpdateSuccess:function(a,b,c){this.set("upcStatus","updateSuccess"),a.resolve("updateSuccess",c)},onCustomizedUpdateFailure:function(a,b,c){this.set("upcStatus","updateFailure"),a.reject(c)},updateOrderToRunRules:function(a,c,d){var e=this;return"undefined"!=typeof a&&null!==a||(a=e.subViewModels.orderInContextTopicViewModel.get("orderActions")),c&&b.each(a,function(a){a.productOrderItemID===c&&(a.updated=!0)}),a=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration&&"BLOCKING"===d.productConfiguration.compatibilityStatus?(e.set("upcStatus","productConfigurationError"),!1):void(a&&a.length>0?e.callUpdateOrder(a):e.set("upcStatus","callShoppingCart"))},callUpdateOrder:function(a){var c,d,e=this,f=[],g={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},h=e.subViewModels.orderInContextTopicViewModel.get(),i=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});i&&i.length>0&&(c=i[0].productOrderItemID,d=i[0].productID,f.push({productID:d})),f.length>0&&(g.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=f);var j=h.customerID;if(j){var k=e.getModel("customerUPCModel");k.set({customerId:j,productOrderItemId:c}),e.setHeaders(k),e.setDefaultQueryParams(k),k.setQueryParams({rp:!1,rpc:!1}),k.save(g,{success:function(b,d){e.updateOrderToRunRules(a,c,d.UpdateProductInOrderConfigurationResponse)},error:e.onUpdateOrderToRunRulesError})}else{var l=e.getModel("anonymousUPCModel");l.set({productOrderItemId:c}),e.setHeaders(l),e.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(g,{success:function(b,d){e.updateOrderToRunRules(a,c,d.UpdateProductInOrderConfigurationResponse)},error:e.onUpdateOrderToRunRulesError})}},onUpdateOrderToRunRulesError:function(a,b){this.set("upcStatus","productConfigurationError")}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel"],function (a,b,c,d,e){return a.Core.ObservableViewModel.extend({defaults:{preTickAddons:[],preTickAddonVmStatus:"",actionList:[],alcarteProductId:null,alcarteTemporaryId:null},subViewModels:{deviceIdAndPlanIdInContextTopic:d,updateProductConfigurationCustomizedViewModel:e},initialize:function(a){this._super(a),c.bindAll(this,"createInputPayload","isPreTickAddonValid","containsData","processResponse","generateTemporaryId","getBillingOfferToBeAdded","populateSPSIds","handleSpsData","handleBOData","populateBODetails","_updateProductConfiguration")},getBillingOfferToBeAdded:function(a,b,d){return c.contains(d,a.productSpecContainmentID)||"undefined"==typeof a.productID||null===a.productID?billingOfferToBeAdded={productSpecPricingID:a.productSpecPricingID,parentProductSpecContainmentID:a.productSpecContainmentID,parentTemporaryID:b}:billingOfferToBeAdded={productSpecPricingID:a.productSpecPricingID,parentProductID:a.productID,parentProductSpecContainmentID:a.productSpecContainmentID},billingOfferToBeAdded},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2);return"C-"+a},containsData:function(a,b){if(a&&a.length>0&&b&&b.length>0){var d=c.find(a,function(a){return c.contains(b,a)});return!!d}return!1},isPreTickAddonValid:function(a,b){return!(a.lob!==b.lob||!c.contains(a.segments,b.customerType)||!c.contains(a.planIds,b.planId)||this.containsData(a.nonCompatibleVasList,b.myBoIds))},handleBOData:function(a,b,d,e){var f=this,g=f.generateTemporaryId();if("undefined"==typeof a.productID||null===a.productID||c.contains(b,a.productSpecContainmentID)){var h={productSpecContainmentID:a.productSpecContainmentID,temporaryID:g,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID};d.push(h)}var i=f.getBillingOfferToBeAdded(a,g,b);e.push(i)},handleSpsData:function(a,b,c,d,e){var f=this;if("alacarte"===b){var g=f.get("alcarteProductId"),h=f.generateTemporaryId(),i=f.get("alcarteTemporaryId");"undefined"!=typeof g&&null!==g||"undefined"!=typeof i&&null!==i||(i=f.generateTemporaryId(),d.push({productSpecContainmentID:"8635152",temporaryID:i}),f.set("alcarteTemporaryId",i)),c.push({productSpecContainmentID:"8635142",temporaryID:h,simpleProductSpecID:a,parentProductSpecContainmentID:"8635152",parentProductID:g,parentTemporaryID:i})}else if("mobileContent"===b){var h=f.generateTemporaryId(),j={temporaryID:h,productSpecContainmentID:"10141011",simpleProductSpecID:a,parentProductID:e.productID};c.push(j)}else{var h=f.generateTemporaryId();c.push({businessType:"TV_PACKAGE",simpleProductSpecID:a,temporaryID:h})}},createInputPayload:function(a,b){var d=this;d.set("alcarteProductId",null);var e=d.get("preTickAddons"),f=d.get("actionList"),g=[],h=[],i=[];if(e&&e.length>0){var j=this.processResponse(a);if(j&&j.planId){var k=c.filter(e,function(a){return d.isPreTickAddonValid(a,j)});if(k&&k.length>0&&(c.each(k,function(a){a.boIds&&a.boIds.length>0&&c.each(a.boIds,function(a){var e=j.boDetails[a];e&&!c.contains(j.myBoIds,a)&&d.handleBOData(e,b,h,g)}),a.spsDetails&&a.spsDetails.length>0&&c.each(a.spsDetails,function(a){a.spsIds&&a.spsIds.length>0&&c.each(a.spsIds,function(b){c.contains(j.mySpsIds,b)||d.handleSpsData(b,a.type,i,h,j)})})}),h.length>0||g.length>0||i.length>0)){var l=!1,m={productOrderItemId:a.productOrderItemID,returnFullUpcResponse:l,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:[],newContainedProducts:h,removedContainedProducts:[],suspendedContainedProducts:[],newSimpleProducts:i,newAssignedBillingOffers:g}};f.push(m),d.set("actionList",f)}}}},processResponse:function(a){var b={boDetails:{},myBoIds:[],mySpsIds:[]},c=this;if(a){b.lob=a.productConfiguration.lineOfBusiness,b.productID=a.productID,b.productOrderItemID=a.productOrderItemID;var d=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType")||"public";"normal"===d||"public"===d?b.customerType="PUBLIC":"cis"===d?b.customerType="CIS":"staff"===d&&(b.customerType="STAFF"),"TV"!==b.lob&&(b.planId=a.productConfiguration.rootProductOfferingID),c.populateBODetails(a.productConfiguration.displayableItems,b.boDetails,b.myBoIds),c.populateSPSIds(a.productConfiguration.displayableSimpleProductReferences,b)}return b},populateSPSIds:function(a,b){a&&a.length>0&&c.each(a,function(a){a.selected&&("TV"===b.lob&&"8861282"===a.productSpecContainmentID&&(b.planId=a.simpleProductSpecID),b.mySpsIds.push(a.simpleProductSpecID))})},populateBODetails:function(a,b,d){var e=this;c.each(a,function(a){c.each(a.displayableBillingOffers,function(c){c.selected?d.push(c.productSpecPricing.childPricingSchema.id):c.productSpecPricing.childPricingSchema&&(b[c.productSpecPricing.childPricingSchema.id]={productSpecPricingID:c.productSpecPricingID,productSpecContainmentID:a.productSpecContainmentID,productID:a.productID,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID})}),a.displayableItems&&e.populateBODetails(a.displayableItems,b,d)})},_updateProductConfiguration:function(){var a=this,b=a.get("actionList"),d=$.Deferred();if(b&&b.length>0){var e=a.subViewModels.updateProductConfigurationCustomizedViewModel,f=e._updateProductConfigurationCustomized(b,!0,"SD Add Comp Stage+++promoCode+++EMPTY");f.done(function(a,b){if("updateSuccess"===a){var e=b.ImplUpdateOrderProductsResponse,f=!1;if(e&&e.implUpdateOrderProductList){var g=e.implUpdateOrderProductList;g&&g.length>0&&c.each(g,function(a){if(!a.isSuccess){var b=a.ruleExecutionMessages;c.find(b,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return f=!0,!0}})}})}f?d.resolve("failure"):d.resolve("success")}}.bind(a)),f.fail(function(a){d.resolve("failure")}.bind(a))}else d.resolve("success");return d}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/SelectNumberWidgetViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/SearchAvailableNumbersModel","businesswidget/repository_l9_common/common/model/ReserveAndReleaseModel","businesswidget/repository_l9_common/common/model/CustomerAssignedProductTechnologyModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","businesswidget/repository_l9_common/common/model/ValidateUniqueLogicalResourceModel","businesswidget/repository_l9_common/common/viewmodel/business/FreeMBBViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/UpdateCoverageViewModel","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){return a.Core.ObservableViewModel.extend({models:{SearchAvailableNumbersModel:d,ReserveAndReleaseModel:e,updateProductConfigurationModel:j,anonymousUpdateProductConfigurationModel:k,customerProductOrderItemProductConfigurationOptionsModel:l,anonymousProductOrderItemRetrieveProductConfigurationOptionsModel:m,customerAssignedProductTechnologyModel:f,customerProductOrderProductOrderItemsModel:o,submitProductConfigurationModel:q,validateUniqueLogicalResourceModel:r},subViewModels:{customerInContextTopicViewModel:g,orderInContextTopicViewModel:h,deviceIdAndPlanIdInContextTopic:i,miniCartInContextTopic:n,individualInContextTopicViewModel:p,freeMBBViewModel:s,billingAccountsViewModel:t,clearContextInContextTopic:u,updateCoverageViewModel:v,pickAndGoViewModel:w,onePassTopicViewModel:x,preTickAddonViewModel:y},defaults:{orderId:null,orderItemId:null,productID:null,receivedNumberList:[],selectedNumber:"",orderUpdate:"",productOrderID:"",numberOfResources:null,sign:"",fiberId:null,singnetIDComponentID:null,singnetIDFVComponentID:null,singnetId:null,planType:null,callSaveNumber:!1,existingNumbers:null,selectedExistingLine:null,mobileReContractFlag:!1,mobilePortinFlag:!1,newNumberFlag:!1,singnetUpdated:!1,adslPlan:null,freeMBBData:null,pricingId:null,newCurrentOrderActions:null,isExistingNumberScenario:!1,installationAddressID:null,recontractBarId:null,productOrderReferenceNumber:null,contactId:null,easyMobileUnits:null,setOrderDataCalled:!1,counter:0,selectedNumbersList:[],deviceInformationContainment:null,refireSaveSelectedNumber:!1,isUpdateOrderReq:!1,selectNumberVmStatus:null,oneClickData:null,simAdded:!1,preTickAddonDetails:null},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{productOrderReferenceNumber:"subViewModels.orderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"getListOfNumber","onFetchListofNumbersSuccess","getErrorMessage","fetchExistingNumberMessage","onSaveSelectedNumberSuccess","fetchNumbers","setOrderData","saveSelectedNumber","retrieveProductConfiguration","onFetchRetrieveProductConfigurationSuccess","onFetchProductConfigurationError","getSuccessMessage","setHeaders","setDefaultQueryParams","saveSelectedSingnetID","getExistingNumbers","saveSeletedExistingNumber","doCancelOrderActions","processOutput","saveSelectedFibreLine","createInputPayload","processFibreOutput","getExistingSuccessMessage","updateExistingNumberOrderToRunRules","getNumbersFromSDP","updateOrderToRunRules","getErrorMessageWithoutContext","callRpcForBB"),this.subViewModels.freeMBBViewModel.on("dataSet",this.getSuccessMessage,this),this.subViewModels.freeMBBViewModel.on("orderFailure",this.getErrorMessage,this),this.on("change:productOrderReferenceNumber",this.setOrderData,this),this.on("change:contactId",this.getExistingNumbers,this);var b=this;setTimeout(function(){var a=b.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");a&&a.length>0&&c.find(a,function(a){if("mobileSharePlan"===a.flowType)return b.subViewModels.miniCartInContextTopic.set("id","mobileSharePlan"),!0});var d=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("recontractBarId");b.set("recontractBarId",d);var e=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("oneClickData");b.set("oneClickData",e),b.set("selectNumberVmStatus","selectNumberVMInitialized")},0)},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},retrieveProductConfiguration:function(a,b,d,e,f){var g=this.subViewModels.orderInContextTopicViewModel.get(),h=g.customerID,i=(g.currentOrderActions,{activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}});if(h){var j=this.getModel("customerProductOrderItemProductConfigurationOptionsModel");j.set({customerId:h,productOrderItemId:b}),j.setQueryParams({rp:!1,rpc:!1}),j.set("RetrieveProductInOrderConfigurationRequest",i),this.setHeaders(j),this.setDefaultQueryParams(j),j.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this,d,a,b,e,f),error:c.bind(this.onFetchProductConfigurationError,this,d,a,b,e,f)})}else{var k=this.getModel("anonymousProductOrderItemRetrieveProductConfigurationOptionsModel");k.set({productOrderItemId:b}),k.setQueryParams({rp:!1,rpc:!1}),k.set("RetrieveProductInOrderConfigurationRequest",i),this.setHeaders(k),this.setDefaultQueryParams(k),k.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this,d,a,b,e,f),error:c.bind(this.onFetchProductConfigurationError,this,d,a,b,e,f)})}},onFetchRetrieveProductConfigurationSuccess:function(a,b,d,e,f,g,h,i){var j=h.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems,k=this;if(j)if(a){var l=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType");if("undefined"!=typeof l&&null!==l||(l="WS"===h.RetrieveProductInOrderConfigurationResponse.productConfiguration.lineOfBusiness?"WIRELESS":"LANDLINE",k.subViewModels.deviceIdAndPlanIdInContextTopic.set("numberType",l)),"CW"===h.RetrieveProductInOrderConfigurationResponse.productOrderItemType&&"WIRELESS"===l)k.set("mobilePortinFlag",!0);else if("PR"===h.RetrieveProductInOrderConfigurationResponse.productOrderItemType)if("LANDLINE"===l){var m=c.filter(j,function(a){return"8613592"===a.productSpecContainmentID});c.each(m[0].displayableCharacteristics,function(a){"2420019"===a.productSpecCharacteristicID&&a.value&&a.value.length>0&&k.set("newNumberFlag",!0)})}else{var m=c.filter(j,function(a){return"11812"===a.productSpecContainmentID});if(m[0].productID)k.set("mobilePortinFlag",!0);else{var m=c.filter(j,function(a){return"8363682"===a.productSpecContainmentID});c.each(m[0].displayableCharacteristics,function(a){"2409309"===a.productSpecCharacteristicID&&a.value&&a.value.length>0&&k.set("newNumberFlag",!0)})}}else k.set("mobileReContractFlag",!0);if("LANDLINE"!==l){var n,o=h.RetrieveProductInOrderConfigurationResponse.productConfiguration.productOffering.id;"8480002"===o?n="8494592":"11627591"===o?n="11621331":"11640191"===o?n="11633931":"11621291"===o&&(n="11615031");var p,q={};c.each(j,function(a){n&&a.productSpecContainmentID===n?p=a:"8363722"!==a.productSpecContainmentID&&"SIM"!==a.name||c.find(a.displayableBillingOffers,function(a){if(a.selected&&a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&"SIM Card Fee"===a.productSpecPricing.childPricingSchema.name)return k.set("simAdded",!0),!0})}),p&&p.productID&&(c.each(p.displayableCharacteristics,function(a){"8212"===a.productSpecCharacteristicID?q.dataUnit=a.value:"8202"===a.productSpecCharacteristicID?q.smsUnit=a.value:"8192"===a.productSpecCharacteristicID&&(q.talkTimeUnit=a.value)}),k.set("easyMobileUnits",q));var r=c.filter(j,function(a){return"Device Information"===a.name});r&&r.length>0&&k.set("deviceInformationContainment",r[0].productSpecContainmentID)}k.set("orderUpdate","RPCDone"),"onDemand"!==k.get("selectNumberVmStatus")?k.getNumbersFromSDP(b,d,e,f):this.callRpcForBB()}else{var m=c.filter(j,function(a){return"8625412"===a.productSpecContainmentID}),s=m[0];s.productID&&k.set("singnetIDComponentID",s.productID),k.set("singnetIDComponentID",m[0].productID),j=c.filter(j,function(a){return"8625612"===a.productSpecContainmentID}),k.set("singnetIDFVComponentID",j[0].productID),c.each(j[0].displayableCharacteristics,function(a){"8640392"===a.productSpecCharacteristicID&&a.value&&(k.set("singnetId",a.value),k.set("singnetUpdated",!0))})}else k.getErrorMessage()},callRpcForBB:function(){var a,b,d=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");d&&(d=c.filter(d,function(a){return"BB"===a.lob&&"S"===a.level}),d&&d.length>0&&(a=d[0].productID,b=d[0].productOrderItemID,this.retrieveProductConfiguration(a,b)))},onFetchProductConfigurationError:function(a,b,c,d,e,f,g,h){a?"onDemand"!==this.get("selectNumberVmStatus")?this.getNumbersFromSDP(b,c,d,e):this.callRpcForBB():(this.set("retrieveProductConfigurationError","retrieveProductConfigurationError"),this.getErrorMessage())},setOrderData:function(){var a=this.subViewModels.orderInContextTopicViewModel.get(),b=a.productID,d=a.productOrderItemID,e=a.productOrderID,f=a.currentOrderActions;if(f&&f.length>0)if(f.length>1){var g=c.filter(f,function(a){return"FV"===a.lob&&"S"===a.level});g&&g.length>0&&(d=g[0].productOrderItemID,b=g[0].productID)}else 1===f.length&&(d=f[0].productOrderItemID,b=f[0].productID);"undefined"!=typeof b&&null!==b||f&&(f=c.filter(f,function(a){return"FV"===a.lob&&"S"===a.level}),"undefined"!=typeof f&&null!==f&&0!==f.length||(f=c.filter(a.currentOrderActions,function(a){return"WS"===a.lob&&"S"===a.level})),f&&f.length>0&&(b=f[0].productID,d=f[0].productOrderItemID)),this.set("orderItemId",d),this.set("productID",b),this.set("orderId",e),this.getListOfNumber(e,d,b)},getListOfNumber:function(a,b,c){if("undefined"!=typeof c&&null!==c){var d=this.get("numberOfResources")||40;void 0!==d&&null!==d&&this.fetchNumbers(d,a,b,c)}},getNumbersFromSDP:function(a,b,c,d){var e=this,f=e.get("selectNumberVmStatus");"onDemand"===f&&(c=e.get("numberOfResources")||40,b=e.get("orderItemId"),a=e.get("productID"),d=e.get("orderId"));var g=e.subViewModels.deviceIdAndPlanIdInContextTopic.get(),h=!1;"MBB"===g.planType&&(h=!0,"onDemand"===f&&e.set("refireSaveSelectedNumber",!0));var i={type:g.numberType,numberOfResources:c,mobileBBRequired:h},j=e.getModel("SearchAvailableNumbersModel");j.set({orderId:d,orderItemId:b,productID:a}),j.save({ImplSearchAviableInput:i},{success:e.onFetchListofNumbersSuccess,error:function(a,b){return e.set("orderUpdate","newNumbersFetchFailed"),!0}})},fetchNumbers:function(a,b,c,d){if("undefined"!=typeof b&&null!==b)this.retrieveProductConfiguration(d,c,!0,a,b);else{var e=this.get("setOrderDataCalled");e||(this.set("setOrderDataCalled",!0),this.setOrderData(),this.set("setOrderDataCalled",!1))}},onFetchListofNumbersSuccess:function(a,b){"undefined"!=typeof b.ImplSearchAviableOutput?(this.set("sign",b.ImplSearchAviableOutput.signature),this.set("receivedNumberList",b.ImplSearchAviableOutput.reservedNumbers),this.set("orderUpdate","NumberFetchsuccessful"),this.trigger("numberFetched"),this.get("refireSaveSelectedNumber")===!0&&(this.saveSelectedNumber(),this.set("refireSaveSelectedNumber",!1)),"onDemand"!==this.get("selectNumberVmStatus")&&this.callRpcForBB()):this.set("orderUpdate","failure")},getExistingNumbers:function(){var a=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType"),b=this.subViewModels.orderInContextTopicViewModel.get(),d=this.subViewModels.individualInContextTopicViewModel.get("personId");if("LANDLINE"===a&&"undefined"!=typeof d&&null!==d){var e,f=this.getModel("customerAssignedProductTechnologyModel"),g=b.currentOrderActions;g&&(g=c.filter(g,function(a){return"FV"===a.lob&&"S"===a.level}),g&&g.length>0&&(e=g[0].productOrderItemID)),f.setQueryParams({lob:"FV"}),f.fetch({orderId:b.productOrderReferenceNumber,orderActionId:e,contactId:d,success:c.bind(this.onGetExistingNumbersSuccess,this),error:this.fetchExistingNumberMessage})}},onGetExistingNumbersSuccess:function(a,b){var d=this,e=b.ImplCustomerAssignedProductTechnologyOutput;if("undefined"!=typeof e&&e.assignedProductDetails){var f=e.assignedProductDetails,g=this.subViewModels.orderInContextTopicViewModel.get("customerID"),h=c.filter(f,function(a){return!a.isDummyDELInd&&"ADSL"!==a.associatedtechnology&&!a.partOfBundle});if("undefined"!=typeof g&&null!==g&&(h=c.filter(h,function(a){return g===a.customerId})),h&&h.length>0){var i=this.subViewModels.billingAccountsViewModel.getBillingAccountDetails();i.done(function(a){var e=b.ImplCustomerAssignedProductTechnologyOutput.currentInstallationAddress;c.each(h,function(b){b.fibreEligibility=!0,b.associatedtechnology&&"HDL"===b.associatedtechnology&&"CE"===b.productState&&"AS"===b.productStatus&&(b.fibreEligibility=!1);var f=d.compareAddress(e.city,b.installationAddress.city);f&&(f=d.compareAddress(e.postcode,b.installationAddress.postcode)),f&&(f=d.compareAddress(e.state,b.installationAddress.state)),
f&&(f=d.compareAddress(e.streetName,b.installationAddress.streetName)),f&&(f=d.compareAddress(e.country,b.installationAddress.country)),f&&(f=d.compareAddress(e.apartment,b.installationAddress.apartment)),f?a&&a.length>0&&c.each(a,function(a){c.each(a.subscribers,function(c){c.subscriberResourceVal===b.serviceID&&(b.barNumber=a.billingAccountNumber)})}):b.fibreEligibility=!1}),d.set("existingNumbers",h),d.set("orderUpdate","ExistingNumberSuccessful")})}else d.set("orderUpdate","ExistingNumberNotFound")}else d.set("orderUpdate","ExistingNumberNotFound")},compareAddress:function(a,b){var c=!0;if(a===b)c=!0;else if("undefined"!=typeof a&&"undefined"!=typeof b){if(a.toUpperCase()!==b.toUpperCase())return!c;c=!0}else{if("undefined"!=typeof a||"undefined"!=typeof b)return!c;c=!0}return c},saveSelectedNumber:function(){var a=this;a.set("orderUpdate","saveSelectedNumber");var b=a.get("selectedNumber"),d=a.get("receivedNumberList");if(""===b&&"undefined"!=typeof d&&d.length>0){b=d[0];var e=a.subViewModels.miniCartInContextTopic.get("flowData");e.selectedNumber=b,a.subViewModels.miniCartInContextTopic.set("flowData",e)}var f=a.get("selectedNumbersList"),g=a.get("counter");if(c.contains(f,b))return a.set("orderUpdate","numberAlreadyReserved"),!0;g++,a.set("counter",g),f.push(b),a.set("selectedNumbersList",f);var h=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType");if(void 0!=b&&""!=b){var i=-1;if(i=c.indexOf(d,b),i>-1){var j={ImplReserveResourceNumberRequest:{resourceNumber:d.splice(i,1)[0],resourceType:h,numbersToBeReleased:d,signature:a.get("sign")}},k=a.getModel("ReserveAndReleaseModel");k.set({orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderID"),orderItemId:a.get("orderItemId"),productID:a.get("productID")});var l=!1,m=a.subViewModels.miniCartInContextTopic.get("id"),n=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("changeCartflag");"mobileSharePlan"===m&&"number"!==n&&(l=!0);var o=!1;a.get("newNumberFlag")||(o=!0),k.setQueryParams({relaxCompatibilityRules:l,setFirstLoad:o,returnFullResponse:!0}),k.save(j,{success:a.onSaveSelectedNumberSuccess,error:c.bind(a.onSaveSelectedNumberError,a)})}}else a.set("refireSaveSelectedNumber",!0)},onSaveSelectedNumberError:function(a,b){var c=this.get("counter");return c>=3?(this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("orderUpdate","failure"),!0):void this.set("orderUpdate","numberAlreadyReserved")},onSaveSelectedNumberSuccess:function(a,b){var d=this;if("undefined"!=typeof b.ImplReserveAndUpdateResourceResponse&&"BLOCKING"!==b.ImplReserveAndUpdateResourceResponse.resourceUpdateStatus){var e=d.get("preTickAddonDetails");if(e&&e.preTickAddons&&b.ImplReserveAndUpdateResourceResponse.updateOrderResponse){var f=d.subViewModels.preTickAddonViewModel;f.set("preTickAddons",e.preTickAddons),f.createInputPayload(b.ImplReserveAndUpdateResourceResponse.updateOrderResponse,e.addComponentList);var g=d.get("fiberId");if("FIBER"!==g&&"TV"!==g){var h=f._updateProductConfiguration();h.done(function(a){f.set("actionList",[]),d.getSuccessMessage()}.bind(d))}else"FIBER"!==g||d.get("singnetUpdated")?"TV"===g?d.updateOrderToRunRules(!0):d.getSuccessMessage():d.saveSelectedSingnetID()}else{var g=this.get("fiberId");"FIBER"!==g||d.get("singnetUpdated")?"TV"===g?d.updateOrderToRunRules(!0):d.getSuccessMessage():d.saveSelectedSingnetID()}}else if(b.ImplReserveAndUpdateResourceResponse&&b.ImplReserveAndUpdateResourceResponse.resourceUpdateMessages&&b.ImplReserveAndUpdateResourceResponse.resourceUpdateMessages.length>0){var i=c.find(b.ImplReserveAndUpdateResourceResponse.resourceUpdateMessages,function(a){return a.indexOf("PENDING_SUBMITTED_ORDER_FORM")>-1});i?(this.set("orderUpdate","submittedReconOrderFound"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0)):this.set("orderUpdate","failure")}else this.set("orderUpdate","failure")},getSuccessMessage:function(a,b){var d=this.get("fiberId"),e=this.get("freeMBBData");if(b&&b.UpdateProductInOrderConfigurationResponse){var f=b.UpdateProductInOrderConfigurationResponse;if(f.productConfiguration&&"BLOCKING"===f.productConfiguration.compatibilityStatus)return this.set("orderUpdate","failure"),!1}if("FIBER"===d){var g=this.get("isExistingNumberScenario");if(g)this.getExistingSuccessMessage(this.get("newCurrentOrderActions"));else{var h=this.subViewModels.orderInContextTopicViewModel.get(),i=c.filter(h.orderActions,function(a){return"WS"===a.lob&&a.isFreeMBB===!0});i&&i.length>0?(this.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobilePortinFlag",!1),this.set("orderUpdate","successful")):this.subViewModels.freeMBBViewModel.createFreeMBBOrder(e.dealerID,e.vendorID,e.mbbOfferId,e.mbbRelationId,h.productOrderID,this.get("singnetId"))}}else this.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobilePortinFlag",!1),this.set("orderUpdate","successful")},getErrorMessage:function(){return this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("orderUpdate","failure"),!0},getErrorMessageWithoutContext:function(){this.set("orderUpdate","failure")},fetchExistingNumberMessage:function(){return this.set("orderUpdate","existingNumbersFailed"),!0},saveSelectedSingnetID:function(){var a=this,b=a.get("singnetIDComponentID"),d=a.get("singnetIDFVComponentID"),e=[],f=[],g={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};b&&e.push({productSpecContainmentID:8625412,productID:b,changedCharacteristics:[{characteristicID:8622642,value:a.get("singnetId")}]}),d?e.push({productSpecContainmentID:8625612,productID:d,changedCharacteristics:[{characteristicID:8640392,value:a.get("singnetId")}]}):f.push({productSpecContainmentID:8625612,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:8640392,value:a.get("singnetId")}]}),f.length>0&&(g.UpdateProductInOrderConfigurationRequest.productChanges[0].newContainedProducts=f),e.length>0&&(g.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=e);var h,i=a.subViewModels.orderInContextTopicViewModel.get(),j=c.filter(i.currentOrderActions,function(a){return"BB"===a.lob&&"S"===a.level});j&&j.length>0&&(h=j[0].productOrderItemID);var k=i.customerID;if(k){var l=a.getModel("updateProductConfigurationModel");l.set({customerId:k,productOrderItemId:h}),a.setHeaders(l),a.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(g,{success:function(b,c){if(c.UpdateProductInOrderConfigurationResponse&&c.UpdateProductInOrderConfigurationResponse.productConfiguration&&"BLOCKING"!==c.UpdateProductInOrderConfigurationResponse.productConfiguration.compatibilityStatus){var d=a.get("preTickAddonDetails");if(d&&d.preTickAddons){var e=a.subViewModels.preTickAddonViewModel;e.set("preTickAddons",d.preTickAddons),e.createInputPayload(c.UpdateProductInOrderConfigurationResponse,d.addComponentList);var f=e._updateProductConfiguration();f.done(function(b){e.set("actionList",[]),a.updateOrderToRunRules(!1,c.UpdateProductInOrderConfigurationResponse)}.bind(a))}else a.updateOrderToRunRules(!1,c.UpdateProductInOrderConfigurationResponse)}else a.updateOrderToRunRules(!1,c.UpdateProductInOrderConfigurationResponse)},error:a.getErrorMessage})}else{var m=a.getModel("anonymousUpdateProductConfigurationModel");m.set({productOrderItemId:h}),a.setHeaders(m),a.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save(g,{success:function(b,c){if(c.UpdateProductInOrderConfigurationResponse&&c.UpdateProductInOrderConfigurationResponse.productConfiguration&&"BLOCKING"!==c.UpdateProductInOrderConfigurationResponse.productConfiguration.compatibilityStatus){var d=a.get("preTickAddonDetails");if(d&&d.preTickAddons){var e=a.subViewModels.preTickAddonViewModel;e.set("preTickAddons",d.preTickAddons),e.createInputPayload(c.UpdateProductInOrderConfigurationResponse,d.addComponentList);var f=e._updateProductConfiguration();f.done(function(b){e.set("actionList",[]),a.updateOrderToRunRules(!1,c.UpdateProductInOrderConfigurationResponse)}.bind(a))}else a.updateOrderToRunRules(!1,c.UpdateProductInOrderConfigurationResponse)}else a.updateOrderToRunRules(!1,c.UpdateProductInOrderConfigurationResponse)},error:a.getErrorMessage})}},updateOrderToRunRules:function(a,b){var d=this;if(b&&b.productConfiguration&&"BLOCKING"===b.productConfiguration.compatibilityStatus)return d.set("orderUpdate","failure"),!1;var e,f,g,h=[],i={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},j=d.subViewModels.orderInContextTopicViewModel.get();g=a?c.filter(j.currentOrderActions,function(a){return"TV"===a.lob&&"S"===a.level}):c.filter(j.currentOrderActions,function(a){return"FV"===a.lob&&"G"===a.level}),g&&g.length>0&&(e=g[0].productOrderItemID,f=g[0].productID,h.push({productID:f})),h.length>0&&(i.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=h);var k=j.customerID;if(k){var l=d.getModel("updateProductConfigurationModel");l.set({customerId:k,productOrderItemId:e}),d.setHeaders(l),d.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(i,{success:d.getSuccessMessage,error:d.getErrorMessage})}else{var m=d.getModel("anonymousUpdateProductConfigurationModel");m.set({productOrderItemId:e}),d.setHeaders(m),d.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save(i,{success:d.getSuccessMessage,error:d.getErrorMessage})}},saveSeletedExistingNumber:function(){var a,b,d=this,e=this.subViewModels.orderInContextTopicViewModel.get(),f=this.subViewModels.miniCartInContextTopic.get("id"),g=d.get("selectedExistingLine"),h=[],i=e.orderActions;if(c.each(i,function(c){"TV"===c.lob?a=c.productOrderItemID:"BB"===c.lob?b=c.productOrderItemID:"undefined"!=typeof c.lob&&null!==c.lob||h.push(c.productOrderItemID)}),"TV"===f){var j=[];e.currentOrderActions&&e.currentOrderActions.length>0&&c.each(e.currentOrderActions,function(a){"FV"===a.lob&&j.push(a.productOrderItemID)}),c.isEmpty(h)||"undefined"!=typeof b&&null!==b||(j=c.union(j,h)),j.length>0&&this.doCancelOrderActions(j,g)}else if("FIBER"===f){var j=[];e.currentOrderActions&&e.currentOrderActions.length>0&&(c.each(e.currentOrderActions,function(a){j.push(a.productOrderItemID)}),c.each(e.orderActions,function(a){!c.contains(j,a.productOrderItemID)&&a.isFreeMBB&&j.push(a.productOrderItemID)}),c.isEmpty(h)||"undefined"!=typeof a&&null!==a||(j=c.union(j,h))),this.doCancelOrderActions(j,g,!0)}},doCancelOrderActions:function(a,b,d){var e=this,f=this.subViewModels.orderInContextTopicViewModel.get(),g=b.customerId,h=f.productOrderID,i=e.getModel("customerProductOrderProductOrderItemsModel");i.set("customerId",g),i.set("productOrderId",h),e.setDefaultQueryParams(i);var j=c.clone(a);i.setQueryParams({poi:a}),i.set("id",a[0]),i.destroy({success:function(a,c){if(d){var g=!1,h=f.orderActions||[];if(h&&h.length===j.length){e.subViewModels.orderInContextTopicViewModel.emptyTopic();var i=[];if(i.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),i.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),e.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin")||window.localStorage.removeItem("LightsaberSessionToken"),window.localStorage.setItem("clearSessionStorage",!0),i.length>0)for(var k=0;k<i.length;k++){var l=i[k];window.sessionStorage.removeItem(l)}window.localStorage.removeItem("clearSessionStorage"),g=!0}e.set("isUpdateOrderReq",g),e.saveSelectedFibreLine(b,j)}else e.processOutput(j,b)},error:this.getErrorMessage})},processOutput:function(a,b){var d=this.subViewModels.orderInContextTopicViewModel.get("orderActions")||[];d&&d.length>0&&(d=c.filter(d,function(b){return!c.contains(a,b.productOrderItemID)}));var e=this.subViewModels.orderInContextTopicViewModel,f=[],g=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");g&&g.length>0&&(f=c.filter(g,function(b){return!c.contains(a,b.productOrderItemID)})),e.set("orderActions",d),e.set("currentOrderActions",f),b&&e.set("customerID",b.customerId);var h=this.get("fiberId"),i=this.get("freeMBBData");if("FIBER"===h){var j=this.subViewModels.orderInContextTopicViewModel.get(),k=c.filter(j.orderActions,function(a){return"WS"===a.lob&&a.isFreeMBB===!0});k&&k.length>0?(this.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobilePortinFlag",!1),this.getExistingSuccessMessage(f)):(this.set("newCurrentOrderActions",f),this.set("isExistingNumberScenario",!0),this.subViewModels.freeMBBViewModel.createFreeMBBOrder(i.dealerID,i.vendorID,i.mbbOfferId,i.mbbRelationId,j.productOrderID,this.get("singnetId")))}else"TV"===h&&this.updateOrderToRunRules(!0)},saveSelectedFibreLine:function(a,b){var c=this,d=c.createInputPayload(a),e=c.subViewModels.individualInContextTopicViewModel.get("personId"),f=c.getModel("submitProductConfigurationModel");f.set({contactId:e,customerId:a.customerId,productId:a.apID}),f.save(d,{success:function(d,e){var f=e.ImplSubmitProductConfigurationRestOutput;"undefined"!=typeof f?c.processFibreOutput(f,a,b):c.set("orderUpdate","failure")},error:c.getErrorMessage})},createInputPayload:function(a){var b,c,d,e,f,g=this,h=g.get("adslPlan"),i=g.subViewModels.deviceIdAndPlanIdInContextTopic.get();if(h){var j=h.adslPlanId;if(j.indexOf("_")>-1){var k=j.split("_");f=k[0],b=k[1]}else b=j;c=h.fvRelId,d=h.bbRelId,e=h.groupRelId}else{var l=i.bbRelationIds;b=i.planId,c=l.fvRelId,d=l.bbRelId,e=l.groupRelId}var m=[{newProductOfferingProductSpecID:c,productID:a.apID,productChanges:{},orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode}],n={ImplSubmitProductConfigurationRestInput:{subscriberId:a.subscriberId,installationAddressID:a.installationAddress.addressId,updateProductConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:m,newProductOfferingID:b}],productChanges:[]}}},o=this.subViewModels.orderInContextTopicViewModel.get("productOrderID");return o&&(n.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.productOrderID=o),n},processFibreOutput:function(a,b,d){var e=this;if(void 0!==typeof a.updateProductConfigurationResponse){var f=a.updateProductConfigurationResponse,g=this.subViewModels.orderInContextTopicViewModel,h=g.get("orderActions")||[],i=[];c.each(h,function(a){c.contains(d,a.productOrderItemID)||i.push(a)});var j=[];c.each(f.productsInReplaceProductOffering,function(a){c.each(a.products,function(a){var b="Provide";"FV"===a.productConfiguration.lineOfBusiness&&"S"===a.productConfiguration.productSpecification.level&&(b="Change");var d={productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productConfiguration.productSpecification.level,lob:a.productConfiguration.lineOfBusiness,flowType:"FIBER",orderType:b};j.push(d),i.push(d),"BB"===a.productConfiguration.lineOfBusiness&&c.each(a.productConfiguration.displayableItems,function(a){"8625412"===a.productSpecContainmentID?e.set("singnetIDComponentID",a.productID):"8625612"===a.productSpecContainmentID&&e.set("singnetIDFVComponentID",a.productID)}),"FV"===a.productConfiguration.lineOfBusiness&&"G"===a.productConfiguration.productSpecification.level&&c.each(a.productConfiguration.displayableItems,function(a){"8854312"===a.productSpecContainmentID&&c.each(a.displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&("9435993"===a.productSpecPricing.childPricingSchema.id||"40010052"===a.productSpecPricing.childPricingSchema.id||"40006762"===a.productSpecPricing.childPricingSchema.id)&&e.set("pricingId",a.productSpecPricingID)})})})}),g.set("orderActions",i),g.set("currentOrderActions",j),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installationAddressID",b.installationAddress.addressId),g.set("productOrderReferenceNumber",f.productOrderReferenceNumber),g.set("productOrderID",f.productOrderID),g.set("customerID",b.customerId),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("reContractFlag",!0),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractBarId",b.barNumber);var k,l=this.subViewModels.updateCoverageViewModel,m=e.get("adslPlan");if(m){var n=c.find(j,function(a){return"BB"===a.lob||"TV"===a.lob});n&&(k=n.productOrderItemID)}var o=l.onCheckServiceCoverage(b.installationAddress);o.done(function(a){if(a&&a.coverageType){var c=l._saveOrderData(a,k);c.done(function(a){if("success"===a){var c=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo"),f=e.get("isUpdateOrderReq");if(f&&c){var g=e.subViewModels.pickAndGoViewModel.updateCode(c,!1);g.done(function(a){"pickAndGoUpdated"===a?e.processOutput(d,b):"pickAndGoFailed"===a&&e.set("orderUpdate","failure")})}else e.processOutput(d,b)}else e.set("orderUpdate","failure")}),c.fail(function(a){e.set("orderUpdate","failure")}.bind(e))}else e.set("orderUpdate","failure")}),o.fail(function(a){e.set("orderUpdate","failure")}.bind(e))}},validateSingnetId:function(){var a=this.get("singnetId"),b=this;b.set("orderUpdate","reset");var c={ImplValidateUniqueLogicalResourceRequest:{userName:a,resourceType:"SINGNETBB"}};this.getModel("validateUniqueLogicalResourceModel").save(c,{success:function(a,c){var d=c.ImplValidateUniqueLogicalResourceResponse;d&&"AVAILABLEX9"===d.result?b.set("orderUpdate","singnetIdValidated"):b.set("orderUpdate","singnetIdValidatedFailed")},error:b.getErrorMessage})},getExistingSuccessMessage:function(a,b,d){var e=this;if(b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0)}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus)return e.set("orderUpdate","failure"),!1;if("BB"===d.productConfiguration.lineOfBusiness||"FV"===d.productConfiguration.lineOfBusiness&&"S"===d.productConfiguration.productSpecification.level){var f=e.get("preTickAddonDetails");if(f&&f.preTickAddons){var g=e.subViewModels.preTickAddonViewModel;g.set("preTickAddons",f.preTickAddons),g.createInputPayload(d,f.addComponentList)}}}if(a&&a.length>0)e.updateExistingNumberOrderToRunRules(a);else{var g=e.subViewModels.preTickAddonViewModel,h=g._updateProductConfiguration();h.done(function(a){g.set("actionList",[]),e.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),e.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!1),e.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobilePortinFlag",!1),e.set("orderUpdate","successful")}.bind(e))}},updateExistingNumberOrderToRunRules:function(a){var b,d,e=this,f=[],g=[],h=[],i=e.get("singnetIDComponentID"),j=e.get("singnetIDFVComponentID"),k={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},l=e.subViewModels.orderInContextTopicViewModel.get(),m=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});if(m&&m.length>0)if(b=m[0].productOrderItemID,d=m[0].productID,f.push({productID:d}),"BB"===m[0].lob)i&&f.push({productSpecContainmentID:8625412,productID:i,changedCharacteristics:[{characteristicID:8622642,value:e.get("singnetId")}]}),j?f.push({productSpecContainmentID:8625612,productID:j,changedCharacteristics:[{characteristicID:8640392,value:e.get("singnetId")}]}):g.push({productSpecContainmentID:8625612,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:8640392,value:e.get("singnetId")}]});else if("FV"===m[0].lob&&"G"===m[0].level){var n=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"),o=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("staffDetails");if("staff"===n&&o){var p="c"+Math.random().toString(36).substr(2,9);g.push({productSpecContainmentID:"8854312",temporaryID:p}),h.push({productSpecPricingID:e.get("pricingId"),parentProductSpecContainmentID:"8854312",parentTemporaryID:p})}}f.length>0&&(k.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=f),h.length>0&&(k.UpdateProductInOrderConfigurationRequest.productChanges[0].newAssignedBillingOffers=h),g.length>0&&(k.UpdateProductInOrderConfigurationRequest.productChanges[0].newContainedProducts=g);var q=l.customerID;if(q){var r=e.getModel("updateProductConfigurationModel");r.set({customerId:q,productOrderItemId:b}),e.setHeaders(r),e.setDefaultQueryParams(r),r.setQueryParams({rp:!1,rpc:!1}),r.save(k,{success:function(c,d){e.getExistingSuccessMessage(a,b,d.UpdateProductInOrderConfigurationResponse)},error:e.getErrorMessage})}else{var s=e.getModel("anonymousUpdateProductConfigurationModel");s.set({productOrderItemId:b}),e.setHeaders(s),e.setDefaultQueryParams(s),s.setQueryParams({rp:!1,rpc:!1}),s.save(k,{success:function(c,d){e.getExistingSuccessMessage(a,b,d.UpdateProductInOrderConfigurationResponse)},error:e.getErrorMessage})}}})});
define("businesswidget/repository_l9_common/common/model/NumberPortingModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/ecommerce/order/:orderId/order-item-id/:orderItemId/product/:productOrderID/number-port",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"PUT",payload:["ImplProductConfigurationInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/NumberPortinWidgetViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/NumberPortingModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel"],function (a,b,c,d,e,f){var g=a.Core.ObservableViewModel.extend({models:{numberPortingModel:c},subViewModels:{orderInContextTopicViewModel:d,deviceIdAndPlanIdInContextTopic:e,preTickAddonViewModel:f},defaults:{mobileNumber:"",numberPortinVmStatus:"",setFirstLoad:!1,preTickAddonDetails:null},config:{actions:{checkMobileNumber:function(){var a=this;a.set("numberPortinVmStatus","checking");var c=a.subViewModels.orderInContextTopicViewModel.get(),d=c.productID,e=c.productOrderItemID,f=c.productOrderID;if("undefined"==typeof d||null===d){var g=c.currentOrderActions;g&&(g=b.filter(g,function(a){return"FV"===a.lob&&"S"===level}),g&&g.length>0&&(d=g[0].productID,e=g[0].productOrderItemID))}var h={ImplProductConfigurationInput:{msisdn:a.get("mobileNumber")}},i=a.getModel("numberPortingModel");i.set({orderId:f,orderItemId:e,productOrderID:d}),a.get("setFirstLoad")||i.setQueryParams({setFirstLoad:!0}),i.setQueryParams({returnFullResponse:!0}),i.save(h,{success:a.onFetchMobileSuccess,error:a.onFetchMobileError})}}},initialize:function(a){b.bindAll(this,"onFetchMobileSuccess","onFetchMobileError")},onFetchMobileSuccess:function(a,b){var c=this;if(c.set("numberPortinVmStatus","onFetchMobileSuccess"),b.StatusResponse&&"Success"===b.StatusResponse.status){var d=c.subViewModels.preTickAddonViewModel,e=c.get("preTickAddonDetails");e&&e.preTickAddons&&b.StatusResponse&&b.StatusResponse.updateOrderResponse&&(d.set("preTickAddons",e.preTickAddons),d.createInputPayload(b.StatusResponse.updateOrderResponse,e.addComponentList));var f=d._updateProductConfiguration();f.done(function(a){d.set("actionList",[]),c.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),c.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobilePortinFlag",!0);var e=b.StatusResponse?b.StatusResponse.status:null;c.set("numberPortinVmStatus",e)}.bind(c))}else b.StatusResponse&&"SingtelPostpaid"===b.StatusResponse.status?this.set("numberPortinVmStatus","checkGomoPostpaidNumber"):b.StatusResponse&&"SingtelPrepaid"===b.StatusResponse.status?this.set("numberPortinVmStatus","checkGomoPrepaidNumber"):this.set("numberPortinVmStatus","PortinError")},onFetchMobileError:function(a,b){this.set("numberPortinVmStatus","PortinError")}});return g});
define("businesswidget/repository_l9_common/common/model/OnePassInfoModel",["businesswidget/repository_l9_common/common/model/ImplSingleCallModel"],function (a){var b=a.extend({options:{url:"onepass/headers",rest:{defaults:{method:"GET"}}}});return b});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel",["underscore","lightsaber","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel"],function (a,b,c,d,e){window.dataObject=window.dataObject||[];var f=b.Core.ObservableViewModel.extend({persistent:[],defaults:{encryptedUserId:null,userLoggedIn:null,nric:null,contactID:null,accountId:null,onePassVmStatus:null,gtmData:null,gtmViewStatus:null},subViewModels:{contactInContextTopicViewModel:c,onePassTopicViewModel:d,accountInContextTopicViewModel:e},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{onePassVmStatus:"subViewModels.onePassTopicViewModel.onePassVmStatus",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){a.bindAll(this,"onOnePassVmStatusChange","publishData"),this.subViewModels.onePassTopicViewModel.on("change:onePassVmStatus",this.onOnePassVmStatusChange)},onOnePassVmStatusChange:function(){var a=this.subViewModels.onePassTopicViewModel.get("onePassVmStatus");if("OnePassInfoSet"===a){var b={LoginStatus:"No"};this.subViewModels.onePassTopicViewModel.get("GTMUserData")&&(b.UserID=this.subViewModels.onePassTopicViewModel.get("GTMUserData"),b.LoginStatus="Yes"),this.set("gtmData",b),this.publishData()}},publishData:function(){this.set("gtmViewStatus","");var b=this.get("gtmData");if(window.dataObject.length>0){var c=window.dataObject[0];c=a.extend(c,b),window.dataObject[0]=c}else window.dataObject.push(b);this.set("gtmData",null),this.set("gtmViewStatus","dataObjectUpdated")}});return f});
define("businesswidget/repository_l9_common/common/viewmodel/ShopNowTopicViewModel",["lightsaber","underscore","Configuration","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c,d,e){return a.Core.ObservableViewModel.extend({models:{anonymousProductOrderProductOrderItemsModel:d},subViewModels:{orderInContextTopicViewModel:e},dataBindings:[],defaults:{},initialize:function(a){console.log("ShopNowTopicViewModel Initializes"),Ractive.defaults.on("TriggerCancelOrder",function(a){this.cancelAnonymouseOrder(a)}.bind(this))},cancelAnonymouseOrder:function(a){var c,d=this,e=d.subViewModels.orderInContextTopicViewModel.get(),f=e.productOrderID,g=[];b.each(e.currentOrderActions,function(a){g.push(a.productOrderItemID)}),g.length>0?(c=d.models.anonymousProductOrderProductOrderItemsModel,c.set("productOrderId",f),d.setDefaultQueryParams(c),c.setQueryParams({poi:g}),c.set("id",g),c.destroy({success:b.bind(d.cancelAnonymouseOrderSuccess,d,a),error:function(){a.resolve()}})):a.resolve()},cancelAnonymouseOrderSuccess:function(a,b,c){var d=[];if(this.subViewModels.orderInContextTopicViewModel.emptyTopic(),d.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic"),d.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"),d.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),d.length>0)for(var e=0;e<d.length;e++){var f=d[e];window.sessionStorage.removeItem(f)}a.resolve()},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})}})});
define("businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/WorryFreeViewModel","single!businesswidget/repository_l9_common/common/viewmodel/ShopNowTopicViewModel"],function (a,b,c,d,e,f,g){return a.Core.ObservableViewModel.extend({models:{onePassInfoModel:d},subViewModels:{onePassTopicViewModel:c,worryFreeViewModel:f,shopNowTopicViewModel:g},dataBindings:[{userId:"subViewModels.onePassTopicViewModel.userId",options:{twoWay:!0,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!0,setOnBind:!0}},{nickName:"subViewModels.onePassTopicViewModel.nickName",options:{twoWay:!0,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!0,setOnBind:!0}},{status:"subViewModels.onePassTopicViewModel.status",options:{twoWay:!0,setOnBind:!0}},{billPayer:"subViewModels.onePassTopicViewModel.billPayer",options:{twoWay:!0,setOnBind:!0}},{familyName:"subViewModels.onePassTopicViewModel.familyName",options:{twoWay:!0,setOnBind:!0}},{email:"subViewModels.onePassTopicViewModel.email",options:{twoWay:!0,setOnBind:!0}},{isWorryFreeLogin:"subViewModels.onePassTopicViewModel.isWorryFreeLogin",options:{twoWay:!0,setOnBind:!0}},{isWorryFreeFaVerfied:"subViewModels.onePassTopicViewModel.isWorryFreeFaVerfied",options:{twoWay:!0,setOnBind:!0}},{GTMUserData:"subViewModels.onePassTopicViewModel.GTMUserData",options:{twoWay:!0,setOnBind:!0}}],defaults:{onePassVmStatus:""},initialize:function(a){b.bindAll(this,"getCookieVal","getCookie","createCookie","deleteSingtelCookie","setSDContextHUB"),this.set("onePassVmStatus","OnePasViewModelInitialized")},config:{actions:{}},setOnePassFields:function(){this.set("onePassVmStatus","OnePassInfoLoading");var a=this.subViewModels.worryFreeViewModel.isWorryFreePage();return a&&this.models.onePassInfoModel.setQueryParams({cleanWorryFree:!0}),this.models.onePassInfoModel.fetch({success:b.bind(this.onOnePassInfoSuccess,this),error:b.bind(this.onOnePassInfoFailure,this)})},sendOnePassDetails:function(){var a=this.subViewModels.onePassTopicViewModel.get("headers"),c={HTTP_CUST_ID:a.nric,HTTP_GIVEN_NAME:a.nickName,HTTP_LOGIN_ID:a.userId,HTTP_CUST_ID_TYPE:a.customerIdType,HTTP_CUST_STATUS:a.status,HTTP_CUST_EMAIL:a.email,HTTP_BILL_PAYER:a.billPayer,HTTP_SSO_FAMILY_NAME:a.familyName},d=function(a){for(var b in c)c.hasOwnProperty(b)&&a.setRequestHeader(b,c[b])};return this.models.onePassInfoModel.fetch({beforeSend:d,success:b.bind(this.onOnePassInfoSuccess,this),error:b.bind(this.onOnePassInfoFailure,this)})},onOnePassInfoSuccess:function(a,b){var c=b.ImplLoginHeaderResOutput.headersMap;this.subViewModels.onePassTopicViewModel.set("onePassVmStatus","OnePassInfoLoadedSuccessfully"),this.subViewModels.onePassTopicViewModel.set("nickName",c.HTTP_GIVEN_NAME),this.subViewModels.onePassTopicViewModel.set("userId",c.HTTP_LOGIN_ID),this.subViewModels.onePassTopicViewModel.set("customerIdType",this.getCustomerIdType(c.HTTP_CUST_ID_TYPE)),this.subViewModels.onePassTopicViewModel.set("status",c.HTTP_LHTTP_CUST_STATUSOGIN_ID),this.subViewModels.onePassTopicViewModel.set("email",c.HTTP_CUST_EMAIL),this.subViewModels.onePassTopicViewModel.set("familyName",c.HTTP_SSO_FAMILY_NAME),this.subViewModels.onePassTopicViewModel.set("billPayer",c.HTTP_BILL_PAYER),this.subViewModels.onePassTopicViewModel.set("nric",c.HTTP_CUST_ID),this.subViewModels.onePassTopicViewModel.set("GTMUserData",c.HTTP_DMP_USERID),this.subViewModels.onePassTopicViewModel.set("isWorryFreeLogin",!!c.WORRY_FREE_LOGIN&&"Y"===c.WORRY_FREE_LOGIN),this.subViewModels.onePassTopicViewModel.set("isWorryFreeFaVerfied",!!c.WF_FA_CHECK_REQD&&"Y"===c.WF_FA_CHECK_REQD),this.subViewModels.onePassTopicViewModel.set("onePassVmStatus","OnePassInfoSet")},getCookieVal:function(a){var b=document.cookie.indexOf(";",a);return b===-1&&(b=document.cookie.length),decodeURI(document.cookie.substring(a,b))},getCookie:function(a){for(var b=a+"=",c=b.length,d=document.cookie.length,e=0;e<d;){var f=e+c;if(document.cookie.substring(e,f)===b)return this.getCookieVal(f);if(e=document.cookie.indexOf(" ",e)+1,0===e)break}return null},createCookie:function(){var a=this.getCookie("singtelUser");"undefined"!=typeof a&&null!==a||(document.cookie="singtelUser=true;path=/")},deleteSingtelCookie:function(){document.cookie="singtelUser=; expires=Thu, 01 Jan 1970 00:00:00 UTC"},setSDContextHUB:function(){if(window.SDContextHUB){var a=this.setStoreData();window.SDContextHUB.publish("singtelstore",a)}},setStoreData:function(){var a={mobile:this.subViewModels.onePassTopicViewModel.get("mobile")?"yes":"no",tv:this.subViewModels.onePassTopicViewModel.get("tv")?"yes":"no",broadband:this.subViewModels.onePassTopicViewModel.get("broadband")?"yes":"no"};return a},getCustomerIdType:function(a){var b="";switch(a){case"2":b="National Registration ID Card (NRIC)";break;case"6":b="Foreign Identification Number (FIN)";break;case"532":b="Foreigner Dependent Pass";break;case"534":b="Foreigner Employment Pass";break;case"535":b="Foreigner S Pass";break;case"533":b="Foreigner Student Pass";break;case"536":b="Passport Number";break;case"531":b="Foreigner Social Visit Pass";break;case"530":b="Foreigner Work Permit";break;case"600":b="Diplomat";break;case"539":b="Entre Pass"}return b},onOnePassInfoFailure:function(){this.set("onePassVmStatus","OnePassInfoLoadingFailed")}})});
define("businesswidget/repository_l9_common/common/model/UserInformationModel",["businesswidget/repository_l9_common/common/model/ImplSingleCallModel","underscore"],function (a,b){var c=a.extend({options:{url:"user/information",rest:{read:{method:"GET"}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/UserInformationViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/UserInformationModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j){var k=a.Core.ObservableViewModel.extend({models:{userInformationModel:c,viewUpdateCustomerProfileModel:d},subViewModels:{individualInContextTopicViewModel:f,implUserContextTopicViewModel:e,customerInContextTopicViewModel:i,contactInContextTopicViewModel:j},dataBindings:[],defaults:{errors:{userInformationError:""},vmStates:{userInfoState:"NotLoaded"},vm_config:{},anonymouUser:!0,userDetails:{custId:"",custIdType:"",billPayer:""},clientContext:{contact:{contactId:"",dateOfBirth:"",firstName:"",gender:"",lastName:"",phone:""},customers:[],billingArrangements:[],financialAccounts:[],subscriptions:[]},permissions:{contactPermissions:{ipa:!1,blacklistReason:null,blacklisted:!1,suspected:!1},accountPermissions:[],servicePermissions:[]}},retrieveUserInfo:function(){var a=$.Deferred();return this.set("userInformationError",""),this.getModel("userInformationModel").fetch({success:b.bind(this.onUserInformationSuccess,this,a),error:b.bind(this.onFetchProfileError,this,a)}),this.set("userInfoState","Loading"),a},logout:function(){this.set("anonymouUser",this.defaults.anonymouUser),this.set("userDetails",this.defaults.userDetails),this.set("clientContext",this.defaults.clientContext),this.subViewModels.individualInContextTopicViewModel.set(this.getValueByPath("clientContext.contact.contactId")),this.set("userInfoState","NotLoaded")},initialize:function(){b.bindAll(this,"retrieveUserInfo","logout")},onUserInformationSuccess:function(a,c,d){this.set("anonymouUser",d.ImplUserInformationResponse.anonymouUser);var e=null;if(d.ImplUserInformationResponse.userDetails){var f=d.ImplUserInformationResponse.clientContext;f.contactDetails=f.contact,this.set("userDetails",d.ImplUserInformationResponse.userDetails),this.set("clientContext",f),this.subViewModels.implUserContextTopicViewModel.set("userInfo",f);var g=b.uniq(b.pluck(f.customers,"customerId"));this.subViewModels.customerInContextTopicViewModel.set("customerIds",g),g&&g.length&&(this.subViewModels.customerInContextTopicViewModel.get("ID")||this.subViewModels.customerInContextTopicViewModel.set("ID",g[0])),e=d.ImplUserInformationResponse.clientContext.contact.gender}else this.set("userDetails",this.defaults.userDetails),this.set("clientContext",this.defaults.clientContext);this.getValueByPath("clientContext.contact.contactId")&&(this.subViewModels.contactInContextTopicViewModel.set("ID",this.getValueByPath("clientContext.contact.contactId")),this.subViewModels.individualInContextTopicViewModel.set("personId",this.getValueByPath("clientContext.contact.contactId"))),this.set("userInfoState","LoadSuccess");var h;d.ImplUserInformationResponse.userDetails&&(h=d.ImplUserInformationResponse.userDetails.loginId);var i={anonymouUser:d.ImplUserInformationResponse.anonymouUser,anonymousUser:d.ImplUserInformationResponse.anonymouUser,gender:e,loginId:h};a.resolve(i),this.retrieveContactInfo()},onFetchProfileError:function(a,b,c){return this.set("anonymouUser",this.defaults.anonymouUser),this.set("userDetails",this.defaults.userDetails),this.set("clientContext",this.defaults.clientContext),this.subViewModels.individualInContextTopicViewModel.set(this.getValueByPath("clientContext.contact.contactId")),this.set("userInfoState","LoadError"),a.reject("failure"),!0},retrieveContactInfo:function(){var a=this,c=$.Deferred(),d=a.subViewModels.individualInContextTopicViewModel.get("personId");if(d){var e=a.getModel("viewUpdateCustomerProfileModel");e.set("id",d),e.fetch({success:b.bind(a.onFetchSuccess,a,c),error:b.bind(a.onFailure,a,c)})}else c.resolve();return c},onFetchSuccess:function(a,b,c){var d=c.ImplContactPersonOutput.implContactPerson,e=!!this.subViewModels.implUserContextTopicViewModel.get("permissions")&&this.subViewModels.implUserContextTopicViewModel.get("permissions").contactPermissions,f={blacklistReason:d.blacklistReason,ipa:!!e&&e.ipa,blacklisted:!1,suspected:!1};f.blacklistReason&&(f.blacklistReason===g.get("SUSPECTED_REASON_CODE")?f.suspected=!0:"X"!==f.blacklistReason&&(f.blacklisted=!0)),this.setValueByPath("permissions.contactPermissions",f),this.subViewModels.implUserContextTopicViewModel.set("permissions",this.get("permissions")),a.resolve()},onFailure:function(a,b,c){this.subViewModels.implUserContextTopicViewModel.set("permissions",this.get("permissions")),a.resolve()}});return k});
define("businesswidget/repository_l9_common/common/model/findCallerByContactModel",["lightsaber","businesswidget/repository_l9_common/common/model/ImplSingleCallModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"customer-management/caller-by-contact/",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},update:{contentType:"application/json",method:"POST",payload:["ImplFindCallerByContactInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UserInformationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/findCallerByContactModel","businesswidget/repository/common/viewmodel/LoginViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l){return a.Core.ObservableViewModel.extend({models:{findCallerModel:g},subViewModels:{onePassDetailsViewModel:d,userInformationViewModel:e,implUserContextTopicViewModel:f,individualInContextTopicViewModel:i,contactInContextTopicViewModel:j,onePassTopicViewModel:k,customerInContextTopicViewModel:l},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.onePassTopicViewModel.tv":"tv",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.onePassTopicViewModel.mobile":"mobile",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.onePassTopicViewModel.mobileSubscriber":"mobileSubscriber",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.onePassTopicViewModel.broadband":"broadband",options:{twoWay:!1,setOnBind:!1}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.implUserContextTopicViewModel.userInfo":"userInfo",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.individualInContextTopicViewModel.personId":"userInfo.contactDetails.contactId",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.contactInContextTopicViewModel.ID":"userInfo.contactDetails.contactId",options:{twoWay:!1,setOnBind:!1}}],defaults:{implLoginVmStatus:"",nric:null,tv:null,mobile:null,broadband:null,mobileSubscriber:null,customerIdType:null,userInfo:{contactDetails:{contactId:null,firstName:null,lastName:null,phone:null,gender:null,dateOfBirth:null},contactCustomerDetails:null,contactBillingArrangementDetails:null,contactFinancialAccountDetails:null,contactSubscriptionDetails:null}},initialize:function(a){var c=this;b.bindAll(),this.on("change:nric",this.fetchUserInfo,this),this.on("change:userInfo",function(a){var c=a.value.contactCustomerDetails;if(c&&c.length>0){var d=b.find(c,function(a){return"Primary"===a.contactRole});this.subViewModels.customerInContextTopicViewModel.set("ID",d.customerId);var e=[];b.each(c,function(a){e.push(a.customerId)}),this.subViewModels.customerInContextTopicViewModel.set("customerIds",b.uniq(e))}}.bind(this)),setTimeout(function(){c.set("implLoginVmStatus","ImplLoginViewModelInitialized")},0)},onLoginSuccess:function(){this.set("implLoginVmStatus","userLoginTicketGenerated"),this.subViewModels.onePassDetailsViewModel.createCookie(),"ON"==c.get("onePassSimulator")?this.subViewModels.onePassDetailsViewModel.sendOnePassDetails():this.subViewModels.onePassDetailsViewModel.setOnePassFields()},onLoginError:function(){this.set("implLoginVmStatus","userLoginTicketGenerationFailed")},fetchUserInfo:function(){var a=this.get("nric");if(a){var c={implContactDetails:{indentValue:a,indentType:this.get("customerIdType")}};this.getModel("findCallerModel").save({ImplFindCallerByContactInput:c},{success:b.bind(this.onFindCallerSuccess,this),error:b.bind(this.onFindCallerFailure,this)})}},onFindCallerSuccess:function(a,b){this.set("userInfo",b.ImplFindCallerByContactOutput),this.setsubscriberData(b.ImplFindCallerByContactOutput.contactSubscriptionDetails),this.subViewModels.onePassDetailsViewModel.createCookie(),this.subViewModels.onePassDetailsViewModel.setSDContextHUB(),this.subViewModels.userInformationViewModel.retrieveContactInfo(),this.set("implLoginVmStatus","userInfoLoadedSuccessfully")},setsubscriberData:function(a){var c=["Mobile","MOB","WS"],d=["TV","FEB"],e=["FEB","FHB","BB"],f=[];b.map(a,function(a){this.get("mobile")||this.set("mobile",c.indexOf(a.lineOfBusiness)>-1),this.get("tv")||this.set("tv",d.indexOf(a.lineOfBusiness)>-1),this.get("broadband")||this.set("broadband",e.indexOf(a.lineOfBusiness)>-1),c.indexOf(a.lineOfBusiness)>-1?f.push(a.primaryResource):console.log("not a mobileSubscriber")},this),this.set("mobileSubscriber",f)},onFindCallerFailure:function(){this.set("implLoginVmStatus","userInfoLoadingFailed")},login:function(){if("ON"==c.get("onePassSimulator")){var a=new h;a.invokeLogin({username:"restOwner",password:"Unix11",success:b.bind(this.onLoginSuccess,this),error:b.bind(this.onLoginError,this)})}else this.subViewModels.onePassDetailsViewModel.setOnePassFields()}})});
define("businesswidget/repository_l9_common/common/model/RetreivePriceSchemasModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"commerce/customer/:customerId/product/:productId/price-schema/:priceSchemaId/retrieve-price-schemas-for-replacement",async:!1,rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/RetreiveSchemasAndProductsModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"commerce/customer/:customerId/price-schema/123/allow-replacement-products",async:!1,rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/UpdateProductConfigurationModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"commerce/customer/:customerId/product-order-item/:productOrderItemId/product-configuration",rest:{defaults:{method:"PUT",contentType:"application/json",payload:["UpdateProductConfigurationRequest"]}}}});return b});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/InstallationAddressTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["installationAddress"],defaults:{installationAddress:{}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/RetreivePriceSchemasTopic",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["priceSchemasArray","choosenPriceSchemaId"],defaults:{priceSchemasArray:[],choosenPriceSchemaId:null}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/PriceSchemaRecontractContextTopic",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["productOfferingID","productOfferingProductSpecID","priceSchemaID"],defaults:{productOfferingID:null,productOfferingProductSpecID:null,priceSchemaID:null}});return d});
define("businesswidget/repository_l9_common/common/model/CustomerProductAddOnsModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"ecommerce/customer/:custId/product/:productApId/add-ons",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/RecontractPlanViewModel",["lightsaber","underscore","single!businesswidget/repository/common/util/BusinessHelper","businesswidget/repository_l9_common/common/model/RetreivePriceSchemasModel","businesswidget/repository_l9_common/common/model/RetreiveSchemasAndProductsModel","businesswidget/repository_l9_common/common/model/UpdateProductConfigurationModel","single!businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/model/viewServiceDetailModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/InstallationAddressTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/RetreivePriceSchemasTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/PriceSchemaRecontractContextTopic","businesswidget/repository_l9_common/common/model/CustomerProductAddOnsModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=a.Core.ObservableViewModel.extend({models:{RetreivePriceSchemasModel:d,RetreiveSchemasAndProductsModel:e,UpdateProductConfigurationModel:f,customerProductAddOnsModel:p,viewServiceListModel:g},subViewModels:{contactInContextTopicViewModel:i,customerInContextTopicViewModel:j,productConfigurationTopicViewModel:k,productInContextTopicViewModel:l,installationAddressTopicViewModel:m,retreivePriceSchemasTopic:n,priceSchemaRecontractContextTipic:o},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.RetreiveSchemasAndProductsModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.RetreivePriceSchemasModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.RetreivePriceSchemasModel.productId":"subViewModels.productInContextTopicViewModel.productID",options:{twoWay:!1,setOnBind:!0}},{productID:"subViewModels.productInContextTopicViewModel.productID",options:{twoWay:!1,setOnBind:!0}},{"models.UpdateProductConfigurationModel.productOrderItemId":"subViewModels.productConfigurationTopicViewModel.productOrderItemID",options:{twoWay:!1,setOnBind:!0}},{installationAddress:"subViewModels.installationAddressTopicViewModel.installationAddress",options:{twoWay:!1,setOnBind:!0}},{priceSchemasArray:"subViewModels.retreivePriceSchemasTopic.priceSchemasArray",options:{twoWay:!0,setOnBind:!0}},{choosenPriceSchemaId:"subViewModels.retreivePriceSchemasTopic.choosenPriceSchemaId",options:{twoWay:!1,setOnBind:!0}},{productOfferingID:"subViewModels.priceSchemaRecontractContextTipic.productOfferingID",options:{twoWay:!1,setOnBind:!0}},{productOfferingProductSpecID:"subViewModels.priceSchemaRecontractContextTipic.productOfferingProductSpecID",options:{twoWay:!0,setOnBind:!0}},{priceSchemaID:"subViewModels.priceSchemaRecontractContextTipic.priceSchemaID",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:"",contactId:"",productOrderItemId:"",customerId:"",productOrderId:"",productID:"",installationAddress:{},priceSchemasArray:[],choosenPlanId:-1,addonProcessCounter:0,productList:[],serviceStatus:"init",productOfferingID:null,productOfferingProductSpecID:null,priceSchemaID:null,errors:{responseError:""}},initialize:function(){console.log("Start initialize...."),b.bindAll(this,"loadPlanList","retreiveSchemasAndProducts","_extractProductAddOnsFromModel","callProductAddOns","handleCustomerProductAddOnsFailure","filterProductsBySchemas","updateRecontractPlanProduct","errorUpdateProduct","successUpdateProduct","getPlanLabel","getServiceLabel"),this.on("change:customerId",this.retreiveSchemasAndProducts),this.on("change:installationAddress",this.retreiveSchemasAndProducts),this.on("change:productID",this.retreiveSchemasAndProducts),this.on("change:productOfferingID",this.retreiveSchemasAndProducts),this.on("change:productOfferingProductSpecID",this.retreiveSchemasAndProducts),this.on("change:priceSchemaID",this.retreiveSchemasAndProducts)},isAllDataAvailable:function(){return null!=this.get("customerId")&&this.get("installationAddress")!={}&&null!=this.get("productID")&&null!=this.get("productOfferingID")&&this.get("productOfferingProductSpecID")!={}&&null!=this.get("priceSchemaID")},retreiveSchemasAndProducts:function(a,b){this.isAllDataAvailable()&&(this.defaults.installationAddress=this.get("installationAddress"),this.getModel("RetreiveSchemasAndProductsModel").fetch({customerId:this.get("customerId"),success:this.loadPlanList,error:function(a){console.log("Error in retreiveSchemasAndProducts")}}))},getServiceLabel:function(a){var b=a.serviceId?a.personName||"":a.offeringName;return a.lob==c.lob.WIRELESS&&a.shared&&(b=a.plan?a.plan.displayName:b),b},getPlanLabel:function(a){var b;switch(a.lob){case c.lob.WIRELESS:b=a.shared?"Shared Plan":a.serviceId?"+"+a.serviceId:"";break;case c.lob.WIRELINE:b=a.serviceId?this.formatPhone(a.serviceId):"";break;case c.lob.INTERNET:b=a.plan?a.plan.displayName?a.plan.displayName:a.plan.catalogItemName?a.plan.catalogItemName:"":"";break;case c.lob.TV:b=a.plan?a.plan.displayName?a.plan.displayName:a.plan.catalogItemName?a.plan.catalogItemName:"":"";break;default:b=a.equipmentName?a.equipmentName:a.serviceId?a.serviceId:""}return b},callProductAddOns:function(a){this.models.customerProductAddOnsModel=this.create("cm_myStuffServicesViewModel_CustomerProductAddOnsModel_Model",p),this.models.customerProductAddOnsModel.set({custId:this.get("customerId"),productApId:a}),this.models.customerProductAddOnsModel.setQueryParams({lo:"en_US",sc:"SS"}),this.models.customerProductAddOnsModel.fetch({success:this._extractProductAddOnsFromModel,error:this.handleCustomerProductAddOnsFailure})},_extractProductAddOnsFromModel:function(a,c){var d=this.get("products"),e=b(d).find(function(b){return b.id===a.attributes.productApId}),f="";b.each(c["ServiceHeader[]"],function(a){f+=a.catalgoItemName+","},this),this.defaults.addonProcessCounter++,e.addons=f,this.set("products",d),this.defaults.addonProcessCounter==d.length&&(this.set("productList",d),this.set("serviceStatus","list-ok"))},handleCustomerProductAddOnsFailure:function(a,b){console.log(" rest error get addons")},findPriceSchema:function(a,c){var d=b(c.ArrayList).find(function(b){return b.assignedProductID===a}),e=-1;return d&&(e=d.priceSchemaID),e},filterProductsBySchemas:function(a,c){var d=[];return b.each(a,function(a){var e=b(c).find(function(b){return b.id===a.assignedProductID});e&&d.push(e)},this),d},loadPlanList:function(a,b){this.set("offerings",b.ArrayList);var c=this;this.getModel("viewServiceListModel").fetch({customerId:this.get("customerId"),success:function(a,b){c.onLoadProductsSuccess(a,b),c.set("viewServiceDetailsVMStatus","ProductsListFetched")}})},onLoadProductsSuccess:function(a,b){var c=b.Products.products;productsForReContract=this.filterProductsBySchemas(this.get("offerings"),c),this.set("products",productsForReContract),this.handleProducts(productsForReContract)},handleProducts:function(a){this.defaults.addonProcessCounter=0,b.each(a,function(a){var c=this.getPlanLabel(a)+" : "+this.getServiceLabel(a);a.productLabel=c,a.address&&!b.isEmpty(a.address)||(a.address=this.defaults.installationAddress),this.callProductAddOns(a.id)},this),this.set("products",a)},config:{actions:{chooseRecontractPlanProduct:function(a){console.log("chooseRecontractPlanProduct"),this.updateRecontractPlanProduct()}}},setModelParams:function(){this.getModel("ManageNicknameModel").setQueryParams({nickName:this.get("nickNameVm")})},updateRecontractPlanProduct:function(a,c){console.log("updateRecontractPlanProduct ....");var d=this.get("choosenPlanId");console.log("choosenPlanId "+d);var e=this.get("offerings"),f=b(e).find(function(a){return a.assignedProductID==d}),g={UpdateProductConfigurationRequest:{runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{newProductOfferingProductSpecID:f.productOfferingProductSpecID,productID:this.get("productID"),newBasicPriceScehmaID:f.priceSchemaID}],newProductOfferingID:f.productOfferingID}]}};updateModel=this.getModel("UpdateProductConfigurationModel"),updateModel.save({UpdateProductConfigurationRequest:g,customerId:this.get("customerId"),productOrderItemId:this.get("customerId")},{type:"PUT",success:this.successUpdateProduct,error:this.errorUpdateProduct})},successUpdateProduct:function(a,b){console.log("successUpdateProduct..."),this.set("serviceStatus","success")},errorUpdateProduct:function(a,b){console.log("fail UpdateProduct..."),this.set("serviceStatus","fail")}});return q});
define("businesswidget/repository_l9_common/common/model/CreateAddressModel",["businesswidget/repository/common/core/RESTModel","underscore"],function (a,b){return a.extend({options:{url:"/location/address",rest:{create:{contentType:"application/json",method:"POST",payload:["CreateAddressRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/BillingAccountDetailedListModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"customer/:customerId/billing-entity",rest:{read:{method:"GET",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplBillingAccountCreateRequest"],qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/ChangePlanModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"/commerce/customer/:customerId/product-order-item/:productOrderItemId/product-configuration",rest:{defaults:{method:"PUT",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"PUT",contentType:"application/json",payload:["UpdateProductInOrderConfigurationRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"ecommerce/customer/:customerId/submitOrder",rest:{defaults:{method:"POST",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/ChangePlanViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/CreateAddressModel","businesswidget/repository_l9_common/common/model/BillingAccountDetailedListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","businesswidget/repository_l9_common/common/model/ChangePlanModel","businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=a.Core.ObservableViewModel.extend({models:{createAddressModel:d,billingAccountDetailedListModel:e,changePlanModel:g,billSpecIdPayChannelModel:h,submitProductConfigurationModel:i,customerSubmitOrderModel:m,updateProductOrderModel:n,customerProductOrderProductOrderItemsModel:o},subViewModels:{customerInContextTopicViewModel:f,productInContextTopicViewModel:l,orderInContextTopicViewModel:j,contactInContextTopicViewModel:k,NotificationViewModel:p},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productOrderId:"subViewModels.orderInContextTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0}},{productOrderItemId:"subViewModels.orderInContextTopicViewModel.productOrderItemID",options:{twoWay:!1,setOnBind:!0}},{assignedProduct:"subViewModels.productInContextTopicViewModel.assignedProduct",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{changePlanVmStatus:null,productOrderItemId:null,productId:null,newPlanId:null,newPlanDetails:null,orderId:null,contactId:null,neWAddress:null,productOrderId:null,productOrderItemId:null,orderActions:null,selectedBarId:null,planRelId:null,penaltyCharges:null,submitOrderFlag:!1,productOrderItemID:null,productOrderReferenceNumber:null},initialize:function(){c.bindAll(this,"updatePlan","updateEasyMobilePlan","updateAccountAddress","createBillAddress","onSaveBillingAddressSuccess","getBillSpecIdPayChannel","setHeaders","setDefaultQueryParams","processFailures"),this.set("changePlanVmStatus","changePlanInitialized"),setTimeout(function(){this.set("changePlanVmStatus","changePlanViewModelInitialized")}.bind(this),0)},updatePlan:function(){var a=this;a.set("changePlanVmStatus","easyMobilePlanUpdateInProgress");var b={updateProductConfigurationRequest:{runCompatibilityRules:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{newProductOfferingProductSpecID:this.get("planRelId"),productID:this.get("productId"),productChanges:{removedSimpleProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[],removedContainedProducts:[]}}],newProductOfferingID:this.get("newPlanId")}],productChanges:[]}};a.subViewModels.orderInContextTopicViewModel.get("orderId")&&(b.productOrderID=a.subViewModels.orderInContextTopicViewModel.get("orderId")),submitProductConfigurationModel=a.getModel("submitProductConfigurationModel"),submitProductConfigurationModel.set({customerId:a.get("customerId"),contactId:a.subViewModels.contactInContextTopicViewModel.get("ID"),productId:a.get("productId")}),submitProductConfigurationModel.save({ImplSubmitProductConfigurationRestInput:b},{type:"PUT",success:c.bind(a.submitProductConfigurationSuccess,a),error:function(){a.set("changePlanVmStatus","planUpdateFailed")}})},submitProductConfigurationSuccess:function(a,b){this.set("changePlanVmStatus",null);var d=this,e=b.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse;e&&e.productOrderID&&(d.set("orderId",e.productOrderID),d.set("productOrderReferenceNumber",e.productOrderReferenceNumber)),d.set("productOrderItemID",e.productsInReplaceProductOffering[0].products[0].productOrderItemID);var a=d.getModel("updateProductOrderModel");d.setHeaders(a),d.setDefaultQueryParams(a),a.setQueryParams({rp:!1,rpc:!1}),a.set({customerId:d.subViewModels.customerInContextTopicViewModel.get("ID"),productOrderItemId:e.productsInReplaceProductOffering[0].products[0].productOrderItemID});var f;if(c.each(e.productsInReplaceProductOffering,function(a){c.each(a.products,function(a){f=c.find(a.productConfiguration.displayableItems,function(a){return a.productID&&"11762"===a.productSpecContainmentID})})}),f)return void d.set("changePlanVmStatus","planUpdateFailed");var g=e.productsInReplaceProductOffering[0].products[0].productID,h={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[{productID:g}],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};a.save(h,{success:c.bind(d.onUpdateOrderSuccess,d),error:function(){d.set("changePlanVmStatus","planUpdateFailed")}})},onUpdateOrderSuccess:function(a,b){var d=this,e=b.UpdateProductInOrderConfigurationResponse.productConfiguration;if(d.set("penaltyCharges",0),"BLOCKING"===e.compatibilityStatus)d.cancelOrder(!0);else{var f=c.find(e.displayableItems,function(a){if(void 0!==a.displayableBillingOffers&&a.displayableBillingOffers.length>0)return c.find(a.displayableBillingOffers,function(a){if("8430902"===a.productSpecPricing.childPricingSchema.id)return!0})});f&&f.totalOneTimeCalculatedPrice&&d.set("penaltyCharges",f.totalOneTimeCalculatedPrice.finalAmountIncludingTax),d.set("submitOrderFlag",!1),d.set("changePlanVmStatus","planUpdatedSuccessfully")}},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},submitPlan:function(){this.set("changePlanVmStatus","planUpdateInProgress"),this.updateEasyMobilePlan()},updateEasyMobilePlan:function(){var a=this,b=a.getModel("customerSubmitOrderModel");b.setQueryParams({id:a.subViewModels.customerInContextTopicViewModel.get("ID"),orderIds:this.get("productOrderReferenceNumber")}),b.set({customerId:a.subViewModels.customerInContextTopicViewModel.get("ID")}),b.save(null,{success:c.bind(this.submitOrderSuccess,this),error:function(){a.set("changePlanVmStatus","planUpdateFailed")}})},updateAccountAddress:function(){var a=this.get("newAddress"),b=this.get("selectedBarId");null===b?this.createBillAddress(a):this.getBillSpecIdPayChannel(b)},createBillAddress:function(a){var b=this,c=a,d={ImplBillingAccountCreateRequest:{deliveryMethod:"Email",nickName:"singtelAccount",isEasyMobile:!1,physicalAddress:{floor:c.floor,houseNumber:c.blockOrHouseNum,postcode:c.postCode,streetName:c.streetName,unitNumber:c.apartment,blockOrHouseAddr:"APT BLK",country:"SGP",state:"SNG"}}},e=b.getModel("billingAccountDetailedListModel");e.save(d,{customerId:b.get("customerId"),success:b.onSaveBillingAddressSuccess,error:function(){b.set("checkoutFullfillmentVMStatus","planUpdateFailed")}})},onSaveBillingAddressSuccess:function(a,b){var c=this;if(void 0!==b.ImplBillingAccountCreateResponse||null!==b.ImplBillingAccountCreateResponse){var d=c.get("neWAddress");c.subViewModels.orderInContextTopicViewModel.set("barId",b.ImplBillingAccountCreateResponse.billingArangmentId),c.subViewModels.orderInContextTopicViewModel.set("billingAddress",d),this.getBillSpecIdPayChannel(b.ImplBillingAccountCreateResponse.billingArangmentId)}},getBillSpecIdPayChannel:function(a){if(void 0!==typeof a||null!==a){var b=this.getModel("billSpecIdPayChannelModel"),c=this;b.set("customerBillSpecId",a),b.fetch({success:function(a,b){c.set("changePlanVmStatus","BarAddressUpdated"),c.updateEasyMobilePlan()},error:function(){c.set("changePlanVmStatus","planUpdateFailed")}})}},submitOrderSuccess:function(a,b){b&&(this.set("submitOrderFlag",!0),this.set("changePlanVmStatus","planSubmittedSuccessfully"),this.subViewModels.NotificationViewModel.getInteractionData().then(function(a){var b,c,d,e=[];a=a.CHANGE_PLAN,b=a.title,c=a.topic;var f=this.get("penaltyCharges")>0?"downgrade":"upgrade",g=this.get("assignedProduct");e=[f,g.plan.displayName,this.get("newPlanDetails").planName,g.serviceId],d=this.subViewModels.NotificationViewModel.getKeyMapping(a.description,e),this.subViewModels.NotificationViewModel.createInteraction(b,c,d)}.bind(this)))},cancelOrder:function(a){var b=this,d=b.get("orderId");if(null!==d){var e=b.getModel("customerProductOrderProductOrderItemsModel");e.set("productOrderId",d),e.set("customerId",b.get("customerId")),b.setDefaultQueryParams(e);var f=[];f.push(b.get("productOrderItemID")),e.setQueryParams({poi:f}),e.set("id",f),e.destroy({success:c.bind(b.processOutput,b,a),error:c.bind(b.processFailures,b)})}},processOutput:function(a){a?this.set("changePlanVmStatus","failedPlanCancelled"):this.set("changePlanVmStatus","planCancelled")},processFailures:function(){this.set("changePlanVmStatus","Failed")}});return q});
define("businesswidget/repository_l9_common/common/viewmodel/ImplAssignedProductDetailsViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository/common/util/BusinessHelper","single!businesswidget/repository_l9_common/common/model/viewServiceDetailModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{viewServiceDetailModel:e},subViewModels:{customerInContextTopicViewModel:f,productInContextTopicViewModel:g},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{assignedProductId:"subViewModels.productInContextTopicViewModel.assignedProduct.id",options:{twoWay:!1,setOnBind:!0}}],defaults:{assignedProductDetails:null,assignedProductDetailsVMStatus:null},initialize:function(a){this._super(a);this.set("assignedProductDetailsVMStatus","initialized"),this.on("change:assignedProductId",this.getProductDetails,this)},getProductDetails:function(){this.set("assignedProductDetailsVMStatus","assignedProductDetailsLoading");var a=this.get("customerId");if(void 0!==typeof a){var b=this.get("assignedProductId");b&&(this.set("assignedProductDetails",null),e.fetch({customerId:a,productId:b,success:c.bind(this.onProductDetailsReceived,this),error:c.bind(this.onProductDetailsError,this)}))}},onProductDetailsReceived:function(a,b){var c=b.Product;this.set("assignedProductDetails",c),this.set("assignedProductDetailsVMStatus","assignedProductassignedProductDetailsSet")},onProductDetailsError:function(){this.set("assignedProductDetailsVMStatus","assignedProductassignedProductDetailsFailed")},isAllDataAvailable:function(){return null!==this.get("customerId")}});return h});
define("businesswidget/repository_l9_common/common/model/SelectedNumberModel",["businesswidget/repository/common/core/RESTModel","underscore"],function (a,b){var c=a.extend({options:{url:"/sdp/manageResource/updateStatus",rest:{read:{method:"GET"},create:{method:"POST",payload:["ImplUpdateStatusInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/UpdateOrderDeliveryAddressModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/ordering/customer/:customerId/order/:orderId/update-delivery-address",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{contentType:"application/json",method:"PUT",payload:["ImplUpdateOrderDeliveryAddressRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/ChangeSimViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/ImplAssignedProductDetailsViewModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/model/SelectedNumberModel","businesswidget/repository_l9_common/common/model/SearchAvailableNumbersModel","businesswidget/repository_l9_common/common/model/UpdateOrderDeliveryAddressModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/CreateAddressModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){
var r=a.Core.ObservableViewModel.extend({models:{submitProductConfigurationModel:f,customerSubmitOrderModel:i,updateProductOrderModel:j,cancelOrderModel:k,selectedNumberModel:l,searchAvailableNumbersModel:m,updateOrderDeliveryAddressModel:n,createAddressModel:p},subViewModels:{customerInContextTopicViewModel:d,contactInContextTopicViewModel:e,productInContextTopicViewModel:g,implAssignedProductDetailsViewModel:h,onePassTopicViewModel:o,NotificationViewModel:q},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productId:"subViewModels.productInContextTopicViewModel.assignedProduct.id",options:{twoWay:!1,setOnBind:!0}},{planId:"subViewModels.productInContextTopicViewModel.assignedProduct.plan.id",options:{twoWay:!1,setOnBind:!0}},{subscriptionId:"subViewModels.productInContextTopicViewModel.assignedProduct.subscriptionId",options:{twoWay:!1,setOnBind:!0}},{status:"subViewModels.productInContextTopicViewModel.assignedProduct.status",options:{twoWay:!1,setOnBind:!0}},{productDetails:"subViewModels.implAssignedProductDetailsViewModel.assignedProductDetails",options:{twoWay:!1,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}}],defaults:{changeSimVmStatus:"",nric:null,customerIdType:null,productOrderItemID:"",contactId:null,customerId:null,productId:null,refNumber:null,submitOrderFlag:!1,imsiNumber:null,selectedDetails:null,simProductId:null,productRefNumber:null,simType:null,penaltyCharges:null},initialize:function(){c.bindAll(this,"updateProductConfig","createInputPayloadForCreateOrder","createInputPayloadforUpdate","setHeaders","setDefaultQueryParams","getImsiNumber","submitOrder","updateProductConfiguration","onCreateDeliveryAddressSuccess"),this.set("changeSimVmStatus","changePlanViewModelInitialized")},config:{actions:{createOrder:function(){var a=this;a.set("changeSimVmStatus","createOrderInProgress");var b=a.createInputPayloadForCreateOrder();a.getModel("submitProductConfigurationModel").set({contactId:a.get("contactId"),customerId:a.get("customerId"),productId:a.get("productId")}),a.getModel("submitProductConfigurationModel").save(b,{success:c.bind(a._submitProductConfigSuccess,a),error:c.bind(a._submitProductConfigFailure,a)})}}},_submitProductConfigSuccess:function(a,b){var d,e,f=b.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse,g=c.filter(f.productConfiguration.displayableItems,function(a){return"8363722"===a.productSpecContainmentID}),h=this.get("selectedDetails"),i=h.selectedSim,j=h.replaceSimBillingOffers;i.type&&i.type.toLowerCase().indexOf("non-nfc")>-1?(e="3IN1",d=j.nonNfcSimOfferId):i.type&&i.type.toLowerCase().indexOf("nfc")>-1&&(e="NFC 3IN1",d=j.nfcSimOfferId);var k;g&&g.length>0&&(this.set("simProductId",g[0].productID),c.each(g[0].displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&a.productSpecPricing.childPricingSchema.id===d&&(k=a.productSpecPricingID)})),this.set("refNumber",f.productOrderID),this.set("productRefNumber",f.productOrderReferenceNumber),this.set("productOrderItemID",f.productOrderItemID),this.set("productId",f.productID),this.set("changeSimVmStatus","submitProductConfigSuccess"),this.set("simType",e),this.updateProductConfig(f,e,k,g[0].productID)},_submitProductConfigFailure:function(a,b){this.set("changeSimVmStatus","createOrderFailed"),this.set("submitOrderFlag",!0)},updateProductConfig:function(a,b,d,e){var f=this,g=f.createInputPayloadforUpdate(a.productID,b,d,e),h=this.getModel("updateProductOrderModel");h.set({customerId:f.subViewModels.customerInContextTopicViewModel.get("ID"),productOrderItemId:a.productOrderItemID}),f.setHeaders(h),f.setDefaultQueryParams(h),h.setQueryParams({rp:!1,rpc:!1}),h.save(g,{success:c.bind(f._updateProductConfigSuccess,f),error:c.bind(f._updateProductConfigFailure,f)})},_updateProductConfigFailure:function(a,b){this.set("changeSimVmStatus","createOrderFailed"),this.set("submitOrderFlag",!1)},createInputPayloadForCreateOrder:function(){var a=this.subViewModels.productInContextTopicViewModel.getValueByPath("assignedProduct.status"),b={updateProductConfigurationRequest:{returnRemovedItems:!1,configurationLevel:"FULL",runCompatibilityRules:!1,confirmationMessagesApproved:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0},submitProductOrder:!1,settingsView:"FULL",productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:[],newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],orderActionReasonX8:"SU"===a||"SUSPENDED"===a?"CREQ":"CSIM",orderActionTypeX8:"SU"===a||"SUSPENDED"===a?"RS":"CH"},subscriberId:this.get("subscriptionId")};return{ImplSubmitProductConfigurationRestInput:b}},createInputPayloadforUpdate:function(a,b,c,d){for(var e=this,f=0,g=this.get("productDetails"),h=0;h<g.services.length;h++){var i=g.services[h];if("8027872"===i.catalogItemID){f=i.id;break}}var j=[],k=this.subViewModels.productInContextTopicViewModel.getValueByPath("assignedProduct.status");"SU"!==k&&"SUSPENDED"!==k&&("3IN1"===b?j.push({productSpecPricingID:c,parentProductID:d}):j.push({productSpecPricingID:c,parentProductID:d})),"LNS"===g.reasonCodeX8&&(j=[]);var l={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[{productID:a},{productID:e.get("simProductId"),changedCharacteristics:[{characteristicID:"8022652",value:b}]},{productID:f,changedCharacteristics:[{characteristicID:"132395",value:""}]},{productID:this.get("productId"),changedCharacteristics:[{characteristicID:"8182",value:"Courier to Home"},{characteristicID:"8363432",value:"Express"}]}],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:j,newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return l},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},_updateProductConfigSuccess:function(a,b){b&&b.UpdateProductInOrderConfigurationResponse?(b.UpdateProductInOrderConfigurationResponse.productConfiguration.totalOneTimeCalculatedPrice&&this.set("penaltyCharges",b.UpdateProductInOrderConfigurationResponse.productConfiguration.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0),this.set("submitOrderFlag",!1),this.set("changeSimVmStatus","planUpdatedSuccessfully")):(this.set("changeSimVmStatus","createOrderFailed"),this.set("submitOrderFlag",!1))},submitOrder:function(){var a=this,b=a.get("selectedDetails"),c=b.addressData;if(c&&c.addressId)a.onCreateDeliveryAddressSuccess(c.addressId);else{var d={CreateAddressRequest:{address:{apartment:c.unitNo,floor:c.floorNo||c.floor,postalCode:c.postCode||c.postcode,street:c.streetName,streetNumber:c.blockOrHouseNum||c.houseNumber,address2:c.blockOrHouseNum,country:c.country||"SGP",state:c.state||"SNG",city:c.city||"Singapore",address1:c.blockOrHouseAddr,address3:c.buildingName}}};a.getModel("createAddressModel").save(d,{success:function(b,c){var d=c.CreateAddressResponse.address.ID;a.onCreateDeliveryAddressSuccess(d)},error:function(){a.set("changeSimVmStatus","failure")}})}},onCreateDeliveryAddressSuccess:function(a){var c=this,d=c.get("selectedDetails"),e=b.get("replaceSim_DeliveryMethod"),f={ImplUpdateOrderDeliveryAddressRestInput:{deliveryMethod:e||"Courier to Home",transactionType:"RECONTRACT",addressId:a,recipientDocumentType:c.get("customerIdType"),recipientDocumentId:c.get("nric"),recipientFirstName:d.firstName,recipientLastName:d.lastName,recipientPhone:d.phone,recipientEmail:d.emailId,shippingInstructions:"shippingInstructions"}};void 0!==d.timeSlotsDetails&&""!==d.timeSlotsDetails&&(f.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:d.timeSlotsDetails.slotStartDate,slotEndDate:d.timeSlotsDetails.slotStartDate,slotCode:d.timeSlotsDetails.slotCode,timeDescription:d.timeSlotsDetails.timeDescription});var g=12345;void 0!==g&&""!==g&&(f.ImplUpdateOrderDeliveryAddressRestInput.appointmentId=g);var h=c.getModel("updateOrderDeliveryAddressModel");h.save(f,{customerId:c.subViewModels.customerInContextTopicViewModel.get("ID"),orderId:c.get("productRefNumber"),success:c.getImsiNumber,error:function(){c.set("changeSimVmStatus","failure")}})},processOutput:function(){this.set("changeSimVmStatus","planCancelled")},getImsiNumber:function(){var a=this,b={ImplSearchAviableInput:{type:"SIM",numberOfResources:1,mobileBBRequired:!1}},d=a.getModel("searchAvailableNumbersModel"),e=a.get("simType"),f=!1;"NFC 3IN1"===e&&(f=!0),d.setQueryParams({oaType:"CH",isCareFlow:!0,NFC:f}),d.set({orderId:a.get("refNumber"),orderItemId:a.get("productOrderItemID"),productID:a.get("productId")}),d.save(b,{success:c.bind(a.onGetImsiNumberSuccess,a),error:c.bind(a.onGetImsiNumberFailure,a)})},onGetImsiNumberSuccess:function(a,b){if("undefined"!=typeof b.ImplSearchAviableOutput){var c=b.ImplSearchAviableOutput.implSimSpec[0].number;this.set("imsiNumber",c),this.updateProductConfiguration(c)}else this.set("changeSimVmStatus","failure")},onGetImsiNumberFailure:function(a,b){this.set("changeSimVmStatus","failure")},updateProductConfiguration:function(a){var b=this,d={UpdateProductInOrderConfigurationRequest:{links:[],confirmationMessagesApproved:!1,runCompatibilityRules:!1,productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:[{productID:b.get("simProductId"),changedCharacteristics:[{characteristicID:"8858992",value:a},{characteristicID:"132395",value:a}]}],newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],returnConfiguration:"ALL",updateEvenIfNotValid:!1}},e=b.getModel("updateProductOrderModel");e.set({customerId:b.subViewModels.customerInContextTopicViewModel.get("ID"),productOrderItemId:b.get("productOrderItemID")}),e.save(d,{success:c.bind(b.reserveImsiNumber,b),error:c.bind(b.updateProductConfigurationFailure,b)})},updateProductConfigurationFailure:function(a,b){this.set("changeSimVmStatus","failure")},reserveImsiNumber:function(a,b){var d=this,e={ImplUpdateStatusInput:{resourceData:[{toReserveSIM:!0,simNumber:d.get("imsiNumber")}]}};d.getModel("selectedNumberModel").save(e,{success:c.bind(d.onReserveNumberSuccess,d),error:c.bind(d.onReserveNumberFailure,d)})},onReserveNumberSuccess:function(){var a=this,b=a.getModel("customerSubmitOrderModel");b.setQueryParams({id:a.subViewModels.customerInContextTopicViewModel.get("ID"),orderIds:this.get("productRefNumber")}),b.set({customerId:a.subViewModels.customerInContextTopicViewModel.get("ID")}),b.save(null,{success:c.bind(this.submitOrderSuccess,this),error:function(b,c){a.set("changeSimVmStatus","failure")}})},onReserveNumberFailure:function(){this.set("changeSimVmStatus","failure")},submitOrderSuccess:function(a,b){b&&(this.set("submitOrderFlag",!0),this.set("changeSimVmStatus","planSubmittedSuccessfully"),this.subViewModels.NotificationViewModel.getInteractionData().then(function(a){var b,c,d,e=[];a=a.REPLACE_SIM,b=a.title,c=a.topic,e=[this.get("selectedDetails").selectedSim.type,this.get("productDetails").serviceId],d=this.subViewModels.NotificationViewModel.getKeyMapping(a.description,e),this.subViewModels.NotificationViewModel.createInteraction(b,c,d)}.bind(this)))},cancelOrder:function(){var a=this,b=a.get("refNumber");if(null!==b){var d=a.getModel("cancelOrderModel");d.set("productOrderId",b),d.set("customerId",a.subViewModels.customerInContextTopicViewModel.get("ID")),a.setDefaultQueryParams(d);var e=[];e.push(a.get("productOrderItemID")),d.setQueryParams({poi:e}),d.set("id",e),d.destroy({success:c.bind(a.processOutput,a),error:function(b,c){a.set("changeSimVmStatus","failed")}})}}});return r});
define("businesswidget/repository_l9_common/common/model/RelocateFixedServicesModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/support/contact-person/:contactId/customer/:customerId/relocate-fixed-services-submit",rest:{defaults:{method:"POST",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},payload:["ImplRelocateFixedServicesRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ValidateNricModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"/verify-customer/relocate-service",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplValidateRelocationInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ImplRelocateFixedServicesAnonymousUserModel",["businesswidget/repository/common/core/RESTModel","businesswidget/repository_l9_common/common/core/Configuration"],function (a,b){return a.extend({options:{url:"/support/relocate-fixed-services-submit-for-anonymous",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRelocateFixedServicesForAnonymousRestInput"]}}},name:b.get("ERROR_CONST").RELOCATE_FIXED_SERVICES_ANONYMOUS})});
define("businesswidget/repository_l9_common/common/viewmodel/business/RelocateMyServicesViewModel",["lightsaber","underscore","Configuration","businesswidget/repository_l9_common/common/model/RelocateFixedServicesModel","businesswidget/repository_l9_common/common/model/AddressModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/common/model/ValidateNricModel","businesswidget/repository_l9_common/common/model/CheckServiceCoverageModel","single!businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","single!businesswidget/repository_l9_common/common/model/ImplRelocateFixedServicesAnonymousUserModel","moment"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a.Core.ObservableViewModel.extend({models:{relocateFixedServicesModel:d,addressModel:e,validateNricModel:j,CheckServiceCoverageModel:k,implRelocateFixedServicesAnonymousUserModel:m},subViewModels:{customerInContextTopicViewModel:g,individualInContextTopicViewModel:i,billingAccountSummaryViewModel:f,productInContextTopicViewModel:h,NotificationViewModel:l},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{accounts:"subViewModels.billingAccountSummaryViewModel.accounts",options:{twoWay:!1,setOnBind:!0}},{productId:"subViewModels.productInContextTopicViewModel.productID",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:"",contactId:"",postalCode:null,address:null,notes:null,subscribersEmailId:"",retainFixedLineNumberList:null,alternativeContactNumber:null,dateToBeContacted:null,timeToBeContacted:null,templateId:null,selectedServices:null,relocateMyServiceVmStatus:"",physicalAddress:"",nricDetails:null,accountList:null,caseDescription:null,isCreateCase:!0,isSendNotificationForAnonymousUser:!0},initialize:function(){b.bindAll(this,"getAddress","onCheckServiceCoverageSuccess","onRetrieveAddressSuccess","saveRelocationFixedServicesDataSuccess","saveRelocationFixedServicesDataError"),this.on("change:selectedAccounts",this.getSelectedAccountDetails),this.set("relocateMyServiceVmStatus","relocationServiceModelInitialized")},config:{actions:{sendNotification:function(){var a={reason1:"BillExplanation",reason2:"BillAccountBillID",result:"CreateCase",protocol:"BillingHD"},b="Service Relocation";this.subViewModels.NotificationViewModel.createInteraction(b,a,this.get("notes"))},checkCoverage:function(){var a=this,b=this.getCheckCoveragePayload();a.set("relocateMyServiceVmStatus","checkCoveragePayloadSet"),a.set("coverageType",b.ImplPhysicalAddress.buildingClassification),a.getModel("CheckServiceCoverageModel").save(b,{success:a.onCheckServiceCoverageSuccess,error:function(){a.set("relocateMyServiceVmStatus","invalidAddress")}})},validateSubscriberNRIC:function(){var a=this,b={ImplValidateRelocationInput:{indentValue:this.get("nricDetails"),indentType:"National Registration ID Card (NRIC)"}};a.set("relocateMyServiceVmStatus","nricValidationInProgress"),a.getModel("validateNricModel").save(b,{success:function(b,c){c.ImplValidateRelocationOutput&&c.ImplValidateRelocationOutput.valid?c.ImplValidateRelocationOutput.eligible?a.set("relocateMyServiceVmStatus","nricValid"):a.set("relocateMyServiceVmStatus","nricIneligible"):a.set("relocateMyServiceVmStatus","nricInvalid")},error:function(){a.set("relocateMyServiceVmStatus","nricValidFailed")}})},saveRelocationFixedServicesData:function(){this.set("relocateMyServiceVmStatus","relocationRequestInProgress");var a=this.getFormattedPayload();this.getModel("relocateFixedServicesModel").set({contactId:this.get("contactId"),customerId:this.get("customerId")}),this.getModel("relocateFixedServicesModel").save({ImplRelocateFixedServicesRestInput:a},{success:this.saveRelocationFixedServicesDataSuccess,error:this.saveRelocationFixedServicesDataError})}}},createCaseForAnonymousUser:function(){this.set("relocateMyServiceVmStatus","createCaseInProgress");var a=this.get("caseDescription"),c=this.get("isCreateCase");this.get("isSendNotificationForAnonymousUser");if(c){var d={ImplRelocateFixedServicesForAnonymousRestInput:{selectedDate:a.selectedDate+","+a.selectedTimeSlot,name:a.subscriberDetails.name,nric:a.subscriberDetails.idType+a.subscriberDetails.nric,nricType:a.subscriberDetails.guestIdType,contactNumber:a.subscriberDetails.contactNo,emailId:a.subscriberDetails.email,selectedServices:a.checkedServices,retainFixedLine:a.retainFixLineNo?"Yes":"No",address:{unitNumber:a.address.unitNo,blockOrHouseNum:a.address.blockOrHouseNum,streetName:a.address.streetName,buildingName:a.address.buildingName,postcode:a.address.postCode}}};if(a.assitingData&&a.assitingData.name){var e={name:a.assitingData.name,email:a.assitingData.email,contactNumber:a.assitingData.contactNo};d.ImplRelocateFixedServicesForAnonymousRestInput.requestorDetails=e}this.models.implRelocateFixedServicesAnonymousUserModel.save(d).then(b.bind(this.onAnonymousUserCreateCaseSuccess,this),b.bind(this.onAnonymousUserCreateCaseFailure,this))}else setTimeout(function(){this.set("relocateMyServiceVmStatus","anonymousUserCreateCaseSuccess")}.bind(this),0)},onAnonymousUserCreateCaseSuccess:function(a){this.set("relocateMyServiceVmStatus","anonymousUserCreateCaseSuccess")},onAnonymousUserCreateCaseFailure:function(){this.set("relocateMyServiceVmStatus","anonymousUserCreateCaseFailure")},sendEmailForAnynymousRelocation:function(){var a=this.get("caseDescription"),b=[{key:"submitDate",value:n().format("DD/MM/YYYY")},{key:"subName",value:a.subscriberDetails.name},{key:"nric",value:a.subscriberDetails.idType+a.subscriberDetails.nric},{key:"subContactNo",value:a.subscriberDetails.contactNo},{key:"subEmail",value:a.subscriberDetails.email},{key:"services",value:a.checkedServices},{key:"retainFixedLineNumber",value:a.retainFixLineNo?"Yes":"No"},{key:"relocationDate",value:a.selectedDate+","+a.selectedTimeSlot},{key:"buildingName",value:a.address.buildingName},{key:"floorNo",value:a.address.floorNo},{key:"unitNo",value:a.address.unitNo},{key:"blockOrHouseNum",value:a.address.blockOrHouseNum},{key:"streetName",value:a.address.streetName},{key:"postCode",value:"Singapore "+a.address.postCode}];a.assitingData&&b.push({key:"reqDetails",value:a.requesterDetails},{key:"reqName",value:a.assitingData.name},{key:"reqContact",value:a.assitingData.contactNo},{key:"reqEmail",value:a.assitingData.email});var d=c.get("RELOCATE_SERVICES_ANONYMOUS_EMAIL"),e=c.get("RELOCATE_SERVICES_ANONYMOUS_EMAIL_TEMPLATE");this.subViewModels.NotificationViewModel.triggerMail(d,e,b,null,null)},onCheckServiceCoverageSuccess:function(a,b){if(b.ImplCheckServiceCoverageRestOutput&&b.ImplCheckServiceCoverageRestOutput.coverageType){var c=b.ImplCheckServiceCoverageRestOutput.coverageType,d={};switch(c){case"S1":this.set("relocateMyServiceVmStatus","availableOnCurrentAddress"),d.status="success";break;case"S2":case"S3":case"S4":case"S5":case"S6":this.set("relocateMyServiceVmStatus","invalidAddress")}var e=b.ImplCheckServiceCoverageRestOutput.coverageStatus,f=b.ImplCheckServiceCoverageRestOutput.coverageSubStatus;this.set("coverageStatus",e),this.set("coverageSubStatus",f),this.set("result",d)}else this.set("relocateMyServiceVmStatus","invalidAddress")},onFetchSuccess:function(a,b){var c=this,d=b.ImplContactPersonOutput.implContactPerson;"undefined"!=typeof d.emailId&&null!==d.emailId&&""!==d.emailId?c.sendEmail(d.emailId):c.set("relocateMyServiceVmStatus","mailFailed")},getCheckCoveragePayload:function(){var a=this.get("physicalAddress"),b={ImplPhysicalAddress:{postcode:a.postCode||a.postcode,streetName:a.streetName,buildingClassification:a.buildingClassification,blockOrHouseNum:a.blockOrHouseNum||a.streetNumber}};if(a.apartment)b.ImplPhysicalAddress.unitNumber=a.apartment;else{var c=a.floorNo||a.floor,d=a.unitNo||a.apartment;(c||d)&&(b.ImplPhysicalAddress.unitNumber=c||d)}return b},getFormattedPayload:function(){var a={},c=this.get("address"),d={apartment:c.unitNo,blockOrHouseNum:c.blockOrHouseNum,room:c.blockOrHouseNum,buildingName:c.buildingName,floor:c.floorNo,postcode:c.postCode,unitNumber:c.unitNo,streetName:c.streetName,buildingClassification:c.buildingClassification,country:"SGP",state:"SNG",countryCode:"65"};a.address=d,a.alternativeContactNumber=this.get("alternativeContactNumber"),a.dateToBeContacted=this.get("dateToBeContacted"),a.preferredTimeSlot=this.get("timeToBeContacted"),a.retainFixedLineNumberList=this.get("retainFixedLineNumberList");var e=this.get("selectedServices"),f=[];return b.each(this.get("accounts"),function(a){var c=b.pluck(a.subscribers,"subscriberResourceVal"),d=[];b.each(e,function(a){b.each(c,function(b){b==a.serviceId&&d.push({serviceId:b,serviceName:a.lob})})}),d.length>0&&f.push({accountNumber:a.faid,servicesList:d})}),a.accountsList=f,a},getAddress:function(){var a=this;this.set("relocateMyServiceVmStatus","relocationRequestAddressRetrieve"),this.models.addressModel.set({postalCode:this.get("postalCode")}),this.models.addressModel.fetch({success:b.bind(this.onRetrieveAddressSuccess,this),error:function(b){a.set("relocateMyServiceVmStatus","retrieveAddressFailed")}})},onRetrieveAddressSuccess:function(a,c){var d=c.ImplSearchAddressResponse.geographicAddress,c=c.ImplSearchAddressResponse.geographicAddress[0],e=[],f={};b.map(d,function(a){return{unit:a.unitNumber,floor:a.floor}});b.each(d,function(a){if(a.floor){var b=a.floor,c=b.split("-")[0].split("#")[1];if(void 0!==c&&e.push({value:c,text:c}),a.unitNumber){var d=a.unitNumber,g=d.split("-");g.length>1&&g[1].indexOf("{")<0&&void 0!==c&&(void 0===f[c]&&(f[c]=[]),f[c].push(g[1]))}}}),e=b.uniq(e,!1,function(a){return a.value});var g={};g.floorAndUnitAddressMap=f,g.floorOptions=e,g.postcode=c.postcode||c.postCode,g.streetName=c.streetName,g.buildingName=c.buildingName,g.blockOrHouseNum=c.blockOrHouseNum,this.set("address",g),this.set("relocateMyServiceVmStatus","relocationRequestAddressLoaded")},saveRelocationFixedServicesDataSuccess:function(a,b){this.set("relocateMyServiceVmStatus","relocationRequestCretedSuccessfully")},saveRelocationFixedServicesDataError:function(a,b){this.set("relocateMyServiceVmStatus","relocationRequestFailed")},getSelectedAccountDetails:function(){var a=this.get("selectedAccounts"),c=[];b.each(a,function(a){var d={};d.accountNumber=a.billingAccountNumber,d.servicesList=[],b.each(a.assignedProducts.services,function(a){d.servicesList.push({serviceId:a.serviceId,serviceName:a.spoName})}),b.each(a.assignedProducts.bundle,function(a){d.servicesList.push({serviceId:a.serviceId,serviceName:a.spoName})}),c.push(d)}),this.set("accountList",c),this.set("relocateMyServiceVmStatus","relocationRequestAccountListSet")}});return o});
define("businesswidget/repository_l9_common/common/model/PayMeansModel",["lightsaber","Configuration"],function (a,b){return a.Core.RESTModel.extend({options:{url:"billingcare/customer/:customerId/individual/:individualId/pay-means",rest:{defaults:{method:"GET",payload:["PayMeanDetails"]},read:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json"}}},name:b.get("ERROR_CONST").GET_PAYMEANS})});
define("businesswidget/repository_l9_common/common/model/ImplPayInstructionModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"billingcare/contact-person/:contactId/customer/:customerId/account/:faId/billing-arrangement/:barId/pay-instruction",rest:{defaults:{contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"POST",payload:["AutoPaymentDetails"]},update:{method:"POST",payload:["AutoPaymentDetails"]},"delete":{url:"billingcare/contact-person/:contactId/customer/:customerId/account/:faId/billing-arrangement/:barId/pay-instruction/delete",method:"DELETE"}}}})});
define("businesswidget/repository_l9_common/common/model/TerminateGiroModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return b.Core.RESTModel.extend({options:{url:"/billingcare/customer/:customerId/contact-person/:individualId/giro/terminate-good-registration",rest:{defaults:{},create:{method:"PUT",payload:["ImplTerminateGOODRegistrationRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ImplInitiateUpdatePaymentModel",["lightsaber"],function (a){return a.Core.RESTModel.extend({options:{url:"payment/paymentGateway/contactId/:contactId/initiateUpdate",rest:{defaults:{method:"POST",contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/SearchDirectDebitModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{url:"billing/search-direct-debit",rest:{defaults:{contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplSearchDirectDebitInput"]},update:{method:"POST",payload:["ImplSearchDirectDebitInput"]}}},name:d.get("ERROR_CONST").DIRECT_DEBIT_RW,parse:function(a,b){if(a.ImplSearchDirectDebitOutput&&a.ImplSearchDirectDebitOutput.implDirectDebitItems){var d=c.filter(a.ImplSearchDirectDebitOutput.implDirectDebitItems,function(a){return 68==a.requestStatus});a.ImplSearchDirectDebitOutput.implDirectDebitItems=c.difference(a.ImplSearchDirectDebitOutput.implDirectDebitItems,d)}return a}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/PayMeansViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/PayMeansModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository/widgetsLibrary/selectPaymentMethod/common/selectPaymentMethodConstants","single!businesswidget/repository_l9_common/common/model/ImplPayInstructionModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","businesswidget/repository_l9_common/common/model/TerminateGiroModel","single!businesswidget/repository_l9_common/common/model/ImplInitiateUpdatePaymentModel","single!businesswidget/repository_l9_common/common/model/SearchDirectDebitModel","moment","businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m){return a.Core.ObservableViewModel.extend({models:{PayMeansModel:c,terminateGiroModel:i,implInitiateUpdatePaymentModel:j,searchDirectDebitModel:k,implPayInstructionModel:g},subViewModels:{customerInContextTopicViewModel:d,individualInContextTopicViewModel:e,accountInContextTopicViewModel:h,implUserContextTopicViewModel:m},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{barId:"subViewModels.accountInContextTopicViewModel.barId",options:{twoWay:!1,setOnBind:!0}},{faId:"subViewModels.accountInContextTopicViewModel.faId",options:{twoWay:!1,setOnBind:!0}},{userInfo:"subViewModels.implUserContextTopicViewModel.userInfo",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,goodAccount:null,payMeansVmStatus:null,paymentMethodtype:f.PAYMENT_METHOD.ALL,payMeans:null,selectedPaymeans:null,isGiroActivated:null,newCreditCard:null,newBankDetails:null,barId:null,newCcRegistrationUrl:null,pgInfo:null,selectedPaymeansToRemove:null},initialize:function(){this._super(),this.searchPaymeansDeferred=$.Deferred(),this.on("change:customerId",this.fetchPayMeansDetails,this),this.on("change:contactId",this.fetchPayMeansDetails,this),$.when(this.searchPaymeansDeferred).done(b.bind(this.checkIfDirectDebitRequestExists,this))},checkIfDirectDebitRequestExists:function(){var a=this.get("goodAccount");if(a){for(var b=this.getValueByPath("userInfo.contactFinancialAccountDetails"),c=[],d=0;d<b.length;d++){var e=this.searchDirectDebit(b[d].faId);c.push(e)}$.when.apply(this,c).done(function(a,b,c,d){var e=this.get("goodAccount"),f=!0;if("string"==typeof b&&"success"==b){var g=[];arguments=[],arguments[0]=g.concat(a,b,c)}for(var h=0;h<arguments.length&&f;h++)for(var i=arguments[h][0].ImplSearchDirectDebitOutput.implDirectDebitItems,j=0;j<i.length;j++){
var k=i[j];if((69===k.requestStatus||80==k.requestStatus)&&k.bankCode===e.bankCode&&k.bankAccountNumber===e.accountNumber){f=!1;break}}e.isDiscontinueAllowed=f,this.set("goodAccount",e)}.bind(this))}},searchDirectDebit:function(a){var b=this.get("goodAccount");return this.models.searchDirectDebitModel.save({ImplSearchDirectDebitInput:{accountId:a,paymentMethod:"DD",bankCode:b.bankCode,bankAccountNumber:b.accountNumber,fromDepositDate:1e3*l().unix(),implPaginationInfo:{pageSize:100,pageCount:1,pageNumber:1}}})},fetchPayMeansDetails:function(){var a=this.get("customerId"),d=this.get("contactId");if(a&&d){this.set("payMeansVmStatus","loadPaymeans"),this.models.customerPersonPayMeansModel=this.create("PayMeansModel",c),this.models.customerPersonPayMeansModel.set({customerId:a,individualId:d});var e=this.get("paymentMethodtype");e!=f.PAYMENT_METHOD.ALL&&(e==f.PAYMENT_METHOD.CC?e=f.PAYMENT_METHOD_ITEMTYPE.CREDIT_CARD:e==f.PAYMENT_METHOD.DD&&(e=f.PAYMENT_METHOD_ITEMTYPE.DIRECT_DEBIT),this.models.customerPersonPayMeansModel.setQueryParams({type:e})),this.models.customerPersonPayMeansModel.fetch({success:b.bind(this._populatePaymeansList,this),error:b.bind(this._handleErrorInFetch,this)})}},_handleErrorInFetch:function(){this.set("payMeansVmStatus","payMeansFailed"),this.searchPaymeansDeferred.reject()},_populatePaymeansList:function(a,b){this.set("payMeansVmStatus","payMeansReceived");var c=[];this.get("paymentMethodtype")==f.PAYMENT_METHOD.CC?c=this.getCreditCardList(b.PayMeans.card):this.get("paymentMethodtype")==f.PAYMENT_METHOD.DD?c=this.getBankAccountList(b.PayMeans.bankAccount):this.get("paymentMethodtype")==f.PAYMENT_METHOD.ALL&&(c=this.getCreditCardList(b.PayMeans.card),c=c.concat(this.getBankAccountList(b.PayMeans.bankAccount))),this.get("goodAccount")||this.set("isGiroActivated","NO"),this.set("payMeans",c),this.set("payMeansVmStatus","payMeansSet"),this.searchPaymeansDeferred.resolve()},getNewCreditCardUrl:function(){this.models.implInitiateUpdatePaymentModel.set({contactId:this.get("contactId")}),this.models.implInitiateUpdatePaymentModel.save(null,{success:b.bind(this._onCreditCardUrlReceived,this),error:b.bind(this._onCreditCardUrlFailure,this)}),this.set("payMeansVmStatus","getNewCCUrlInPreogress")},_onCreditCardUrlReceived:function(a,b){b&&b.ImplInitiateUpdatePaymentGatewayApiResponse.paymentEntryURL?(this.set("newCcRegistrationUrl",b.ImplInitiateUpdatePaymentGatewayApiResponse.paymentEntryURL),this.set("payMeansVmStatus","newCCUrlSet")):this.set("payMeansVmStatus","newCCUrlFailed")},_onCreditCardUrlFailure:function(a){this.set("payMeansVmStatus","newCCUrlFailed")},getCreditCardList:function(a){var b=[];if(a)for(var c=0;c<a.length;c++){var d=a[c];d.name=d.brand,d.brandDisplay=d.brand,d.itemType=f.PAYMENT_METHOD_ITEMTYPE.CREDIT_CARD,d.customerName=d.imprintedName,d.payMeanId=d.id,d.itemId=d.id,d.firstSixDigits=d.cardNumberX8.substring(0,4)+"-"+d.cardNumberX8.substring(4,6),b.push(d)}return b},getBankAccountList:function(a){var c=[];if(a)for(var c=[],d=0;d<a.length;d++){var e=a[d];e.itemType=f.PAYMENT_METHOD_ITEMTYPE.BANK_ACCOUNT,e.name=e.bankName,e.customerName=e.accountName,e.payMeanId=e.bankCode+e.accountNumber.slice(-4),b.isUndefined(e.accountNumber)||(e.lastFourDigits=e.accountNumber.slice(-4)),e.itemId=e.id,e.goodStatusX8=e.goodStatusX8,e.goodStatusX8&&1==e.goodStatusX8?(e.isDiscontinueAllowed=!1,this.set("goodAccount",e),this.set("isGiroActivated","YES")):this.set("isGiroActivated","NO"),c.push(e)}return c},payMeanFailure:function(a,b){this.set("payMeansVmStatus","payMeansFailed")},setAutoPayNewCard:function(){var a=this.get("customerId"),c=this.get("contactId");if(a&&c){this.set("payMeansVmStatus","createNewPaymensInProgress");var d=this.getCardDetaildFromPGData();this.set("newCreditCard",d.card),this.models.PayMeansModel.set({customerId:a,individualId:c,type:f.PAYMENT_METHOD_ITEMTYPE.CREDIT_CARD}),this.models.PayMeansModel.save({PayMeanDetails:d},{success:b.bind(this._contactPersonPayMeansOnSuccess,this),error:b.bind(this._contactPersonPayMeansOnError,this)})}},getCardDetaildFromPGData:function(){var a=this.get("pgInfo"),b={card:{brand:this.getCCBrand(a.cardType),imprintedName:a.imprintedName,validityMonth:a.expiryDate.substr(0,2),validityYear:a.expiryDate.substr(2),cardNumber:a.tokenCardNo,defaultPayMean:!0},authorizationNumberX8:a.authId};return b},getCCBrand:function(a){var b={MASTER:"M",VISA:"V",AMEX:"A",CITIBANK:"C","ST-UOB":"S"};return b[a]},_contactPersonPayMeansOnSuccess:function(a,b){var c=this.get("newCreditCard"),d=this.get("pgInfo");c.lastFourDigits=c.cardNumber.substr(-4),c.cardNumberX8=c.cardNumber,c.brand=d.cardType,c.id=b.ImplPostPaymentsAddPayMeansToPersonOutput.cardPayMeanId,c.itemType=f.PAYMENT_METHOD_ITEMTYPE.CREDIT_CARD,this.set("selectedPaymeans",c),this.set("payMeansVmStatus","createNewPaymensSuccess"),this.setAutoPayExistingCard()},_contactPersonPayMeansOnError:function(){this.set("payMeansVmStatus","createNewPaymensFailed")},setAutoPayExistingCard:function(){var a=this.get("selectedPaymeans"),c=this.models.implPayInstructionModel,d={personId:this.get("contactId"),card:{brand:this.getCCBrand(a.brand),imprintedName:a.imprintedName,validityMonth:a.validityMonth,validityYear:a.validityYear,number:a.cardNumberX8}},e=this.get("customerId"),f=this.subViewModels.implUserContextTopicViewModel.getValueByPath("userInfo.contactFinancialAccountDetails")||this.subViewModels.implUserContextTopicViewModel.getValueByPath("userInfo.financialAccounts");if(f&&f.length>0){var g=this.zeroPadding(this.get("faId"),8);if(g){var h=b.findWhere(f,{faId:g.toString()});h.faCustomerId&&(e=h.faCustomerId)}}c.set({contactId:this.get("contactId"),customerId:e,barId:this.get("barId"),faId:this.get("faId")}),c.setQueryParams({ap:!1}),c.save({AutoPaymentDetails:d},{success:b.bind(this._setAutoPayConfirmationOnSuccess,this),error:b.bind(this._setAutoPayConfirmationOnError,this)})},_setAutoPayConfirmationOnSuccess:function(a,b){this.set("payMeansVmStatus","autoPaymentSetSuccess")},_setAutoPayConfirmationOnError:function(a,b){this.set("payMeansVmStatus","autoPaymentSetError")},terminateGiro:function(){var a=this;a.set("payMeansVmStatus","terminateGiroInitialized");var b=this.get("goodAccount"),c={accountId:b.id,giroId:b.id};this.models.terminateGiroModel.set({customerId:this.get("customerId"),individualId:this.get("contactId")}),this.models.terminateGiroModel.save({ImplTerminateGOODRegistrationRestInput:c},{success:function(b,c){a.set("payMeansVmStatus","terminateGiroSuccess")},error:function(){a.set("payMeansVmStatus","terminateGiroError")}})},delinkPaymeans:function(){var a=(this.get("selectedPaymeansToRemove"),this.models.implPayInstructionModel);a.set({id:"pay-instruction",contactId:this.get("contactId"),customerId:this.get("customerId"),barId:this.get("barId"),faId:this.get("faId")}),a.destroy({success:b.bind(this.delinkPaymeansSuccess,this),error:b.bind(this.delinkPaymeansError,this)})},delinkPaymeansSuccess:function(a){this.set("payMeansVmStatus","delinkPaymeansSuccess")},delinkPaymeansError:function(a){this.set("payMeansVmStatus","delinkPaymeansError")},zeroPadding:function(a,b){a+="";for(var b=b-a.length,c=0;c<b;c++)a="0"+a;return a}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/EbillContextTopicViewModel",["lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b){var c=b.extend({persistent:["remindMeFlag"],defaults:{remindMeFlag:!1},subViewModels:{},dataBindings:[]});return c});
define("businesswidget/repository_l9_common/common/model/NotificationPreferencesModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"ebill/contact-person/:contactId/notification-preferences",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},read:{method:"GET"},create:{method:"POST",contentType:"application/json",payload:["ImplContactNotificationPreferences"]}}},name:b.get("ERROR_CONST").NOTIFICATION_PREFERENCE_RW})});
define("businesswidget/repository_l9_common/common/model/ImplCopyBillRestModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/customer/:customerId/billing-arrangement/:barId/copybill",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplCopyBillRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetHardCopyBillsModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/account/:accountId/billing-arrangement/:barId/bills/fromDate/:fromDate/toDate/:toDate/get-hard-copy-bills",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},method:"GET"}}},parse:function(a){var b=a.HardCopyBillsAmountValidResponse&&a.HardCopyBillsAmountValidResponse.docInfos?a.HardCopyBillsAmountValidResponse.docInfos:[];return _.each(b,function(a){a.interim="INCALL"==a.docDemandType}),b}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ChangeEbillPreferenceViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/EbillContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository_l9_common/common/model/CreateInteractionModel","businesswidget/repository_l9_common/common/model/NotificationPreferencesModel","businesswidget/repository_l9_common/common/model/UpdateDeliveryMethodModel","businesswidget/repository_l9_common/common/model/ImplCopyBillRestModel","businesswidget/repository_l9_common/common/model/GetHardCopyBillsModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=a.Core.ObservableViewModel.extend({models:{updateDeliveryMethod:l,viewUpdateCustomerProfileModel:i,createInteractionModel:j,notificationPreferencesModel:k,implSendNotificationModel:h,getHardCopyBillsModel:n,implCopyBillRestModel:m},subViewModels:{contactInContextTopicViewModel:e,customerInContextTopicViewModel:d,billingAccountSummary:g,ebillContextTopicViewModel:f,viewUpdateCustomerProfileWidgetViewModel:o},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{remindMeFlag:"subViewModels.ebillContextTopicViewModel.remindMeFlag",options:{twoWay:!0,setOnBind:!0}},{billingAccountSummaryStatus:"subViewModels.billingAccountSummary.billingAccountSummaryVmStatus",options:{twoWay:!1,setOnBind:!0}},{contactInfo:"subViewModels.viewUpdateCustomerProfileWidgetViewModel.contactInfo",options:{twoWay:!1,setOnBind:!0}}],defaults:{billingAccountSummaryStatus:"",changeEbillPreferenceVmStatus:"",showPopup:!1,selectedOption:"",requestedDuration:"",selectedAccount:null,hardCopyBills:[],templateId:null,implCopyBillRestInput:null,implCopyBillRestOutput:{successDocId:[],errorDocId:[],requestedDocId:[]},selectedDuration:{startDate:"",endDate:""},mailParameters:null,interactionId:null},initialize:function(a){$.when(this.subViewModels.billingAccountSummary.accountsSetDeferred).done(this.onAccountChange.bind(this))},isEbillNric:function(){var a=this.subViewModels.billingAccountSummary.get("accounts"),b=c.filter(a,function(a){return 0==a.isEasyMobile}),d=c.find(b,function(a){return"E_BILL"!==a.billType&&79===a.faStatus});return!d},onAccountChange:function(){var a=this.isEbillNric();this.set("showPopup",!a)},getCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},changeEbillPreference:function(){var a=this.get("selectedOption"),b={};switch(a){case"E_BILL":b.billType="E_BILL",b.deliveryMethod="METH_PAPER",b.intFlowType="ebill";break;case"METH_PAPER":b.billType="SUMMARY",b.intFlowType="prs";break;case"E_BILL_METH_NON_PAPER":b.billType="E_BILL",b.intFlowType="ebill",b.deliveryMethod="METH_NON_PAPER"}"NO_ACTION"==a?setTimeout(function(){this.set("changeEbillPreferenceVmStatus","changeEbillPreferenceSuccess")}.bind(this),0):this.saveEbillPreference(b)},saveEbillPreference:function(a){var b=[],d=this,e=this.subViewModels.billingAccountSummary.get("accounts"),f=a.intFlowType;delete a.intFlowType,e=c.filter(e,function(a){return 79===a.faStatus});var g=!1;e.length?(c.each(e,function(c){if(!c.isEasyMobile){var e=$.Deferred();d.models.updateDeliveryMethod.setQueryParams({intFlowType:f,skipNotification:g});var h="E_BILL"===c.billType?c.billType:a.billType?a.billType:c.billType;d.models.updateDeliveryMethod.save({customerId:c.customerId,faId:c.faid,barId:c.billingAccountNumber,ImplBillingDataInput:{barId:c.billingAccountNumber,deliveryMethod:a.deliveryMethod?a.deliveryMethod:c.deliveryMethod,billType:h,nickName:"Account Name"==c.nickName?"":c.nickName,avatarImageId:c.avatarImageId,mcssBillPassword:c.billPassword}},{success:function(a){return function(b){a.resolve()}}(e),error:function(a){return function(b){a.reject()}}(e)}),b.push(e),g=!0}}),$.when.apply(d,b).then(function(){if("E_BILL"==d.get("selectedOption")||"E_BILL_METH_NON_PAPER"==d.get("selectedOption")){var a=[];c.each(e,function(b){b.isEasyMobile||a.push({isSmsNotify:d.isValidContactMobileNumber(),barId:b.billingAccountNumber})}),d.models.notificationPreferencesModel.save({contactId:d.get("contactId"),ImplContactNotificationPreferences:{implBarNotificationPreferences:a,contactId:d.get("contactId")}},{success:function(a,b){d.set("changeEbillPreferenceVmStatus","notificationSet")},error:function(){d.set("changeEbillPreferenceVmStatus","notificationFailed")}})}d.subViewModels.billingAccountSummary.fetchData(),d.set("changeEbillPreferenceVmStatus","changeEbillPreferenceSuccess")},function(){d.set("changeEbillPreferenceVmStatus","changeEbillPreferenceError")})):setTimeout(function(){d.set("changeEbillPreferenceVmStatus","changeEbillPreferenceSuccess")},0)},isValidContactMobileNumber:function(){var a=this.getValueByPath("contactInfo");if(a){var b=a.phone;if(b.length>8)return!1;var c=/^[(]{0,1}[8|9]{1}[)]{0,1}[0-9]{3}[-\s.]{0,1}[0-9]{4}/;return c.test(b)}return!1},saveEbillPaperBillPreference:function(){var a=this,b=this.get("selectedAccount");a.models.updateDeliveryMethod.setQueryParams({intFlowType:"ebill"}),a.models.updateDeliveryMethod.save({customerId:b.customerId,faId:b.faid,barId:b.billingAccountNumber,ImplBillingDataInput:{barId:b.billingAccountNumber,deliveryMethod:b.deliveryMethod,billType:"E_BILL",nickName:b.nickName,avatarImageId:b.avatarImageId,mcssBillPassword:b.billPassword}},{success:function(b){a.set("changeEbillPreferenceVmStatus","changeEbillPaperBillPreferenceSuccess")},error:function(b){a.set("changeEbillPreferenceVmStatus","changeEbillPaperBillPreferenceError")}})},sendEmailToCustomer:function(){var a=this;a.createInteraction();var b=a.get("contactId");if(void 0!==b&null!==b){var d=a.getModel("viewUpdateCustomerProfileModel");d.set("id",b),d.fetch({success:c.bind(a.onFetchSuccess,a),error:function(){a.set("changeEbillPreferenceVmStatus","mailFailed")}})}},onFetchSuccess:function(a,b){var c=this,d=b.ImplContactPersonOutput.implContactPerson;"undefined"!=typeof d.emailId&&null!==d.emailId&&""!==d.emailId?c.sendEmail(d.emailId):c.set("changeEbillPreferenceVmStatus","mailFailed")},createInteraction:function(){var a=this,b={title:"Request Copy Bill",medium:"Self Service",channel:"Web",notes:"You have requested for a cop(ies) of your bill(s) for account "+a.get("selectedAccount").faid+" between "+a.get("requestedDuration")+". Please note there is a charge of $5.35 (incl. of GST) per copy of your bill(s), which will be reflected in your next Bill.",userId:"sa",direction:{value:"1"},endTime:(new Date).getTime()+9999,startTime:(new Date).getTime(),topic:[{reason1:"Billing",reason2:"RequestCopyBill",result:"NotApplicable",protocol:"SpringDigital"}],contactId:this.get("contactId")};this.models.createInteractionModel.save({contactId:this.get("contactId"),ImplCreateInteractionInput:b,success:function(b,c){c&&(a.set("interactionId",c),a.set("changeEbillPreferenceVmStatus","createInteractionSuccess"))},error:function(){a.set("changeEbillPreferenceVmStatus","createInteractionFailed")}})},sendEmail:function(a){var b=this,c=b.get("templateId"),d=b.get("mailParameters"),e=[{key:"table1Accounts",values:d[5].value.accounts},{key:"table1Months",values:d[5].value.months},{key:"table1Years",values:d[5].value.years}];d.length=5;var f={ImplSendNotificationRequest:{target:[a],templateId:c,notificationChannel:"EMAIL",templateSimpleParameters:d,templateListParameters:e,templateURLParameters:[]}};b.getModel("implSendNotificationModel").save(f,{success:function(a,c){b.set("changeEbillPreferenceVmStatus","mailSent")},error:function(a,c){b.set("changeEbillPreferenceVmStatus","mailFailed")}})},getHardCopyBills:function(){var a=this;a.set("changeEbillPreferenceVmStatus","getHardCopyBillsInProgress"),a.models.getHardCopyBillsModel.setQueryParams({hasDocInfo:!0});var b=a.get("selectedDuration");a.models.getHardCopyBillsModel.set({accountId:b.accountId,fromDate:b.startDate,toDate:b.endDate,barId:b.billingAccountNumber}),a.models.getHardCopyBillsModel.fetch({success:function(b,c){c&&c.HardCopyBillsAmountValidResponse?(a.set("hardCopyBills",c.HardCopyBillsAmountValidResponse.docInfos||[]),a.set("changeEbillPreferenceVmStatus","getHardCopyBillsSuccess")):a.set("changeEbillPreferenceVmStatus","getHardCopyBillsError")},error:function(){a.set("changeEbillPreferenceVmStatus","getHardCopyBillsError")}})},implCopyBillRest:function(){var a=this,d=a.get("implCopyBillRestInput");a.setValueByPath("implCopyBillRestOutput.errorDocId",[]),a.setValueByPath("implCopyBillRestOutput.requestedDocId",[]),a.setValueByPath("implCopyBillRestOutput.successDocId",[]);var e=c.pluck(c.filter(d.hardCopyBills,function(a){return a.selected}),"docId");a.setValueByPath("implCopyBillRestOutput.requestedDocId",e);a.set("changeEbillPreferenceVmStatus","implCopyBillRestInProgress"),a.models.implCopyBillRestModel.set({customerId:d.customerId,barId:d.barId});for(var f=b.get("printApiChunkSize")?b.get("printApiChunkSize"):3,g=[];e.length>0;)g.push(e.splice(0,f));var h=c.find(a.subViewModels.billingAccountSummary.get("accounts"),function(a){return a.billingAccountNumber===d.barId});h.physicalAddress.blockOrHouseAddr="APT Blk";for(var i in g){var j=[];for(var k in g[i])j.push({documentId:g[i][k]});var l=a.get("contactInfo"),m={barName:d.barName,contactName:l.name,contactSalutation:l.salutation,implPrintDocuments:j,implPhysicalAddress:h.physicalAddress};a.models.implCopyBillRestModel.save({ImplCopyBillRestInput:m},{success:function(b,d){if(d&&d.ImplCopyBillRestOutput){var d=d.ImplCopyBillRestOutput;if(d){if(d.successDocumentIds){a.setValueByPath("implCopyBillRestOutput.successDocId",a.getValueByPath("implCopyBillRestOutput.successDocId").concat(d.successDocumentIds));var e=a.getValueByPath("implCopyBillRestOutput.successDocId"),f=a.get("hardCopyBills");c.each(f,function(a){a.isPrintSuccess=c.contains(e,a.docId+"")}),a.set("hardCopyBills",f)}d.failedDocumentIds&&a.setValueByPath("implCopyBillRestOutput.errorDocId",a.getValueByPath("implCopyBillRestOutput.errorDocId").concat(d.failedDocumentIds))}a.set("changeEbillPreferenceVmStatus","implCopyBillRestSuccess")}},error:function(){a.set("changeEbillPreferenceVmStatus","implCopyBillRestError")}})}}});return p});
define("businesswidget/repository_l9_common/common/model/SearchAvailableMobileNumbersModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/sdp/manageResource/order-id/:orderId/order-item-id/:orderItemId/productId/:productID/searchmobilenumber",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},read:{method:"GET"},create:{method:"POST",payload:["ImplSearchAviableInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ImplReserveLogicalResourceModel",["underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"ecommerce/order/:orderId/order-item-id/:orderItemId/product-in-order/:productId/reserve-resource",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},read:{method:"GET"},create:{method:"PUT",payload:["ImplReserveResourceNumberRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/ChangeMobileNumberViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/SearchAvailableMobileNumbersModel","businesswidget/repository_l9_common/common/model/ImplReserveLogicalResourceModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","businesswidget/repository_l9_common/common/model/CreateInteractionModel","single!businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/ImplAssignedProductDetailsViewModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){return a.Core.ObservableViewModel.extend({models:{searchAvailableNumbersModel:e,reserveLogicalResourceModel:f,submitProductConfigurationModel:g,customerSubmitOrderModel:h,createInteractionModel:i,customerProductOrderProductOrderItemsModel:n,viewServiceListModel:j},subViewModels:{customerInContextTopicViewModel:c,contactInContextTopicViewModel:d,productInContextTopicViewModel:k,NotificationViewModel:m,implAssignedProductDetailsViewModel:l},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{customerIds:"subViewModels.customerInContextTopicViewModel.customerIds",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productId:"subViewModels.productInContextTopicViewModel.assignedProduct.id",options:{twoWay:!1,setOnBind:!0}},{subscriptionId:"subViewModels.productInContextTopicViewModel.assignedProduct.subscriptionId",options:{twoWay:!1,setOnBind:!0}},{selectedServiceId:"subViewModels.productInContextTopicViewModel.assignedProduct.serviceId",options:{twoWay:!1,setOnBind:!0}},{status:"subViewModels.productInContextTopicViewModel.assignedProduct.status",options:{twoWay:!1,setOnBind:!0}},{productDetails:"subViewModels.implAssignedProductDetailsViewModel.assignedProductDetails",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,customerIds:null,contactId:null,changeMobileNumberVmStatus:null,receivedNumberList:null,sign:null,selectedNumber:null,productId:null,orderId:null,orderIds:null,allServices:null,selectedServiceId:null,productOrderItemID:null,productOrderReferenceNumber:null},initialize:function(){this._super(),this.on("change:customerIds",this.loadServices,this),setTimeout(function(){this.set("changeMobileNumberVmStatus","changeMobileNumberInitialized")}.bind(this,0))},config:{actions:{updateStatus:function(){var a=this,c=this.get("selectedNumber"),d=b.filter(a.get("receivedNumberList"),function(a){if(c!=a)return a}),e={resourceNumber:c,numbersToBeReleased:d,resourceType:"WIRELESS",signature:a.get("sign")};a.models.reserveLogicalResourceModel.set({orderId:a.get("orderIds"),orderItemId:a.get("productOrderItemID"),productId:a.get("productId")}),a.models.reserveLogicalResourceModel.save({ImplReserveResourceNumberRequest:e},{success:b.bind(a._updateStatusSuccess,a),error:function(){a.set("changeMobileNumberVmStatus","updateStatusFailed"),a.handleAction("cancelOrder")}})},updateProductConfig:function(){var a=this;a.set("changeMobileNumberVmStatus","updateProductConfigInitialized");var c=a.createInputPayload();this.getModel("submitProductConfigurationModel").set({contactId:this.get("contactId"),customerId:this.get("customerId"),productId:this.get("productId")}),this.getModel("submitProductConfigurationModel").save(c,{success:b.bind(a._updateProductConfigSuccess,a),error:function(){a.set("changeMobileNumberVmStatus","updateProductConfigFailed")}})},createInteraction:function(){var a={title:"update contact",medium:"Self Service",channel:"Web",notes:"Mr.",userId:"sa",direction:{value:"1"},endTime:(new Date).getTime()+9999,startTime:(new Date).getTime(),topic:[{reason1:"MyAccount",reason2:"ChangeMobileNumber",result:"NotApplicable",protocol:"SpringDigital"}],contactId:this.get("contactId")};this.models.createInteractionModel.save({contactId:this.get("contactId"),ImplCreateInteractionInput:a,success:function(a,b){b&&self.set("changeMobileNumberVmStatus","createInteractionSuccess")}.bind(self),error:function(){self.set("changeMobileNumberVmStatus","createInteractionFailed")}})},getAllMobileNumber:function(){var a=this;this.models.searchAvailableNumbersModel.set({orderId:this.get("contactId"),orderItemId:this.get("contactId"),productID:this.get("productId")});var b={type:"WIRELESS",numberOfResources:40,mobileBBRequired:!1};this.models.searchAvailableNumbersModel.save({ImplSearchAviableInput:b},{success:function(b,c){if(void 0!==typeof c){var d=c.ImplSearchAviableOutput.reservedNumbers;a.set("sign",c.ImplSearchAviableOutput.signature),a.set("receivedNumberList",d),a.set("changeMobileNumberVmStatus","mobileListSetSuccessfully")}else a.set("changeMobileNumberVmStatus","mobileListEmpty")},error:function(){a.set("changeMobileNumberVmStatus","mobileListEmpty")}})},cancelOrder:function(){var a=this,b=a.get("orderIds");if(null!==b){var c=a.getModel("customerProductOrderProductOrderItemsModel");c.set("productOrderId",b),c.set("customerId",a.get("customerId"));var d=[];d.push(a.get("productOrderItemID")),c.setQueryParams({poi:d}),c.set("id",d),c.destroy({success:function(){a.set("changeMobileNumberVmStatus","orderCancellationSuccess")},error:function(){a.set("changeMobileNumberVmStatus","orderCancelationFaild")}})}}}},loadServices:function(){var a=this,c=[],d=this.get("customerIds"),e=a.get("prevCustomerIds");b.isEqual(e,d)||(b.each(d,function(d){var e=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:d,success:b.bind(a.onLoadServicesSuccess,a,e,d),error:function(a){a.resolve()}.bind(a,e)}),c.push(e)}),$.when.apply(a,c).done(function(){a.set("changeMobileNumberVmStatus","allServicesFetched")}),a.set("prevCustomerIds",d))},onLoadServicesSuccess:function(a,b,c,d){var e=this.get("allServices")||{},f=d.Products.products;e[b]=f,this.set("allServices",e),this.set("changeMobileNumberVmStatus","servicesListFetched"),a.resolve()},submitOrder:function(){var a=this;a.getModel("customerSubmitOrderModel").setQueryParams({id:this.get("customerId"),orderIds:a.get("productOrderReferenceNumber")}),a.getModel("customerSubmitOrderModel").set({customerId:this.get("customerId")}),a.getModel("customerSubmitOrderModel").save(null,{success:b.bind(this._submitOrderSuccess,this,a.get("productOrderReferenceNumber")),error:function(){a.set("changeMobileNumberVmStatus","submitOrderFailed"),a.handleAction("cancelOrder")}})},_updateStatusSuccess:function(a,b){b&&"BLOCKING"!==b.ImplReserveAndUpdateResourceResponse.resourceUpdateStatus?(this.submitOrder(),this.set("changeMobileNumberVmStatus","updateStatusSuccess")):(this.handleAction("cancelOrder"),this.set("changeMobileNumberVmStatus","updateStatusFailed"))},_updateProductConfigSuccess:function(a,b){var b=b.ImplSubmitProductConfigurationRestOutput;this.set("orderIds",b.updateProductConfigurationResponse.productOrderID),this.set("productOrderItemID",b.updateProductConfigurationResponse.productOrderItemID),this.set("productOrderReferenceNumber",b.updateProductConfigurationResponse.productOrderReferenceNumber),this.set("changeMobileNumberVmStatus","updateProductConfigSuccess")},_submitOrderSuccess:function(a,b,c){var c=c.SubmitOrderResponse;c?(this.set("orderId",a),this.set("changeMobileNumberVmStatus","submitOrderSuccess"),this.sendNotification()):(this.handleAction("cancelOrder"),this.set("changeMobileNumberVmStatus","submitOrderFailed"))},createInputPayload:function(a){for(var c=0,d=this.get("productDetails"),e=0;e<d.services.length;e++){var f=b.find(d.services[e].parameters,function(a){return"132395"===a.catalogId});if(f){c=d.services[e].id;break}}var g={updateProductConfigurationRequest:{returnRemovedItems:!1,configurationLevel:"FULL",runCompatibilityRules:!1,confirmationMessagesApproved:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0},submitProductOrder:!1,settingsView:"FULL",productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:[{productID:this.get("productId"),changedCharacteristics:[{characteristicID:"2409309",value:""}]}],newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],orderActionReasonX8:"CREQ",orderActionTypeX8:"CH"}};return{ImplSubmitProductConfigurationRestInput:g}},sendNotification:function(){this.subViewModels.NotificationViewModel.getInteractionData().then(function(a){var b,c,d,e=[];a=a.CHANGE_MOBILE_NUMBER,b=a.title,c=a.topic,e=[this.get("selectedServiceId"),this.get("selectedNumber")],d=this.subViewModels.NotificationViewModel.getKeyMapping(a.description,e),this.subViewModels.NotificationViewModel.createInteraction(b,c,d)}.bind(this))}})});
define("businesswidget/repository_l9_common/common/model/CreateOrderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"ordering/createOrder",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplCreateOrderInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/SuspendServiceViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/CreateOrderModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","businesswidget/repository_l9_common/common/model/CreateInteractionModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","moment"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){
return a.Core.ObservableViewModel.extend({models:{createOrderModel:f,customerSubmitOrderModel:g,implSendNotificationModel:j,viewUpdateCustomerProfileModel:k,customerProductOrderProductOrderItemsModel:l,createInteractionModel:h,updateProductOrderModel:m,implSubmitProductConfigurationModel:n},subViewModels:{customerInContextTopicViewModel:d,contactInContextTopicViewModel:e,productInContextTopicViewModel:i,NotificationViewModel:o},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productId:"subViewModels.productInContextTopicViewModel.assignedProduct.id",options:{twoWay:!1,setOnBind:!0}},{selectedServiceId:"subViewModels.productInContextTopicViewModel.assignedProduct.serviceId",options:{twoWay:!1,setOnBind:!0}},{subscriptionId:"subViewModels.productInContextTopicViewModel.assignedProduct.subscriptionId",options:{twoWay:!1,setOnBind:!0}},{staus:"subViewModels.productInContextTopicViewModel.assignedProduct.status",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,suspendServiceVmStatus:null,productId:null,orderId:null,recurringCharges:null,selectedServiceId:null,userSelection:null,dates:null,orderIds:null,templateId:null,productOrderItemID:null,deviceCareComp:null,deviceCareOrderId:null,deviceCareProductOrderItemReferenceNumber:null,deviceCareProductOrderReferenceNumber:null},initialize:function(){this._super(),c.bindAll(this,"setHeaders","setDefaultQueryParams","onUpdateOrderSuccess"),this.set("suspendServiceVmStatus","suspendServiceInitialized")},config:{actions:{sendEmailToCustomer:function(){var a=this,b=a.get("contactId");if(void 0!==b&null!==b){var d=a.getModel("viewUpdateCustomerProfileModel");d.set("id",b),d.fetch({success:c.bind(a.onFetchSuccess,a),error:function(){a.set("suspendServiceVmStatus","mailFailed")}})}},updateProductConfig:function(){var a=this;a.set("suspendServiceVmStatus","UPCInitialized");var b={ImplCreateOrderInput:{customerId:this.get("customerId"),orderActionType:"SU",assignedProductId:this.get("productId"),orderActionReason:this.get("userSelection")}};"VOL"==this.get("userSelection")&&(b.ImplCreateOrderInput.serviceRequiredDate=this.get("dates").startDate,b.ImplCreateOrderInput.futureResumeDate=this.get("dates").endDate),this.getModel("createOrderModel").save(b,{success:c.bind(a._updateProductConfigSuccess,a),error:function(){a.set("suspendServiceVmStatus","updateProductConfigFailed")}})},submitOrder:function(){var a=this;return a.set("suspendServiceVmStatus","submitOrderInitialized"),a.getModel("customerSubmitOrderModel").setQueryParams({id:this.get("customerId"),orderIds:this.get("orderIds")}),a.getModel("customerSubmitOrderModel").set({customerId:this.get("customerId")}),a.getModel("customerSubmitOrderModel").save(null,{success:c.bind(this._submitOrderSuccess,this),error:function(){a.set("suspendServiceVmStatus","submitOrderFailed"),a.handleAction("cancelOrder")}})},createInteraction:function(){var a=this,b={title:"update contact",medium:"Self Service",channel:"Web",notes:"Mr.",userId:"sa",direction:{value:"1"},endTime:(new Date).getTime()+9999,startTime:(new Date).getTime(),topic:[{reason1:"BillExplanation",reason2:"BillAccountBillID",result:"CreateCase",protocol:"BillingHD"}],contactId:this.get("contactId")};this.models.createInteractionModel.save({contactId:this.get("contactId"),ImplCreateInteractionInput:b,success:function(b,c){c&&a.set("suspendServiceVmStatus","createInteractionSuccess")},error:function(){a.set("suspendServiceVmStatus","createInteractionFailed")}})}}},cancelOrder:function(){var a=this,b=a.get("orderIds");if(null!==b){var c=a.getModel("customerProductOrderProductOrderItemsModel");c.set("productOrderId",b),c.set("customerId",a.get("customerId"));var d=[];d.push(a.get("productOrderItemID")),c.setQueryParams({poi:d}),c.set("id",d),c.destroy({success:function(){a.set("suspendServiceVmStatus","orderCancellationSuccess")},error:function(){a.set("suspendServiceVmStatus","orderCancelationFaild")}})}},removeDeviceCare:function(){this.set("suspendServiceVmStatus","removeDeviceCareInitialized");var a=this.get("deviceCareComp"),b=this.getBlankOrderInput(),d=[{productSpecContainmentID:a.catalogItemID,productID:a.id}],e=c.map(a.pricePackages,function(a){return{billingOfferID:a.id,parentProductID:a.parent}});b.productChanges[0].removedContainedProducts=d,b.productChanges[0].removedAssignedBillingOffers=e,this.createOrderForRemoveDeviceCare(b).then(function(a){this.set("suspendServiceVmStatus","createOrderForRemoveDeviceCareSuccess");var b=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse;this.set("orderIds",b.productOrderID),this.set("productOrderItemID",b.productOrderItemID),this.set("deviceCareProductOrderReferenceNumber",b.productOrderReferenceNumber),this.set("deviceCareProductOrderItemReferenceNumber",b.productOrderItemReferenceNumber),this.runUPCWithRules()}.bind(this)),console.log(b)},createOrderForRemoveDeviceCare:function(a){this.set("suspendServiceVmStatus","createOrderForRemoveDeviceCareInProgress");var b=(this.getBlankOrderInput(),{updateProductConfigurationRequest:a,subscriberId:this.get("subscriptionId")}),d=this.getModel("implSubmitProductConfigurationModel"),e={contactId:this.get("contactId"),customerId:this.get("customerId"),productId:this.get("productId")};return d.set(e),d.save({ImplSubmitProductConfigurationRestInput:b},{error:c.bind(this.onProductConfigurationError,this)})},onProductConfigurationError:function(a,b,c){this.set("suspendServiceVmStatus","updateProductConfigFailed")},runUPCWithRules:function(){var a=this.getModel("updateProductOrderModel");a.set({customerId:this.get("customerId"),productOrderItemId:this.get("productOrderItemID")}),a.setQueryParams({rp:!1,rpc:!1});var b=this.createInputPayloadforUpdate();return a.save(b,{success:c.bind(this.upcSuccess,this),error:function(){this.cancelOrder(),this.set("suspendServiceVmStatus","updateProductConfigFailed")}.bind(this)})},upcSuccess:function(a,b){var c=b.UpdateProductInOrderConfigurationResponse.productConfiguration,d=this.getErrorsFromUpdateProductConfiguration(c);if(d.isError)this.set("errorObj",d),this.set("suspendServiceVmStatus","updateProductConfigFailed"),this.cancelOrder();else{var e=this.getModel("customerSubmitOrderModel");e.setQueryParams({orderIds:this.get("deviceCareProductOrderReferenceNumber")}),e.set({customerId:this.get("customerId")}),e.save().then(function(){this.set("suspendServiceVmStatus","UpdateAssignedProductConfigurationSuccess")}.bind(this),function(){this.cancelOrder(),this.set("suspendServiceVmStatus","updateProductConfigFailed")}.bind(this))}},getErrorsFromUpdateProductConfiguration:function(a){var b=a.messages,d={isError:!1,messages:[]};return b&&c.each(b,function(a){"ERROR"===a.severity&&(d.isError=!0,d.messages.push(a.text))}),d},createInputPayloadforUpdate:function(){var a={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"NOT_SELECTED",settingsView:"QUICK_SETTINGS",updateEvenIfNotValid:!1,returnConfiguration:"NONE",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return a},getBlankOrderInput:function(){var a={removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]},b={runCompatibilityRules:!1,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",submitProductOrder:!1,productChanges:[a],returnConfigurationData:{catalogDataInd:!1,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}};return b},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onFetchSuccess:function(a,b){var c=this,d=b.ImplContactPersonOutput.implContactPerson;"undefined"!=typeof d.emailId&&null!==d.emailId&&""!==d.emailId?c.sendEmail(d.emailId):c.set("suspendServiceVmStatus","mailFailed")},sendEmail:function(a){var b=this,c=b.get("templateId"),d=[],e={ImplSendNotificationRequest:{target:[a],templateId:c,notificationChannel:"EMAIL",templateSimpleParameters:d,templateURLParameters:[]}};b.getModel("implSendNotificationModel").save(e,{success:function(a,c){b.set("suspendServiceVmStatus","mailSent")},error:function(a,c){b.set("suspendServiceVmStatus","mailSent")}})},_updateProductConfigSuccess:function(a,b){var d=this,b=b.ImplCreateOrderRestOutput;this.set("orderIds",b.restOrderoutput.referenceNumber),this.set("orderId",b.orderId),this.set("recurringCharges",b.restOrderoutput.recurringPrice.finalAmountWithTax),this.set("productOrder",b),this.set("productOrderItemID",b.restOrderoutput?b.restOrderoutput.orderItems[0].id:0);var a=d.getModel("updateProductOrderModel");d.setHeaders(a),d.setDefaultQueryParams(a),a.setQueryParams({rp:!1,rpc:!1}),a.set({customerId:d.get("customerId"),productOrderItemId:d.get("productOrderItemID")});var e=b.restOrderoutput.orderItems[0].productID,f={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[{productID:e}],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};a.save(f,{success:c.bind(d.onUpdateOrderSuccess,d),error:function(){d.set("suspendServiceVmStatus","updateProductConfigFailed")}})},onUpdateOrderSuccess:function(a,b){var c=this,d=b.UpdateProductInOrderConfigurationResponse.productConfiguration;"BLOCKING"===d.compatibilityStatus?c.set("suspendServiceVmStatus","updateProductConfigFailed"):c.set("suspendServiceVmStatus","updateProductConfigSuccess")},_submitOrderSuccess:function(a,b){this.set("suspendServiceVmStatus","submitOrderSuccess"),this.subViewModels.NotificationViewModel.getInteractionData().then(function(a){var b,c,d,e=[];"VOL"===this.get("userSelection")?(a=a.TOS_VOL,b=a.title,c=a.topic,e=[p(this.get("dates").startDate).utc().format("DD-MMM-YY"),p(this.get("dates").endDate).utc().format("DD-MMM-YY"),this.get("selectedServiceId")]):(a=a.TOS_LOST,b=a.title,c=a.topic,e=["TOS",this.get("selectedServiceId")]),d=this.subViewModels.NotificationViewModel.getKeyMapping(a.description,e),this.subViewModels.NotificationViewModel.createInteraction(b,c,d)}.bind(this))}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ResumeServiceViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/CreateOrderModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/model/CreateInteractionModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","Configuration","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m){return a.Core.ObservableViewModel.extend({models:{createOrderModel:e,customerSubmitOrderModel:f,createInteractionModel:h,cancelOrderModel:g,updateProductOrderModel:j,customerRPCModel:l},subViewModels:{customerInContextTopicViewModel:c,contactInContextTopicViewModel:d,productInContextTopicViewModel:i,NotificationViewModel:m},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productId:"subViewModels.productInContextTopicViewModel.assignedProduct.id",options:{twoWay:!1,setOnBind:!0}},{subscriptionId:"subViewModels.productInContextTopicViewModel.assignedProduct.subscriptionId",options:{twoWay:!1,setOnBind:!0}},{selectedServiceId:"subViewModels.productInContextTopicViewModel.assignedProduct.serviceId",options:{twoWay:!1,setOnBind:!0}},{staus:"subViewModels.productInContextTopicViewModel.assignedProduct.status",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,resumeServiceVmStatus:null,productId:null,selectedServiceId:null,orderId:null,productOrderItemID:null,adminCharges:null,penaltyCharges:null},initialize:function(){this._super(),b.bindAll(this,"_updateProductConfigSuccess","_submitOrderSuccess","setHeaders","setDefaultQueryParams","createInputPayloadforUpdate","updateSuccess","updateOrderWithRules","createInputPayloadforRPC"),setTimeout(function(){this.set("resumeServiceVmStatus","resumeServiceInitialized")}.bind(this))},config:{actions:{updateProductConfig:function(){var a=this,c={ImplCreateOrderInput:{customerId:this.get("customerId"),orderActionType:"RS",assignedProductId:this.get("productId"),orderActionReason:"CREQ"}};this.getModel("createOrderModel").save(c,{success:b.bind(a._updateProductConfigSuccess,a),error:function(){a.set("resumeServiceVmStatus","updateProductConfigFailed")}})},submitOrder:function(){var a=this;a.getModel("customerSubmitOrderModel").setQueryParams({id:this.get("customerId"),orderIds:this.get("orderIds")}),a.getModel("customerSubmitOrderModel").set({customerId:this.get("customerId")}),a.getModel("customerSubmitOrderModel").save(null,{success:b.bind(this._submitOrderSuccess,this),error:function(){a.set("resumeServiceVmStatus","submitOrderFailed"),a.handleAction("cancelOrder")}})},cancelOrder:function(){var a=this,b=a.get("orderIds");if(null!==b){var c=a.getModel("cancelOrderModel");c.set("productOrderId",b),c.set("customerId",a.get("customerId")),a.setDefaultQueryParams(c);var d=[];d.push(a.get("productOrderItemID")),c.setQueryParams({poi:d}),c.set("id",d),c.destroy({success:function(b,c){a.set("resumeServiceVmStatus","resumeServiceOrderCancelSuccess")},error:function(b,c){a.set("resumeServiceVmStatus","resumeServiceOrderCancelFailed")}})}},createInteraction:function(){var a=this,b={title:"update contact",medium:"Self Service",channel:"Web",notes:"Mr.",userId:"sa",direction:{value:"1"},endTime:(new Date).getTime()+9999,startTime:(new Date).getTime(),topic:[{reason1:"BillExplanation",reason2:"BillAccountBillID",result:"CreateCase",protocol:"BillingHD"}],contactId:this.get("contactId")};this.models.createInteractionModel.save({contactId:this.get("contactId"),ImplCreateInteractionInput:b,success:function(b,c){c&&a.set("resumeServiceVmStatus","createInteractionSuccess")}.bind(a),error:function(){a.set("resumeServiceVmStatus","createInteractionFailed")}})}}},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var c=a.getDataSource().methods.defaults.qParams;c||(c={}),a.getDataSource().methods.defaults.qParams=b.extend(c,{lo:k.get("defaultLocale")||c.locale,sc:this.get("sc")||c.sc})},_updateProductConfigSuccess:function(a,c){var d=this,c=c.ImplCreateOrderRestOutput;d.set("orderIds",c.restOrderoutput.referenceNumber),d.set("orderId",c.orderId),d.set("productOrder",c),d.set("productOrderItemID",c.restOrderoutput.orderItems[0].id);var a=d.getModel("customerRPCModel"),e=d.createInputPayloadforRPC();a.set({productOrderItemId:d.get("productOrderItemID"),customerId:d.get("customerId")}),a.setQueryParams({rp:!1,rpc:!1}),a.set("RetrieveProductInOrderConfigurationRequest",e),d.setHeaders(a),d.setDefaultQueryParams(a),a.fetch({success:b.bind(d.updateOrderWithRules,d),error:function(){d.set("resumeServiceVmStatus","updateProductConfigFailed"),d.handleAction("cancelOrder")}})},createInputPayloadforRPC:function(){var a={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}};return a},updateOrderWithRules:function(a,c){var d=c.RetrieveProductInOrderConfigurationResponse,e=this,f=e.get("adminCharges"),g=this.getModel("updateProductOrderModel");g.set({customerId:e.get("customerId"),productOrderItemId:e.get("productOrderItemID")}),e.setHeaders(a),e.setDefaultQueryParams(a),g.setQueryParams({rp:!1,rpc:!1});var h,i=b.filter(d.productConfiguration.displayableItems,function(a){return"8363682"===a.productSpecContainmentID});i&&i.length>0&&b.each(i[0].displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&a.productSpecPricing.childPricingSchema.id===f&&(h=a.productSpecPricingID)});var j=e.createInputPayloadforUpdate(h);g.save(j,{success:e.updateSuccess,error:function(){e.set("resumeServiceVmStatus","updateProductConfigFailed"),e.handleAction("cancelOrder")}})},updateSuccess:function(a,b){var c=this;b.UpdateProductInOrderConfigurationResponse.productConfiguration.totalOneTimeCalculatedPrice&&c.set("penaltyCharges",b.UpdateProductInOrderConfigurationResponse.productConfiguration.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0),c.set("resumeServiceVmStatus","updateProductConfigSuccess")},_submitOrderSuccess:function(a,b){this.set("resumeServiceVmStatus","submitOrderSuccess"),this.subViewModels.NotificationViewModel.getInteractionData().then(function(a){var b,c,d,e=[];a=a.RECONNECT,b=a.title,c=a.topic,e=[this.get("selectedServiceId")],d=this.subViewModels.NotificationViewModel.getKeyMapping(a.description,e),this.subViewModels.NotificationViewModel.createInteraction(b,c,d)}.bind(this))},createInputPayloadforUpdate:function(a){var b=[];a&&b.push({productSpecPricingID:a});var c={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:b,newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return c}})});
define("businesswidget/repository_l9_common/common/model/SaveTweakProductModal",["businesswidget/repository/common/core/RESTModel","lightsaber","Configuration"],function (a,b,c){return a.extend({options:{url:"commerce/customer/:customerId/product/:productId/product-configuration",rest:{defaults:{method:"PUT",contentType:"application/json",payload:["UpdateProductConfigurationRequest"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"PUT"}}},name:c.get("ERROR_CONST").SUBMIT_TWEAK_PLAN})});
define("businesswidget/repository_l9_common/common/viewmodel/business/TweakEasyMobilePlanViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/SaveTweakProductModal","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel"],function (a,b,c,d,e){var f=a.Core.ObservableViewModel.extend({defaults:{customerId:null,productId:null,catalogItemId:null,tweakEasyMobilePlanVmStatus:null,easyMobilePlans:null,originalPlan:null},models:{saveTweakProductModal:d},subViewModels:{NotificationViewModel:e},dataBindings:[],initialize:function(){this._super(),this.set("tweakEasyMobilePlanVmStatus","tweakEasyMobilePlanVmInitialized")},createEasyMobileOrder:function(){this.set("tweakEasyMobilePlanVmStatus","tweakEasyMobilePlanCreateOrder"),this.models.saveTweakProductModal.set({customerId:this.get("customerId"),productId:this.get("productId")}),this.models.saveTweakProductModal.save({UpdateProductConfigurationRequest:this.createPayload()},{success:c.bind(this.onProductOfferingInstanceSuccess,this),error:c.bind(this.onProductOfferingInstanceError,this)})},createPayload:function(){var a=this.get("easyMobilePlans"),b=[{temporaryID:"c"+Math.random().toString(36).substr(2,9),productID:this.get("catalogItemId"),changedCharacteristics:[{characteristicID:8192,value:a.talktime.unit},{characteristicID:8202,value:a.sms.unit},{characteristicID:8212,value:a.data.unit}]}],c={links:[],confirmationMessagesApproved:!1,runCompatibilityRules:!1,productChanges:[{links:[],resumedContainedProducts:[],newAssignedBillingOffers:[],changedContainedProducts:b,newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],returnConfigurationData:{quotedPricesInd:!0},submitProductOrder:"true"};return c},onProductOfferingInstanceSuccess:function(a,b,c){this.set("tweakEasyMobilePlanVmStatus","tweakEasyMobilePlanSuccess"),this.sendNotification()},onProductOfferingInstanceError:function(a,b,c){this.set("tweakEasyMobilePlanVmStatus","tweakEasyMobilePlanError")},sendNotification:function(){this.subViewModels.NotificationViewModel.getInteractionData().then(function(a){var b,c,d,e=[],f=this.get("easyMobilePlans"),g=this.get("originalPlan");a=a.EASY_MOB_TWEAK,b=a.title,c=a.topic,e=[g.serviceId,g.units.voiceUnits,f.talktime.unit,g.units.smsUnits,f.sms.unit,g.units.dataUnits,f.data.unit],d=this.subViewModels.NotificationViewModel.getKeyMapping(a.description,e),this.subViewModels.NotificationViewModel.createInteraction(b,c,d)}.bind(this))}});return f});
define("businesswidget/repository_l9_common/common/model/SendEmailModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"sendmail/:customerId/:contactId",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")},method:"POST",contentType:"application/json",payload:[""]}}}})});
define("businesswidget/repository_l9_common/common/model/ValidateEmailModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"validatemail/:customerId/:contactId",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")},method:"POST",contentType:"application/json",payload:[""]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/EmailVerificationViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/SendEmailModel","businesswidget/repository_l9_common/common/model/ValidateEmailModel"],function (a,b,c,d,e,f){return a.Core.ObservableViewModel.extend({models:{sendEmailModel:e,validateEmailModel:f},subViewModels:{customerInContextTopicViewModel:c,contactInContextTopicViewModel:d},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,verificationVmStatus:null},initialize:function(){this._super(),this.set("verificationVmStatus","emailVerificationInitialized")},config:{actions:{sendMail:function(){var a=this;this.models.sendEmailModel.set({customerId:this.get("customerId"),contactId:this.get("contactId")}),this.models.sendEmailModel.save({payload:"abc"},{success:function(b,c){a.set("verificationVmStatus","emailSent")},error:function(b,c){a.set("verificationVmStatus","emailSendingError")}})},validateToken:function(){var a=this;a.set("verificationVmStatus","verificationInProgress"),this.models.validateEmailModel.set({customerId:this.get("customerId"),contactId:this.get("contactId")}),this.models.validateEmailModel.save({payload:"abc"},{success:function(b,c){a.set("verificationVmStatus","validateSuccess")},error:function(b,c){a.set("verificationVmStatus","validateError")}})}}}})});
define("businesswidget/repository_l9_common/common/model/ContactReContractModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/commerce/contact-person/:contactId/recontract-product-details",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},read:{method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/UpdateContactModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/shoppingcart/customer/:customerId/order/:orderId/add-customer-contact",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplAddCustomerContactRestInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/SimOnlyPlanViewModel",["lightsaber","Configuration","underscore","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f){return a.Core.ObservableViewModel.extend({defaults:{accountNo:null,accountProductID:null,existingAddonList:null,allProductsDetails:null,existingBillingOfferList:null,compatibleAddonList:null},models:{customerUPCModel:d,anonymousUPCModel:e},subViewModels:{deviceIdAndPlanIdInContextTopic:f},dataBindings:[],initialize:function(a){this._super(a),c.bindAll(this,"updateAddonDetailsOrder","createInputPayload","loadBillingOffers","getBillingOfferToBeAdded","generateTemporaryId","_updateProductConfiguration","setHeaders","setDefaultQueryParams","onUpdateSuccess","onUpdateFailure","identifyExistingServicesAddons")},onUpdateSuccess:function(a,b,c){a.resolve(c)},onUpdateFailure:function(a,b,c){a.reject("failed")},getBillingOfferToBeAdded:function(a,b,d){return c.contains(d,a.productSpecContainmentID)?billingOfferToBeAdded={productSpecPricingID:a.productSpecPricingID,parentProductSpecContainmentID:a.productSpecContainmentID,parentTemporaryID:b}:billingOfferToBeAdded={productSpecPricingID:a.productSpecPricingID,parentProductID:a.productID,parentProductSpecContainmentID:a.productSpecContainmentID},billingOfferToBeAdded},getBillingOfferToBeRemoved:function(a){return billingOfferToBeRemoved={billingOfferID:a.billingOfferID,productSpecPricingID:a.productSpecPricingID}},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},updateAddonDetailsOrder:function(a,b,d,e){var f,g,h=this,i=[],j=[],k=a.CreateNewOfferingConfigurationResponse,l=null;"undefined"==typeof k||null===k?(k=a.updateProductConfigurationResponse,f=k.productsInReplaceProductOffering[0].products[0].productConfiguration.displayableItems,g=k.productsInReplaceProductOffering[0].products[0].productOrderItemID,l=k.productsInReplaceProductOffering[0].products[0].productConfiguration.serviceID):(f=k.newProductsInNewOfferings[0].productConfiguration.displayableItems,g=k.newProductsInNewOfferings[0].productOrderItemID),l&&this.identifyExistingServicesAddons(l);var m=[],n=[],o=[],p=[],q=[],r=$.Deferred();if(b&&b.length>0)if(h.loadBillingOffers(f,b,m,n),m.length>0){h.get("existingAddonList")&&h.get("compatibleAddonList")&&(h.loadBillingOffersToRemove(f,h.get("existingAddonList"),o,p),c.each(o,function(a){var b=h.getBillingOfferToBeRemoved(a);q.push(b)}),console.log("existingAssignedBillingOffers",q)),c.each(m,function(a){var b=h.generateTemporaryId();if("undefined"==typeof a.productID||null===a.productID||c.contains(d,a.productSpecContainmentID)){var e={productSpecContainmentID:a.productSpecContainmentID,temporaryID:b,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID};j.push(e)}var f=h.getBillingOfferToBeAdded(a,b,d);i.push(f)});var s=h.createInputPayload(j,i,q);h._updateProductConfiguration(s,e,g,r)}else r.resolve("success");else r.resolve("success");return r},_updateProductConfiguration:function(a,b,d,e){var f=this;return"undefined"!=typeof b&&null!==b&&""!==b?(model=f.getModel("customerUPCModel"),model.set({customerId:b,productOrderItemId:d})):(model=f.getModel("anonymousUPCModel"),model.set({productOrderItemId:d})),f.setHeaders(model),f.setDefaultQueryParams(model),model.setQueryParams({rp:!1,rpc:!1}),model.save(a,{success:c.bind(f.onUpdateSuccess,f,e),error:c.bind(f.onUpdateFailure,f,e)}),e},loadBillingOffers:function(a,b,d,e){var f=this,g=f.get("accountNo");d.length<b.length&&c.each(a,function(a){g&&("Singtel Energy Plan"===a.name||"18645511"===a.productSpecContainmentID)&&a.selected&&f.set("accountProductID",a.productID),d.length<b.length&&(a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(f){if(f){var g=f.productSpecPricing.childPricingSchema.id;c.contains(b,g)&&!c.contains(e,g)&&(d.push({productSpecPricingID:f.productSpecPricingID,productSpecContainmentID:a.productSpecContainmentID,productID:a.productID,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID}),e.push(f.productSpecPricing.childPricingSchema.id))}}),a.displayableItems&&a.displayableItems.length>0&&f.loadBillingOffers(a.displayableItems,b,d,e))})},loadBillingOffersToRemove:function(a,b,d,e){var f=this,g=this.get("compatibleAddonList"),h=c.intersection(b,g);
a&&b&&c.each(a,function(a){a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(b){if(b&&b.selected){var f=b.productSpecPricing.childPricingSchema.id;c.contains(h,f)&&!c.contains(e,f)&&(d.push({productSpecPricingID:b.productSpecPricingID,productSpecContainmentID:a.productSpecContainmentID,productID:a.productID,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID,billingOfferID:b.billingOfferID}),e.push(b.productSpecPricing.childPricingSchema.id))}}),a.displayableItems&&a.displayableItems.length>0&&f.loadBillingOffersToRemove(a.displayableItems,b,d,e)})},createInputPayload:function(a,b,d){var e=[],f=this.get("accountNo");if(f){var g=this.get("accountProductID");g?e.push({productID:g,changedCharacteristics:[{characteristicID:18611461,value:f}]}):c.find(a,function(a){if("18645511"===a.productSpecContainmentID){var b=a.changedCharacteristics||[];return b.push({characteristicID:18611461,value:f}),a.changedCharacteristics=b,!0}})}var h={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:e,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:b,newContainedProducts:a,newSimpleProducts:[],removedAssignedBillingOffers:d,resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};return h},identifyExistingServicesAddons:function(a){var b=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedPlanAddonDetails"),d=[];c.each(b,function(a,c){b[c]&&b[c].compatibleAddon&&(d=d.concat(b[c].compatibleAddon.split(",")))}),this.set("compatibleAddonList",d);var e=this.get("allProductsDetails");if(e&&e.length>0){var f,g=c.find(e,function(b){var c=b&&b.plan&&b.plan.catalogItemName;return"WS"==b.lineOfBusiness&&c&&0==c.indexOf("Sim Only")&&b.serviceId==a}),h=[];g&&g.services?(h=h.concat(g.pricePackages?g.pricePackages:[]),c.each(g.services,function(a){h=h.concat(a.pricePackages?a.pricePackages:[]),a&&a.containedServices&&c.each(a.containedServices,function(a){h=h.concat(a.pricePackages?a.pricePackages:[])})}),f=c.filter(h,function(a){return a&&"AddOn"==a.catalogTechDescriptionX8}),f=c.unique(c.pluck(f,"catalogItemID")),this.set("existingBillingOfferList",h),this.set("existingAddonList",f),this.set("SimOnlyAddonUpgradeVmStatus","serviceDetailsFetchSuccess")):this.set("SimOnlyAddonUpgradeVmStatus","serviceDetailsFetchFailed")}}})});
define("businesswidget/repository_l9_common/common/model/CheckPendingOnPendingOrderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"ecommerce/customer/:customerId/orders",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/CheckPendingOnPendingAPOrderModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/contact/:contactId/customer/:customerId/product/:apid/orders",rest:{defaults:{method:"GET",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/CheckPendingOnPendingOrderViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/model/CheckPendingOnPendingOrderModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/ImplPendingProductsViewModel","single!businesswidget/repository_l9_common/common/model/CheckPendingOnPendingAPOrderModel"],function (a,b,c,d,e,f,g,h,i){return a.Core.ObservableViewModel.extend({models:{checkPendingOnPendingOrderModel:d,customerProductOrderProductOrderItemsModel:e,checkPendingOnPendingAPOrderModel:i},subViewModels:{individualInContextTopicViewModel:f,orderInContextTopicViewModel:g,implPendingProductsViewModel:h},defaults:{pendingOrderVmStatus:"",pendingOrderData:null,assignedProductId:null,customerId:null,eCareFlow:!1,isPrepaidScenario:!1},initialize:function(){b.bindAll(this,"checkPendingOrders","cancelPendingOrders","getPendingOrdersForCop","setDefaultQueryParams")},getPendingOrdersForCop:function(a){var c=this;c.set("pendingOrderVmStatus","getPendingProductsForCop");var d=$.Deferred(),e=c.subViewModels.implPendingProductsViewModel;e.set("salesFlow",!0);var f=a.id||a.productId,g=a.customerId||a.customerIdX8,h=a.contactIdX8||c.subViewModels.individualInContextTopicViewModel.get("personId"),i=e.getPendingProducts(g,f);return $.when(i).done(function(){var f=a.id||a.productId,i=e.get("pendingProductsByCatlogId"),j=b.find(i,function(a){return a.captionId&&a.captionId.indexOf("SU-")>-1});if(j)d.resolve("futureDatedSuspend");else{var k;k=c.get("isPrepaidScenario")?c.getModel("checkPendingOnPendingAPOrderModel"):c.getModel("checkPendingOnPendingOrderModel"),k.set({contactId:h,customerId:g,apid:f}),c.set("customerId",g),k.setQueryParams({apid:f,checkPayment:!0}),k.fetch({success:b.bind(c.onCheckPendingOnPendingOrderSuccess,c,a,d),error:b.bind(c.onCheckPendingOnPendingOrderError,c,d)})}}.bind(c)),d},onCheckPendingOnPendingOrderSuccess:function(a,b,c,d){this.set("pendingOrderVmStatus","pendingOnPendingOrderSuccess");var e=this.checkPendingOrders(a,d);b.resolve(e)},onCheckPendingOnPendingOrderError:function(a,b,c){a.reject("pendingOnPendingOrderError"),this.set("pendingOrderVmStatus","ordersDeletionFailed")},checkPendingOrders:function(a,c){var d="noPendingOrders";if(c&&c.ImplContactCustomerOrdersResponse&&c.ImplContactCustomerOrdersResponse.implOrderHeaderList&&c.ImplContactCustomerOrdersResponse.implOrderHeaderList.length>0){var e=c.ImplContactCustomerOrdersResponse.implOrderHeaderList,f=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),g=this.subViewModels.orderInContextTopicViewModel.get("isChangeUserScenario"),h=b.find(e,function(a){return a.isPendingPayment});if(h)d="pendingPayment";else{var i=a.id||a.productId,j=b.filter(e,function(a){var c=b.filter(a.implOrderActionHeaderList,function(a){var c=!1;return!g&&b.contains(b.pluck(f,"productOrderItemID"),a.orderActionId)||(c=!0),"NE"===a.orderStatus&&a.assignedProductId===i&&c});if(c&&c.length>0)return c=b.filter(a.implOrderActionHeaderList,function(a){return"NE"===a.orderStatus}),a.implOrderActionHeaderList=c,!0});j&&j.length>0&&(this.set("pendingOrderData",j),d="isOrderPending")}}return d},cancelPendingOrders:function(a){var c=this,d=c.get("pendingOrderData");c.set("pendingOrderVmStatus","cancelPendingOrders");var e=c.subViewModels.orderInContextTopicViewModel;"undefined"!=typeof a&&null!==a||(a=e.get("customerID"));var f=(e.get("productOrderID"),c.models.customerProductOrderProductOrderItemsModel),g=[];b.each(d,function(d){var e=$.Deferred();f.set("customerId",a||c.get("customerId")),f.set("productOrderId",d.orderId),c.setDefaultQueryParams(f);var h=c.subViewModels.orderInContextTopicViewModel.get(),i=[];b.each(d.implOrderActionHeaderList,function(a){d.orderId===h.productOrderID?!h.isChangeUserScenario&&b.contains(b.pluck(h.currentOrderActions,"productOrderItemID"),a.orderActionId)||i.push(a.orderActionId):i.push(a.orderActionId)}),f.setQueryParams({poi:i}),f.set("id",i[0]),f.destroy({success:function(a){return function(b){c.set("pendingOrderVmStatus","success"),a.resolve([])}}(e),error:function(a){return function(a){c.set("pendingOrderVmStatus","failure"),e.resolve(["fail"])}}(e)}),g.push(e)}),$.when.apply(c,g).done(function(a){var d=b.find(a,function(a){return"fail"===a}),e=c.get("eCareFlow");d?c.set("pendingOrderVmStatus","ordersDeletionFailed"):e?c.set("pendingOrderVmStatus","triggeredBuyFlow"):(c.set("pendingOrderVmStatus","ordersDeleted"),c.get("isPrepaidScenario")?c.trigger("prepaidOrdersDeleted"):c.trigger("ordersDeleted"))})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:c.get("salesChannel")||d.sc})}})});
define("businesswidget/repository_l9_common/common/model/ValidateSessionTokenModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/cce/validateSessionToken",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplValidateSessionTokenInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/ValidateNewSessionTokenModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/cce/cisOrstaff/validateSessionToken",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplValidateSessionTokenInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/CisMyInfoModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/cce/cis/myinfo",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplValidateSessionTokenInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel",["underscore","lightsaber","Configuration","single!businesswidget/repository_l9_common/common/model/ValidateSessionTokenModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/model/ValidateNewSessionTokenModel","single!businesswidget/repository_l9_common/common/model/CisMyInfoModel"],function (a,b,c,d,e,f,g){var h=b.Core.ObservableViewModel.extend({models:{validateSessionTokenModel:d,validateNewSessionTokenModel:f,cisMyInfoModel:g},subViewModels:{clearContextInContextTopic:e},defaults:{validateTokenStatus:"",cisDetails:null,sessionToken:null,appType:!1,cisCustomerDetails:null},initialize:function(){a.bindAll(this,"validateToken","getCISInfo","getCustIDType")},validateToken:function(){var b=this;b.set("validateTokenStatus","validateToken");var c,d,e=b.get("appType");e?(c=b.getModel("validateNewSessionTokenModel"),d={ImplValidateSessionTokenInput:{sessionToken:b.get("sessionToken"),isCIS:!0}}):(c=b.getModel("validateSessionTokenModel"),d={ImplValidateSessionTokenInput:{sessionToken:b.get("sessionToken")}}),c.save(d,{success:function(c,d){if(e)if(d.ImplValidateTokenResponse&&d.ImplValidateTokenResponse.company){var f=d.ImplValidateTokenResponse,g=[];a.each(f.company.pricePlans,function(a){g.push({planID:a.planID,discountedPrice:a.price})});var h={originalToken:b.get("sessionToken"),sessionToken:f.token,appType:f.type,parentCompanyBRN:f.company.parentBrn,parentCompanyName:f.company.parentCompanyName,parentCompanyDomain:f.company.parentCompanyDomain,childCompanyBRN:f.company.brn,childCompanyName:f.company.name,childCompanyDomain:f.company.domain,custId:f.customerId,rates:g};b.set("cisDetails",h),b.set("validateTokenStatus","tokenValidated")}else b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("validateTokenStatus","error");else!d.ImplValidateSessionTokenOutput||"undefined"!=typeof d.ImplValidateSessionTokenOutput.errorCode&&null!==d.ImplValidateSessionTokenOutput.errorCode?(b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("validateTokenStatus","error")):(b.set("cisDetails",d.ImplValidateSessionTokenOutput),b.set("validateTokenStatus","tokenValidated"))},error:function(a,c){b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("validateTokenStatus","error")}})},getCustIDType:function(a){var b;if(a)switch(a){case"WORK_PERMIT":b="Foreigner Work Permit";break;case"SPASS":b="Foreigner S Pass";break;case"EPASS1":case"EPASS2":case"QPASS":case"PERSONALISED_EPASS":b="Foreigner Employment Pass";break;case"ENTREPASS":b="EntrePass";break;case"NRIC":b="National Registration ID Card (NRIC)"}else b="National Registration ID Card (NRIC)";return b},getCISInfo:function(a){var b=this,c=$.Deferred();b.set("validateTokenStatus","gettingCISInfo");var d={ImplValidateSessionTokenInput:{sessionToken:a,isCIS:!0}},e=b.getModel("cisMyInfoModel");return e.save(d,{success:function(a,d){if(d.ImplMyInfoOutput&&d.ImplMyInfoOutput.customerId){var e=b.getCustIDType(d.ImplMyInfoOutput.passType),f=d.ImplMyInfoOutput.dateOfBirth.split("-");if(e){var g={custId:d.ImplMyInfoOutput.customerId,idType:e,selectedId:d.ImplMyInfoOutput.customerId,selectedIdType:e,selectedNumber:d.ImplMyInfoOutput.contactNumber,dateOfBirth:d.ImplMyInfoOutput.dateOfBirth,selectedDay:f[2],selectedMonth:f[1],selectedYear:f[0],selectedEmail:d.ImplMyInfoOutput.email,selectedName:d.ImplMyInfoOutput.name,selectedGender:d.ImplMyInfoOutput.gender,selectedAddress:d.ImplMyInfoOutput.address,readOnly:!0};b.set("cisCustomerDetails",g),b.set("validateTokenStatus","cisInfoSuccess"),c.resolve("cisInfoSuccess")}else b.set("validateTokenStatus","cisNotSupported"),c.resolve("cisNotSupported")}else b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("validateTokenStatus","cisInfoFailure"),c.resolve("cisInfoFailure")},error:function(a,d){var e="cisInfoFailure";try{if(d&&d.responseText){var f=JSON.parse(d.responseText);f&&f.ErrorInfo&&"CIS_MISMATCH_ERROR"===f.ErrorInfo.errorCode&&(e="cisMismatchError")}}finally{b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("validateTokenStatus",e),c.resolve(e)}}}),c}});return h});
define("businesswidget/repository_l9_common/common/viewmodel/business/ContactReContractViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/ContactReContractModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/SimOnlyPlanViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/CheckPendingOnPendingOrderViewModel","businesswidget/repository_l9_common/common/model/viewServiceListModel","businesswidget/repository_l9_common/common/model/viewServiceDetailModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){var C=a.Core.ObservableViewModel.extend({models:{ContactReContractModel:d,SubmitProductConfigurationModel:e,customerProductOrderProductOrderItemsModel:k,anonymousProductOrderProductOrderItemsModel:j,updateProductConfigurationModel:l,anonymousUpdateProductConfigurationModel:m,updateContactModel:n,viewServiceListModel:u,viewServiceDetailModel:v},subViewModels:{OrderInContextTopicViewModel:f,IndividualInContextTopicViewModel:g,deviceIdAndPlanIdInContextTopic:h,CustomerInContextTopicViewModel:i,ImplUserContextTopicViewModel:o,billingAccountsViewModel:p,miniCartInContextTopic:q,simOnlyPlanViewModel:r,clearContextInContextTopic:s,checkPendingOnPendingOrderViewModel:t,onePassTopicViewModel:w,pickAndGoViewModel:x,validateSessionTokenViewModel:z,preTickAddonViewModel:A,worryFreeContextTopicViewModel:B},dataBindings:[{contactId:"subViewModels.IndividualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{recontractNumber:[],recontractVmStatus:"",selectedRecontractDetails:null,customerID:null,selectedVouchers:null,productId:null,flowType:null,vendorCode:null,dealerCode:null,isContactUpdated:!1,accounts:null,recontractBarId:null,contactId:null,addComponentList:null,addonDetails:null,reContractServices:null,blockingMessages:null,productServicesTemp:null,blockingMessages:null,isPaymentPending:null,isUpdateOrderReq:!1,isFirstTime:!0,isMainFirstTime:!0,deviceInformationContainment:null,allProductsDetails:[],allProducts:null,cisCustomerDetails:null,preTickAddonDetails:null},initialize:function(a){this._super(a),c.bindAll(this,"getAllProducts","getErrorMessage","updateContact","updateContactSuccess","updateContactFailure","saveRecontractDetails","createInputPayload","updateOrderToRunRules","triggerBuyFlow","getSuccessMessage","setDefaultQueryParams","addCustomerContact","fetchExistingNumberMessage","onsaveRecontractDetailsError","processVMvalue","onsaveRecontractDetailsClearContextError","createReconOrder","doSaveReconDetails","loadServices","getProductDetails","populateContainedAddons","formatProductDetails","updateSimOnlyPlan","initializeServices","getCisData");var b=this,d=(this.subViewModels.OrderInContextTopicViewModel.get("productOrderID"),this.subViewModels.deviceIdAndPlanIdInContextTopic.get("recontractBarId"));b.getCisData(),this.set("recontractBarId",d),this.on("change:contactId",function(){setTimeout(function(){b.initializeServices()}.bind(b),0)},b),this.subViewModels.checkPendingOnPendingOrderViewModel.on("ordersDeleted",this.doSaveReconDetails,this)},getCisData:function(){var a=this,b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");if("cis"===b){var c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails");if(c&&"MY_INFO"===c.appType&&c.sessionToken){var d=a.subViewModels.validateSessionTokenViewModel.getCISInfo(c.sessionToken);d.done(function(b){if("cisInfoSuccess"===b){var c=a.subViewModels.validateSessionTokenViewModel.get("cisCustomerDetails");a.set("cisCustomerDetails",c),a.set("recontractVmStatus","cisDataFetched")}else a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("recontractVmStatus","fraudUser")}.bind(a))}}},initializeServices:function(){var a=this,b=a.get("contactId"),c=this.subViewModels.onePassTopicViewModel.get("newcustomer"),d=a.get("isMainFirstTime");d&&"undefined"!=typeof b&&null!==b&&!c?(a.set("isMainFirstTime",!1),setTimeout(function(){a.set("recontractVmStatus","initializeServices");var b=a.get("isFirstTime");b&&a.set("recontractVmStatus","vmInitialized"),a.set("isFirstTime",!1)}.bind(a),0)):setTimeout(function(){var b=a.get("isFirstTime");b&&a.set("reContractVMStatus","vmInitialized"),a.set("isFirstTime",!1)}.bind(a),0)},fetchExistingNumberMessage:function(){var a=this;a.set("recontractVmStatus","ExistingNumberfailure")},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},loadServices:function(){var a=this,b=(this.subViewModels.OrderInContextTopicViewModel.get("productOrderID"),a.get("contactId")),c=this.subViewModels.onePassTopicViewModel.get("newcustomer");if("undefined"!=typeof b&&null!==b&&""!==b&&!c){a.addCustomerContact(!0);var d=this.subViewModels.billingAccountsViewModel.getBillingAccountDetails();d.done(function(b){a.set("accounts",b),a.getAllProducts()}.bind(a)),d.fail(function(b){a.set("recontractVmStatus","failure")}.bind(a))}},getAllProducts:function(){var a=this,b=a.subViewModels.CustomerInContextTopicViewModel.get("customerIds"),d=a.subViewModels.worryFreeContextTopicViewModel.get("otpData");if(b&&b.length>0&&d&&("GOMO"===d.type||"PREPAID"===d.type)&&d.customerIds&&d.customerIds.length>0&&(b=c.filter(b,function(a){return!c.contains(d.customerIds,a)})),b&&b.length>0){var e=[];c.each(b,function(b){var d=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:b,success:c.bind(a.getAllProductsSuccess,a,d,b),error:function(b){return function(c,d){403===d.status?(a.set("customerReContractDetails",[]),a.set("recontractVmStatus","RecontractDataFetched")):a.set("recontractVmStatus","failure"),b.reject(d)}}(d)}),e.push(d)}),$.when.apply(a,e).done(function(){var b=a.get("reContractServices")||[];"undefined"!=typeof b&&null!==b&&b.length>0?a.getProductDetails(b):(a.set("customerReContractDetails",b),a.set("recontractVmStatus","RecontractDataFetched"))})}else a.set("customerReContractDetails",[]),a.set("recontractVmStatus","RecontractDataFetched")},getAllProductsSuccess:function(a,b,d,e){if("undefined"!=typeof e.Products){this.set("recontractVmStatus","reContractListFetched");var f=e.Products.products,g=this.get("reContractServices")||[];if("undefined"!=typeof f&&f.length>0){var h=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("planType"),i=[],j=[],k=null,l=this.subViewModels.OrderInContextTopicViewModel.get("currentOrderActions");l&&l.length>0&&(k=c.findWhere(l,{flowType:"mobileSharePlan"})),c.each(f,function(a){if("WS"===a.lob){var c=a.offeringName.toUpperCase();c&&c.indexOf("BROADBAND")>0?(a.customerId=b,i.push(a)):k?c&&c.indexOf("SHARE")>0&&(a.customerId=b,j.push(a)):(a.customerId=b,j.push(a))}}),g=g.concat("MBB"===h?i:j),this.set("reContractServices",g),c.each(f,function(a){a.customerId=b}),this.set("allProducts",f)}a.resolve()}else this.set("recontractVmStatus","failure")},getProductDetails:function(a){var b=this,d=(b.getModel("viewServiceDetailModel"),[]);c.each(a,function(a){var e=$.Deferred(),f=b.getModel("viewServiceDetailModel");f.set({customerId:a.customerId,productId:a.id}),f.setQueryParams({allParams:!0}),service=a,f.fetch({success:c.bind(b.onGetProductDetailsSuccess,b,e,a),error:function(a){return function(c){b.set("recontractVmStatus","failure"),a.reject(c)}}(e)}),d.push(e)}),this.getOtherLobProductDetails(),$.when.apply(b,d).done(function(){var a=b.get("productServicesTemp");if(a&&a.length>0){var d=b.get("accounts");d&&d.length>0&&a&&a.length>0&&c.each(a,function(a){if(a){var b=a.serviceId;b&&c.each(d,function(d){c.each(d.subscribers,function(c){c.subscriberResourceVal===b&&(a.barNumber=d.billingAccountNumber)})})}})}b.set("recontractNumber",a);var e=b.subViewModels.OrderInContextTopicViewModel.get(),f=e.currentOrderActions;if(a&&a.length>0&&f&&f.length>0){var g=c.find(f,function(a){return"WS"===a.lob});if(g){var h=c.find(a,function(a){return a.productId===g.productID});h?b.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractNumber",h):b.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractNumber",null)}}b.set("recontractVmStatus","RecontractDataFetched")})},getOtherLobProductDetails:function(){var a=this,d=[],e=this.get("allProducts");c.each(e,function(c){if(c.lob&&b.get("RECON_LOB_LIST").indexOf(c.lob)>-1&&"WS"!=c.lob){var e=$.Deferred(),f=a.getModel("viewServiceDetailModel");f.set({customerId:c.customerId,productId:c.id}),f.setQueryParams({allParams:!1}),f.fetch({success:function(b,c){if(c&&c.Product){var d=a.get("allProductsDetails");d.push(c.Product),a.set("allProductsDetails",d),a.subViewModels.simOnlyPlanViewModel.set("allProductsDetails",d)}e.resolve()},error:function(){e.resolve()}}),d.push(e)}}),$.when.apply(a,d).done(function(){a.set("recontractVmStatus","allProductsDetailsSet")})},onGetProductDetailsSuccess:function(a,b,d,e){if(e.Product.services&&e.Product.services.length>0){var f;c.find(e.Product.services,function(a){if("SIM"===a.catalogItemName||"8027872"===a.catalogItemID)return f=a.id,!0});var g=this.get("allProductsDetails");g.push(e.Product),this.set("allProductsDetails",g),this.subViewModels.simOnlyPlanViewModel.set("allProductsDetails",g);var h,i=this.get("productServicesTemp")||[],j=e.Product;b.offeringDescription&&(h=b.offeringDescription.split(","));var k;b.offeringId&&(k=b.offeringId);var l;j.plan&&j.plan.catalogItemID&&(l=j.plan.catalogItemID);var m,n=!1;c.each(j.devices,function(a){"10492"===a.productSpecContainmentID?m&&m.id?Number(m.id)<Number(a.id)&&(m=a):m=a:"Device_Contract"===a.catalogItemDescription&&c.find(a.parameters,function(a){if("8682"===a.catalogId){if(!n){var b=y(a.valueName,"DD/MM/YYYY").unix()-y("17/09/2019","DD/MM/YYYY").unix()>0,c=6;b&&(c=12),n=y(a.valueName,"DD/MM/YYYY").add(c,"months").date(1).hour(0).minute(0).second(0).milliseconds(0).unix()-y().unix()>0}return!0}})});var o=!1;c.each(j.parameters,function(a){a&&"8363392"===a.catalogId&&"Prepaid"===a.valueName&&(o=!0)}),m&&(m=m.id);var p={subscriptionId:b.subscriptionId,customerId:b.customerId,serviceId:j.serviceId,basePlan:b.offeringName,basePlanDesc:h,addOn:"",productId:b.id,oldOfferId:k,oldPlanId:l,oldDeviceId:m,isChildPlan:!1,staffProductId:null,easyMobilepProductId:null,cisProductId:null,isCI6:n,isPrepaid:o,simProductID:f};this.formatProductDetails(e.Product.services,p),p.addOn=p.addOn.toString(),i.push(p),this.set("productServicesTemp",i),a.resolve()}},formatProductDetails:function(a,b){var d=this,e=[];d.populateContainedAddons(a,e),c.each(a,function(a){if(a.catalogItemName){var c=a.catalogItemName.toUpperCase();"STAFF"===c?b.staffProductId=a.id:"CIS"===c?b.cisProductId=a.id:"EASY MOBILE"===c&&(b.easyMobilepProductId=a.id)}}),b.addOn=e},populateContainedAddons:function(a,b){var d=this;c.each(a,function(a){a.pricePackages&&a.pricePackages.length>0&&c.each(a.pricePackages,function(a){"AddOn"===a.catalogTechDescriptionX8&&b.push(a.catalogItemName)}),a.containedServices&&a.containedServices.length>0&&d.populateContainedAddons(a.containedServices,b)})},addCustomerContact:function(a){var b=this,d=b.subViewModels.CustomerInContextTopicViewModel.get("customerIds");if(d&&1===d.length){var e=b.getModel("updateContactModel");b.subViewModels.ImplUserContextTopicViewModel.get("userInfo");e.setQueryParams({isAnonymous:!0});var f=b.subViewModels.OrderInContextTopicViewModel.get();e.set({customerId:d[0]||b.get("customerID"),orderId:f.productOrderReferenceNumber});var g=f.orderActions,h=f.updatedOrderActions;g=c.filter(g,function(a){return!c.contains(h,a.productOrderItemID)});var i=[],j=[];if(c.each(g,function(a){i.push({orderActionId:a.productOrderItemID,contactId:b.subViewModels.IndividualInContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),j.push(a.productOrderItemID)}),i.length>0){var k={ImplAddCustomerContactRestInput:{orderAction:i}};e.save(k,{success:c.bind(b.addCustomerContactSuccess,b,j,a),error:c.bind(b.addCustomerContactFailure,b,j,a)})}}},addCustomerContactSuccess:function(a,b,d,e){var f=this,g=f.subViewModels.OrderInContextTopicViewModel.get("updatedOrderActions")||[];c.each(a,function(a){g.push(a)}),f.subViewModels.OrderInContextTopicViewModel.set("updatedOrderActions",g),b||f.set("recontractVmStatus","done")},addCustomerContactFailure:function(a,b,c,d){b||this.set("recontractVmStatus","done")},saveRecontractDetails:function(){var a=this;a.set("isPaymentPending",!1);var c=a.get("selectedRecontractDetails")||a.subViewModels.deviceIdAndPlanIdInContextTopic.get("recontractNumber");a.set("recontractVmStatus","saveRecontractDetails");var d=b.get("isPendingOrderCheck");if(d){var e=a.subViewModels.checkPendingOnPendingOrderViewModel;e.set("isPrepaidScenario",!1);var f=e.getPendingOrdersForCop(c);$.when(f).done(function(c){if(c){var d=b.get("isPendingOrderConfirmationNeeded");"noPendingOrders"===c?a.doSaveReconDetails():"futureDatedSuspend"===c?a.set("isPaymentPending",c):"pendingPayment"===c?a.set("isPaymentPending",!0):"isOrderPending"===c&&d?a.set("recontractVmStatus",c):e.cancelPendingOrders()}}.bind(a))}else a.doSaveReconDetails()},doSaveReconDetails:function(){var a=this;a.set("recontractVmStatus","doSaveReconDetails");var b=a.get("selectedRecontractDetails")||a.subViewModels.deviceIdAndPlanIdInContextTopic.get("recontractNumber"),d=a.get("customerID")||b.customerId;a.subViewModels.deviceIdAndPlanIdInContextTopic.set("oldOfferId",b.oldOfferId);var e=a.subViewModels.OrderInContextTopicViewModel.get(),f=e.productOrderID,g=e.currentOrderActions,h=[];if(!e.isChangeUserScenario&&g&&g.length>0){c.each(g,function(a){h.push(a.productOrderItemID)});var i;d?(i=a.models.customerProductOrderProductOrderItemsModel,i.set("customerId",d)):i=a.models.anonymousProductOrderProductOrderItemsModel,i.set("productOrderId",f),a.setDefaultQueryParams(i);var j=c.clone(h);i.setQueryParams({poi:h}),i.set("id",h[0]),i.destroy({success:c.bind(a.createReconOrder,a,b,j),error:c.bind(a.onsaveRecontractDetailsError,a)})}else e.isChangeUserScenario&&(h.push({lob:"WS"}),a.subViewModels.OrderInContextTopicViewModel.set("orderActions",h),a.subViewModels.OrderInContextTopicViewModel.set("isChangeUserScenario",!1)),a.createReconOrder(b,h)},createReconOrder:function(a,b){var d=this,e=!1;if(b&&b.length>0){var f=d.subViewModels.OrderInContextTopicViewModel.get("orderActions")||[];if(f=c.filter(f,function(a){return a.lob}),f&&f.length===b.length){d.subViewModels.OrderInContextTopicViewModel.emptyTopic();var g=[];if(g.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),g.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),this.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin")||window.localStorage.removeItem("LightsaberSessionToken"),window.localStorage.setItem("clearSessionStorage",!0),g.length>0)for(var h=0;h<g.length;h++){var i=g[h];window.sessionStorage.removeItem(i)}window.localStorage.removeItem("clearSessionStorage"),e=!0}}var j=d.createInputPayload(a),k=d.subViewModels.IndividualInContextTopicViewModel.get("personId"),l=d.getModel("SubmitProductConfigurationModel");d.set("customerID",a.customerId),l.set({contactId:k,customerId:a.customerId,productId:a.productId}),l.setQueryParams({enableHardCancellation:!0}),d.set("isUpdateOrderReq",e),l.save(j,{success:c.bind(d.onsaveRecontractDetailsSuccess,d,a,b),error:d.onsaveRecontractDetailsClearContextError})},createInputPayload:function(a){var b=this,c=b.subViewModels.deviceIdAndPlanIdInContextTopic.get(),d=[],e=[],f=[];if("staff"===c.customerType&&c.staffDetails&&("undefined"!=typeof a.staffProductId&&null!==a.staffProductId||d.push({productSpecContainmentID:"11822",temporaryID:"c"+Math.random().toString(36).substr(2,9)})),"cis"===c.customerType&&c.cisDetails){var g=c.cisDetails,h=[{
characteristicID:8480012,value:g.companyId},{characteristicID:8582,value:g.companyName},{characteristicID:8592,value:g.childCompanyName}];d.push({productSpecContainmentID:"11762",changedCharacteristics:h,temporaryID:"c"+Math.random().toString(36).substr(2,9)}),a.cisProductId&&e.push({productID:a.cisProductId})}if(a.easyMobilepProductId&&a.easyMobileUnits&&f.push({productID:a.easyMobilepProductId,changedCharacteristics:[{characteristicID:8192,value:a.easyMobileUnits.talkTimeUnit},{characteristicID:8202,value:a.easyMobileUnits.smsUnit},{characteristicID:8212,value:a.easyMobileUnits.dataUnit}]}),a.updateSim&&a.simProductID){var i={productID:a.simProductID,changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:"8858992",value:null},{characteristicID:8022652,value:"3IN1"},{characteristicID:132395,value:null}]};f.push(i)}var j=[];if(null!==c.deviceId&&""!==c.deviceId){var k={businessType:"DEVICE",simpleProductSpecID:c.deviceId,temporaryID:"c"+Math.random().toString(36).substr(2,9)};if(c.installmentPayment||c.installmentDuration&&c.isIppPlan){var h=[];h.push({characteristicID:8272,value:c.installmentDuration||"24"}),h.push({characteristicID:13897781,value:"Instalments"}),k.changedCharacteristics=h}j.push(k);var l=b.get("deviceInformationContainment")||"10482";d.push({productSpecContainmentID:l,temporaryID:"c"+Math.random().toString(36).substr(2,9)})}var m={ImplSubmitProductConfigurationRestInput:{subscriberId:a.subscriptionId,updateProductConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:null,addDefaultChildItemsImplicitly:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{newProductOfferingProductSpecID:c.relationId,productID:a.productId,newBasicPriceScehmaID:c.priceSchemaId,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:b.get("vendorCode"),dealerCodeX8:b.get("dealerCode"),productChanges:{removedSimpleProducts:[],changedContainedProducts:f,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:d,newSimpleProducts:j,removedAssignedBillingOffers:[],resumedContainedProducts:[],removedContainedProducts:e}}],newProductOfferingID:c.planId}],productChanges:[]}}};c.priceSchemaId&&(m.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.replaceProductOfferingConfiguration[0].productForReplacement[0].newBasicPriceScehmaID=c.priceSchemaId);var n=b.subViewModels.OrderInContextTopicViewModel.get("productOrderID");return n&&(m.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.productOrderID=n),m},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onsaveRecontractDetailsSuccess:function(a,b,d,e){var f=this,g=e.ImplSubmitProductConfigurationRestOutput;if(g.errorInfo&&g.errorInfo.length>0){var h=c.find(g.errorInfo,function(a){return"EntityAlreadyExists"===a.errorCode});if(h)return void this.set("recontractVmStatus","tbcOrderFound")}f.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractBarId",a.barNumber),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutOrderID",null),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutServiceID",null),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutRulesCompleted",!1),f.processOutput(g,b)},getErrorMessage:function(){this.set("recontractVmStatus","failure")},processVMvalue:function(a,b){var c=this,d="recontractFailed";try{if(b&&b.responseText){var e=JSON.parse(b.responseText);e&&e.ErrorInfo&&"SuspendedSubscription"===e.ErrorInfo.errorCode&&(d="SuspendedSubscriptionFailure")}}finally{c.set("recontractVmStatus",d)}},onsaveRecontractDetailsClearContextError:function(a,b){this.subViewModels.clearContextInContextTopic.clearCurrentContextTopic(),this.processVMvalue(a,b)},onsaveRecontractDetailsError:function(a,b){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.processVMvalue(a,b)},processOutput:function(a,b){var d=this,e=[],f=[];if("undefined"!=typeof a.updateProductConfigurationResponse){var g=a.updateProductConfigurationResponse,h=this.subViewModels.OrderInContextTopicViewModel,i=h.get("orderActions")||[];i&&i.length>0&&(i=c.filter(i,function(a){return!c.contains(b,a.productOrderItemID)}));var j,k,l,m=[],n=d.subViewModels.deviceIdAndPlanIdInContextTopic.get(),o=n.planId;"8480002"===o?j="8494592":"11627591"===o?j="11621331":"11640191"===o?j="11633931":"11621291"===o&&(j="11615031"),c.each(g.productsInReplaceProductOffering,function(a){c.each(a.products,function(a){var b=!1;d.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan")&&d.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration")&&(b=!0);var f={productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productConfiguration.productSpecification.level,lob:a.productConfiguration.lineOfBusiness,flowType:d.get("flowType"),orderType:"Change",isPPOrder:b};if(m.push(f),i.push(f),a.productConfiguration.displayableItems&&a.productConfiguration.displayableItems.length>0){if(j){var g=c.find(a.productConfiguration.displayableItems,function(a){return a.productSpecContainmentID===j});g&&(l=g.productID,d.subViewModels.deviceIdAndPlanIdInContextTopic.set("easyMobileId",g.productOrderItemID))}var h=c.find(a.productConfiguration.displayableItems,function(a){if("10482"!==a.productSpecContainmentID&&"11264181"!==a.productSpecContainmentID&&"11259761"!==a.productSpecContainmentID&&"11261971"!==a.productSpecContainmentID||!a.selected||"AD"!==a.action)return!1;if(a.displayableSimpleProductReferences){var b=c.find(a.displayableSimpleProductReferences,function(a){return a.selected&&"DEVICE"===a.businessType&&"Device"===a.name});return!!b}return!1});h&&(k=h.productID);var o=[];if("cis"!==n.customerType){var p=c.find(a.productConfiguration.displayableItems,function(a){return a.productID&&"11762"===a.productSpecContainmentID});p&&o.push(p)}if("staff"!==n.customerType){var q=c.find(a.productConfiguration.displayableItems,function(a){return a.productID&&"11822"===a.productSpecContainmentID});q&&o.push(q)}o&&o.length>0&&c.each(o,function(a){e.push({productID:a.productID})})}})}),"undefined"!=typeof h.get("customerID")&&null!==h.get("customerID")||this.set("isContactUpdated",!0);var p=this.get("customerID");h.set("orderActions",i),h.set("currentOrderActions",m),h.set("customerID",p),h.set("productID",g.productID),h.set("productOrderReferenceNumber",g.productOrderReferenceNumber),h.set("productOrderID",g.productOrderID),h.set("productOrderItemID",g.productOrderItemID),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("reContractFlag",!0),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!0);var q=this.subViewModels.miniCartInContextTopic.get("id"),r=this.get("addonDetails")||this.subViewModels.deviceIdAndPlanIdInContextTopic.get("addonDetails"),s=this.get("addComponentList"),t=d.get("selectedRecontractDetails")||d.subViewModels.deviceIdAndPlanIdInContextTopic.get("recontractNumber");t.easyMobileUnits&&("undefined"==typeof t.easyMobilepProductId||null===t.easyMobilepProductId)&&l&&f.push({productID:l,changedCharacteristics:[{characteristicID:8192,value:t.easyMobileUnits.talkTimeUnit},{characteristicID:8202,value:t.easyMobileUnits.smsUnit},{characteristicID:8212,value:t.easyMobileUnits.dataUnit}]}),k&&e.push({productID:k});var u=d.get("isUpdateOrderReq"),v=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo");if(u&&v&&(v.code||v.campaign&&v.parentLine)){var w=d.subViewModels.pickAndGoViewModel.updateCode(v,!1);w.done(function(b){"pickAndGoUpdated"===b?d.updateSimOnlyPlan(q,r,a,s,p,m,f,e):"pickAndGoFailed"===b&&d.getErrorMessage()})}else d.updateSimOnlyPlan(q,r,a,s,p,m,f,e)}},updateSimOnlyPlan:function(a,b,d,e,f,g,h,i){var j=this,k=["simOnlyPlan","tabletPlanFirst","tabletFirst"];if(c.contains(k,a)&&b&&b.length>0){var l=this.subViewModels.simOnlyPlanViewModel.updateAddonDetailsOrder(d,b,e,f);l.done(function(a){"failed"!==a?j.getSuccessMessage(g,null,null,h,i):j.getErrorMessage()}.bind(j))}else this.getSuccessMessage(g,null,null,h,i)},triggerBuyFlow:function(){var a=this,d=a.get("selectedVouchers");a.set("recontractVmStatus",""),a.set("isPaymentPending",!1);var e={},f=!1;if(d){a.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedVouchers",d);var g=d.serviceNoX8;if("undefined"!=typeof g&&null!==g&&""!==g){var h=a.get("recontractNumber");if(h){var i=c.filter(h,function(a){return a.serviceId===g});i&&i.length>0&&(e.customerId=i[0].customerId,a.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractNumber",i[0]))}}}else if(e=a.get("selectedRecontractDetails")){var h=a.get("recontractNumber");if(h){var i=c.filter(h,function(a){return a.productId===e.productId});i&&i.length>0&&!i[0].isCI6?(e.customerId=i[0].customerId,a.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractNumber",i[0])):i&&i.length>0&&i[0].isCI6&&(a.set("recontractVmStatus","ci6CustomerFound"),f=!0)}}if(!f){var j=b.get("isPendingOrderCheck");if(j){a.subViewModels.checkPendingOnPendingOrderViewModel.set("eCareFlow",!0);var k=a.subViewModels.checkPendingOnPendingOrderViewModel.getPendingOrdersForCop(e);$.when(k).done(function(c){if(c){var d=b.get("isPendingOrderConfirmationNeeded");"noPendingOrders"===c?a.set("recontractVmStatus","vouchersSelected"):"futureDatedSuspend"===c?a.set("isPaymentPending",c):"isOrderPending"===c&&d?a.set("recontractVmStatus",c):"pendingPayment"===c?a.set("isPaymentPending",!0):a.subViewModels.checkPendingOnPendingOrderViewModel.cancelPendingOrders()}}.bind(a))}else a.set("recontractVmStatus","vouchersSelected")}},getSuccessMessage:function(a,b,d,e,f){var g=this;if(g.set("recontractVmStatus",""),g.set("blockingMessages",null),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus){var h=d.productConfiguration.messages,i=!1;if(h=c.filter(h,function(a){return a.text&&a.text.indexOf("PENDING_SUBMITTED_ORDER_FORM")>-1&&(i=!0),"ERROR"===a.severity}),h&&h.length>0){var j={orderActionId:b,messages:h};g.set("blockingMessages",j),g.set("recontractVmStatus","blockingErrorFound")}return i?(g.set("recontractVmStatus","submittedReconOrderFound"),g.subViewModels.clearContextInContextTopic.clearAllTopics(!0)):g.set("recontractVmStatus","failure"),!1}var k=g.get("preTickAddonDetails");if(k&&k.preTickAddons){var l=g.subViewModels.preTickAddonViewModel;l.set("preTickAddons",k.preTickAddons),l.createInputPayload(d,k.addComponentList)}}if(b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0)}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),a&&a.length>0)g.updateOrderToRunRules(a,e,f);else{var l=g.subViewModels.preTickAddonViewModel,m=l._updateProductConfiguration();m.done(function(a){l.set("actionList",[]),g.updateContact()}.bind(g))}},updateOrderToRunRules:function(a,b,d){var e=this;"undefined"!=typeof b&&null!==b||(b=[]),"undefined"!=typeof d&&null!==d||(d=[]);var f,g,h={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:d,changedContainedProducts:b,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},i=e.subViewModels.OrderInContextTopicViewModel.get(),j=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});j&&j.length>0&&(f=j[0].productOrderItemID,g=j[0].productID,b.push({productID:g})),b.length>0&&(h.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=b);var k=i.customerID;if(k){var l=e.getModel("updateProductConfigurationModel");l.set({customerId:k,productOrderItemId:f}),e.setHeaders(l),e.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(h,{success:function(b,c){var d=[],g=[];e.getSuccessMessage(a,f,c.UpdateProductInOrderConfigurationResponse,d,g)},error:e.getErrorMessage})}else{var m=e.getModel("anonymousUpdateProductConfigurationModel");m.set({productOrderItemId:f}),e.setHeaders(m),e.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save(h,{success:function(b,c){var d=[],g=[];e.getSuccessMessage(a,f,c.UpdateProductInOrderConfigurationResponse,d,g)},error:e.getErrorMessage})}},updateContact:function(){var a=this;if(a.get("isContactUpdated")){var b=a.getModel("updateContactModel");this.subViewModels.ImplUserContextTopicViewModel.get("userInfo");b.setQueryParams({isAnonymous:!0});var d=a.subViewModels.OrderInContextTopicViewModel.get("productOrderReferenceNumber");b.set({customerId:a.get("customerID"),orderId:d});var e=a.subViewModels.OrderInContextTopicViewModel.get("orderActions"),f=this.subViewModels.OrderInContextTopicViewModel.get("updatedOrderActions");e=c.filter(e,function(a){return!c.contains(f,a.productOrderItemID)});var g=[],h=[];if(c.each(e,function(b){g.push({orderActionId:b.productOrderItemID,contactId:a.subViewModels.IndividualInContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),h.push(b.productOrderItemID)}),g.length>0){var i={ImplAddCustomerContactRestInput:{orderAction:g}};b.save(i,{success:c.bind(a.updateContactSuccess,a,h),error:a.updateContactFailure})}}else a.set("recontractVmStatus","successful")},updateContactSuccess:function(a){var b=this,d=b.subViewModels.OrderInContextTopicViewModel.get("updatedOrderActions")||[];c.each(a,function(a){d.push(a)}),b.subViewModels.OrderInContextTopicViewModel.set("updatedOrderActions",d),b.set("recontractVmStatus","successful")},updateContactFailure:function(){var a=this;a.set("recontractVmStatus","successful")}});return C});
define("businesswidget/repository_l9_common/common/model/SetNominationModal",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"ecommerce/customer/:customerId/product/:product/validate-nominations",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplValidateNominationsRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/KeyNominationViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/RetrieveNominationModel","single!businesswidget/repository_l9_common/common/model/findCallerByContactModel","businesswidget/repository_l9_common/common/model/SetNominationModal","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/viewServiceDetailModel","single!businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l){return a.Core.ObservableViewModel.extend({models:{RetrieveNominationModel:c,getBillingAccountDetailedListModel:g,setNominationModal:e,findCallerModel:d,viewServiceListModel:k,viewServiceDetailModel:j},subViewModels:{customerInContextTopicViewModel:f,onePassTopicViewModel:h,productInContextTopicViewModel:i,onePassDetailsViewModel:l},defaults:{keyNominationVmStatus:null,selectedPlan:null,nominationsDetails:null,productId:null,maxNomination:null,type:null,nric:null,flowType:null,updatedNominations:null,keyLineNumber:null,isNonKeyExists:null,mobileNumbers:null,nonKeyValuesLength:null,isKeyExists:!1,userInfo:null,customerIdList:null,services:{},bundles:{},accounts:null,transactionId:null,miniDesign:!0,assignedProduct:null,isKeylineNominationAllowed:!1,bundleType:null,serviceIdToOfferingIdMap:null},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{type:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{assignedProduct:"subViewModels.productInContextTopicViewModel.assignedProduct",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){var a=this;a._super(),a.set("keyNominationVmStatus","keyNominationInitialized");var b=this.subViewModels.onePassTopicViewModel.get("nric"),c=this.subViewModels.onePassTopicViewModel.get("customerIdType");this.on("change:nric",this.getCustomerInfo(b,c),this),this.on("change:assignedProduct",this.setSelectedPlan,this)},setSelectedPlan:function(){var a=this.get("assignedProduct"),b=this.subViewModels.productInContextTopicViewModel.get("serviceIdToOfferingIdMap");"undefined"!=typeof a&&null!==a&&a.id&&"undefined"!=typeof b&&null!==b&&(this.set("serviceIdToOfferingIdMap",b),this.set("selectedPlan",a.selectedPlan))},getCustomerInfo:function(a,c){var d=this.subViewModels.customerInContextTopicViewModel.get("customerId");"undefined"==typeof a||null===a?this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(b.bind(this.onOnePassInfoSuccess,this),function(){this.set("keyNominationVmStatus","onePassInfofailure")}.bind(this)):"undefined"==typeof d||null==d?this.fetchUserInfo(a,c):this.checkforAssignedProduct()},onOnePassInfoSuccess:function(){var a=this.subViewModels.onePassTopicViewModel.get("customerIdType"),b=this.subViewModels.onePassTopicViewModel.get("nric");this.set("nric",b),this.set("type",a),this.fetchUserInfo(b,a)},fetchUserInfo:function(a,c){var d=this;if(a){var e={implContactDetails:{indentValue:a,indentType:c}};d.getModel("findCallerModel").save({ImplFindCallerByContactInput:e},{success:b.bind(d.onFindCallerSuccess,d),error:function(){d.set("keyNominationVmStatus","failure")}})}},onFindCallerSuccess:function(a,b){var c=this,d=b.ImplFindCallerByContactOutput,e=d.contactCustomerDetails;e&&e.length>0&&(this.set("customerId",e[0].customerId),this.set("customerIdList",e)),c.checkforAssignedProduct()},checkforAssignedProduct:function(){var a=this.subViewModels.productInContextTopicViewModel.get("serviceIdToOfferingIdMap"),b=this.subViewModels.productInContextTopicViewModel.get("assignedProduct");"undefined"!=typeof a&&null!==a&&"undefined"!=typeof b&&null!==b&&"undefined"!=typeof b.id&&null!==b.id||this.loadAccounts()},loadAccounts:function(){var a=this;this.models.getBillingAccountDetailedListModel.set("type",this.getCustomerType(this.get("type"))),this.models.getBillingAccountDetailedListModel.fetch({id:this.get("nric"),success:b.bind(this.billingAccountDetailedListSuccess,this),error:function(b,c){a.set("keyNominationVmStatus","nominationRetrivedFail")}},this)},billingAccountDetailedListSuccess:function(a,c){b.each(c.ImplBillingAccountDetailsResponse.billingAccountDetails,function(a){a.nickName=a.nickName?a.nickName.trim():"Account Name"});var d=b.sortBy(c.ImplBillingAccountDetailsResponse.billingAccountDetails,"nickName");d&&d.length&&this.set("accounts",d),this.loadServices()},loadServices:function(a){var c=this,d=[],e=this.get("customerIdList");b.each(e,function(a){var e=$.Deferred();c.getModel("viewServiceListModel").fetch({customerId:a.customerId,success:b.bind(c.onLoadServicesSuccess,c,e,a.customerId),error:function(a,b){c.customerDeferred.resolve()}.bind(c,e)}),d.push(e)}),$.when.apply(c,d).done(function(){c.setAssignedProducts()})},onLoadServicesSuccess:function(a,c,d,e){var f=e.Products.products;b.each(f,function(a){a.collapsed=this.get("miniDesign")},this);var g=this.get("services"),h=this.get("bundles"),i=this.initBundles(f,c);g[c]=i.services,h[c]=i.bundle,this.set("services",g),this.set("bundles",h),a.resolve()},setAssignedProducts:function(){var a=(this.get("services"),this.get("accounts"));b.each(a,function(a){var b=this.mapProductToAccount(a);b&&(a.assignedProducts=b)}.bind(this)),this.set("accounts",a);var c=[];b.each(a,function(a){79===a.faStatus&&b.each(a.assignedProducts.bundles,function(d){b.each(d.bundledServices,function(b){b.lob&&"BB"===b.lob&&c.push({customerId:a.customerId,id:b.id,email:b.serviceId})})})}),c=b.uniq(c,function(a){return a.id}),this.set("selectedPlan",c)},initBundles:function(a,c){var d=this.get("serviceIdToOfferingIdMap")?this.get("serviceIdToOfferingIdMap"):[],e=b.groupBy(a,function(a){return"WS"===a.lob&&d.push({serviceId:a.serviceId,offeringId:a.offeringId}),a.bundle?"bundle":"services"});if(this.set("serviceIdToOfferingIdMap",d),this.subViewModels.productInContextTopicViewModel.set("serviceIdToOfferingIdMap",d),e.bundle){var f=b.groupBy(e.bundle,"offeringInstanceId");e.bundle=b.map(f,function(a,c){var d=null,e=null;return a=b.filter(a,function(a){return"TV"===a.lob&&(e=a),"Bundle GLP"===a.spoName?(d=a,!1):!!a.lob}),e?d.bundleType="FEB":d.bundleType="FHB",d.bundledServices=a,d})}return e},mapProductToAccount:function(a){var c=this,d={},e=this.mergeAccountSubscriptionAndServices(a.subscribers,c.get("services")[a.customerId]);e&&e.length>0&&(d.services=e);var f=b.map(c.get("bundles")[a.customerId],function(b){var c=this.mergeAccountSubscriptionAndServices(a.subscribers,b.bundledServices);return c&&c.length>0&&(b.bundledServices=c),b}.bind(this));return d.bundles=f,d},mergeAccountSubscriptionAndServices:function(a,c){var d=b.map(a,function(a){var d=b.find(c,function(b){return a.subscriberResourceVal===b.serviceId});return d&&(d.reContractionDate=a.reContractionDate,d.primaryInd=a.primaryInd,d.activationDate=a.subscrActivationDate,d.subscrStatus=a.subscrStatus,d.subscrStatusChangeDate=a.subscrStatusChangeDate,d.subscrType=a.subscrType),d});return d=b.filter(d,function(a){return a})},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT"}return a},getNomination:function(){var a=this;this.get("productId")||a.set("productId",a.subViewModels.productInContextTopicViewModel.get("assignedProduct")?a.subViewModels.productInContextTopicViewModel.get("assignedProduct").selectedPlan[0].id:a.get("selectedPlan")[0].id);var c=this.get("productId");if(c){var d=b.find(this.get("selectedPlan"),function(a){return a.id==c});this.models.RetrieveNominationModel.setQueryParams({product:c}),this.models.RetrieveNominationModel.fetch({customerId:d.customerId,success:function(c,d){if(d&&d.ImplRetrieveNominationsRestOutput){a.set("maxNomination",d.ImplRetrieveNominationsRestOutput.nominationsOutput.maxLinesForNominationX9),a.set("tvID",d.ImplRetrieveNominationsRestOutput.nominationsOutput.tvServiceIDX9),a.set("isKeylineNominationAllowed",!!d.ImplRetrieveNominationsRestOutput.nominationsOutput.tvServiceIDX9);var d=d.ImplRetrieveNominationsRestOutput.nominationsOutput;d.nominationsDetailsX9||(d.nominationsDetailsX9=[]);var e=b.find(d.nominationsDetailsX9,function(a){return a.keylineX9===!0});e?a.set("keyLineNumber",e.nominatedLineX9):a.get("isKeylineNominationAllowed")&&d.nominationsDetailsX9.unshift({keylineX9:!0,nominatedLineX9:"",keylineEnabledX9:!0,isTemporary:!0});for(var f=a.get("maxNomination")-d.nominationsDetailsX9.length,g=b.find(d.nominationsDetailsX9,function(a){return a.keylineX9===!1}),h=0;h<f;h++)d.nominationsDetailsX9.push({keylineX9:!1,nominatedLineX9:"",keylineEnabledX9:!1,isTemporary:!0});a.set("nominationsDetails",d.nominationsDetailsX9),a.set("nonKeyValuesLength",f),a.set("isKeyExists",!!e),a.set("isNonKeyExists",!!g),a.set("keyNominationVmStatus","nominationRetrievedSuccess")}},error:function(b,c){a.set("keyNominationVmStatus","nominationRetrivedFailed")}})}},config:{actions:{setNominations:function(){var a=this,c=this.get("flowType"),d=null;d="AddFlow"==c?this.get("nominationsDetails"):this.get("updatedNominations");var e={ImplValidateNominationsRestInput:{tvServiceIDX9:this.get("tvID"),nominationDetails:[]}};b.each(d,function(a){if(a.nominatedLineX9){var c={keylineEnabledX9:a.keylineEnabledX9,keylineX9:a.keylineX9,nominatedLineX9:a.nominatedLineX9};e.ImplValidateNominationsRestInput.nominationDetails.push(c),e.ImplValidateNominationsRestInput.nominationDetails=b.uniq(e.ImplValidateNominationsRestInput.nominationDetails,function(a){return a.nominatedLineX9})}}),a.models.setNominationModal.set({customerId:this.get("customerId"),product:this.get("productId")}),a.models.setNominationModal.save(e,{success:function(b,d){var d=d.ImplValidateNominationsRestOutput;a.set("transactionId",d.interactionId),"AddFlow"==c?a.set("keyNominationVmStatus","nominationSetSuccessfully"):a.set("keyNominationVmStatus","nominationRemovedSuccessfully")},error:function(b,d){"AddFlow"==c?a.set("keyNominationVmStatus","nominationSetFailed"):a.set("keyNominationVmStatus","nominationRemovedFailed")}})},getAllMobileNumbers:function(){var a=this,c=a.get("type");c=c.includes("NRIC")?"NRIC":c,a.models.getBillingAccountDetailedListModel.set("type",c),a.models.getBillingAccountDetailedListModel.fetch({id:a.get("nric"),success:function(c,d){var d=d.ImplBillingAccountDetailsResponse.billingAccountDetails,e=[];b.each(d,function(a){b.each(a.subscribers,function(a){"MOB"!=a.subscriberType&&"WS"!=a.subscriberType||e.push({title:a.subscriberResourceVal,value:a.subscriberResourceVal})})}),a.set("mobileNumbers",e),a.set("keyNominationVmStatus","mobileNumberLoaded")},error:function(){a.set("keyNominationVmStatus","mobileNumberLoadingFailed")}})}}}})});
define("businesswidget/repository_l9_common/common/model/RetrieveAppointmentStatus",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"dwfm/appointment/status",rest:{read:{method:"GET",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/AppointmentInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["appointmentId","flowType"],defaults:{appointmentId:null,flowType:!1},subViewModels:{}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/AppointmentStatusViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/RetrieveAppointmentStatus","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AppointmentInContextTopicViewModel"],function (a,b,c,d){return a.Core.ObservableViewModel.extend({models:{retrieveAppointmentStatus:c},subViewModels:{appointmentInContextTopicViewModel:d},dataBindings:[{timelineApptId:"subViewModels.appointmentInContextTopicViewModel.appointmentId",options:{twoWay:!1,setOnBind:!0}},{flowType:"subViewModels.appointmentInContextTopicViewModel.flowType",options:{twoWay:!1,setOnBind:!0}}],defaults:{appointmentVmStatus:"",appointmentId:"",errorCode:"",appointmentDetails:""},initialize:function(){this._super(),this.set("appointmentVmStatus","appointmentVmInitialized"),setTimeout(function(){var a=this.subViewModels.appointmentInContextTopicViewModel.get("flowType"),b=this.subViewModels.appointmentInContextTopicViewModel.get("appointmentId");switch(a){case"timeLineFlow":this.set("appointmentVmStatus","timeLineFlow");break;case"guestViewFlow":this.set("appointmentVmStatus","guestViewFlow")}b&&(this.set("appointmentId",b),this.handleAction("getAppointment"))}.bind(this),0)},config:{actions:{getAppointment:function(){var a=this;a.set("appointmentVmStatus","appointmentRetrievalInitialized"),this.models.retrieveAppointmentStatus.setQueryParams({appointmentId:this.get("appointmentId")}),this.models.retrieveAppointmentStatus.fetch({success:function(c,d){if(d){var d=d.ImplCheckAppointmentStatusRestOutput;d.appointmentID&&d.serviceNo?(a.set("appointmentDetails",d),a.set("appointmentVmStatus","appointmentRetrieved")):d.errorInfo&&d.errorInfo.length>0?(a.set("errorCode",d.errorInfo[0].errorCode),a.set("appointmentVmStatus","appointmentDataError")):b.isEmpty(d.ImplCheckAppointmentStatusRestOutput)&&a.set("appointmentVmStatus","invalidAppointmentId")}},error:function(b,c){a.set("appointmentVmStatus","appointmentRetrievalFailed")}})}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplLogoutViewModel",["lightsaber","underscore","jquery","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/EbillContextTopicViewModel","businesswidget/repository_l9_common/common/core/Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c,d,e,f,g,h){var i=a.Core.ObservableViewModel.extend({subViewModels:{baseContextTopicViewModel:d,onePassDetailsViewModel:e,ebillContextTopicViewModel:f,orderInContextTopicViewModel:h},dataBindings:[{remindMeFlag:"subViewModels.ebillContextTopicViewModel.remindMeFlag",options:{twoWay:!0,setOnBind:!0}}],defaults:{logoutVmStatus:"",remindMeFlag:""},initialize:function(){b.bindAll(this,"logout","clearUxfSecureSession"),setTimeout(function(){this.set("logoutVmStatus","initialized")}.bind(this),0)},onLogoutSuccess:function(){this.subViewModels.onePassDetailsViewModel.deleteSingtelCookie(),localStorage.setItem("remindMeFlag",this.get("remindMeFlag")),this.set("logoutVmStatus","logoutSuccessFull")},onLogoutError:function(){this.set("logoutVmStatus","logoutError")},clearPersistanceData:function(){var a=this.getSubViewModel("baseContextTopicViewModel");a.empty()},clearSession:function(){var a=c.Deferred();return this.set("logoutVmStatus","clearingSession"),sessionStorage.clear(),localStorage.clear(),a.resolve(),a},clearUxfSecureSession:function(a){window.localStorage.setItem("clearSessionStorage",!0);var b=g.get("clearCareTopicsList"),c=this.subViewModels.orderInContextTopicViewModel.get("customerID");(a||c)&&(b=g.get("clearSecureTopicsList"));for(var d=0;d<b.length;d++){var e=b[d];window.sessionStorage.removeItem(e)}window.localStorage.removeItem("clearSessionStorage")},logout:function(){var a=this.clearSession();this.clearUxfSecureSession(!0),window.localStorage.setItem("completeLogout",!0),c.when(a).done(function(){this.onLogoutSuccess()}.bind(this)),window.localStorage.removeItem("completeLogout")},logoutOtherTabs:function(){this.set("logoutVmStatus","forceLogout")}});return i});
define("businesswidget/repository_l9_common/common/model/ImplGetOrderListModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"/ordering/retrieve/customer-order-details",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplSearchCustomerOrderRestInput"],
qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplOrderListViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/ImplGetOrderListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel"],function (a,b,c,d,e){var f=a.Core.ObservableViewModel.extend({models:{implGetOrderListModel:d},subViewModels:{implUserContextTopicViewModel:e},VALID_SALES_CHANNEL:["SS","CC","DT","DL"],VALID_OA_REASON:["RECON"],VALID_OA_LOB:["FV","WS","BB","MBB","TV"],defaults:{activities:null,orderDetails:null,orderList:null,customerIdList:null,orderListVmStatus:null,userInfo:null},dataBindings:[{userInfo:"subViewModels.implUserContextTopicViewModel.userInfo",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this.on("change:userInfo",this.initData,this)},initData:function(){var a=this.get("userInfo"),b=null;if(a&&(b=a.contactCustomerDetails?a.contactCustomerDetails:a.customers),b&&b.length>0){var d=c.map(b,function(a){return a.customerId});this.set("customerIdList",d),this.set("orderListVmStatus","initialized")}},getAllOrders:function(){this.set("orderListVmStatus","getOrderListInProgress");var a=this.get("customerIdList"),b=c.map(a,function(a){var b=$.Deferred(),d={ImplSearchCustomerOrderRestInput:{customerId:a}},e=this.getModel("implGetOrderListModel");return e.setQueryParams({osc:"ALL"}),e.save(d,{success:c.bind(this.onOrderListSuccess,this,b,a),error:c.bind(this.onOrderListFailure,this,b)}),b}.bind(this));return $.when.apply(this,b).then(function(){for(var a=[],c=b.length,d=0;d<c;d++){var e=arguments[d];if(e.length)var f=e[0].ImplSearchCustomerOrderRestOutput.implOrderOutput||[];else var f=e.ImplSearchCustomerOrderRestOutput.implOrderOutput||[];for(var g=0;g<f.length;g++){var h=f[g];a.push(h)}}var a=this.filterOrderList(a);return this.set("orderList",a),this.set("orderListVmStatus","getOrderListSuccess"),a}.bind(this),function(){return this.set("orderListVmStatus","getOrderListFailed"),[]}.bind(this))},filterOrderList:function(a){var b=this,d=[];return c.each(a,function(a){if("CA"!==a.orderStatus){var e=c.filter(a.implOrderActionOutput,function(a){if(a.transactionType&&b.VALID_SALES_CHANNEL.indexOf(a.salesChannel)!==-1&&b.VALID_OA_LOB.indexOf(a.lineOfBusiness)!==-1){var c=a.transactionType.split("_");return"PR"===c[0]||c.length>=2&&b.VALID_OA_REASON.indexOf(c[1])!==-1}return!1});e&&e.length&&(a.implOrderActionOutput=e,d.push(a))}}),d},onOrderListSuccess:function(a,b,c,d){a.resolve(d,b)},onOrderListFailure:function(a){a.reject("Failed to load orders")}});return f});
define("businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/common/constants",{"ViewModel":{"appointmentTypes":{"INSTALLATION":"Installation","MAINTENANCE":"Maintenance","SHOP":"Shop","CALLBACK":"Callback"}}});
define("businesswidget/repository_l9_common/common/model/CustomerTechnicalAppointmentsModel",["lightsaber","businesswidget/repository/common/core/RESTModel","businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/common/constants"],function (a,b,c){return b.extend({options:{url:"sdp/contact-person/:contactId/appointments-list",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},parse:function(a,b){var c=[];return a&&a.ImplRetrieveAppointmentsListOutput&&a.ImplRetrieveAppointmentsListOutput.appointments&&(c=this._appointmentsMapper(a.ImplRetrieveAppointmentsListOutput.appointments)),{appointments:c}},_appointmentsMapper:function(a){return _.each(a,function(a){switch(a.serviceId=a.serviceID||"",a.changeURL=null,a.apptDuration=60*a.apptDuration||null,a.apptLocation=a.apptLocation||"",a.apptStatus="",a.isChangeAllowed=a.isChangeAllowed||!1,a.isCancelAllowed=a.isCancelAllowed||!1,a.apptType){case"Installation Appointment":a.apptType=c.ViewModel.appointmentTypes.INSTALLATION;break;case"Maintenance Appointment":a.apptType=c.ViewModel.appointmentTypes.MAINTENANCE}}),a}})});
define("businesswidget/repository_l9_common/common/model/CustomerTechnicalAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},"delete":{url:"sdp/contact-person/:contactId/appointment/cancel-appointment",method:"DELETE"},update:{url:"sdp/contact-person/:contactId/appointment/update-appointment",method:"PUT",payload:[]}}}})});
define("businesswidget/repository_l9_common/common/model/CustomerShopAppointmentsModel",["lightsaber","businesswidget/repository/common/core/RESTModel","businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/common/constants"],function (a,b,c){return b.extend({options:{url:"qnomy/contact-person/:contactId/getShopAppointment",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},parse:function(a,b){var c=[];return a&&a.ImplShopAppointmentsResponse&&a.ImplShopAppointmentsResponse.listOfShopAppointment&&(c=this._appointmentsMapper(a.ImplShopAppointmentsResponse.listOfShopAppointment)),{appointments:c}},_appointmentsMapper:function(a){return _.each(a,function(a){a.apptType=c.ViewModel.appointmentTypes.SHOP,a.serviceName=a.serviceName||"",a.serviceId="",a.apptLocation=a.apptLocation||"",a.changeURL=a.changeURL||"",a.apptDuration=a.apptDuration||null,a.apptStatus="Confirmed",a.isChangeAllowed=a.isChangeAllowed||!1,a.isCancelAllowed=a.isCancelAllowed||!1}),a}})});
define("businesswidget/repository_l9_common/common/model/CustomerShopAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},"delete":{url:"qnomy/contact-person/:contactId/appointment/:processId/cancelShopAppointment",method:"DELETE"}}}})});
define("businesswidget/repository_l9_common/common/model/MaintenanceAppointmentModel",["businesswidget/repository/common/core/RESTModel","Configuration","businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/common/constants","moment"],function (a,b,c,d){return a.extend({options:{url:"/manageAppointments/contact-person/:contactId/maintenance",rest:{defaults:{method:"GET",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}}}},parse:function(a,b){var c=[];return a&&a.ImplRetrieveAppointmentsListOutput&&a.ImplRetrieveAppointmentsListOutput.appointments&&(c=this._appointmentsMapper(a.ImplRetrieveAppointmentsListOutput.appointments)),{appointments:c}},_appointmentsMapper:function(a){return _.each(a,function(a){a.serviceId=a.serviceID||a.serviceId||"",a.changeURL=null,a.address.houseNumber=a.address&&a.address.blockOrHouseNum?a.address.blockOrHouseNum:"",a.apptDuration=a.apptDuration||0,a.apptLocation=a.apptLocation||"",a.isChangeAllowed="Cancelled"!=a.apptStatus&&(a.isChangeAllowed||!1),a.isCancelAllowed="Cancelled"!=a.apptStatus&&(a.isCancelAllowed||!1),a.apptStatus=a.apptStatus,a.apptType=c.ViewModel.appointmentTypes.MAINTENANCE,a.isChangeAllowed&&(a.isChangeAllowed=1e3*d().unix()<a.apptDate),a.isCancelAllowed&&(a.isCancelAllowed=1e3*d().unix()<a.apptDate)}),a}})});
define("businesswidget/repository_l9_common/common/model/InstallationAppointmentModel",["businesswidget/repository/common/core/RESTModel","Configuration","businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/common/constants","moment"],function (a,b,c,d){return a.extend({options:{url:"/manageAppointments/contact-person/:contactId/installation",rest:{defaults:{method:"GET",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}}}},parse:function(a,b){var c=[];return a&&a.ImplRetrieveAppointmentsListOutput&&a.ImplRetrieveAppointmentsListOutput.appointments&&(c=this._appointmentsMapper(a.ImplRetrieveAppointmentsListOutput.appointments)),{appointments:c}},_appointmentsMapper:function(a){return _.each(a,function(a){a.serviceId=a.serviceID||a.serviceId||"",a.changeURL=null,a.address.houseNumber=a.address&&a.address.blockOrHouseNum?a.address.blockOrHouseNum:"",a.apptDuration=isNaN(a.apptDuration)?a.apptDuration.split(/\s+/)[1]:a.apptDuration,a.apptLocation=a.apptLocation||"",a.isChangeAllowed="Cancelled"!=a.apptStatus&&(a.isChangeAllowed||!1),a.isCancelAllowed=!1,a.apptStatus=a.apptStatus,a.apptType=c.ViewModel.appointmentTypes.INSTALLATION;var b=d.unix(a.apptDate/1e3).format("DD/MM/YYYY"),e=a.apptDuration.split("-"),f=b+" "+e[0].replace(/\s/g,""),g=(b+" "+e[1].replace(/\s/g,""),1e3*d(f,"DD/MM/YYYY hh:mma").unix());a.isChangeAllowed&&(a.isChangeAllowed=1e3*d().unix()<g),a.isCancelAllowed&&(a.isCancelAllowed=1e3*d().unix()<g)}),a}})});
define("businesswidget/repository_l9_common/common/utils/implDateUtils",["underscore","knockout","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","src/core/formatter/DateFormatter"],function (a,b,c,d,e){var f=new e({resourceBundle:d});return{timeStampToDateString:function(a,b,c){var c=c||!1,d="";if(!isNaN(a)){var e=new Date(1*a);d=f.format(e,b,c)}return d}}});
define("businesswidget/repository_l9_common/common/viewmodel/CustomerViewAppointmentsViewModel",["underscore","lightsaber","single!businesswidget/repository_l9_common/common/model/CustomerTechnicalAppointmentsModel","single!businesswidget/repository_l9_common/common/model/CustomerTechnicalAppointmentModel","single!businesswidget/repository_l9_common/common/model/CustomerShopAppointmentsModel","single!businesswidget/repository_l9_common/common/model/CustomerShopAppointmentModel","single!businesswidget/repository_l9_common/common/model/MaintenanceAppointmentModel","single!businesswidget/repository_l9_common/common/model/InstallationAppointmentModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/common/constants","businesswidget/repository_l9_common/common/utils/implDateUtils","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){return b.Core.ObservableViewModel.extend({models:{technicalAppointmentsModel:c,techApptModel:d,maintenanceAppointmentModel:g,installationAppointmentModel:h,shopAppointmentsModel:e,shopApptModel:f},subViewModels:{individualInContextTopicViewModel:i,singtelStoreEAppointmentViewModel:n},defaults:{contactId:null,appointments:null,timeStampToDateString:function(a,b){return k.timeStampToDateString(a,b,!0)},lastRecivedAppointmentsTimestamp:null,isSystemDown:!1,currentAppointment:null,isEULAChecked:!1,exisitingAppointmentInput:null},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(b){this._super(),a.bindAll(this,"_onGetAppointmentsSuccess","_onContactIdChange","selectAppointmentToCancel","cancelAppointment","selectAppointmentToChange","updateAppointments","_getNewShopAppointments","_appointmentsMapper"),this._addMoreDataAndFunctions(),this._setEventsHandlers()},_addMoreDataAndFunctions:function(){this.set("contactId",this.subViewModels.individualInContextTopicViewModel.get("personId")),this.set("selectAppointmentToCancel",this.selectAppointmentToCancel),this.set("cancelAppointment",this.cancelAppointment),this.set("selectAppointmentToChange",this.selectAppointmentToChange),this.set("updateAppointments",this.updateAppointments)},_setEventsHandlers:function(){this.on("change:contactId",this._onContactIdChange)},_onContactIdChange:function(a){this._resetData();var b=this.get("contactId");b&&this._getAllAppointments()},_resetData:function(){this.set("isSystemDown",!1),this.set("appointments",null),this.set("currentAppointment",null),this.set("isEULAChecked",null)},_getAllAppointments:function(){var a=this.get("contactId"),b=this._getTechnicalAppointments(a);return $.when(b)},_getInstalltionAppointments:function(a){var b=this.get("contactId")||a,c=this._getAllInstalltionAppointments(b);return $.when(c)},_getMaintenanceAppointments:function(a){var b=this.get("contactId")||a,c=this._getAllMaintenanceAppointments(b);return $.when(c)},_getAllShopAppointments:function(a,b){var c=this.get("contactId")||a,b=this.get("exisitingAppointmentInput")||b;if(b&&b.eAppointmentCareCrOn){var d=this._getNewShopAppointments(c,b);return d}var e=this._getShopAppointments(c);return $.when(e)},_getTechnicalAppointments:function(a){var b=this;return this.models.technicalAppointmentsModel.fetch({contactId:a,success:function(a,c){b._onGetAppointmentsSuccess(a),b.handleAction("getInstallationAndMaintenanceAppointmentsSuccess")},error:function(){return b.set("isSystemDown",!0),!0}})},_getAllInstalltionAppointments:function(a){var b=this;return this.models.installationAppointmentModel.fetch({contactId:a,success:function(a,c){b._onGetAppointmentsSuccess(a),b.handleAction("getInstallationAndMaintenanceAppointmentsSuccess")},error:function(){return b.set("isSystemDown",!0),!0}})},_getAllMaintenanceAppointments:function(a){var b=this;return this.models.maintenanceAppointmentModel.fetch({contactId:a,success:function(a,c){b._onGetAppointmentsSuccess(a),b.handleAction("getInstallationAndMaintenanceAppointmentsSuccess")},error:function(){return b.set("isSystemDown",!0),!0}})},_getShopAppointments:function(a){var b=this;return this.models.shopAppointmentsModel.fetch({contactId:a,success:function(a,c){b._onGetAppointmentsSuccess(a),b.handleAction("getSingtelShopAppointmentsSuccess")},error:function(){return b.set("isSystemDown",!0),!0}})},_getNewShopAppointments:function(a,b){var c=this,d=$.Deferred();c.subViewModels.singtelStoreEAppointmentViewModel.set("exisitingAppointmentInput",b);var e=c.subViewModels.singtelStoreEAppointmentViewModel.retrieveExistingAppointment();return e.done(function(){var a=c.subViewModels.singtelStoreEAppointmentViewModel.get("singtelStoreAptVmStatus");if("aptRetrieved"===a){var b=c.subViewModels.singtelStoreEAppointmentViewModel.get("existingAptDetails");b=c._appointmentsMapper(b);var e={attributes:{appointments:b}};b=c._onGetAppointmentsSuccess(e),d.resolve(b),c.handleAction("getSingtelShopAppointmentsSuccess")}else d.resolve([]),c.set("isSystemDown",!0)}.bind(c)),e.fail(function(a){d.resolve([]),c.set("isSystemDown",!0)}.bind(c)),d},_removeItemsByProperty:function(a,b,c){return a.filter(function(a){return a[b]!==c})},_onGetAppointmentsSuccess:function(b){var c=this.get("appointments")||[],d=b.attributes.appointments,e=Date.now();return d.length>0&&("Installation"===d[0].apptType||"Maintenance"===d[0].apptType?(c=this._removeItemsByProperty(c,"apptType","Installation"),c=this._removeItemsByProperty(c,"apptType","Maintenance")):c=this._removeItemsByProperty(c,"apptType",d[0].apptType),a.each(d,function(a){a.recievedTimeStamp=e,a.state=a.apptStatus}),this.set("appointments",this._mergeCollectionsAndSort([c,d])),this.set("lastRecivedAppointmentsTimestamp",e)),d},_mergeCollectionsAndSort:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c]||[];b=b.concat(d)}return b.sort(function(a,b){return 1*a.apptDate>1*b.apptDate?1:-1}),b},_cancelAppointment:function(){var a=this,b=this.get("currentAppointment");b.state="Cancelling",this.set("currentAppointment",b),b&&"Maintenance"===b.apptType?(this.models.techApptModel.set("id",b.apptID),this.models.techApptModel.destroy({contactId:this.get("contactId"),appointmentId:b.apptID,success:function(b,c){c&&c.ImplStatusResponse&&c.ImplStatusResponse.isSuccess===!0?a._onCancelAppointmentSuccess():a._onCancelAppointmentFail()}})):b&&"Shop"===b.apptType?(this.models.shopApptModel.set("id",b.processId),this.models.shopApptModel.destroy({contactId:this.get("contactId"),processId:b.processId,success:function(b,c){c&&c.ImplCancelShopAppointmentResponse&&c.ImplCancelShopAppointmentResponse.isSuccess===!0?a._onCancelAppointmentSuccess():a._onCancelAppointmentFail()},error:function(){a._onCancelAppointmentFail()}})):(b=a.get("currentAppointment"),b.state="CancelFail",a.set("currentAppointment",b))},_onCancelAppointmentSuccess:function(){var a=this.get("currentAppointment");a.state="CancelSuccess",this.set("currentAppointment",a),this._updateAppointments()},_onCancelAppointmentFail:function(){var a=this.get("currentAppointment");a.state="CancelFail",this.set("currentAppointment",a),this._updateAppointments()},_changeAppointmentFirstStep:function(){var a=this,b=this.get("contactId"),c=this.get("currentAppointment");"Maintenance"!==c.apptType&&"Installation"!==c.apptType||(this.models.techApptModel.set("id",c.apptID),this.models.techApptModel.save({},{contactId:b,appointmentId:c.apptID,success:function(b,d){d&&d.ImplUpdateAppointmentOutput&&d.ImplUpdateAppointmentOutput.changeURL&&(c.changeURL=d.ImplUpdateAppointmentOutput.changeURL,c.tokenID=d.ImplUpdateAppointmentOutput.tokenID,a.set("currentAppointment",c))}}))},_updateAppointments:function(){var a=this.get("contactId"),b=this.get("currentAppointment");if("Maintenance"===b.apptType||"Installation"===b.apptType)this._getTechnicalAppointments(a);else if("Shop"===b.apptType){var c=this.get("exisitingAppointmentInput");c&&c.eAppointmentCareCrOn?this._getNewShopAppointments(a,c):this._getShopAppointments(a)}},selectAppointmentToCancel:function(a,b){b.state="Ready",this.set("currentAppointment",b),this.set("isEULAChecked",!1)},cancelAppointment:function(){return this._cancelAppointment(),!0},selectAppointmentToChange:function(a,b){b.state="Ready",this.set("currentAppointment",b),this._changeAppointmentFirstStep()},updateAppointments:function(){return this._updateAppointments(),!0},_appointmentsMapper:function(b){return a.each(b,function(a){a.apptType=j.ViewModel.appointmentTypes.SHOP,a.serviceName=a.transactionType+" "+a.serviceTypeDesc,a.serviceId=a.externalId,a.apptLocation=a.site.shopName||"",a.apptDate=a.startTimestamp,a.apptDuration=(a.endTimestamp-a.startTimestamp)/6e4,a.apptStatus=a.apptState,a.apptID=a.apptId,a.isChangeAllowed=a.isChangeAllowed||!1,a.isCancelAllowed=a.isCancelAllowed||!1}),b}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplTimelineDataAdapter",["underscore","moment"],function (a,b){var c={lobMap:{BB:"Broadband Line",WS:"Mobile Line",FV:"Home Digital Line",TV:"Singtel TV"},channelMap:{CC:"Customer Care",SS:"Online",DT:"Customer Care"},appointmentNameMap:{Shop:"Singtel Shop Appointment",Maintenance:"Maintenance Appointment",Installation:"Installation Appointment",Interaction:"Customer Care",Avaya:"Callback from Singtel"},orderingStatusMap:{NE:"Pending",DE:"Pending",CA:"Cancelled",IN:"Pending",AM:"Amended",DO:"Confirm",NO:"Pending",DC:"Cancelled",CO:"Pending",TC:"Pending Cancellation",OH:"On Hold",BA:"Being Amended",EX:"Pending"},fsAppointmentStatusMap:{NEW:"Processing",CFM:"In Warehouse",ALC:"Out for Delivery",DEL:"Delivered",UND:"Delivery Failed",RDL:"Change of Delivery",UND2:"Delivery Failed",DLK:"Ready for Collection",COL:"Collected",FAL:"Failed",CAN:"Cancelled",VRC:"Vendor Received",PRT:"Printed",SNW:"Student New Plan"},fsPopStnAppointmentStatusMap:{NEW:"Processing",CFM:"In Warehouse",ALC:"Out for Delivery",DEL:"Delivered",UND:"Collection Failed",RDL:"Change of Delivery",UND2:"Collection Failed",DLK:"Ready for Collection",COL:"Collected",FAL:"Failed",CAN:"Cancelled",VRC:"Vendor Received",PRT:"Printed",SNW:"Student New Plan"},orderActionReasonMap:{CREQ:"Customer Request",RECON:"Recontract",LNS:"Lost and Stolen",CSIM:"Change Sim"},popStationSlotTypes:["P","S"],covertAppointmentsToActivityList:function(b){var c=a.filter(b,function(a){return a.apptDate}),d=a.map(c,function(a){var b=this.getBlankActivity();b.date=parseInt(a.apptDate),b.type=a.apptType;var c=this.getApointmentDescription(a),d=this.getBlankEvent();return d.title=this.getAppointmentName(a),d.changeable=!!a.isChangeAllowed,d.cancelable=!!a.isCancelAllowed,d.description.push(c),d.type=a.apptType,"Shop"===a.apptType?(d.address=a.apptLocation,d.installation.shopApointmentDate=parseInt(a.apptDate),d.installation.shopApointmentTime=this.getAppointmentTime(a)):"Installation"===a.apptType?(d.address=a.address,d.address&&(d.address.addressType="timeline"),d.installation.installationDate=parseInt(a.apptDate),d.installation.installationTime=a.apptDuration,d.isLinkedApptIdExist=a.apptID):"Maintenance"===a.apptType&&(d.address=a.address,d.address&&(d.address.addressType="timeline"),d.installation.installationDate=parseInt(a.apptDate),d.installation.installationTime=this.getAppointmentTime(a),d.isLinkedApptIdExist=a.apptID),"BB"==a.serviceName?d.installation.service="Broadband Line":a.serviceName&&a.serviceName.indexOf("TV")>-1?d.installation.service="Singtel TV":d.installation.service=a.serviceName?a.serviceName:"Broadband Line",d.installation.appointmentId=a.apptID,d.installation.serviceNumber=a.serviceId?a.serviceId:a.serviceID,d.installation.status=a.state,d.lineOfBusiness=a.serviceName,d.serviceNumber=d.installation.serviceNumber,"Shop"===a.apptType&&a.serviceName&&(d.installation.serviceNumber=a.serviceName),b.events.push(d),b}.bind(this));return d},convertInteractionListToActivityList:function(b){var c=a.map(b,function(a){var b=this.getBlankActivity();b.date=parseInt(a.creationDate),b.type="message";var c=this.getBlankEvent();c.title=a.name,c.changeable=!!a.isChangeAllowed,c.cancelable=!!a.isCancelAllowed,c.type="Interaction",a.additionalInfo&&(c.installation.interactionDesc=a.additionalInfo.replace("\\n","<br/>")),b.events.push(c);var d=this.getBlankLink();return d.type="Care",b.links.push(d),b}.bind(this));return c},convertAvayaListToActivityList:function(b){var c=a.map(b,function(a){var b=this.getBlankActivity();b.date=parseInt(a.userRequestDateTime),b.type="message";var c="Phone No : "+a.phoneNumber,d=this.getBlankEvent();d.title="Avaya Interaction Details",d.changeable=!!a.isChangeAllowed,d.cancelable=!!a.isCancelAllowed,d.description.push(c),d.description.push("Request Type : "+a.requestType),d.serviceNumber=a.phoneNumber,d.installation.shopApointmentDate=parseInt(a.scheduledDateTime),d.installation.appointmentId=a.requestId,d.installation.status=a.status,b.events.push(d);var e=this.getBlankLink();return e.label="Callback Id",e.link=a.requestId,e.type="Care",b.links.push(e),b}.bind(this));return c},getAppointmentTime:function(a){var c=b(parseInt(a.apptDate)),d=c.format("hh:mm A"),e=b.duration({minutes:parseInt(a.apptDuration)});return c=c.add(e),d=d+" - "+c.format("hh:mm A")},getAppointmentName:function(a){return this.appointmentNameMap[a.apptType]?this.appointmentNameMap[a.apptType]:a.apptType},getApointmentDescription:function(a){return a.serviceName+" : "+a.serviceId?a.serviceId:a.serviceID},covertOrderListToActivityList:function(b){var c=a.map(b,function(b){var c=this.getBlankActivity();c.date=b.orderCreationDatetime,c.type="purchase",c.orderId=b.orderId,c.customerId=b.customerId;var d=a.map(b.implOrderActionOutput,function(a){var c=this.getBlankEvent();c.title=(this.getOrderActionTitle(a)||"New Purchase ")+": "+this.getLineName(a);var d=this.getServiceDescription(a);c.lineOfBusiness=a.lineOfBusiness,c.serviceNumber=a.serviceNumber,c.planName=a.planName,c.description.push(d),c.description.push("Channel: "+this.getChannelName(a)),c.installation.status=this.orderingStatusMap[a.orderActionStatus];var e=a.fsAppointment;return e?(e=this.updateHisotyListStatus(e),c.fsAppointment=e,c.type="FSAppointment",e.appointmentId=e.orderActionId,c.installation.deliveryDate=e.deliveryDateMilli,c.installation.deliveryTime=e.deliverySlot,c.address=e.implPhysicalAddress,c.address.addressType="timelineSingleLine",c.changeable=!!e.isChangeAllowed,c.appointetDetails=!!e.isDownloadDoAllowed,c.cancelable=!!e.isCancelAllowed):(e=b.implManageAppointmentDetailsForWirelineOutput||a.implWirelessAppointmentDetailsOutput,e&&(a.implWirelessAppointmentDetailsOutput?(e.appointmentId=a.implWirelessAppointmentDetailsOutput.appointmentId,c.type="WirelessAppointment",c.installation.appointmentId=a.implWirelessAppointmentDetailsOutput.appointmentId,c.installation.deliveryDate=a.implWirelessAppointmentDetailsOutput.implTimeSlotOutput.startDateAndTimeX9,c.installation.deliveryTime=a.implWirelessAppointmentDetailsOutput.implTimeSlotOutput.timeDescriptionX9):(c.type="DWFMAppointment",e.appointmentId=e.appointmentId,c.installation.appointmentId=e.appointmentId,c.installation.wfmAppointmentDate=e.wfmAppointmentDate,c.installation.netLinkDate=e.appointmentDate))),c}.bind(this));c.events=d;var e=this.getBlankLink();return e.label="Order Id",e.link=b.orderId,e.type="order",c.links.push(e),c}.bind(this));return c},updateHisotyListStatus:function(b){return a.each(b.implFulfillmentStatusHistoryList,function(a){"P"===b.slotType||"S"===b.slotType?a.currentMessage=this.fsPopStnAppointmentStatusMap[a.currentStatus]||a.currentStatus:a.currentMessage=this.fsAppointmentStatusMap[a.currentStatus]||a.currentStatus}.bind(this)),b},getOrderActionTitle:function(a){var b=this.orderActionReasonMap[a.transactionType];return a.fsAppointment&&(b=this.popStationSlotTypes.indexOf(a.fsAppointment.slotType)!==-1?"Collection at POPStation":"Delivery"),b},getServiceDescription:function(a){var b=this.getLineName(a)+": "+(a.serviceNumber?a.serviceNumber:"")+" (on "+a.planName+") ";return b},getChannelName:function(a){return a.salesChannel?this.channelMap[a.salesChannel]:this.channelMap.CC},getLineName:function(a){return a.lineOfBusiness?this.lobMap[a.lineOfBusiness]:""},getBlankActivity:function(){var a={date:null,type:null,links:[],events:[]};return a},getBlankEvent:function(){var a={title:null,description:[],type:null,address:null,lineOfBusiness:null,serviceNumber:null,installation:{installationDate:null,shopApointmentDate:null,appointmentId:null,deliveryDate:null,netLinkDate:null,wfmAppointmentDate:null,installationTime:null,shopApointmentTime:null,status:null,service:null,serviceNumber:null},changeable:!1,cancelable:!1};return a},getBlankLink:function(){var a={label:null,link:null,url:null,type:null};return a}};return c});
define("businesswidget/repository_l9_common/common/model/GetAllInteractionModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"support/individual/:contactId/interactions",rest:{defaults:{method:"GET",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/GetAvayaDataModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"manageAppointments/contact-person/:contactId/webcallback/:callbackParam",rest:{defaults:{method:"GET",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/CancelShopInstallationAppointment",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"/qnomy/contact-person/:contactId/appointment/:appointmentId/cancelShopAppointment",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},"delete":{method:"DELETE"}}}})});
define("businesswidget/repository_l9_common/common/model/CancelInstallationAppointment",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"/manageAppointments/contact-person/:contactId/maintenance/appointment/timeSlot",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},"delete":{method:"DELETE"}}}})});
define("businesswidget/repository_l9_common/common/model/SetDWFMInstalltionAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"manageAppointments/contact-person/:contactId/installation/appointment/timeSlot",rest:{defaults:{method:"PUT",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"PUT",contentType:"application/json",payload:["ImplConfirmTimeSlotInstallationAppointmentInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/SetDWFMMaintenanceAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"manageAppointments/contact-person/:contactId/maintenance/appointment/timeSlot",rest:{defaults:{method:"PUT",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"PUT",contentType:"application/json",payload:["ImplConfirmTimeSlotMaintenanceAppointmentInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetDWFMAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"manageAppointments/contact-person/:contactId/:type/appointment/timeSlot",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/ImplFsGetOrderFulfilmentInfoModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/fs/order/fulfillmentinfo",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplFsGetOrderFulfillmentInfoRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ImplFsChangeDeliveryOrderTimeslotModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/fs/order/changeDeliveryOrderTimeslot",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplFsChangeDeliveryOrderTimeslotRequest"]}}},name:"ImplFsChangeDeliveryOrderTimeslotRequest"})});
define("businesswidget/repository_l9_common/common/model/ImplFsGetDOImageModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/fs/order/image",rest:{defaults:{method:"GET"}}},name:"ImplFsGetDOImageModel"})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplFileDownloadViewModel",["lightsaber","underscore"],function (a,b){var c=a.Core.ObservableViewModel.extend({defaults:{base64String:null,fileType:null,fileName:null,MIME_TYPE_MAP:{pdf:"application/pdf"}},initialize:function(a){this.set("fileDownloadVmStatus","initialized")},getFileMimeType:function(){var a=this.get("fileType").toLowerCase(),b=this.get("MIME_TYPE_MAP")[a]||a;return b},downloadFile:function(){for(var a=this.get("fileName"),b=this.get("base64String"),c=this.getFileMimeType(),d=window.Blob||window.MozBlob||window.WebKitBlob,e=atob(b),f=e.length,g=new Uint8Array(f),h=0;h<f;h++)g[h]=e.charCodeAt(h);var i=new d([g],{type:c});if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(i,a);else{var j=window.URL||window.webkitURL,k=j.createObjectURL(i),l=document.createElement("a");if(navigator.userAgent.match("CriOS")){var m=new FileReader;m.onload=function(b){l.href=m.result,l.download=a,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)},m.readAsDataURL(i)}else l.href=k,l.download=a,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}});return c});
define("businesswidget/repository_l9_common/common/model/ImplFsChangeRedeliveryOrderTimeslotModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/fs/order/confirmredeliverytimeslot",rest:{defaults:{method:"POST",contentType:"application/json",
payload:["ImplFsConfirmRedeliveryTimeslotRequest"]}}},name:"ImplFsChangeRedeliveryOrderTimeslotModel"})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplFSAppointmentViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/ImplFsGetOrderFulfilmentInfoModel","businesswidget/repository_l9_common/common/model/ImplFsChangeDeliveryOrderTimeslotModel","businesswidget/repository_l9_common/common/model/ImplFsGetDOImageModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ImplFileDownloadViewModel","businesswidget/repository_l9_common/common/model/ImplFsChangeRedeliveryOrderTimeslotModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{implFsGetOrderFulfilmentInfoModel:c,implFsChangeDeliveryOrderTimeslotModel:d,implFsGetDOImageModel:e,implFsChangeRedeliveryOrderTimeslotModel:g},subViewModels:{implFileDownloadViewModel:f},defaults:{fsAppointmentVmStatus:null,fsPopAppointmentList:null,oaListWithFSAppointment:null,newFsDelSelectedSlot:null,orderActionId:null,dealerCode:null,salesOrderNo:null,salesManCode:null,redeliveryTimeslots:null,newPopStationAddress:null},dataBindings:[],initialize:function(a){this.set("fsAppointmentVmStatus","initialized")},getAppointments:function(a){var c={ImplFsGetOrderFulfillmentInfoRequest:{orderActionIdList:b.pluck(a,"orderActionId")}};return this.models.implFsGetOrderFulfilmentInfoModel.save(c)},changeFsRedelAppointment:function(){setTimeout(function(){this.set("fsAppointmentVmStatus","changeFsRedelAppointmentInProgress")}.bind(this),0);var a=this.get("newFsDelSelectedSlot"),b=this.get("orderActionId"),c=this.get("dealerCode"),d={ImplFsConfirmRedeliveryTimeslotRequest:{orderActionId:b,redeliveryDate:a.slotDate,redeliverySlot:a.slotCode,dealerCode:c}};return this.models.implFsChangeRedeliveryOrderTimeslotModel.save(d).then(function(a){a.ImplFsConfirmRedeliveryTimeslotResponse.confirmRedeliveryTimeslot?this.set("fsAppointmentVmStatus","changeFsRedelAppointmentSuccess"):this.set("fsAppointmentVmStatus","changeFsRedelAppointmentFailure")}.bind(this),function(){this.set("fsAppointmentVmStatus","changeFsRedelAppointmentRestFailed")}.bind(this))},changeFsDelAppointment:function(){setTimeout(function(){this.set("fsAppointmentVmStatus","changeFsDelAppointmentInProgress")}.bind(this),0);var a=this.get("newFsDelSelectedSlot"),b=this.get("orderActionId"),c=this.get("dealerCode"),d={ImplFsChangeDeliveryOrderTimeslotRequest:{orderActionId:b,deliveryDate:a.slotDate,slotCode:a.slotCode,slotQty:1,dealerCode:c}};return this.models.implFsChangeDeliveryOrderTimeslotModel.save(d).then(this.onChangeFsDelAppointmentSuccess.bind(this),this.onChangeFsDelAppointmentFailure.bind(this))},onChangeFsDelAppointmentSuccess:function(a){a.ImplFsChangeDeliveryOrderTimeslotResponse.changeDeliveryOrderTimeSlotStatus?this.set("fsAppointmentVmStatus","changeFsDelAppointmentSuccess"):this.set("fsAppointmentVmStatus","changeFsDelAppointmentFailure")},onChangeFsDelAppointmentFailure:function(){this.set("fsAppointmentVmStatus","changeFsDelAppointmentRestFailed")},getRedeliveryTimeslots:function(){this.set("fsAppointmentVmStatus","GetRedeliveryTimeslotsInitialized");var a={ImplFsGetRedeliveryTimeslotRequest:{salesOrderNo:this.get("salesOrderNo"),deliveryOrderNo:this.get("deliveryOrderNo"),dealerCode:this.get("dealerCode"),salesManCode:this.get("salesManCode")}};return this.models.implFsGetRedeliveryTimeslotsModel.save(a).then(this.onGetRedeliveryTimeslotsSuccess.bind(this),function(){this.set("fsAppointmentVmStatus","GetRedeliveryTimeslotsFailure")}.bind(this))},onGetRedeliveryTimeslotsSuccess:function(a){this.set("redeliveryTimeslots",a.ImplFsGetRedeliveryTimeslotResponse),this.set("fsAppointmentVmStatus","GetRedeliveryTimeslotsSuccess")},getDoImage:function(){this.set("fsAppointmentVmStatus","fsGetDoImageInProcess");var a=this.get("orderActionId");return this.models.implFsGetDOImageModel.setQueryParams({orderActionId:a}),this.models.implFsGetDOImageModel.fetch().then(function(a){this.subViewModels.implFileDownloadViewModel.set({base64String:a.ImplFsGetDeliveryOrderResponse.deliveryOrderImage,fileType:a.ImplFsGetDeliveryOrderResponse.fileType,fileName:"Delivery_Order.pdf"}),this.subViewModels.implFileDownloadViewModel.downloadFile(),this.set("fsAppointmentVmStatus","fsGetDoImageSuccess")}.bind(this),function(){this.set("fsAppointmentVmStatus","fsGetDoImageFailure")}.bind(this))},changeFsPopStationAppointment:function(){setTimeout(function(){this.set("fsAppointmentVmStatus","changeFsPopStationAppointmentInProgress")}.bind(this),0);var a=this.get("newFsDelSelectedSlot"),b=this.get("orderActionId"),c=this.get("dealerCode"),d=this.get("newPopStationAddress"),e={ImplFsChangeDeliveryOrderTimeslotRequest:{orderActionId:b,slotQty:1,dealerCode:c,timeSlotID:a.id,address:null}};return d&&(e.ImplFsChangeDeliveryOrderTimeslotRequest.address={blockOrHouseNum:d.HouseBlockNumber,unitNumber:d.UnitNumber,streetName:d.StreetName,buildingName:d.BuildingName,country:"SINGAPORE",postcode:d.PostCode,outletCode:d.KioskId}),this.models.implFsChangeDeliveryOrderTimeslotModel.save(e).then(this.onChangeFsPopStationAppointmentSuccess.bind(this),this.onChangeFsPopStationAppointmentFailure.bind(this))},onChangeFsPopStationAppointmentSuccess:function(a){a.ImplFsChangeDeliveryOrderTimeslotResponse.changeDeliveryOrderTimeSlotStatus?this.set("fsAppointmentVmStatus","changeFsPopStationAppointmentSuccess"):this.set("fsAppointmentVmStatus","changeFsPopStationAppointmentFailure")},onChangeFsPopStationAppointmentFailure:function(){this.set("fsAppointmentVmStatus","changeFsPopStationAppointmentRestFailure")}});return h});
define("businesswidget/repository_l9_common/common/model/RetrievePOPStationsModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"/ordering/postcode/:postcode/pop-stations",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplTimelineViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/business/ImplOrderListViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerViewAppointmentsViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ImplTimelineDataAdapter","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/model/GetAllInteractionModel","businesswidget/repository_l9_common/common/model/GetAvayaDataModel","businesswidget/repository_l9_common/common/model/CancelShopInstallationAppointment","businesswidget/repository_l9_common/common/model/CancelInstallationAppointment","businesswidget/repository_l9_common/common/model/SetDWFMInstalltionAppointmentModel","businesswidget/repository_l9_common/common/model/SetDWFMMaintenanceAppointmentModel","businesswidget/repository_l9_common/common/model/GetDWFMAppointmentModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/ImplFSAppointmentViewModel","businesswidget/repository_l9_common/common/model/RetrievePOPStationsModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=a.Core.ObservableViewModel.extend({models:{getAvayaDataModel:j,getAllInteractionModel:i,cancelShopInstallationAppointment:k,cancelInstallationAppointment:l,setDWFMInstalltionAppointmentModel:m,setDWFMMaintenanceAppointmentModel:n,getDWFMAppointmentModel:o,retrievePOPStationsModel:r},subViewModels:{implOrderListViewModel:c,customerViewAppointmentsViewModel:d,orderInContextTopicViewModel:f,shoppingCartViewModel:h,implUserContextTopicViewModel:g,implFSAppointmentViewModel:q,singtelStoreEAppointmentViewModel:s},defaults:{activities:[],orderList:null,appointments:null,appointmentList:null,selectedSlot:null,orderId:null,timeSlots:null,availableTimeSlots:null,appointment:null,existingApptTimeSlot:null,customerId:null,implTimelineVmStatus:null,orderData:null,userInfo:null,itemsPerPage:null,getOrderDetails:!1,newAppointmentId:null,isInitDataCalled:!1,popStationPostalCode:null,popStations:null,exisitingAppointmentInput:null},dataBindings:[{userInfo:"subViewModels.implUserContextTopicViewModel.userInfo",options:{twoWay:!1,setOnBind:!0}},{appointments:"subViewModels.customerViewAppointmentsViewModel.appointments",options:{twoWay:!1,setOnBind:!0}},{"subViewModels.orderInContextTopicViewModel.productOrderID":"orderId",options:{twoWay:!1,setOnBind:!0}},{"subViewModels.orderInContextTopicViewModel.customerID":"customerId",options:{twoWay:!1,setOnBind:!0}},{orderData:"subViewModels.shoppingCartViewModel.orderData",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(),b.bindAll(this,"fetchData","initData","checkAndUpdateStoreAppointmentChangeAllowed","getOrderDetails","onAppointmentsChange","onOrderListChange","populateFsAppointments","getAllInteractionData","getInteractionDataSuccess","getAllAvayaData","getAvayaDataSuccess","convertOrderListToActivities","cancelPreviousAppointment","cancelPreviousShopAppointment","getDWFMTimeSlots","formatSlots","setDWFMTimeSlot","getUTCTime","setAppointmentData"),setTimeout(function(){this.set("implTimelineVmStatus","vmInitialized");var a=this.get("userInfo");a&&a.contactDetails&&a.contactDetails.contactId&&this.fetchData()}.bind(this),0)},fetchData:function(){var a=this.get("userInfo"),b=this.get("isInitDataCalled");!b&&a&&a.contactDetails&&a.contactDetails.contactId&&(this.set("isInitDataCalled",!0),this.initData())},setAppointmentData:function(){var a=this,b=a.get("exisitingAppointmentInput");console.log("exisitingAppointmentInput"+b)},initData:function(){var a=this.getValueByPath("userInfo.contactDetails.contactId");this.set("implTimelineVmStatus","initialized"),this.orderDetailsPromise=$.Deferred(),setTimeout(function(){this.get("getOrderDetails")?this.subViewModels.implOrderListViewModel.getAllOrders().then(function(a){this.set("orderList",a),this.orderDetailsPromise.resolve(a),this.onOrderListChange()}.bind(this),function(){this.orderDetailsPromise.resolve(null)}.bind(this)):this.orderDetailsPromise.resolve(null)}.bind(this),0);var b=this.subViewModels.customerViewAppointmentsViewModel._getInstalltionAppointments(a);b.done(function(a){a.ImplRetrieveAppointmentsListOutput&&a.ImplRetrieveAppointmentsListOutput.appointments&&this.onAppointmentsChange(a.ImplRetrieveAppointmentsListOutput.appointments)}.bind(this));var c=this.subViewModels.customerViewAppointmentsViewModel._getMaintenanceAppointments(a);c.done(function(a){a.ImplRetrieveAppointmentsListOutput&&a.ImplRetrieveAppointmentsListOutput.appointments&&this.onAppointmentsChange(a.ImplRetrieveAppointmentsListOutput.appointments)}.bind(this));var d=this.get("exisitingAppointmentInput");this.subViewModels.customerViewAppointmentsViewModel.set("exisitingAppointmentInput",d);var e=this.subViewModels.customerViewAppointmentsViewModel._getAllShopAppointments(a,d);$.when(e,this.orderDetailsPromise).then(function(a,b){var c;if(d&&d.eAppointmentCareCrOn)c=a;else{var e=a[0];e.ImplShopAppointmentsResponse&&e.ImplShopAppointmentsResponse.listOfShopAppointment&&(c=e.ImplShopAppointmentsResponse.listOfShopAppointment)}b&&b.length&&(c=this.checkAndUpdateStoreAppointmentChangeAllowed(c,b)),this.onAppointmentsChange(c)}.bind(this)),this.getAllInteractionData()},checkAndUpdateStoreAppointmentChangeAllowed:function(a,c){return b.each(a,function(a){b.each(c,function(c){b.each(c.implOrderActionOutput,function(b){b&&b.implWirelessAppointmentDetailsOutput&&b.implWirelessAppointmentDetailsOutput.implTimeSlotOutput&&b.implWirelessAppointmentDetailsOutput.implTimeSlotOutput.slotCodeX9==a.apptID&&(a.isChangeAllowed=!1,a.isCancelAllowed=!1)})})}),a},getOrderDetails:function(){this.set("implTimelineVmStatus","RetrieveOrderDetails"),this.subViewModels.shoppingCartViewModel.set("orderData",null);var a=this.subViewModels.shoppingCartViewModel.loadShoppingCartData(!0);a.then(function(){var a=this.get("orderData"),c=this.subViewModels.shoppingCartViewModel.get("address");a.order=b.extend(a.order,c),this.set("orderData",a),this.set("orderId",null),this.set("implTimelineVmStatus","OrderDetailsReceived")}.bind(this),function(){this.set("implTimelineVmStatus","OrderDetailsFailed")}.bind(this))},onAppointmentsChange:function(a){if(this.set("implTimelineVmStatus","onAppoitnmentsReceived"),a&&a.length>0){var c=e.covertAppointmentsToActivityList(a),d=b.union(this.get("activities"),c);d=b.sortBy(d,function(a){return-1*a.date}),this.set("activities",d),this.set("implTimelineVmStatus","appointmentListConvertedToActivities")}},onOrderListChange:function(){this.set("implTimelineVmStatus","orderListReceived");var a=this.get("orderList");if(a&&a.length>0)return this.populateFsAppointments().then(function(a){this.set("orderList",a),this.convertOrderListToActivities()}.bind(this))},populateFsAppointments:function(){var a=$.Deferred(),c=this.get("orderList"),d=[];b.filter(c,function(a,c){var e=a.implOrderActionOutput,f=b.filter(e,function(a,b){return a.deliveryAddressId});f.length&&(d=d.concat(f))});return d.length?this.subViewModels.implFSAppointmentViewModel.getAppointments(d).then(function(d){var e=d.ImplFsGetOrderFulfillmentInfoResponse.implFsOrderFulfillmentInfoList;b.each(e,function(a){var d=a.orderActionId;b.each(c,function(c){oaList=c.implOrderActionOutput,b.each(oaList,function(b){b.orderActionId===d&&(b.fsAppointment=a)})})}),a.resolve(c)}.bind(this),function(){a.resolve(c)}.bind(this)):a.resolve(c),a},getAllInteractionData:function(){var a=this,c=1438487696e3,d=a.get("itemsPerPage");(null===d||b.isEmpty(d))&&(d=200);var e=Date.now();a.models.getAllInteractionModel.setQueryParams({startDate:c,endDate:e,itemsPerPage:d}),a.models.getAllInteractionModel.set("contactId",a.get("userInfo").contactDetails.contactId),a.models.getAllInteractionModel.fetch({success:b.bind(a.getInteractionDataSuccess,a),error:function(){a.set("implTimelineVmStatus","interactionDataError")}})},getInteractionDataSuccess:function(a,c){if(c&&c.SearchInteractionsResponse.interactions){var d=c.SearchInteractionsResponse.interactions,f=e.convertInteractionListToActivityList(d),g=b.union(this.get("activities"),f);g=b.sortBy(g,function(a){return-1*a.date}),this.set("activities",g),this.set("implTimelineVmStatus","interactionConvertedToActivities")}else this.set("implTimelineVmStatus","interactionDataError")},getAllAvayaData:function(){var a=this,c=this.get("userInfo").contactSubscriptionDetails,d=b.filter(c,function(a){return"FV"==a.lineOfBusiness||"MOB"==a.lineOfBusiness||"EQMT"==a.lineOfBusiness});b.each(d,function(c){a.models.getAvayaDataModel.set("contactId",a.get("userInfo").contactDetails.contactId),a.models.getAvayaDataModel.set("callbackParam",c.primaryResource),a.models.getAvayaDataModel.fetch({success:b.bind(a.getAvayaDataSuccess,a),error:function(){a.set("implTimelineVmStatus","avayaDataError")}})})},getAvayaDataSuccess:function(a,c){if(c&&c.ImplPendingWebCallRestOutput.appointmentList){var d=c.ImplPendingWebCallRestOutput.appointmentList,f=e.convertAvayaListToActivityList(d),g=b.union(this.get("activities"),f);g=b.sortBy(g,function(a){return-1*a.date}),this.set("activities",g),this.set("implTimelineVmStatus","interactionConvertedToActivities")}},convertOrderListToActivities:function(){var a=this.get("orderList"),c=e.covertOrderListToActivityList(a),d=b.union(this.get("activities"),c);d=b.sortBy(d,function(a){return-1*a.date}),this.set("activities",d),this.set("implTimelineVmStatus","orderListConvertedToActivities")},cancelPreviousAppointment:function(){var a=this;a.set("implTimelineVmStatus","appointmentCancellationInitialized");var b=this.get("appointment").events[0].installation.appointmentId;a.models.cancelInstallationAppointment.set("id",""),a.models.cancelInstallationAppointment.setQueryParams({originalDate:this.get("appointment").date,appointmentId:b}),a.models.cancelInstallationAppointment.destroy({contactId:a.get("userInfo").contactDetails.contactId,appointmentId:b,success:function(b,c){c&&c.ImplResultAppointmentOutput&&c.ImplResultAppointmentOutput.status?a.set("implTimelineVmStatus","appointmentCancelled"):a.set("implTimelineVmStatus","CancelFailure")},error:function(b,c){a.set("implTimelineVmStatus","CancelFailure")}})},cancelPreviousShopAppointment:function(){var a=this;a.set("implTimelineVmStatus","appointmentShopCancellationInitialized");var b,c=this.get("appointment").events[0].installation.appointmentId,d=a.get("exisitingAppointmentInput"),e=a.get("userInfo").contactDetails.contactId;if(d&&d.eAppointmentCareCrOn){d.apptId=c,a.subViewModels.singtelStoreEAppointmentViewModel.set("storeAptDetails",d);var f=a.subViewModels.singtelStoreEAppointmentViewModel.cancelStoreAppointment();f.done(function(){var b=a.subViewModels.singtelStoreEAppointmentViewModel.get("singtelStoreAptVmStatus");"cancelAppointmentSuccess"===b?a.set("implTimelineVmStatus","appointmentCancelled"):a.set("implTimelineVmStatus","CancelFailure")}.bind(a)),f.fail(function(b){a.set("implTimelineVmStatus","CancelFailure")}.bind(a))}else b=a.getModel("cancelShopInstallationAppointment"),b.set("id",""),b.destroy({contactId:e,appointmentId:c,success:function(b,c){a.set("implTimelineVmStatus","appointmentCancelled")},error:function(b,c){a.set("implTimelineVmStatus","appointmentCancelled")}})},getDWFMTimeSlots:function(){var a=this;a.set("implTimelineVmStatus","getDWFMTimeSlotsInitialized");var b=this.get("appointment").events[0].installation.appointmentId,c="Installation"==this.get("appointment").type?"installation":"maintenance",d=a.getModel("getDWFMAppointmentModel");d.set({contactId:a.get("userInfo").contactDetails.contactId,type:c,appointmentId:b}),d.setQueryParams({appointmentDate:this.get("appointment").date,appointmentId:b}),d.fetch({success:function(b,c){c&&c.ImplTimeSlotsAppointmentOutput&&(a.formatSlots(c.ImplTimeSlotsAppointmentOutput.proposedTimeSlots),a.set("existingApptTimeSlot",c.ImplTimeSlotsAppointmentOutput.existingApptTimeSlot),a.set("calendarRefID",c.ImplTimeSlotsAppointmentOutput.calendarRefID),a.set("implTimelineVmStatus","getDWFMTimeSlotsSuccess"))},error:function(b,c){a.set("implTimelineVmStatus","getDWFMTimeSlotsFailure")}})},formatSlots:function(a){var c=this,d=[],e={enabledDays:[],dateTimeSlots:{}};b.each(a,function(a,c){e.enabledDays.push(c);var f=e.dateTimeSlots[c];b.each(a,function(a){a.localizedUsed||(a.localizedTextSlot=a.startTime),"undefined"==typeof f&&(f=[]),f.push({title:a.localizedTextSlot.replace("to","-"),value:a.slotId}),d.push({slotId:a.slotId,slotDate:c})}),e.dateTimeSlots[c]=f}),e.enabledDays=b.uniq(e.enabledDays),c.set("timeslots",a),c.set("slotDetails",d),c.set("availableTimeSlots",e)},setDWFMTimeSlot:function(){var a=this;a.set("implTimelineVmStatus","setDWFMTimeSlotInitialized");var c,d=this.get("appointment").events[0].installation.appointmentId,e=this.get("availableTimeSlots"),f="Installation"==this.get("appointment").type?"installation":"maintenance",g=b.find(this.get("slotDetails"),function(b){return b.slotId===a.get("selectedSlot")}),h=b.find(e.dateTimeSlots[g.slotDate],function(b){return b.value==a.get("selectedSlot")}),i={originalDate:a.getUTCTime(a.get("existingApptTimeSlot").dateNumber),newDate:a.getUTCTime(g.slotDate),originalTimeSlot:a.getValueByPath("existingApptTimeSlot.localizedTextSlot"),newTimeSlot:h.title};if("installation"==f){c=a.getModel("setDWFMInstalltionAppointmentModel");var j={ImplConfirmTimeSlotInstallationAppointmentInput:i}}else{c=a.getModel("setDWFMMaintenanceAppointmentModel");var j={ImplConfirmTimeSlotMaintenanceAppointmentInput:i}}c.set({contactId:a.get("userInfo").contactDetails.contactId,appointmentId:d}),c.setQueryParams({slotId:a.get("selectedSlot"),calRefId:a.get("calendarRefID"),appointmentId:d}),c.save(j,{success:function(b,c){a.set("newAppointmentId",c.ImplResultAppointmentOutput.jobId),a.set("implTimelineVmStatus","setDWFMTimeSlotSuccess")},error:function(b,c){a.set("implTimelineVmStatus","setDWFMTimeSlotError")}})},getUTCTime:function(a){var a=p(a,"YYYYMMDD");return Date.UTC(a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds())},getPOPStations:function(){var a=this,c=a.get("popStationPostalCode"),d=a.getModel("retrievePOPStationsModel");a.set("implTimelineVmStatus","fetchingPopstations"),d.set({postcode:c}),d.fetch({success:function(c,d){if("undefined"!=typeof d.ImplRetrievePOPStationsResponse){var e=d.ImplRetrievePOPStationsResponse.implPOPStationDetails;e&&e.length>0?(b.each(e,function(a){a.Distance=a.Distance/1e3}),a.set("popStations",e),a.set("implTimelineVmStatus","popStationsFound")):a.set("implTimelineVmStatus","noPopStationsFound")}else a.set("implTimelineVmStatus","popStationsFailure")},error:function(b,c){a.set("implTimelineVmStatus","popStationsFailure")}})}});return t});
define("businesswidget/repository_l9_common/common/model/VerifyEmailModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/anonymous/contact-person/change-email",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplAnonymousContactPersonChangeEmailInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/UpdateVerifyViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/VerifyEmailModel"],function (a,b,c){var d=a.Core.ObservableViewModel.extend({models:{verifyEmailModel:c},defaults:{verifyEmailModelVmStatus:null,emailToken:null,errorCode:null},initialize:function(){b.bindAll(this,"updateEmailAddress","updateEmailSuccess"),this.set("verifyEmailModelVmStatus","initialized")},updateEmailAddress:function(){var a={token:this.get("emailToken")};verifyEmailModel=this.getModel("verifyEmailModel"),verifyEmailModel.save({ImplAnonymousContactPersonChangeEmailInput:a},{success:b.bind(this.updateEmailSuccess,this)})},updateEmailSuccess:function(a,b){this.set("verifyEmailModelVmStatus","EmailUpdatedSuccessfully")}});return d});
define("businesswidget/repository_l9_common/common/model/ImplConsolidateAccountsModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/billing/customer/:customerId/account/:faId/billing-arrangement/:barId/merge-accounts",rest:{defaults:{method:"POST",contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},payload:["ImplPostRedirectBanDistributionRequest"]}}},name:c.get("ERROR_CONST").MERGE_ACCOUNT_CONSOLIDATE})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplConsolidateAccountsViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/ImplConsolidateAccountsModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel"],function (a,b,c,d){var e=a.Core.ObservableViewModel.extend({models:{implConsolidateAccountsModel:c},defaults:{sourceAccounts:null,targetAccount:null,mailParameters:null,notes:null,templateId:null,consolidateAccountsVmStatus:null},subViewModels:{NotificationViewModel:d},initialize:function(){b.bindAll(this,"consolidateAccounts"),this.set("consolidateAccountsVmStatus","initialized")},consolidateAccounts:function(){var a={sourceAccounts:this.get("sourceAccounts"),targetBillingAddressId:this.getValueByPath("targetAccount.targetBillingAddressId")};this.models.implConsolidateAccountsModel.set({customerId:this.getValueByPath("targetAccount.customer"),faId:this.getValueByPath("targetAccount.account"),barId:this.getValueByPath("targetAccount.billingAccountNumber")}),this.models.implConsolidateAccountsModel.setQueryParams({targetPcnNo:this.getValueByPath("targetAccount.pcnNo")}),this.models.implConsolidateAccountsModel.save({ImplPostRedirectBanDistributionRequest:a},{success:b.bind(this.consolidateAccountsSuccess,this),error:b.bind(this.consolidateAccountsError,this)})},consolidateAccountsSuccess:function(a,b){b.ImplPostRedirectBanDistributionResponse&&b.ImplPostRedirectBanDistributionResponse.success?this.set("consolidateAccountsVmStatus","consolidateAccountsSuccess"):this.consolidateAccountsError(a,b)},consolidateAccountsError:function(a,b){this.set("consolidateAccountsVmStatus","consolidateAccountsError")},sendNotification:function(){var a=this.get("mailParameters"),c=0,d=b.find(a,function(a,b){return c=b,"table1Accounts"==a.key}),e=[{key:"table1Accounts",values:d.value}];a.splice(c,1),this.subViewModels.NotificationViewModel.sendMailToCustomer(this.get("templateId"),a,e);var f="Consolidation of Accounts",g={reason1:"Billing",reason2:"RequestCopyBill",result:"NotApplicable",protocol:"SpringDigital"};this.subViewModels.NotificationViewModel.createInteraction(f,g,this.get("notes"))}});return e});
define("businesswidget/repository_l9_common/common/model/GetOrderDetailsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/ordering/retrieve/customer-order-details",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplSearchCustomerOrderRestInput"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/OrderDetailsModelViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/GetOrderDetailsModel","businesswidget/repository_l9_common/common/viewmodel/business/ImplTimelineDataAdapter"],function (a,b,c,d){return a.Core.ObservableViewModel.extend({models:{getOrderDetailsModel:c},subViewModels:{},dataBindings:[],defaults:{activities:null,orderDetailsVmStatus:null,orderInputs:null},initialize:function(){var a=this;setTimeout(function(){a.set("orderDetailsVmStatus","orderDetailsInitialized")},0)},config:{actions:{getOrderDetails:function(){var a=this;a.set("orderDetailsVmStatus","getOrderDetailsInProgress");var c={ImplSearchCustomerOrderRestInput:{customerId:a.getValueByPath("orderInputs.customerId")}};this.models.getOrderDetailsModel.save(c,{success:function(c,e){if(e.ImplSearchCustomerOrderRestOutput&&e.ImplSearchCustomerOrderRestOutput.implOrderOutput){var e=e.ImplSearchCustomerOrderRestOutput.implOrderOutput,f=d.covertOrderListToActivityList(e);f=b.sortBy(f,function(a){return-1*a.date}),f=b.filter(f,function(b){return b.orderId==a.getValueByPath("orderInputs.orderId")}),a.set("activities",f),a.set("orderDetailsVmStatus","getOrderDetailsSuccess")}else a.set("orderDetailsVmStatus","getOrderDetailsError")},error:function(b,c){a.set("orderDetailsVmStatus","getOrderDetailsError")}})}}}})});
define("businesswidget/repository_l9_common/common/model/GetBillPdfModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/billingcare/anonymous/retrieve-document",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplProtectedDocumentRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetSecuredPdfModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/billingcare/retrieve-document",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplProtectedDocumentRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/BillPdfDownloadViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/GetBillPdfModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","businesswidget/repository_l9_common/common/model/GetSecuredPdfModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({defaults:{billPdfDownloadVmStatus:null,hashString:null,byteArray:null},models:{getBillPdfModel:d,onePassInfoModel:e,getSecuredPdfModel:f},subViewModels:{onePassDetailsViewModel:g},dataBindings:[],initialize:function(){this._super(),setTimeout(function(){this.set("billPdfDownloadVmStatus","billPdfDownloadVmInitialized")}.bind(this),0)},config:{actions:{getUserStatus:function(){var a=this;a.set("billPdfDownloadVmStatus","onePassInitialized"),this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(function(b){var c=b.ImplLoginHeaderResOutput.headersMap;c&&(c.HTTP_CUST_ID?a.getSecuredPdf():a.getBillPdf(),a.set("billPdfDownloadVmStatus","onePassSuccess"))},function(){a.set("billPdfDownloadVmStatus","onePassFailure")})}}},getSecuredPdf:function(){var a={hashString:this.getParameterByName("encval",!0)};this.models.getSecuredPdfModel.save({ImplProtectedDocumentRestInput:a},{success:c.bind(this.getSecuredPdfSuccess,this),error:c.bind(this.getSecuredPdfError,this)})},getBillPdf:function(){this.set("hashString",this.getParameterByName("encval",!0));var a={hashString:this.get("hashString")};this.models.getBillPdfModel.save({ImplProtectedDocumentRestInput:a},{success:c.bind(this.getBillPdfSuccess,this),error:c.bind(this.getBillPdfError,this)})},getParameterByName:function(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(location.search);return b?null===d?"":d[1]:null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},getSecuredPdfSuccess:function(a,b){var b=b.ImplGetDocumentRestOutput;this.set("byteArray",b.fileBytes);var c=b.fileBytes,d="singtel_mybill.pdf";if(window.navigator&&window.navigator.msSaveOrOpenBlob){for(var e=atob(c),f=new Array(e.length),g=0;g<e.length;g++)f[g]=e.charCodeAt(g);var h=new Uint8Array(f),i=new Blob([h],{type:"application/pdf"});window.navigator.msSaveOrOpenBlob(i,d)}else{var j=document.createElement("a");j.href="data:application/pdf;base64, "+b.fileBytes,j.download=d;var k=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});j.dispatchEvent(k)}this.set("billPdfDownloadVmStatus","securedPdfSuccess")},getSecuredPdfError:function(a,b){this.set("billPdfDownloadVmStatus","securedPdfError")},getBillPdfSuccess:function(a,b){var b=b.ImplGetDocumentRestOutput;this.set("byteArray",b.fileBytes);var c=b.fileBytes,d="singtel_mybill.pdf";if(window.navigator&&window.navigator.msSaveOrOpenBlob){for(var e=atob(c),f=new Array(e.length),g=0;g<e.length;g++)f[g]=e.charCodeAt(g);var h=new Uint8Array(f),i=new Blob([h],{type:"application/pdf"});window.navigator.msSaveOrOpenBlob(i,d)}else{var j=document.createElement("a");j.href="data:application/pdf;base64, "+b.fileBytes,j.download=d;var k=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});j.dispatchEvent(k)}this.set("billPdfDownloadVmStatus","billPdfDownloadSuccess")},getBillPdfError:function(a,b){b=JSON.parse(b.responseText),b=b?b.ErrorInfo.errorCode:"",this.set("billPdfDownloadVmStatus","billPdfDownloadError")}});return h});
define("businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/AddressModel"],function (a,b,c){var d=a.Core.ObservableViewModel.extend({models:{addressModel:c},subViewModels:{},dataBindings:[],defaults:{address:null,postalCode:null,addressError:null,addressVMStatus:null,addressList:null},initialize:function(){b.bindAll(this,"_retrieveAddress"),this.set("addressVMStatus","addressVMInitialize")},config:{actions:{getAddress:function(){this._retrieveAddress()}}},_retrieveAddress:function(){if(null!==this.get("postalCode")){var a=$.Deferred();return this.set("addressVMStatus","getAddressCalled"),this.set("address",null),this.set("addressList",null),this.models.addressModel.set({postalCode:this.get("postalCode")
}),this.models.addressModel.fetch({success:b.bind(this._getAddressSuccess,this,a),error:b.bind(this._getAddressError,this,a)}),a}},_getAddressSuccess:function(a,b,c){var d=c.ImplSearchAddressResponse.geographicAddress;this.set("addressList",d),this.set("addressVMStatus","getAddressSuccess"),a.resolve(d)},_getAddressError:function(a,b,c){if(c.responseText){var d=JSON.parse(c.responseText),e=d&&d.ErrorInfo&&d.ErrorInfo.backendErrorInfo;if(e){var f=e.split(":"),g=f[1].split(";");this.set("addressError",g[1]||g[0])}}else c.statusText&&this.set("addressError",c.statusText);this.set("addressVMStatus","getAddressError"),a.reject(c)}});return d});
define("businesswidget/repository_l9_common/common/utils/utility",["underscore","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","jquery","businesswidget/repository/common/util/Util"],function (a,b,c,d,e,f){var g={isDevice:!1,format:{ddMonthNameYY:0,"dd/MM/YYYY":1},init:function(){this.checkForDevice()},getAllData:function(a){var b=new Object,c=new Date(a);return b.currentLocale=d.getLocale().toLowerCase(),b.hours=c.getHours(),b.minutes=c.getMinutes(),b.seconds=c.getSeconds(),b.fullYear=c.getFullYear(),b.shortYear=""+new String(c.getFullYear()).substring(2,4),b.day=c.getDate(),b.month=c.getMonth()+1,1==b.month.toLocaleString().length&&(b.month=0+b.month.toLocaleString()),b.monthStr=f.monthName(c.getMonth()),b.shortMonthStr=f.shortMonthName(c.getMonth()),b},convertToTime:function(a){return new Date(a).getTime()},getDisplayDate:function(a,b){var c=this.getAllData(a),d="";switch(b){case this.format.ddMonthNameYY:switch(c.currentLocale){case"en-us":d=c.day+" "+c.monthStr+" "+c.shortYear;break;case"fr-fr":d=c.day+" "+c.monthStr+" "+c.shortYear;break;default:d=c.day+" "+c.monthStr+" "+c.shortYear}break;case this.format["dd/MM/YYYY"]:switch(c.currentLocale){case"en-us":d=c.day+"/"+c.month+"/"+c.fullYear;break;case"fr-fr":d=c.day+"/"+c.month+"/"+c.fullYear;break;default:d=c.day+"/"+c.month+"/"+c.fullYear}}return d},calculateRefDate:function(a){var b=(new Date).getTime()-24*a*3600*1e3;return this.getDisplayDate(b,1)},checkForDevice:function(){null!=navigator.userAgent.match(/(windows)/i)||void 0!=navigator.userAgent.match(/(windows)/i)||navigator.userAgent.match(/(windows)/i)?this.isDevice=!1:this.isDevice=!0},isLetter:function(a){return 1===a.length&&a.match(/[a-z]/i)},isDigit:function(a){return 1===a.length&&a.match(/[0-9]/i)},validateNRIC:function(a){if(9!=a.length)return!1;var b=a.charAt(0).toUpperCase(),c=a.charAt(a.length-1).toUpperCase();if("S"!=b&&"T"!=b)return!1;if(!this.isLetter(c))return!1;for(var d=1;d<8;d++){var e=a.charAt(d);if(!this.isDigit(e))return!1}return!!this.UIN(a)},appendPhoneNumber:function(a){return a="54"+a},UIN:function(a){var b=a.charAt(0).toUpperCase();if("S"!=b&&"T"!=b)return!1;var c=0,d=7;c+=2*a.charAt(1);for(var e=2;e<8;e++)c+=a.charAt(e)*d,d--;"T"==b&&(c+=4);var f,g=11-c%11,h=a.charAt(a.length-1).toUpperCase();switch(g){case 1:f="A";break;case 2:f="B";break;case 3:f="C";break;case 4:f="D";break;case 5:f="E";break;case 6:f="F";break;case 7:f="G";break;case 8:f="H";break;case 9:f="I";break;case 10:f="Z";break;case 11:f="J";break;default:f=" "}return h==f}};return g.init(),g});
define("businesswidget/repository_l9_common/common/model/ChangeOwnershipDonorValidatorModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/change-owner/service-id/:serviceId/validatetransferor",rest:{create:{method:"POST",contentType:"application/json",payload:["ImplValidateCOInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ChangeOwnershipRecipientValidatorModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/customer-management/verify-customer",rest:{create:{method:"POST",contentType:"application/json",payload:["ImplValidateCustomerRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ChangeOwnershipRecipientInitModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/customer-management/transferee",rest:{create:{method:"POST",contentType:"application/json",payload:["ImplOwnerShipDetails"]}}},parse:function(a){return a.ImplManageTransfereeOutput&&(a.ImplManageTransfereeOutput.requests=_.map(a.ImplManageTransfereeOutput.requests,function(a){return a.listOfAddOns&&(a.addons=a.listOfAddOns.split(", ")),a})),a}})});
define("businesswidget/repository_l9_common/common/model/ChangeOwnershipDonorDetails",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/customer-management/transfer-ownership-details",rest:{create:{method:"POST",contentType:"application/json",payload:["ImplOwnerShipDetails"]}}}})});
define("businesswidget/repository_l9_common/common/model/CommerceCustomerProductOrderPayChannelModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"commerce/customer/:customerId/product-order/:productOrderId/pay-channel",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"PUT",payload:["PayChannelProductOrderDetails"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ChangeOwnershipRecipientDataModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/customer-management/update-request-status",rest:{create:{method:"POST",contentType:"application/json",payload:["ImplTransferOwnerShipDetailsInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ChangeOwnershipViewModel",["jquery","underscore","knockout","lightsaber","businesswidget/repository/common/core/Configuration","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/utils/utility","businesswidget/repository_l9_common/common/model/ChangeOwnershipDonorValidatorModel","businesswidget/repository_l9_common/common/model/ChangeOwnershipRecipientValidatorModel","businesswidget/repository_l9_common/common/model/ChangeOwnershipRecipientInitModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","businesswidget/repository_l9_common/common/model/ChangeOwnershipDonorDetails","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/CommerceCustomerProductOrderPayChannelModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","businesswidget/repository_l9_common/common/model/ChangeOwnershipRecipientDataModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/model/BillingAccountDetailedListModel","businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel","businesswidget/repository_l9_common/common/model/findCallerByContactModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){return d.Core.ObservableViewModel.extend({models:{donorValidator:h,recipientAllowedModel:i,recipientInitCheck:j,findCaller:v,upcModelForAllScenarios:l,donorOrderDetails:m,submitRecipientOrder:p,productOrderPayChannelModel:o,cancelOrderModel:r,recipientUpdator:q,getBillingAccountDetailedListModel:x,billingAccountDetailedListModel:t,customerBillSpecIdPayChannel:u,updateContactModel:w},subViewModels:{onePassTopicViewModel:k,contactInContextTopicViewModel:n,implUserContextTopicViewModel:s},defaults:{donorVMStatus:{recipient:"",donor:"",confirm:""},accountId:null,serviceId:null,nricId:"",nricType:"",validationResult:null,contactId:null,customerId:null,productId:null,donorNRIC:null,recipientNRIC:null,recipientNRICType:null,recipientChownResponse:null,faId:null,recipientVMStatus:{request:!1,start:!1,confirm:!1,postconfirm:!1},listOfAddOns:null,accountType:null,errorInfo:{errorState:null},requestType:null,errorState:{ERROR_RECIPENT_DB_RETRIEVE_FAILED:"ERROR_RECIPENT_DB_RETRIEVE_FAILED",ERROR_RECIPENT_ORDER_FAILED:"ERROR_RECIPENT_ORDER_FAILED",ERROR_RECIPENT_DB_FAILED:"ERROR_RECIPENT_DB_FAILED",ERROR_RECIPENT_CANCEL_FAILED:"ERROR_RECIPENT_CANCEL_FAILED",ERROR_RECIPENT_PCN_FAILED:"ERROR_RECIPENT_PCN_FAILED",ERROR_DONOR_NOT_ALLOWED:"ERROR_DONOR_NOT_ALLOWED",ERROR_DONOR_ORDER_VALIDATION:"ERROR_DONOR_ORDER_VALIDATION",ERROR_DONOR_RECIPIENT_VALIDATION:"ERROR_DONOR_RECIPIENT_VALIDATION",ERROR_NEW_ACCOUNT_CREATION_FAILED:"ERROR_NEW_ACCOUNT_CREATION_FAILED",SYSTEM_ERROR:"SYSTEM_ERROR",GENERAL:"GENERAL"},userInfo:null,recipientCustomerNumber:null},dataBindings:[{recipientNRIC:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{recipientNRICType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{donorNRIC:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{userInfo:"subViewModels.implUserContextTopicViewModel.userInfo",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){b.bindAll(this,"validateDonor","isRecipientAllowed","createAndSubmitDonorOrder","hasChangeOwnershipRequest","updateProductOrderPayChannel","createNewBillingAccount","handleRequest","submitRecipientOrder"),this.on("change:recipientNRIC",function(){var a=this.get("recipientNRIC");a&&this.hasChangeOwnershipRequest()}.bind(this))},getUPCPayload:function(){return{ImplSubmitProductConfigurationRestInput:{updateProductConfigurationRequest:{performSave:!1,returnRemovedItems:!1,configurationLevel:"FULL",runCompatibilityRules:!0,confirmationMessagesApproved:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0},submitProductOrder:!1,settingsView:"FULL",productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:[],newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],orderActionReasonX8:"CREQ",orderActionTypeX8:"CW"},newCustomerForCW:null}}},isRecipientAllowed:function(){this.setValueByPath("donorVMStatus.recipient","PROCESSING"),this.checkRecipientExist().then(function(a){a?this.validateChownOrder().then(function(a){this.setValueByPath("donorVMStatus.recipient",a?"SUCCESS":"FAILURE")}.bind(this),function(){this.setValueByPath("donorVMStatus.recipient","FAILURE")}.bind(this)):this.setValueByPath("donorVMStatus.recipient","FAILURE")}.bind(this),function(a){this.setValueByPath("donorVMStatus.recipient","FATAL")}.bind(this))},checkRecipientExist:function(){var a={ImplValidateCustomerRestInput:{indentType:"National Registration ID Card (NRIC)",indentValue:this.get("nricId")}},b=this.getModel("recipientAllowedModel");return b.save(a).then(function(a){if(a.ImplValidateCustomerRestOutput){if(a.ImplValidateCustomerRestOutput.allowedForTransfer){var b=a.ImplValidateCustomerRestOutput.customerId;return this.set("recipientCustomerNumber",b),!0}return this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_DONOR_RECIPIENT_VALIDATION),!1}return!1}.bind(this),function(a){return this.set("errorInfo",a.responseJSON.ErrorInfo),!1}.bind(this))},onRecipientAllowedSuccess:function(a,b){b.ImplValidateCustomerRestOutput?this.setValueByPath("donorVMStatus.recipient",b.ImplValidateCustomerRestOutput.allowedForTransfer?"SUCCESS":"FAILURE"):this.onRecipientAllowedError()},onRecipientAllowedError:function(){this.setValueByPath("donorVMStatus.recipient","FAILURE")},validateDonor:function(){this.setValueByPath("donorVMStatus.donor","PROCESSING");var a={ImplValidateCOInput:{accountId:this.get("accountId")}},c=this.getModel("donorValidator");c.set("serviceId",this.get("serviceId")),c.save({ImplValidateCOInput:a.ImplValidateCOInput},{success:b.bind(this.onvalidateDonorSuccess,this),error:b.bind(this.onvalidateDonorError,this)})},onvalidateDonorSuccess:function(a,b){b.ImplValidateCOOutput.success?(this.set("validationResult",b.ImplValidateCOOutput),this.setValueByPath("donorVMStatus.donor","SUCCESS")):b.ImplValidateCOOutput.success===!1&&(this.set("errorInfo",b.ImplValidateCOOutput.errorInfo),this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_DONOR_NOT_ALLOWED),this.setValueByPath("donorVMStatus.donor","FAILURE"))},onvalidateDonorError:function(a,b){b.responseJSON.ErrorInfo?(this.set("errorInfo",b.responseJSON.ErrorInfo),this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_DONOR_NOT_ALLOWED),this.setValueByPath("donorVMStatus.donor","FAILURE")):(this.set("errorInfo",{errorCode:"FATAL",errorInfo:"System is DOWN"}),this.setValueByPath("errorInfo.errorState",this.get("errorState").SYSTEM_ERROR),this.setValueByPath("donorVMStatus.donor","FATAL"))},processTransferOwnershipCharges:function(a){var c=a.displayableItems,d=this.get("transfer_ownership_charges").billingOffer;b.each(c,function(c){billingOfferRelationship=c.displayableBillingOffers,b.each(billingOfferRelationship,function(b){if(b.productSpecPricing.childPricingSchema.id==d){var c={productSpecPricingID:b.productSpecPricingID,parentProductID:a.productID};this.set("newContainedProducts",[c])}}.bind(this))}.bind(this))},validateChownOrder:function(){var a=this.getUPCPayload();a.ImplSubmitProductConfigurationRestInput.newCustomerForCW=this.get("recipientCustomerNumber");var b=this.getModel("upcModelForAllScenarios");return b.set({contactId:this.get("contactId"),customerId:this.get("customerId"),productId:this.get("productId")}),b.save({ImplSubmitProductConfigurationRestInput:a.ImplSubmitProductConfigurationRestInput}).then(function(a){if(a.ImplSubmitProductConfigurationRestOutput){var b=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productConfiguration;return"COMPATIBLE"===b.compatibilityStatus||"INFORMATION"===b.compatibilityStatus?(this.processTransferOwnershipCharges(b),!0):(this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_DONOR_ORDER_VALIDATION),!1)}return!1}.bind(this),function(a){return this.set("errorInfo",a.responseJSON.ErrorInfo),this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_DONOR_ORDER_VALIDATION),!1}.bind(this))},getRecipientCustID:function(){var a=this.getModel("findCaller"),b={ImplFindCallerByContactInput:{implContactDetails:{indentType:"National Registration ID Card (NRIC)",indentValue:this.get("nricId")}}};return a.save({ImplFindCallerByContactInput:b.ImplFindCallerByContactInput}).then(function(a){return a.ImplFindCallerByContactOutput.contactCustomerDetails[0].customerId}.bind(this),function(){return null}.bind(this))},createAndSubmitDonorOrder:function(){this.setValueByPath("donorVMStatus.confirm","PROCESSING");var a=this.getUPCPayload();a.ImplSubmitProductConfigurationRestInput.newCustomerForCW=this.get("recipientCustomerNumber"),a.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.performSave=!0,a.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.submitProductOrder=!1,a.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.productChanges.newContainedProducts=this.get("newContainedProducts");var c=this.getModel("upcModelForAllScenarios");c.set({contactId:this.get("contactId"),customerId:this.get("customerId"),productId:this.get("productId")}),c.save({ImplSubmitProductConfigurationRestInput:a.ImplSubmitProductConfigurationRestInput},{success:b.bind(this.oncreateAndSubmitDonorOrderSuccess,this),error:b.bind(this.oncreateAndSubmitDonorOrderFailure,this)})},oncreateAndSubmitDonorOrderSuccess:function(a,b){b.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productOrderID?this.saveDonorData(b).then(function(a){this.setValueByPath("donorVMStatus.confirm",a?"SUCCESS":"FAILURE")}.bind(this),function(a){this.setValueByPath("donorVMStatus.confirm","FAILURE")}.bind(this)):(this.set("validationResult",b.ImplSubmitProductConfigurationRestOutput),this.oncreateAndSubmitDonorOrderFailure())},oncreateAndSubmitDonorOrderFailure:function(){this.setValueByPath("donorVMStatus.confirm","FATAL")},saveDonorData:function(a){donorDataSave=this.getModel("donorOrderDetails");var b=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productOrderID,c=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productOrderItemID,d=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productID,e=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productConfiguration.productOffering.name,f=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse.productConfiguration.totalOneTimeCalculatedPrice.finalAmountIncludingTax,g=this.get("listOfAddOns"),h=this.get("accountType"),i={ImplOwnerShipDetails:{transferorId:this.get("donorNRIC"),transferorIdType:"NRIC",transferorName:this.get("userInfo").contactDetails.registeredName,serviceId:this.get("serviceId"),transfereeId:this.get("nricId"),transfereeIdType:"NRIC",listOfAddOns:g.join(", "),planName:e,transferFee:f,orderId:b,productId:d+"_"+this.get("recipientCustomerNumber"),orderActionId:c,serviceType:h?"EASY_MOB":"MOB"}};return donorDataSave.save({ImplOwnerShipDetails:i.ImplOwnerShipDetails}).then(function(a){return"SUCCESS"===a.ImplTransferOwnerShipDetailsOutput.status}.bind(this),function(a){return this.cancelChangeOwnershipOrder(b,c),!1}.bind(this))},cancelChangeOwnershipOrder:function(a,b){var c=this.getModel("cancelOrderModel");return c.set({customerId:this.get("customerId"),productOrderId:a,productOrderItemId:b}),c.setQueryParams({poi:[b]}),c.destroy().then(function(a){return!0}.bind(this),function(a){return!1}.bind(this))},hasChangeOwnershipRequest:function(){this.setValueByPath("recipientVMStatus.request",!1);var a={ImplOwnerShipDetails:{transfereeId:this.get("recipientNRIC"),transfereeIdType:"NRIC"}},b=this.getModel("recipientInitCheck");b.save({ImplOwnerShipDetails:a.ImplOwnerShipDetails},{success:function(a,b){b&&b.ImplManageTransfereeOutput&&b.ImplManageTransfereeOutput.requests&&(this.set("recipientChownResponse",b.ImplManageTransfereeOutput),this.setValueByPath("recipientVMStatus.request",!0))}.bind(this),error:function(a){this.setValueByPath("errorInfo.errorState",this.getValueByPath("errorState.ERROR_RECIPENT_DB_RETRIEVE_FAILED"))}.bind(this)})},updateProductOrderPayChannel:function(){if(this.setValueByPath("recipientVMStatus.start",!1),this.get("recipientChownResponse")){var a=0,b=this.get("recipientChownResponse").requests[a];this.set("chownSelectedData",b);var c={PayChannelProductOrderDetails:{productOrderDetails:[{paymentCatergory:"POST",pcnId:this.get("faId"),productOrderItemId:b.orderActionId}]}},d=this.getModel("productOrderPayChannelModel");d.set({productOrderId:b.orderId,customerId:this.get("customerId")}),d.save({PayChannelProductOrderDetails:c.PayChannelProductOrderDetails}).then(function(a){if(!a.CustomerPayChannelOutput)return this.setValueByPath("recipientVMStatus.start",!1),a;var c=b.orderId+"A";this.updateContact(c,b.orderActionId).then(function(a){return this.setValueByPath("recipientVMStatus.start",!0),a}.bind(this)).then(function(a){return this.setValueByPath("recipientVMStatus.start",!1),a}.bind(this))}.bind(this),function(a){a&&a.responseJSON&&this.set("errorInfo",a.responseJSON.ErrorInfo),this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_PCN_FAILED),this.setValueByPath("recipientVMStatus.start",!1)}.bind(this))}},updateContact:function(a,b){var c=this.getModel("updateContactModel");c.set({customerId:this.get("customerId"),orderId:a});var d={orderAction:[{contactId:this.get("contactId"),orderActionId:b,userOnBehalf:"Online"}]};return c.setQueryParams({isAnonymous:!1}),c.save({ImplAddCustomerContactRestInput:d}).then(function(a){return!0}.bind(this)).then(function(a){return!1}.bind(this))},submitRecipientOrder:function(){this.setValueByPath("recipientVMStatus.confirm","PROCESSING");var a=this.getModel("submitRecipientOrder"),c=this.get("chownSelectedData");a.setQueryParams({orderIds:c.orderId+"A"}),a.set("customerId",this.get("customerId")),a.save(null,{success:b.bind(this.onSubmitRecipientOrderSuccess,this),error:b.bind(this.onSubmitRecipientOrderFailure,this)})},onSubmitRecipientOrderSuccess:function(a,b){b&&b.SubmitOrderResponse&&b.SubmitOrderResponse.failedOrders?(this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_ORDER_FAILED),this.setValueByPath("recipientVMStatus.confirm","FAILURE")):b?this.updateDonorData("ACCEPTED").then(function(a){a?this.setValueByPath("recipientVMStatus.confirm","SUCESSS"):this.cancelOrder().then(function(a){this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_DB_FAILED),this.setValueByPath("recipientVMStatus.confirm","FAILURE")}.bind(this),function(a){this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_CANCEL_FAILED),this.setValueByPath("recipientVMStatus.confirm","FAILURE")}.bind(this))}.bind(this),function(a){this.set("errorInfo",a.ErrorInfo),this.cancelOrder().then(function(a){this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_DB_FAILED),this.setValueByPath("recipientVMStatus.confirm","FAILURE")}.bind(this),function(a){this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_CANCEL_FAILED),this.setValueByPath("recipientVMStatus.confirm","FAILURE")}.bind(this))}.bind(this)):(this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_ORDER_FAILED),this.setValueByPath("recipientVMStatus.confirm","FAILURE"))},updateDonorData:function(a){var b=this.get("chownSelectedData"),c={ImplTransferOwnerShipDetailsInput:{orderId:b.orderId,transfereeNRIC:b.transfereeId,statusToUpdate:a}},d=this.get("newBillingAccountDetails");if(d&&d.physicalAddress){var e=d.physicalAddress,f=e.houseNumber+", "+e.streetName+", "+e.unitNumber+", SINGAPORE "+e.postcode;c.ImplTransferOwnerShipDetailsInput.newBillingAddress=f}return recipientUpdator=this.getModel("recipientUpdator"),recipientUpdator.save({ImplTransferOwnerShipDetailsInput:c.ImplTransferOwnerShipDetailsInput}).then(function(a){return"SUCCESS"===a.ImplTransferOwnerShipDetailsOutput.status}.bind(this),function(a){return!1}.bind(this))},onSubmitRecipientOrderFailure:function(a,b){this.set("errorInfo",b.responseJSON.ErrorInfo),this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_RECIPENT_ORDER_FAILED),this.setValueByPath("recipientVMStatus.confirm","FATAL")},handleRequest:function(){var a=0,b=this.get("recipientChownResponse").requests[a];this.set("chownSelectedData",b);var c=this.get("requestType"),d=null;switch(c){case"CLOSE":d="CLOSED";break;case"REJECT":this.set("customerId",b.productId.split("_")[1]||null),this.cancelOrder(),d="REJECTED"}this.updateDonorData(d).then(function(a){a?this.setValueByPath("recipientVMStatus.confirm",d+"_SUCESSS"):this.setValueByPath("recipientVMStatus.confirm",d+"_FAILURE")}.bind(this),function(a){this.set("errorInfo",a.ErrorInfo),this.setValueByPath("recipientVMStatus.confirm",d+"_FAILURE")}.bind(this))},cancelOrder:function(){var a=this.getModel("cancelOrderModel"),b=this.get("chownSelectedData");return a.set({customerId:this.get("customerId"),productOrderId:b.orderId,productOrderItemId:b.orderActionId}),a.setQueryParams({poi:[b.orderActionId]}),a.destroy().then(function(a){return!0}.bind(this),function(a){return!1}.bind(this))},createNewBillingAccount:function(){var a=this,c=a.get("customerId"),d=this.get("newBillingAccountDetails"),e=a.getModel("billingAccountDetailedListModel");e.save({ImplBillingAccountCreateRequest:d},{customerId:c,success:b.bind(a.getBillSpecIdPayChannel,a),error:function(){this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_NEW_ACCOUNT_CREATION_FAILED)}})},getBillSpecIdPayChannel:function(a,b){var c=this;if(b.ImplBillingAccountCreateResponse&&b.ImplBillingAccountCreateResponse.billingArangmentId){var a=this.getModel("customerBillSpecIdPayChannel");a.fetch({customerBillSpecId:b.ImplBillingAccountCreateResponse.billingArangmentId,success:function(a,b){c.set("faId",b),c.updateProductOrderPayChannel(),c.getFaidForNewAccount()},error:function(){this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_NEW_ACCOUNT_CREATION_FAILED)}})}else this.setValueByPath("errorInfo.errorState",this.get("errorState").ERROR_NEW_ACCOUNT_CREATION_FAILED)},getFaidForNewAccount:function(){var a=this,c=this.get("faId"),d=this.getModel("getBillingAccountDetailedListModel"),e=["X","T"];d.setQueryParams({includeBAStatus:e}),d.set("type","NRIC"),d.fetch({id:this.get("recipientNRIC"),success:function(d,e){if("undefined"!=typeof e.ImplBillingAccountDetailsResponse){var f=b.where(e.ImplBillingAccountDetailsResponse.billingAccountDetails,{billingAccountNumber:c});a.set("faId",f[0].faid)}},error:function(){}})}})});
define("businesswidget/repository_l9_common/widgetsLibrary/viewBillCurrentChargesWidget/common/constants",{"ViewModel":{"LOB_TV":"SINGTEL TV","LOB_INTERNET":"SINGNET","LOB_TELEPHONE":"TELEPHONE","LOB_MOBILE":"MOBILE","LOB_OTHER":"OTHER"}});
define("businesswidget/repository_l9_common/common/model/ViewBillCurrentChargesModel",["lightsaber","businesswidget/repository/common/core/RESTModel","businesswidget/repository_l9_common/widgetsLibrary/viewBillCurrentChargesWidget/common/constants","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","moment"],function (a,b,c,d,e){return b.extend({options:{url:"ebill/customer/:customerId/billing-arrangement/:barId/bill/:billNumber/currentCharges",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},parse:function(a,b){var c=null;return a&&a.BillCharges&&(c=this._billMapper(a)),c},_billMapper:function(a){var b=0,f=0,g=function(a,c,e){var g,h=[],i=null,j=0,k=0,l=[];return h.g_Total=0,h.g_z_o_Total=0,"DISCOUNTS_AND_ADGUSTMENTS"===c?(i=_.filter(e,function(a,b){return"recurringCharges"==b||"usageCharges"==b||"oneTimeCharges"==b||"prorationChargesX8"==b}),_.each(_.flatten(i),function(a){l=l.concat(a.chargeDetails)}),g=a||[]):g=a&&a[0].chargeDetails||[],_.each(g,function(a){if("DISCOUNTS_AND_ADGUSTMENTS"===c){if(a.startDateX8&&a.taxLegendX8)a.taxLegendX8=a.taxLegendX8;else{var e=_.find(l,function(b){return b.chargeCodeX8==a.chargeCode});e&&(a.taxLegendX8=e.taxLegendX8||a.taxLegendX8)}a.chargeInitAmtX8=1*a.amount}"OTHER_CHARGE_CREDIT"!==c||a.taxLegendX8||(a.taxLegendX8=a.amount==a.chargeInitAmt?"Z":"G"),a.taxLegendX8&&"Z"===a.taxLegendX8?b+=a.chargeInitAmtX8||0:a.taxLegendX8&&"O"===a.taxLegendX8?f+=a.chargeInitAmtX8||0:j+=a.chargeInitAmtX8||0,k+=a.chargeInitAmtX8||0;var g=_.find(h,function(b){return b.name===a.consolidatedItemDescX8});if(g&&"UC"===c)g.amount+=a.amount,g.chargeInitAmt+=a.chargeInitAmtX8||0,g.usageVolume+=a.usageVolume;else{var i,m;a.subPlanDescX8&&a.consolidatedItemDescX8?(i=a.consolidatedItemDescX8,m=a.subPlanDescX8||""):a.isTerminatedX8?(i=d.getString("cm_viewBillCurrentCharges_chargeType_OC_termination"),m=a.description):(i=a.description,m=""),h.push({type:c,name:i||"",description:m||"",start:a.startDateX8?1*a.startDateX8:null,end:a.endDateX8?1*a.endDateX8:null,chargeDate:a.chargeDate?1*a.chargeDate:null,amount:a.amount,chargeInitAmt:a.chargeInitAmtX8,chargeType:a.chargeTypeX8||null,chargeCode:a.chargeCodeX8||null,isItemized:"true"===a.itemizedX8,taxLegendX8:a.taxLegendX8,usageVolume:a.usageVolume,usageUOMX8:a.usageUOMX8})}h.g_Total=j,h.g_z_o_Total=k}),h},h=function(a){a=(a||"").toUpperCase().trim();var b=c.ViewModel;return a&&a!==b.LOB_TV&&a!==b.LOB_INTERNET&&a!==b.LOB_TELEPHONE&&a!==b.LOB_MOBILE&&(a=b.LOB_OTHER),a},i=function(a){if(a.prorateCharges&&a.prorateCharges.length>0){var b=a.prorateCharges.g_Total,c=a.prorateCharges.g_z_o_Total;a.prorateCharges=_.map(a.prorateCharges,function(b){var c=_.find(a.recurringCharges,function(a){return a.name===b.name});if(b.proratedNoOfDays=e.duration(e(b.end).diff(e(b.start))).asDays()+1,b.noOfDaysInMonth=e(b.end).subtract(1,"month").daysInMonth(),c)b.monthlyCharge=c.chargeInitAmt;else{var d=b.chargeInitAmt/b.proratedNoOfDays;b.monthlyCharge=d*b.noOfDaysInMonth}return b}),a.prorateCharges.g_Total=b,a.prorateCharges.g_z_o_Total=c}return a.prorateCharges},j=function(a){a.zeroTaxableTotalCharges=0,a.totalTaxableAmount=0;var b={name:a.subscriptionDetails.subscriptionNameX8,subscriptionId:a.subscriptionDetails.subscriptionId,no:a.nodeResource,lobName:a.planIndicatorX8?null:h(a.lob),lob:a.lob,bundleId:a.subscriptionDetails.product.id||null,totalAmount:a.subscriptionTotalAmount,totalTaxAmount:a.totalTaxAmount,totalAmountWithoutTax:a.subscriptionTotalAmount-a.totalTaxAmount,oneTimeCharges:g(a.oneTimeCharges,"OC",a),prorateCharges:g(a.prorationChargesX8,"PR",a),recurringCharges:g(a.recurringCharges,"RC",a),usageCharges:g(a.usageCharges,"UC",a),discountsAndAdjustments:g((a.discounts||[]).concat(a.adjustments||[]),"DISCOUNTS_AND_ADGUSTMENTS",a),isPlan:a.planIndicatorX8||!1};return b.totalTaxableAmount=getAllGChargeSummation(b),b.prorateCharges=i(b),b};getAccountLevelCharge=function(a){if(a.hasOwnProperty("oneTimeCharges")){var b={name:"Other Charges",subscriptionId:"-",no:"",lobName:"OTHER",lob:"OTHER",zeroTaxableTotalCharges:0,oTaxableTotalCharges:0,gTaxableTotalCharges:0};return b.otherChargesCredit=g(a.oneTimeCharges,"OTHER_CHARGE_CREDIT",b),b.totalAmountWithoutTax=b.otherChargesCredit.g_z_o_Total,b.totalTaxableAmount=b.otherChargesCredit.g_Total,new Array(b)}return[]},getAllGChargeSummation=function(a){var b=a.oneTimeCharges.g_Total+a.usageCharges.g_Total+a.prorateCharges.g_Total+a.recurringCharges.g_Total+a.discountsAndAdjustments.g_Total;return b};var k=a.BillCharges.billingArrangement||{},l=a.BillCharges.subscriptions||[],m=k.bundlesX8||[],n={billtotalAmount:k.totalAmountWithoutTaxX8,gst:k.totalTaxAmount,totalAmountIncludeGst:k.totalAmountIncludeTaxX8,totalCurrentBillChargesWithGst:k.totalChargesWithoutBalanceX8,bundles:[],subscriptions:[]};return _.each(m,function(a){n.bundles.push({bundleId:a.ID,name:a.name||"",description:a.description||"",freeDescriptionX8:a.freeDescriptionX8||"",totalAmount:a.amount,subscriptions:[],totalTaxableAmount:0})}),n.accountLevelCharge=getAccountLevelCharge(k),0==n.bundles.length?_.each(l,function(a){var b=j(a);n.subscriptions.push(b)}):_.each(n.bundles,function(a){_.each(l,function(b){var c=j(b);c.name="GLP"==c.lob?a.name:c.name,a.bundleId==b.subscriptionDetails.product.id?(a.subscriptions.push(c),a.totalTaxableAmount=a.totalTaxableAmount+getAllGChargeSummation(c)):n.subscriptions.push(c)})}),n.totalTaxableServicesCharge=n.billtotalAmount-(b+f),n.totalNonTaxableServicesCharge=b,n.totalOTypeTaxableServiceCharge=f,n}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplSingtelEnergyViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/UserInformationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","businesswidget/repository_l9_common/common/model/AccountBillsModel","businesswidget/repository_l9_common/common/model/ViewBillCurrentChargesModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){
var o=a.Core.ObservableViewModel.extend({defaults:{autoRenewIndicator:null,assignedProductId:null,subscriptionId:null,customerId:null,barId:null,faId:null,serviceId:null,chNodeId:null,energyUsage:[],energyUsageCharges:[],contactId:null,energyVmStatus:null,productConfiguration:null,orderProductConfigurationInput:null,productOrderID:null,productOrderItemID:null,productOrderReferenceNumber:null,productOrderItemReferenceNumber:null},orderMap:{},models:{implSubmitProductConfigurationModel:f,customerProductOrderProductOrderItemsModel:h,accountBillsModel:m,viewBillCurrentChargesModel:n},subViewModels:{customerInContextTopicViewModel:d,productInContextTopicViewModel:e,contactInContextTopicViewModel:g,implUserContextTopicViewModel:i,userInformationViewModel:k,accountInContextTopicViewModel:l},dataBindings:[{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){},getEnergyUsage:function(){this.set("energyVmStatus","energyUsageInProgress"),this.models.accountBillsModel.fetch({id:this.get("customerId"),accountsID:this.get("barId"),success:c.bind(this.configureAccountBillingList,this)}),console.log(this.get())},configureAccountBillingList:function(a,b){var d=b.ImplBillsOutput.billList;if(d){this.set("energyUsageCharges",[]);var e=c.sortBy(d[this.get("barId")]," billClosedDate").reverse()||[];if(e.length){var f=0,g=[];c.each(e,function(a){if(f<=2){var b=this.getBillCharges(a);g.push(b)}f++}.bind(this)),$.when.apply(this,g).then(function(){var a=this.get("energyUsageCharges"),b=this.transformEnergyUsage(a);this.set("energyUsage",b),setTimeout(function(){this.set("energyVmStatus","energyUsageSet")}.bind(this),0)}.bind(this))}console.log(d)}},transformEnergyUsage:function(a){var b=a;return b=c.sortBy(b,function(a){return parseInt(a.chargeDate,10)})},getBillCharges:function(a){this.models.viewBillCurrentChargesModel.setQueryParams({bcd:a.billClosedDate});var b=this.models.viewBillCurrentChargesModel.fetch({customerId:a.customerId,barId:a.billingArrangement,billNumber:a.billNumber,success:function(a,b){var d=this.get("subscriptionId"),e=c.find(b.BillCharges.subscriptions,function(a){return a.subscriptionDetails.subscriptionId==d});e&&this.updateUsage(e)}.bind(this)});return b},updateUsage:function(a){var b=this.get("energyUsageCharges");c.each(a.usageCharges,function(d){c.each(d.chargeDetails,function(c){"kWh"===c.usageUOMX8&&(c.smartTotalUsageX8=a.smartTotalUsageX8,c.nationalAverageX8=a.nationalAverageX8,b.push(c))})}),this.set("energyUsageCharges",b)},accumulateEnergyUsageCharges:function(a){},updateAutoRenewIndicator:function(){this.set("energyVmStatus","updateAutoRenewIndicatorInProgress"),this.setOrderProductConfigurationInput(null),this.updateAssignedProductConfiguration(!0)},updateAutoRenewIndicatorSuccess:function(){this.set("energyVmStatus","autoRenewIndicatorSuccess"+this.get("autoRenewIndicator"))},updateAutoRenewIndicatorError:function(){this.set("energyVmStatus","autoRenewIndicatorError")},updateAssignedProductConfiguration:function(a){this.set("energyVmStatus","UpdateAssignedProductConfiguration");var b=this.getProductConfigurationInput(a);b.orderActionReasonX8="CREQ",b.orderActionTypeX8="CH";var d={updateProductConfigurationRequest:b,subscriberId:this.get("subscriptionId")},e=this.get("customerId"),f=this.getModel("implSubmitProductConfigurationModel"),g={contactId:this.get("contactId"),customerId:e,productId:this.get("assignedProductId")};f.set(g),f.save({ImplSubmitProductConfigurationRestInput:d},{success:c.bind(this.onUpdateAssignedProductConfigurationSuccess,this),error:c.bind(this.onProductConfigurationError,this)})},onProductConfigurationError:function(){this.updateAutoRenewIndicatorError()},onUpdateAssignedProductConfigurationSuccess:function(a,b){var c=b.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse;this.setCreateOrderResponse(c);var d=c.productConfiguration,e=this.getErrorsFromUpdateProductConfiguration(d);e.isError?(this.cancelOrder(),this.updateAutoRenewIndicatorError()):this.updateAutoRenewIndicatorSuccess()},getOrderProductConfigurationInput:function(){var a=this.get("orderProductConfigurationInput");return a||(a={removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}),a},setOrderProductConfigurationInput:function(a){this.set("orderProductConfigurationInput",a)},updateProductConfigurationForEnergyAutoRenewIndicator:function(a){var b={productID:this.get("assignedProductId"),changedCharacteristics:[{characteristicID:"18683321",value:this.get("autoRenewIndicator")}]};return a.changedContainedProducts.push(b),a},getProductConfigurationInput:function(a){var b=this.getOrderProductConfigurationInput();b=this.updateProductConfigurationForEnergyAutoRenewIndicator(b),this.setOrderProductConfigurationInput(b);var c=b,d={runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",submitProductOrder:a,productChanges:[c],returnConfigurationData:{catalogDataInd:!1,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}};return d},onUserInfoReceived:function(a){this.set("isAnonymous",a.anonymousUser),this.set("addonsVmStatus","userInformationSet")},cancelOrder:function(){this.set("energyVmStatus","CancelOrderInProgress");var a=this.get("productOrderID");if(null!==a){var b=this.getModel("customerProductOrderProductOrderItemsModel");b.set("productOrderId",a);var c=[];return c.push(this.get("productOrderItemID")),b.setQueryParams({poi:c}),b.set("id",c),b.set("customerId",this.get("myAccountCustomerId")),b.destroy()}},setOrderProductConfigurationInput:function(a){this.set("orderProductConfigurationInput",a)},getOrderProductConfigurationInput:function(){var a=this.get("orderProductConfigurationInput");return a||(a={removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}),a},setCreateOrderResponse:function(a){this.set("productOrderID",a.productOrderID),this.set("productOrderItemID",a.productOrderItemID),this.set("productOrderReferenceNumber",a.productOrderReferenceNumber),this.set("productOrderItemReferenceNumber",a.productOrderItemReferenceNumber)},getErrorsFromUpdateProductConfiguration:function(a){var b=a.messages,d={isError:!1,messages:[]};return b&&c.each(b,function(a){"ERROR"===a.severity&&(d.isError=!0,d.messages.push(a.text))}),d},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})}});return o});
define("l9_common.careWidgets",{"billingAccountSummaryWidget":"businesswidget/repository_l9_common/widgetsLibrary/BillingAccountSummaryWidget/web/BillingAccountSummaryWidget","viewUpdateCustomerWidget":"businesswidget/repository_l9_common/widgetsLibrary/viewUpdateCustomerWidget/web/ViewUpdateCustomerWidget","addressWidget":"businesswidget/repository_l9_common/widgetsLibrary/addressWidget/web/AddressWidget","userIdPasswordWidget":"businesswidget/repository_l9_common/widgetsLibrary/userIdPasswordWidget/web/UserIdPasswordWidget","viewServiceDetailsWidget":"businesswidget/repository_l9_common/widgetsLibrary/viewServiceDetailsWidget/web/viewServiceDetailsWidget","selectNumberWidget":"businesswidget/repository_l9_common/widgetsLibrary/selectNumberWidget/web/SelectNumberWidget","numberPortinWidget":"businesswidget/repository_l9_common/widgetsLibrary/numberPortinWidget/web/NumberPortinWidget","numberOptionsWidget":"businesswidget/repository_l9_common/widgetsLibrary/numberOptionsWidget/web/NumberOptionsWidget","UnbilledUsageWidget":"businesswidget/repository_l9_common/widgetsLibrary/UnbilledUsageWidget/web/UnbilledUsageWidget","sendFeedbackWidget":"businesswidget/repository_l9_common/widgetsLibrary/SendFeedbackWidget/web/SendFeedbackWidget","terminateEasyMobileWidget":"businesswidget/repository_l9_common/widgetsLibrary/TerminateEasyMobileWidget/web/TerminateEasyMobileWidget","implLoginViewModel":"businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","overUsedDetailsWidget":"businesswidget/repository_l9_common/widgetsLibrary/overUsedDetailsWidget/web/overUsedDetailsWidget","VoucherWidget":"businesswidget/repository_l9_common/widgetsLibrary/VoucherWidget/web/VoucherWidget","recontractPlanWidget":"businesswidget/repository_l9_common/widgetsLibrary/recontractPlanWidget/web/recontractPlanWidget","ChangePlanWidget":"businesswidget/repository_l9_common/widgetsLibrary/ChangePlanWidget/web/ChangePlanWidget","ChangeSimWidget":"businesswidget/repository_l9_common/widgetsLibrary/ChangeSimWidget/web/ChangeSimWidget","ImplAssignedProductDetailsViewModel":"businesswidget/repository_l9_common/common/viewmodel/ImplAssignedProductDetailsViewModel","RelocateMyServicesViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/RelocateMyServicesViewModel","PayMeansViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/PayMeansViewModel","ChangeEbillPreferenceViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ChangeEbillPreferenceViewModel","ChangeMobileNumberViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ChangeMobileNumberViewModel","SuspendServiceViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SuspendServiceViewModel","ResumeServiceViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ResumeServiceViewModel","TweakEasyMobilePlanViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/TweakEasyMobilePlanViewModel","EmailVerificationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/EmailVerificationViewModel","ContactReContractViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ContactReContractViewModel","KeyNominationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/KeyNominationViewModel","AppointmentStatusViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/AppointmentStatusViewModel","ImplLogoutViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ImplLogoutViewModel","ImplTimelineViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ImplTimelineViewModel","UpdateVerifyViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/UpdateVerifyViewModel","ImplConsolidateAccountsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ImplConsolidateAccountsViewModel","OrderDetailsModelViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/OrderDetailsModelViewModel","BillPdfDownloadViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/BillPdfDownloadViewModel","RetrieveAddressViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel","NotificationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","ChangeOwnershipViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ChangeOwnershipViewModel","ImplSingtelEnergyViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ImplSingtelEnergyViewModel","ShopNowTopicViewModel":"businesswidget/repository_l9_common/common/viewmodel/ShopNowTopicViewModel","DqmsUnbilledDataUsageViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/DqmsUnbilledDataUsageViewModel"});
define("l9_common.careTopics",{"ImplCustomerInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"ImplUserContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","vmKeys":{"data.userInfo":"userInfo","data.permissions":"permissions"},"mode":"pubsub"},"ViewServiceDetailsContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/viewServiceDetailsViewModel","vmKeys":{"data.services":"services","data.bundles":"bundles","data.options":"options","data.miniDesign":"miniDesign","data.currentCustomerId":"currentCustomerId","data.currentPersonId":"currentPersonId","data.currentProductId":"currentProductId","data.currentSubscriptionId":"currentSubscriptionId","data.currentPageIndex":"currentPageIndex","data.offeringInstanceId":"offeringInstanceId","data.currentAccountId":"currentAccountId","data.currentUsageType":"currentUsageType","data.chNodeId":"chNodeId","data.dataInfinityXLiteList":"dataInfinityXLiteList","data.productId":"productId","data.otherVouchers":"otherVouchers","data.islobTypeFBB":"islobTypeFBB","data.currentServiceId":"currentServiceId","data.viewServiceDetailsVMStatus":"viewServiceDetailsVMStatus","data.dqmsToken":"dqmsToken","data.alertOptionsList":"alertOptionsList","data.unbilledUsagePlansList":"unbilledUsagePlansList","data.planId":"planId","data.sponsoredCrOn":"sponsoredCrOn","data.usageLimitMap":"usageLimitMap","data.supplementaryLineIds":"supplementaryLineIds","data.filteredChildLines":"filteredChildLines","data.limitAlertSettingData":"limitAlertSettingData","data.alertHistoryList":"alertHistoryList","data.alertOptionData":"alertOptionData","data.supplementryLineUsageDetails":"supplementryLineUsageDetails","data.updatedDataLimit":"updatedDataLimit","data.currentSubscriptionPlanId":"currentSubscriptionPlanId","data.assignedProductDetails":"assignedProductDetails","data.suspensionRequestData":"suspensionRequestData","data.suspensionTransactionId":"suspensionTransactionId","action.toggleService":"toggleService","action.getProductDetails":"getProductDetails","action.getUnbilledUsage":"getUnbilledUsage","action.getUnbilledUsageEvents":"getUnbilledUsageEvents","action.getAllVouchers":"getAllVouchers","action.setMobileShareChildLimit":"setMobileShareChildLimit","action.getAlertHistory":"getAlertHistory","action.getLocalAlertOptions":"getLocalAlertOptions","action.setLocalAlertOptions":"setLocalAlertOptions","action.getRoamingAlertOptions":"getRoamingAlertOptions","action.setRoamingAlertOptions":"setRoamingAlertOptions","action.getDataUsage":"getDataUsage","action.getDqmsToken":"getDqmsToken","action.cancelSuspensionRequest":"cancelSuspensionRequest","action.retrieveCIAmt":"retrieveCIAmt"},"mode":"pubsub"},"ImplIndividualInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","vmKeys":{"data.personId":"personId","data.contactFirstName":"contactFirstName","data.contactLastName":"contactLastName","data.contactFormattedName":"contactFormattedName"},"mode":"pubsub"},"customerProductOrders":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductOrderTopicViewModel","vmKeys":{"data.productOrderID":"productOrderID"},"mode":"pubsub"},"customerProductOrdersItem":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductConfigurationTopicViewModel","vmKeys":{"data.productOrderItemID":"productOrderItemID"},"mode":"pubsub"},"AccountInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","vmKeys":{"data.barId":"barId","data.faId":"faId","data.accountName":"accountName"},"mode":"pubsub"},"AppointmentInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AppointmentInContextTopicViewModel","vmKeys":{"data.appointmentId":"appointmentId","data.flowType":"flowType"},"mode":"pubsub"},"ViewBillingAccountSummaryTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel","vmKeys":{"data.physicalAddress":"physicalAddress","data.accounts":"accounts","data.billingAccountSummaryVmStatus":"billingAccountSummaryVmStatus","data.byteArray":"byteArray","data.reasons":"reasons","data.isGetBalance":"isGetBalance","data.isGetBillsList":"isGetBillsList","data.includeLob":"includeLob","data.excludeLob":"excludeLob","data.CIAmts":"CIAmts","data.CIErrorDetails":"CIErrorDetails"},"mode":"pubsub"},"ActionsBillingAccountSummaryTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel","vmKeys":{"data.selectedAccount":"selectedAccount","data.pdfBillNumber":"pdfBillNumber","data.customerId":"customerId","data.nickName":"nickName","data.selectedAvatar":"selectedAvatar","data.billingAccountSummaryVmStatus":"billingAccountSummaryVmStatus","data.pdfDetails":"pdfDetails","data.currentAccount":"currentAccount","data.isGetBalance":"isGetBalance","data.isGetBillsList":"isGetBillsList","action.changeAvatarAndNickName":"changeAvatarAndNickName","action.changeAddressPopUp":"changeAddressPopUp","action.confirmBarNameBtn":"confirmBarNameBtn","action.barNameEditableToggle":"barNameEditableToggle","action.payBills":"payBills","action.loadPdf":"loadPdf","action.saveUserSelection":"saveUserSelection","action.updateAccountAddress":"updateAccountAddress"},"mode":"pubsub"},"NumberPortinTopicView":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/NumberPortinWidgetViewModel","vmKeys":{"data.mobileNumber":"mobileNumber"},"mode":"pub"},"NumberPortinTopicActions":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/NumberPortinWidgetViewModel","vmKeys":{"data.numberPortinVmStatus":"numberPortinVmStatus","data.setFirstLoad":"setFirstLoad","data.preTickAddonDetails":"preTickAddonDetails","action.checkMobileNumber":"checkMobileNumber","action.onClickNextUpdateOrder":"onClickNextUpdateOrder"},"mode":"pubsub"},"SelectNumberTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SelectNumberWidgetViewModel","vmKeys":{"data.receivedNumberList":"receivedNumberList","data.selectedNumber":"selectedNumber","data.orderUpdate":"orderUpdate","data.adslPlan":"adslPlan","data.subType":"subType","data.numberOfResources":"numberOfResources","data.fiberId":"fiberId","data.singnetId":"singnetId","data.callSaveNumber":"callSaveNumber","data.existingNumbers":"existingNumbers","data.selectedExistingLine":"selectedExistingLine","action.saveSeletedExistingNumber":"saveSeletedExistingNumber","data.mobilePortinFlag":"mobilePortinFlag","data.mobileReContractFlag":"mobileReContractFlag","data.newNumberFlag":"newNumberFlag","action.fetchNumbers":"fetchNumbers","action.saveSelectedNumber":"saveSelectedNumber","action.validateSingnetId":"validateSingnetId","action.getExistingNumbers":"getExistingNumbers","action.getNumbersFromSDP":"getNumbersFromSDP","data.freeMBBData":"freeMBBData","data.recontractBarId":"recontractBarId","data.easyMobileUnits":"easyMobileUnits","data.deviceInformationContainment":"deviceInformationContainment","data.selectNumberVmStatus":"selectNumberVmStatus","data.oneClickData":"oneClickData","data.simAdded":"simAdded","data.preTickAddonDetails":"preTickAddonDetails"},"mode":"pubsub"},"personInfoErrorsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel","vmKeys":{"data.errors":"errors"},"mode":"sub"},"personInfoViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel","vmKeys":{"data.contactInfo":"contactInfo","data.salutationOptions":"salutationOptions","data.genderOptions":"genderOptions","data.showError":"showError","data.viewUpdateCustomerProfileVmStatus":"viewUpdateCustomerProfileVmStatus"},"mode":"sub"},"personInfoUpdateTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel","vmKeys":{"data.contactInfoForUpdate":"contactInfoForUpdate","data.updateCutomerProfileVmStatus":"updateCutomerProfileVmStatus"},"mode":"pubsub"},"personInfoActionsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel","vmKeys":{"action.save":"save","action.retrieveAddress":"retrieveAddress","action.reset":"reset","action.updateEmail":"updateEmail"},"mode":"pub"},"addressTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/addressWidgetViewModel","vmKeys":{"data.postalCode":"postalCode","data.address":"address","data.errorMessage":"errorMessage","data.returnStatus":"returnStatus","action.retrieveAddress":"retrieveAddress"}},"devicePricesWrite":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ViewDevicePricesViewModel","vmKeys":{"data.planId":"planId","data.deviceIds":"deviceIds"},"mode":"pub"},"devicePricesRead":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ViewDevicePricesViewModel","vmKeys":{"data.deviceDetailsList":"deviceDetailsList"},"mode":"sub"},"accountStartDateWrite":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/RetrieveOpenDatesViewModel","vmKeys":{"data.billingAccountNumber":"billingAccountNumber"},"mode":"pub"},"accountStartDateRead":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/RetrieveOpenDatesViewModel","vmKeys":{"data.accountObject":"accountObject"},"mode":"sub"},"RelocateMyServicesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/RelocateMyServicesViewModel","vmKeys":{"data.postalCode":"postalCode","data.address":"address","data.physicalAddress":"physicalAddress","data.retainFixedLineNumberList":"retainFixedLineNumberList","data.alternativeContactNumber":"alternativeContactNumber","data.relocateMyServiceVmStatus":"relocateMyServiceVmStatus","data.dateToBeContacted":"dateToBeContacted","data.templateId":"templateId","data.nricDetails":"nricDetails","data.notes":"notes","data.subscribersEmailId":"subscribersEmailId","data.timeToBeContacted":"timeToBeContacted","data.selectedServices":"selectedServices","data.selectedAccounts":"selectedAccounts","data.accountList":"accountList","data.caseDescription":"caseDescription","data.isCreateCase":"isCreateCase","data.isSendNotificationForAnonymousUser":"isSendNotificationForAnonymousUser","action.createCaseForAnonymousUser":"createCaseForAnonymousUser","action.sendNotification":"sendNotification","action.createRelocationInteraction":"createRelocationInteraction","action.validateSubscriberNRIC":"validateSubscriberNRIC","action.checkCoverage":"checkCoverage","action.saveRelocationFixedServicesData":"saveRelocationFixedServicesData","action.getAddress":"getAddress"},"mode":"pubsub"},"ImplLoginViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"data.implLoginVmStatus":"implLoginVmStatus","data.userInfo":"userInfo"},"mode":"sub"},"ImplLoginActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"action.login":"login"},"mode":"pub"},"OnePassDetailsViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","vmKeys":{"data.onePassVmStatus":"onePassVmStatus","data.nric":"nric","data.nickName":"nickName","data.userId":"userId","data.customerIdType":"customerIdType","data.status":"status","data.email":"email","data.billPayer":"billPayer","data.familyName":"familyName","data.GTMUserData":"GTMUserData","data.isWorryFreeLogin":"isWorryFreeLogin","data.isWorryFreeFaVerfied":"isWorryFreeFaVerfied","data.headers":"headers","data.newcustomer":"newcustomer"},"mode":"pubsub"},"OnePassDetailsActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","vmKeys":{"action.setOnePassFields":"setOnePassFields","action.sendOnePassDetails":"sendOnePassDetails"},"mode":"pubsub"},"ImplInstallationAddressInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/InstallationAddressTopicViewModel","vmKeys":{"data.installationAddress":"installationAddress"},"mode":"pubsub"},"ImplProductInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","vmKeys":{"data.productID":"productID","data.assignedProduct":"assignedProduct"},"mode":"pubsub"},"ImplRetreiveAssignedProductDetailsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplAssignedProductDetailsViewModel","vmKeys":{"data.assignedProductDetails":"assignedProductDetails","data.assignedProductDetailsVMStatus":"assignedProductDetailsVMStatus"},"mode":"pubsub"},"ImplRetreivePriceSchemasTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/RetreivePriceSchemasTopic","vmKeys":{"data.priceSchemasArray":"priceSchemasArray","data.choosenPriceSchemaId":"choosenPriceSchemaId"},"mode":"pubsub"},"RecontractPlanTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/RecontractPlanViewModel","vmKeys":{"data.serviceStatus":"serviceStatus","data.productList":"productList","data.choosenPlanId":"choosenPlanId","action.chooseRecontractPlanProduct":"chooseRecontractPlanProduct"},"mode":"pubsub"},"ImplPriceSchemaRecontractTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/PriceSchemaRecontractContextTopic","vmKeys":{"data.productOfferingID":"productOfferingID","data.productOfferingProductSpecID":"productOfferingProductSpecID","data.priceSchemaID":"priceSchemaID"},"mode":"pubsub"},"UnbilledUsageTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/UnbilledUsageViewModel","vmKeys":{"data.unbilledUsageDataMap":"unbilledUsageDataMap","data.unbilledUsageSummary":"unbilledUsageSummary","data.currentUnbilledUsageData":"currentUnbilledUsageData","data.unbilledUsageVmStatus":"unbilledUsageVmStatus","action.getUnbilledUsageDetails":"getUnbilledUsageDetails"},"mode":"pubsub"},"OverUsedDetailsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/OverUsedDetailsViewModel","vmKeys":{"data.overUsedDetailsStatus":"overUsedDetailsStatus","data.eventsSorting":"eventsSorting","data.unbilledEventsDataMap":"unbilledEventsDataMap"},"mode":"pubsub"},"VoucherTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/VoucherViewModel","vmKeys":{"data.checkVouchersStatus":"checkVouchersStatus","data.checkVouchers":"checkVouchers","data.voucherVmStatus":"voucherVmStatus","data.subscriptionId":"subscriptionId","data.customerId":"customerId","data.personId":"personId","data.vouchers":"vouchers","data.voucherList":"voucherList","data.selectedVouchers":"selectedVouchers","data.mobile":"mobile","data.selectedShoppingCartVouchers":"selectedShoppingCartVouchers","data.reservedVouchersList":"reservedVouchersList","action.applyVoucher":"applyVoucher","action.getAllVouchers":"getAllVouchers"},"mode":"pubsub"},"ChangePlanTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ChangePlanViewModel","vmKeys":{"data.productId":"productId","data.newPlanId":"newPlanId","data.newPlanDetails":"newPlanDetails","data.orderId":"orderId","data.selectedBarId":"selectedBarId","data.planRelId":"planRelId","data.changePlanVmStatus":"changePlanVmStatus","data.newAddress":"newAddress","data.penaltyCharges":"penaltyCharges","data.submitOrderFlag":"submitOrderFlag","action.updatePlan":"updatePlan","action.submitPlan":"submitPlan","action.updateAccountAddress":"updateAccountAddress","action.cancelOrder":"cancelOrder"},"mode":"pubsub"},"ChangeSimTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ChangeSimViewModel","vmKeys":{"data.changeSimVmStatus":"changeSimVmStatus","data.refNumber":"refNumber","data.submitOrderFlag":"submitOrderFlag","data.selectedDetails":"selectedDetails","data.penaltyCharges":"penaltyCharges","action.createOrder":"createOrder","action.submitOrder":"submitOrder","action.cancelOrder":"cancelOrder"},"mode":"pubsub"},"PayMeansTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PayMeansViewModel","vmKeys":{"data.payMeansVmStatus":"payMeansVmStatus","data.paymentMethodtype":"paymentMethodtype","data.payMeans":"payMeans","data.selectedPaymeans":"selectedPaymeans","data.newCreditCard":"newCreditCard","data.pgInfo":"pgInfo","data.newBankDetails":"newBankDetails","data.isGiroActivated":"isGiroActivated","data.giroDetails":"giroDetails","data.goodAccount":"goodAccount","data.newCcRegistrationUrl":"newCcRegistrationUrl","data.selectedPaymeansToRemove":"selectedPaymeansToRemove","data.barId":"barId","data.faId":"faId","data.customerId":"customerId","action.setAutoPayExistingCard":"setAutoPayExistingCard","action.setAutoPayNewCard":"setAutoPayNewCard","action.terminateGiro":"terminateGiro","action.getNewCreditCardUrl":"getNewCreditCardUrl","action.delinkPaymeans":"delinkPaymeans"},"mode":"pubsub"},"ChangeEbillPreferenceTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ChangeEbillPreferenceViewModel","vmKeys":{"data.changeEbillPreferenceVmStatus":"changeEbillPreferenceVmStatus","data.showPopup":"showPopup","data.selectedOption":"selectedOption","data.selectedAccount":"selectedAccount","data.remindMeFlag":"remindMeFlag","data.templateId":"templateId","data.requestedDuration":"requestedDuration","data.hardCopyBills":"hardCopyBills","data.interactionId":"interactionId","data.implCopyBillRestInput":"implCopyBillRestInput","data.implCopyBillRestOutput":"implCopyBillRestOutput","data.mailParameters":"mailParameters","data.selectedDuration":"selectedDuration","action.sendEmailToCustomer":"sendEmailToCustomer","action.implCopyBillRest":"implCopyBillRest","action.createInteraction":"createInteraction","action.getHardCopyBills":"getHardCopyBills","action.changeEbillPreference":"changeEbillPreference","action.saveEbillPaperBillPreference":"saveEbillPaperBillPreference"},"mode":"pubsub"},"ReContractTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ContactReContractViewModel","vmKeys":{"data.recontractNumber":"recontractNumber","data.recontractVmStatus":"recontractVmStatus","data.selectedRecontractDetails":"selectedRecontractDetails","data.productId":"productId","data.selectedVouchers":"selectedVouchers","data.flowType":"flowType","data.vendorCode":"vendorCode","data.dealerCode":"dealerCode","data.recontractBarId":"recontractBarId","data.addonDetails":"addonDetails","data.addComponentList":"addComponentList","data.deviceInformationContainment":"deviceInformationContainment","data.blockingMessages":"blockingMessages","data.isPaymentPending":"isPaymentPending","data.allProductsDetails":"allProductsDetails","data.cisCustomerDetails":"cisCustomerDetails","data.preTickAddonDetails":"preTickAddonDetails","data.prepaidVMStatus":"prepaidVMStatus","data.prepaidDetails":"prepaidDetails","data.gomoDetails":"gomoDetails","data.selectedServiceDetails":"selectedServiceDetails","action.loadServices":"loadServices","action.saveRecontractDetails":"saveRecontractDetails","action.triggerBuyFlow":"triggerBuyFlow","action.getRecontractDetails":"getRecontractDetails","action.getPrepaidNumbers":"getPrepaidNumbers","action.createChangeOwnershipOrder":"createChangeOwnershipOrder"},"mode":"pubsub"},"changeMobileNumberTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ChangeMobileNumberViewModel","vmKeys":{"data.changeMobileNumberVmStatus":"changeMobileNumberVmStatus","data.selectedNumber":"selectedNumber","data.receivedNumberList":"receivedNumberList","data.orderId":"orderId","data.selectedServiceId":"selectedServiceId","data.allServices":"allServices","action.updateStatus":"updateStatus","action.updateProductConfig":"updateProductConfig","action.submitOrder":"submitOrder","action.createInteraction":"createInteraction","action.getAllMobileNumber":"getAllMobileNumber","action.cancelOrder":"cancelOrder"}},"suspendServiceTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SuspendServiceViewModel","vmKeys":{"data.suspendServiceVmStatus":"suspendServiceVmStatus","data.orderId":"orderId","data.recurringCharges":"recurringCharges","data.selectedServiceId":"selectedServiceId","data.templateId":"templateId","data.dates":"dates","data.userSelection":"userSelection","data.deviceCareComp":"deviceCareComp","action.updateProductConfig":"updateProductConfig","action.submitOrder":"submitOrder","action.createInteraction":"createInteraction","action.cancelOrder":"cancelOrder","action.sendEmailToCustomer":"sendEmailToCustomer","action.removeDeviceCare":"removeDeviceCare"}},"resumeServiceTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ResumeServiceViewModel","vmKeys":{"data.resumeServiceVmStatus":"resumeServiceVmStatus","data.adminCharges":"adminCharges","data.penaltyCharges":"penaltyCharges","data.orderId":"orderId","data.selectedServiceId":"selectedServiceId","action.updateProductConfig":"updateProductConfig","action.submitOrder":"submitOrder","action.createInteraction":"createInteraction","action.cancelOrder":"cancelOrder"},"mode":"pubsub"},"TweakEasyMobilePlanTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/TweakEasyMobilePlanViewModel","vmKeys":{"data.productId":"productId","data.tweakEasyMobilePlanVmStatus":"tweakEasyMobilePlanVmStatus","data.catalogItemId":"catalogItemId","data.originalPlan":"originalPlan","data.customerId":"customerId","data.easyMobilePlans":"easyMobilePlans","action.createEasyMobileOrder":"createEasyMobileOrder"}},"EmailVerificationTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/EmailVerificationViewModel","vmKeys":{"data.verificationVmStatus":"verificationVmStatus","data.email":"email","action.sendMail":"sendMail","action.validateToken":"validateToken"}},"ImplLogoutActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplLogoutViewModel","vmKeys":{"action.logout":"logout","action.clearUxfSecureSession":"clearUxfSecureSession","action.logoutOtherTabs":"logoutOtherTabs","data.logoutVmStatus":"logoutVmStatus"},"mode":"pubsub"},"KeyNominationTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/KeyNominationViewModel","vmKeys":{"action.getNomination":"getNomination","action.setNominations":"setNominations","action.getAllMobileNumbers":"getAllMobileNumbers","data.nominationsDetails":"nominationsDetails","data.keyNominationVmStatus":"keyNominationVmStatus","data.productId":"productId","data.prodId":"prodId","data.updatedNominations":"updatedNominations","data.flowType":"flowType","data.transactionId":"transactionId","data.selectedPlan":"selectedPlan","data.maxNomination":"maxNomination","data.mobileNumbers":"mobileNumbers","data.nonKeyValuesLength":"nonKeyValuesLength","data.keyLineNumber":"keyLineNumber","data.isNonKeyExists":"isNonKeyExists","data.isKeyExists":"isKeyExists","data.isKeylineNominationAllowed":"isKeylineNominationAllowed","data.bundleType":"bundleType","data.serviceIdToOfferingIdMap":"serviceIdToOfferingIdMap"},"mode":"pubsub"},"AppointmentStatusTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/AppointmentStatusViewModel","vmKeys":{"action.getAppointment":"getAppointment","data.appointmentVmStatus":"appointmentVmStatus","data.appointmentDetails":"appointmentDetails","data.errorCode":"errorCode","data.appointmentId":"appointmentId"},"mode":"pubsub"},"OrderListTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplOrderListViewModel","vmKeys":{"data.activities":"activities","data.orderDetails":"orderDetails"},"mode":"pubsub"},"ImplTimelineTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplTimelineViewModel","vmKeys":{"data.activities":"activities","data.implTimelineVmStatus":"implTimelineVmStatus","data.orderId":"orderId","data.orderData":"orderData","data.customerId":"customerId","data.appointment":"appointment","data.existingApptTimeSlot":"existingApptTimeSlot","data.availableTimeSlots":"availableTimeSlots","data.selectedSlot":"selectedSlot","data.getOrderDetails":"getOrderDetails","data.newAppointmentId":"newAppointmentId","data.popStationPostalCode":"popStationPostalCode","data.popStations":"popStations","data.exisitingAppointmentInput":"exisitingAppointmentInput","action.setAppointmentData":"setAppointmentData","action.cancelPreviousAppointment":"cancelPreviousAppointment","action.cancelPreviousShopAppointment":"cancelPreviousShopAppointment","action.setDWFMTimeSlot":"setDWFMTimeSlot","action.getDWFMTimeSlots":"getDWFMTimeSlots","action.getOrderDetails":"getOrderDetails","action.getPOPStations":"getPOPStations"},"mode":"pubsub"},"UpdateVerifyEmailTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateVerifyViewModel","vmKeys":{"data.emailToken":"emailToken","data.errorCode":"errorCode","data.verifyEmailModelVmStatus":"verifyEmailModelVmStatus","action.updateEmailAddress":"updateEmailAddress"},"mode":"pubsub"},"ConsolidateAccountsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplConsolidateAccountsViewModel","vmKeys":{"data.sourceAccounts":"sourceAccounts","data.targetAccount":"targetAccount","data.mailParameters":"mailParameters","data.templateId":"templateId","data.notes":"notes","data.consolidateAccountsVmStatus":"consolidateAccountsVmStatus","action.consolidateAccounts":"consolidateAccounts","action.sendNotification":"sendNotification"},"mode":"pubsub"},"BillPdfDownloadTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/BillPdfDownloadViewModel","vmKeys":{"data.hashString":"hashString","data.billPdfDownloadVmStatus":"billPdfDownloadVmStatus","data.byteArray":"byteArray","action.getUserStatus":"getUserStatus"},"mode":"pubsub"},"OrderDetailsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/OrderDetailsModelViewModel","vmKeys":{"data.orderDetailsVmStatus":"orderDetailsVmStatus","data.activities":"activities","data.orderInputs":"orderInputs","action.getOrderDetails":"getOrderDetails"}},"GetAddressTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel","vmKeys":{"data.address":"address","data.addressList":"addressList","data.postalCode":"postalCode","data.addressError":"addressError","data.addressVMStatus":"addressVMStatus","action.getAddress":"getAddress"}},"GlobalErrorTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplGlobalErrorViewModel","vmKeys":{"data.timestamp":"timestamp","data.modelName":"modelName","data.requestType":"requestType","data.errorObj":"errorObj"},"mode":"sub"},"ChangeOwnershipDonorTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ChangeOwnershipViewModel","vmKeys":{"data.donorVMStatus":"donorVMStatus","data.accountId":"accountId","data.serviceId":"serviceId","data.validationResult":"validationResult","data.nricId":"nricId","data.customerId":"customerId","data.productId":"productId","data.listOfAddOns":"listOfAddOns","data.accountType":"accountType","data.errorInfo":"errorInfo","data.transfer_ownership_charges":"transfer_ownership_charges","action.validateDonor":"validateDonor","action.isRecipientAllowed":"isRecipientAllowed","action.createAndSubmitDonorOrder":"createAndSubmitDonorOrder"},"mode":"pubsub"},"changeOwnershipRecipientTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ChangeOwnershipViewModel","vmKeys":{"data.recipientVMStatus":"recipientVMStatus","data.recipientNRIC":"recipientNRIC","data.recipientChownResponse":"recipientChownResponse","data.customerId":"customerId","data.faId":"faId","data.errorInfo":"errorInfo","data.newBillingAccountDetails":"newBillingAccountDetails","data.requestType":"requestType","action.hasChangeOwnershipRequest":"hasChangeOwnershipRequest","action.handleRequest":"handleRequest","action.updateProductOrderPayChannel":"updateProductOrderPayChannel","action.createNewBillingAccount":"createNewBillingAccount","action.createNewAccount":"createNewAccount","action.submitRecipientOrder":"submitRecipientOrder"},"mode":"pubsub"},"NotificationTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","vmKeys":{"data.contactDetails":"contactDetails"},"mode":"pubsub"},"GATopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","vmKeys":{"data.gtmData":"gtmData","data.gtmViewStatus":"gtmViewStatus","action.publishData":"publishData"},"mode":"pubsub"},"ImplFSAppointmentTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplFSAppointmentViewModel","vmKeys":{"data.newFsDelSelectedSlot":"newFsDelSelectedSlot","data.orderActionId":"orderActionId","data.dealerCode":"dealerCode","data.salesOrderNo":"salesOrderNo","data.salesManCode":"salesManCode","data.fsAppointmentVmStatus":"fsAppointmentVmStatus","data.newPopStationAddress":"newPopStationAddress","action.changeFsDelAppointment":"changeFsDelAppointment","action.changeFsRedelAppointment":"changeFsRedelAppointment","action.getDoImage":"getDoImage","action.getRedeliveryTimeslots":"getRedeliveryTimeslots","action.changeFsPopStationAppointment":"changeFsPopStationAppointment"},"mode":"pubsub"},"ImplSingtelEnergyTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplSingtelEnergyViewModel","vmKeys":{"data.autoRenewIndicator":"autoRenewIndicator","data.assignedProductId":"assignedProductId","data.subscriptionId":"subscriptionId","data.customerId":"customerId","data.barId":"barId","data.faId":"faId","data.serviceId":"serviceId","data.chNodeId":"chNodeId","data.energyUsage":"energyUsage","data.energyVmStatus":"energyVmStatus","action.updateAutoRenewIndicator":"updateAutoRenewIndicator","action.getEnergyUsage":"getEnergyUsage"},"mode":"pubsub"},"DqmsUnbilledDataUsageTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/DqmsUnbilledDataUsageViewModel","vmKeys":{"data.aemConfigData":"aemConfigData"},"mode":"pubsub"}});
define("l9_common.careTopicsBinding",{"binding":[]});
define("businesswidget/repository_l9_common/common/viewmodel/ImplGlobalErrorViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ObservableViewModel.extend({defaults:{timestamp:null,modelName:null,requestType:null,errorObj:null,errorList:[]},setErrorDetails:function(a,b,c,d){var e=this._getModelName(b),f=this._getRequestType(b,d),g={errorObj:a,requestType:f,modelName:e};this.set(g),this.set("timestamp",Date.now());var h=this.get("errorList");return h.push(g),this.set("errorList",h),g},_getModelName:function(a){return a.name||a.urlRoot},_getRequestType:function(a,b){return b.requestType||a.requestType||"read"}})});
define("businesswidget/repository_l9_common/common/core/ImplRepositoryGlobalErrorHandler",["lightsaber","underscore","RepositoryGlobalErrorHandler","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/ImplGlobalErrorViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ImplLogoutViewModel"],function (a,b,c,d,e,f,g){var h=function(){a.Core.RESTModel.setGlobalErrorHandler(b.bind(this.errorHandler,this)),this.initialize()};return b.extend(h.prototype,c.prototype,{initialize:function(){b.bindAll(this,"errorHandler","handleError"),this.on("globalErrorHandler:error",function(a){switch(a.statusCode){case 504:var b=window.location.href;if((!window.isEditorMode||"false"===window.isEditorMode)&&b.indexOf("/editor.html/content/singtel/en")===-1){var c=d.get("errorUrl");0===c.trim().indexOf("/")&&(c=this.getFullHost()+c),window.location.href=c}break;case 403:var e=f.get("otpData");e&&e.identValue&&(console.log("******** Emptying the session as authentication of one of the rest service failed *********"),f.empty(),g.clearUxfSecureSession())}}.bind(this))},getFullHost:function(){var a=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");return a},handleError:function(a,b,c){this.errorHandler(a,b,c)},errorHandler:function(a,b,d){var f={model:a,xhr:b,options:d,_this:this},g=this.on("globalErrorHandler:error",function(a){e.setErrorDetails(a,f.model,f.xhr,f.options)}.bind(f));c.prototype.errorHandler.call(this,a,b,d),g.off()}}),h});
define("l9_common.careExpPackage",["l3_common.careExpPackage","l9_common.careWidgets","l9_common.careTopics","l9_common.careTopicsBinding","text!businesswidget/repository_l9_common/common/config/l9_common.carePackage.config.json","single!businesswidget/repository_l9_common/common/core/ImplRepositoryGlobalErrorHandler"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l9_common/common/i18n/care/web/nls/l9_common.careStrings")});
define("businesswidget/repository_l9_common/common/core/WidgetResourceBundle",["businesswidget/repository_l3_common/common/core/WidgetResourceBundle","i18n!businesswidget/repository_l9_common/common/i18n/repository/nls/l9_common.repositoryStrings"],function (a,b){return a.loadBundle(b),a});
define("businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel",["underscore","lightsaber","single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel"],function (a,b,c){var d=b.Core.ObservableViewModel.extend({persistent:["ID"],defaults:{customerId:null,ID:null},subViewModels:{customerTopicsDefinitionViewModel:c},dataBindings:[{ID:"subViewModels.customerTopicsDefinitionViewModel.CustomerInContext.ID",options:{twoWay:!0,setOnBind:!0}},{customerId:"subViewModels.customerTopicsDefinitionViewModel.CustomerInContext.ID",options:{twoWay:!0,setOnBind:!0}}]}),e=d.extend({}),f={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerInContextTopicViewModel",path:"businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{customerId:{key:"customerId",value:"null"}},methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository_l9_common/common/core/ImplStorageUtil",["underscore","src/core/util/StorageUtil"],function (a,b){var c=a.extend(b,{getStorage:function(b,c){a.isString(b)||(c=b,b=this._getDefaultStorageName());var d=c&&c.fallback||"memory";if(!this._storageObjects[b])throw"Storage type "+b+" is not supported";return a.isUndefined(this._storageObjects[b].isAvailable)&&(this._storageObjects[b].isAvailable=this._storageObjects[b].storage._isAvailable()),this._storageObjects[b].isAvailable?this._storageObjects[b].storage:this.getStorage(d)},_getDefaultStorageName:function(){return"session"}});return c});
define("businesswidget/repository_l9_common/common/core/ImplLSRESTDataSource",["src/core/dataSource/LSRESTDataSource","src/core/util/StorageUtil","jquery"],function (a,b,c){a.prototype.storage=b.getStorage("local");var d=a.extend({prefixUrl:function(){var a=this._super.apply(this,arguments);return a.indexOf(":80")!==-1&&(a=a.replace(":80","")),a},sync:function(a,b,c){c=this.updateOptions(c);var d=this._super.apply(this,arguments);return d},updateOptions:function(a){a=a||{};var b=this.getProperty("withCredentials",{},a);return b&&(console.log("CORS: Calling cross domain request"),a.xhrFields={withCredentials:b}),a}});return d});
define("l3_common.care.custom",["replace","l9_common.care.custom"],function() {});
define("l3_common.careWidgets",{});
define("l3_common.careTopics",{});
define("l3_common.careTopicsBinding",{"binding":[]});
define("l3_common.careExpPackage",["l0.careExpPackage","l3_common.careWidgets","l3_common.careTopics","l3_common.careTopicsBinding","text!businesswidget/repository_l3_common/common/config/l3_common.carePackage.config.json"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l3_common/common/i18n/care/web/nls/l3_common.careStrings")});
define("businesswidget/repository_l3_common/common/core/WidgetResourceBundle",["businesswidget/repository/common/core/WidgetResourceBundle","i18n!businesswidget/repository_l3_common/common/i18n/repository/nls/l3_common.repositoryStrings"],function (a,b){return a.loadBundle(b),a});
define("businesswidget/repository_l3_common/common/core/Configuration",["businesswidget/repository/common/core/Configuration","text!l3_common.repository.config.json"],function (a,b){return a.loadConfiguration(b),a});
define("text!businesswidget/repository/common/config/carePackage.config.json",function (){return'({\n    "experiencePackage":"care",\n\n    // notification widget\n\t"NotificationReadActions" : {\t\n\t\t"NotificationChannel" : {"S":"SMS", "E":"EMAIL", "P":"PUSH", "D":"SELFSERVICE"},\n\t\t"NotificationType" : {"A":"ALERT", "SR":"SELF_REGISTRATION", "R":"REGISTRATION"},\n\t\t"NotificationSubType" : {"IS":"INSIGHT", "IR":"INVOICE_READY", "AN":"APPROVAL_NEEDED"},\n\t\t"NotificationReadFlag" : {"READ":"C"}\n\t},\n\t"NotificationFeedbackEnabled" : true, \n\t"NotificationActionsEnabled" : true,\n\t"supportedLOBListForUsageEvents" : ["WS"],\n\t"numberOfCyclesForBills" :12,\n\t"showOnlyBill":true,\n\t"showBillDetails" :false,\n\t"imageBaseUrl" : "businesswidget/repository/common/resources/care/web/css",\n\t\n\t//social share widget\n\t"facebook_config" :{\n\t\t"appId" : "707929789328788",\n\t\t"version" : "v2.2",\n\t\t"xfbml" : "false"\n\t}\n\n})'});
define("businesswidget/repository/common/core/Configuration",["underscore","lightsaber","text!repository.config.json"],function (a,b,c){function d(a){return a.replace(/_/g,"-").toLowerCase()}function e(a){var b=a.split("-");return b.length>1?b[0]+"_"+b[1].toUpperCase():a}function f(a,b){b||(b=location.search),a=a.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var c=b.match(new RegExp("[?&]"+a+"=([^&]*)(&|$)"));return c?decodeURIComponent(c[1].replace(/\+/g," ")):null}var g=b.Core.Configuration,h="";return g.on("change:customizationLevel",function(a,b){h+="-"+b}),g.getLocaleByHierarchy=function(){var b,c,g,h=f("uxfLocale");return this.has("locale")?b=d(this.get("locale")):(c="undefined"!=typeof navigator&&d(navigator.language||navigator.userLanguage),g=a.map(this.get("allowedLocales"),d),b=a.contains(g,c)?c:d(this.get("defaultLocale"))||"en",h&&(h=d(h),b=a.contains(g,h)?h:b),this.set("locale",e(b))),b},g.getLocale=function(){return this.getLocaleByHierarchy()+h},g.loadConfiguration(c),g});
define("businesswidget/repository/common/library/commonTopics",{"GeneralErrorInWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/GenericErrorViewModel","vmKeys":{"data.widgetInformationObject":"widgetInformationObject","action.dataNotAvailableError":"dataNotAvailableError","action.generalServiceError":"generalServiceError"},"mode":"sub"}});
define("businesswidget/repository/common/core/RESTModel",["lightsaber","underscore","Configuration"],function (a,b,c){var d=a.Core.RESTModel.extend({options:{url:""},setRESTConfig:function(a){return a.defaults&&a.defaults.module||(a.defaults=b.defaults({module:this._getRESTDefaultModule()},a.defaults||{})),this._super(a)},_getRESTDefaultModule:function(){return c.get("cm_rest_default_module")}}),e=d.extend({}),f={parent:"Lightsaber.Core.RESTModel",type:"model",name:"RESTModel",path:"businesswidget/repository/common/core/RESTModel.js",savePath:"businesswidget/repository/common/core",description:"","extends":"Lightsaber.Core.RESTModel",extendsClassPath:"",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"Configuration"}],replaced:!1,dataSource:"rest",modelType:"model",fixturesPath:"businesswidget/repository/common/core/RESTModel_fixtures.js",validations:[],methods:{setRESTConfig:{name:"setRESTConfig",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_getRESTDefaultModule:{name:"_getRESTDefaultModule",privacyLevel:"private",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}},modelOptions:{modelProperties:{url:{isMandatory:!1,value:""}}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/core/ClientConfigurationModel",["lightsaber","underscore","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{url:"application/client/configuration",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository/common/core/ClientConfigurationLoader",["jquery","underscore","lightsaber","Configuration","businesswidget/repository/common/core/ClientConfigurationModel"],function (a,b,c,d,e){requirejs(["businesswidget/repository/common/core/RESTModel"],function(b){if(d.get("useFixture")&&requirejs(["fixture"],function(){a&&a.fixture&&(a.fixture.on=d.get("useFixture"))}),"undefined"==typeof process){var f=c.Core.StorageUtil.getStorage("session").get("clientConfigurationData");f?d.loadConfiguration(f):c.Core.Utils.create("clientConfiguationModel",e,{}).fetch({success:function(a){c.Core.StorageUtil.getStorage("session").set("clientConfigurationData",a.toJSON().HashMap),d.loadConfiguration(a.toJSON().HashMap)}})}})});
define("experiencePackage",["require","jquery","underscore","Configuration","lightsaber","businesswidget/repository/common/library/commonTopics","businesswidget/repository/common/core/ClientConfigurationLoader"],function (a,b,c,d,e,f){"use strict";var g=function(a,b,c,d){c=c||function(){},d=d||function(a){throw a};try{e([a],function(a){try{c(new a(b))}catch(a){d(a)}})}catch(e){d(e)}},h=function(a,b){return function(c,d,e){b.then(function(){g(a,c,d,e)})}},i=function(g,i,j,k,l){var m=b.Deferred(),n=b.Deferred(),o=b.when(m.promise(),n.promise());g=g||{},i=i||{},c.extend(i,f);for(var p in g)this[p]=h(g[p],o);for(var q in i)this.hub.register(q,i[q]);return c.each(j.binding,function(a){this.hub.bindTopics(a.topicA,a.topicB,a.options)},this),l?a(["ResourceBundle","i18n!"+l,"exclude!i18n!businesswidget/repository/common/i18n/repository/nls/repositoryStrings"],function(a,b,c){a.loadCoreBundle(c),a.loadBundle(b),m.resolve()}):m.resolve(),k&&d.loadConfiguration(k),d.get("repositorySA")&&!this.registeredGlobalErrorHandler?(this.registeredGlobalErrorHandler=!0,a(["single!RepositoryGlobalErrorHandler"],function(a){e.Core.RESTModel.setGlobalErrorHandler(a.errorHandler),e.Core.Collection.setGlobalErrorHandler(a.errorHandler),n.resolve()})):n.resolve(),this};return i.prototype={hub:e.Core.BusinessWidgetHub,extend:function(a,b,c,d){var e=function(a){return i.apply(this,a)};return e.prototype=this,new e(arguments)}},i.setLocale=function(a,b){a.config({locale:b})},i.setLocale(require,d.getLocale()),i});
define("careWidgets",{"notificationWidget":"businesswidget/repository/widgetsLibrary/notificationwidget/web/NotificationWidget","notificationPreferencesWidget":"businesswidget/repository/widgetsLibrary/notificationpreferenceswidget/web/NotificationPreferencesWidget","unbilledUsageWidget":"businesswidget/repository/widgetsLibrary/unbilledusagewidget/web/UnbilledUsageWidget","productOverviewWidget":"businesswidget/repository/widgetsLibrary/productsoverviewwidget/web/ProductOverviewWidget","prepaidBalanceWidget":"businesswidget/repository/widgetsLibrary/prepaidbalancewidget/web/PrepaidBalanceWidget","postPaidBalanceWidget":"businesswidget/repository/widgetsLibrary/postpaidbalancewidget/web/PostPaidBalanceWidget","ProductsNavigationDropDownWidget":"businesswidget/repository/widgetsLibrary/productsNavigationDropDownWidget/web/ProductsNavigationDropDownWidget","facebookShareWidget":"businesswidget/repository/widgetsLibrary/facebookShareWidget/FacebookShareWidget"});
define("careTopics",{"CustomerInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","vmKeys":{"data.customerId":"customerId"},"mode":"pubsub"},"UserInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/UserInContextTopicViewModel","vmKeys":{"data.userId":"userId"},"mode":"pubsub"},"notificationWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/NotificationWidgetViewModel","vmKeys":{"data.customerId":"customerId","data.username":"username","action.requestCreditEvent":"requestCreditEvent","action.paymentDetailsEvent":"paymentDetailsEvent","action.disputeChargeEvent":"disputeChargeEvent","action.billPayEvent":"billPayEvent","action.viewBillEvent":"viewBillEvent"},"mode":"pubsub"},"notificationPreferencesWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/NotificationsSettingsViewModel","vmKeys":{"data.userEmail":"userEmail","data.userMdn":"userMdn","data.username":"username","data.customerId":"customerId"},"mode":"pubsub"},"amdocs.Unbilled.Accumulators":{"vmId":"single!businesswidget/repository/common/viewmodel/UnbilledUsageWidgetViewModel","vmKeys":{"data.customerId":"customerId","data.subscriptionId":"subscriptionId","data.salesChannel":"salesChannel","data.locale":"locale","data.selectedAccumulator":"selectedAccumulator","data.UsageType":"UsageType","data.AccumulatorID":"AccumulatorID","action.ViewAllAccumulators":"ViewAllAccumulators","action.MoreDetails":"MoreDetails","action.ViewEvent":"ViewEvent"},"mode":"pubsub"},"PrepaidBalanceInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/PrepaidBalanceWidgetViewModel","vmKeys":{"data.customerId":"customerId","data.subscriptionId":"subscriptionId","data.salesChannel":"salesChannel","data.locale":"locale","data.selectedBalance":"selectedBalance","action.ViewAllBalances":"ViewAllBalances","action.MoreDetails":"MoreDetails","action.Topup":"Topup","action.ViewSelectedBalance":"ViewSelectedBalance"},"mode":"pubsub"},"productOverviewWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductOverviewWidgetViewModel","vmKeys":{"action.AssignLOB":"AssignLOB","action.NonAssignLOB":"NonAssignLOB","data.LOBCode":"LOBCode","data.PlansCategoryStructureID":"PlansCategoryStructureID","data.APID":"APID","data.existSharedProduct":"existSharedProduct","action.AllProductsClicked":"AllProductsClicked"},"mode":"pubsub"},"postPaidBalanceInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/PostPaidBalanceWidgetViewModel","vmKeys":{"data.billID":"billID","data.customerBillSpecID":"customerBillSpecID","data.customerAccountID":"customerAccountID","data.totalDue":"totalDue","data.billDueDate":"billDueDate","action.setAutoPay":"setAutoPay","action.payBillSelected":"payBillSelected","action.payBillWithCardSelected":"payBillWithCardSelected","action.autoPaySettingsSelected":"autoPaySettingsSelected","action.paymentSettingsSelected":"paymentSettingsSelected","action.viewBalanceDetails":"viewBalanceDetails"},"mode":"sub"},"amdocs.CancelLink":{"vmId":"single!businesswidget/repository/common/viewmodel/CancelLinkViewModel","vmKeys":{"action.LinkClicked":"LinkClicked","data.widgetID":"widgetID","data.widgetName":"widgetName","data.identifier":"identifier"},"mode":"pubsub"},"IndividualInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel","vmKeys":{"data.personId":"personId"},"mode":"pubsub"}});
define("l0.careExpPackage",["experiencePackage","careWidgets","careTopics","careTopicsBinding","text!businesswidget/repository/common/config/carePackage.config.json","repository.lightsaber.custom"],function (a,b,c,d,e){"use strict";return new a(b,c,d,e,"businesswidget/repository/common/i18n/care/web/nls/careStrings")});
define("careExpPackage",["l9_common.careExpPackage","l3_common.care.custom"],function (a){"use strict";return a});
define("businesswidget/repository/common/core/WidgetResourceBundle",["lightsaber"],function (a){return a.Core.ViewModel.getRepositoryResourceBundle()});
define("businesswidget/repository/common/util/PhoneNumberFormatter",function (){return window.formatPhoneNumber=function(a,b){var c="";if(a){var d=requirejs("ResourceBundle"),e=d.getString("localPhoneNumberLength"),f=/[\D]/g,g=a.replace(f,""),h="",i=d.getString("localPhoneNumberMinLength");if(!isNaN(i)&&g.length<i)return g;h=g.length>e?d.getString("intlPhoneNumberFormat"):d.getString("localPhoneNumberFormat"),b&&(h=h.replace(" ","&nbsp;").replace("-","&ndash;"));for(var j=0,k=0;j<h.length&&k<g.length;)"#"==h[j]?(c+=g[k],j++,k++):(c+=h[j],j++);k<g.length&&(c+=g.substring(k))}return c},{formatPhoneNumber:window.formatPhoneNumber}});
define("businesswidget/repository/common/util/KnockoutPlugins",["jquery","underscore","knockout","businesswidget/repository/common/util/PhoneNumberFormatter"],function (a,b,c,d){c.subscribable.fn.phoneNumberFormatter=function(){var a,b=this;return c.computed({read:function(){var c=b();return a=c?d.formatPhoneNumber.apply(window,[c]):""},write:function(a){b(a)}})},c.bindingHandlers.uniqueId={init:function(a,b){if(b()){var d="unique_id_"+ ++c.bindingHandlers.uniqueId.currentIndex;a.setAttribute("data-unique-id",d)}}},c.bindingHandlers.uniqueId.currentIndex=0,c.bindingHandlers.numeric={init:function(b){a(b).on("keydown",function(a){46==a.keyCode||8==a.keyCode||9==a.keyCode||27==a.keyCode||13==a.keyCode||65==a.keyCode&&!0===a.ctrlKey||a.keyCode>=35&&a.keyCode<=39||(a.shiftKey||(a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105))&&a.preventDefault()})}};var e=function(a){var b=[],d=c.unwrap(a());return b.push({action:d,event:"click"}),b},f=function(d,f,g,h,i){var j=h.__handler__;j||(j=i.$root.__handler__);var k=e(f);b.each(k,function(b){var e=c.unwrap(b.action),f=a(d);f.off(b.event),h.__vmKeys__&&h.__vmKeys__["action."+e]&&(e=c.unwrap(h.__vmKeys__["action."+e])),f.on(b.event,function(a){j(e,a,{},h,i,b.args)})})};c.bindingHandlers.specialAction={init:f,update:f}});
define("text!businesswidget/repository/common/view/template/generalErrorMessageTemplate.html",function (){return'<div data-uxf-point="widgetErrorMessage" class="widget-general-error-message"></div>\n'});
define("text!businesswidget/repository/common/view/template/generalWarningMessageTemplate.html",function (){return'<div data-uxf-point="widgetErrorMessage" class="widget-general-warning-message"></div>\n'});
define("text!businesswidget/repository/common/view/template/unauthenticatedViewTemplate.html",function (){return"<div class=\"smb-rejected\"><%=i18n('businessWidget_unauthenticatedView_message')%></div>\n"});
define("RepositoryGlobalErrorHandler",["underscore","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration"],function (a,b,c,d){var e=function(a,b,c){this.initialize()};return a.extend(e.prototype,Backbone.Events,{initialize:function(){a.bindAll(this,"errorHandler")},errorHandler:function(a,e,f){if("validation"!==e.source){var g="",h=e.status,i=e.responseText&&e.responseText.indexOf("User account is locked")>-1;if("Login"===a.urlRoot&&401===h&&!i||"authentication/self-service-user"===a.urlRoot&&403===h)return void b.Core.StorageUtil.getStorage("session").set(d.get("authorizationTokenStorageKey"),void 0);if(void 0!==e.responseText&&e.responseText.length>0)try{var j=JSON.parse(e.responseText),k=j.ErrorInfo.errorCode;i&&(k="UserLocked"),g=j.ErrorInfo&&j.ErrorInfo.errorMessage?j.ErrorInfo.errorMessage:c.getString("cm_ERROR_"+h+"_"+k+"_MSG")}catch(a){"TOKEN_IDLE_OR_EXPIRATION_PASSED"===e.responseText?(k=e.responseText,g=c.getString("cm_ERROR_"+h+"_TOKEN_IDLE_OR_EXPIRATION_PASSED_MSG")):console.log("cannot parse the error Code in error Handling mechanism")}if(void 0!==g&&0!==g.length||(g=c.getString("cm_ERROR_"+h+"_MSG")),void 0!==g&&0!==g.length||(g=c.getString("cm_ERROR_DEFAULT_MSG"),console.log("Default message was used in error handling mechanism cause the status code"+h+" was not found")),void 0!==g){var l={};l.errorMessage=g,l.errorCode=k,l.statusCode=h,d.get("globalErrorHandlerAlert")&&this.alert(g),this.trigger("globalErrorHandler:error",l)}}},alert:function(a){alert(a)}}),e});
define("businesswidget/repository/common/core/BusinessWidget",["underscore","knockout","src/core/application/BusinessWidget","src/core/util/StorageUtil","src/core/util/Configuration","src/core/view/View","businesswidget/repository/common/util/KnockoutPlugins","text!businesswidget/repository/common/view/template/generalErrorMessageTemplate.html","text!businesswidget/repository/common/view/template/generalWarningMessageTemplate.html","text!businesswidget/repository/common/view/template/unauthenticatedViewTemplate.html"],function (a,b,c,d,e,f,g,h,i,j){return c.extend({errors:[],config:{ignoreInitialData:!1},getMetaData:c.prototype.getMetaData,publicMethods:[],initialize:function(b){if(this.widgetInstanceId=this._generateWidgetId(),!0===this.getConfig("ignoreInitialData")?b.data&&this.viewModel.set(a.defaults(this.viewModel.get(),b.data)):b.data&&this.viewModel.set(b.data),this._super(b),e.get("repositorySA")){var c=this;requirejs(["single!RepositoryGlobalErrorHandler"],function(a){a.on("globalErrorHandler:error",c._onGlobalError,c)})}e.get("errorMessageHandling")&&this.viewModel.on("widget:displayMessage",this._handleCallerMessage,this),this.registerHashChangeListener(),b.isCMS&&b.callback&&b.callback(this)},clearErrors:function(){this.errors.length=0},addError:function(a){this.errors.push(a)},getErrors:function(){return this.errors},registerHashChangeListener:function(){var a=this;$(window).bind("hashchange",function(b){a.viewModel.trigger("hashChanged",a.widgetInstanceId)})},_configure:function(a){this._super(a),this.constructor.widgetName&&this.constructor._addToLibrary(this.constructor.widgetName,this)},postRender:function(){this._isAllDataAvailable()?this.hasSessionToken()?this._isAllDataAvailable()&&this.postRenderDefaultMode():this.postRenderUnauthMode():this.postRenderNonDefaultMode(),requirejs.appContext&&requirejs.appContext.config&&requirejs.appContext.config.cms&&this._removeProductEnrichmentHideClass()},_removeProductEnrichmentHideClass:function(){var a;if(this.$el)(a=this.$el.attr("data-hide-class"))&&this.$el.removeClass(a);else if(this.el&&(a=this.el.getAttribute("data-hide-class"))){var b=this.el.className;b=b.replace(a,""),this.el.classNam=b}a&&$('[data-hide-class="'+a+'"]').removeClass(a)},_handleCallerMessage:function(a,b){var c=a;"string"==typeof c&&(c={},c.message=a),requirejs.appContext&&requirejs.appContext.config&&requirejs.appContext.config.cms&&this._removeTemplateFalse(),b?this._onGlobalError(null,c):this._postRenderInformationDataViewMode(c)},_postRenderInformationDataViewMode:function(a){var b=this.create("businessWidget_noDataFoundView",f,{el:this.el,viewModel:this.viewModel,config:{template:i,insertMethod:"html"}}),c=b.$el.find('div[data-uxf-point="widgetErrorMessage"]');if(a&&a.template)c.removeClass("widget-general-warning-message"),c.append(this.getPopulatedTemplate(a.template));else{var d=a.message?a.message:this._getLocaleString("businessWidget_nodataavailableView_message");c.html(d)}},_onGlobalError:function(a,b){if(requirejs.appContext&&requirejs.appContext.config&&requirejs.appContext.config.cms&&this._removeTemplateFalse(),e.get("errorMessageHandling")){var c=this.create("businessWidget_generalErrorView",f,{el:this._getWidgetErrorDom(),viewModel:this.viewModel,config:{template:h,insertMethod:"html"}}),d=c.$el.find('div[data-uxf-point="widgetErrorMessage"]');if(b&&b.template)d.removeClass("widget-general-error-message"),d.append(this.getPopulatedTemplate(b.template));else{var g=b&&b.message?b.message:this._getLocaleString("businessWidget_generalservererrorView_message");d.html(g)}e.get("displayWidgetErrorDetailsControl")||d.css("background-image","none"),this._delegateWidgetErrors("generalServiceError",a)}},_removeTemplateFalse:function(){var a,c;if(this.$el?(a=this.$el.attr("data-uxf-point"),c=this.$el.attr("data-template"),this.$el.removeAttr("data-template"),"false"===c&&b.cleanNode(this.$el[0])):this.el&&(a=this.$el.getAttribute("data-uxf-point"),c=this.el.getAttribute("data-template"),this.el.removeAttribute("data-template"),"false"===c&&b.cleanNode(this.el)),"false"===c){var d=$('[data-uxf-point="'+a+'"]');d.removeAttr("data-template"),b.cleanNode(d[0]),this.$el=d,this.el=d[0]}},_delegateWidgetErrors:function(a,b){if(e.get("throwErrorsToWidgetsConsumer")&&b){var c=this;requirejs(["single!businesswidget/repository/common/viewmodel/GenericErrorViewModel"],function(d){c.addError({errorCode:b.errorCode,errorMessage:b.errorMessage,statusCode:b.statusCode}),d.set("widgetInformationObject",c.getErrors()),d.handleAction(a)})}},_getWidgetErrorDom:function(){return this.el},_getUid:function(){return"_"+Math.random().toString(36).substr(2,9)},_generateWidgetId:function(){return"wid:"+a.uniqueId()},postRenderDefaultMode:function(){},postRenderNonDefaultMode:function(){this._handleCallerMessage(this._getLocaleString("businessWidget_missingRequiredInformation_message"),!1)},postRenderUnauthMode:function(){this.widgetView&&(this.widgetView.destroy(),this.widgetView=void 0),this.unauthenticatedView=this.create("businessWidget_unauthenticatedView",f,{el:this.el,viewModel:this.viewModel,config:{template:j,insertMethod:"html"}})},_onSessionCreated:function(){this.postRender()},_onSessionDestroyed:function(){this.postRenderUnauthMode()},hasSessionToken:function(){return!!d.getStorage("session").get(e.get("authorizationTokenStorageKey"))},_isAllDataAvailable:function(){return!0}},{_widgetLibrary:{},_addToLibrary:function(a,b){var c=a.split(/[. ]+/).pop();this._widgetLibrary[c]=b},getLoadedWidgets:function(){return this._widgetLibrary}})});
define("businesswidget/repository/common/core/LSResourceBundleCust",["underscore","src/core/resourceBundle/ResourceBundle"],function (a,b){var c=b.extend({getString:function(a,b,c){var d=this._super(a,b,c);return void 0===d?a:d}}),d={},e=new c({defaultBundle:d},"defaultBundle"),f=!1;return e.loadBundle=function(b){a.extend(d,b)},e.loadCoreBundle=function(a){f||(e.loadBundle(a),f=!0)},e});
define("businesswidget/repository/common/viewmodel/WidgetCoreBaseViewModel",["src/core/viewModel/BaseViewModel","businesswidget/repository/common/core/LSResourceBundleCust","src/core/model/RESTModel"],function (a,b,c){var d={name:"WidgetCoreBaseViewModel",requires:[{variable:"LightsaberCoreBaseViewModel",pathName:"exclude!src/core/viewModel/BaseViewModel"},{variable:"ResourceBundle",pathName:"businesswidget/repository/common/core/LSResourceBundleCust"},{variable:"RESTModel",pathName:"exclude!src/core/model/RESTModel"}],config:{resourceBundle:"ResourceBundle"},methods:{getResourceBundle:{name:"getResourceBundle",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getString:{name:"getString",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},on:{name:"on",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},handleFaqs:{name:"handleFaqs",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return a.extend({getMetaData:function(){return d},config:{resourceBundle:b},constructor:function(a){this.config=this.config||{},this.config.resourceBundle||(this.config.resourceBundle=b),this._super(a)},getResourceBundle:function(){return this.getConfig("resourceBundle")},getString:function(a,b){return this.getConfig("resourceBundle").getString(a,b)},on:function(a,b,c,d){return!d&&c&&c.addViewModel&&c.addViewModel(a,b,this),Backbone.Events.on.call(this,a,b,c)},handleFaqs:function(a){if(a&&a.faqIDs&&a.successCallback){var b=require("Configuration");new c(null,{url:"utilities/content-data",rest:{defaults:{qParams:{groupIds:a.faqIDs,tp:b.get("touchPoint"),lo:b.get("locale"),sc:b.get("salesChannel")}}}}).fetch({success:a.successCallback})}}},{getRepositoryResourceBundle:function(){return b}})});
define("text!businesswidget/repository/common/view/showMoreOrLess/view/template/ShowMoreLessLinkTemplate.html",function (){return'<span data-uxf-point="continueDots" style="display:block;float:left">...&nbsp;</span>\n<a data-uxf-point="show-more-link" style="color:blue;font-size: 16px;text-decoration:none;display:block">more</a>\n<a data-uxf-point="show-less-link" style="color:blue;font-size: 16px;text-decoration:none;display:none">less</a>'});
define("text!businesswidget/repository/common/view/showMoreOrLess/view/template/ShowMoreLinkTemplate.html",function (){return'<span>... </span><a data-uxf-point="show-more-link" style="color:#01afd1;font-size: 16px;text-decoration:none;">more</a><span style="display:none;">'});
define("text!businesswidget/repository/common/view/showMoreOrLess/view/template/ShowLessLinkTemplate.html",function (){return'<a href="#" data-uxf-point="show-less-link" style="color:#01afd1;font-size: 16px;text-decoration:none;"> less</a>'});
define("businesswidget/repository/common/model/UtilitiesLineOfBusinessModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"referencedata/line-of-business",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},read:{url:"referencedata/line-of-business"}}}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/UtilitiesLineOfBusinessModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"UtilitiesLineOfBusinessModel",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"utilities/line-of-business"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}},read:{url:{value:"utilities/line-of-business"}}}},defaultData:{data:null},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel",["underscore","lightsaber","businesswidget/repository/common/model/UtilitiesLineOfBusinessModel"],function (a,b,c){var d=b.Core.ViewModel.extend({models:{},subViewModels:{},dataBindings:[],defaults:{},initialize:function(){a.bindAll(this,"lazyLoadData","_setLineOfBusinessDataOnSuccess","_setLineOfBusinessDataOnError"),this.LOBCodeLOBDetailsMap={},this.initModels()},lazyLoadData:function(c,d){var e=b.Core.StorageUtil.getStorage("session").get("cachedLobDetailData");if(e){var f=$.Deferred();return f.resolve(),this.set("lobDetailData",e),this.prepareLOBCodeLOBDetailsMap(),this.trigger("lobDetailDataLoaded:suceess"),f.promise()}var g={};return a.isUndefined(c)||(g.lo=c),a.isUndefined(d)||(g.sc=d),this.models.lineOfBusinessModel.setQueryParams(g),this.models.lineOfBusinessModel.fetch({success:this._setLineOfBusinessDataOnSuccess,error:this._setLineOfBusinessDataOnError})},_setLineOfBusinessDataOnSuccess:function(a,c,d){b.Core.StorageUtil.getStorage("session").set("cachedLobDetailData",c["LineOfBusinessDetails[]"]),this.set("lobDetailData",c["LineOfBusinessDetails[]"]),this.prepareLOBCodeLOBDetailsMap(),this.trigger("lobDetailDataLoaded:suceess")},_setLineOfBusinessDataOnError:function(a,b,c){this.trigger("lobDetailDataLoaded:error")},prepareLOBCodeLOBDetailsMap:function(){for(var a=this.get("lobDetailData"),b=0;b<a.length;b++)this.LOBCodeLOBDetailsMap[a[b].code]={sortIndex:b,lobDetail:a[b]};this.setLOBCodeLOBDetailsMap()},setLOBCodeLOBDetailsMap:function(){this.set("lobCodeLOBDetailsMap",this.LOBCodeLOBDetailsMap)},getLOBCodeLOBDetailsMap:function(){return this.get("lobCodeLOBDetailsMap")},initModels:function(){this.models.lineOfBusinessModel=this.create("mcss_customerProductsViewModel_customerProducts_CustomerProductsModel",c)}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"LineOfBusinessDetailViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"UtilitiesLineOfBusinessModel",pathName:"businesswidget/repository/common/model/UtilitiesLineOfBusinessModel"}],models:{},viewModels:{},dataBindings:{},methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"Method to initialize ViewModel with variables.",isChangeEventTriggered:!1},lazyLoadData:{name:"lazyLoadData",privacyLevel:"public",isEventTriggered:!1,desc:"Method to fetch Line Of Business Details.\nMethod returns the deferred Object on which the calling code can wait.",isChangeEventTriggered:!1},_setLineOfBusinessDataOnSuccess:{name:"_setLineOfBusinessDataOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"Method to handle the successful invocation of  Line Of Business Details REST.",isChangeEventTriggered:!1},_setLineOfBusinessDataOnError:{name:"_setLineOfBusinessDataOnError",privacyLevel:"public",isEventTriggered:!1,desc:"Method to handle the failure in  invocation of  Line Of Business Details REST.",isChangeEventTriggered:!1},prepareLOBCodeLOBDetailsMap:{name:"prepareLOBCodeLOBDetailsMap",privacyLevel:"public",isEventTriggered:!1,desc:"Method to create LOB Code and LOB details map so we can get the details of LOB without iteration over the REST response.",isChangeEventTriggered:!1},setLOBCodeLOBDetailsMap:{name:"setLOBCodeLOBDetailsMap",privacyLevel:"public",isEventTriggered:!1,desc:"Method to set lobCodeLOBDetailsMap.",isChangeEventTriggered:!1},getLOBCodeLOBDetailsMap:{name:"getLOBCodeLOBDetailsMap",privacyLevel:"public",isEventTriggered:!1,desc:"Method to get lobCodeLOBDetailsMap.",isChangeEventTriggered:!1},initModels:{name:"initModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}},defaults:{}};return e.prototype.getMetaData=function(){return f},e});
define("text!businesswidget/repository/common/view/template/reAuthenticationModalTemplate.html",function (){return'<div class="modal col-md-8 col-sm-10 col-xs-12 shopping-cart__modal">\n\t<div class="modal-content">\n\t\t<div class="modal-header">\n\t\t\t<span class="error-title b1"\n\t\t\t\tdata-bind="i18n:\'reAuthentication_header\'"></span> <span\n\t\t\t\tdata-bind="click: \'close\'" class="close"><span>X</span></span>\n\t\t</div>\n\t\t<div class="modal-body">\n\t\t\t<div data-bind="i18n:\'reAuthentication_instructions\'"></div>\n\t\t\t<input type="password" data-bind="textInput: inputPassword"\n\t\t\t\tid="loginusername" name="loginusername"\n\t\t\t\tclass="col-sm-10 form-control" "/>\n\t\t</div>\n\t\t<div class="modal-footer">\n\t\t\t<button type="submit" data-bind="click:\'confirmAction\', i18n:\'OK\'"\n\t\t\t\tclass="btn btn-primary"></button>\n\t\t</div>\n\n\t</div>\n</div>'});
define("businesswidget/repository/common/util/Util",["underscore","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","jquery","knockout","text!businesswidget/repository/common/view/showMoreOrLess/view/template/ShowMoreLessLinkTemplate.html","text!businesswidget/repository/common/view/showMoreOrLess/view/template/ShowMoreLinkTemplate.html","text!businesswidget/repository/common/view/showMoreOrLess/view/template/ShowLessLinkTemplate.html","businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel","businesswidget/repository/common/util/PhoneNumberFormatter","text!businesswidget/repository/common/view/template/reAuthenticationModalTemplate.html"],function (a,b,c,d,e,f,g,h,i,j,k,l){var m={currency:{USD:"$"},chargesLevel:{BILL:"BILL",LOB:"LOB",SUBSCRIPTION:"SUBSCRIPTION"},format:{full:0,"short":1,general:2,monthYear:3,monthNameYear:4,dayMonth:5,dayMonthName:6,"YYYY-MM":7,"YYYY/MM/DD":8,"DD/MM/YYYY":9,"YYYY-MM-DD":10,"mm:ss":11,"DD-MMM":12,"MMM-YY":13,"DD MMM YYYY":14,"MM/DD/YYYY":15,"DD-MMM-YY":16},phoneLobs:[d.get("lobs").WL,d.get("lobs").WS],installationAddressLobs:[d.get("lobs").TV,d.get("lobs").IN],level:{ACCOUNT:"ACCOUNT",SHARED:"SHARED",SUBSCRIBER:"SUBSCRIBER"},getImageURL:function(a){return d.get("imageBaseUrl")+"/"+a},formatPhoneNumber:function(){return k.formatPhoneNumber.apply(window,arguments)},monthName:function(a){switch(a){case 0:return c.getString("util_mo_Jan");case 1:return c.getString("util_mo_Feb");case 2:return c.getString("util_mo_Mar");case 3:return c.getString("util_mo_Apr");case 4:return c.getString("util_mo_May");case 5:return c.getString("util_mo_Jun");case 6:return c.getString("util_mo_Jul");case 7:return c.getString("util_mo_Aug");case 8:return c.getString("util_mo_Sep");case 9:return c.getString("util_mo_Oct");case 10:return c.getString("util_mo_Nov");case 11:return c.getString("util_mo_Dec");default:return c.getString("util_mo_Jan")}},shortMonthName:function(a){switch(a){case 0:return c.getString("util_mo_short_Jan");case 1:return c.getString("util_mo_short_Feb");case 2:return c.getString("util_mo_short_Mar");case 3:return c.getString("util_mo_short_Apr");case 4:return c.getString("util_mo_short_May");case 5:return c.getString("util_mo_short_Jun");case 6:return c.getString("util_mo_short_Jul");case 7:return c.getString("util_mo_short_Aug");case 8:return c.getString("util_mo_short_Sep");case 9:return c.getString("util_mo_short_Oct");case 10:return c.getString("util_mo_short_Nov");case 11:return c.getString("util_mo_short_Dec");default:return c.getString("util_mo_short_Jan")}},getDateString:function(a,b,c){var e=new Date(a),f=d.getLocale();f=f.toLowerCase();var g,h=e.getHours(),i=e.getMinutes(),j=e.getSeconds(),k=e.getFullYear(),l=""+new String(e.getFullYear()).substring(2,4),m=e.getDate(),n=e.getMonth()+1,o=this.monthName(e.getMonth()),p=this.shortMonthName(e.getMonth()),q="";switch(i<10&&(i="0"+i),j<10&&(j="0"+j),"en-us"==f?(h>12?(h=h-12+"",g=" PM"):g=h<12?" AM":" PM",n<10&&(n="0"+n),m<10&&(m="0"+m)):(n<10&&(n="0"+n),m<10&&(m="0"+m)),c){case this.format.full:switch(f){case"en-us":q=o+" "+m+", "+k;break;case"fr-fr":q=m+" "+o+k;break;default:q=o+" "+m+", "+k}break;case this.format["short"]:switch(f){case"en-us":q=n+"/"+m+"/"+l;break;case"fr-fr":q=m+"/"+n+"/"+l;break;default:q=m+"/"+n+"/"+l}break;case this.format.general:switch(f){case"en-us":q=n+"/"+m+"/"+k;break;case"fr-fr":q=m+"/"+n+"/"+k;break;default:q=m+"/"+n+"/"+k}break;case this.format["YYYY/MM/DD"]:q=k+"/"+n+"/"+m;break;case this.format["YYYY-MM-DD"]:q=k+"-"+n+"-"+m;break;case this.format["DD/MM/YYYY"]:q=n+"/"+m+"/"+k;break;case this.format["mm:ss"]:q=i+":"+j;break;case this.format.monthYear:q=n+"/"+l;break;case this.format.monthNameYear:q=o+" "+k;break;case this.format.dayMonth:switch(f){case"en-us":q=n+"/"+m;break;case"fr-fr":q=m+"/"+n;break;default:q=m+"/"+n}break;case this.format.dayMonthName:switch(f){case"en-us":var r=m.toString(),s=r.substr(r.length-1);"1"==s?r+="st":"2"==s?r+="nd":"3"==s?v=r+"rd":r+="th",q=o+" "+r;break;case"fr-fr":q=m+" "+o;break;default:q=m+" "+o}break;case this.format["YYYY-MM"]:q=k+"-"+n;break;case this.format["DD-MMM"]:q=m+"-"+p;break;case this.format["MMM-YY"]:q=p+"-"+k.toString().substring(2,4);break;case this.format["DD MMM YYYY"]:q=m+" "+p.toUpperCase()+" "+k+" ";break;case this.format["DD-MMM-YYYY"]:q=m+"-"+p+"-"+k;break;case this.format["MM/DD/YYYY"]:q=n+"/"+m+"/"+k;break;case this.format["DD-MMM-YY"]:q=m+"-"+p+"-"+l}if(b)if(c==this.format.full)switch(f){case"en-us":q=q+" "+h+":"+i+":"+j+g;break;case"fr-fr":q=q+" "+h+":"+i+":"+j;break;default:q=q+" "+h+":"+i+":"+j}else switch(f){case"en-us":q=q+"- "+h+":"+i+g;break;case"fr-fr":q=q+" "+h+":"+i;break;default:q=q+" "+h+":"+i}return q},shortenStringWords:function(a,b,c,d){if(c=c||" ",void 0===d&&(d="..."),a.length<=b)return a;var e=a.substr(0,b+c.length),f=e.lastIndexOf(c);return f>=0&&(e=e.substr(0,f)),e&&(e+=d),e},formatAMPM:function(a){var b=a.getHours(),c=a.getMinutes(),d=b>=12?"PM":"AM";return b%=12,b=b||12,c=c<10?"0"+c:c,b+":"+c+" "+d},getZipCodeAllowedLength:function(){var a=b.Core.Configuration.get("ZipCodeFormat"),c=0;if(a)for(var d=a.length,e=0;e<d;e++)"#"==a[e]&&(c+=1);return c},getZipCodeShortLength:function(){var a=b.Core.Configuration.get("ZipCodeFormat"),c=0;if(a)for(var d=a.length,e=0;e<d&&"#"==a[e];e++)c+=1;return c},validZipCode:function(a){var b=this.getZipCodeAllowedLength(),c=this.getZipCodeShortLength(),d=!1,e=this.unFormatZipCode(a);return e&&e.length>0&&this._isNumber(e)&&(e.length!=c&&e.length!=b||(d=!0)),d},validEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return new RegExp(b).test(a)},formatZipCode:function(a){var c,d=/^\d+$/,e=d.test(a);a=a.toString();var f=a;if(c=b.Core.Configuration.get("ZipCodeFormat"),e&&void 0!=c){f="";for(var g=a.length,h=c.length,i=0,j=0;j<g;j++){for(var k=(a[j],i);k<h;k++){if("#"==c[k]){f+=a[j],i=k+1;break}f+=c[k]}i>h&&(f+=a[j]),i==h&&(i+=1)}}return f},unFormatZipCode:function(a){if(a){var c=a.length,d="";if(0==c)return"";for(var e=0;e<c;e++){var f=a[e];!isNaN(parseFloat(f))&&isFinite(f)&&(d+=f)}zipCodeFormat=b.Core.Configuration.get("ZipCodeFormat");var g=this.getZipCodeAllowedLength();return d.length>g&&(d=d.substring(0,g)),d}},formatAddress:function(b){var c=d.get("ADDRESS_DELIMITER");return a.isUndefined(b.address)?"":(b.address.apartmentAndStreet?b.address.apartmentAndStreet+c:"")+(b.address.addressLine2?b.address.addressLine2+c:"")+(b.address.state?b.address.state+" ":"")+(b.address.postCode?b.address.postCode:"")},formattedAddress:function(b,c){var d=[];return a.isUndefined(b.apartmentAndStreet)||d.push(b.apartmentAndStreet),a.isUndefined(b.addressLine2)||d.push(b.addressLine2),a.isUndefined(b.formattedAddress3)||d.push(b.formattedAddress3),
a.isUndefined(b.formattedAddress4)||d.push(b.formattedAddress4),c?d.join(c):d.join(",")},LuhnValidation:function(a){var b=[0,2,4,6,8,1,3,5,7,9];cc=a.replace(/[^\d]/g,"");for(var c=a.split(""),d=!1,e=0;c.length;){var f=Number(c.pop());e+=d?b[f]:f,d=!d}return e%10==0},validateUrl:function(a){return!!/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i.test(a)},getNumberOfDaysForTopUp:function(a,b,c,d){var e,f=0,g=864e5,b=parseFloat(b);if(d>a){f=(d-a)/g;var e=new Date(d)}else var e=new Date(a);if("MONTH"==c){var h=e.getDate();if(b>h)noOfDays=b-h;else{var i=this.daysInMonth(e.getMonth(),e.getFullYear());noOfDays=i-h+b}noOfDays+=f}else if("WEEK"==c){var j=e.getDay();j++,noOfDays=b>j?b-j:7-j+b,noOfDays+=f}else"DAY"==c&&(noOfDays=f?f+b:b-(new Date(e)-new Date(d))/g%b);return noOfDays=Math.ceil(noOfDays),noOfDays},getNextAutoTopUpDate:function(a,b,c,d){var e,b=parseFloat(b);if(e=d>a?new Date(d):new Date(a),"MONTH"==c){var f=new Date(e).getDate();e.setDate(b),f>b&&e.setMonth(e.getMonth()+1)}else if("WEEK"==c){var g=new Date(e).getDay()+1;g<b?e.setDate(e.getDate()+(b-g)):e.setDate(e.getDate()+(7-g+b))}else"DAY"==c&&(e=new Date(a+864e5*this.getNumberOfDaysForTopUp(a,b,c,d)));return e},daysInMonth:function(a,b){return new Date(b,a,0).getDate()},deepDiffMapper:{VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",map:function(b,c){if(this.isFunction(b)||this.isFunction(c))throw"Invalid argument. Function given, object expected.";if(this.isValue(b)||this.isValue(c))return{type:this.compareValues(b,c),data:b};var d={};for(var e in b)if(!this.isFunction(b[e])){var f=void 0;c&&void 0!==c[e]&&(f=c[e]),d[e]=this.map(b[e],f)}for(var e in c)this.isFunction(c[e])||a.isEmpty(c[e])||void 0!==d[e]||(d[e]=this.map(void 0,c[e]));return d},compareValues:function(a,b){return a===b?this.VALUE_UNCHANGED:void 0===a?this.VALUE_DELETED:void 0===b?this.VALUE_CREATED:this.VALUE_UPDATED},isFunction:function(a){return"[object Function]"===Object.prototype.toString.apply(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},isObject:function(a){return"[object Object]"===Object.prototype.toString.apply(a)},isValue:function(a){return!this.isObject(a)&&!this.isArray(a)}},getMultiLineEllipsis:function(a){for(var b=(a.height(),a.parent().height());a.height()>b;)a.text(function(a,b){return b.replace(/\W*\s(\S)*$/,"...")})},applyMultiLineEllipsisWithLink:function(a,b){var c=a.height();a.text(),c>b&&(a.parent().css("height",b),a.css("height",b),a.css("overflow","hidden"),a.parent().append(g),a.parent().find('[data-uxf-point="show-more-link"]').on("click",function(b){b.stopPropagation(),a.parent().css("height",c),a.css("height",c),a.css("overflow","visible"),a.parent().find('[data-uxf-point="continueDots"]').css("display","none"),a.parent().find('[data-uxf-point="show-less-link"]').css("display","block"),a.parent().find('[data-uxf-point="show-more-link"]').css("display","none")}),a.parent().find('[data-uxf-point="show-less-link"]').on("click",function(c){c.stopPropagation(),a.parent().css("height",b),a.css("height",b),a.css("overflow","hidden"),a.parent().find('[data-uxf-point="continueDots"]').css("display","block"),a.parent().find('[data-uxf-point="show-less-link"]').css("display","none"),a.parent().find('[data-uxf-point="show-more-link"]').css("display","block")}))},applyMultiLineEllipsisWithoutLink:function(a,b,c){var d=a.height();a.text(),d>c&&a.each(function(){var d=a.text();d.length<b||(e(this).html(d.slice(0,b)+"..."),a.parent().css("height",c),a.css("height",c))})},applyMultiLineEllipsis:function(a,b,c){var d=a.height();a.text(),d>c&&(a.each(function(){var d=a.text();d.length<b||(e(this).html(d.slice(0,b)+h+d.slice(b,d.length)+i),a.parent().css("height",c),a.css("height",c))}),e('[data-uxf-point="show-more-link"]',a).click(function(b){b.preventDefault(),a.parent().css("height",d),a.css("height",d),e(this).hide().prev().hide(),e(this).next().show()}),e('[data-uxf-point="show-less-link"]',a).click(function(b){b.preventDefault(),a.parent().css("height",c),a.css("height",c),e(this).parent().hide().prev().show().prev().show()}))},getDecimalRegex:function(){return/^[1-9]\d*(\.\d+)?$/},getCurrencyRegex:function(){return/^\$?[0-9][0-9]*(\.\d{1,2})?$|^\$?[\.]([\d][\d]?)$/},getCaretPos:function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"===a.selectionStart)&&(b=a.selectionStart);return b},getDecimalSeparator:function(){return c.getString("decimalSeparator")},isSingleWirelessTelco:function(){this.lobViewModel=new j,this.lobViewModel.lazyLoadData();var a=this.lobViewModel.get("lobDetailData");return 1==a.length&&a[0].code==d.get("lobs").WS},getPhoneNumberAllowedLength:function(){var a=c.getString("localPhoneNumberFormat"),b=0;if(a)for(var d=a.length,e=0;e<d;e++)"#"===a[e]&&(b+=1);return b},getPhoneNumberLength:function(){var a=c.getString("localPhoneNumberFormat"),b=0;return a&&(b=a.length),b},unFormatPhoneNumber:function(a){var b=0;void 0!=a&&(b=a.length);var d="";if(0===b)return"";for(var e=0;e<b;e++){var f=a[e];!isNaN(parseFloat(f))&&isFinite(f)&&(d+=f)}var g=(c.getString("localPhoneNumberFormat"),this.getPhoneNumberAllowedLength());return d.length>g&&(d=d.substring(0,g)),d},formatPhoneNumber:k.formatPhoneNumber,showChangePlan:function(a){var b=a.bundle,c=a.shared,d=a.productStatus;return!b&&!c&&"SUSPENDED"!=d},dataLabelFormatter:function(a){var b=this.total,c=d.getLocale();return c=c.toLowerCase(),b="en-us"==c?Highcharts.numberFormat(b,2,".",","):Highcharts.numberFormat(b,2,",","."),a?a+b:b},getSeriesColors:function(){var a=[],b=e("<span></span>");return function(c){var d,f,g;if(void 0===a[c]){for(g=[],a[c]=g,e("body").append(b),d=0;d<c;d++)b.addClass("cm-chart-"+d),f=b.css("color"),f&&g.push(f),b.removeClass("cm-chart-"+d);b.remove()}return a[c]}}(),formatChartMonthByTouchPoint:function(a,b){return"M"===d.get("touchPoint")?this.shortMonthName(a):this.shortMonthName(a)+"-"+new String(b).substring(2,4)},formatNumberString:function(a){if(a){if("0"==(a=a.toString()))return"0.00";var b="";0==a.indexOf("-")&&(b="-",a=a.substring(1)),-1==a.indexOf(".")&&(a+=".00"),a.indexOf(".")==a.length-1&&(a+="00"),a.indexOf(".")==a.length-2&&(a+="0"),0==a.indexOf(".")&&(a="0"+a);var c=a.substring(a.indexOf(".")+1),e=a.substring(0,a.indexOf(".")),f=""+parseInt(a)/1e3;-1!=f.indexOf(".")&&(f=f.substring(0,f.indexOf("."))),e=""+parseFloat(e)%1e3;var g=d.getLocale();g=g.toLowerCase();var h=".",i=",";return"en-us"==!g&&(i=".",h=","),"0"!=f&&""!=f||(f="",i=""),2==e.length&&""==!f&&(e="0"+e),1==e.length&&""==!f&&(e="00"+e),b+f+i+e+h+c}return"0.00"},isPhoneNumber:function(b){return a.contains(this.phoneLobs,b)},formatNodeResource:function(a,b){return this.isPhoneNumber(a)?this.formatPhoneNumber(b):b},isDisplayInstallationAddress:function(b){return a.contains(this.installationAddressLobs,b)},getMonthValidationRegEx:function(a){return a?"^(\\d{4})-(0[1-9]|1[0-2])$":/^(\d{4})-(0[1-9]|1[0-2])$/},isValidCreditCardNumber:function(a){var b=/(^[0-9]+$)/;return 0!=a.length&&!!b.test(a)},_isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isValidateNumber:function(a,b,c){var d=!1;if(isNaN(a))return!1;if(a=""+a){b||(b=!1),(!c||c<0)&&(c=-1);var e=0,f=!1;a.indexOf(".")==a.length-1?(e=parseFloat(a+"0"),f=null!=(a+"0").match(/^-?\d*(\.\d+)?$/)):(f=null!=a.match(/^-?\d*(\.\d+)?$/),e=parseFloat(a));var g=!1;-1!=a.indexOf(".")&&(g=a.length-1-a.indexOf(".")>c),d=!(!f||b&&"-"==a||b&&e<0||g)}return d},formatCurrencyToNumber:function(a){var b=c.getString("currency_symbol")||"",d=c.getString("thousandsSeparator")||",",e=c.getString("decimalSeparator")||".",f=(a.length,m.replaceAll(a,b,""));return f=m.replaceAll(f,d,""),f=m.replaceAll(f,e,"."),Number(f)},getWholePart:function(a){var b=Math.floor(a<0?-a:a);return a<0?-b:b},formatNumberToCurrency:function(a,b){b=b||{};var e,f=d.get("defaultNumberOfDecimalsKey"),g=c.getString(f);e=g?new String(Number(a).toFixed(g)):b.fixed?new String(Number(a).toFixed(b.fixed)):new String(a);var h=e.match(/(.*)\.(.*)$/,"$2")?e.replace(/(.*)\.(.*)$/,"$2"):"",i=c.getString("thousandsSeparator")||",",j=c.getString("decimalSeparator")||".",k=m.getWholePart(a).toString(),l=k.length,n=/^\d{4,}$/.test(k)?l%3:0;return(c.getString("currency_symbol")||"")+(n?k.slice(0,n)+i:"")+k.slice(n).replace(/(\d{3})(?=\d)/g,"$1"+i)+(h?j+h:"")},generateTemporaryId:function(){return"C-"+Math.random().toString(36).substr(2)},getFormattedDate:function(a,b){var d=new Date(a),e=d.getDate(),f=d.getMonth()+1,g=d.getFullYear().toString(),h=b;return h=h.replace("yyyy",g),h=h.replace("yy",function(){return g.substring(2,4)}),h=h.replace("dd",function(){return e<10?"0"+e:e}),h=h.replace("mmmm",function(){return c.getString("FULL_MONTH_"+f)}),h=h.replace("mmm",function(){return c.getString("MONTH_"+f)}),h=h.replace("mm",function(){return f<10?"0"+f:f})},getProductActionType:function(a,b,d){this.rb=c;var e="";if(a)switch(a){case"ADD_PRODUCT":e="oms_ConfigureMultiProductWidget_ADD_PRODUCT",d?e="oms_ConfigureMultiProductWidget_AMEND_PROVIDE":b&&(e="oms_ConfigureMultiProductWidget_REPLACE_OFFER_PROVIDE");break;case"CHANGE_PRODUCT":e="oms_ConfigureMultiProductWidget_CHANGE_PRODUCT",d?e="oms_ConfigureMultiProductWidget_AMEND_CHANGE":b&&(e="oms_ConfigureMultiProductWidget_REPLACE_OFFER_CHANGE");break;case"SUSPEND_PRODUCT":e="oms_ConfigureMultiProductWidget_SUSPEND_PRODUCT",d&&(e="oms_ConfigureMultiProductWidget_AMEND_SUSPEND");break;case"RESUME_PRODUCT":e="oms_ConfigureMultiProductWidget_RESUME_PRODUCT",d&&(e="oms_ConfigureMultiProductWidget_AMEND_RESUME");break;case"REMOVE_PRODUCT":e="oms_ConfigureMultiProductWidget_REMOVE_PRODUCT",d?e="oms_ConfigureMultiProductWidget_AMEND_CEASE":b&&(e="oms_ConfigureMultiProductWidget_REPLACE_OFFER_CEASE");break;case"REESTABLISH_PRODUCT":e="oms_ConfigureMultiProductWidget_REESTABLISH_PRODUCT",d&&(e="oms_ConfigureMultiProductWidget_AMEND_REESTABLISH");break;case"CEASE_MOVE":case"Cease Part of Move":e="oms_ConfigureMultiProductWidget_CEASE_MOVE";break;case"PROVIDE_MOVE":case"Provide Part of Move":e="oms_ConfigureMultiProductWidget_PROVIDE_MOVE",d&&(e="oms_ConfigureMultiProductWidget_AMEND_PROVIDE_MOVE");break;case"MOVE_PRODUCT":e="oms_ConfigureMultiProductWidget_MOVE_PRODUCT";break;case"CHANGE_OWNERSHIP":e="oms_ConfigureMultiProductWidget_CHANGE_OWNERSHIP",d&&(e="oms_ConfigureMultiProductWidget_AMEND_CHANGE_OWNERSHIP");break;case"NOTIFY_DISCOUNTS":e="oms_ConfigureMultiProductWidget_NOTIFY_DISCOUNTS";break;case"UPDATE_CONTACT":e="oms_ConfigureMultiProductWidget_UPDATE_CONTACT"}return this.rb.getString(e)},setAnonymousRequestHeader:function(a){var c=b.Core.StorageUtil.getStorage("securedPersistentCookie").get(d.get("anonymousSecurityKey"));c&&a.setRequestHeader(d.get("anonymousSecurityKey"),c)},setAnonymousRequestHeaderInCookie:function(a){var c=a.getResponseHeader(d.get("anonymousSecurityKey"));c&&b.Core.StorageUtil.getStorage("securedPersistentCookie").set(d.get("anonymousSecurityKey"),c)},showAuthenticationModal:function(a,c){var d=new b.Core.ObservableViewModel;d.set("inputPassword",f.observable("")),d.set("confirmCallBack",c);var e=b.UI.ModalView.extend({confirmAction:function(){this.viewModel.get("confirmCallBack")&&this.viewModel.get("confirmCallBack")(this.viewModel.data.inputPassword()),this.close()}});this.errorModal=new e({el:a,config:{template:l},viewModel:d})},getImageBaseURL:function(a){var b=require.toUrl(".");return a?b+"/"+d.get("imageBase")+a:b+"/"+d.get("imageBase")},generateTemporaryId:function(){return"C-"+Math.random().toString(36).substr(2)}};return m});
define("businesswidget/repository/common/viewmodel/UserInformationViewModel",["lightsaber","underscore"],function (a,b){var c=a.Core.ViewModel.extend({initialize:function(a){},fetchSync:function(a){return!0},getProperty:function(a){return 1},fetch:function(a){}}),d=c.extend({}),e={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"UserInformationViewModel",path:"businesswidget/repository/common/viewmodel/UserInformationViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"_",pathName:"underscore"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},fetchSync:{name:"fetchSync",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getProperty:{name:"getProperty",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},fetch:{name:"fetch",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/util/HelperBase",["underscore","backbone","lightsaber"],function (a,b,c){var d=function(a){this.initialize(a)};return a.extend(d,{extend:c.Core.Utils.extend}),a.extend(d.prototype,b.Events,{initialize:function(a){},create:c.Core.Utils.create}),d});
define("businesswidget/repository/common/util/BusinessHelper",["underscore","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/util/HelperBase","businesswidget/repository/common/util/PhoneNumberFormatter"],function (a,b,c,d,e,f){var g=e.extend({getOrderDescription:function(a,e){if(a===b.get("ordersListPage.createdInDefaultGenCodeValue"))return e.description;switch(e.orderItems[0].actionType){case b.get("ordersListPage.actionType.ADD_PRODUCT"):return c.getString("smb_ordersListPage_description_NewSubscription")+d.formatPhoneNumber(e.orderItems[0].productServiceID);case b.get("ordersListPage.actionType.CHANGE_PRODUCT"):return c.getString("smb_ordersListPage_description_UpdatesOnSubscription")+d.formatPhoneNumber(e.orderItems[0].productServiceID);case b.get("ordersListPage.actionType.REMOVE_PRODUCT"):return c.getString("smb_ordersListPage_description_RemoveSubscription")+d.formatPhoneNumber(e.orderItems[0].productServiceID);case b.get("ordersListPage.actionType.NEW_BOT_PRODUCT"):return c.getString("smb_ordersListPage_description_NewSubscriptionBasedOnBusinessOfferTemplate")+d.formatPhoneNumber(e.orderItems[0].productServiceID);case b.get("ordersListPage.actionType.CHANGE_BOT"):case b.get("ordersListPage.actionType.PROVIDE_FWA"):return c.getString("smb_ordersListPage_description_UpdatesOnFrameworkAgreement");case b.get("ordersListPage.actionType.ALIGN_PRODUCT_BOT"):return c.getString("smb_ordersListPage_description_AlignSubscriptionWithBusinessOfferTemplate");default:return c.getString("smb_ordersListPage_description_ChangeDoneVia")+a}},isValidAssignedProductId:function(b){var c=!0;return(a.isNull(b)||"null"===b||a.isUndefined(b)||a.isEmpty(b))&&(c=!1),c},getLOBNameFromReferenceData:function(a,b){return"Other"==b.lineOfBusiness?b.productName||b.productOfferingName:"SERVICE_ID"===a.displayIdentifier&&b.productServiceID&&"unknown"!==b.productServiceID?null!=b.productServiceID.match(/^[0-9]+$/)?this.formatPhoneNumber(b.productServiceID):b.productServiceID:null},getOrderCreatedBy:function(a,d){return a===b.get("ordersListPage.createdInDefaultGenCodeValue")?d.orderItems[0].createdBy:c.getString("smb_myOrdersWidget_createdBy_"+d.currentSalesChannel)},ORDER_ID_SUFFIX:"A",orderActionType:["CE"],WORK_INDICATORS:{OWNER_INDICATOR:"W1",MEMBER_INDICATOR:"W2"},subscriptionTypes:{GLP:"GLP",MULTIGLP:"MULTIGLP",MULTI:"MULTI",INDIVIDUAL:"INDIVIDUAL"},level:{ACCOUNT:"ACCOUNT",SHARED:"SHARED",SUBSCRIBER:"SUBSCRIBER"},lob:{WIRELESS:b.get("lobs").WS,WIRELINE:b.get("lobs").WL,INTERNET:b.get("lobs").IN,TV:b.get("lobs").TV},lobName:{WS:"Wireless",WL:"Home Phone",IN:"Internet",TV:"TV"},status:{ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",REMOVED:"REMOVED"},entireAccount:{id:"EntireAccount",name:"Entire Account"},displayIdentifier:{ADDRESS:"ADDRESS",SERVICE_ID:"SERVICE_ID"},navigationItems:{PLAN:"plan",DEVICES:"devices",SERVICES:"services",PACKAGES:"packages",CHANNELS:"channels",RECEIVERS:"receivers"},businessType:{SPECIALPACKAGES:"SPECIAL_PACKAGES",REGULAR:"REGULAR"},lobsHierarchyProductsComparator:function(a){var b="";if(!0===a.get("isLob")&&a.get("id")===g.prototype.lob.WIRELESS)b="1";else if(a.get("isLob")||a.get("lob")!==g.prototype.lob.WIRELESS)!0===a.get("isLob")&&a.get("id")===g.prototype.lob.WIRELINE?b="3":a.get("isLob")||a.get("lob")!==g.prototype.lob.WIRELINE?!0===a.get("isLob")&&a.get("id")===g.prototype.lob.TV?b="4":a.get("isLob")||a.get("lob")!==g.prototype.lob.TV?!0===a.get("isLob")&&a.get("id")===g.prototype.lob.INTERNET?b="5":a.get("isLob")||a.get("lob")!==g.prototype.lob.INTERNET||(b="5_"+a.get("lob")):b="4_"+a.get("lob"):b=a.get("serviceId")?"3_"+a.get("serviceId"):"3_"+a.get("lob");else if(a.get("GLP"))b="1_"+a.get("GLP");else if(b="2",a.get("personId")){var c;a.get("name")?(c=a.get("name"),b+="_1_"+c+"_"+a.get("serviceId")):b+="_2_"+a.get("serviceId")}else b+="_2_"+a.get("serviceId");return b},isOwner:function(){},isMember:function(){},formatPhoneNumber:function(){return f.formatPhoneNumber.apply(window,arguments)},getContextId:function(){return"ctxid:"+a.uniqueId()},getNumberOfLOBsToBeFetchedForAddsubscription:function(){return 100}});return g});
define("businesswidget/repository/common/model/LoginModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"Login",rest:{defaults:{qParams:{}}}}})});
define("businesswidget/repository/common/viewmodel/LoginViewModel",["jquery","underscore","lightsaber","businesswidget/repository/common/model/LoginModel"],function (a,b,c,d){return c.Core.ViewModel.extend({invokeLogin:function(a){return this.sendCredentials(b.defaults({Model:d},a))},sendCredentials:function(a){var b=a.username,c=a.password;return(new a.Model).save({Credentials:{user:b,password:c}},{success:a.success,error:a.error})}})});
define("businesswidget/repository/common/model/CustomerProductOfferingInstanceIdModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:custId/product-offering-instance/:productOfferingInstanceId",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},payload:["NewProductInOfferingInstanceConfigurationRequest"]},create:{method:"PUT",url:"commerce/customer/:custId/product-offering-instance/:productOfferingInstanceId",payload:["NewProductInOfferingInstanceConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductOfferingInstanceModel",path:"businesswidget/repository/common/model/CustomerProductOfferingInstanceModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:custId/product-offering-instance/:productOfferingInstanceId"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"sc",value:'Configuration.get("salesChannel")'},{key:"locale",value:'Configuration.get("locale")'}],isJSON:!0},payload:{value:["NewProductInOfferingInstanceConfigurationRequest"]}},create:{method:{value:"PUT"},url:{value:"commerce/customer/:custId/product-offering-instance/:productOfferingInstanceId"},payload:{value:["NewProductInOfferingInstanceConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/core/RESTCollection",["lightsaber","underscore","Configuration"],function (a,b,c){var d=a.Core.Collection.extend({options:{url:""},setRESTConfig:function(a){return a.defaults&&a.defaults.module||(a.defaults=b.defaults({module:this._getRESTDefaultModule()},a.defaults||{})),this._super(a)},_getRESTDefaultModule:function(){return c.get("cm_rest_default_module")}}),e=d.extend({}),f={parent:"Lightsaber.Core.Collection",type:"model",name:"RESTCollection",path:"businesswidget/repository/common/core/RESTCollection.js",savePath:"businesswidget/repository/common/core",description:"","extends":"Lightsaber.Core.Collection",extendsClassPath:"",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"Configuration"}],replaced:!1,dataSource:"rest",modelType:"model",fixturesPath:"businesswidget/repository/common/core/RESTCollection_fixtures.js",validations:[],methods:{setRESTConfig:{name:"setRESTConfig",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_getRESTDefaultModule:{name:"_getRESTDefaultModule",privacyLevel:"private",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}},modelOptions:{modelProperties:{url:{isMandatory:!1,value:""}}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerPredictionModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"insight/customer/:customerId/prediction",rest:{defaults:{qParams:{}}}}})});
define("businesswidget/repository/common/model/NotificationUserRetrieveNotificationsModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"notification/self-service-user/:userId/notifications",rest:{defaults:{qParams:{}}}}})});
define("businesswidget/repository/common/model/CommunicationCustomerSelfServiceUserNotificationPreferencesModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{url:"communication/customer/:custId/self-service-user/:user/notification-preferences",rest:{read:{method:"GET",url:"communication/customer/:custId/self-service-user/:user/notification-preferences"},update:{method:"PUT",contentType:"application/json",url:"communication/customer/:custId/self-service-user/:user/notification-preferences",payload:["NotificationPreferences"]},create:{method:"POST",contentType:"application/json",
url:"communication/customer/:custId/self-service-user/:user/notification-preferences"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}}}})});
define("businesswidget/repository/common/model/BusinessCustomerIdDraftOrdersModel",["underscore","jquery","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c,d){return c.extend({url:"ecommerce/business-customer/:customerId/draft-orders",options:{rest:{save:{method:"POST",contentType:"application/json"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")},payload:["BusinessDraftOrdersRequest"]}}}})});
define("businesswidget/repository/common/model/CustomerSubscriptionsModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){function e(a){return null==a.Subscriptions.subscriptions||0==a.Subscriptions.subscriptions.length?{pageStart:0,totalSize:0,data:[]}:{pageStart:a.Subscriptions.startIndex,totalSize:a.Subscriptions.totalResults,data:a.Subscriptions.subscriptions}}var f=b.extend({options:{url:"ecommerce/customer/:customerId/search-subscriptions",rest:{create:{method:"POST",contentType:"application/json"},defaults:{payload:["SearchSubscriptionRequest"],qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},readPage:{supportsPagination:!0,supportsSorting:!0,parse:e,names:{pageStart:"st",pageSize:"ps"}}}}});return f.idAttribute="subscriptionID",f});
define("businesswidget/repository/common/model/FrameworkAgreementsModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{rest:{read:{method:"GET"},defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}}},url:"ecommerce/business-customer/:customerId/framework-agreements"}})});
define("businesswidget/repository/common/viewmodel/WidgetBaseObservableViewModel",["src/core/viewModel/ObservableViewModel","businesswidget/repository/common/core/LSResourceBundleCust"],function (a,b){var c=a.extend({config:{resourceBundle:b},getResourceBundle:function(){return this.getConfig("resourceBundle")},getString:function(a,b){return this.getConfig("resourceBundle").getString(a,b)},on:function(a,b,c,d){return!d&&c&&c.addViewModel&&c.addViewModel(a,b,this),Backbone.Events.on.call(this,a,b,c)}},{getRepositoryResourceBundle:function(){return b}}),d={name:"WidgetBaseObservableViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"ResourceBundle",pathName:"businesswidget/repository/common/core/LSResourceBundleCust"},{variable:"ObservableViewModel",pathName:"exclude!src/core/viewModel/ObservableViewModel"}],methods:{getResourceBundle:{name:"getResourceBundle",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getString:{name:"getString",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},on:{name:"on",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}},config:{resourceBundle:"ResourceBundle"}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/util/CustomFormattersContainer",["underscore","require","knockout","src/core/formatter/FormattersContainer"],function (a,b,c,d){var e=function(){},f={customChargeFormatter:function(b,c){var e,f=this.getResourceBundle();return a.isUndefined(b)?e="":(e=d.prototype.default_number_formatter.apply(this,arguments),b<0&&(e=f.getString("oms_NPCWidget_negativeCharge",[e]))),e},addBracketsFormatter:function(a){return"("+a+")"},addColonFormatter:function(a){return a+":"},addCommasFormatter:function(a){for(var b="",c=0;c<a.length;c++)b=b+a[c].value()+", ";return b=b.substring(0,b.length-2)},preparePrice:function(d,e,f,g){for(var h=0;h<f.length;h++){var i=f[h];if(d[i]){if(e[i]=d[i],a.isEmpty(d[i])){if(e[i].finalAmount=0,e[i].originalAmount=0,"recurringPrice"==i){var j=b("Configuration");e[i].frequency=j.get("itemListWidget_defaultRecurringFrequency")}e[i].displayOriginalAmount=!1}else c.unwrap(d[i].originalAmount)!==c.unwrap(d[i].finalAmount)?e[i].displayOriginalAmount=!0:e[i].displayOriginalAmount=!1;g&&(e[i].displayCurrency=!0)}}return e},customPricePreparationFormatter:function(a){var b={},d=["oneTimePrice","recurringPrice"];return displayCurrency=c.unwrap(a.metadata.displayCurrency),b.currency=c.unwrap(a.currency),b=f.preparePrice(a,b,d,displayCurrency)},searchResultHighlightFormatter:function(a){for(var b=this.getParams().searchText,c=b.split(/ /g),d=0;d<c.length;d++){var e=new RegExp("(?:^|\\s)("+c[d]+")(?=\\s|$)","gi");a=a.replace(e,' <span class="ux-search__highlight">$1</span> ')}return a},cm_currency_formatter:function(c){var d=b("Configuration"),e=$.extend(!0,{},d.get("cm_currency_formatter_defaults"),this.getParams()),f=this.getResourceBundle(),g={amount:c};dummyContext=a.defaults({getVMData:function(a){return g[a]}},this),amountFormatterOptions=a.defaults({fields:["amount"]},e.amountFormatterOptions),LSFormatter=b("single!src/core/formatter/Formatter"),formattedAmount=LSFormatter.format(dummyContext,amountFormatterOptions);var h=e.currency||f.getString(e.currencyCode);e.currencyClass&&(h='<span class="'+e.currencyClass+'">'+h+"</span>"),h=(e.currencyPrefix||"")+h+(e.currencySuffix||"");var i,j;switch(e.currencyPosition){case"before":i=h+formattedAmount;break;case"after":i=formattedAmount+h;break;case"afterSign":j=formattedAmount.indexOf("-")+1,i=formattedAmount.substr(0,j)+h+formattedAmount.substr(j);break;case"placeholder":i=formattedAmount.replace("%currency%",h)}return i}};return a.extend(e.prototype,d.prototype),a.extend(e.prototype,f),e});
define("businesswidget/repository/common/viewmodel/UserInContextTopicViewModel",["underscore","lightsaber"],function (a,b){var c=b.Core.ViewModel.extend({defaults:{userId:null}}),d=c.extend({}),e={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"UserInContextTopicViewModel",path:"businesswidget/repository/common/viewmodel/UserInContextTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"}],models:[],viewModels:[],dataBindings:[],methods:{},defaults:[{key:"userId",value:"null"}]};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/model/SupportInteractionModel",["underscore","lightsaber","Configuration"],function (a,b,c){return b.Core.RESTModel.extend({options:{url:"support/individual/:individualId/interactions",rest:{defaults:{},read:{}}}}).extend({})});
define("businesswidget/repository/common/viewmodel/SupportInteractionViewModel",["lightsaber","businesswidget/repository/common/model/SupportInteractionModel","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c){return a.Core.ViewModel.extend({defaults:{joureneyItesm:[],name:"interactions"},models:{supportInteractionModel:b},initialize:function(a){_.bindAll(this,"loadData","_onsupportInteractionFetchSuccess","_onsupportInteractionFetchError"),this._super(a)},loadData:function(a){this.models.supportInteractionModel.urlRoot=a,this.models.supportInteractionModel.fetch({success:this._onsupportInteractionFetchSuccess,error:this._onsupportInteractionFetchError})},_onsupportInteractionFetchSuccess:function(a,b){var c=this,d=[],e=null,f=b.SearchInteractionsResponse.interactions;if(f)for(var g=0;g<f.length;g++)e=f[g],d.push({id:e.ID,name:e.name,creationChannel:e.creationChannel,creationMedium:e.creationMedium,icon:c.getImageIcon(e),detailIcon:c.getImageIconWhite(e),activityType:e.activityType,displayableActivityType:e.displayableActivityType,creationDate:e.creationDate,additionalInfo:e.additionalInfo,title:e.displayableActivityType,date:c.getDateValue(e)+" Via "+e.creationMedium,descriptionPart1:e.name,descriptionPart2:"Type :"+e.activityType,isEntityActivity:!1,iconDivider:"social"});this.set("joureneyItesm",$.extend(!0,{},d))},_onsupportInteractionFetchError:function(){this.set("joureneyItesm",null)},getImageIcon:function(a){var b="businesswidget/repository/common/resources/accountManagement/web/ccView/images/icons/";return b+="CALL"===a.activityType.toUpperCase()?"Phone.png":"EMAIL"===a.activityType.toUpperCase()?"Mail.png":"SOCIAL_MEDIA"===a.activityType.toUpperCase()?"Interaction.png":"IN PERSON"===a.activityType.toUpperCase()?"Retail.png":"OTHER"===a.activityType.toUpperCase()&&"FAX"===a.creationMedium.toUpperCase()?"Fax.png":a.creationMedium&&"EMAIL"===a.creationMedium.toUpperCase()?"Mail.png":a.creationMedium&&"SOCIAL"===a.creationMedium.toUpperCase()?"Interaction.png":a.creationMedium&&"RETAIL"===a.creationMedium.toUpperCase()?"Retail.png":"Phone.png"},getImageIconWhite:function(a){var b="businesswidget/repository/common/resources/accountManagement/web/ccView/images/icons/";return b+="CALL"===a.activityType.toUpperCase()?"F_Phone.png":"EMAIL"===a.activityType.toUpperCase()?"F_Mail.png":"SOCIAL_MEDIA"===a.activityType.toUpperCase()?"F_Interaction.png":"IN PERSON"===a.activityType.toUpperCase()?"F_Retail.png":"OTHER"===a.activityType.toUpperCase()&&"FAX"===a.creationMedium.toUpperCase()?"F_Fax.png":a.creationMedium&&"EMAIL"===a.creationMedium.toUpperCase()?"F_Mail.png":a.creationMedium&&"SOCIAL"===a.creationMedium.toUpperCase()?"F_Interaction.png":a.creationMedium&&"RETAIL"===a.creationMedium.toUpperCase()?"F_Retail.png":"F_Phone.png"},getDateValue:function(a){return new Date(a.creationDate),c.getDateString(a.creationDate,!0,12)}})});
define("businesswidget/repository/common/viewmodel/CancelLinkViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{widgetID:null,widgetName:null,identifier:{}}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CancelLinkViewModel",path:"businesswidget/repository/common/viewmodel/CancelLinkViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetID:{key:"widgetID",value:"null"},widgetName:{key:"widgetName",value:"null"},identifier:{key:"identifier",value:"{}"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/model/AnonymousCustomerProductOfferingInstanceModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/core/Configuration"],function (a,b,c,d){return a.extend({options:{url:"commerce/anonymous/product-offering/:productOfferingId/product-order",rest:{defaults:{qParams:{sc:d.get("salesChannel"),lo:d.get("locale")},payload:["CreateNewOfferingConfigurationRequest"]}}},parse:function(a,b){return c.setAnonymousRequestHeaderInCookie(b.xhr),this._super(a,b)}})});
define("businesswidget/repository/common/model/AnonymousCustomerOfferingHasAddOnsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/commerce/anonymous/product-offering/:offeringId/has-add-ons",rest:{defaults:{qParams:{numOfLOB:1,sc:c.get("salesChannel"),lo:c.get("locale")}}}}})});
define("businesswidget/repository/common/model/AnonymousCartResModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel","Configuration","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d,e){return c.extend({fetch:function(a){return a.beforeSend=function(a){e.setAnonymousRequestHeader(a)},this._super(a)},options:{url:"commerce/anonymous/product-order/:productOrderId",rest:{defaults:{method:"GET",qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},read:{url:"commerce/anonymous/product-order/:productOrderId"}}}})});
define("businesswidget/repository/common/model/CommerceAnonymousHardGoodSpecProductOrderModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d){return b.extend({options:{url:"/commerce/anonymous/hard-good-spec/:hardGoodSpecId/product-order",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["CreateNewHardGoodOrderRequest"]}}},parse:function(a,b){return d.setAnonymousRequestHeaderInCookie(b.xhr),this._super(a,b)}})});
define("businesswidget/repository/common/model/AnonymousProductOfferingInstanceIdModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){return a.extend({options:{url:"commerce/anonymous/product-offering-instance/:productOfferingInstanceId",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},payload:["NewProductInOfferingInstanceConfigurationRequest"]},create:{method:"PUT",url:"commerce/anonymous/product-offering-instance/:productOfferingInstanceId",payload:["NewProductInOfferingInstanceConfigurationRequest"]}}}})});
define("businesswidget/repository/common/viewmodel/NotificationWidgetViewModel",["jquery","underscore","lightsaber","businesswidget/repository/common/model/CustomerPredictionModel","businesswidget/repository/common/model/NotificationUserRetrieveNotificationsModel","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d,e,f){return c.Core.ViewModel.extend({defaults:{customerId:null,username:null},initialize:function(a){b.bindAll(this,"_createSubViewModels","_onMotivationFetchSuccess","_onMotivationFetchError","_onNotificationFetchSuccess","_onNotificationFetchError","getNumberOfNotifications","getRecentNotification","_fetchMotivationData","_fetchNotificationData","_beforeMotivationFetch","_beforeNotificationFetch","_storeNotificationsData","_mergeNotifications","_updateNotificationInfo","_clearNotificationStoreInfo","_getBannerItem","updateBannerNotificationViewedStatus","_fetchMotivationAndNotification","populateNotificationData"),this.router=a.router,this.rb=this.getResourceBundle()},loadNotificationData:function(){this.clearData(),this.isDataAvailable()?this.populateNotificationData():this.trigger("notificationWidget:noData")},isDataAvailable:function(){return this.get("customerId")||this.get("username")},clearData:function(){c.Core.StorageUtil.set("notificationsData",void 0),c.Core.StorageUtil.set("numberOfNotification",void 0),c.Core.StorageUtil.set("numberOfMotivations",void 0),c.Core.StorageUtil.set("notificationSelectedItem",void 0)},populateNotificationData:function(a){this._createSubViewModels(a),this._clearNotificationStoreInfo(),
this._unreadNotifications=0,this.motivationDateTime=null,b.defer(this._fetchMotivationAndNotification)},_createSubViewModels:function(a){this.models.customerPredictionModel=this.create("mcss_landingpage_customerprediction_m",d),this.models.customerNotificationModel=this.create("mcss_landingpage_notificationuser_retrievenotifications_m",e),this.subViewModels.motivationList=this.create("mcss_landingPageViewModel_motivationListViewModel",c.ItemListViewModel,{models:{items:new c.Core.Collection},config:{autoUpdate:!0}}),this.subViewModels.motivationList.models.items.comparator=function(a){return-a.get("probability")},this.subViewModels.notificationList=this.create("mcss_landingPageViewModel_notificationListViewModel",c.ItemListViewModel,{models:{items:new c.Core.Collection},config:{autoUpdate:!0}}),this.subViewModels.notificationList.models.items.comparator=function(a){return-a.get("sortDate").getTime()}},_onMotivationFetchSuccess:function(a,c){this.motivationDateTime=(new Date).getTime();var d=a.get("Prediction");if(d){var e=d.motivations;e&&b.isArray(e)&&this._storeNotificationsData(e,"Motivation",this.subViewModels.motivationList)}},_onNotificationFetchSuccess:function(){this._mergeNotifications();var a=this.models.customerNotificationModel.get("NotificationDetails");if(a){var c=a.messages;c&&b.isArray(c)&&this._storeNotificationsData(c,"Notification",this.subViewModels.notificationList)}this._updateNotificationInfo()},_mergeNotifications:function(){for(var a=0;a<this.subViewModels.motivationList.models.items.length;a++)this.subViewModels.notificationList.add(this.create("mcss_landingPageNotificationsVM_notificationList_itemModel",c.Core.Model,this.subViewModels.motivationList.getData().items[a]))},_storeNotificationsData:function(a,b,d){for(var e=0;e<a.length;e++){var g=a[e];if(g){g.category=b,g.probability=g.probability?g.probability:"0",g.explicitFeedbackSubmitted=!1,g.status="Notification"==b?g.status:"U","Notification"==b&&"C"!==g.status&&this._unreadNotifications++;var h="Notification"==b?h=parseInt(g.id):new Date;g.date=f.getDateString(h,!1,f.format.full),g.sortDate=new Date("Notification"==b?parseInt(g.id):this.motivationDateTime);var i=this.create("mcss_landingPageNotificationsVM_notification_itemModel",c.Core.Model,g);d.add(i)}}},_updateNotificationInfo:function(){c.Core.StorageUtil.set("notificationsData",this.subViewModels.notificationList.getData()),c.Core.StorageUtil.set("numberOfNotification",this._unreadNotifications+this.subViewModels.motivationList.models.items.length),c.Core.StorageUtil.set("numberOfMotivations",this.subViewModels.motivationList.models.items.length);var a=this._getBannerItem(this.subViewModels.notificationList.getData().items);if(void 0!=a){c.Core.StorageUtil.set("notificationSelectedItem",a);var b={description:a.description,date:a.date,alertcount:c.Core.StorageUtil.get("numberOfNotification")};this.set("notificationInfoObject",b)}else this.subViewModels.notificationList.getData().items&&this.subViewModels.notificationList.getData().items.length>0&&c.Core.StorageUtil.set("notificationSelectedItem",this.subViewModels.notificationList.getData().items[0]);this.set("notificationCountUpdated",c.Core.StorageUtil.get("numberOfNotification")),this.trigger("notificationWidget:dataReady")},_getBannerItem:function(a){for(var b=0;b<a.length;b++)if("U"==a[b].status)return a[b]},updateBannerNotificationViewedStatus:function(){if(null!=c.Core.StorageUtil.get("bannerNotificationItem")){var a=c.Core.StorageUtil.get("bannerNotificationItem");a.viewed=!0,c.Core.StorageUtil.set("bannerNotificationItem",a)}},_clearNotificationStoreInfo:function(){c.Core.StorageUtil.deleteKey("numberOfNotification"),c.Core.StorageUtil.deleteKey("numberOfMotivations")},_onMotivationFetchError:function(a,b){},_onNotificationFetchError:function(a,b){this._mergeNotifications(),this._updateNotificationInfo()},_fetchMotivationAndNotification:function(){a.when(this._fetchMotivationData(),this._fetchNotificationData()).done(this._onNotificationFetchSuccess).fail(this._onNotificationFetchError)},_fetchMotivationData:function(){if(this._beforeMotivationFetch(),this.models.customerPredictionModel.get("customerId"))return this.models.customerPredictionModel.fetch({success:this._onMotivationFetchSuccess})},_fetchNotificationData:function(){if(this._beforeNotificationFetch(),this.models.customerNotificationModel.get("userId"))return this.models.customerNotificationModel.fetch({})},_beforeMotivationFetch:function(){this.models.customerPredictionModel.set({customerId:this.get("customerId")})},_beforeNotificationFetch:function(){this.models.customerNotificationModel.set({userId:this.get("username")})},getNumberOfNotifications:function(){return this.get("numberOfNotification")},getRecentNotification:function(){return this.get("notificationDescription")}})});
define("businesswidget/repository/common/viewmodel/NotificationsSettingsViewModel",["underscore","lightsaber","Configuration","businesswidget/repository/common/model/CommunicationCustomerSelfServiceUserNotificationPreferencesModel","sync!businesswidget/repository/common/viewmodel/UserInformationViewModel"],function (a,b,c,d,e){return b.Core.ViewModel.extend({models:{notificationPreferencesModel:new d},defaults:{customerId:e.getProperty("customerId"),username:e.getProperty("username"),userEmail:void 0,userMdn:void 0,locale:c.get("locale")},initialize:function(b){a.bindAll(this,"getUserNotificationsPreferences","handleNotificationPreferencesSuccesss","handleNotificationPreferencesError","updateNotificationPreferencesSuccess","updateNotificationPreferencesError","_createNotificationsPreferencesListViewModel","getNotificationsChannelVM","handleNotificationsSettingsSelected","processNotificationChannels","getNotificationsChannlesListVM","getUserInfo","setCurrentSelectedItem","getCurrentSelectedItem"),this.options=b,this.rb=this.getConfig("resourceBundle"),this.notificationSubtypeChannelsMap={},this.isList=this.getConfig("isList")},getUserNotificationsPreferences:function(){var b=this.get();if(this.notificationPreferencesReset){var c=this.get("notificationPreferencesResponse");a.isUndefined(c)||(this.notificationSubTypes=this.get("notificationPreferencesResponse").notificationTypes[0].notificationSubTypes,this.trigger("userNotificationsFetchSuccess",this.notificationSubTypes))}else this.notificationPreferencesReset=!1,this.models.notificationPreferencesModel.set({custId:b.customerId,user:b.username}),this.models.notificationPreferencesModel.fetch({success:this.handleNotificationPreferencesSuccesss,error:this.handleNotificationPreferencesError})},handleNotificationPreferencesSuccesss:function(a,b){b.NotificationPreferences&&b.NotificationPreferences.notificationTypes?(this.set("notificationPreferencesResponse",b.NotificationPreferences),this.notificationSubTypes=b.NotificationPreferences.notificationTypes[0].notificationSubTypes,this.isList&&(this._createNotificationsPreferencesListViewModel(),this.processNotificationsPreferencesData()),this.trigger("userNotificationsFetchSuccess",this.notificationSubTypes)):this.trigger("noAvailableNotificationsPreferences")},handleNotificationPreferencesError:function(a,b){this.trigger("userNotificationsFetchError",b)},processNotificationsPreferencesData:function(){if(!a.isUndefined(this.notificationSubTypes))for(var b=0;b<this.notificationSubTypes.length;b++){for(var d=this.notificationSubTypes[b].notificationSubType,e=this.notificationSubTypes[b].notificationChannels,f={id:d,title:this.rb.getString("mcss_notificationsSettings_notificationSubType_"+d),channels:e},g="",h=0;h<e.length;h++){var i=e[h].notificationChannel,j=-1==a.indexOf(c.get("restrictedNotificationChannels"),i);if(j){var k=e[h].implemented;if(k){var l=this.rb.getString("mcss_notificationsSettings_notificationChannel_"+i);g=""==g?this.rb.getString("mcss_notificationsSettings_sendNotifications_by",[l]):g+" , "+l}this.processNotificationChannels(d,e[h])}}""==g&&(g=this.rb.getString("mcss_notificationsSettings_dontSendNotifications")),f.text=g,this.subViewModels.notificationsPreferencesListVM.add(f)}},_createNotificationsPreferencesListViewModel:function(){var a=this.create("mcss_NotificationsSettingsViewModel_notificationsPreferencesCollection_Collection",b.Core.Collection),c=this.create("mcss_NotificationsSettingsViewModel_notificationsPreferencesListVM_CollectionViewModel",b.CollectionViewModel,{models:{items:a}});this.subViewModels.notificationsPreferencesListVM=c,this.subViewModels.notificationsPreferencesListVM.on("items:selected",this.handleNotificationsSettingsSelected,this)},handleNotificationsSettingsSelected:function(a){var b={text:this.rb.getString("mcss_notificationsSettings_notificationSubType_title_"+a.itemId)};this.set("notificationTypeInfo",b),this.trigger("userNotificationPreferencesSelected",a)},processNotificationChannels:function(a,b){var c=null;this.notificationSubtypeChannelsMap[a]?c=this.notificationSubtypeChannelsMap[a]:(c=this.getNotificationsChannlesListVM(),this.notificationSubtypeChannelsMap[a]=c);var d=b.notificationChannel,e=a+"_"+d;c.add({id:d,title:this.rb.getString("mcss_notificationsSettings_notificationChannel_"+d),notificationChannelID:e,notificationChannelObj:b})},getNotificationsChannlesListVM:function(){var a=this.create("mcss_NotificationsSettingsViewModel_notificationsChannelsCollection_Collection",b.Core.Collection);return this.create("mcss_NotificationsSettingsViewModel_notificationsChannelsListVM_CollectionViewModel",b.CollectionViewModel,{models:{items:a},config:{autoUpdate:!1}})},getNotificationsChannelVM:function(a,c,d,e){if(!this.subViewModels[a]){var f=c?"1":"0";if(e){var g=new b.Core.Collection([{name:this.rb.getString("mcss_notificationsSettings_notificationPreferences_flipOff"),value:"0"},{name:this.rb.getString("mcss_notificationsSettings_notificationPreferences_flipOn"),value:"1"}]);this.subViewModels[a]=this.create("mcss_notificationPreferences_"+a+"_FormElementViewModel",b.FormElementViewModel,{data:{fieldValue:f,label:d},models:{options:g},config:{optionsModelName:"options"}})}else{var f=c?"true":"false";this.subViewModels[a]=this.create("mcss_notificationPreferences_"+a+"_FormElementViewModel",b.FormElementViewModel,{data:{fieldValue:f,label:d},config:{enabled:!1}})}}return this.subViewModels[a]},updateNotificationPreferences:function(){this.notificationPreferencesReset=!1;var b=this.get("notificationPreferencesResponse"),c=null,d=null,e=null,f=this.get();if(b){c={},d=[];for(var g=0;g<b.notificationTypes[0].notificationSubTypes.length;g++){var h=b.notificationTypes[0].notificationSubTypes[g].notificationSubType,i=b.notificationTypes[0].notificationSubTypes[g].notificationChannels;e=[];for(var j=0;j<i.length;j++){var k,l=i[j].notificationChannel,m=h+"_"+l;this.subViewModels[m]&&(k=!(!this.subViewModels[m].get("fieldValue")||"true"!=this.subViewModels[m].get("fieldValue")&&"1"!=this.subViewModels[m].get("fieldValue")),i[j].implemented!==k&&e.push(i[j]),i[j].implemented=k)}e.length>0&&d.push({notificationSubType:b.notificationTypes[0].notificationSubTypes[g].notificationSubType,notificationChannels:e})}d.length>0&&(c.notificationTypes=[],c.notificationTypes.push({notificationType:b.notificationTypes[0].notificationType,notificationSubTypes:d})),!a.isUndefined(c.notificationTypes)&&c.notificationTypes.length>0&&!a.isUndefined(c.notificationTypes[0].notificationSubTypes)&&c.notificationTypes[0].notificationSubTypes.length>0&&(this.models.notificationPreferencesModel.set({id:f.username}),this.models.notificationPreferencesModel.set({custId:f.customerId,user:f.username}),this.models.notificationPreferencesModel.save({NotificationPreferences:c},{success:this.updateNotificationPreferencesSuccess,error:this.updateNotificationPreferencesError}))}},updateNotificationPreferencesSuccess:function(a,b){this.trigger("updateNotificationSuccess",b)},updateNotificationPreferencesError:function(a,b){this.trigger("updateNotificationPreferencesError",b)},resetOriginalNotificationPreferences:function(a){var a=a||!1,b=this.get("notificationPreferencesResponse");if(b)for(var c=0;c<b.notificationTypes[0].notificationSubTypes.length;c++)for(var d=b.notificationTypes[0].notificationSubTypes[c].notificationSubType,e=b.notificationTypes[0].notificationSubTypes[c].notificationChannels,f=0;f<e.length;f++){var g,h=e[f].notificationChannel,i=d+"_"+h;if(this.subViewModels[i]){g=e[f].implemented;var j="";j=a?g?"1":"0":g?"true":"false",this.subViewModels[i].set("fieldValue",j)}}this.notificationPreferencesReset=!0},getUserInfo:function(){return e.getProperty("primaryContactDetails"),{email:this.get("userEmail"),mdn:this.get("userMdn")}},setCurrentSelectedItem:function(a){this.selectedItem=a},getCurrentSelectedItem:function(){return this.selectedItem}})});
define("businesswidget/repository/common/viewmodel/UnbilledUsageViewModel",["underscore","lightsaber","Configuration"],function (a,b,c){var d=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"lazyLoadData","_setUnbilledUsageOnSuccess","invokeCustomerUnbilledUsageCall","invokeSubscriberUnbilledUsageCall","_setUnbilledUsageOnError","unbilledUsagesRbaSuccessHandler","unbilledUsagesRbaErrorHandler","_setSubscriberUnbilledUsageOnSuccess","_resolveAccumulatorPromise","_getProductBySubscriptionId")},lazyLoadData:function(a,c){return this.set("subscriptionArr",a),this.set("allCustomerProducts",c),this.unbilleldUsageDeferred=$.Deferred(),new b.Core.RESTModel(null,{url:"RBA/common/usages"}).fetch({success:this.unbilledUsagesRbaSuccessHandler,error:this.unbilledUsagesRbaErrorHandler}),this.unbilleldUsageDeferred.promise()},unbilledUsagesRbaSuccessHandler:function(b,c,d){var e=c.UnbilledUsageAccumulators;if(!a.isUndefined(e)){var f=e.modelID,g=e.modelData.successCallBack;requirejs([f],this[g])}},unbilledUsagesRbaErrorHandler:function(a,b,c){this.unbilleldUsageDeferred.reject()},_getProductBySubscriptionId:function(b){var c=this.get("allCustomerProducts"),d=a.filter(c,function(a){return a.subscriptionId==b});return null!=d&&d.length>0?d[0]:null},invokeCustomerUnbilledUsageCall:function(a){this.models.unbilledUsagesModel=this.create("unBilledUsageViewModel_CustomerUnbilledUsageModel",a);var b={custId:this.get("customerId")};if(this.models.unbilledUsagesModel.set(b),this.get("subscriptionId")){var c=!0,d=this.get("subscriptionId");if(void 0!==this._getProductBySubscriptionId(d).plan&&(c=!1),c)var e={si:this.get("subscriptionId"),ast:"SUBSCRIPTION_AND_SHARED"};else var e={si:this.get("subscriptionId"),ast:"ONLY_SUBSCRIPTION"};this.models.unbilledUsagesModel.setQueryParams(e)}return this.models.unbilledUsagesModel.fetch({success:this._setUnbilledUsageOnSuccess,error:this._setUnbilledUsageOnError})},_setUnbilledUsageOnSuccess:function(a,b,c){this.set("accumulators",b.UnbilledUsageAccumulators),this.unbilleldUsageDeferred.resolve()},_setUnbilledUsageOnError:function(){this.unbilleldUsageDeferred.reject()},invokeSubscriberUnbilledUsageCall:function(a){this.models.unbilledUsagesModel=this.create("unBilledUsageViewModel_SubscriberUnbilledUsageModel",a);var b={custId:this.get("customerId")};if(this.get("subscriptionId"))return b.subsId=this.get("subscriptionId"),this.models.unbilledUsagesModel.set(b),this.models.unbilledUsagesModel.fetch({success:this._setUnbilledUsageOnSuccess,error:this._setUnbilledUsageOnError});var c=this.get("subscriptionArr");this.arrCount=c.length;var d={};for(var e in c)if(c[e]){b.subsId=c[e],this.models.unbilledUsagesModel.set(b);var f=this.models.unbilledUsagesModel.fetch({success:this._setSubscriberUnbilledUsageOnSuccess,error:this._setUnbilledUsageOnError});d=$.when(d,f)}d.done?d.done(this._resolveAccumulatorPromise):this._resolveAccumulatorPromise()},_setSubscriberUnbilledUsageOnSuccess:function(a,c,d){this.subscriberAccumulators||(this.subscriberAccumulatorsCollection=this.create("UnbilledUsageViewModel_Data_Collection",b.Core.Collection.extend({model:b.Core.Model.extend({idAttribute:"id"})})),this.subscriberAccumulators=c.UnbilledUsageAccumulators),this.subscriberAccumulatorsCollection.add(c.UnbilledUsageAccumulators.accumulators)},_resolveAccumulatorPromise:function(){if(this.subscriberAccumulatorsCollection){var a=[];for(var b in this.subscriberAccumulatorsCollection.models)a[b]=this.subscriberAccumulatorsCollection.models[b].attributes;this.subscriberAccumulators.accumulators=a,this.set("accumulators",this.subscriberAccumulators)}else this.set("accumulators",{});this.unbilleldUsageDeferred.resolve()}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/UnbilledUsageViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"UnbilledUsageViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"Configuration",pathName:"Configuration"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"Binds all methods to corrunt context.",isChangeEventTriggered:!1},lazyLoadData:{name:"lazyLoadData",privacyLevel:"public",isEventTriggered:!1,desc:"Calls model to feth unbilled usages.",isChangeEventTriggered:!1},unbilledUsagesRbaSuccessHandler:{name:"unbilledUsagesRbaSuccessHandler",privacyLevel:"public",isEventTriggered:!1,desc:"Success callback for RBA usages model.",isChangeEventTriggered:!1},unbilledUsagesRbaErrorHandler:{name:"unbilledUsagesRbaErrorHandler",privacyLevel:"public",isEventTriggered:!1,desc:"Error callback for RBA usages model.",isChangeEventTriggered:!1},invokeCustomerUnbilledUsageCall:{name:"invokeCustomerUnbilledUsageCall",privacyLevel:"public",isEventTriggered:!1,desc:"Success callback for usages model.",isChangeEventTriggered:!1},_setUnbilledUsageOnSuccess:{name:"_setUnbilledUsageOnSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"Success callback for usages model.",isChangeEventTriggered:!1},_setUnbilledUsageOnError:{name:"_setUnbilledUsageOnError",privacyLevel:"protected",isEventTriggered:!1,desc:"Error callback for usages model.",isChangeEventTriggered:!1},invokeSubscriberUnbilledUsageCall:{name:"invokeSubscriberUnbilledUsageCall",privacyLevel:"public",isEventTriggered:!1,desc:"Success callback for usages model subscriber level.",isChangeEventTriggered:!1},_setSubscriberUnbilledUsageOnSuccess:{name:"_setSubscriberUnbilledUsageOnSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"Success callback for usages model subscriber level.",isChangeEventTriggered:!1},_resolveAccumulatorPromise:{name:"_resolveAccumulatorPromise",privacyLevel:"protected",isEventTriggered:!1,desc:"Resolve promise.",isChangeEventTriggered:!1}},description:""};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/UtilityApplicationDateModel",["underscore","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"utility/appdate"}}),d=c.extend({}),e={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"UtilityApplicationDateModel",path:"businesswidget/repository/common/model/UtilityApplicationDateModel.js",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"utility/appdate"}}},validations:[],methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel",["underscore","lightsaber","Configuration","businesswidget/repository/common/model/UtilityApplicationDateModel"],function (a,b,c,d){var e=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"_initUtilityApplicationDateModel","loadData","_onLogicalDateFetchSuccess","_onLogicalDateFetchError","getDate","isStillValidLogicalDate"),this._initUtilityApplicationDateModel()},_initUtilityApplicationDateModel:function(){this.models.utilityApplicationDateModel=this.create("mcss_utility_utilityApplicationDateModel",d,{})},loadData:function(){if(c.get("getLogicalDate")){var a=b.Core.StorageUtil.getStorage("session").get("cachedLogicalDate");if(a&&this.isStillValidLogicalDate()){var d=$.Deferred();return d.resolve(),this.set("logicalDate",a),this.trigger("logicalDateLoaded",a),d.promise()}return this.models.utilityApplicationDateModel.fetch({success:this._onLogicalDateFetchSuccess,error:this._onLogicalDateFetchError})}return this.utilityApplicationDateDeferred=new $.Deferred,this.set("logicalDate",(new Date).getTime()),this.utilityApplicationDateDeferred.resolve(),this.utilityApplicationDateDeferred.promise()},_onLogicalDateFetchSuccess:function(a,c){b.Core.StorageUtil.getStorage("session").set("cachedLogicalDate",c.Timestamp),b.Core.StorageUtil.getStorage("session").set("lastFetchedLogicalDate",(new Date).getTime()),this.set("logicalDate",c.Timestamp),this.trigger("logicalDateLoaded")},_onLogicalDateFetchError:function(a){},getDate:function(){return this.get("logicalDate")},isStillValidLogicalDate:function(){var a,d=c.get("logicalDateExpiration"),e=b.Core.StorageUtil.get("lastFetchedLogicalDate"),f=(new Date).getTime();if(a=new Date(f),!d||!e)return!1;a.setHours(24,0,0,0);var g=a.getTime()-f;return!(f>=e+d||g<d)}}),f=e.extend({}),g={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"LogicalDateUtilityViewModel",path:"businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"Configuration",pathName:"Configuration"},{variable:"UtilityApplicationDateModel",pathName:"businesswidget/repository/common/model/UtilityApplicationDateModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"It initializes the models",isChangeEventTriggered:!1},_initUtilityApplicationDateModel:{name:"_initUtilityApplicationDateModel",privacyLevel:"protected",isEventTriggered:!1,desc:"It initializes the utility date model.",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"Calls the utility date model to fetch logical date.",isChangeEventTriggered:!1},_onLogicalDateFetchSuccess:{name:"_onLogicalDateFetchSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"Success callback for utility date model.",isChangeEventTriggered:!1},_onLogicalDateFetchError:{name:"_onLogicalDateFetchError",privacyLevel:"protected",isEventTriggered:!1,desc:"Error callback for utility date model.",isChangeEventTriggered:!1},getDate:{name:"getDate",privacyLevel:"public",isEventTriggered:!1,desc:"Returns logical date.",isChangeEventTriggered:!1}}};return f.prototype.getMetaData=function(){return g},f});
define("businesswidget/repository/common/model/Customer91CustomerContactPersonsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"customer/9-1/customer/:customerID/contact-persons",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{payload:["ContactPersonRequest"]}}},defaults:function(){return{ContactPersonRequest:{}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"Customer91CustomerContactPersonsModel",path:"businesswidget/repository/common/model/Customer91CustomerContactPersonsModel.js",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/9-1/customer/:customerID/contact-persons"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}},create:{payload:{value:["ContactPersonRequest"]}}}},validations:[],methods:{defaults:{name:"defaults",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel",["underscore","lightsaber","Configuration","businesswidget/repository/common/model/Customer91CustomerContactPersonsModel"],function (a,b,c,d){var e=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"_initContactPersonsModel","loadData","_setCustomerContactPersonsDataOnSuccess","_setCustomerContactPersonsDataOnError"),this._initContactPersonsModel()},_initContactPersonsModel:function(){this.models.customer91CustomerContactPersonsModel=this.create("mcss_landingpage_customer91CustomerContactPersonsModel_Customer91CustomerContactPersonsModel",d,{})},loadData:function(){var b={involvementType:"SUBSCRIBER"};this.models.customer91CustomerContactPersonsModel.set({customerID:this.get("customerId")});var c={sv:!0};return a.isUndefined(this.get("locale"))||(c.lo=this.get("locale")),a.isUndefined(this.get("salesChannel"))||(c.sc=this.get("salesChannel")),this.models.customer91CustomerContactPersonsModel.setQueryParams(c),this.models.customer91CustomerContactPersonsModel.save({ContactPersonRequest:b},{success:this._setCustomerContactPersonsDataOnSuccess,error:this._setCustomerContactPersonsDataOnError})},_setCustomerContactPersonsDataOnSuccess:function(a,b){void 0!=b.ContactPersons&&void 0!=b.ContactPersons.contactPersons&&(persons=b.ContactPersons.contactPersons,this.set("contactPersons",persons))},_setCustomerContactPersonsDataOnError:function(a){}}),f=e.extend({}),g={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerContactPersonsViewModel",path:"businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"Configuration",pathName:"Configuration"},{variable:"Customer91CustomerContactPersonsModel",pathName:"businesswidget/repository/common/model/Customer91CustomerContactPersonsModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"It initialize the models",isChangeEventTriggered:!1},_initContactPersonsModel:{name:"_initContactPersonsModel",privacyLevel:"protected",isEventTriggered:!1,desc:"It initialize the ContactPersonsModel",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"It calls the model to feth contact data",isChangeEventTriggered:!1},_setCustomerContactPersonsDataOnSuccess:{name:"_setCustomerContactPersonsDataOnSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"Success callback for contacts model.",isChangeEventTriggered:!1},_setCustomerContactPersonsDataOnError:{name:"_setCustomerContactPersonsDataOnError",privacyLevel:"public",isEventTriggered:!1,desc:"Error callback for contacts model.",isChangeEventTriggered:!1}}};return f.prototype.getMetaData=function(){return g},f});
define("businesswidget/repository/common/model/CustomerProductsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"ecommerce/customer/:custId/products",rest:{defaults:{qParams:{locale:c.get("locale"),sc:c.get("salesChannel")}}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductsModel",path:"businesswidget/repository/common/model/CustomerProductsModel.js",
savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"ecommerce/customer/:custId/products"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"locale",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/CustomerProductsViewModelWrapper",["underscore","lightsaber","businesswidget/repository/common/model/CustomerProductsModel"],function (a,b,c){return b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"lazyLoadData","_setCustomerProductsDataOnSuccess","_setCustomerProductsDataOnError","invokeModel","productsRbaErrorHandler","productsRbaSuccessHandler"),this.set("isRestInProgress",!1)},lazyLoadData:function(a,c){return this.def=$.Deferred(),this.get("customerProductsData")&&this.get("isRestInProgress")?(this.def.resolve(),this.trigger("customerProductsDataLoaded",this.get("customerProductsData")),this.def.promise()):(this.set("customerId",a),this.set("personId",c),new b.Core.RESTModel(null,{url:"RBA/common/products"}).fetch({success:this.productsRbaSuccessHandler,error:this.productsRbaErrorHandler}),this.def.promise())},productsRbaSuccessHandler:function(b,c,d){var e=c.customerProducts;if(!a.isUndefined(e)){var f=e.modelID;this.get("isRestInProgress")||(this.set("isRestInProgress",!0),requirejs([f],this.invokeModel))}},productsRbaErrorHandler:function(a,b,c){this.def.reject()},invokeModel:function(b){productsModel=this.create("products_rest_Model",b);var c={custId:this.get("customerId")};return a.isUndefined(this.get("personId"))||(c.personId=this.get("personId")),productsModel.set(c),productsModel.fetch({success:this._setCustomerProductsDataOnSuccess,error:this._setCustomerProductsDataOnError})},_setCustomerProductsDataOnSuccess:function(c,d,e){var f={};if(a.isUndefined(d.Products)||a.isUndefined(d.Products.products))this.trigger("noProducts");else{f=d.Products.products,this.set("customerProductsData",f),b.Core.StorageUtil.getStorage("session").set("cachedCustomerProducts",f);var g="cachedCustomerProducts_"+this.get("customerId");b.Core.StorageUtil.getStorage("session").set(g,f),this.trigger("customerProductsDataLoaded",f)}this.def.resolve()},_setCustomerProductsDataOnError:function(a,b,c){this.def.reject()}})});
define("businesswidget/repository/common/viewmodel/CustomerProductsViewModel",["underscore","lightsaber","single!businesswidget/repository/common/viewmodel/CustomerProductsViewModelWrapper"],function (a,b,c){return b.Core.ViewModel.extend({defaults:{customerId:null,personId:null,customerProductsData:null},initialize:function(b){a.bindAll(this,"lazyLoadData","_setCustomerProductsData")},lazyLoadData:function(d,e){var f=b.Core.StorageUtil.getStorage("session").get("cachedCustomerProducts_"+d);if(f){var g=$.Deferred();return b.Core.StorageUtil.getStorage("session").set("cachedCustomerProducts",f),this.set("customerProductsData",f),this.trigger("customerProductsWidgetDataLoaded",f),g.resolve(),g.promise()}return c.off("customerProductsDataLoaded",null,this),c.on("customerProductsDataLoaded",a.bind(this._setCustomerProductsData,this)),c.off("noProducts",null,this),c.on("noProducts",a.bind(this._setNoProductsData,this)),c.lazyLoadData(d,e)},_setCustomerProductsData:function(a){c.off("customerProductsDataLoaded",null,this),this.set("customerProductsData",a),this.trigger("customerProductsWidgetDataLoaded",a)},_setNoProductsData:function(){c.off("noProducts",null,this),this.trigger("noProductsDataLoaded")}})});
define("businesswidget/repository/common/viewmodel/UnbilledUsageWidgetViewModel",["jquery","underscore","lightsaber","Configuration","businesswidget/repository/common/viewmodel/UnbilledUsageViewModel","businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel","businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel","businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel","businesswidget/repository/common/viewmodel/CustomerProductsViewModel","businesswidget/repository_l9_common/common/utils/ImplUtil","mobiscroll.datetime","single!businesswidget/repository/common/util/BusinessHelper"],function (a,b,c,d,e,f,g,h,i,j,k,l){var m=c.Core.ViewModel.extend({initialize:function(a){this.set("showSubscriptionInfo",!1),b.bindAll(this,"loadData","callAccumulators","callUtilityLogicalDate","callLineOfBusinessDetail","callCustomerProducts","_initializeSubViewModels","_initializeCollectionViewModel","_usageSelectionHandler","_viewAllAccumulatorsActionHandler","_viewMoreDetailsActionHandler","_viewHeaderDataOnChangeActionHandler","_mapData","_getSortedAccumulators","_accumulatorComparator","_compareAccumulator","percentageAttributeComparator","lobAttributeComparator","subscriberIdAttributeComparator","_calculatePercentage","_findProduct","_findLob","_indexOfLob","_findContact","_throwError","_handleViewMode","_setSubscribersData","_resolveAccumulatorPromise","_rejectAccumulatorPromise","_compareAttr","sortProductsExcludingLOB","_createSubscriptionAndLobNode","getAccumulatorsForLobName","getAccumulatorsForLobandSubscription","getSharedAccumulators","getAccumulatorsForEntireAccount","_createAcumulatorsGroup","findSubscription","initializeDataForNavigationView","_findPersonId","onNavigationClick","getAccumulatorName","getProductFromId","isCurrentLevelProductGLP","getSubscriberHeaderText"),this.BACKNAVIGATION={ENTIRE_ACCOUNT:"ENTIRE_ACCOUNT_LEVEL",LOB:"LOB_LEVEL"},this.TREE_NODE_TYPE={VIEW:"view",HTML:"html"},this.VIEW_MODE={HIGHLIGHT:"HighlightsView",DETAILS:"DetailedView"},this.TREE_LEVELS={ENTIRE_ACCOUNT:"ENTIRE_ACCOUNT_LEVEL",LOB:"LOB_LEVEL",LOB_SUBSCRIPTION:"LOB_SUBSCRIPTION_LEVEL",SHARED:"SHARED_LEVEL"},this.TREE_ITEM_TYPE={VOICE_ACCUMULATOR_GRP:"VOICE_ACCUMULATOR_GRP",DATA_ACCUMULATOR_GRP:"DATA_ACCUMULATOR_GRP",MESSAGE_ACCUMULATOR_GRP:"MESSAGE_ACCUMULATOR_GRP",ALLOWANCE_ACCUMULATOR_GRP:"ALLOWANCE_ACCUMULATOR_GRP",RATE_ACCUMULATOR_GRP:"RATE_ACCUMULATOR_GRP",ALLOWANCE_ACCUMULATOR:"ALLOWANCE_ACCUMULATOR",RATE_ACCUMULATOR:"RATE_ACCUMULATOR",LOB:"LOB",SUBSCIPTION:"SUBSCIPTION",SHARED_SUBSCIPTION:"SHARED_SUBSCIPTION",ACCUMULATOR:"ACCUMULATOR",VOICE_ACCUMULATOR_GRP:"VOICE",DATA_ACCUMULATOR_GRP:"DATA",MESSAGE_ACCUMULATOR_GRP:"MESSAGE"},this.LOB_CODE={WS:d.get("lobs").WS},this.ACCUMULATOR_TYPE={RATE:"RATE",ALLOWANCE:"ALLOWANCE"},this.TREE_NODE_STRUCTURE={UNBILLED_USAGE_DETAIL:"UNBILLED_USAGE_DETAIL",LOB_DETAIL:"LOB_DETAIL",SUBSCRIPTION_DETAIL:"SUBSCRIPTION_DETAIL",VOICE_GRP_DETAIL:"VOICE_GRP_DETAIL",MESSAGE_GRP_DETAIL:"MESSAGE_GRP_DETAIL",DATA_GRP_DETAIL:"DATA_GRP_DETAIL",ALLOWANCE_GRP_DETAIL:"ALLOWANCE_GRP_DETAIL",RATE_GRP_DETAIL:"RATE_GRP_DETAIL",ALLOWANCE_DETAIL:"ALLOWANCE_DETAIL",RATE_DETAIL:"RATE_DETAIL",VOICE_ACCUMULATOR_GRP:"VOICE_GRP",DATA_ACCUMULATOR_GRP:"DATA_GRP",MESSAGE_ACCUMULATOR_GRP:"MESSAGE_GRP"},this._initializeCollectionViewModel(),this.set("noUsage",!1)},loadData:function(){this.unbilledUsages.reset(),this.set("nextBillMessage",""),this._initializeSubViewModels(),this.callCustomerProducts(),this.accumulatorPromiceDeferred=a.Deferred(),this.accumulatorPromice=this.accumulatorPromiceDeferred.promise(),this.logicalDatePromice=this.callUtilityLogicalDate(),this.lineOfBusinessDetailPromice=this.callLineOfBusinessDetail(),this.customerContactPersonsPromice=this.callCustomerContactPersons();var b=a.when(this.accumulatorPromice,this.logicalDatePromice,this.lineOfBusinessDetailPromice,this.customerContactPersonsPromice);return b.done(this._mapData),b.fail(this._throwError),b},onNavigationClick:function(){var a=this.get("slectedLevelInfo").clickedObjArr,b=a.pop();b.level===this.TREE_LEVELS.ENTIRE_ACCOUNT?this.setAccountLevelSelectedInfo():b.level===this.TREE_LEVELS.LOB&&this.setLOBLevelSelectedInfo(b.lobCode,null)},getAccumulatorName:function(a){for(var b=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),c=0;c<b.length;c++)if(b[c].code===a)return b[c].name},getProductFromId:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++){var d=b[c];if(d.id===a)return d.formattedServiceID=l.formatPhoneNumber(d.serviceId),d}},callAccumulators:function(){return this.subViewModels.unbilledUsageViewModel.lazyLoadData(this.get("subscriptionArr"),this.subViewModels.customerProductsViewModel.get("customerProductsData"))},callCustomerContactPersons:function(){return this.subViewModels.customerContactPersonsViewModel.loadData()},callUtilityLogicalDate:function(){return this.subViewModels.logicalDateUtilityViewModel.loadData()},callLineOfBusinessDetail:function(){return this.subViewModels.lineOfBusinessDetailViewModel.lazyLoadData()},callCustomerProducts:function(){return this.subViewModels.customerProductsViewModel.on("customerProductsWidgetDataLoaded",b.bind(this._setSubscribersData,this)),this.subViewModels.customerProductsViewModel.on("noProductsDataLoaded",b.bind(this._setNoProductMsg,this)),this.subViewModels.customerProductsViewModel.lazyLoadData(this.get("customerId"),this.get("personId"))},_initializeSubViewModels:function(){this.subViewModels.unbilledUsageViewModel=this.create("mcss_unbilledUssage_UnbilledUsageViewModel",e,{data:{customerId:this.get("customerId"),subscriptionId:this.get("subscriptionId")}}),this.subViewModels.logicalDateUtilityViewModel=this.create("mcss_unbilledUssage_LogicalDateUtilityViewModel",f),this.subViewModels.lineOfBusinessDetailViewModel=this.create("mcss_unbilledUssage_LineOfBusinessDetailViewModel",h),this.subViewModels.customerProductsViewModel=this.create("mcss_unbilledUssage_CustomerProductsViewModel",i,{data:{customerId:this.get("customerId")}}),this.subViewModels.customerContactPersonsViewModel=this.create("mcss_unbilledUssage_CustomerContactPersonsViewModel",g,{data:{customerId:this.get("customerId")}})},_initializeCollectionViewModel:function(){this.unbilledUsages=this.create("smb_OfferDetailsWidgetViewModel_category_Collection",c.Core.Collection.extend({model:c.Core.Model.extend({idAttribute:"uniqueAccumulatorId"})})),this.subViewModels.unbilledUsagesList=this.create("smb_planForReplacementViewModel_mainServicesList_CollectionViewModel",c.CollectionViewModel,{models:{items:this.unbilledUsages},config:{resourceBundle:this.getConfig("resourceBundle")}}),this.subViewModels.unbilledUsagesList.on("items:selected",this._usageSelectionHandler,this),this.unbilledUsagesAllowancesCollection=this.create("cm_UnbilledUsageWidgetViewModel_Allownaces_Collection",c.Core.Collection.extend({model:c.Core.Model.extend({idAttribute:"uniqueAccumulatorId"})})),this.subViewModels.unbilledUsagesAllowancesVM=this.create("cm_UnbilledUsageWidgetViewModel_Allownaces_CollectionViewModel",c.CollectionViewModel,{models:{items:this.unbilledUsagesAllowancesCollection}}),this.subViewModels.unbilledUsagesAllowancesVM.on("items:selected",this._usageSelectionHandler,this),this.unbilledUsagesRatesCollection=this.create("cm_UnbilledUsageWidgetViewModel_Rates_Collection",c.Core.Collection.extend({model:c.Core.Model.extend({idAttribute:"uniqueAccumulatorId"})})),this.subViewModels.unbilledUsagesRatesVM=this.create("cm_UnbilledUsageWidgetViewModel_Rates_CollectionViewModel",c.CollectionViewModel,{models:{items:this.unbilledUsagesRatesCollection}}),this.subViewModels.unbilledUsagesRatesVM.on("items:selected",this._usageSelectionHandler,this)},_usageSelectionHandler:function(a){var b=this.unbilledUsages.get(a.itemId).get();"RATE"===b.type&&b.lobObject.code===d.get("lobs").WS&&(this.set("selectedAccumulator",b),this.trigger("ViewEvent",b))},_viewAllAccumulatorsActionHandler:function(a){this.trigger("action:ViewAllAccumulators",{})},_viewMoreDetailsActionHandler:function(a){this.trigger("action:MoreDetails",a)},_updateLogicalDate:function(b){var c=new Date(b),d=a.scroller.formatDate(this.get("DateFormat"),c);this.set("refreshedDate",d);var e=j.getDateString(c,!1,11);this.set("refreshedTime",e)},_updateNextBillMessage:function(a){"POSTPAID"===this.get("customerType")?this.set("nextBillMessage",this.getString("care_unbilled_usage_widget_next_bill_message",[a.daysToNextBill])):this.set("nextBillMessage","")},_updateShowMoreLinkFlag:function(a){this.set("showMoreLink",void 0);var b=this.get("noOfRates")+this.get("noOfAllowances");a&&b&&a.length>0&&a.length>b&&this.set("showMoreLink",!0)},_updateTotalCharges:function(a){void 0!=a.totalCharges&&this.trigger("showTotalCharges",{totalCharges:a.totalCharges,currency:a.currency})},_updateAccumulatorList:function(a){var c,e=!1;if(a&&a.length>0){var f=[],g=[],h=[];c=a[0].subscriptionId;for(var i=0;i<a.length;i++){var k=a[i],l=b.extend({},k);this.updateAccumulatorData(l),l.usageThreshold=d.get("usageThreshold");var m=this._findProduct(l);if(l.product=m,m){var n=this._findContact(m.personId);l.contact=n,l.address=j.formatAddress(m);var o=this._findLob(m.lob);o&&(l.lobObject=b.extend({},o),l.lobObject.ShowLOBInfo=this.get("ShowLOBInfo"),l.lobObject.smallPicture=j.getImageURL(o.smallPicture))}void 0!==l.subscriptionId&&c!==l.subscriptionId&&(e=!0),l.hideSubscriberDetails=e,f.push(l)}if(e)for(var i=0;i<f.length;i++)f[i].hideSubscriberDetails=!0;var p=this._getSortedAccumulators(f);this.unbilledUsages.add(p)}else this.set("noUsage",!0),this.trigger("noUsage");for(var i=0;p&&i<p.length;i++)"ALLOWANCE"===p[i].type?g.push(p[i]):"RATE"===p[i].type&&h.push(p[i]);this.trigger("showListsHeader"),g&&0==g.length&&this.trigger("noAllowances"),h&&0==h.length&&this.trigger("noRates");var q=g?g.length:0,r=h?h.length:0,s=this.get("noOfAllowances"),t=this.get("noOfRates");q<s&&(t=t+s-q),r<t&&(s=s+t-r),g&&this.unbilledUsagesAllowancesCollection.add(g.slice(0,s)),h&&this.unbilledUsagesRatesCollection.add(h.slice(0,t)),t<r?this.trigger("showFooterMessage","RATE"):this.trigger("lessExtraCharges","RATE"),s<q?this.trigger("showFooterMessage","ALLOWANCE"):this.trigger("lessExtraCharges","ALLOWANCE")},updateAccumulatorData:function(a){void 0!==a.allowanceType&&null!==a.allowanceType||(a.allowanceType="NA"),a.uniqueAccumulatorId=this.generateIDForAccumulators(a.type,a.id,a.subscriptionId)},generateIDForAccumulators:function(a,b,c){return a+"_"+b+"_"+c},_updateCustomerType:function(a){var c,d="",e=this.get("subscriptionId");c=e?b.find(a,function(a){return e==a.subscriptionId&&"POSTPAID"===a.paymentCategory}):b.find(a,function(a){return"POSTPAID"===a.paymentCategory}),d=c?"POSTPAID":"PREPAID",this.set("customerType",d)},_mapData:function(){var a=this.subViewModels.unbilledUsageViewModel.get("accumulators"),b=a.accumulators,c=this.subViewModels.customerProductsViewModel.get("customerProductsData");this._updateLogicalDate(this.subViewModels.logicalDateUtilityViewModel.getDate()),this._updateCustomerType(c),this._updateNextBillMessage(a),this._updateShowMoreLinkFlag(b),this._updateTotalCharges(a),this._updateAccumulatorList(b),1!=this.get("noUsage")&&(this._handleViewMode(),this.get("viewMode")===this.VIEW_MODE.DETAILS&&(this._updateLobAndSubscriptionMap(),this.initializeDataForNavigationView(),this.trigger("unbilledUsageDataInitialized")))},_addSortingInformation:function(a,c){a.personName=c.personName,a.serviceId=c.serviceId,a.formattedPhoneNo=l.formatPhoneNumber(c.serviceId),a.spoName=c.spoName,a.subscriptionId=c.subscriptionId,a.productId=c.id,a.shared?a.planName=c.plan.catalogItemName:b.isUndefined(c.plan)?a.sharedSubscription=!0:a.sharedSubscription=!1,c.lob===d.get("lobs").WS?(a.primaryIdentifier=a.personName,a.secondryIdentifier=a.formattedPhoneNo):c.lob===d.get("lobs").WL?(a.primaryIdentifier=a.formattedPhoneNo,a.formattedAddress=this.formatAddress(c),a.secondryIdentifier=a.formattedAddress):(a.formattedAddress=this.formatAddress(c),a.primaryIdentifier=a.formattedAddress,a.secondryIdentifier="")},getSubscriberHeaderText:function(a){var b,c;if(a.lob===d.get("lobs").WS)b=a.personName,c=l.formatPhoneNumber(a.serviceId);else if(a.lob===d.get("lobs").WL){b=l.formatPhoneNumber(a.serviceId);var e=this.formatAddress(a);c=e}else if(a.lob===d.get("lobs").IN){b=a.plan.displayName;var e=this.formatAddress(a);c=e}else b=a.plan.displayName,c="";return text=void 0!=b&&""!=c?b+" - "+c:void 0===b&&""!=c?c:b,text},formatAddress:function(a){var c=d.get("ADDRESS_DELIMITER");return b.isUndefined(a.address)?"":(a.address.apartmentAndStreet?a.address.apartmentAndStreet+c:"")+(a.address.addressLine2?a.address.addressLine2+c:"")+(a.address.state?a.address.state+" ":"")+(a.address.postCode?a.address.postCode:"")},_updateLobAndSubscriptionMap:function(){for(var a={},b={},c={},d=0;d<this.unbilledUsages.length;d++)if(this.unbilledUsages.models[d].get("product")){var e=this.unbilledUsages.models[d].get("product").subscriptionId,f=this.unbilledUsages.models[d].get("product").shared;f?(void 0===c.shared&&(c.shared=[]),c.shared.push(this.unbilledUsages.models[d])):(void 0===c[e]&&(c[e]=[]),c[e].push(this.unbilledUsages.models[d]))}for(var g=this.subViewModels.customerProductsViewModel.get("customerProductsData"),d=0;d<g.length;d++){var e=(c[g[d].subscriptionId],g[d].subscriptionId),h=g[d].lob,f=g[d].shared;f?(void 0===b[h]&&(b[h]={},b[h].accumulatorDetails=[]),b[h].accumulatorDetails.push(this._createSubscriptionWithAccumulatorNode(g[d],c.shared))):(void 0===a[h]&&(a[h]={},a[h].accumulatorDetails=[]),a[h].accumulatorDetails.push(this._createSubscriptionWithAccumulatorNode(g[d],c[e])))}this.set("accumulatorsMap",a),this.set("sharedAccumulatorsMap",b)},_createSubscriptionWithAccumulatorNode:function(a,b){var c={},d=a.subscriptionId;return c.shared=a.shared,c.subscriptionId=d,c.accumulators=void 0===b?[]:b,this._addSortingInformation(c,a),c},sortProductsExcludingLOB:function(a,b){var c=this,d=void 0===a.personName?"":a.personName.toLowerCase(),e=void 0===b.personName?"":b.personName.toLowerCase(),f=void 0===a.serviceId?"":a.serviceId.toLowerCase(),g=void 0===b.serviceId?"":b.serviceId.toLowerCase(),h=void 0===a.spoName?"":a.spoName.toLowerCase(),i=void 0===b.spoName?"":b.spoName.toLowerCase(),j=c._compareAttr(d,e);if(0!==j)return j;var k=this._compareAttr(f,g);return 0!==k?k:this._compareAttr(h,i)},_compareAttr:function(a,b){return""===a&&""!==b?1:""===b&&""!==a?-1:a.localeCompare(b)},getAccumulatorsForLobName:function(a){this._buildGenericTree(this.TREE_LEVELS.LOB,a)},getAccumulatorsForLobandSubscription:function(a,b){this._buildGenericTree(this.TREE_LEVELS.LOB_SUBSCRIPTION,a,b)},getSharedAccumulators:function(){this._buildGenericTree(this.TREE_LEVELS.SHARED,null,null,!0)},getAccumulatorsForEntireAccount:function(){this._buildGenericTree(this.TREE_LEVELS.ENTIRE_ACCOUNT,null,null,!0)},_buildGenericTree:function(c,e,f,g){for(var h,i,k=[],l=!1,m=this.get("accumulatorsMap"),n=this.get("sharedAccumulatorsMap"),o=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),p=[],q=0,r=0;r<o.length;r++)if(i=b.extend({},o[r]),i.smallPicture=j.getImageURL(o[r].smallPicture),c!=this.TREE_LEVELS.LOB&&c!=this.TREE_LEVELS.LOB_SUBSCRIPTION||o[r].code==e){if(p[q]={},n[o[r].code]&&(h=this._createSubscriptionAndLobNode(n,i,this.TREE_ITEM_TYPE.SHARED_SUBSCIPTION,f,c),a.isEmptyObject(h)||(p[q].subItems=[],p[q].subItems=p[q].subItems.concat(h))),c!=this.TREE_LEVELS.SHARED&&m[o[r].code]&&(h=this._createSubscriptionAndLobNode(m,i,this.TREE_ITEM_TYPE.SUBSCIPTION,f,c),a.isEmptyObject(h)||(void 0===p[q].subItems&&(p[q].subItems=[]),p[q].subItems=p[q].subItems.concat(h))),(n[o[r].code]||m[o[r].code])&&void 0!=p[q].subItems){if(1==p[q].subItems.length){if(p[q].subItems[0].singleSubscription=!0,!0===this.get("showSubscriptionInfo")&&c===this.TREE_LEVELS.LOB_SUBSCRIPTION)var l=!0;!0!==p[q].subItems[0].singleWirelessSubscription&&!0!==l&&(p[q].subItems[0].UIDisplay=!1),p[q].singleSubscription=!0,p[q].noUsageAvailable=p[q].subItems[0].noUsageAvailable}else p[q].singleSubscription=!1,p[q].noUsageAvailable=p[q].subItems[0].noUsageAvailable;k.push(this._addPropertiesToChild(this.TREE_ITEM_TYPE.LOB,this.TREE_NODE_TYPE.VIEW,i,p[q],this.TREE_NODE_STRUCTURE.LOB_DETAIL,!0,c))}q+=1}if(1===p.length&&!0===p[0].singleSubscription){var s=!0;if(p[0].data.code===d.get("lobs").WS)var t=!0;var u=p[0].subItems[0].data.subscriptionId}else var s=!1,t=!1;mainItem={childsCollapsible:!1,type:"text",data:{mandatoryFieldExist:!1},nodeStructure:"UNBILLED_USAGE_DETAIL",singleSubscriptionCurrentLevel:s,singleSubscriptionWireless:t,singleSubscriptionId:u,level:c,subItems:k},this.set("node",mainItem),this.trigger("genericUsageTree:initialized",c)},_createSubscriptionAndLobNode:function(a,b,c,d,e){var f=a[b.code].accumulatorDetails;f.sort(this.sortProductsExcludingLOB);for(var g=this._checkSplicingRequired(f,e,b),h=[],i=0,j=0;j<f.length;j++)if((e!=this.TREE_LEVELS.LOB_SUBSCRIPTION||d==f[j].subscriptionId)&&(this._createSubscriptionNode(h,i,g,f[j],b,c,e),i+=1,e==this.TREE_LEVELS.LOB_SUBSCRIPTION))return h;return h},_createSubscriptionNode:function(a,b,c,e,f,g,h){var i,j=!1;a[b]={subItems:[]};for(var k=[],l=[],m=0;m<e.accumulators.length;m++){var n=e.accumulators[m].attributes;n.type===this.ACCUMULATOR_TYPE.ALLOWANCE?l.push(n):n.type===this.ACCUMULATOR_TYPE.RATE&&k.push(n)}l.sort(this._accumulatorComparator),k.sort(this._accumulatorComparator),1==c&&(i=this._sliceAccumulatorArray(l,k),l=i.allowances,k=i.rates),!1===c&&f.code===d.get("lobs").WS&&1!=e.shared&&(j=!0),a[b]=this._createLobAccumulatorNode(l,k,j,e,f,i),this._addPropertiesToChild(g,this.TREE_NODE_TYPE.VIEW,e,a[b],this.TREE_NODE_STRUCTURE.SUBSCRIPTION_DETAIL,!0,h),a[b].data.lob=f,b+=1},_createLobAccumulatorNode:function(b,c,d,e,f,g){var h={};if(1==d){for(var i={subItems:[]},j={subItems:[]},k={subItems:[]},l=[],m=[],n=[],o=[],p=[],q=[],r=0;r<b.length;r++)accumulator=b[r],"VOICE"==accumulator.usageType?l.push(accumulator):"MESSAGE"==accumulator.usageType?p.push(accumulator):"DATA"==accumulator.usageType&&n.push(accumulator);for(var r=0;r<c.length;r++)accumulator=c[r],"VOICE"==accumulator.usageType?m.push(accumulator):"MESSAGE"==accumulator.usageType?q.push(accumulator):"DATA"==accumulator.usageType&&o.push(accumulator);this._addPropertiesToChild(this.TREE_ITEM_TYPE.VOICE_ACCUMULATOR_GRP,this.TREE_NODE_TYPE.HTML,{usageTypeText:this.getString("care_unbilled_usage_detail_widget_usage_voice"),moreItemsText:this.getString("care_unbilled_usage_detail_widget_usage_more-items",[this.getString("care_unbilled_usage_detail_widget_usage_voice")]),lob:f,subscription:e,usageType:"VOICE"},i,this.TREE_NODE_STRUCTURE.VOICE_ACCUMULATOR_GRP,!0),this._addPropertiesToChild(this.TREE_ITEM_TYPE.DATA_ACCUMULATOR_GRP,this.TREE_NODE_TYPE.HTML,{usageTypeText:this.getString("care_unbilled_usage_detail_widget_usage_data"),moreItemsText:this.getString("care_unbilled_usage_detail_widget_usage_more-items",[this.getString("care_unbilled_usage_detail_widget_usage_data")]),lob:f,subscription:e,usageType:"DATA"},j,this.TREE_NODE_STRUCTURE.DATA_ACCUMULATOR_GRP,!0),this._addPropertiesToChild(this.TREE_ITEM_TYPE.MESSAGE_ACCUMULATOR_GRP,this.TREE_NODE_TYPE.HTML,{usageTypeText:this.getString("care_unbilled_usage_detail_widget_usage_message"),moreItemsText:this.getString("care_unbilled_usage_detail_widget_usage_more-items",[this.getString("care_unbilled_usage_detail_widget_usage_message")]),lob:f,subscription:e,usageType:"MESSAGE"},k,this.TREE_NODE_STRUCTURE.MESSAGE_ACCUMULATOR_GRP,!0);var s=!1,t=!1,u=!1;if(!0===e.sharedSubscription){var v=this.get("sharedAccumulatorsMap");if(v[f.code])for(var w,x=v[f.code].accumulatorDetails[0],y=x.accumulators,z=[],A=[],B=[],C=0;C<y.length;C++)w=y[C].attributes,"VOICE"==w.usageType?(z.push(w),s=!0):"MESSAGE"==w.usageType?(B.push(w),u=!0):"DATA"==w.usageType&&(A.push(w),t=!0)}this._createAcumulatorsGroup(i,l,m,e,null,f,s,z),this._createAcumulatorsGroup(j,n,o,e,null,f,t,A),this._createAcumulatorsGroup(k,p,q,e,null,f,u,B),h.subItems=[],a.isEmptyObject(i.subItems)||h.subItems.push(i),a.isEmptyObject(k.subItems)||h.subItems.push(k),a.isEmptyObject(j.subItems)||h.subItems.push(j)}else this._createAcumulatorsGroup(h,b,c,e,g,f);return h.singleSubscription=!1,h.UIDisplay=!0,h.singleWirelessSubscription=d,void 0===h.subItems||0===h.subItems.length?h.noUsageAvailable=!0:h.noUsageAvailable=!1,h},_getAccumulatorGroupName:function(a,b){return!0===a?this._getAccumulatorGroupNameText(a,b.data.subscription.formattedPhoneNo):this._getAccumulatorGroupNameText(a,null)},_getAccumulatorGroupNameText:function(a,b){return!0===a?this.getString("care_unbilled_usage_detail_widget_allowance_grp_name_shared_Subscription")+b:this.getString("care_unbilled_usage_detail_widget_allowance_grp_name")},_createAcumulatorsGroup:function(a,c,d,e,f,g,h,i){var j,k,l=0;this.get("accumulatorsMap")[g.code]&&(l=this.get("accumulatorsMap")[g.code].accumulatorDetails.length),this.get("sharedAccumulatorsMap")[g.code]&&(l+=this.get("sharedAccumulatorsMap")[g.code].accumulatorDetails.length);var m={noUsageAvailable:!0},n=this._getAccumulatorGroupName(h,a);this._addPropertiesToChild(this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR_GRP,this.TREE_NODE_TYPE.HTML,{grpType:this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR_GRP,grpName:n},m,this.TREE_NODE_STRUCTURE.ALLOWANCE_GRP_DETAIL,!0);var o={noUsageAvailable:!0};if(this._addPropertiesToChild(this.TREE_ITEM_TYPE.RATE_ACCUMULATOR_GRP,this.TREE_NODE_TYPE.HTML,{grpType:this.TREE_ITEM_TYPE.RATE_ACCUMULATOR_GRP,grpName:this.getString("care_unbilled_usage_detail_widget_rate_grp_name")},o,this.TREE_NODE_STRUCTURE.RATE_GRP_DETAIL,!0),this.addAdditionalInfoToAccumulators(m,g,e),this.addAdditionalInfoToAccumulators(o,g,e),!0===h){var p={noUsageAvailable:!0};if(this._addPropertiesToChild(this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR_GRP,this.TREE_NODE_TYPE.HTML,{grpType:this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR_GRP,grpName:this.getString("care_unbilled_usage_detail_widget_shared_allowances_title")},p,this.TREE_NODE_STRUCTURE.ALLOWANCE_GRP_DETAIL,!0),this.addAdditionalInfoToAccumulators(p,g,e),p.data.isSharedAllowanceGrp=!0,0!=i.length){for(p.noUsageAvailable=!1,p.data.singleSubscription=1===l,j=[],counter=0;counter<i.length;counter++)j[counter]={},this._addPropertiesToChild(this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR,this.TREE_NODE_TYPE.VIEW,i[counter],j[counter],this.TREE_NODE_STRUCTURE.ALLOWANCE_DETAIL,!0);p.subItems=j,p.data.moreItems=null!=f&&f.moreAllowance}}if(0!=c.length){for(m.noUsageAvailable=!1,m.data.singleSubscription=1===l,j=[],counter=0;counter<c.length;counter++)j[counter]={},this._addPropertiesToChild(this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR,this.TREE_NODE_TYPE.VIEW,c[counter],j[counter],this.TREE_NODE_STRUCTURE.ALLOWANCE_DETAIL,!0);m.subItems=j,m.data.moreItems=null!=f&&f.moreAllowance}if(0!=d.length){o.noUsageAvailable=!1;var l=0;for(this.get("accumulatorsMap")[g.code]&&(l=this.get("accumulatorsMap")[g.code].accumulatorDetails.length),this.get("sharedAccumulatorsMap")[g.code]&&(l+=this.get("sharedAccumulatorsMap")[g.code].accumulatorDetails.length),o.data.singleSubscription=1===l,k=[],counter=0;counter<d.length;counter++)k[counter]={},this._addPropertiesToChild(this.TREE_ITEM_TYPE.RATE_ACCUMULATOR,this.TREE_NODE_TYPE.VIEW,d[counter],k[counter],this.TREE_NODE_STRUCTURE.RATE_DETAIL,!0);o.data.moreItems=void 0!=f&&f.moreRate,o.subItems=k}a.subItems=[],(!1===m.noUsageAvailable||!1===o.noUsageAvailable||!b.isUndefined(p)&&!1===p.noUsageAvailable)&&(this.get("ratesBeforeAllowances")?(b.isUndefined(o)||a.subItems.push(o),b.isUndefined(p)||!1!==p.noUsageAvailable||a.subItems.push(p),b.isUndefined(m)||!1!==m.noUsageAvailable||a.subItems.push(m)):(b.isUndefined(p)||!1!==p.noUsageAvailable||a.subItems.push(p),b.isUndefined(m)||!1!==m.noUsageAvailable||a.subItems.push(m),b.isUndefined(o)||a.subItems.push(o))),b.isUndefined(a.data)&&(a.data={}),!1===o.noUsageAvailable?a.data.rateAccumulatorsAvailable=!0:a.data.rateAccumulatorsAvailable=!1},_checkSplicingRequired:function(b,c,d){var e=0;if(c==this.TREE_LEVELS.ENTIRE_ACCOUNT){if(!a.isEmptyObject(this.get("sharedAccumulatorsMap")))return!0;for(var f=this.get("accumulatorsMap"),g=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),h=0;h<g.length;h++)f.hasOwnProperty(g[h].code)&&(e+=1);return"1"!=e||"1"!=b.length}return c==this.TREE_LEVELS.LOB&&(!a.isEmptyObject(this.get("sharedAccumulatorsMap"))&&d.code===this.LOB_CODE.WS||"1"!=b.length)},initializeDataForNavigationView:function(){if(!this.get("slectedLevelInfo"))if(this.get("subscriptionId")){var a=this.findProductFromSubscriptionId(this.get("subscriptionId"));this.setSelectedLevelInfo(this.TREE_LEVELS.LOB_SUBSCRIPTION,a.lob,a.id)}else{for(var b={},c=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),d=this.get("accumulatorsMap"),e=this.get("sharedAccumulatorsMap"),f=0;f<c.length;f++)d.hasOwnProperty(c[f].code)&&(b[c[f].code]={},b[c[f].code].subsArr=[],b[c[f].code].subsArr=b[c[f].code].subsArr.concat(d[c[f].code].accumulatorDetails)),e.hasOwnProperty(c[f].code)&&(b[c[f].code]?b[c[f].code].subsArr=b[c[f].code].subsArr.concat(e[c[f].code].accumulatorDetails):(b[c[f].code]={},b[c[f].code].subsArr=[],b[c[f].code].subsArr=b[c[f].code].subsArr.concat(e[c[f].code].accumulatorDetails)));var g,h,i,j=0;for(var k in b)b.hasOwnProperty(k)&&(j+=1,g=k);1===j?(h=b[g].subsArr.length,1===h?(this.setSelectedLevelInfo(this.TREE_LEVELS.LOB_SUBSCRIPTION,g,b[g].subsArr[0].productId),i=this.TREE_LEVELS.LOB_SUBSCRIPTION):(this.setSelectedLevelInfo(this.TREE_LEVELS.LOB,g,null),i=this.TREE_LEVELS.LOB)):i=this.TREE_LEVELS.ENTIRE_ACCOUNT,this.set("customerProductMetaData",{lobCount:j,singleLobCode:g,singleLobSubscriptionCount:h,level:i})}},_sliceAccumulatorArray:function(a,b){var c={};c.moreAllowance=!1,c.moreRate=!1;var d=(a&&a.length,b&&b.length,this.get("noOfAllowances")),e=this.get("noOfRates");return d<a.length&&(c.moreAllowance=!0),e<b.length&&(c.moreRate=!0),a&&(a=a.slice(0,d)),b&&(b=b.slice(0,e)),c.allowances=a,c.rates=b,c},_addPropertiesToChild:function(a,c,d,e,f,g,h){return void 0===e.data&&(e.data={}),e.itemType=a,e.UIDisplay=g,e.nodeStructure=f,e.data=b.extend({},e.data,d),e.type=c,e.currentLevel=h,e},_getSortedAccumulators:function(a){return a.sort(this._accumulatorComparator)},_accumulatorComparator:function(a,b){var c;if("ALLOWANCE"==a.type){if("RATE"==b.type)return this.get("ratesBeforeAllowances")?1:-1;for(var d=this.get("AllowanceSort"),e=0;e<d.length;e++){var f=d[e];if(0!=(c=this._compareAccumulator(a,b,f)))break}return c}if("ALLOWANCE"==b.type)return this.get("ratesBeforeAllowances")?-1:1;for(var d=this.get("RateSort"),e=0;e<d.length;e++){var f=d[e];if(0!==(c=this._compareAccumulator(a,b,f)))break}return c},_compareAccumulator:function(a,b,c){var d;switch(c){case"PERCENTAGE":d=this.percentageAttributeComparator(a,b,c);break;case"LOB":d=this.lobAttributeComparator(a,b,c);break;case"SUBSCRIPTION_ID":d=this.subscriberIdAttributeComparator(a,b,c);break;default:d=this.customAttributeComparator(a,b,c)}return d},percentageAttributeComparator:function(a,b,c){return this._calculatePercentage(b)-this._calculatePercentage(a)},lobAttributeComparator:function(a,b,c){return void 0==a.lobObject&&void 0!=b.lobObject?1:void 0!=a.lobObject&&void 0==b.lobObject?-1:void 0!=a.lobObject&&void 0!=b.lobObject?this._indexOfLob(a.lobObject.code)-this._indexOfLob(b.lobObject.code):0},subscriberIdAttributeComparator:function(a,b,c){return void 0==a.subscriptionId&&void 0!=b.subscriptionId?-1:void 0!=a.subscriptionId&&void 0==b.subscriptionId?1:void 0!=a.subscriptionId&&void 0!=b.subscriptionId?parseInt(a.subscriptionId)-parseInt(b.subscriptionId):0},customAttributeComparator:function(a,b,c){return 0},_calculatePercentage:function(a){return"ALLOWANCE"==a.type?"UNLIMITED"==a.allowanceType?-1:a.utilizedQuotaPercentage:a.amount},_findProduct:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++){var d=b[c];if(void 0!=d.subscriptionId&&d.subscriptionId==a.subscriptionId||void 0==d.subscriptionId&&d.shared)return d;
}},_findPersonId:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++){var d=b[c];if(void 0!=d.subscriptionId&&d.subscriptionId==a)return d.personId}},_findLob:function(a){for(var b=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),c=0;c<b.length;c++){var d=b[c];if(d.code==a)return d}},_indexOfLob:function(a){for(var b=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),c=0;c<b.length;c++)if(b[c].code==a)return c;return-1},_findContact:function(a){for(var b=this.subViewModels.customerContactPersonsViewModel.get("contactPersons"),c=0;c<b.length;c++){var d=b[c];if(d.personID==a)return d}},_throwError:function(a){this.trigger("error",a)},_handleViewMode:function(){console.log(this.get("viewMode"))},setSelectedLevelInfo:function(a,c,d,e){if(this.get("slectedLevelInfo")&&this.get("slectedLevelInfo").clickedObjArr)var f=this.get("slectedLevelInfo").clickedObjArr;else var f=[];if(!b.isUndefined(e)&&!b.isNull(e)){var g={level:e.level,lobCode:e.lobCode,productId:e.productId,clickedObjArr:e.clickedObjArr?e.clickedObjArr.slice(0):void 0,lobName:e.lobName,headerData:e.headerData};f.push(g)}var h,i=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData");for(var j in i)i[j].code===c&&(h=i[j].name);this.set("slectedLevelInfo",{level:a,lobCode:c,productId:d,clickedObjArr:f,lobName:h})},setAccountLevelSelectedInfo:function(){this.setSelectedLevelInfo(this.TREE_LEVELS.ENTIRE_ACCOUNT,null,null),this.trigger("action:accountSelected")},setLOBLevelSelectedInfo:function(a,b){this.setSelectedLevelInfo(this.TREE_LEVELS.LOB,a,null,b),this.trigger("action:lobSelected")},setSubscriptionLevelSelectedInfo:function(a,b,c){var d=this.findProduct(b);this.setSelectedLevelInfo(this.TREE_LEVELS.LOB_SUBSCRIPTION,a,d,c),this.postSubscriptionLevelSelectedInfo(a,b,c,d),this.trigger("action:subscriptionSelected")},postSubscriptionLevelSelectedInfo:function(a,b,c,d){},_setSubscribersData:function(){this.subViewModels.customerProductsViewModel.off("customerProductsWidgetDataLoaded",null,this);var a=[],b=this.subViewModels.customerProductsViewModel.get("customerProductsData");for(var c in b)b[c].subscriptionId&&(a[c]=b[c].subscriptionId);this.set("subscriptionArr",a);var d=this.callAccumulators();d.done(this._resolveAccumulatorPromise),d.fail(this._rejectAccumulatorPromise)},_setNoProductMsg:function(){this.trigger("noProductData")},_resolveAccumulatorPromise:function(){this.accumulatorPromiceDeferred.resolve()},_rejectAccumulatorPromise:function(){this.accumulatorPromiceDeferred.reject()},findSubscription:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++)if(b[c].id===a)return b[c].subscriptionId;return null},findProduct:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++)if(b[c].subscriptionId===a)return b[c].id;return null},findProductFromProductId:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++)if(b[c].id===a)return b[c];return null},isCurrentLevelProductGLP:function(){if(this.get("slectedLevelInfo")){var a=this.get("slectedLevelInfo").productId;if(a)return this.findProductFromProductId(a).shared}},findProductFromSubscriptionId:function(a){var b=this.subViewModels.customerProductsViewModel.get("customerProductsData");if(a===l.subscriptionTypes.GLP){for(var c=0;c<b.length;c++)if(!0===b[c].shared)return b[c];return null}for(var c=0;c<b.length;c++)if(b[c].subscriptionId==a)return b[c];return null},addAdditionalInfoToAccumulators:function(a,c,d){void 0===a.data&&(a.data={});var e={};e.subscription={},e.lob={},e.lob.lobCode=c.code,e.lob.lobName=c.name,e.subscription.serviceId=d.serviceId,e.subscription.productId=d.productId,e.subscription.personName=d.personName,e.subscription.formattedPhoneNo=d.formattedPhoneNo,e.subscription.subscriptionId=d.subscriptionId,e.subscription.shared=d.shared,void 0!=d.primaryIdentifier&&void 0!=d.secondryIdentifier&&""!=d.secondryIdentifier?e.subscription.moreItemsText=d.primaryIdentifier+" - "+d.secondryIdentifier:void 0==d.primaryIdentifier||void 0!==d.secondryIdentifier&&""!==d.secondryIdentifier?void 0===d.primaryIdentifier&&void 0!=d.secondryIdentifier&&""!=d.secondryIdentifier?e.subscription.moreItemsText=d.secondryIdentifier:e.subscription.moreItemsText=d.formattedAddress:e.subscription.moreItemsText=d.primaryIdentifier,a.data=b.extend({},a.data,e);var f=0;this.get("accumulatorsMap")[c.code]&&(f=this.get("accumulatorsMap")[c.code].accumulatorDetails.length),this.get("sharedAccumulatorsMap")[c.code]&&(f+=this.get("sharedAccumulatorsMap")[c.code].accumulatorDetails.length),a.data.singleSubscription=1===f,this.setMoreItemsText(a)},setMoreItemsText:function(a){a.data.grpType===this.TREE_ITEM_TYPE.ALLOWANCE_ACCUMULATOR_GRP?!0===a.data.singleSubscription?(a.data.moreItemsText=this.getString("care_unbilled_usage_detail_widget_more_allowances",[a.data.lob.lobName]),a.data.moreItemsLevel=this.TREE_LEVELS.LOB):!0===a.data.subscription.shared?(a.data.moreItemsText=this.getString("care_unbilled_usage_detail_widget_more_allowances",[this.getString("care_unbilled_usage_detail_widget_shared_plan_small")]),a.data.moreItemsLevel=this.TREE_LEVELS.LOB_SUBSCRIPTION):(a.data.moreItemsText=this.getString("care_unbilled_usage_detail_widget_more_allowances",[a.data.subscription.moreItemsText]),a.data.moreItemsLevel=this.TREE_LEVELS.LOB_SUBSCRIPTION):a.data.grpType===this.TREE_ITEM_TYPE.RATE_ACCUMULATOR_GRP&&(!0===a.data.singleSubscription?(a.data.moreItemsText=this.getString("care_unbilled_usage_detail_widget_more_rates",[a.data.lob.lobName]),a.data.moreItemsLevel=this.TREE_LEVELS.LOB):!0===a.data.subscription.shared?(a.data.moreItemsText=this.getString("care_unbilled_usage_detail_widget_more_rates",[this.getString("care_unbilled_usage_detail_widget_shared_plan_small")]),a.data.moreItemsLevel=this.TREE_LEVELS.LOB_SUBSCRIPTION):(a.data.moreItemsText=this.getString("care_unbilled_usage_detail_widget_more_rates",[a.data.subscription.moreItemsText]),a.data.moreItemsLevel=this.TREE_LEVELS.LOB_SUBSCRIPTION))},navigateToUnbilledUsageEvents:function(a){this.set("subscriptionId",a.SubscriptionID),this.set("UsageType",a.usageType),this.set("AccumulatorID",a.AccumulatorID),this.trigger("action:ViewEvent",{subscriptionId:a.SubscriptionID,UsageType:a.usageType,AccumulatorID:a.AccumulatorID})},isSingleSubscription:function(){for(var a=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0,d=0;d<a.length&&(!b.isUndefined(a[d].equipmentName)&&null!==a[d].equipmentName||!(++c>1));d++);return 1===c},_viewHeaderDataOnChangeActionHandler:function(a){this.set("widgetID",a.widgetID),this.set("pageTitle",a.pageTitle),this.set("backLabel",a.backLabel),this.set("hideRightButton",a.hideRightButton),this.set("footerLogicalName",a.footerLogicalName);var b={widgetID:a.widgetID,pageTitle:a.pageTitle,backLabel:a.backLabel,hideRightButton:a.hideRightButton,footerLogicalName:a.footerLogicalName};this.get("slectedLevelInfo")&&(this.get("slectedLevelInfo").headerData=b),this.trigger("action:HeaderDataOnChangeView",b)},getSupportedLOBListForUsageEvents:function(){return d.get("supportedLOBListForUsageEvents")},isShowEventsSupported:function(a){var b=this.getSupportedLOBListForUsageEvents();return!b||-1!==b.indexOf(a)}}),n=m.extend({}),o={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"UnbilledUsageWidgetViewModel",path:"businesswidget/repository/common/viewmodel/UnbilledUsageWidgetViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"$",pathName:"jquery"},{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"Configuration",pathName:"Configuration"},{variable:"UnbilledUsageViewModel",pathName:"businesswidget/repository/common/viewmodel/UnbilledUsageViewModel"},{variable:"LogicalDateUtilityViewModel",pathName:"businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel"},{variable:"CustomerContactPersonsViewModel",pathName:"businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel"},{variable:"CustomerProductsViewModel",pathName:"businesswidget/repository/common/viewmodel/CustomerProductsViewModel"},{variable:"CustomerContactPersonsViewModel",pathName:"businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel"},{variable:"Util",pathName:"businesswidget/repository/common/util/Util"},{variable:"mobiscroll",pathName:"mobiscroll.datetime"}],models:null,viewModels:null,dataBindings:null,defaults:{locale:{key:"locale",value:"Configuration.get('defaultLocale')"},salesChannel:{key:"salesChannel",value:"Configuration.get('salesChannel')"}},methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"Initializes the unbilled usage collection",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"Fetch data from all RESTs and return final promice",isChangeEventTriggered:!1},callAccumulators:{name:"callAccumulators",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},callCustomerContactPersons:{name:"callCustomerContactPersons",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},callUtilityLogicalDate:{name:"callUtilityLogicalDate",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},callLineOfBusinessDetail:{name:"callLineOfBusinessDetail",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},callCustomerProducts:{name:"callCustomerProducts",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_initializeSubViewModels:{name:"_initializeSubViewModels",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_initializeCollectionViewModel:{name:"_initializeCollectionViewModel",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_usageSelectionHandler:{name:"_usageSelectionHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_viewAllAccumulatorsActionHandler:{name:"_viewAllAccumulatorsActionHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_viewMoreDetailsActionHandler:{name:"_viewMoreDetailsActionHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_updateLogicalDate:{name:"_updateLogicalDate",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_updateNextBillMessage:{name:"_updateNextBillMessage",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_updateShowMoreLinkFlag:{name:"_updateShowMoreLinkFlag",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_updateTotalCharges:{name:"_updateTotalCharges",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_updateAccumulatorList:{name:"_updateAccumulatorList",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_updateCustomerType:{name:"_updateCustomerType",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_mapData:{name:"_mapData",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_getSortedAccumulators:{name:"_getSortedAccumulators",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_accumulatorComparator:{name:"_accumulatorComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_compareAccumulator:{name:"_compareAccumulator",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},percentageAttributeComparator:{name:"percentageAttributeComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},lobAttributeComparator:{name:"lobAttributeComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},subscriberIdAttributeComparator:{name:"subscriberIdAttributeComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},customAttributeComparator:{name:"customAttributeComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_calculatePercentage:{name:"_calculatePercentage",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_findProduct:{name:"_findProduct",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_findLob:{name:"_findLob",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_indexOfLob:{name:"_indexOfLob",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_findContact:{name:"_findContact",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_throwError:{name:"_throwError",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_handleViewMode:{name:"_handleViewMode",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setSubscribersData:{name:"_setSubscribersData",privacyLevel:"protected",isEventTriggered:!1,desc:"Set the subscriber IDs from customer products.",isChangeEventTriggered:!1},_resolveAccumulatorPromise:{name:"_resolveAccumulatorPromise",privacyLevel:"protected",isEventTriggered:!1,desc:"Resolve promise.",isChangeEventTriggered:!1},_rejectAccumulatorPromise:{name:"_rejectAccumulatorPromise",privacyLevel:"protected",isEventTriggered:!1,desc:"Reject promise.",isChangeEventTriggered:!1}}};return n.prototype.getMetaData=function(){return o},n});
define("businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel",["underscore","lightsaber"],function (a,b){var c=b.Core.ViewModel.extend({defaults:{IndividualInContext:{ID:void 0,anonymous:void 0,familyName:void 0,givenName:void 0,middleName:void 0,salutation:void 0,phone:void 0,analyticsIndicator:void 0,individualScore:void 0},CustomerInContext:{ID:void 0,alias:void 0,mediaID:void 0,mktCode:void 0},CurrentOrganizationInContext:{ID:void 0,name:void 0},DefaultOrganizationInContext:{ID:void 0,name:void 0},CustomerBillSpecInContext:{ID:void 0,name:void 0},CustomerAccountInContext:{ID:void 0,name:void 0},SubscriptionInContext:{ID:void 0,reference:void 0},BillingDetailsInContext:{lastBillAmount:void 0,currency:void 0,totalDue:void 0,billDueDate:void 0,customerAccountID:void 0,customerBillSpecID:void 0},GoodwillAdjustments:{total:void 0,details:void 0}}}),d=c.extend({}),e={path:"businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerTopicsDefinitionViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{IndividualInContext:{key:"IndividualInContext",value:"{\n\t\t\t\t\t\t'ID': undefined,\n\t\t\t\t\t\t'anonymous': undefined,\n\t\t\t\t\t\t'familyName': undefined,\n\t\t\t\t\t\t'givenName': undefined,\n\t\t\t\t\t\t'middleName': undefined,\n\t\t\t\t\t\t'salutation': undefined,\n\t\t\t\t\t\t'phone': undefined,\n\t\t\t\t\t\t'analyticsIndicator': undefined,\n\t\t\t\t\t\t'individualScore': undefined\n\t\t\t}"},CustomerInContext:{key:"CustomerInContext",value:"{\n    'ID': undefined,\n    'alias': undefined,\n    'mediaID': undefined,\n    'mktCode':undefined\n}"},CurrentOrganizationInContext:{key:"CurrentOrganizationInContext",value:"{\n\t\t\t\t\t'ID': undefined,\n\t\t\t\t\t'name': undefined\n\t\t\t}"},DefaultOrganizationInContext:{key:"DefaultOrganizationInContext",value:"{\n\t\t\t\t\t'ID': undefined,\n\t\t\t\t\t'name': undefined\n\t\t\t}"},CustomerBillSpecInContext:{key:"CustomerBillSpecInContext",value:"{\n\t\t\t\t\t'ID': undefined,\n\t\t\t\t\t'name': undefined\n\t\t\t}"},CustomerAccountInContext:{key:"CustomerAccountInContext",value:" {\n\t\t\t\t\t'ID': undefined,\n\t\t\t\t\t'name': undefined\n\t\t\t}"},SubscriptionInContext:{key:"SubscriptionInContext",value:"{\n\t\t\t\t\t'ID': undefined,\n\t\t\t\t\t'reference': undefined\n\t\t\t}\t"},BillingDetailsInContext:{key:"BillingDetailsInContext",value:"{\n    'lastBillAmount': undefined,\n    'currency': undefined,\n    'totalDue': undefined,\n    'billDueDate': undefined,\n    'customerAccountID': undefined,\n    'customerBillSpecID': undefined\n}"},GoodwillAdjustments:{key:"GoodwillAdjustments",value:"{\n    'total': undefined,\n    'details': undefined\n}"}},methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel",["underscore","lightsaber","single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel"],function (a,b,c){var d=b.Core.ObservableViewModel.extend({persistent:["ID","isAuthenticated","allowedSubscriptions","readyForCart"],defaults:{customerId:null,ID:null,isAuthenticated:!1,readyForCart:null,allowedSubscriptions:0},subViewModels:{customerTopicsDefinitionViewModel:c},dataBindings:[{ID:"subViewModels.customerTopicsDefinitionViewModel.CustomerInContext.ID",options:{twoWay:!0,setOnBind:!0}},{customerId:"subViewModels.customerTopicsDefinitionViewModel.CustomerInContext.ID",options:{twoWay:!0,setOnBind:!0}}]}),e=d.extend({}),f={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerInContextTopicViewModel",path:"businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{customerId:{key:"customerId",value:"null"}},methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/IndividualDetailsViewModel",["lightsaber"],function (a){return a.Core.ViewModel.extend({defaults:{IndividualDetails:{ID:null,firstName:null,middleName:null,lastName:null,phone:null,dateOfBirth:null,fax:null,email:null,preferredContactMethod:null,preferredLanguage:null,preferredContactName:null}},config:{actions:{create:function(a){this.create.apply(this,arguments)}}},initialize:function(a){this._super(a),_.bindAll(this,"create")},create:function(a){this.trigger("action:create",a)}}).extend({})});
define("businesswidget/repository/common/viewmodel/CustomerDetailsViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["ID","customerAccountId","customerAddressId","customerBillSpecId","individualId","name","individual","primaryAddress","billingAddress"],defaults:{individual:null,primaryAddress:null,billingAddress:null,customerAccountId:null,customerAddressId:null,customerBillSpecId:null,individualId:null,name:null,ID:null}})});
define("businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel",["underscore","lightsaber","single!businesswidget/repository/common/viewmodel/IndividualDetailsViewModel","single!businesswidget/repository/common/viewmodel/CustomerDetailsViewModel"],function (a,b,c,d){var e=b.Core.ObservableViewModel.extend({persistent:["personId","ID"],defaults:{personId:null,ID:null},subViewModels:{customerDetailsTopicViewModel:d},dataBindings:[{personId:"subViewModels.customerDetailsTopicViewModel.individualId",options:{twoWay:!1,setOnBind:!0}},{ID:"this.personId",options:{twoWay:!1,setOnBind:!0}}]}),f=e.extend({}),g={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"IndividualInContextTopicViewModel",path:"businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{personId:{key:"personId",value:"null"}},methods:{}};return f.prototype.getMetaData=function(){return g},f});
define("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel",["lightsaber"],function (a){var b=a.Core.ObservableViewModel.extend({persistent:["productOrderItemID","productOrderItemRefNumber","productSpecID","productOfferingID","productOfferingProductSpecID","businessType","flowName","activityName","quantity","productID","catalogVariantID","lobCode","catalogItem","variantName","defaultVariantID","priceSchemaID","containedProductID","productSpecContainmentID","productSpecContainmentIDChannels","productSpecContainmentIDPackages","selectDevice","configurationToDisplay","deviceAssignedProductID","containedProductSpecID"],historyAttrs:["variantName","catalogVariantID"],defaults:{name:null,description:null,lobs:null,variantName:null,defaultVariantID:null,sellableWithoutPlan:null,businessType:null,basicBillingOfferID:null,productOfferingID:null,productOfferingType:null,productOfferingProductSpecID:null,productID:null,deviceAssignedProductID:null,productOrderItemID:null,productOrderItemType:null,productOrderItemReason:null,productOrderItemReasonText:null,priceSchemaID:null,isReplacedOffer:null,productSpecID:null,catalogVariantID:null,quantity:1,isSellableOutsideOffering:null,serviceRequiredDate:null,planName:null,flowName:null,flowOrigin:null,installationAddressID:null,activityName:null,containedProductID:null,containedProductSpecID:null,containedProductParentID:null,productSpecContainmentID:null,lobCode:null,containedProductType:null,parentProductSpecContainmentID:null,productOrderItemRefNumber:null,catalogItem:null,reserveItemDetails:null,productSpecContainmentIDChannels:null,productSpecContainmentIDPackages:null,selectDevice:null,configurationToDisplay:null},restoreFromUrl:function(a){a||(a={});var b=requirejs.urlVM&&requirejs.urlVM.get("Variant")||a.variantName;b&&this.set("variantName",b);var c=requirejs.urlVM&&requirejs.urlVM.get("ID")||a.catalogVariantID||this.get("defaultVariantID");c&&this.set("catalogVariantID",c)}}),c=b.extend({}),d={path:"businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductConfigurationTopicViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{productOfferingID:{key:"productOfferingID",value:"null"},productOfferingProductSpecID:{key:"productOfferingProductSpecID",value:"null"},productID:{key:"productID",value:"null"},productOrderItemID:{key:"productOrderItemID",value:"null"},productOrderItemType:{key:"productOrderItemType",value:"null"},productOrderItemReason:{key:"productOrderItemReason",value:"null"},productOrderItemReasonText:{key:"productOrderItemReasonText",value:"null"},serviceRequiredDate:{key:"serviceRequiredDate",value:"null"},flowName:{key:"flowName",value:"null"},installationAddressID:{key:"installationAddressID",value:"null"},activityName:{key:"activityName",value:"null"},containedProductID:{key:"containedProductID",value:"null\n"},containedProductParentID:{key:"containedProductParentID",value:"null"},productSpecContainmentID:{key:"productSpecContainmentID",value:"null"},lobCode:{key:"lobCode",value:"null"},containedProductType:{key:"containedProductType",value:"null"},parentProductSpecContainmentID:{key:"parentProductSpecContainmentID",value:"null"},catalogItem:{key:"catalogItem",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/SearchTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["searchText","selectedItem","selectedCategoryId","selectedStructureId"],historyAttrs:["searchText"],defaults:{searchText:"",selectedCategoryId:null,resultsSize:null,moreResultsSize:null,selectedStructureId:null,totalSearchResults:null,installationAddressId:null,selectedItem:null,HGPresentmentLevel:null},initialize:function(){this.on("dataReady",this.fireEvent,this)},bindData:function(a){(new b.Core.DataBinding).bindAll(a)},registerActions:function(a){this.vm=a},fireEvent:function(){this.handleAction("action:searchDataReady")},restoreFromUrl:function(a){a||(a={});var b=requirejs.urlVM&&requirejs.urlVM.get("search")||a.searchText;b&&this.set("searchText",b)}})});
define("businesswidget/repository/common/viewmodel/ItemListTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["selectedItem","itemsToCompare","itemsToCompareBrowsingCategoryStructureID","itemsSelectedDeltaStatus","browsingCategoryStructureID","productOfferingID","currentCategoryStructureId","itemsStatusList","browsingCategoryID","productSpecID","productOfferingProductSpecID","productOfferingInstanceID"],historyAttrs:["browsingCategoryID","browsingCategoryStructureID","itemsToCompare","itemsToCompareBrowsingCategoryStructureID"],defaults:{maxNumberOfSelectedItems:null,itemsStatusList:null,itemsToCompare:null,itemsToCompareBrowsingCategoryStructureID:null,InstallationAddressId:null,productId:null,removedItem:null,selectedItem:null,selectedItems:null,itemsSelectedDeltaStatus:null,browsingCategoryStructureID:null,browsingCategoryID:null,activeFilterFacets:null,productSpecID:null,productOfferingID:null,productOfferingProductSpecID:null,relationID:null,HGPresentmentLevel:null,searchText:null,deviceName:null,currentCategoryStructureId:null,reserveItemDetails:null,productOfferingInstanceID:null},resetTopicData:function(){this.set(this.defaults)},restoreFromUrl:function(a){a||(a={});var b=requirejs.urlVM&&requirejs.urlVM.get("activeFilterFacets")||[];try{b=JSON.parse(b)}catch(a){}b&&this.set("activeFilterFacets",b)}})});
define("businesswidget/repository/common/viewmodel/CompareTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["selectedItem","compareIDs"],defaults:{entityType:null,compareIDs:null,selectedItem:null}})});
define("businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel",["underscore","lightsaber","Configuration","single!businesswidget/repository/common/viewmodel/SearchTopicViewModel","single!businesswidget/repository/common/viewmodel/ItemListTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository/common/viewmodel/CompareTopicViewModel"],function (a,b,c,d,e,f,g){return b.Core.ObservableViewModel.extend({persistent:["selectedItems","buyItems"],historyAttrs:["selectedItems"],defaults:{selectedItems:null,buyItems:null,productDetails:null,clickedItem:null},dataBindings:[{selectedItems:"subViewModels.searchTopic.selectedItem",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.get("selectedItems")||{};c[a.businessType]=this.mapSelectedItem(a),this.mapRecentSelectedItem(c,a),this.set("selectedItems",c)}}}}],initialize:function(){this.subViewModels.searchTopic=d,this.subViewModels.itemListTopic=e,this.subViewModels.productConfigurationTopic=f,this.subViewModels.compareTopic=g;var a=this;this.subViewModels.productConfigurationTopic.on("action:buyPlanClicked action:addItemToCart",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get();if(b[e.businessType]=a.mapBuyItemFromItemDetails(e),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.name=e.catalogItem.name,f.oneTimePrice=e.catalogItem.oneTimePrice,f.recurringPrice=e.catalogItem.recurringPrice,f.brand=e.catalogItem.brand,f.variant=e.catalogItem.variant,f.catalogItemId=e.catalogItem.id,f.lob=e.catalogItem.lob,a.set("clickedItem",f)}d[e.businessType]=a.updateQuantity(e,e.businessType,d[e.businessType]),d[e.businessType]=a.updateSelectedHardGood(e,e.businessType,d[e.businessType]),a.set("buyItems",b),a.set("selectedItems",d),a.handleAction("onItemClicked")}),this.subViewModels.productConfigurationTopic.on("action:addedItem",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get();if(b[e.businessType]=a.mapBuyItemFromItemDetails(e),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.name=e.catalogItem.name,f.oneTimePrice=e.catalogItem.oneTimePrice,f.recurringPrice=e.catalogItem.recurringPrice,f.brand=e.catalogItem.brand,f.variant=e.catalogItem.variant,f.catalogItemId=e.catalogItem.id,f.lob=e.catalogItem.lob,a.set("clickedItem",f)}d[e.businessType]=a.updateQuantity(e,e.businessType,d[e.businessType]),d[e.businessType]=a.updateSelectedHardGood(e,e.businessType,d[e.businessType]),a.set("buyItems",b),a.set("selectedItems",d),a.handleAction("onItemClicked"),a.subViewModels.productConfigurationTopic.trigger("buyTopItemPerformed")}),this.subViewModels.productConfigurationTopic.on("action:buyAddonPlanFromBundleClicked",function(){var b=a.get("buyItems")||{},c=a.get("selectedItems")||{},d=this.get();b[d.businessType]=a.mapBuyItemFromItemDetails(d),b[d.businessType].productOfferingInstanceID=d.ProductOfferingInstanceID,c[d.businessType]=a.mapSelectedItemForBunndleAddon(d),c[d.businessType].productOfferingInstanceID=d.ProductOfferingInstanceID,a.subViewModels.itemListTopic.set("productOfferingInstanceID",d.ProductOfferingInstanceID),a.set("buyItems",b),a.set("selectedItems",c),a.subViewModels.productConfigurationTopic.handleAction("buyBundleAddOn")}),this.subViewModels.productConfigurationTopic.on("action:itemSelected",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get();if(b[e.businessType]=a.mapBuyItemFromItemDetails(e),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.name=e.catalogItem.name,f.oneTimePrice=e.catalogItem.oneTimePrice,f.recurringPrice=e.catalogItem.recurringPrice,f.brand=e.catalogItem.brand,f.variant=e.catalogItem.variant,f.catalogItemId=e.catalogItem.id,f.lob=e.catalogItem.lob,a.set("clickedItem",f)}d[e.businessType]=a.updateQuantity(e,e.businessType,d[e.businessType]),d[e.businessType]=a.updateSelectedHardGood(e,e.businessType,d[e.businessType]),a.set("buyItems",b),a.set("selectedItems",d),a.subViewModels.productConfigurationTopic.trigger("buyBundlePerformed")}),this.subViewModels.productConfigurationTopic.on("action:buyPlanWithExitingHardGoodsClicked action:addExistingSubscriptionToCart action:addNewSubscriptionToCart action:buyHardGoodWithExitingPlan",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get();if(b[e.businessType]=a.mapBuyItemFromItemDetails(e),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.name=e.catalogItem.name,f.oneTimePrice=e.catalogItem.oneTimePrice,f.recurringPrice=e.catalogItem.recurringPrice,f.brand=e.catalogItem.brand,f.variant=e.catalogItem.variant,f.catalogItemId=e.catalogItem.id,f.lob=e.catalogItem.lob,a.set("clickedItem",f)}d[e.businessType]=a.updateQuantity(e,e.businessType,d[e.businessType]),d[e.businessType]=a.updateSelectedHardGood(e,e.businessType,d[e.businessType]),a.set("buyItems",b),a.set("selectedItems",d),a.handleAction("onItemClicked"),a.subViewModels.productConfigurationTopic.trigger("buyActionPerformed");
}),this.subViewModels.productConfigurationTopic.on("action:changePlanClicked",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get();if(b[e.businessType]=a.mapBuyItemFromItemDetails(e),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.name=e.catalogItem.name,f.oneTimePrice=e.catalogItem.oneTimePrice,f.recurringPrice=e.catalogItem.recurringPrice,f.brand=e.catalogItem.brand,f.variant=e.catalogItem.variant,f.catalogItemId=e.catalogItem.id,f.lob=e.catalogItem.lob,a.set("clickedItem",f)}d[e.businessType]=a.updateQuantity(e,e.businessType,d[e.businessType]),d[e.businessType]=a.updateSelectedHardGood(e,e.businessType,d[e.businessType]),a.set("buyItems",b),a.set("selectedItems",d),a.handleAction("onItemClicked"),a.subViewModels.productConfigurationTopic.trigger("changePlanActionPerformed")}),this.subViewModels.productConfigurationTopic.on("action:upgradeDeviceClicked",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get();if(b[e.businessType]=a.mapBuyItemFromItemDetails(e),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.name=e.catalogItem.name,f.oneTimePrice=e.catalogItem.oneTimePrice,f.recurringPrice=e.catalogItem.recurringPrice,f.brand=e.catalogItem.brand,f.variant=e.catalogItem.variant,f.catalogItemId=e.catalogItem.id,f.lob=e.catalogItem.lob,a.set("clickedItem",f)}d[e.businessType]=a.updateQuantity(e,e.businessType,d[e.businessType]),a.set("buyItems",b),a.set("selectedItems",d),a.handleAction("onItemClicked"),a.subViewModels.productConfigurationTopic.trigger("upgradeDeviceActionPerformed")}),this.subViewModels.productConfigurationTopic.on("action:SelectSubscription",function(){if(selectedItems=a.get("selectedItems")||{},data=this.get(),selectedItems)for(var b in selectedItems)b&&b===data.businessType?(selectedItems[data.businessType].catalogItemID=data.catalogItem&&data.catalogItem.id?data.catalogItem.id:data.priceSchemaID,selectedItems[data.businessType].lobCode=data.lobCode,selectedItems[data.businessType].lob=[data.lobCode],selectedItems[data.businessType].isSharedPlan=data.sharedPlan,selectedItems[data.businessType].isRecent=!0,selectedItems[data.businessType].productOfferingID=data.productOfferingID,selectedItems[data.businessType].productOfferingProductSpecID=data.productOfferingProductSpecID,selectedItems[data.businessType].productSpecID||(selectedItems[data.businessType].productSpecID=data.productSpecID)):selectedItems[b].isRecent=!1;else selectedItems[data.businessType]={},selectedItems[data.businessType].catalogItemID=data.catalogItem&&data.catalogItem.id?data.catalogItem.id:data.priceSchemaID,selectedItems[data.businessType].lobCode=data.lobCode,selectedItems[data.businessType].lob=[data.lobCode],selectedItems[data.businessType].isSharedPlan=data.sharedPlan,selectedItems[data.businessType].isRecent=!0,selectedItems[data.businessType].productOfferingID=data.productOfferingID,selectedItems[data.businessType].productOfferingProductSpecID=data.productOfferingProductSpecID,selectedItems[data.businessType].productSpecID=data.productSpecID;if(a.set("selectedItems",selectedItems),c.get("useDataManipulationForTagging")){var d=a.get("clickedItem")||{};d.name=data.catalogItem.name,d.oneTimePrice=data.catalogItem.oneTimePrice,d.recurringPrice=data.catalogItem.recurringPrice,d.brand=data.catalogItem.brand,d.variant=data.catalogItem.variant,d.catalogItemId=data.catalogItem.id,d.lob=data.catalogItem.lob,a.set("clickedItem",d)}a.handleAction("onItemClicked")}),this.subViewModels.compareTopic.on("action:viewItemDetails",function(){var b=a.get("selectedItems")||{},c=this.get("selectedItem");c&&c.item&&(b[c.businessType]=a.mapSelectedItemFromCompare(c.item),a.mapRecentSelectedItem(b,c),a.set("selectedItems",b))}),this.subViewModels.itemListTopic.on("action:onMoreDetailsAction",function(){var b=a.get("selectedItems")||{},c=this.get("selectedItem");c&&c.item&&(b[c.item.businessType]=a.mapSelectedItem(c.item),a.mapRecentSelectedItem(b,c.item),a.set("selectedItems",b))}),this.subViewModels.itemListTopic.on("action:onItemSelected",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get("selectedItem");if(e&&e.item){if(d[e.item.businessType]=a.mapSelectedItem(e.item),a.set("selectedItems",d),b[e.item.businessType]=a.mapBuyItemFromItemList(e.item),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.catalogItemId=e.id,f.name=e.item.catalogItemName,f.recurringPrice=e.item.recurringPrice,f.oneTimePrice=e.item.oneTimePrice,f.currency=e.item.currency,f.lob=e.item.lob.length>1?"bundle":e.item.lob[0],a.set("clickedItem",f)}a.set("buyItems",b),a.handleAction("onItemClicked")}}),this.subViewModels.itemListTopic.on("action:SelectSubscription",function(){var b=a.get("selectedItems")||{},c=this.get("selectedItem");c&&c.item&&(b[c.item.businessType]=a.mapSelectedItem(c.item),a.mapRecentSelectedItem(b,c.item),a.set("selectedItems",b))}),this.subViewModels.searchTopic.on("action:SelectSubscription",function(){var b=a.get("selectedItems")||{},c=this.get("selectedItem");c&&c.item&&(b[c.item.businessType]=a.mapSelectedItem(c.item),a.mapRecentSelectedItem(b,c.item),a.set("selectedItems",b))}),this.subViewModels.itemListTopic.on("action:onDeviceForUpgradeSelected",function(){var b=a.get("buyItems")||{},d=a.get("selectedItems")||{},e=this.get("selectedItem");if(e&&e.item){if(d[e.item.businessType]=a.mapSelectedItem(e.item),a.set("selectedItems",d),b[e.item.businessType]=a.mapBuyItemFromItemList(e.item),c.get("useDataManipulationForTagging")){var f=a.get("clickedItem")||{};f.catalogItemId=e.id,f.name=e.item.catalogItemName,f.recurringPrice=e.item.recurringPrice,f.oneTimePrice=e.item.oneTimePrice,f.currency=e.item.currency,f.lob=e.item.lob.length>1?"bundle":e.item.lob[0],a.set("clickedItem",f)}a.set("buyItems",b),a.subViewModels.itemListTopic.handleAction("DeviceForUpgrade")}})},updateQuantity:function(a,b,d){return d&&a&&b==c.get("businessType_ACCESSORY")&&(d.quantity=a.quantity),d},updateSelectedHardGood:function(a,b,d){return d&&a&&b==c.get("businessType_DEVICE_MD")&&(d.catalogItemID=a.productSpecID,d.productOfferingID=a.productOfferingID,d.productOfferingProductSpecID=a.productOfferingProductSpecID,d.sellableWithoutPlan=a.sellableWithoutPlan),d},mapSelectedItem:function(b){switch(b.businessType){case"DEVICE":case"PLAN":return{catalogItemID:b.catalogItemID,productSpecID:b.containingOfferings[0].productSpecIds[0],productOfferingID:b.containingOfferings[0].offeringId,productOfferingProductSpecID:b.containingOfferings[0].offeringToProductIds[0],lob:b.lob,isSharedPlan:!a.isUndefined(b.sharedPlan)&&"YES"===b.sharedPlan};case"SERVICE":case"F_N_F_SERVICE":case"TV_PACKAGE":case"TV_CHANNEL":case"PRICE_PACKAGE":case c.get("businessType_DEVICE_MD"):case c.get("businessType_ACCESSORY"):return{catalogItemID:b.catalogItemID,productOfferingID:b.containingOfferings[0].offeringId,productOfferingProductSpecID:b.containingOfferings[0].offeringToProductIds[0],lob:b.lob,sellableWithoutPlan:b.sellableWithoutPlan};case"OFFERING":return{catalogItemID:b.catalogItemID,lob:b.lob};default:return{}}},mapSelectedItemFromCompare:function(a){switch(a.businessType){case"DEVICE":case"PLAN":return{catalogItemID:a.id,productOfferingID:a.productOfferingID,productOfferingProductSpecID:a.productOfferingProductSpecID,lob:a.lineOfBusiness,productSpecID:a.productSpecID,isSharedPlan:a.isSharedPlan};case c.get("businessType_DEVICE_MD"):case c.get("businessType_ACCESSORY"):return{catalogItemID:a.productSpecID,productOfferingID:a.productOfferingID,productOfferingProductSpecID:a.productOfferingProductSpecID,lob:a.lineOfBusiness};default:return{}}},mapSelectedItemForBunndleAddon:function(a){var b={};return"PLAN"==a.businessType&&(b={catalogItemID:a.catalogItemID,productSpecID:a.productSpecID,productOfferingID:a.productOfferingID,productOfferingProductSpecID:a.productOfferingProductSpecID,priceSchemaID:a.priceSchemaID,businessType:a.businessType,lob:a.lobs||[a.lobCode],productOfferingInstanceID:a.ProductOfferingInstanceID,addressID:a.addressID?a.addressID:""}),b},mapBuyItemFromItemDetails:function(b){switch(b.businessType){case"PLAN":return{productSpecID:b.productSpecID,productOfferingID:b.productOfferingID,productOfferingProductSpecID:b.productOfferingProductSpecID,priceSchemaID:b.priceSchemaID,lob:b.lobs||[b.lobCode]};case"TV_PACKAGE":case"TV_CHANNEL":return a.pick(b,["productSpecID","productOfferingID"]);case c.get("businessType_DEVICE_MD"):case c.get("businessType_ACCESSORY"):return a.pick(b,["productSpecID","productOfferingID","productOfferingProductSpecID","quantity","sellableWithoutPlan","name","orderItemRefID","relatedItemID"]);case"OFFERING":return a.pick(b,["productOfferingID","name","description","lob"]);case"DEVICE":case"SERVICE":case"F_N_F_SERVICE":case"PRICE_PACKAGE":default:return{}}},mapBuyItemFromItemList:function(a){switch(a.businessType){case"PLAN":return{productSpecID:a.containingOfferings[0].productSpecIds[0],productOfferingID:a.containingOfferings[0].offeringId,productOfferingProductSpecID:a.containingOfferings[0].offeringToProductIds[0],priceSchemaID:a.catalogItemID,lob:a.lob};case"TV_PACKAGE":case"TV_CHANNEL":return{catalogItemID:a.catalogItemID,productOfferingID:a.containingOfferings[0].offeringId,productOfferingProductSpecID:a.containingOfferings[0].offeringToProductIds[0],lob:a.lob};case c.get("businessType_DEVICE_MD"):case c.get("businessType_ACCESSORY"):return{catalogItemID:a.catalogItemID,productOfferingID:a.containingOfferings[0].offeringId,productOfferingProductSpecID:a.containingOfferings[0].offeringToProductIds[0],lob:a.lob,quantity:1,sellableWithoutPlan:a.sellableWithoutPlan};case"OFFERING":return{productOfferingID:a.catalogItemID,lob:a.lob};case"DEVICE":case"SERVICE":case"F_N_F_SERVICE":case"PRICE_PACKAGE":default:return{}}},mapRecentSelectedItem:function(a,b){for(var c in a)c&&a[c]&&(c===b.businessType?a[c].isRecent=!0:a[c].isRecent=!1)}})});
define("businesswidget/repository/common/viewmodel/ProductsNavigationDropDownWidgetViewModel",["underscore","lightsaber","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel"],function (a,b,c,d,e,f,g){return b.Core.ObservableViewModel.extend({PRODUCTS_NAVIGATION_CONSTANTS:{DEFAULT_BUSINESS_TYPE:"PLAN",BUSINESS_TYPES:["PLAN","TV_CHANNEL","TV_PACKAGE","SERVICE","MD"]},subViewModels:{CustomerInContextTopicVM:d,IndividualInContextTopicVM:e,productConfigurationTopicViewModel:f,selectedCatalogItemsTopicViewModel:g},dataBindings:[{customerId:"subViewModels.CustomerInContextTopicVM.ID",options:{twoWay:!1,setOnBind:!0}},{personId:"subViewModels.IndividualInContextTopicVM.personId",options:{twoWay:!0,setOnBind:!0}},{assignedProductID:"subViewModels.productConfigurationTopicViewModel.productID",options:{twoWay:!1,setOnBind:!0}},{priceSchemaID:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapPriceSchemaIdFromItemList(a);c&&this.set("priceSchemaID",c)}}}},{productSpecID:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapProductSpecIDFromItemList(a);c&&this.set("productSpecID",c)}}}},{productOfferingID:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapProductOfferingIdFromItemList(a);c&&this.set("productOfferingID",c)}}}},{productOfferingProductSpecID:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapProductOfferingProductSpecIdFromItemList(a);c&&this.set("productOfferingProductSpecID",c)}}}},{lobCode:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapLobCodeFromItemList(a);c&&this.set("lobCode",c)}}}},{catalogItemId:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapLobCodeForCatalogItemId(a);c&&this.set("catalogItemId",c)}}}},{catalogItemIdBussinessType:"subViewModels.selectedCatalogItemsTopicViewModel.selectedItems",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){if(a){var c=this.mapLobCodeForCatalogItemIdBussinessType(a);c&&(this.set("catalogItemIdBussinessType",c),this.subViewModels.productConfigurationTopicViewModel.set("businessType",c))}}}}],defaults:{customerId:null,personId:null,lobCode:"EntireAccount",assignedProductID:null,individualId:null,displayInputLOBOnly:!1,enableItemSelection:!0,includeGLP:!0,priceSchemaID:null,productSpecID:null,productOfferingID:null,productOfferingProductSpecID:null,widgetView:null,catalogItemId:null,catalogItemIdBussinessType:null,lo:c.get("locale"),sc:c.get("salesChannel"),enableSaveConfiguration:!0},mapPriceSchemaIdFromItemList:function(a){var b;for(var c in a)if(c&&c===this.PRODUCTS_NAVIGATION_CONSTANTS.DEFAULT_BUSINESS_TYPE&&a[c]&&a[c].isRecent&&a[c].catalogItemID){b=a[c].catalogItemID;break}return b},mapProductSpecIDFromItemList:function(a){var b;for(var c in a)if(c&&c===this.PRODUCTS_NAVIGATION_CONSTANTS.DEFAULT_BUSINESS_TYPE&&a[c]&&a[c].isRecent&&a[c].productSpecID){b=a[c].productSpecID;break}return b},mapProductOfferingIdFromItemList:function(a){var b;for(var c in a)if(c&&c===this.PRODUCTS_NAVIGATION_CONSTANTS.DEFAULT_BUSINESS_TYPE&&a[c]&&a[c].isRecent&&a[c].productOfferingID){b=a[c].productOfferingID;break}return b},mapProductOfferingProductSpecIdFromItemList:function(a){var b;for(var c in a)if(c&&c===this.PRODUCTS_NAVIGATION_CONSTANTS.DEFAULT_BUSINESS_TYPE&&a[c]&&a[c].isRecent&&a[c].productOfferingProductSpecID){b=a[c].productOfferingProductSpecID;break}return b},mapLobCodeFromItemList:function(a){var b;for(var c in a)if(c&&this.getBusinessType(c)&&a[c]&&a[c].isRecent&&a[c].lob){b=a[c].lob[0];break}return b},mapLobCodeForCatalogItemId:function(a){var b;for(var c in a)if(c&&this.getBusinessType(c)&&a[c]&&a[c].isRecent&&a[c].catalogItemID){b=a[c].catalogItemID;break}return b},mapLobCodeForCatalogItemIdBussinessType:function(a){var b;for(var c in a)if(c&&this.getBusinessType(c)&&a[c]&&a[c].isRecent&&a[c].catalogItemID){b=c;break}return b},getBusinessType:function(b){var c=!1;return a.each(this.PRODUCTS_NAVIGATION_CONSTANTS.BUSINESS_TYPES,function(a){a===b&&(c=!0)}),c}})});
define("businesswidget/repository/common/model/CustomerHasOffersForLOBModel",["underscore","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"ecommerce/customer/:id/has-offers-for-lob",rest:{defaults:{qParams:{lo:"en_US",sc:"SS"}},read:{url:"ecommerce/customer/:id/has-offers-for-lob"}}}}),d=c.extend({}),e={path:"src/modules/ebill/common/model/CustomerHasOffersForLOBModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerHasOffersForLOBModel",savePath:"src/modules/ebill/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"ecommerce/customer/:id/has-offers-for-lob"}},restDataSourceProperties:{read:{url:{value:"ecommerce/customer/:id/has-offers-for-lob"}}}},defaultData:{data:null},validations:[],methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/CustomerHasOffersForLOBViewModel",["underscore","lightsaber","businesswidget/repository/common/model/CustomerHasOffersForLOBModel"],function (a,b,c){var d=b.Core.ViewModel.extend({models:{CustomerHasOffersForLOBModel:b.Core.Model},initialize:function(){a.bindAll(this,"lazyLoadData","_setCustomerHasOffersDataOnSuccess","_setCustomerHasOffersDataOnError"),this.initCustomerHasOffersForLOBModel()},initCustomerHasOffersForLOBModel:function(){this.models.customerHasOffersForLOBModel=this.create("mcss_customerProductsViewModel",c)},lazyLoadData:function(a,b,c){return this.models.customerHasOffersForLOBModel.set({id:this.customerId}),this.models.customerHasOffersForLOBModel.setQueryParams({lo:b,sc:c,lob:this.lob}),this.models.customerHasOffersForLOBModel.fetch({success:this._setCustomerHasOffersDataOnSuccess,error:this._setCustomerHasOffersDataOnError})},_setCustomerHasOffersDataOnSuccess:function(b,c){a.isUndefined(c)||a.isUndefined(c["String[]"])||this.set("eligibleLobDetails",c["String[]"])},_setCustomerHasOffersDataOnError:function(){}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/CustomerHasOffersForLOBViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerHasOffersForLOBViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"CustomerHasOffersForLOBModel",pathName:"businesswidget/repository/common/model/CustomerHasOffersForLOBModel"}],models:[{name:"CustomerHasOffersForLOBModel",type:"module",module:"Lightsaber.Core.Model",moduleId:"Lightsaber.Core.Model",description:""}],viewModels:[],dataBindings:[],methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initCustomerHasOffersForLOBModel:{name:"initCustomerHasOffersForLOBModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},lazyLoadData:{name:"lazyLoadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setCustomerHasOffersDataOnSuccess:{name:"_setCustomerHasOffersDataOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setCustomerHasOffersDataOnError:{name:"_setCustomerHasOffersDataOnError",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}},defaults:[]};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","single!businesswidget/repository/common/util/BusinessHelper","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel"],function (a,b,c,d,e,f){var g=b.Core.ObservableViewModel.extend({persistent:["assignedProductID"],subViewModels:{CustomerInContextTopicVM:e,IndividualInContextTopicVM:f},dataBindings:[{customerId:"subViewModels.CustomerInContextTopicVM.ID",options:{twoWay:!0,setOnBind:!0}},{personId:"subViewModels.IndividualInContextTopicVM.personId",options:{twoWay:!0,setOnBind:!0}}],defaults:{customerId:null,personId:null,lobCode:d.entireAccount.id,assignedProductID:null,assignedProductStatus:null,navigationItem:null,GLPAssignedProductID:null,widgetView:null}}),h=g.extend({}),i={path:"businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"MyProductsAndServicesWidgetViewModel",savePath:"businesswidget/repository/widgetsLibrary/myProductsAndServicesWidget/web/viewModel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"rb",pathName:"ResourceBundle"},{variable:"BusinessHelper",pathName:"businesswidget/repository/common/util/BusinessHelper"},{variable:"CustomerInContextTopicViewModel",pathName:"single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel"},{variable:"IndividualInContextTopicViewModel",pathName:"single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel"}],models:[],viewModels:[{name:"CustomerInContextTopicVM",type:"module",module:"CustomerInContextTopicViewModel",moduleId:"businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel",description:""},{name:"IndividualInContextTopicVM",type:"module",module:"IndividualInContextTopicViewModel",moduleId:"businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel",description:""}],dataBindings:[{target:"customerId",source:"subViewModels.CustomerInContextTopicVM.customerId",options:{twoWay:!0,setOnBind:!0}},{target:"personId",source:"subViewModels.IndividualInContextTopicVM.personId",options:{twoWay:!0,setOnBind:!0}}],methods:{initialize:{name:"initialize",
privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}},defaults:[{key:"customerId",value:"null"},{key:"personId",value:"null"},{key:"lobCode",value:"BusinessHelper.entireAccount.id"},{key:"assignedProductID",value:"null"},{key:"navigationItem",value:"null"}]};return h.prototype.getMetaData=function(){return i},h});
define("businesswidget/repository/common/viewmodel/CreateCustomerProblemTopicViewModel",["lightsaber"],function (a){return a.Core.ViewModel.extend({defaults:{isGeneralTicketSelected:!1}})});
define("businesswidget/repository/common/viewmodel/ProductOverviewWidgetViewModel",["underscore","lightsaber","knockout","businesswidget/repository/common/viewmodel/CustomerHasOffersForLOBViewModel","businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel","businesswidget/repository/common/viewmodel/CustomerProductsViewModel","single!businesswidget/repository/common/util/BusinessHelper","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel","single!businesswidget/repository/common/viewmodel/CreateCustomerProblemTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j){return b.Core.ObservableViewModel.extend({defaults:{customerId:null,salechannel:"SS",locale:"en_US",NonAssignLOBisRequired:"YesEligibilityNotRequired",lobArray:c.observableArray([]),selectedLob:null,enableItemSelection:!0},subViewModels:{CustomerInContextTopicVM:h},dataBindings:[{customerId:"subViewModels.CustomerInContextTopicVM.customerId",options:{setOnBind:!0}}],initialize:function(a){this._super(a),this.bindContext(),this.VIEW_MODE={SINGLE_LINE:"singleLine",LIST_VIEW:"listView"}},lobItemSelectedAction:function(a,b){console.log("LOB Code: "+b.code);var c=b.code;this.set("selectedLob",b.name),this._createLobData(),this.trigger("action:AssignLOB",c,this.assignedLobInformation[c].apId,this.assignedLobInformation[c].shared)},_createLobInformation:function(){this.assignedLobInformation={};var b=this.subViewModels.customerProductsViewModel.get("customerProductsData");a.each(b,function(a){a.lob&&(this.assignedLobInformation[a.lob]?a.shared||(this.assignedLobInformation[a.lob].productCounter=this.assignedLobInformation[a.lob].productCounter+1):this.assignedLobInformation[a.lob]={product:a,productCounter:1,shared:a.shared})},this)},bindContext:function(){a.bindAll(this,"lobItemSelectedAction","_onFetchError","_createNonAssignedLobInformation","createMergedLobList","_createMultilineLobList","_createSinglelineLobList","_loadEligibleLob","_createLobInformation","loadData","_createLobData","addDisplayProperties","_lobSelectedHandler","_getPlansCategoryStructureID","getLobCodeForAssignedProduct")},_onFetchError:function(){},_createNonAssignedLobInformation:function(){this.varNonAssignedLobItemArr=[];var b={};!0===this.eligibilityRequired?a.each(this.lobdetails,function(a){this.eligibleLobCode[a.code]&&(b={},b.name=a.name,b.code=a.code,b.plansCategoryStructureID=a.plansCategoryStructureID,this.addIconURL&&(b.bigPicture=this.addIconURL,b.smallPicture=this.addIconURL,b.bigPictureClass="lob-big",b.smallPictureClass="lob-small"),this.varNonAssignedLobItemArr.push(b))},this):a.each(this.lobdetails,function(a){this.assignedLobInformation[a.code]||(b={},b.name=a.name,b.code=a.code,b.plansCategoryStructureID=a.plansCategoryStructureID,this.addIconURL&&(b.bigPicture=this.addIconURL,b.smallPicture=this.addIconURL,b.bigPictureClass="lob-big",b.smallPictureClass="lob-small"),this.varNonAssignedLobItemArr.push(b))},this)},InitializeVmParameters:function(){switch(this.customerId=this.get("customerId"),this.get("locale")&&""!=this.get("locale")?this.locale=this.get("locale"):this.locale="en_US",this.get("salechannel")&&""!=this.get("salechannel")?this.salechannel=this.get("salechannel"):this.salechannel="SS",this.get("nonAssignLOBisRequiredInputField")&&(this.NonAssignLOBisRequired=this.get("nonAssignLOBisRequiredInputField")),this.noDataURL=this.get("noDataURL"),this.addIconURL=this.get("addIconURL"),this.NonAssignLOBisRequired){case"No":this.eligibilityRequired=!1,this.nonAssignLOBisRequired=!1;break;case"YesEligibilityNotRequired":this.eligibilityRequired=!1,this.nonAssignLOBisRequired=!0;break;case"YesEligibleOnly":default:this.eligibilityRequired=!0,this.nonAssignLOBisRequired=!0}this.DISPLAY_MODE={TWO_ITEM:"twoItems",THREE_ITEM:"threeItems",MORE_THAN_THREE_ITEM:"moreItems"}},_loadEligibleLob:function(){this.subViewModels.customerHasOffersForLOBViewModel.customerId=this.customerId,this.subViewModels.customerHasOffersForLOBViewModel.lob=this.nonAssignedLobCodeArr;var a=this;$.when(this.subViewModels.customerHasOffersForLOBViewModel.lazyLoadData(this.customerId,this.locale,this.salechannel)).then(function(){a._setEligibleLobOnSuccess()})},_setEligibleLobOnSuccess:function(b,c){if(c=this.subViewModels.customerHasOffersForLOBViewModel.get("eligibleLobDetails"),!a.isUndefined(c)){this.eligibleLobCode=[],lobs=c;for(var d=0;d<lobs.length;d++)this.eligibleLobCode[lobs[d]]={eligible:"true"};this._createNonAssignedLobInformation(),this.createMergedLobList()}},createMergedLobList:function(){var a=this.get("displayMode");a===this.VIEW_MODE.SINGLE_LINE?this._createSinglelineLobList():a===this.VIEW_MODE.LIST_VIEW?this._createSinglelineLobList():this._createMultilineLobList()},_createMultilineLobList:function(){var c=this.create("mcss_lob_collection",b.Core.Collection);if(a.each(this.varAssignedLobItemArr,function(a){c.add(a)},this),a.each(this.varNonAssignedLobItemArr,function(a){c.add(a)},this),0===c.length)this.trigger("NoData");else{6===c.length?(this.displayMode=this.DISPLAY_MODE.THREE_ITEM,this.itemSize=3):c.length>4?(this.displayMode=this.DISPLAY_MODE.MORE_THAN_THREE_ITEM,this.itemSize=3):(this.displayMode=this.DISPLAY_MODE.TWO_ITEM,this.itemSize=2),this._createLobPictureType(c);for(var d={},e=0,f=new b.Core.Collection,d={},f=new b.Core.Collection,e=0;e<c.length;)d={},c.at(e)&&(d.lob1=c.at(e)),c.at(e+1)&&(d.lob2=c.at(e+1)),d.id=e,f.add(d),e+=2;this.subViewModels.customerLobDetailsVM=new b.CollectionViewModel({models:{tabs:f},config:{enable:!0,visible:!0,actions:{select:this._lobSelectedHandler}}}),this.trigger("dataLoaded")}},_createSinglelineLobList:function(){this.varAssignedLobItemArr.length>0?(this.set("lobArray",this.varAssignedLobItemArr),this.set("noDataLoaded",!1),this.trigger("dataLoaded")):(this.set("noDataLoaded",!0),this.trigger("noDataLoaded"))},_lobSelectedHandler:function(a){var b=this,c=$(a.event.target).parents('[data-uxf-point="ui-listitem"]').attr("code");if(c)if(b.assignedLobInformation[c])i.set("assignedProductID",this.assignedLobInformation[c].apId),this.trigger("action:AssignLOB",c,this.assignedLobInformation[c].apId,this.assignedLobInformation[c].shared);else{var d=this._getPlansCategoryStructureID(c);this.trigger("action:NonAssignLOB",c,d)}},loadData:function(){this.InitializeVmParameters(),this._initSubViewModel();var a=this;$.when(this.subViewModels.customerProductsViewModel.lazyLoadData(this.customerId,this.get("individualId")),this.subViewModels.lineOfBusinessDetailViewModel.lazyLoadData(this.locale,this.salechannel)).then(function(){a.set("selectedLob",null),a._createLobData()})},createAssignedLobMap:function(){this.assignedLobInformation={},this.set("assignedProductLob",null);var b=this;a.each(this.customerProducts,function(a){a.lob&&(this.assignedLobInformation[a.lob]||a.shared?a.shared||(this.assignedLobInformation[a.lob].productCounter=this.assignedLobInformation[a.lob].productCounter+1,this.assignedLobInformation[a.lob].apId=void 0):this.assignedLobInformation[a.lob]={product:a,productCounter:1,shared:a.shared,apId:a.id,name:a.lob},b.get("assignedProductId")===a.id&&b.set("assignedProductLob",a.lob))},this)},getLobCodeForAssignedProduct:function(a){return this.get("assignedProductLob")},_createAssignedLobArray:function(){this.varAssignedLobItemArr=[],this.varNonAssignedLobItemArr=[];var b={};this.nonAssignedLobCodeArr=[];for(var c,d=(this.get("assignedProductId"),0);d<this.lobdetails.length;d++)if((c=this.lobdetails[d])&&this.assignedLobInformation[c.code]){if(!a.isUndefined(this.get("enableItemSelection"))&&!1===this.get("enableItemSelection")&&null!==this.get("assignedProductLob")&&this.get("assignedProductLob")!==c.code)continue;b={},b.setSelected=!1,this.get("selectedLob")||this.get("assignedProductLob")!=c.code||0!=j.get("isGeneralTicketSelected")?this.get("selectedLob")==c.name&&(b.setSelected=!0):b.setSelected=!0,b.code=c.code,b.name=c.name,b.bigPictureUrl=c.bigPicture,b.smallPictureUrl=c.smallPicture,this.addDisplayProperties(b),b.assigned="true",b.bigPicture&&(b.bigPictureClass="lob-big"),b.smallPicture&&(b.smallPictureClass="lob-small"),b.existSharedProduct=this.assignedLobInformation[c.code].shared,"1"==this.assignedLobInformation[c.code].productCounter?(b.apId=this.assignedLobInformation[c.code].product.id,"SERVICE_ID"===c.displayIdentifier&&(b.serviceId=g.formatPhoneNumber(this.assignedLobInformation[c.code].product.serviceId))):b.productCounter=this.assignedLobInformation[c.code].productCounter,this.varAssignedLobItemArr.push(b)}else this.nonAssignedLobCodeArr.push(c.code)},_createLobData:function(){this.setLobAndProductInformation(),this.createAssignedLobMap(),this._createAssignedLobArray(),!0===this.nonAssignLOBisRequired&&0!=this.nonAssignedLobCodeArr.length?!0===this.eligibilityRequired?this._loadEligibleLob():(this._createNonAssignedLobInformation(),this.createMergedLobList()):this.createMergedLobList()},_initSubViewModel:function(){this.subViewModels.customerHasOffersForLOBViewModel=this.create("productsOverviewViewModel_customerHasOffersForLOBViewModel",d),this.subViewModels.customerHasOffersForLOBViewModel.set("lo",this.locale),this.subViewModels.customerHasOffersForLOBViewModel.set("saleschannel",this.salechannel),this.subViewModels.lineOfBusinessDetailViewModel=this.create("mcss_utilitiesLineOfBusinessModel",e),this.subViewModels.lineOfBusinessDetailViewModel.set("lo",this.locale),this.subViewModels.lineOfBusinessDetailViewModel.set("saleschannel",this.salechannel),this.subViewModels.customerProductsViewModel=this.create("mcss_utilitiesLineOfBusinessModel",f),this.subViewModels.customerProductsViewModel.set("lo",this.locale),this.subViewModels.customerProductsViewModel.set("saleschannel",this.salechannel)},setLobAndProductInformation:function(){this.lobdetails=this.subViewModels.lineOfBusinessDetailViewModel.get("lobDetailData"),this.customerProducts=this.subViewModels.customerProductsViewModel.get("customerProductsData")},getPresentationMode:function(){return this.displayMode},_createLobPictureType:function(a){for(var b=0;b<a.length;b++)a.at(b).set("usePicture",this.displayMode)},addDisplayProperties:function(a){if(a.bigPictureUrl){var b=a.bigPictureUrl.split("."),c=b.length-2;this.get("selectedLob"),a.name,b[c]=b[c]+".",b=b.join(""),a.bigPicture=b}if(a.smallPictureUrl){var d=a.smallPictureUrl.split("."),c=d.length-2;this.get("selectedLob"),a.name,d[c]=d[c]+".",d=d.join(""),a.smallPicture=d}},_navigateToMyStuff:function(){this.trigger("action:AllProductsClicked",{})},_getPlansCategoryStructureID:function(a){if(this.subViewModels.lineOfBusinessDetailViewModel.getLOBCodeLOBDetailsMap()&&this.subViewModels.lineOfBusinessDetailViewModel.getLOBCodeLOBDetailsMap()[a])return this.subViewModels.lineOfBusinessDetailViewModel.getLOBCodeLOBDetailsMap()[a].lobDetail.plansCategoryStructureID}})});
define("businesswidget/repository/common/model/SubscriptionsPrepaidBucketsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"prepaid/customer/:customerId/subscriptions-prepaid-buckets",rest:{defaults:{qParams:{locale:c.get("locale"),sc:c.get("salesChannel")}}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"SubscriptionsPrepaidBucketsModel",path:"businesswidget/repository/common/model/SubscriptionsPrepaidBucketsModel.js",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"prepaid/customer/:customerId/subscriptions-prepaid-buckets"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"locale",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/SubscriptionsPrepaidBucketsViewModel",["underscore","lightsaber","businesswidget/repository/common/model/SubscriptionsPrepaidBucketsModel"],function (a,b,c){var d=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"loadData","_handleSubscriptionsPrepaidBucketsSuccess","_handleSubscriptionsPrepaidBucketsError")},loadData:function(){this.models.subscriptionsPrepaidBucketsModel=this.create("care_prepaidBalance_SubscriptionsPrepaidBucketsModel",c),this.models.subscriptionsPrepaidBucketsModel.set({customerId:this.get("customerId")});var a={};return void 0!=this.get("subscriptionIds")&&(a.sis=this.get("subscriptionIds")),this.models.subscriptionsPrepaidBucketsModel.setQueryParams(a),this.models.subscriptionsPrepaidBucketsModel.fetch({success:this._handleSubscriptionsPrepaidBucketsSuccess,error:this._handleError})},_handleSubscriptionsPrepaidBucketsSuccess:function(a,c){var d=c.PrepaidBuckets.buckets;b.Core.StorageUtil.set("topupbuckets",c.PrepaidBuckets.buckets),this.set("balancesData",d),this.trigger("dataReady:SubscriptionsPrepaidBuckets",d)},_handleSubscriptionsPrepaidBucketsError:function(a){}}),e=d.extend({}),f={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"SubscriptionsPrepaidBucketsViewModel",path:"businesswidget/repository/common/viewmodel/SubscriptionsPrepaidBucketsViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"SubscriptionsPrepaidBucketsModel",pathName:"businesswidget/repository/common/model/SubscriptionsPrepaidBucketsModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"fetch the data from model subscriptionsPrepaidBucketsModel",isChangeEventTriggered:!1},_handleSubscriptionsPrepaidBucketsSuccess:{name:"_handleSubscriptionsPrepaidBucketsSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"success callback for model subscriptionsPrepaidBucketsModel",isChangeEventTriggered:!1},_handleSubscriptionsPrepaidBucketsError:{name:"_handleSubscriptionsPrepaidBucketsError",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/PrepaidBucketAutoTopupModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/prepaid/prepaid-bucket/:pcnId/auto-topup",rest:{defaults:{qParams:{locale:c.get("locale"),sc:c.get("salesChannel")}}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"PrepaidBucketAutoTopupModel",path:"businesswidget/repository/common/model/PrepaidBucketAutoTopupModel.js",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"/prepaid/prepaid-bucket/:pcnId/auto-topup"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"locale",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/PrepaidBucketAutoTopupViewModel",["underscore","lightsaber","businesswidget/repository/common/model/PrepaidBucketAutoTopupModel","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d){var e=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"_initPrepaidBucketAutoTopupModel","loadData","_setPrepaidBucketAutoTopupOnSuccess","_setPrepaidBucketAutoTopupOnError")},_initPrepaidBucketAutoTopupModel:function(){this.prepaidBucketAutoTopupModel=this.create("care_prepaidBalance_PrepaidBucketAutoTopupModel",c),this.prepaidBucketAutoTopupModel.set({pcnId:this.get("pcnId")})},loadData:function(){return this._initPrepaidBucketAutoTopupModel(),this.prepaidBucketAutoTopupModel.fetch({success:this._setPrepaidBucketAutoTopupOnSuccess,error:this._setPrepaidBucketAutoTopupOnError})},_setPrepaidBucketAutoTopupOnSuccess:function(a,b){var c=b.AutoTopupHeader;$.isEmptyObject(c)||this.set("autoTopupData",b.AutoTopupHeader)},_setPrepaidBucketAutoTopupOnError:function(a){}}),f=e.extend({}),g={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"PrepaidBucketAutoTopupViewModel",path:"businesswidget/repository/common/viewmodel/PrepaidBucketAutoTopupViewModel.js",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"PrepaidBucketAutoTopupModel",pathName:"businesswidget/repository/common/model/PrepaidBucketAutoTopupModel"},{variable:"Util",pathName:"businesswidget/repository/common/util/Util"}],models:null,viewModels:null,dataBindings:null,defaults:null,
methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_initPrepaidBucketAutoTopupModel:{name:"_initPrepaidBucketAutoTopupModel",privacyLevel:"protected",isEventTriggered:!1,desc:"initialize the model prepaidBucketAutoTopupModel",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"feth the data from model prepaidBucketAutoTopupModel",isChangeEventTriggered:!1},_setPrepaidBucketAutoTopupOnSuccess:{name:"_setPrepaidBucketAutoTopupOnSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"success handler for model prepaidBucketAutoTopupModel",isChangeEventTriggered:!1},_setPrepaidBucketAutoTopupOnError:{name:"_setPrepaidBucketAutoTopupOnError",privacyLevel:"protected",isEventTriggered:!1,desc:"error handler for model prepaidBucketAutoTopupModel",isChangeEventTriggered:!1}}};return f.prototype.getMetaData=function(){return g},f});
define("businesswidget/repository/common/viewmodel/PrepaidBalanceWidgetViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/SubscriptionsPrepaidBucketsViewModel","businesswidget/repository/common/viewmodel/PrepaidBucketAutoTopupViewModel","businesswidget/repository/common/viewmodel/CustomerProductsViewModel","businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel","businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel"],function (a,b,c,d,e,f,g,h){var i=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"loadData","callPrepaidBuckets","callCustomerContactPersons","callCustomerProducts","callUtilityLogicalDate","_initializeCollection","_fetchAutoTopData","_createSubscriberPrepaidBucketAutoTopUpViewModel","callSubscriberPrepaidBucketAutoTopUp","_populateAutotopupData","_autoTopupDataReady","_initializeSubViewModels","_mapData","_calculateRemainingDays","_updateAutoTopupDetails","_findProduct","_getWirelessProductCount","_getPrepaidProductCount","_findContact","_throwError","_getSortedBalances","_balanceComparator","customAttributeComparator","_balanceSelectionHandler","_balanceTopupHandler","_viewAllBalancesActionHandler","_viewMoreDetailsActionHandler","_balanceTopupPopupHandler","_mapBalancesData")},loadData:function(){this._initializeSubViewModels(),this.prepaidBucketsPromise=this.callPrepaidBuckets(),this.prepaidBucketsPromise.done(this._fetchAutoTopData),this.prepaidBucketsPromise.fail(this._throwError),this.topupDataWithAutoTopupDefered=$.Deferred(),this.topupDataWithAutoTopupPromise=this.topupDataWithAutoTopupDefered.promise(),this.customerProductsPromise=this.callCustomerProducts(),this.customerContactPersonsPromise=this.callCustomerContactPersons(),this.logicalDatePromice=this.callUtilityLogicalDate();var a=$.when(this.topupDataWithAutoTopupPromise,this.customerProductsPromise,this.customerContactPersonsPromise,this.logicalDatePromice);return a.done(this._mapData),a.fail(this._throwError),a},callPrepaidBuckets:function(){return this.subViewModels.subscriptionsPrepaidBucketsViewModel.loadData()},callCustomerContactPersons:function(){return this.subViewModels.customerContactPersonsViewModel.loadData()},callCustomerProducts:function(){return this.subViewModels.customerProductsViewModel.lazyLoadData(this.get("customerId"),this.get("locale"),this.get("salesChannel"))},callUtilityLogicalDate:function(){return this.subViewModels.logicalDateUtilityViewModel.loadData()},_initializeCollection:function(){this.balances=null,this.balances=this.create("care_prepaidBalance_Collection",b.Core.Collection.extend({model:b.Core.Model.extend({idAttribute:"id"})})),this.popupBalances=null,this.popupBalances=this.create("care_prepaidBalance_popupCollection",b.Core.Collection.extend({model:b.Core.Model.extend({idAttribute:"id"})})),this.subViewModels.balancesList=this.create("care_prepaidBalance_CollectionViewModel",b.CollectionViewModel,{models:{items:this.balances}}),this.subViewModels.balancesList.on("items:selected",this._balanceSelectionHandler,this),this.subViewModels.balancesPopupList=this.create("care_prepaidBalance_CollectionViewModel_popup",b.CollectionViewModel,{models:{items:this.popupBalances}}),this.subViewModels.balancesPopupList.on("items:selected",this._balanceTopupPopupHandler,this),this.subViewModels.viewAllButtonViewModel=this.create("care_prepaidBalance_viewAll_ViewModel",b.Core.ViewModel,{config:{label:this.getString("care_prepaid_balance_widget_more_details"),actions:{click:this._viewAllBalancesActionHandler}}})},_fetchAutoTopData:function(){var a=this._getFilteredBalances();this.set("filteredBalances",a);for(var b,c=0;c<a.length;c++){var d=a[c],e=this._createSubscriberPrepaidBucketAutoTopUpViewModel(d.id),f=this.callSubscriberPrepaidBucketAutoTopUp(e);this._populateAutotopupData(e,f,d),b||(b={}),b=$.when(b,f)}b?b.done(this._autoTopupDataReady):this.topupDataWithAutoTopupDefered.resolve()},_getFilteredBalances:function(a){this.set("showMoreLink",!1);var a=this.subViewModels.subscriptionsPrepaidBucketsViewModel.get("balancesData");return a?a.length>this.get("noOfBalances")?(this.subViewModels.viewAllButtonViewModel=this.create("care_prepaidBalance_viewAll_ViewModel",b.Core.ViewModel,{config:{label:this.getString("care_prepaid_balance_widget_more_details"),actions:{click:this._viewAllBalancesActionHandler}}}),this.set("showMoreLink",!0),this._getSortedBalances(a).slice(0,this.get("noOfBalances"))):(this.set("showMoreLink",!1),this._getSortedBalances(a)):[]},_createSubscriberPrepaidBucketAutoTopUpViewModel:function(a){return this.create("care_prepaidBalance_PrepaidBucketAutoTopupViewModel",e,{data:{pcnId:a}})},callSubscriberPrepaidBucketAutoTopUp:function(a){return a.loadData()},_populateAutotopupData:function(a,b,c){b.done(function(){c.autoTopupData=a.get("autoTopupData")})},_autoTopupDataReady:function(){this.topupDataWithAutoTopupDefered.resolve()},_initializeSubViewModels:function(){this.subViewModels.subscriptionsPrepaidBucketsViewModel=this.create("care_prepaidBalance_SubscriptionsPrepaidBucketsViewModel",d,{data:{customerId:this.get("customerId"),subscriptionIds:this.get("subscriptionId")}}),this.subViewModels.customerProductsViewModel=this.create("care_prepaidBalance_CustomerProductsViewModel",f,{data:{customerId:this.get("customerId")}}),this.subViewModels.customerContactPersonsViewModel=this.create("care_prepaidBalance_CustomerContactPersonsViewModel",g,{data:{customerId:this.get("customerId")}}),this.subViewModels.logicalDateUtilityViewModel=this.subViewModels.logicalDateUtilityViewModel||this.create("care_prepaidBalance_LogicalDateUtilityViewModel",h)},_mapData:function(){var a=this.get("filteredBalances");console.log(a);var b=this._getWirelessProductCount();return 0==this._getPrepaidProductCount()?(this.trigger("action:noPrepaidError","No prepaid subscription"),void console.log("No prepaid subscription")):0==b?(this.trigger("action:noWirelessError","No wireless subscription"),void console.log("No wireless subscription")):void(a.length>0?(this._mapBalancesData(a,!1),this._mapBalancesData(this.subViewModels.subscriptionsPrepaidBucketsViewModel.get("balancesData"),!0),this.balances.length>0&&this.trigger("prepaidBalancesAvailable")):this.trigger("action:noBalances"))},_calculateRemainingDays:function(a){var b=this.subViewModels.logicalDateUtilityViewModel.getDate(),c=a.balanceExpiryDate-b;return Math.ceil(c/864e5)},_updateAutoTopupDetails:function(a){var b=this.subViewModels.logicalDateUtilityViewModel.getDate();a.autoTopupData&&(a.autoTopupData.noOfDays=c.getNumberOfDaysForTopUp(b,a.autoTopupData.intervalSize,a.autoTopupData.frequency,a.autoTopupData.startDate),a.autoTopupData.nextAutoTopUpDate=c.getNextAutoTopUpDate(b,a.autoTopupData.intervalSize,a.autoTopupData.frequency,a.autoTopupData.startDate))},_findProduct:function(a){for(var b=this.subViewModels.customerProductsViewModel.get("customerProductsData"),c=0;c<b.length;c++){var d=b[c];if(void 0!=d.subscriptionId&&d.subscriptionId==a||void 0==a&&d.shared)return d}},_getWirelessProductCount:function(){var a=this.subViewModels.customerProductsViewModel.get("customerProductsData");return a?a.length:0},_getPrepaidProductCount:function(){for(var a=this.subViewModels.customerProductsViewModel.get("customerProductsData"),b=0,c=0;c<a.length;c++)"PREPAID"===a[c].paymentCategory&&b++;return b},_findContact:function(a){for(var b=this.subViewModels.customerContactPersonsViewModel.get("contactPersons"),c=0;c<b.length;c++){var d=b[c];if(d.personID==a)return d}},_throwError:function(a){this.trigger("error",a)},_getSortedBalances:function(a){return a.sort(this._balanceComparator)},_balanceComparator:function(a,b){var c;switch(this.get("sort")){case"lowest_first":c=a.balanceAmount-b.balanceAmount;break;case"highest_first":c=b.balanceAmount-a.balanceAmount;break;case"expires":c=a.balanceExpiryDate-b.balanceExpiryDate;break;default:c=this.customAttributeComparator(a,b)}return c},customAttributeComparator:function(a,b){return 0},_balanceSelectionHandler:function(a){var b=this.balances.get(a.itemId).get();this.set("selectedBalance",b),this.trigger("action:ViewSelectedBalance ",b)},_balanceTopupHandler:function(a){this.set("selectedBalance",a),this.trigger("action:Topup",a)},_viewAllBalancesActionHandler:function(a){this.trigger("action:ViewAllBalances",a)},_viewMoreDetailsActionHandler:function(a){this.trigger("action:MoreDetails",a)},_balanceTopupPopupHandler:function(a){var b=this.popupBalances.get(a.itemId).get();this.set("selectedBalance",b),this.trigger("closeTopupPopup"),this.trigger("action:Topup",b)},_mapBalancesData:function(a,b){console.log(a);var c,d=!1,e=!1;if(a.length>0){c=a[0].subscriptionID;for(var f=0;f<a.length;f++){var g=a[f];this._updateAutoTopupDetails(g);var h=this._findProduct(g.subscriptionID);if(g.product=h,h){var i=this._findContact(h.personId);g.contact=i}g.noOfDaysToExpire=this._calculateRemainingDays(g),g.noOfDaysToExpireMessageThreshold=this.get("noOfDaysToExpire"),g.nextAutoTopupDaysMessageThreshold=this.get("nextAutoTopupDays"),g.showContactName=this.get("showContactName"),this.get("subscriptionId")===g.subscriptionID?g.hideSubscriberDetails=!0:g.hideSubscriberDetails=d,void 0!==g.subscriptionID&&c!==g.subscriptionID&&(e=!0),g.showSubscriberDetails=e}for(var j={},f=0;f<a.length;f++){var g=a[f];if(g.contact){j[g.contact.personId]||(j[g.contact.personId]={});var k=j[g.contact.personId];if(k[g.name]){var l=k[g.name];l.push(g);for(var m=0;m<l.length;m++)l[m].showContactName=!1}else k[g.name]=[],k[g.name].push(g)}}b?this.popupBalances.add(a):this.balances.add(a)}}}),j=i.extend({}),k={path:"businesswidget/repository/common/viewmodel/PrepaidBalanceWidgetViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"PrepaidBalanceWidgetViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"Util",pathName:"businesswidget/repository/common/util/Util"},{variable:"SubscriptionsPrepaidBucketsViewModel",pathName:"businesswidget/repository/common/viewmodel/SubscriptionsPrepaidBucketsViewModel"},{variable:"PrepaidBucketAutoTopupViewModel",pathName:"businesswidget/repository/common/viewmodel/PrepaidBucketAutoTopupViewModel"},{variable:"CustomerProductsViewModel",pathName:"businesswidget/repository/common/viewmodel/CustomerProductsViewModel"},{variable:"CustomerContactPersonsViewModel",pathName:"businesswidget/repository/common/viewmodel/CustomerContactPersonsViewModel"},{variable:"LogicalDateUtilityViewModel",pathName:"businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"Initialize models",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},callPrepaidBuckets:{name:"callPrepaidBuckets",privacyLevel:"protected",isEventTriggered:!1,desc:"loads the data of subscriptionsPrepaidBucketsViewModel",isChangeEventTriggered:!1},callCustomerContactPersons:{name:"callCustomerContactPersons",privacyLevel:"protected",isEventTriggered:!1,desc:"loads the data of customerContactPersonsViewModel",isChangeEventTriggered:!1},callCustomerProducts:{name:"callCustomerProducts",privacyLevel:"protected",isEventTriggered:!1,desc:"loads the data of customerProductsViewModel",isChangeEventTriggered:!1},callUtilityLogicalDate:{name:"callUtilityLogicalDate",privacyLevel:"protected",isEventTriggered:!1,desc:"loads the data of customerProductsViewModel",isChangeEventTriggered:!1},_initializeCollection:{name:"_initializeCollection",privacyLevel:"protected",isEventTriggered:!1,desc:"Initialize the balances collection",isChangeEventTriggered:!1},_fetchAutoTopData:{name:"_fetchAutoTopData",privacyLevel:"protected",isEventTriggered:!1,desc:"fetch the autotopup data for each balance",isChangeEventTriggered:!1},_getFilteredBalances:{name:"_getFilteredBalances",privacyLevel:"protected",isEventTriggered:!1,desc:"it returns top 'noOfBalances' balances ",isChangeEventTriggered:!1},_createSubscriberPrepaidBucketAutoTopUpViewModel:{name:"_createSubscriberPrepaidBucketAutoTopUpViewModel",privacyLevel:"protected",isEventTriggered:!1,desc:"Init the viewmodel SubscriberPrepaidBucketAutoTopUpViewModel",isChangeEventTriggered:!1},callSubscriberPrepaidBucketAutoTopUp:{name:"callSubscriberPrepaidBucketAutoTopUp",privacyLevel:"protected",isEventTriggered:!1,desc:"fetch the autotopup data",isChangeEventTriggered:!1},_populateAutotopupData:{name:"_populateAutotopupData",privacyLevel:"protected",isEventTriggered:!1,desc:"set the autotopup data on balance",isChangeEventTriggered:!1},_autoTopupDataReady:{name:"_autoTopupDataReady",privacyLevel:"protected",isEventTriggered:!1,desc:"it resolves the autotopup promise",isChangeEventTriggered:!1},_initializeSubViewModels:{name:"_initializeSubViewModels",privacyLevel:"protected",isEventTriggered:!1,desc:"Initializes all subviewmodels",isChangeEventTriggered:!1},_mapData:{name:"_mapData",privacyLevel:"protected",isEventTriggered:!1,desc:"populate the balances data",isChangeEventTriggered:!1},_calculateRemainingDays:{name:"_calculateRemainingDays",privacyLevel:"protected",isEventTriggered:!1,desc:"calculates the remaining days",isChangeEventTriggered:!1},_updateAutoTopupDetails:{name:"_updateAutoTopupDetails",privacyLevel:"protected",isEventTriggered:!1,desc:"updates the noOfDays and nextAutoTopUpDate on autotopup data",isChangeEventTriggered:!1},_findProduct:{name:"_findProduct",privacyLevel:"protected",isEventTriggered:!1,desc:"find the matching product ",isChangeEventTriggered:!1},_getWirelessProductCount:{name:"_getWirelessProductCount",privacyLevel:"protected",isEventTriggered:!1,desc:"return the WirelessProductCount",isChangeEventTriggered:!1},_getPrepaidProductCount:{name:"_getPrepaidProductCount",privacyLevel:"protected",isEventTriggered:!1,desc:"returns the PrepaidProductCount",isChangeEventTriggered:!1},_findContact:{name:"_findContact",privacyLevel:"protected",isEventTriggered:!1,desc:"find matching contact by personid",isChangeEventTriggered:!1},_throwError:{name:"_throwError",privacyLevel:"protected",isEventTriggered:!1,desc:"error handler for andd REST error",isChangeEventTriggered:!1},_getSortedBalances:{name:"_getSortedBalances",privacyLevel:"protected",isEventTriggered:!1,desc:"returns sorted balances",isChangeEventTriggered:!1},_balanceComparator:{name:"_balanceComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"Comparator for sorting balances",isChangeEventTriggered:!1},customAttributeComparator:{name:"customAttributeComparator",privacyLevel:"protected",isEventTriggered:!1,desc:"customization hook",isChangeEventTriggered:!1},_balanceSelectionHandler:{name:"_balanceSelectionHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"balance Selection Handler",isChangeEventTriggered:!1},_balanceTopupHandler:{name:"_balanceTopupHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"balance Topup Handler",isChangeEventTriggered:!1},_viewAllBalancesActionHandler:{name:"_viewAllBalancesActionHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"view All Balances Action Handler",isChangeEventTriggered:!1},_viewMoreDetailsActionHandler:{name:"_viewMoreDetailsActionHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"view More Details Action Handler",isChangeEventTriggered:!1},_balanceTopupPopupHandler:{name:"_balanceTopupPopupHandler",privacyLevel:"protected",isEventTriggered:!1,desc:"Topup Mobile Handler",isChangeEventTriggered:!1},_mapBalancesData:{name:"_mapDataForTopupPoup",privacyLevel:"protected",isEventTriggered:!1,desc:"Maps balances data topup popup",isChangeEventTriggered:!1}}};return j.prototype.getMetaData=function(){return k},j});
define("businesswidget/repository/common/model/CustomerAccountsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/customer/customer/:customerId/customer-accounts",rest:{defaults:{qParams:{lo:c.get("locale")}},read:{url:"/customer/customer/:customerId/customer-accounts"}}}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/CustomerAccountsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerAccountsModel",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"/customer/customer/:customerId/customer-accounts"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"sc",value:"Configuration.get('salesChannel')"},{key:"lo",value:"Configuration.get('locale')"}],isJSON:!0}},read:{url:{value:"/customer/customer/:customerId/customer-accounts"}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/CustomerAccountsViewModel",["underscore","lightsaber","businesswidget/repository/common/model/CustomerAccountsModel"],function (a,b,c){var d=b.Core.ViewModel.extend({models:{customerAccountsModel:new c},initialize:function(b){a.bindAll(this,"loadData","_initCustomerAccountsModel","_setCustomerAccountDataOnSuccess","_setCustomerAccountDataOnFailure","getAccountId"),this.router=b.router,this._initCustomerAccountsModel()},_initCustomerAccountsModel:function(a,b,d){this.models.customerAccountsModel=this.create("lineOfBusinessModel_customerAccountsModel",c)},loadData:function(a){var b=this,c=new $.Deferred;return this.models.customerAccountsModel.set({customerId:a}),this.models.customerAccountsModel.fetch({success:function(a,d){b._setCustomerAccountDataOnSuccess(a,d),c.resolve()},error:this._setCustomerAccountDataOnFailure}),c.promise()},_setCustomerAccountDataOnSuccess:function(a,b,c){this.set("accountID",b.Accounts.accounts[0].id),this.trigger("customerAccountDataLoaded")},_setCustomerAccountDataOnFailure:function(a,b,c){this.trigger("lobDetailDataLoaded:error")},getAccountId:function(){this.get("accountId")}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/CustomerAccountsViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerAccountsViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"CustomerAccountsModel",pathName:"businesswidget/repository/common/model/CustomerAccountsModel"}],models:{customerAccountsModel:{name:"customerAccountsModel",type:"code",code:"new CustomerAccountsModel()",description:""}},viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_initCustomerAccountsModel:{name:"_initCustomerAccountsModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setCustomerAccountDataOnSuccess:{name:"_setCustomerAccountDataOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setCustomerAccountDataOnFailure:{name:"_setCustomerAccountDataOnFailure",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getAccountId:{name:"getAccountId",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/AccountBalanceSummaryModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"billingcare/customer-account/:accountId/balance-summary",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},read:{url:"billingcare/customer-account/:accountId/balance-summary"}}}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/AccountBalanceSummaryModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"AccountBalanceSummaryModel",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"billingcare/customer-account/:accountId/balance-summary"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}},read:{url:{value:"billingcare/customer-account/:accountId/balance-summary"}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/AccountBalanceSummaryViewModel",["underscore","lightsaber","businesswidget/repository/common/model/AccountBalanceSummaryModel"],function (a,b,c){var d=b.Core.ViewModel.extend({_initModels:function(){this.models.accountBalanceSummaryModel=this.create("accountBalanceSummaryModel_AccountBalanceSummaryModel",c)},_accountBalanceSummaryOnSuccess:function(a,b,c){this._prepareResponse(a,b,c)},initialize:function(b){a.bindAll(this,"lazyLoadData","_accountBalanceSummaryOnSuccess","_accountBalanceSummaryOnFailure","_prepareModel","_prepareResponse"),this._initModels()},_accountBalanceSummaryOnFailure:function(a,b,c){this.set("balanceSummaryDataAvailable",!1)},_prepareModel:function(a){this.models.accountBalanceSummaryModel.set({accountId:a})},_prepareResponse:function(a,b,c){var d=b.BalanceSummary;d?(this.set("balanceSummaryDataAvailable",!0),this.set("balanceSummaryData",d)):this.set("balanceSummaryDataAvailable",!1)},lazyLoadData:function(a){return this._prepareModel(a),this.models.accountBalanceSummaryModel.fetch({success:this._accountBalanceSummaryOnSuccess,error:this._accountBalanceSummaryOnFailure})}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/AccountBalanceSummaryViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"AccountBalanceSummaryViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"AccountBalanceSummaryModel",pathName:"businesswidget/repository/common/model/AccountBalanceSummaryModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{_initModels:{name:"_initModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_accountBalanceSummaryOnSuccess:{name:"_accountBalanceSummaryOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_accountBalanceSummaryOnFailure:{name:"_accountBalanceSummaryOnFailure",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_prepareModel:{name:"_prepareModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_prepareResponse:{name:"_prepareResponse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},lazyLoadData:{name:"lazyLoadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerBillAutoPaymentModel",["underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"ebill/billing-arrangement/:billingArrangementId/bill-auto-payment",rest:{defaults:{qParams:{lo:b.get("locale"),sc:b.get("salesChannel")},payload:["AutoPaymentDetails"]},read:{method:"GET"},create:{method:"POST",contentType:"application/json"},"delete":{method:"DELETE",url:"ebill/billing-arrangement/:billingArrangementId/bill-auto-payment"}}}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/CustomerBillAutoPaymentModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerBillAutoPaymentModel",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"Configuration"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"ebill/billing-arrangement/:billingArrangementId/bill-auto-payment"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0},payload:{value:["AutoPaymentDetails"]}},read:{url:{value:"ebill/billing-arrangement/:billingArrangementId/bill-auto-payment"}}}},validations:[],methods:{},description:"",replaced:!1,fixturesPath:"businesswidget/repository/common/model/CustomerBillAutoPaymentModel_fixtures.js"};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/CustomerBillAutoPaymentInfoViewModel",["underscore","lightsaber","businesswidget/repository/common/model/CustomerBillAutoPaymentModel"],function (a,b,c){var d=b.Core.ViewModel.extend({_initModels:function(){this.models.customerBillAutoPaymentModel=this.create("customerBillAutoPaymentModel_CustomerBillAutoPaymentModel",c)},initialize:function(b){a.bindAll(this,"loadData","_setBillAutoPaymentOnSuccess","_setBillAutoPaymentOnError"),this._initModels()},loadData:function(a,b){return this.models.customerBillAutoPaymentModel.set({billingArrangementId:a}),this.models.customerBillAutoPaymentModel.fetch({success:this._setBillAutoPaymentOnSuccess,error:this._setBillAutoPaymentOnError})},_setBillAutoPaymentOnSuccess:function(a,b,c){var d=b.AutoPayment;this.set("autoPayMentData",d),this.trigger("autoPayMentDataReady")},_setBillAutoPaymentOnError:function(){},isAutoPayEnabled:function(){return!a.isUndefined(this.get("autoPayMentData"))&&!a.isEmpty(this.get("autoPayMentData"))}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/CustomerBillAutoPaymentInfoViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerBillAutoPaymentInfoViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"CustomerBillAutoPaymentModel",pathName:"businesswidget/repository/common/model/CustomerBillAutoPaymentModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{_initModels:{name:"_initModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setBillAutoPaymentOnSuccess:{name:"_setBillAutoPaymentOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_setBillAutoPaymentOnError:{name:"_setBillAutoPaymentOnError",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},isAutoPayEnabled:{name:"isAutoPayEnabled",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerContactPersonPayMeansModel",["underscore","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"customer/customer/:custId/individual/:personID/pay-means",rest:{defaults:{payload:["PayMeanDetails"],url:"customer/customer/:custId/individual/:personID/pay-means"},read:{method:"GET"},create:{method:"POST",contentType:"application/json"}}}}),d=c.extend({}),e={path:"businesswidget/repository/common/model/CustomerContactPersonPayMeansModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerContactPersonPayMeansModel",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/customer/:custId/individual/:personID/pay-means"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{payload:{value:["PayMeanDetails"]},url:{value:"customer/customer/:custId/individual/:personID/pay-means"}}}},validations:[],methods:{},description:"",replaced:!1,fixturesPath:"businesswidget/repository/common/model/CustomerContactPersonPayMeansModel_fixtures.js"};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/PayMeansInfoViewModel",["underscore","lightsaber","businesswidget/repository/common/model/CustomerContactPersonPayMeansModel"],function (a,b,c){var d=b.Core.ViewModel.extend({initialize:function(b){a.bindAll(this,"lazyLoadData","_contactPersonPayMeansOnSuccess","_contactPersonPayMeansOnError","_prepareModel","_prepareResponse"),this._initModels()},_initModels:function(){this.models.customerContactPersonPayMeansModel=this.create("customerContactPersonPayMeansModel_CustomerContactPersonPayMeansModel",c)},_contactPersonPayMeansOnSuccess:function(a,b,c){this._prepareResponse(a,b,c)},_contactPersonPayMeansOnError:function(a,b,c){},isSingleCardPayMean:function(){return!(!this.get("payMeansResponseData")||!this.get("payMeansResponseData").card||1!==this.get("payMeansResponseData").card.length)},getPayMeansResponse:function(){return this.get("payMeansResponseData")},_prepareModel:function(a,b){this.models.customerContactPersonPayMeansModel.set({custId:a,personID:b})},_prepareResponse:function(a,b,c){var d=b.PayMeans;this.set("payMeansResponseData",d)},lazyLoadData:function(a,b){return this._prepareModel(a,b),this.models.customerContactPersonPayMeansModel.fetch({success:this._contactPersonPayMeansOnSuccess,error:this._contactPersonPayMeansOnError})}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/PayMeansInfoViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"PayMeansInfoViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"CustomerContactPersonPayMeansModel",pathName:"businesswidget/repository/common/model/CustomerContactPersonPayMeansModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_initModels:{name:"_initModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_contactPersonPayMeansOnSuccess:{name:"_contactPersonPayMeansOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_contactPersonPayMeansOnError:{name:"_contactPersonPayMeansOnError",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},isSingleCardPayMean:{name:"isSingleCardPayMean",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getPayMeansResponse:{name:"getPayMeansResponse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_prepareModel:{name:"_prepareModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_prepareResponse:{name:"_prepareResponse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},lazyLoadData:{name:"lazyLoadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerAccountBillingArrangementsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"customer/customer/:customerId/customer-account/:accountId/customer-bill-specs",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},read:{url:"customer/customer/:customerId/customer-account/:accountId/customer-bill-specs"}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerAccountBillingArrangementsModel",path:"businesswidget/repository/common/model/CustomerAccountBillingArrangementsModel.js",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/customer/:customerId/customer-account/:accountId/customer-bill-specs"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:"Configuration.get('locale')"},{key:"sc",value:"Configuration.get('salesChannel')"}],isJSON:!0}},read:{url:{value:"customer/customer/:customerId/customer-account/:accountId/customer-bill-specs"}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/AccountBillingArrangementsViewModel",["underscore","lightsaber","businesswidget/repository/common/model/CustomerAccountBillingArrangementsModel"],function (a,b,c){var d=b.Core.ViewModel.extend({initialize:function(){a.bindAll(this,"_accountBillingArrangementsOnSuccess","_accountBillingArrangementsOnSuccessLazy","_accountBillingArrangementsOnError"),this._initModels()},_initModels:function(){this.models.customerAccountBillingArrangementsModel=this.create("customerAccountBillingArrangementsModel_CustomerAccountBillingArrangementsModel",c)},_prepareModel:function(a,b){this.models.customerAccountBillingArrangementsModel.set({customerId:a,accountId:b})},lazyLoadData:function(a,b){return this._prepareModel(a,b),this.models.customerAccountBillingArrangementsModel.fetch({success:this._accountBillingArrangementsOnSuccessLazy,error:this._accountBillingArrangementsOnError})},_accountBillingArrangementsOnSuccess:function(a,b,c){this._prepareResponse(b),this.trigger("customerBillingArrDataLoaded")},_accountBillingArrangementsOnError:function(a,b,c){this.set("customerBillingArrDataAvailable",!1)},loadData:function(a,b){return this._prepareModel(a,b),this.models.customerAccountBillingArrangementsModel.fetch({success:this._accountBillingArrangementsOnSuccess,error:this._accountBillingArrangementsOnError})},_accountBillingArrangementsOnSuccessLazy:function(a,b,c){this._prepareResponse(b)},_prepareResponse:function(a){a.BillingArrangements&&a.BillingArrangements.billingArrangements?(this.set("customerBillingArrDataAvailable",!0),this.set("billingArrangementID",a.BillingArrangements.billingArrangements[0].id)):this.set("customerBillingArrDataAvailable",!1)}}),e=d.extend({}),f={path:"businesswidget/repository/common/viewmodel/AccountBillingArrangementsViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"AccountBillingArrangementsViewModel",savePath:"businesswidget/repository/common/viewmodel","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"CustomerAccountBillingArrangementsModel",pathName:"businesswidget/repository/common/model/CustomerAccountBillingArrangementsModel"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_initModels:{name:"_initModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_prepareModel:{name:"_prepareModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},lazyLoadData:{name:"lazyLoadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_accountBillingArrangementsOnSuccess:{name:"_accountBillingArrangementsOnSuccess",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_accountBillingArrangementsOnError:{name:"_accountBillingArrangementsOnError",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},loadData:{name:"loadData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_accountBillingArrangementsOnSuccessLazy:{name:"_accountBillingArrangementsOnSuccessLazy",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_prepareResponse:{name:"_prepareResponse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/BillingEntityBillsModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({options:{rest:{defaults:{qParams:{locale:d.get("locale"),salesChannel:d.get("salesChannel"),numOfCycles:d.get("NumBillingCycles")}}},url:"billingcare/customer/:customerId/customer-bill-spec/:customerBillSpecId/bills"}});return e.idAttribute="title",e});
define("businesswidget/repository/common/viewmodel/BillsInfoViewModel",["underscore","lightsaber","businesswidget/repository/common/model/BillingEntityBillsModel"],function (a,b,c){var d=b.Core.ViewModel.extend({_initModels:function(){this.models.billingEntityBillsModel=this.create("billInfoViewModel_BillingEntityBillsModel",c)},loadData:function(a,b,c){return this.models.billingEntityBillsModel.setQueryParams({numOfCycles:c}),this.models.billingEntityBillsModel.set({customerBillSpecId:b,customerId:a}),this.models.billingEntityBillsModel.fetch({success:this._billingEntityBillsDataOnSuccess,error:this._billingEntityBillsDataOnError})},_billingEntityBillsDataOnSuccess:function(a,b,c){b.Bills&&b.Bills.bills&&b.Bills.bills.length>0?(this.set("billsInfoDataAvailable",!0),this.set("billsInfoData",b.Bills.bills)):this.set("billsInfoDataAvailable",!1),this.trigger("billsInfoDataReady")},_billingEntityBillsDataOnError:function(a,b,c){},initialize:function(b){a.bindAll(this,"_billingEntityBillsDataOnSuccess","_billingEntityBillsDataOnError"),this._initModels()}}),e=d.extend({});return e.prototype.getMetaData=function(){return metaData},e});
define("businesswidget/repository/common/viewmodel/PostPaidBalanceWidgetViewModel",["underscore","lightsaber","businesswidget/repository/common/viewmodel/CustomerAccountsViewModel","businesswidget/repository/common/viewmodel/AccountBalanceSummaryViewModel","businesswidget/repository/common/viewmodel/CustomerBillAutoPaymentInfoViewModel","businesswidget/repository/common/viewmodel/PayMeansInfoViewModel","businesswidget/repository/common/viewmodel/LogicalDateUtilityViewModel","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/AccountBillingArrangementsViewModel","businesswidget/repository/common/viewmodel/BillsInfoViewModel"],function (a,b,c,d,e,f,g,h,i,j){return b.Core.ViewModel.extend({defaults:{accountID:null,customerID:null,presentCardOnPayButton:!0,personID:null,billingArrangementID:null},initSubViewModels:function(){this.subViewModels.customerAccountsViewModel=this.create("customerAccountsViewModel_CustomerAccountsViewModel",c),this.subViewModels.accountBalanceSummaryViewModel=this.create("accountBalanceSummaryViewModel_AccountBalanceSummaryViewModel",d),this.subViewModels.customerAccountsViewModel.on("customerAccountDataLoaded",this.setCustomerAccount,this),this.subViewModels.customerBillAutoPaymentInfoViewModel=this.create("customerBillAutoPaymentInfoViewModel_CustomerBillAutoPaymentInfoViewModel",e),this.subViewModels.payMeansInfoViewModel=this.create("payMeansInfoViewModel_PayMeansInfoViewModell",f),this.subViewModels.logicalDateUtilityViewModel=this.create("logicalDateUtilityViewModel_LogicalDateUtilityViewModel",g),this.subViewModels.accountBillingArrangementsViewModel=this.create("accountBillingArrangementsViewModel_AccountBillingArrangementsViewModel",i),this.subViewModels.accountBillingArrangementsViewModel.on("customerBillingArrDataLoaded",this._setCustomerBillingArr),this.subViewModels.billsInfoViewModel=this.create("billsInfoViewModel_BillsInfoViewModel",j)},loadData:function(){null===this.get("accountID")?this.getCustomerAccount():(this.retrieveBillingArrInfo(),this.getBillAndBalanceInfo())},getCustomerAccount:function(){this.subViewModels.customerAccountsViewModel.loadData(this.get("customerID"))},initialize:function(b){a.bindAll(this,"preparePostPaidBalanceWidgetData","_payNowAction","_payOptionsAction","_autoPayAction","_autoPaySettingAction","publishBalanceDetailsSelectedEvent","_setCustomerBillingArr","_fillDataInPayBillEvent"),this.initSubViewModels(),this.set("billAndBalanceData",{}),this.rb=this.getResourceBundle()},setCustomerAccount:function(){this.set("accountID",this.subViewModels.customerAccountsViewModel.get("accountID")),this.retrieveBillingArrInfo()},getCustomerBalanceInfo:function(){return this.subViewModels.accountBalanceSummaryViewModel.lazyLoadData(this.get("accountID"))},getCustomerAutoPaymentInfo:function(){return this.subViewModels.customerBillAutoPaymentInfoViewModel.loadData(this.get("billingArrangementID"))},getCustomerPayMeans:function(){return this.subViewModels.payMeansInfoViewModel.lazyLoadData(this.get("customerID"),this.get("personID"))},getCurrentDate:function(){return this.subViewModels.logicalDateUtilityViewModel.loadData()},createPayNowActionVM:function(a){this.subViewModels.payNowActionVM=this.create("payNowButton_actionViewModel",b.ActionViewModel,{data:{label:this.getPayNowActionLabel()},config:{actions:{click:this._payNowAction}}})},_payNowAction:function(){this._fillDataInPayBillEvent(),this.subViewModels.payMeansInfoViewModel.isSingleCardPayMean()?this.handleAction("payBillWithCardSelected"):this.handleAction("payBillSelected")},_fillDataInPayBillEvent:function(){var a=this.subViewModels.accountBalanceSummaryViewModel.get("balanceSummaryData");if(this.set("customerBillSpecID",this.get("billingArrangementID")),this.set("customerAccountID",this.get("accountID")),this.set("totalDue",a.currentDue),this.subViewModels.billsInfoViewModel.get("billsInfoData")&&this.subViewModels.billsInfoViewModel.get("billsInfoData").length>0)var b=this.subViewModels.billsInfoViewModel.get("billsInfoData")[0];
this.set("billID",b.billNumber),this.set("billDueDate",b.paymentDueDate)},_createAutoPayActionVM:function(){this.subViewModels.autoPayActionVM=this.create("autoPayActionVM_ActionViewModel",b.ActionViewModel,{data:{label:this.getString("care_billAndBalanceWidget_setUpAutoPay")},config:{actions:{click:this._autoPayAction}}})},_createAutoPaySettingVM:function(){this.subViewModels.autoPaySettingActionVM=this.create("autoPaySettingActionVM_ActionViewModel",b.ActionViewModel,{data:{label:this.getString("care_billAndBalanceWidget_autoPaySettings")},config:{actions:{click:this._autoPaySettingAction}}})},_payOptionsAction:function(){this.handleAction("paymentSettingsSelected")},_autoPayAction:function(){this.handleAction("setAutoPay")},_autoPaySettingAction:function(){this.handleAction("autoPaySettingsSelected")},_createPayOptionsActionVM:function(){this.subViewModels.payOptionsActionVM=this.create("payOptionsActionVM_ActionViewModell",b.ActionViewModel,{data:{label:this.getString("care_billAndBalanceWidget_paymentOptions")},config:{actions:{click:this._payOptionsAction}}})},createExtendedControlVM:function(){this._createPayOptionsActionVM(),this._createAutoPayActionVM(),this._createAutoPaySettingVM()},getPayNowActionLabel:function(){var a=this.getString("care_billAndBalanceWidget_pay_now");if(this.get("presentCardOnPayButton")&&this.subViewModels.payMeansInfoViewModel.isSingleCardPayMean()){var b=this.subViewModels.payMeansInfoViewModel.getPayMeansResponse(),c=b.card[0].lastFourDigits;a=this.get("billAndBalanceData").autoPayDataAvailable?this.getString("care_billAndBalanceWidget_payNowWithCard",[c]):this.getString("care_billAndBalanceWidget_payWithCard",[c])}return a},publishBalanceDetailsSelectedEvent:function(){this.handleAction("viewBalanceDetails")},getCustomerBillingArrangements:function(){this.subViewModels.accountBillingArrangementsViewModel.loadData(this.get("customerID"),this.get("accountID"))},_setCustomerBillingArr:function(){this.set("billingArrangementID",this.subViewModels.accountBillingArrangementsViewModel.get("billingArrangementID")),this.getBalanceInfo()},getBalanceInfo:function(){var a=this;$.when(this.getCustomerBalanceInfo(),this.getCurrentDate()).then(function(){a.parseBalanceData()})},parseBalanceData:function(){var a=this;if(this.subViewModels.accountBalanceSummaryViewModel.get("balanceSummaryDataAvailable")){var b=this.subViewModels.accountBalanceSummaryViewModel.get("balanceSummaryData");this.get("billAndBalanceData").balanceSummaryDataAvailable=!0,this.get("billAndBalanceData").balanceSummaryData={},this.get("billAndBalanceData").asOfDate=this.subViewModels.logicalDateUtilityViewModel.getDate(),this.get("billAndBalanceData").formattedAsOfDate=h.getDateString(this.subViewModels.logicalDateUtilityViewModel.getDate(),!1,h.format.dayMonth),this.get("billAndBalanceData").balanceSummaryData.currentDue=b.currentDue,b.lastPaymentDate&&(this.get("billAndBalanceData").lastPaymentDataAvailable=!0,this.get("billAndBalanceData").lastPaymentData={},this.get("billAndBalanceData").lastPaymentData.lastPaymentAmount=b.lastPaymentAmount,this.get("billAndBalanceData").lastPaymentData.lastPaymentDate=b.lastPaymentDate,this.get("billAndBalanceData").lastPaymentData.formattedLastPaymentDate=h.getDateString(b.lastPaymentDate,!1,h.format.general)),b.currentDue<=0?(this.subViewModels.customerBillAutoPaymentInfoViewModel.off("autoPayMentDataReady",null,this),this.subViewModels.customerBillAutoPaymentInfoViewModel.on("autoPayMentDataReady",this.preparePostPaidBalanceWidgetData),this.getCustomerAutoPaymentInfo()):this.get("presentCardOnPayButton")?$.when(this.getCustomerAutoPaymentInfo(),this.getCustomerPayMeans()).then(function(){a.preparePostPaidBalanceWidgetData()}):(this.subViewModels.customerBillAutoPaymentInfoViewModel.off("autoPayMentDataReady",null,this),this.subViewModels.customerBillAutoPaymentInfoViewModel.on("autoPayMentDataReady",this.preparePostPaidBalanceWidgetData),this.getCustomerAutoPaymentInfo())}else this.get("billAndBalanceData").balanceSummaryDataAvailable=!1;if(this.subViewModels.billsInfoViewModel.get("billsInfoDataAvailable")){var c=this.subViewModels.billsInfoViewModel.get("billsInfoData")[0];this.get("billAndBalanceData").currency=c.currency,this.get("billAndBalanceData").lastBillDataAvailable=!0,this.get("billAndBalanceData").lastBillData={},this.get("billAndBalanceData").lastBillData.billAmount=c.billAmount,this.get("billAndBalanceData").lastBillData.formattedBillAmount=h.formatNumberString(c.billAmount),this.get("billAndBalanceData").lastBillData.lastBillMonthAndYear=h.getDateString(c.billStartDate,!1,h.format.monthNameYear),this.get("billAndBalanceData").lastBillData.paymentDueDate=c.paymentDueDate,this.get("billAndBalanceData").lastBillData.daysTillPaymentCount=this.getPayByDaysFromCurrentDate(c.paymentDueDate),this.get("billAndBalanceData").lastBillData.formattedPaymentDueDate=h.getDateString(c.paymentDueDate,!1,h.format.general),this.get("billAndBalanceData").lastBillData.payByText=this.getString("care_billAndBalanceWidget_payBy")+" "+this.get("billAndBalanceData").lastBillData.formattedPaymentDueDate;var d=this.showAlertForDaysTillPayment(this.get("billAndBalanceData").lastBillData.daysTillPaymentCount);this.get("billAndBalanceData").lastBillData.showAlertForDaysTillPayment=d,d&&(this.get("billAndBalanceData").lastBillData.daysTillPaymentText=this.getString("care_billAndBalanceWidget_daysTillPayment",[this.get("billAndBalanceData").lastBillData.daysTillPaymentCount]))}else this.get("billAndBalanceData").lastBillDataAvailable=!1;this.get("billAndBalanceData").showOriginalBill=this._isPartialPaymentDone()},retrieveBillingArrInfo:function(){null!==this.get("billingArrangementID")?this.getBalanceInfo():this.getCustomerBillingArrangements()},preparePostPaidBalanceWidgetData:function(){var b=this.subViewModels.customerBillAutoPaymentInfoViewModel.get("autoPayMentData");a.isEmpty(b)?this.get("billAndBalanceData").autoPayDataAvailable=!1:(this.get("billAndBalanceData").autoPayDataAvailable=!0,this.get("billAndBalanceData").autoPayData={},this.get("billAndBalanceData").autoPayData.nextBillGenerationDate=b.nextBillGenerationDate,this.get("billAndBalanceData").autoPayData.foramattedNextBillGenerationDate=h.getDateString(b.nextBillGenerationDate,!1,h.format.general)),this.trigger("postPaidBalanceWidgetDataLoaded")},getPayByDaysFromCurrentDate:function(a){var b=this.subViewModels.logicalDateUtilityViewModel.getDate(),c=new Date(b),d=new Date(a),e=d.getTime()-c.getTime();return e=Math.floor(e/864e5)},showAlertForDaysTillPayment:function(a){return a>0&&a<7},_isPartialPaymentDone:function(){return!(!this.get("billAndBalanceData").lastBillDataAvailable||!this.get("billAndBalanceData").balanceSummaryDataAvailable||this.get("billAndBalanceData").lastBillData.billAmount===this.get("billAndBalanceData").balanceSummaryData.currentDue)},getBillAndBalanceInfo:function(){var a=this;$.when(this.getCustomerBalanceInfo(),this.getCustomerBillsInfo(),this.getCurrentDate()).then(function(){a.parseBalanceData()})},getCustomerBillsInfo:function(){return this.subViewModels.billsInfoViewModel.loadData(this.get("customerID"),this.get("billingArrangementID"),this.getNumberOfCyclesForBill())},getNumberOfCyclesForBill:function(){return b.Core.Configuration.get("numberOfCyclesForBills")}}).extend({})});
define("businesswidget/repository/common/viewmodel/ItemListRelatedItemsTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["productSpecID","productOfferingID","productOfferingProductSpecID","relationID"],defaults:{productSpecID:null,productOfferingID:null,productOfferingProductSpecID:null,relationID:null}})});
define("businesswidget/repository/common/model/CommerceCustomerProductsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/commerce/customer/:customerID/products",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}})});
define("businesswidget/repository/common/model/CommerceCustomerSearchProductsConfigurationOptionsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/commerce/customer/:customerId/search-products-configuration-options",rest:{create:{method:"POST",contentType:"application/json",payload:["SearchProductsConfigurationOptionsRequest"]},defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}})});
define("businesswidget/repository/common/viewmodel/CustomerSubscriptionsSharedViewModel",["underscore","lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/model/CommerceCustomerProductsModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","businesswidget/repository/common/model/CommerceCustomerSearchProductsConfigurationOptionsModel"],function (a,b,c,d,e,f,g,h,i){return b.Core.ObservableViewModel.extend({models:{commerceCustomerProductsModel:f,searchProductsConfigurationOptionsModel:i},subViewModels:{customerInContextTopicVM:g,productConfigurationTopicViewModel:h},defaults:{customerId:null,assignedProductId:null,catalogItemId:null,bussinessType:null,BUSINESS_TYPE_INFO:{PACKAGE:"TV_PACKAGE",CHANNEL:"TV_CHANNEL",SERVICE:"SERVICE"},STATUS:{ACTIVE:"ACTIVE"},LOB:{TV:"TV"}},dataBindings:[{
customerId:"subViewModels.customerInContextTopicVM.ID",options:{twoWay:!0,setOnBind:!0}}],initialize:function(b){this._super(b),a.bindAll(this,"onCustomerProductsFetchSuccess","onCustomerProductsFetchError"),this.bindEvents()},bindEvents:function(){this.off("getCustomerProducts",null),this.on("AddService",this.handleAddService,this),this.on("AddChannelPackage",this.handleAddChannelPackage,this)},handleAddService:function(){this.clearCache(),this.get("selectedItem").item.businessType==this.get("BUSINESS_TYPE_INFO").SERVICE&&this.fetchSearchCompatibleSubscriptionOptions()},handleAddChannelPackage:function(){if(this.get("selectedItem").item.businessType==this.get("BUSINESS_TYPE_INFO").PACKAGE||this.get("selectedItem").item.businessType==this.get("BUSINESS_TYPE_INFO").CHANNEL)if(this.get("assignedProductId"))if(this.get("selectedItem").item.lob[0]==this.get("LOB").TV){var a=this.get("selectedItem");a.assignedProductId=this.get("assignedProductId"),this.handleAction("SingleSubscription",a)}else this.handleAction("NoSubscription");else this.fetchCustomerProducts()},getCommonQueryParams:function(){return{lo:this.get("locale")||d.get("defaultLocale"),sc:this.get("salesChannel")||d.get("salesChannel")}},getProductSpecIds:function(){return this.get("selectedItem").item.catalogItemID},getSearchProductsConfigurationOptionsRequest:function(){var a=[],b=[];return this.get("assignedProductId")&&a.push(this.get("assignedProductId")),b.push(this.getProductSpecIds()),searchProductsConfigurationOptionsRequest={productIDs:a,productSpecIDs:b}},fetchSearchCompatibleSubscriptionOptions:function(){var b=this.getCommonQueryParams(),c=this.get("customerId");return this.models.searchProductsConfigurationOptionsModel.setQueryParams(b),this.models.searchProductsConfigurationOptionsModel.set({customerId:c}),this.models.searchProductsConfigurationOptionsModel.save({SearchProductsConfigurationOptionsRequest:this.getSearchProductsConfigurationOptionsRequest()},{success:a.bind(this.onSearchCompatibleSubscriptionFetchSuccess,this),error:a.bind(this.onSearchCompatibleSubscriptionFetchError,this)})},onSearchCompatibleSubscriptionFetchSuccess:function(a,b,c){if(b.SearchProductsConfigurationOptionsResponse){var d=b.SearchProductsConfigurationOptionsResponse;if(!d.availableProdSpecForProdIDs)return void this.handleAction("NoSubscription");var e=this.get("selectedItem");0==d.availableProdSpecForProdIDs.length?this.handleAction("NoSubscription"):1==d.availableProdSpecForProdIDs.length?(e.assignedProductId=d.availableProdSpecForProdIDs[0].productId,this.handleAction("SingleSubscription",e)):d.availableProdSpecForProdIDs.length>1&&this.handleAction("selectSubscription",e)}},onSearchCompatibleSubscriptionFetchError:function(a,b,c){},fetchCustomerProducts:function(){var b=this.getCommonQueryParams(),c=this.get("customerId");return this.models.commerceCustomerProductsModel.setQueryParams(b),this.models.commerceCustomerProductsModel.set({customerID:c}),this.models.commerceCustomerProductsModel.fetch({success:a.bind(this.onCustomerProductsFetchSuccess,this),error:a.bind(this.onCustomerProductsFetchError,this)})},onCustomerProductsFetchSuccess:function(b,c,d){var e,f=0;if(c&&c.Products&&c.Products.products){var g=this;if(a.each(c.Products.products,function(a){a.lob===g.get("selectedItem").item.lob[0]&&"ACTIVE"==a.status&&(f++,e=a.id)}),this.get("selectedItem").item.businessType==this.get("BUSINESS_TYPE_INFO").PACKAGE||this.get("selectedItem").item.businessType==this.get("BUSINESS_TYPE_INFO").CHANNEL){var h=this.get("selectedItem");0==f?this.handleAction("NoSubscription"):1===f?(h.assignedProductId=e,this.handleAction("SingleSubscription",h)):f>1&&this.handleAction("SelectSubscription",h)}}},getPayload:function(b,c,d){var e={newSimpleProducts:[]},f=this;return"object"==typeof c?a.each(c,function(a){var c=f.getAddProductConfig(b,a,d);e.newSimpleProducts.push(c)}):e.newSimpleProducts.push(this.getAddProductConfig(b,c,d)),e},getAddProductConfig:function(a,b,c){return{simpleProductSpecID:b,temporaryID:this.getRequestRandomNumber(),businessType:c,parentProductID:a}},getRequestRandomNumber:function(){return e.generateTemporaryId()},onCustomerProductsFetchError:function(a,b,c){},clearCache:function(){this.subViewModels.productConfigurationTopicViewModel.set("productOrderItemID",void 0),this.subViewModels.productConfigurationTopicViewModel.set("productOrderItemRefNumber",void 0)}})});
define("businesswidget/repository/common/model/CustomerProductProductConfigurationModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product/:productId/configuration",rest:{create:{method:"PUT"},defaults:{payload:["UpdateProductConfigurationRequest"],qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/CustomerProductProductConfiguration.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductProductConfiguration",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product/:productId/configuration"},autoSnapshot:{value:"None"}},restDataSourceProperties:{create:{method:{value:"PUT",isDefault:!0,isMandatory:!0}},update:{payload:{value:["UpdateProductConfigurationRequest"]},qParams:{value:[{key:"local",value:'"Configuration.get(\'locale"'},{key:"sc",value:"\"Configuration.get('salesChannel')\""}],isJSON:!0}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){return a.extend({options:{rest:{"delete":{method:"DELETE",url:"commerce/customer/:customerId/product-order/:productOrderId/product-order-items"},read:{method:"GET"},defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}},url:"commerce/customer/:customerId/product-order/:productOrderId/product-order-items",id:"productOrderId"})});
define("businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product-order-item/:productOrderItemId/product-configuration",rest:{defaults:{qParams:{locale:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"PUT",payload:["UpdateProductInOrderConfigurationRequest"]},update:{payload:["UpdateProductInOrderConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductOrderItemProductConfigurationModel",path:"businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product-order-item/:productOrderItemId/product-configuration"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"locale",value:'Configuration.get("locale")'},{key:"sc",value:'Configuration.get("salesChannel")'}],isJSON:!0}},create:{method:{value:"PUT",isDefault:!0,isMandatory:!0},payload:{value:["UpdateProductInOrderConfigurationRequest"]}},update:{payload:{value:["UpdateProductInOrderConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel",["lightsaber"],function (a){var b=a.Core.ObservableViewModel.extend({persistent:["productOrderID","productOrderReferenceNumber","productOrderItems","missingConfigurationOrderActionIDs"],defaults:{productOrderID:null,productOrderReferenceNumber:null,productOrderItems:null,missingConfigurationOrderActionIDs:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductOrderTopicViewModel",path:"businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{productOrderID:{key:"productOrderID",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel",["lightsaber","underscore"],function (a,b){var c=a.Core.ObservableViewModel.extend({persistent:["locale","salesChannel"],defaults:{locale:null,salesChannel:null}}),d=c.extend({}),e={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ApplicationInContextTopicViewModel",path:"businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"_",pathName:"underscore"}],models:null,viewModels:null,dataBindings:null,defaults:{locale:{key:"locale",value:"null"},salesChannel:{key:"salesChannel",value:"null"}},methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/model/CustomerProductIdValidateProductConfigurationModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product/:productId/validate-configuration",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["ValidateProductConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductIdValidateProductConfigurationModel",path:"businesswidget/repository/common/model/CustomerProductIdValidateProductConfigurationModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product/:productId/validate-configuration"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"sc",value:"Configuration.get('salesChannel')"},{key:"locale",value:"Configuration.get('locale')"}],isJSON:!0}},read:{method:{value:"POST",isDefault:!0,isMandatory:!0},contentType:{value:"application/json"},payload:{value:["ValidateProductConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/OrderManagerSharedViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/utils/ImplUtil","Configuration","businesswidget/repository/common/model/CustomerProductProductConfigurationModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/viewmodel/ItemListTopicViewModel","single!businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel","businesswidget/repository/common/model/CustomerProductIdValidateProductConfigurationModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m){return b.Core.ObservableViewModel.extend({defaults:{flowData:{}},models:{customerProductProductConfigurationModel:e,customerProductOrderItemsModel:f,customerProductOrderItemProductConfigurationModel:g,customerProductIdValidateProductConfigurationModel:m},subViewModels:{itemListTopicVM:h,productOrderTopicViewModel:j,myProductsAndServicesWidgetViewModel:i,applicationInContextTopicViewModel:l,customerInContextTopicViewModel:k},initialize:function(){a.bindAll(this,"handleProductConfigurationSaveSuccess","handleProductConfigurationSaveError","onValidateProductConfigurationSuccess","onValidateProductConfigurationError","handleProductConfigurationSaveSuccessOnExistingOrder"),this.eventBinding()},eventBinding:function(){this.off("action:CreateChangeOrderActionForProduct",null),this.on("action:CreateChangeOrderActionForProduct",this.preCreateOrderCheckValidation,this)},preCreateOrderCheckValidation:function(){this.setRequiredData(),this.createOrderCheckValidation()},createOrUpdateOrder:function(){this.setRequiredData(),this.get("productOrderID")?this.updateOrder():this.createOrder()},createOrderCheckValidation:function(){var b=this.getCommonValidateConfiguration(),b=this.getPayload(b);this.models.customerProductIdValidateProductConfigurationModel.set({customerId:this.getCustomerId(),productId:this.getAssignedProductId()}),this.models.customerProductIdValidateProductConfigurationModel.set("ValidateProductConfigurationRequest",b),this.models.customerProductIdValidateProductConfigurationModel.fetch({success:a.bind(this.onValidateProductConfigurationSuccess,this),error:a.bind(this.onValidateProductConfigurationError,this)})},onValidateProductConfigurationSuccess:function(a,b){console.log("onValidateProductConfigurationSuccess"),b&&b.ValidateProductConfigurationResponse&&b.ValidateProductConfigurationResponse.errorMessage&&-1!==b.ValidateProductConfigurationResponse.errorMessage.indexOf(d.get("tvChannelPackageFlowExceedMaximumQuantity"))?this.handleAction("changeFailed"):this.createOrUpdateOrder()},onValidateProductConfigurationError:function(){console.log("onValidateProductConfigurationError")},createOrder:function(){var a=this.getCommonConfiguration();a=this.getPayload(a);var b={lo:this.getLocale(),sc:this.getSalesChannel()};return this.models.customerProductProductConfigurationModel.setQueryParams(b),this.models.customerProductProductConfigurationModel.set("customerId",this.getCustomerId()),this.models.customerProductProductConfigurationModel.set("productId",this.getAssignedProductId()),this.models.customerProductProductConfigurationModel.save({UpdateProductConfigurationRequest:a},{success:this.handleProductConfigurationSaveSuccess,error:this.handleProductConfigurationSaveError})},updateOrder:function(){this.fetchProductOrderItemsForRegisteredUser()},updateOrderWithAddTVChannelOrPackage:function(a){var b=(requirejs.appContext,this.getSelectedItem(),this.getAssignedProductId(),this.get("itemsSelectedDeltaStatus"),this.getCommonConfiguration()),b=this.getPayload(b),c={lo:this.getLocale(),sc:this.getSalesChannel()};return this.models.customerProductOrderItemProductConfigurationModel.setQueryParams(c),this.models.customerProductOrderItemProductConfigurationModel.set("customerId",this.getCustomerId()),this.models.customerProductOrderItemProductConfigurationModel.set("productOrderItemId",a),this.models.customerProductOrderItemProductConfigurationModel.save({UpdateProductInOrderConfigurationRequest:b},{success:this.handleProductConfigurationSaveSuccessOnExistingOrder,error:this.handleProductConfigurationSaveError})},fetchProductOrderItemsForRegisteredUser:function(){return this.models.customerProductOrderItemsModel.set({customerId:this.getCustomerId(),productOrderId:this.subViewModels.productOrderTopicViewModel.get("productOrderID")}),this.models.customerProductOrderItemsModel.setQueryParams({lo:this.getLocale(),sc:this.getSalesChannel()}),this.models.customerProductOrderItemsModel.fetch({success:a.bind(this.onProductOrderItemsFetchSuccess,this),error:a.bind(this.onProductOrderItemsFetchError,this)})},onProductOrderItemsFetchSuccess:function(a,b,c){if(b&&b.ProductOrderItemHeaders&&b.ProductOrderItemHeaders.productOrderItemHeaders&&b.ProductOrderItemHeaders.productOrderItemHeaders.length>0){for(var d=this.getAssignedProductId(),e=b.ProductOrderItemHeaders.productOrderItemHeaders,f=0;f<e.length;f++)if("CHANGE_PRODUCT"===e[f].actionType&&e[f].productID==d)return void this.updateOrderWithAddTVChannelOrPackage(e[f].id);this.updateOrderWithNewOrderItem(d)}},updateOrderWithNewOrderItem:function(a){var b=this.getCommonConfiguration();b=this.getPayload(b),b.productOrderID=this.get("productOrderID");var c={lo:this.getLocale(),sc:this.getSalesChannel()};this.models.customerProductProductConfigurationModel.setQueryParams(c),this.models.customerProductProductConfigurationModel.set("customerId",this.getCustomerId()),this.models.customerProductProductConfigurationModel.set("productId",a),this.models.customerProductProductConfigurationModel.save({UpdateProductConfigurationRequest:b},{success:this.handleProductConfigurationSaveSuccessOnExistingOrder,error:this.handleProductConfigurationSaveError})},onProductOrderItemsFetchError:function(a,b,c){console.log("error")},getPayload:function(a){return a.productChanges.push(this.get("productChanges")),a},getCommonConfiguration:function(){return{runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},productChanges:[]}},getCommonValidateConfiguration:function(){return{activityForConfiguration:"NegotiateProductConfiguration",returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",attachmentCriteria:[{type:"LVPIC",purpose:"MA"}],returnConfigurationData:{catalogDataInd:!0,productConfigurationInd:!0,quotedPricesInd:!0},productChanges:[]}},handleProductConfigurationSaveSuccess:function(a,b){var c=b.UpdateProductConfigurationResponse||b.UpdateProductInOrderConfigurationResponse;this.subViewModels.productOrderTopicViewModel.set("productOrderID",c.productOrderID),this.subViewModels.productOrderTopicViewModel.set("productOrderReferenceNumber",c.productOrderReferenceNumber),this.isHavingPriceImpact(c)?this.handleAction("ChangeSucceedHavingPriceimpact",b):this.handleAction("ChangeSucceedHavingNoPriceImpact",b)},clearCache:function(){this.subViewModels.myProductsAndServicesWidgetViewModel.set("assignedProductID",void 0)},handleProductConfigurationSaveSuccessOnExistingOrder:function(a,b){this.handleAction("ChangeSucceedWithExistingOrder")},handleProductConfigurationSaveError:function(a,b){console.log("failed"),JSON.parse(b.responseText).ErrorInfo.backendErrorMessage&&this.handleAction("ChangeFailed")},isHavingPriceImpact:function(a){return!("SUCCESS"!==a.productConfiguration.quoteStatus||!a.productConfiguration.totalOneTimeCalculatedPrice.finalAmount&&!a.productConfiguration.totalRecurringCalculatedPrice.finalAmount)},setRequiredData:function(){this.set("selectedItem",this.getSelectedItem()),this.set("productOrderID",this.subViewModels.productOrderTopicViewModel.get("productOrderID")),this.set("itemsSelectedDeltaStatus",this.subViewModels.itemListTopicVM.get("itemsSelectedDeltaStatus"))},getSelectedItem:function(){return this.subViewModels.itemListTopicVM.get("selectedItem")},getLocale:function(){return this.subViewModels.applicationInContextTopicViewModel.get("locale")||d.get("locale")},getSalesChannel:function(){return this.subViewModels.applicationInContextTopicViewModel.get("salesChannel")||d.get("salesChannel")},getCustomerId:function(){return this.subViewModels.customerInContextTopicViewModel.get("ID")},getAssignedProductId:function(){return this.subViewModels.myProductsAndServicesWidgetViewModel.get("assignedProductID")}})});
define("i18n!businesswidget/repository/common/i18n/repository/nls/repositoryStrings",{"root":{},"en":true,"de":true,"fr":true});
define("i18n!businesswidget/repository/common/i18n/care/web/nls/careStrings",{"root":{},"en":true,"fr":true});
define("i18n!businesswidget/repository_l3_common/common/i18n/repository/nls/l3_common.repositoryStrings",{"root":{},"en":true,"fr":true});
define("text!businesswidget/repository_l3_common/common/config/l3_common.carePackage.config.json",function (){return"({\n\n})\n\n"});
define("i18n!businesswidget/repository_l3_common/common/i18n/care/web/nls/l3_common.careStrings",{"root":{},"en":true,"fr":true});
define("i18n!businesswidget/repository_l9_common/common/i18n/repository/nls/l9_common.repositoryStrings",{"root":{},"en":true,"fr":true});
define("i18n!businesswidget/repository_l9_common/common/i18n/care/web/nls/l9_common.careStrings",{"root":{},"en":true,"fr":true});
define("l9_common.billingCare.custom",["replace","businesswidget/repository_l9_common/common/utils/ImplCopySessionStorage"],function() {});
define("businesswidget/repository_l9_common/widgetsLibrary/createBillingAccountWidget/common/constants",{"WIDGET_NAME":"createBillingAccountWidget","DATA_LOADED_EVENT":"dataLoaded","PLAN_EASY_MOBILE":"easyMobile","DELIVERY_METHOD_PAPER":"METH_PAPER","PAYMENT_METHOD_CASH":"cash","ViewModel":{"FIELD_BILLING_ADDRESS_POSTAL_CODE":"billingAddressPostalCode","FIELD_BILLING_ADDRESS_STREET_NAME":"billingAddressStreetName","FIELD_BILLING_ADDRESS_HOUSE_NO":"billingAddressHouseNo","FIELD_BILLING_ADDRESS_FLOOR_NO":"billingAddressFloorNo","FIELD_BILLING_ADDRESS_UNIT_NO":"billingAddressUnitNo","FIELD_SELECTED_DELIVERY_METHOD":"selectedDeliveryMethod","FIELD_PLAN":"plan","FIELD_DELIVERY_METHODS":"deliveryMethods","FIELD_NICK_NAME":"nickName","FIELD_INSTALLATION_ADDRESS":"installationAddress","FIELD_DELIVERY_READ_ONLY":"deliveryReadOnly","FIELD_CUSTOMER_ID":"customerId","FIELD_SUBMIT_SUCCESS":"submitSuccess"},"Model":{"REST_REQUEST":"ImplBillingAccountCreateRequest","REST_RESPONSE":"ImplBillingAccountDetailsResponse","Fields":{"FLOOR_NO":"floorNo","HOUSE_NO":"houseNo","POSTAL_CODE":"postalCode","STREET_NAME":"streetName","UNIT_NO":"unitNo","NICK_NAME":"nickName"}}});
define("businesswidget/repository_l9_common/common/model/billingEntityModel",["lightsaber","businesswidget/repository_l9_common/widgetsLibrary/createBillingAccountWidget/common/constants"],function (a,b){return a.Core.RESTModel.extend({options:{url:"customer/:customerId/billing-entity"},parse:function(a){var c=a[b.Model.REST_RESPONSE];if(c)return{billingAccounts:c.billingAccountDetails}},toJSON:function(){return{ImplBillingAccountCreateRequest:{deliveryMethod:this.get("deliveryMethod"),nickName:this.get(b.Model.Fields.NICK_NAME),physicalAddress:{floor:this.get(b.Model.Fields.FLOOR_NO),houseNumber:this.get(b.Model.Fields.HOUSE_NO),postcode:this.get(b.Model.Fields.POSTAL_CODE),streetName:this.get(b.Model.Fields.STREET_NAME),unitNumber:this.get(b.Model.Fields.UNIT_NO)}}}},setPostalAddress:function(a){this.set("postalCode",a[b.ViewModel.FIELD_BILLING_ADDRESS_POSTAL_CODE]),this.set("streetName",a[b.ViewModel.FIELD_BILLING_ADDRESS_STREET_NAME]),this.set("houseNo",a[b.ViewModel.FIELD_BILLING_ADDRESS_HOUSE_NO]),this.set("floorNo",a[b.ViewModel.FIELD_BILLING_ADDRESS_FLOOR_NO]),this.set("unitNo",a[b.ViewModel.FIELD_BILLING_ADDRESS_UNIT_NO])}})});
define("businesswidget/repository_l9_common/common/viewmodel/createBillingAccountViewModel",["lightsaber","knockout","businesswidget/repository_l9_common/common/model/billingEntityModel","businesswidget/repository/common/model/ChoiceListModel","businesswidget/repository_l9_common/common/viewmodel/addressWidgetViewModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/widgetsLibrary/createBillingAccountWidget/common/constants","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore"],function (a,b,c,d,e,f,g,h,i,j){return a.Core.ObservableViewModel.extend({models:{BillingEntityModel:c,ChoiceListModel:d},subViewModels:{AddressViewModel:e,CustomerInContextTopicViewModel:f,IndividualInContextTopicViewModel:g},dataBindings:[{nickName:"subViewModels.IndividualInContextTopicViewModel.nickName",options:{twoWay:!1,setOnBind:!0}},{selectedDeliveryMethod:"models.BillingEntityModel.deliveryMethod",options:{twoWay:!0}},{plan:"models.BillingEntityModel.plan",options:{twoWay:!0}},{customerId:"subViewModels.CustomerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{billingAddressPostalCode:"subViewModels.AddressViewModel.postalCode",options:{twoWay:!0}},{billingAddressStreetName:"subViewModels.AddressViewModel.streetName",options:{twoWay:!0}},{billingAddressHouseNo:"subViewModels.AddressViewModel.houseNo",options:{twoWay:!0}},{billingAddressFloorNo:"subViewModels.AddressViewModel.floorNo",options:{twoWay:!0}},{billingAddressUnitNo:"subViewModels.AddressViewModel.unitNo",options:{twoWay:!0}}],defaults:{selectedDeliveryMethod:"",plan:"",deliveryMethods:[],submitSuccess:!1},submitPostalCode:function(){this.subViewModels.AddressViewModel.handleAction("retrieveAddress")},submit:function(){this.models.BillingEntityModel.setPostalAddress(this.get()),this.models.BillingEntityModel.set(h.Model.Fields.NICK_NAME,this.get(h.ViewModel.FIELD_NICK_NAME));var a=this;this.models.BillingEntityModel.save({customerId:this.get(h.ViewModel.FIELD_CUSTOMER_ID)},{success:function(){a.set(h.ViewModel.FIELD_SUBMIT_SUCCESS,!0)}})},_deliveryMethodsLoaded:function(){var a=this.models.ChoiceListModel.getChoiceList(),b=[];j.each(a,function(a){b.push({id:a.ID,name:a.title})}),this.set(h.ViewModel.FIELD_DELIVERY_METHODS,b)},initialize:function(){this.models.ChoiceListModel.addToQueryParameter("STANDARD","x_7_bill_delivery_method",!0),this.models.ChoiceListModel.on("OnDataLoaded",j.bind(this._deliveryMethodsLoaded,this)),this.models.ChoiceListModel.fetch(),this.on("change:"+h.ViewModel.FIELD_PLAN,function(){var a=this.get(h.ViewModel.FIELD_PLAN);this.set(h.ViewModel.FIELD_DELIVERY_READ_ONLY,a===h.PLAN_EASY_MOBILE),a===h.PLAN_EASY_MOBILE&&this.set(h.ViewModel.FIELD_SELECTED_DELIVERY_METHOD,h.DELIVERY_METHOD_PAPER)},this),this.on("change:"+h.ViewModel.FIELD_INSTALLATION_ADDRESS,function(){var a=this.get(h.ViewModel.FIELD_INSTALLATION_ADDRESS);this.set(h.ViewModel.FIELD_BILLING_ADDRESS_POSTAL_CODE,a.postalCode)})}})});
define("businesswidget/repository_l9_common/common/model/PaymentHistoryModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({options:{url:"billingcare/customer/:ID/customer-account/:customerAccountID/payments",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},read:{contentType:"application/json",payload:["[]"]}}},name:d.get("ERROR_CONST").GET_ALLPAYMEANS_HISTORY});return e});
define("businesswidget/repository_l9_common/widgetsLibrary/paymentHistoryWidget/common/constants",["jquery","lightsaber","businesswidget/repository/common/core/LSResourceBundleCust"],function (a,b,c){var d={SORT_BY:{DATE:"sortDate",PAYMENT_METHOD:"PAYMENT METHOD",AMOUNT:"AMOUNT"},ACTIVITY_REASONS:{BACKOUT:c.getString("paymentHistoryWidget_paymentRejected"),FUND_TRANSFER_TO:c.getString("paymentHistoryWidget_fundTransferTo"),REFUND:c.getString("paymentHistoryWidget_paymentRefunded"),REFUND_REVERSAL:c.getString("paymentHistoryWidget_refundReversed"),SUCCESS:"Successful",BACKOUT:"Unsuccessful"},REF_DAYS:180,DEVICE_CONFIG:{ITEMS_PER_PAGE:5},WEB_CONFIG:{ITEMS_PER_PAGE:6},PAYMENT_METHOD:{CC:"Credit Card",CQ:"Check",DD:"Demad Draft",CA:"Cash"},PAYMENT_DETAIL_DESCRIPTIN_START_STRING:"Payment using",PAYMENT_DETAIL_HIDE_STRING:"xxxx xxxx xxxx",PAYMENT_DETAIL_DESCRIPTIN_FROM_STRING:"from"};return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/paymentHistoryViewModel",["underscore","lightsaber","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","businesswidget/repository_l9_common/common/model/PaymentHistoryModel","businesswidget/repository_l9_common/common/model/SearchDirectDebitModel","businesswidget/repository_l9_common/widgetsLibrary/paymentHistoryWidget/common/constants","businesswidget/repository/common/core/Configuration","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/utils/utility","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l){return b.Core.ObservableViewModel.extend({models:{paymentHistoryModel:e,searchDirectDebitModel:f,getBillingAccountDetailedListModel:k},subViewModels:{customerInContextTopicViewModel:c,accountInContextTopicViewModel:d,onePassTopicViewModel:l},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{type:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}}],defaults:{paymentHistory:[],paymentHistoryVmStatus:"",refDays:180,sortBy:"DATE",numberOfItems:100,sortOrder:"ASC",giroPaymentList:null,otherPaymentsList:null,nric:null,type:null,accounts:null,sortConfig:null},initialize:function(b){a.bindAll(this,"onPaymentHistorySuccess","onPaymentHistoryError","searchDirectDebit"),this.set("paymentHistoryVmStatus","paymentHistoryVmInitialized"),this.on("change:nric change:type",this.getBillingAccounts,this)},getBillingAccounts:function(){this.set("paymentHistoryVmStatus","getBillingAccountsInProgress");var b=this.get("type"),c=this.get("nric");b&&c&&(b=this.models.getBillingAccountDetailedListModel.getCustomerType(b),this.models.getBillingAccountDetailedListModel.set("type",b),this.models.getBillingAccountDetailedListModel.fetch({id:c,success:a.bind(this.billingAccountDetailedListSuccess,this),error:a.bind(this.onPaymentHistoryError,this)}))},billingAccountDetailedListSuccess:function(a,b){var c=this.subViewModels.customerInContextTopicViewModel.get("ID"),d=this.subViewModels.accountInContextTopicViewModel.get("faId");this.set("accounts",b.ImplBillingAccountDetailsResponse.billingAccountDetails),d&&c?this.getPaymentHistoryForSingleAccount():this.getPaymentHistoryForAllAccounts(),this.set("paymentHistoryVmStatus","accountsSet")},getPaymentHistoryForAllAccounts:function(){this.set("paymentHistoryVmStatus","getPaymentHistoryForAllAccountsInProgress");var b=this.get("accounts");this.initPaymentHistoryData();for(var c=[],d=0;d<b.length;d++){var e=b[d];this.set("customerId",e.customerId),this.set("faId",e.faid);var f=this._getPaymentHistoryData();c.push(f)}return $.when.apply(this,c).then(function(){this.set("paymentHistoryVmStatus","getPaymentHistoryForAllAccountSuccess")}.bind(this),a.bind(this.onPaymentHistoryError,this))},initPaymentHistoryData:function(){this.set("paymentHistory",[])},getPaymentHistoryForSingleAccount:function(){this.set("paymentHistoryVmStatus","getPaymentHistoryFor1AccountInProgress");var b=this.subViewModels.customerInContextTopicViewModel.get("ID"),c=this.subViewModels.accountInContextTopicViewModel.get("faId");this.set("customerId",b),this.set("faId",c),this.initPaymentHistoryData();var d=this._getPaymentHistoryData();return $.when(d).then(function(){this.set("paymentHistoryVmStatus","getPaymentHistoryFor1AccountSuccess")}.bind(this),a.bind(this.onPaymentHistoryError,this))},_getPaymentHistoryData:function(){var b=this.get("customerId"),c=this.get("faId");if(b&&c){this.models.paymentHistoryModel.set("ID",b),this.models.paymentHistoryModel.set("customerAccountID",c);var d=this.models.paymentHistoryModel.fetch({data:this.setQueryParameters()}),e=this.searchDirectDebit();return $.when(d,e).done(function(b,c,d){var e=[],f=this.onPaymentHistorySuccess(c[0]);e=e.concat(f);var g=this.onSearchDirectDebitSuccess(d[0]);e=e.concat(g),e=this._sortData(e,{field:"paymentDate",direction:"DESC"}),accounts=this.get("accounts");var h=a.find(accounts,function(a){return a.faid===b});h.timestamp=Date.now(),h.paymentHistory=e,accounts=this.set("accounts",accounts),this.set("paymentHistoryVmStatus","paymentDataMerged")}.bind(this,c))}},setQueryParameters:function(){return{rfd:j.calculateRefDate(this.get("refDays")),so:this.get("sortBy"),ps:this.get("numberOfItems")}},onPaymentHistorySuccess:function(a){var b=[];return a.PaymentsHistory&&a.PaymentsHistory.paymentHistoryDetails&&(b=this.formatData(a.PaymentsHistory.paymentHistoryDetails)),b},onPaymentHistoryError:function(){this.set("paymentHistoryVmStatus","paymentHistoryLoadingFailed")},formatData:function(b){return void 0!==b&&b.length>0&&a.each(b,function(a){a.paymentStatus="Successful",a.activities&&a.activities.length>0&&(a.paymentStatus="Failed")}),b},sortDataByOrder:function(){var b=this.get("sortConfig"),c=b.faId,d=this.get("accounts"),e=a.find(d,function(a){return a.faid===c}),f=e.paymentHistory;f&&f.length&&(f=this._sortData(f,b),e.paymentHistory=f,this.set("accounts",d))},_sortData:function(a,b){var c=b.field?b.field:"paymentDate",d=b.direction?b.direction:"ASC";return"ASC"===d?a.sort(function(a,b){return a[c]<b[c]?-1:a[c]>b[c]?1:(a[c]==b[c],0)}):a.sort(function(a,b){return a[c]>b[c]?-1:a[c]<b[c]?1:(a[c]==b[c],0)}),a},searchDirectDebit:function(){return this.models.searchDirectDebitModel.save({ImplSearchDirectDebitInput:{accountId:this.get("faId"),paymentMethod:"DD",implPaginationInfo:{pageSize:100,pageCount:1,pageNumber:1}}})},onSearchDirectDebitSuccess:function(b){var c=this,d=b.ImplSearchDirectDebitOutput.implDirectDebitItems||[];return d.length&&(d=a.map(d,function(a){return a.paymentStatus=c.getPaymentStatus(a.requestStatus),a.paymentDate=a.dueDate,a.instructionDateX8=a.dueDate,a.confirmationNumber=a.directDebitVoucher,a.paymentMethod="DD",a.paymentSourceTypeX8="P",a.originalAmount=a.requestAmount,a.requestType=a.requestType,a})),d=a.filter(d,function(a){return!a.requestType||79===a.requestType})},onSearchDirectDebitError:function(a,b){this.set("paymentHistoryVmStatus","paymentHistoryForDDLoaded")},getPaymentStatus:function(a){var b="";switch(a){case 69:case 80:b="Pending";break;case 83:b="Successful";break;case 67:case 70:case 82:b="Failed"}return b}})});
define("businesswidget/repository_l9_common/common/model/ValidateAccountModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/billing/financialAccount/:accountId",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/PayBillReferenceModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/payment/onepay/customer/:customerId/billing-arrangement/:billingAccountId/reference/",rest:{defaults:{method:"POST"},read:{method:"GET"},create:{method:"POST"}}}})});
define("businesswidget/repository_l9_common/common/model/DirectDebitModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"account/:billingAccount/directdebit",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplCreateDirectDebitRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/PayBillVerifyModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/payment/onepay/validate",rest:{defaults:{method:"POST"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/PayBillContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel"],function (a,b,c,d){var e=c.extend({persistent:["selectedPaymentMethod","selectedAccounts","pgData"],defaults:{selectedPaymentMethod:null,selectedAccounts:null,pgData:null},subViewModels:{customerInContextTopicViewModel:d},handleDependencies:function(){this.subViewModels.customerInContextTopicViewModel.on("change:ID",a.bind(this.empty,this))}});return e});
define("businesswidget/repository_l9_common/common/model/ImplPayBillTransactionModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/payment/onepay/contact-person/:contactId/transaction-details",rest:{defaults:{method:"POST",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},payload:["ImplCreateUpdateOnePayTransactionDetailsInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ImplOnepayV2CreatePaymentModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"/onepay/V2/payment/requests",rest:{defaults:{method:"POST",contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},payload:["ImplCreatePaymentRequestV2"]}}},name:"ImplOnepayV2CreatePaymentModel"})});
define("businesswidget/repository_l9_common/common/viewmodel/PayBillViewModel",["lightsaber","jquery","underscore","businesswidget/repository_l9_common/common/model/AccountBalanceModel","businesswidget/repository_l9_common/common/model/ValidateAccountModel","businesswidget/repository_l9_common/common/model/PayBillReferenceModel","businesswidget/repository_l9_common/common/model/DirectDebitModel","businesswidget/repository_l9_common/common/model/PayBillVerifyModel","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/PayBillContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/model/ImplPayBillTransactionModel","single!businesswidget/repository_l9_common/common/model/ImplOnepayV2CreatePaymentModel","Configuration"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=a.Core.ObservableViewModel.extend({models:{validateAccountModel:e,accountBalanceModel:d,payBillReferenceModel:f,payBillVerifyModel:h,implSendNotificationModel:o,viewUpdateCustomerProfileModel:p,directDebitModel:g,implPayBillTransactionModel:q,implOnepayV2CreatePaymentModel:r},subViewModels:{customerInContextTopicViewModel:k,payBillContextTopicViewModel:l,contactInContextTopicViewModel:m,onePassTopicViewModel:n},defaults:{accountId:"",accountId3rdParty:null,selectedPaymentMethod:"",selectedAccounts:"",payBillVmStatus:"",totalAmountToPay:"",paymentConfirmation:null,confirmationMessage:[],payStatus:null,balanceAmount:null,dueDate:null,isStartModeReady:!1,selectedPayMethod:null,isPartialPayment:!1,partialPayment:null,goodAccount:null,purchaseToken:null,isPayVerified:null,confirmationNumber:null,mailParameters:null,contactId:null,templateId:null,isNewConfirmationAPICall:!0,isOnePayV2APICall:!1,allPayMethods:{creditCard:2,mCash:3,eNet:4},pgData:{referenceId:"",authenticationHeader:"",custId:"",paymentMode:"",receiptEmailAddress:"",totalPrice:"",payer_identity:"",redirect_urls:{success_url:"",failure_url:""},merchantData:"",payment_method:"",gateway_reference:"",redirection_mode:"BROWSER",sales_channel:"RETAIL_SALE",currency:"SGD",cart_details:null,id:"",redirect_url:"",internal_id:"",paymentStatus:"",items:[]},onePayPaymentMethodsV2:{1:"GIRO",2:"CREDIT_CARD",3:"MCASH",4:"ENETS_IB"},onePayPaymentMethods:{1:"GIRO",2:"CC",3:"mCash",4:"CE"}},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{selectedAccounts:"subViewModels.payBillContextTopicViewModel.selectedAccounts",options:{twoWay:!0,setOnBind:!0}},{selectedPaymentMethod:"subViewModels.payBillContextTopicViewModel.selectedPaymentMethod",options:{twoWay:!0,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){c.bind("confirmPayBill",this),setTimeout(function(){this.set("payBillVmStatus","payBillInitialized")}.bind(this),0)},paymentFailure:function(){this.set("isPayVerified",!1),this.set("payBillVmStatus","PaymentFailed")},paymentSuccess:function(a,b){var c=this;if(b&&b.ImplPaymentConfirmation&&b.ImplPaymentConfirmation.paymentConfirmation&&b.ImplPaymentConfirmation.paymentConfirmation.confirmationNumber&&0!=b.ImplPaymentConfirmation.paymentConfirmation.confirmationNumber.length){c.set("isPayVerified",!0);var d=[],e={};e.confirmationNumber=b.ImplPaymentConfirmation.paymentConfirmation.confirmationNumber,d.push(e),c.set("confirmationMessage",d),c.set("payBillVmStatus","PaymentConfirmed")}else c.set("isPayVerified",!1),c.set("payBillVmStatus","PaymentFailed")},startPayBill:function(){var a=this;if(a.set("payBillVmStatus","InitializedReferenceIdFetch"),"1"==this.get("selectedPaymentMethod")){var d=[],e=this.get("selectedAccounts");c.each(e,function(c){var e=b.Deferred();a.getModel("directDebitModel").save({billingAccount:c.faid,ImplCreateDirectDebitRequest:a.createGiroPayload(c)},{success:function(a,b){return function(b){a.resolve()}}(e,a),error:function(a,b){return function(c){b.set("payBillVmStatus","GiroPaymentError"),a.reject()}}(e,a)}),d.push(e)}),b.when.apply(a,d).done(function(){a.set("payBillVmStatus","GiroPaymentSuccess")})}else a.getModel("payBillReferenceModel").save({customerId:a.get("selectedAccounts")[0].customerId,billingAccountId:a.get("selectedAccounts")[0].billingAccountNumber},{success:c.bind(a.payBillReferenceModelSuccess,a),error:c.bind(a.payBillReferenceModelError,a)})},createGiroPayload:function(a){var b=this.get("goodAccount"),c={accountId:a.faid,cmAccountNumber:a.faid,requestAmount:a.amountToPay,paymentMethod:"DD",requestStatus:"",dueDate:Date.now(),invoiceId:"",billingInvoiceNumber:"",payChannelId:a.pcnNo,implBankAccountDetails:{bankCode:b.bankCode,accountNumber:b.accountNumber,bankName:b.bankName,bankBranch:b.branchCode},accountTimestamp:"-1",customerName:a.name};return c},payBillReferenceModelSuccess:function(a,b){var c=this;if(b&&b.ImplOnePayReferenceResponse&&b.ImplOnePayReferenceResponse.referenceId){var d=c.get("pgData");d.paymentStatus="Pending",d.referenceId=b.ImplOnePayReferenceResponse.referenceId,d.receiptEmailAddress||(d.receiptEmailAddress=this.subViewModels.onePassTopicViewModel.get("email")),c.set("pgData",d);var e=s.get("isOnePayV2APICallCare");if(e){var f=this.onePayV2APICall(),g=f.then(function(){return this.confirmPayBillWithTransactionDetailsAPI()}.bind(this),function(){this.set("payBillVmStatus","referenceIdSetFailed")}.bind(this));g.then(function(){this.set("payBillVmStatus","initiatePaymentSuccess")}.bind(this),function(){this.payBillReferenceModelError(),this.set("payBillVmStatus","createTransactionEntryFailed")}.bind(this))}else{var h=this.get("isNewConfirmationAPICall");h?this.confirmPayBillWithTransactionDetailsAPI().then(function(){c.set("payBillVmStatus","referenceIdSet")}.bind(this),function(){this.payBillReferenceModelError(),this.set("payBillVmStatus","createTransactionEntryFailed")}.bind(this)):c.set("payBillVmStatus","referenceIdSet")}}},payBillReferenceModelError:function(a,b){this.set("payBillVmStatus","referenceIdSetFailed")},onePayV2APICall:function(){var a=this.get("pgData"),b=JSON.parse(a.merchantData);b.accounts=c.filter(b.accounts,function(a){return a.amountToPay>0}),a.merchantData=JSON.stringify(b);var d={ImplCreatePaymentRequestV2:{gateway_reference:a.referenceId,payer_identity:a.payer_identity,payment_method:a.payment_method,description:a.description,amount:a.totalPrice,currency:a.currency,parameters:[{name:"merchant_data",value:a.merchantData}],merchant_data:a.merchantData,redirection_mode:a.redirection_mode,redirect_urls:a.redirect_urls,sales_channel:a.sales_channel,cart_details:a.cart_details}},e=this.models.implOnepayV2CreatePaymentModel;return e.save(d,{success:c.bind(this.onepayV2CreatePaymentSuccess,this),error:c.bind(this.onepayV2CreatePaymentFailure,this)})},onepayV2CreatePaymentSuccess:function(a,b){var c=this.get("pgData"),d=b.ImplCreatePaymentResponseV2;d?(c.id=d.id,c.referenceId=d.gateway_reference,c.redirect_url=d.redirect_url,c.internal_id=d.internal_id,c.paymentStatus="Pending",c.receiptEmailAddress||(c.receiptEmailAddress=this.subViewModels.onePassTopicViewModel.get("email")),this.set("pgData",c),this.set("payBillVmStatus","OnepayV2PaymentCreated")):this.onepayV2CreatePaymentFailure()},onepayV2CreatePaymentFailure:function(){
this.set("payBillVmStatus","OnepayV2PaymentFailed")},getSelectedPaymentMethod:function(a){return this.get("onePayPaymentMethods")[a]},confirmPayBill:function(){var a=this.get("isNewConfirmationAPICall");a?setTimeout(function(){this.set("payBillVmStatus","PaymentConfirmed")}.bind(this),0):this.confirmPayBillWithVerifyPaymentAPI()},confirmPayBillWithTransactionDetailsAPI:function(){var a=this,b=a.get("pgData"),d=a.get("selectedAccounts"),e=this.getSelectedPaymentMethod(a.get("selectedPaymentMethod"));a.set("payStatus",b.paymentStatus);var f=[];d&&d.length>0&&c.each(d,function(a){var b={};a.amountToPay>0&&(b.amount=parseFloat(a.amountToPay,10),b.accountId=a.faid,f.push(b))});var g={ImplCreateUpdateOnePayTransactionDetailsInput:{referenceId:b.referenceId,accountsAmounts:f,paymentAmount:parseFloat(b.totalPrice,10),paymentStatus:b.paymentStatus,thirdPartyInd:!1,paymentMethod:e,currency:"SGD"}},h=this.models.implPayBillTransactionModel;return h.set("contactId",this.get("contactId")),this.models.implPayBillTransactionModel.save(g,{success:c.bind(this.newPaymentSuccess,this),error:c.bind(this.paymentFailure,this)})},newPaymentSuccess:function(a,b){this.set("isPayVerified",!1),this.set("payBillVmStatus","TransactionAdded")},confirmPayBillWithVerifyPaymentAPI:function(){var a=this,b=a.get("paymentConfirmation"),d=a.get("selectedAccounts"),e=this.getSelectedPaymentMethod(a.get("selectedPaymentMethod"));a.set("payStatus",b.paymentStatus);var f={paymentMethodType:e};if(d&&d.length>0){var g=[];c.each(d,function(a){var b={};b.amount=a.amountToPay,b.accountId=a.faid,g.push(b)}),f.implAccountAmountDetails=g,f.transactionId=b.purchaseId}var h={ImplValidateOnePayRequest:{implPaymentDetails:f,purchaseToken:b.purchaseToken,referenceId:b.referenceId}};a.getModel("payBillVerifyModel").setQueryParams({isPayforOthersAccount:!1}),a.getModel("payBillVerifyModel").save(h,{success:c.bind(this.paymentSuccess,this),error:c.bind(this.paymentFailure,this)})},config:{actions:{pay:function(){this.trigger("payNow")},cancelPayBill:function(a){this.set("payStatus","CANCEL"),c.isFunction(a)&&a()},failPayBill:function(a){this.set("payStatus","FAIL"),c.isFunction(a)&&a()},sendEmailToCustomer:function(){var a=this,b=a.get("contactId");if(void 0!==b&null!==b){var d=a.getModel("viewUpdateCustomerProfileModel");d.set("id",b),d.fetch({success:c.bind(a.onFetchSuccess,a),error:function(){a.set("payBillVmStatus","mailFailed")}})}},validateAccount:function(){this.set("payBillVmStatus","validateAccountInProgress"),this.models.validateAccountModel.fetch({accountId:this.get("accountId3rdParty"),success:c.bind(this.validateAccountSuccess,this),error:c.bind(this.validateAccountError,this)})}}},onFetchSuccess:function(a,b){var c=this,d=b.ImplContactPersonOutput.implContactPerson;"undefined"!=typeof d.emailId&&null!==d.emailId&&""!==d.emailId?c.sendEmail(d.emailId,d.name):c.set("payBillVmStatus","mailFailed")},sendEmail:function(a,b){var d=this,e=d.get("templateId"),f=d.get("mailParameters"),g=c.map(this.get("allPayMethods"),function(a,b){var c={};return c[a]=b,c}),h=c.find(f,function(a,b){return"paymentMethod"==a.key});g=c.find(g,function(a,b){return a[h.value]}),h.value=g[h.value],h=c.find(f,function(a,b){return"customerName"==a.key}),h.value=b;var i={ImplSendNotificationRequest:{target:[a],templateId:e,notificationChannel:"EMAIL",templateSimpleParameters:f,templateURLParameters:[]}};d.getModel("implSendNotificationModel").save(i,{success:function(a,b){d.set("payBillVmStatus","mailSent")},error:function(a,b){d.set("payBillVmStatus","mailFailed")}})},validateAccountSuccess:function(a,b){b&&(this.set("accountId3rdParty",b.ImplRetrieveFADetailsRestOutput.accountId),this.set("payBillVmStatus","validateAccountSuccess"))},validateAccountError:function(a,b){this.set("payBillVmStatus","validateAccountError")}});return t});
define("businesswidget/repository_l9_common/common/model/BillSummaryChargesModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/ebill/customer/:customerId/billing-arrangement/:barId/bill/:billId/get-billSummary",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/BillInContextTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository/common/viewmodel/BillAndBalanceInContextViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel"],function (a,b,c,d,e){var f=c.extend({persistent:["billDetails","barId","faId","topBills"],defaults:{billDetails:{customerId:void 0,billingArrangement:void 0,billNumber:void 0,billClosedDate:void 0,billDate:void 0,dueDate:void 0,currentCharges:void 0},barId:null,faId:null,topBills:null},subViewModels:{billAndBalanceInContextViewModel:d,customerInContextTopicViewModel:e},dataBindings:[{"billDetails.customerId":"subViewModels.customerInContextTopicViewModel.customerId",options:{twoWay:!0,setOnBind:!0}},{"billDetails.billNumber":"subViewModels.billAndBalanceInContextViewModel.billId",options:{twoWay:!0,setOnBind:!0}}]});return f});
define("businesswidget/repository_l9_common/common/viewmodel/BillSummaryChargesTopicViewModel",["underscore","lightsaber"],function (a,b){var c=b.Core.ViewModel.extend({defaults:{billId:null,barId:null,billDate:null,billCycleStartDate:null,billingCycleEndDate:null,deposit:null,previousBalance:null,outstandingBalance:null,currentCharges:null,currentChargesDueDate:null,totalAmount:null,dueDate:null,totalAdjustments:null,payments:null}});return c});
define("businesswidget/repository_l9_common/common/utils/ImplUtil",["underscore","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","businesswidget/repository/common/util/Util"],function (a,b,c,d,e){function f(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}return e.format["DD-MMM-YYYY"]=13,e.currency.SGD=d.get("currency"),e.getDateString=function(a,b,c){var e=new Date(a),f=d.getLocale();f=f.toLowerCase();var g,h=e.getHours(),i=e.getMinutes(),j=e.getSeconds(),k=e.getFullYear(),l=""+new String(e.getFullYear()).substring(2,4),m=e.getDate(),n=e.getMonth()+1,o=this.monthName(e.getMonth()),p=this.shortMonthName(e.getMonth()),q="";switch(i<10&&(i="0"+i),j<10&&(j="0"+j),"en-us"==f?(h>12?(h=h-12+"",g=" PM"):g=h<12?" AM":" PM",n<10&&(n="0"+n),m<10&&(m="0"+m)):(n<10&&(n="0"+n),m<10&&(m="0"+m)),c){case this.format.full:switch(f){case"en-us":q=o+" "+m+", "+k;break;case"fr-fr":q=m+" "+o+k;break;default:q=o+" "+m+", "+k}break;case this.format["short"]:switch(f){case"en-us":q=n+"/"+m+"/"+l;break;case"fr-fr":q=m+"/"+n+"/"+l;break;default:q=m+"/"+n+"/"+l}break;case this.format.general:switch(f){case"en-us":q=n+"/"+m+"/"+k;break;case"fr-fr":q=m+"/"+n+"/"+k;break;default:q=m+"/"+n+"/"+k}break;case this.format["YYYY/MM/DD"]:q=k+"/"+n+"/"+m;break;case this.format["YYYY-MM-DD"]:q=k+"-"+n+"-"+m;break;case this.format["DD/MM/YYYY"]:q=n+"/"+m+"/"+k;break;case this.format["mm:ss"]:q=i+":"+j;break;case this.format.monthYear:q=n+"/"+l;break;case this.format.monthNameYear:q=o+" "+k;break;case this.format.dayMonth:switch(f){case"en-us":q=n+"/"+m;break;case"fr-fr":q=m+"/"+n;break;default:q=m+"/"+n}break;case this.format.dayMonthName:switch(f){case"en-us":var r=m.toString(),s=r.substr(r.length-1);"1"==s?r+="st":"2"==s?r+="nd":"3"==s?v=r+"rd":r+="th",q=o+" "+r;break;case"fr-fr":q=m+" "+o;break;default:q=m+" "+o}break;case this.format["YYYY-MM"]:q=k+"-"+n;break;case this.format["DD-MMM"]:q=m+"-"+p;break;case this.format["DD-MMM-YYYY"]:q=m+"-"+p+"-"+k;break;case this.format["DD MMM YYYY"]:q=m+" "+p.toUpperCase()+" "+k+" "}if(b)if(c==this.format.full)switch(f){case"en-us":q=q+" "+h+":"+i+":"+j+g;break;case"fr-fr":q=q+" "+h+":"+i+":"+j;break;default:q=q+" "+h+":"+i+":"+j}else switch(f){case"en-us":q=q+" "+h+":"+i+g;break;case"fr-fr":q=q+" "+h+":"+i;break;default:q=q+" "+h+":"+i}return q},e.formatDate=function(a,b){if(a||0===a){if(a=Number(a)?new Date(Number(a)):a,b){var c={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in c)new RegExp("("+d+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[d]:("00"+c[d]).substr((""+c[d]).length)));a=b}return a}},e.usageUnitBasedFormat=function(a,b){var c="",d=Number(a);switch(b){case"KBYTES":c=d>=1048576?(d/1048576).toFixed(2)+"GB":d>=1024?(d/1024).toFixed(1)+"MB":d.toFixed(0)+"KB";break;case"MBYTES":c=d>=1024?(d/1024).toFixed(2)+"GB":d.toFixed(1)+"MB";break;case"GBYTES":c=d.toFixed(2)+"GB";break;case"SGD":var e=f(d.toFixed(2));c=this.currency.SGD+e;break;case"MESSAGING":c=d.toFixed(0)+" SMS";break;case"MINUTES":c=d.toFixed(0)+" Min";break;case"SECONDS":c=(d/60).toFixed(0)+" Min";break;case"COUNTER":var g=new Date(null);g.setSeconds(d);var h=g.getMonth(),i=g.getDate()-1,j=g.getHours(),k=g.getMinutes(),l=g.getSeconds();j<10&&(j="0"+j),k<10&&(k="0"+k),l<10&&(l="0"+l),h>1?c=h+" Months ":h>0&&(c=h+" Month "),i>1?c=c+i+" Days ":i>0&&(c=c+i+" Day "),c=c+j+":"+k+":"+l}return c},e.mapNames=function(b,c){var d={};return a.each(b,function(a,b){b=c[b]||b,d[b]=a}),d},e});
define("businesswidget/repository_l9_common/common/viewmodel/BillSummaryChargesViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/BillSummaryChargesModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/BillInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/BillSummaryChargesTopicViewModel","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d,e,f,g,h){var i=b.Core.ObservableViewModel.extend({models:{BillSummaryChargesModel:e},subViewModels:{billInContextTopicViewModel:f,billSummaryChargesTopicViewModel:g},defaults:{locale:c.get("locale"),sc:c.get("salesChannel"),customerId:null,billId:null,prevBillId:null,prevBillClosedDate:null,barId:null,billDate:null,billCycleStartDate:null,billingCycleEndDate:null,previousBalance:null,previousPaymentAmount:null,previousPaymentDate:null,previousPaymentMethod:null,outstandingBalance:null,totalChargesWithoutBalance:null,totalAmount:null,dueDate:null,deposit:null,currency:null,currentCharges:null,currentChargesDueDate:null,displayPaymentRow:!0,payments:null},initialize:function(a){d.bindAll(this,"onFetchSuccess","getBillSummaryChargesData","getDate"),this._bindEvents(),this.getDataFromContext(),this.getBillSummaryChargesData()},_bindEvents:function(){this.subViewModels.billInContextTopicViewModel.on("change:billDetails",this.getDataFromContext,this),this.on("change:billId",this.getBillSummaryChargesData,this),this.on("change:billClosedDate",this.getBillSummaryChargesData,this)},getDataFromContext:function(){var a=this.subViewModels.billInContextTopicViewModel.get("billDetails");this.set("customerId",a.customerId),this.set("barId",a.billingArrangement),this.set("billId",this.subViewModels.billInContextTopicViewModel.get("billId")?this.subViewModels.billInContextTopicViewModel.get("billId"):a.billNumber),this.set("billDate",a.billDate),this.set("billClosedDate",a.billClosedDate),this.set("dueDate",a.dueDate),this.subViewModels.billSummaryChargesTopicViewModel.set("barId",this.get("barId")),this.subViewModels.billSummaryChargesTopicViewModel.set("billId",this.get("billId")),this.subViewModels.billSummaryChargesTopicViewModel.set("billDate",a.billDate),this.subViewModels.billSummaryChargesTopicViewModel.set("dueDate",a.dueDate),this.subViewModels.billSummaryChargesTopicViewModel.set("billClosedDate",a.billClosedDate)},getAmountWithCurrency:function(a){return h.usageUnitBasedFormat(a,this.get("currency"))},getDate:function(a){return h.getDateString(parseInt(a),!1,9)},getshortMonthDate:function(a){return h.getDateString(parseInt(a),!1,4)},getBillSummaryChargesData:function(){var a=this.get("billId"),b=this.get("billClosedDate");if(a&&a!==this.get("prevBillId")&&b&&b!==this.get("prevBillClosedDate")){this.set("prevBillId",a),this.set("prevBillClosedDate",b);var d={bcd:this.get("billClosedDate"),lo:this.get("locale")?this.get("locale"):c.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):c.get("salesChannel")};this.models.BillSummaryChargesModel.setQueryParams(d),e.fetch({customerId:this.get("customerId"),barId:this.get("barId"),billId:this.get("billId"),success:this.onFetchSuccess})}},onFetchSuccess:function(a,b){this.set("currency",b.ImplBillSummaryChargesResponse.currency),this.set("billCycleStartDate",b.ImplBillSummaryChargesResponse.billCycleStartDate),this.set("billingCycleEndDate",b.ImplBillSummaryChargesResponse.billingCycleEndDate),this.set("currentChargesDueDate",b.ImplBillSummaryChargesResponse.billingCycleEndDate),this.set("deposit",b.ImplBillSummaryChargesResponse.deposit),this.set("previousBalance",b.ImplBillSummaryChargesResponse.previousBalance),this.set("totalChargesWithoutBalance",b.ImplBillSummaryChargesResponse.totalChargesWithoutBalance),this.set("payments",b.ImplBillSummaryChargesResponse.payments),this.set("totalAdjustments",parseFloat(b.ImplBillSummaryChargesResponse.totalAdjustments)),null==b.ImplBillSummaryChargesResponse.payments?this.set("displayPaymentRow",!1):this.set("displayPaymentRow",!0),this.set("outstandingBalance",b.ImplBillSummaryChargesResponse.outstandingBalance),this.set("currentCharges",b.ImplBillSummaryChargesResponse.totalCurrentCharges),this.set("totalAmount",b.ImplBillSummaryChargesResponse.totalAmount),this.subViewModels.billSummaryChargesTopicViewModel.set("billCycleStartDate",b.ImplBillSummaryChargesResponse.billCycleStartDate),this.subViewModels.billSummaryChargesTopicViewModel.set("billingCycleEndDate",b.ImplBillSummaryChargesResponse.billingCycleEndDate),this.subViewModels.billSummaryChargesTopicViewModel.set("currentChargesDueDate",b.ImplBillSummaryChargesResponse.billingCycleEndDate),this.subViewModels.billSummaryChargesTopicViewModel.set("deposit",this.get("deposit")),this.subViewModels.billSummaryChargesTopicViewModel.set("previousBalance",this.get("previousBalance")),this.subViewModels.billSummaryChargesTopicViewModel.set("payments","undefined"!=typeof this.get("payments")?this.get("payments"):null),this.subViewModels.billSummaryChargesTopicViewModel.set("outstandingBalance",this.get("outstandingBalance")),this.subViewModels.billSummaryChargesTopicViewModel.set("currentCharges",this.get("currentCharges")),this.subViewModels.billSummaryChargesTopicViewModel.set("totalAmount",this.get("totalAmount")),this.subViewModels.billSummaryChargesTopicViewModel.set("totalChargesWithoutBalance",this.get("totalChargesWithoutBalance")),this.subViewModels.billSummaryChargesTopicViewModel.set("totalAdjustments",parseFloat(this.get("totalAdjustments")))},isAllDataAvailable:function(){return null!=this.get("customerId")}});return i});
define("businesswidget/repository_l9_common/common/model/usageDetailsModel",["lightsaber","underscore","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"/ebill/customer/:customerId/subscription/:subscriptionId/billing-arrangement/:barId/bill/:billId/event-list",rest:{defaults:{method:"POST",payload:["ImplEventRequest"],qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale"),sortType:"date",sortAsc:!0}}}},parse:function(a,c){if(a&&a.ImplEventsDetails){var d=a.ImplEventsDetails.events,e=b.pluck(b.filter(a.ImplEventsDetails.columns,function(a){return"CURRENCY"==a.format}),"id");b.each(d,function(a){switch(a.direction){case"O":a.direction="Out";break;case"I":a.direction="In";break;case"C":a.direction="Call Forward"}b.each(e,function(b){a[b]=a[b]&&0===a[b].trim().indexOf("$")?a[b].substr(1):a[b]})})}return a},initialize:function(a){this._super(a)}});return d});
define("text!businesswidget/repository_l9_common/widgetsLibrary/usageDetailsWidget/web/view/template/downloadUsageDetailsButtonTemplate.html",function (){return"<button class=\"btn btn-primary\" data-bind=\"i18n:'usageDetails_export_excel', action: 'downloadXlsx'\"></button>\n"});
define("businesswidget/repository_l9_common/common/viewmodel/usageDetailsViewModel",["knockout","lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/usageDetailsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/BillInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","text!businesswidget/repository_l9_common/widgetsLibrary/usageDetailsWidget/web/view/template/downloadUsageDetailsButtonTemplate.html"],function (a,b,c,d,e,f){var g=b.Core.ObservableViewModel.extend({models:{usageDetailsModel:d},subViewModels:{customerInContextTopicViewModel:f,billInContextTopicViewModel:e},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.customerId",options:{twoWay:!1,setOnBind:!0}},{billId:"subViewModels.billInContextTopicViewModel.billDetails.billNumber",options:{twoWay:!1,setOnBind:!0}}],defaults:{pageSize:10,locale:b.Core.Configuration.get("locale"),sc:b.Core.Configuration.get("salesChannel"),customerId:null,subscriptionId:null,billId:null,barId:null,usageEventList:null,usageType:"",serviceTypeID:null,pagination:null,activePage:0,phoneNumber:"",accountNumber:"",eventsPeriod:"",bcd:null,totalResults:null,columnConfig:{taxLegend:{sortOrder:100,title:"GST"},date:{sortOrder:200,title:"Date"},time:{sortOrder:300,title:"Time"},chargeableUnits:{sortOrder:400,title:"Chargeable Units"},description2:{sortOrder:500,title:"Description"},callTypex:{sortOrder:600,title:"Call Type"},amount:{sortOrder:650,title:"Amount",format:"CURRENCY"},callingCountryName:{sortOrder:700,title:"Calling Country"},direction:{sortOrder:750,title:"Direction"},otherPartyNo:{sortOrder:800,title:"Other Party No."},rate:{sortOrder:850,title:"Rate"},amtBeforeFreeBundle:{sortOrder:900,title:"Amount (Before free bundle)",format:"CURRENCY"},amtAfterFreeBundle:{sortOrder:950,title:"Amount (After free bundle)",format:"CURRENCY"},volume:{sortOrder:970,title:"Volume"},wifi:{sortOrder:970,title:"WiFi"},type:{sortOrder:1e3,title:"Type"},quantity:{sortOrder:1e3,title:"Quantity"}}},onFetchSuccess:function(a,b){var c=this.get("usageEventList");if(b.ImplEventsDetails){if(b=b.ImplEventsDetails,c){var d=c.events.concat(b.events);b.events=d}b.success=!0,0==this.get("pageIndex")&&null!==b.totalResults?b.totalResults=b.totalResults:b.totalResults=this.getValueByPath("usageEventList.totalResults");var e=[],f=Math.ceil(b.totalResults/b.itemsPerPage),g=this.get("activePage");this.set("pagination",null),this.set("usageEventList",null);for(var h=0;h<f;h++)e.push({pageIndex:h,isActive:g===h});this.set("pagination",e),this.set("usageEventList",b)}else b.success=!1,this.set("pagination",[]),this.set("usageEventList",b)},sortColumns:function(a){var b=this.get("columnConfig"),d=a.columns;return d=c.map(d,function(a){return c.extend(a,b[a.id])}.bind(this)),d=c.sortBy(d,"sortOrder")},_onFetchXlsxSuccess:function(a,b){var c=new Blob([b],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.target="_blank",e.download="usageDetails.xlsx",document.body.appendChild(e),e.click()},initialize:function(a){c.bindAll(this,"isAllDataAvailable","onFetchSuccess","getUsageDetails","_onFetchXlsxSuccess","_downloadExcelFile","_downloadExcelFileWithIframe"),this._super(a)},isAllDataAvailable:function(){return null!=this.get("customerId")},getUsageDetails:function(){var a={ImplEventRequest:{typeId:this.get("serviceTypeID")}},b=this.get("pageIndex");return 0===b&&(this.set("activePage",0),this.set("pagination",null),this.set("usageEventList",null)),this.models.usageDetailsModel.setQueryParams({start:b*this.get("pageSize"),pageSize:this.get("pageSize"),outputFormat:"json",bcd:this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billClosedDate")}),this.models.usageDetailsModel.save(a,{customerId:this.get("customerId"),billId:this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billNumber"),subscriptionId:this.get("subscriptionId"),barId:this.get("barId"),success:this.onFetchSuccess})},_downloadExcelFileWithIframe:function(){var a=this.models.usageDetailsModel.urlRoot.replace(":customerId",this.get("customerId")).replace(":billId",this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billNumber")).replace(":subscriptionId",this.get("subscriptionId")).replace(":barId",this.get("barId"));a+="/excel?sc="+b.Core.Configuration.get("salesChannel")+"&lo="+b.Core.Configuration.get("locale")+"&sortType=date&sortAsc=true&start=0&pageSize=1&outputFormat=xlsx&bcd="+this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billClosedDate")+"&typeId="+btoa(this.get("serviceTypeID"));var c=b.Core.Configuration.get("REST data source"),d=c.defaults.host||location.hostname,e=this.models.usageDetailsModel.dataSource.defaults.module,f=c.defaults.port||location.port;f=f&&80!==f?":"+f:"";var g=c.defaults.protocol||location.protocol.split(":")[0];a=g+"://"+d+f+e+a;window.open(a,"_blank")},_downloadExcelFile:function(){var a=this.get("serviceTypeID")+".xlsx",c=b.Core.LSRESTDataSource.token,d=this.models.usageDetailsModel.urlRoot.replace(":customerId",this.get("customerId")).replace(":billId",this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billNumber")).replace(":subscriptionId",this.get("subscriptionId")).replace(":barId",this.get("barId"));d+="?sc="+b.Core.Configuration.get("salesChannel")+"&lo="+b.Core.Configuration.get("locale")+"&sortType=date&sortAsc=true&start=0&pageSize=1&outputFormat=xlsx&bcd="+this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billClosedDate");var e=new XMLHttpRequest,f=b.Core.Configuration.get("REST data source"),g=f.defaults.host||location.hostname,h=this.models.usageDetailsModel.dataSource.defaults.module,i=f.defaults.port?":"+f.defaults.port:"";!i&&location.port&&(i=":"+location.port);var j=f.defaults.protocol||location.protocol.split(":")[0];d=j+"://"+g+i+h+d,e.open("POST",d,!0),e.setRequestHeader("authorization",c),e.setRequestHeader("Content-Type","application/json"),e.responseType="arraybuffer",e.onload=function(){if(200===this.status){var b=e.getResponseHeader("Content-Disposition");if(b&&b.indexOf("attachment")!==-1){var c=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,d=c.exec(b);null!=d&&d[1]&&(a=d[1].replace(/['"]/g,""))}var f=e.getResponseHeader("Content-Type"),g=new Blob([this.response],{type:f});if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(g,a);else{var h=window.URL||window.webkitURL,i=h.createObjectURL(g);if(a){var j=document.createElement("a");"undefined"==typeof j.download?window.location=i:(j.href=i,j.download=a,j.style.display="none",document.body.appendChild(j),j.click(),document.body.removeChild(j))}else window.location=i;setTimeout(function(){h.revokeObjectURL(i)},100)}}};var k={ImplEventRequest:{typeId:this.get("serviceTypeID")}};e.send(JSON.stringify(k))},config:{actions:{downloadXlsx:function(){this._downloadExcelFileWithIframe()},changePage:function(a,b,c){return a.preventDefault(),a.stopPropagation(),this.set("activePage",b.pageIndex),this.getUsageDetails()}}}});return g.widgetName="usageDetailsWidget",g});
define("businesswidget/repository_l9_common/common/viewmodel/ViewBillCurrentChargesViewModel",["underscore","knockout","lightsaber","single!businesswidget/repository_l9_common/common/model/ViewBillCurrentChargesModel","single!businesswidget/repository_l9_common/common/viewmodel/usageDetailsViewModel","businesswidget/repository_l9_common/common/viewmodel/BillSummaryChargesViewModel","businesswidget/repository_l9_common/widgetsLibrary/viewBillCurrentChargesWidget/common/constants","businesswidget/repository_l9_common/common/utils/implDateUtils","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/BillInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m){return c.Core.ObservableViewModel.extend({models:{viewBillCurrentChargesModel:d},subViewModels:{usageDetailsViewModel:e,billSummaryChargesViewModel:f,
billInContextTopicViewModel:l,accountInContextTopicViewModel:m},dataBindings:[{customerId:"subViewModels.billInContextTopicViewModel.billDetails.customerId",options:{twoWay:!1,setOnBind:!0}},{barId:"subViewModels.billInContextTopicViewModel.billDetails.billingArrangement",options:{twoWay:!1,setOnBind:!0}},{billNumber:"subViewModels.billInContextTopicViewModel.billDetails.billNumber",options:{twoWay:!1,setOnBind:!0}},{bcd:"subViewModels.billInContextTopicViewModel.billDetails.billClosedDate",options:{twoWay:!1,setOnBind:!0}},{accountId:"subViewModels.accountInContextTopicViewModel.faId",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,accountId:null,barId:null,bcd:null,billNumber:null,viewBillCurrentChargesVmStatus:null,isBillExist:!1,bill:null,constants:g.ViewModel,currentCharge:null,currentSubscription:null,usageDetails:null,pageIndex:0,pageSize:10,amountFormat:function(a,b,c){c=c||"$";var d;return 0==a&&b?d=b:(a=1*a,d=a<0?"-"+c+(a*-1).toFixed(2):c+a.toFixed(2)),d},timeStampToDateString:function(a,b){return h.timeStampToDateString(a,b,!1)}},initialize:function(){this._super(),a.bindAll(this,"_onViewBillSuccess","getBill","printUsageDetails","getUsageDetails","downloadXlsx"),this._addMoreData(),setTimeout(function(){this.set("viewBillCurrentChargesVmStatus","initialized"),this.getBill()}.bind(this),0)},_addMoreData:function(){this.set("usageDetails",e.data)},_onViewBillSuccess:function(b,c){b.attributes&&!a.isUndefined(b.attributes.billtotalAmount)?(this.set("bill",b.attributes),this.set("isBillExist",!0),this.set("viewBillCurrentChargesVmStatus","currentBillChargesReceived")):this.set("viewBillCurrentChargesVmStatus","currentBillChargesFailed"),c&&"function"==typeof c&&c()},getBill:function(a){var b=this.get("customerId"),c=this.get("barId"),d=this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billNumber"),e=this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billClosedDate"),f=this;b&&c&&d&&e&&(this.set("viewBillCurrentChargesVmStatus","currentBillChargesInProgress"),this.set("isBillExist",!1),this.models.viewBillCurrentChargesModel.setQueryParams({bcd:e}),this.models.viewBillCurrentChargesModel.fetch({customerId:b,barId:c,billNumber:d,success:function(b,c){f._onViewBillSuccess(b,a)},error:function(a){return function(){a.set("viewBillCurrentChargesVmStatus","currentBillChargesFailed")}}(this)}))},payBill:function(){},printUsageDetails:function(){this.set("viewBillCurrentChargesVmStatus","printUsageDetailsInProgress"),this.printUsageDetailsDeferred=this.getUsageDetails(),this.printUsageDetailsDeferred.done(function(){this.set("viewBillCurrentChargesVmStatus","printUsageDetailsSuccess")}.bind(this))},getUsageDetails:function(){this.set("viewBillCurrentChargesVmStatus","getUsageDetailsInProgress");var a=this.get("currentCharge"),b=this.get("currentSubscription");if("UC"===a.type){var c=(this.get("dateFormat"),h.timeStampToDateString(a.start,"dd mmmm",!0)+" - "+h.timeStampToDateString(a.end,"dd mmmm yyyy",!0)),d=b.subscriptionId,e=b.no,f=this.get("accountId"),g=this.get("customerId"),i=this.get("barId"),j=this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billNumber"),k=this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billClosedDate");this.subViewModels.usageDetailsViewModel.set({customerId:g,outputFormat:"json",barId:i,billId:j,subscriptionId:d,serviceTypeID:a.name,bcd:k,pageIndex:this.get("pageIndex"),pageSize:this.get("pageSize"),phoneNumber:e,accountNumber:f,eventsPeriod:c});var l=this.subViewModels.usageDetailsViewModel.getUsageDetails();return l.then(function(){this.set("viewBillCurrentChargesVmStatus","getUsageDetailsSuccess")}.bind(this),function(){this.set("viewBillCurrentChargesVmStatus","getUsageDetailsFailure")}.bind(this)),l}},changePage:function(a,b,c){e.handleAction("changePage",a,b,c)},downloadXlsx:function(){var a=this.get("currentCharge"),b=this.get("currentSubscription");if("UC"===a.type){var c=(this.get("dateFormat"),h.timeStampToDateString(a.start,"dd mmmm",!0)+" - "+h.timeStampToDateString(a.end,"dd mmmm yyyy",!0)),d=b.subscriptionId,e=b.no,f=this.get("accountId"),g=this.get("customerId"),i=this.get("barId"),j=this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billNumber"),k=this.subViewModels.billInContextTopicViewModel.getValueByPath("billDetails.billClosedDate");this.subViewModels.usageDetailsViewModel.set({customerId:g,outputFormat:"xlsx",barId:i,billId:j,subscriptionId:d,serviceTypeID:a.name,bcd:k,phoneNumber:e,accountNumber:f,eventsPeriod:c}),this.subViewModels.usageDetailsViewModel.handleAction("downloadXlsx",0)}}})});
define("businesswidget/repository_l9_common/common/viewmodel/ViewBillNavigatorViewModel",["underscore","knockout","lightsaber","businesswidget/repository_l9_common/common/model/AccountBillsModel","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration"],function (a,b,c,d,e,f){return c.Core.ObservableViewModel.extend({models:{AccountBillsModel:d},defaults:{customerId:null,accountId:null,selectedBillNumber:null,billList:null},initialize:function(){this._super()},config:{actions:{getBillList:function(a){var b=this.get("customerId"),c=this.get("accountId"),d=this;b&&c&&this.models.AccountBillsModel.fetch({id:b,accountsID:c,success:function(b,e){var f=e.ImplBillsOutput.billList[c]||null;d.set("selectedBillNumber",f?f[0].billNumber:null),d.set("billList",f),a&&"function"==typeof a&&a()}})},changeBill:function(a,b){return b.billNumber!==this.get("selectedBillNumber")&&this.set("selectedBillNumber",b.billNumber),!0}}}})});
define("businesswidget/repository_l9_common/common/model/BillingArrangementHeaderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"billing/billing-arrangement/:billingAccountNumber/bar-header",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/GetEbillDeRegistrationResonsModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"billing/ebillDeRegistrationResons",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/CheckAndUpdateAutoLaunchModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/ordering/customer/:customerId/msisdn/:serviceId/managepaperbill",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplCheckNUpdateAutoLaunchResInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ImplChangeSmsNotificationModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"ebill/customer/:customerId/account/:faId/billing-arrangement/:barId/change-sms-notification-status",rest:{defaults:{method:"POST"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/ChangeBillPreferenceViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","businesswidget/repository_l9_common/common/model/BillingArrangementHeaderModel","businesswidget/repository_l9_common/common/model/GetFaidEasyMobileInfoModel","businesswidget/repository_l9_common/common/model/UpdateDeliveryMethodModel","businesswidget/repository_l9_common/common/model/CreateInteractionModel","businesswidget/repository_l9_common/common/model/GetEbillDeRegistrationResonsModel","businesswidget/repository_l9_common/common/model/CheckAndUpdateAutoLaunchModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","businesswidget/repository_l9_common/common/model/NotificationPreferencesModel","businesswidget/repository_l9_common/common/model/viewServiceDetailModel","businesswidget/repository_l9_common/common/model/ImplChangeSmsNotificationModel","businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ViewUpdateCustomerProfileWidgetViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){
var u=b.Core.ObservableViewModel.extend({models:{GetbillingAccountDetailedListModel:g,billingArrangementHeaderModel:h,getFaidEasyMobileInfoModel:i,updateDeliveryMethod:j,createInteractionModel:k,getEbillDeRegistrationResonsModel:l,checkAndUpdateAutoLaunchModel:m,viewServiceDetailModel:q,viewServiceListModel:s,notificationPreferencesModel:p,implChangeSmsNotificationModel:r},subViewModels:{contactInContextTopicViewModel:f,onePassTopicViewModel:n,customerInContextTopicViewModel:e,viewUpdateCustomerProfileWidgetViewModel:t},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactInfo:"subViewModels.viewUpdateCustomerProfileWidgetViewModel.contactInfo",options:{twoWay:!1,setOnBind:!0}}],defaults:{accounts:[],type:null,changePreferenceVmStatus:"",reasons:[],customerIds:[],selectedAccount:"",ebillDeregistrationReason:"",ebillDeregistrationReasonOther:"",ebillInd:!1,isAllEasyMobile:!0,isAnyEasyMobileExsist:!1,isProdListRequired:!1,products:null,mcssNotifications:null,autoLaunchBoCatalogIds:b.Core.Configuration.get("autoLaunchBoCatalogIds"),userInfo:null},initialize:function(a){this.on("change:nric change:contactId",function(a){this.get("nric")&&this.get("contactId")&&this.fetchData()}.bind(this),this),this.set("changePreferenceVmStatus","changeBillPreferenceInitialize"),this.productsDeferred=$.Deferred(),this.autoLaunchDeferred=$.Deferred()},fetchData:function(){var a=this.getCustomerType(this.subViewModels.onePassTopicViewModel.get("customerIdType"));this.models.GetbillingAccountDetailedListModel.set("type",a);var b=this.models.GetbillingAccountDetailedListModel.fetch({id:this.get("nric"),error:d.bind(this.onAccountLoadFailure,this)}),c=this.models.notificationPreferencesModel.fetch({contactId:this.get("contactId")});$.when(b,c).then(function(a,b){var c=a[0].ImplBillingAccountDetailsResponse.billingAccountDetails;this.set("accounts",c);var d=b[0].ImplContactNotificationPreferences;this.set("mcssNotifications",d),this.billingAccountDetailedListSuccess()}.bind(this),function(){this.onAccountLoadFailure()}.bind(this))},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a},getEbillDeRegistrationResonsModelSuccess:function(a,b){this.set("reasons",b.eBillDeRegistraionReasons)},isEbillNric:function(){var a=this.get("accounts"),b=d.filter(a,function(a){return 0==a.isEasyMobile}),c=d.find(b,function(a){return"E_BILL"!==a.billType&&79===a.faStatus});return!c},billingAccountDetailedListSuccess:function(a,b){var c=this,e=this.get("accounts"),f=this.get("mcssNotifications");this.setTypeIndicatorFlag(null),this.set("changePreferenceVmStatus","easyMobileAndFaidLoaded"),this.set("ebillInd",this.isEbillNric()),this.set("customerIds",d.unique(d.pluck(e,"customerId")));var g=this.get("accounts");d.each(g,function(a){if("SUMMARY"==a.billType&&(a.currentChargeDetailsInd=!0),a.isEasyMobile||c.set("isAllEasyMobile",a.isEasyMobile),a.isEasyMobile&&c.set("isAnyEasyMobileExsist",a.isEasyMobile),"E_BILL"!==a.billType&&!a.isEasyMobile||"Y"!==a.billPassword?a.passwordProtection=!1:a.passwordProtection=!0,"METH_EBILL"===a.deliveryMethod?a.paperBillInd=!0:"E_BILL"===a.billType?a.paperBillInd="METH_PAPER"===a.deliveryMethod:a.paperBillInd=!1,a.paperBillInd&&!c.get("isProdListRequired")&&(c.set("isProdListRequired",!0),c.fetchProductList()),("E_BILL"===a.billType||a.isEasyMobile)&&f&&f.implBarNotificationPreferences){var b=d.find(f.implBarNotificationPreferences,function(b){return b.barId===a.billingAccountNumber});b&&(a.smsNotification=b.isSmsNotify)}}),this.set("accounts",g),this.set("changePreferenceVmStatus","accountNotificationDataSet"),this.fetchAutoLaunchDetails(),$.when.call(c,c.productsDeferred,c.autoLaunchDeferred).done(function(){d.each(c.get("accounts"),function(a){c.fetchProductDetails(a)})})},fetchAutoLaunchDetails:function(){var a=this,b=[];d.each(this.get("accounts"),function(c){c.paperBillInd&&d.each(c.subscribers,function(e){if("WS"==e.subscriberType||"MOB"==e.subscriberType){var f={serviceId:e.subscriberResourceVal,executionMode:"READ"},g=$.Deferred();a.models.checkAndUpdateAutoLaunchModel.setQueryParams({faId:c.faid}),a.models.checkAndUpdateAutoLaunchModel.save({customerId:c.customerId,serviceId:e.subscriberResourceVal,ImplCheckNUpdateAutoLaunchResInput:f},{success:function(a,b,c,f){return function(g,h){if(h&&h.ImplCheckNUpdateAutoLaunchResOutput){var i=a.get("accounts"),j=d.find(i,function(a){return c.billingAccountNumber==a.billingAccountNumber});j&&(e=d.find(j.subscribers,function(a){return a.subscriberResourceVal==f}),e&&(h.ImplCheckNUpdateAutoLaunchResOutput&&"SUCCESS"===h.ImplCheckNUpdateAutoLaunchResOutput.responseStatus?"RM"===h.ImplCheckNUpdateAutoLaunchResOutput.autoLaunchStatus?e.subscriptionBillInd=!1:"AD"===h.ImplCheckNUpdateAutoLaunchResOutput.autoLaunchStatus?e.subscriptionBillInd=!0:e.subscriptionBillInd=void 0:e.subscriptionBillInd=void 0)),a.set("accounts",i)}b.resolve()}}(a,g,c,e.subscriberResourceVal),error:function(a,b){return function(){b.resolve()}}(a,g)}),b.push(g)}})}),$.when.apply(a,b).done(function(){a.autoLaunchDeferred.resolve()})},fetchProductList:function(){var a=this,b=[];d.each(this.get("customerIds"),function(c){var d=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:c,success:function(b,c){if(c.Products&&c.Products.products){var e=a.get("products");e?(e=e.concat(c.Products.products),a.set("products",e)):a.set("products",c.Products.products)}return d.resolve()}.bind(d),error:function(b,c){return a.set("products",null),d.resolve()}.bind(d)}),b.push(d)}),$.when.apply(a,b).done(function(){a.productsDeferred.resolve()})},fetchProductDetails:function(a){var b=this,c=[];d.each(a.subscribers,function(e){if(("WS"==e.subscriberType||"MOB"==e.subscriberType)&&void 0===e.subscriptionBillInd){var f=d.find(b.get("products"),function(a){return a.serviceId==e.subscriberResourceVal});f?b.getModel("viewServiceDetailModel").fetch({customerId:a.customerId,productId:f.id,success:d.bind(b.setSubscriptionInd,b,a,e),error:function(){}}):c.push(e.subscriberID)}}),a.subscribers=d.filter(a.subscribers,function(a){return $.inArray(a.subscriberID,c)===-1});var e=this.get("accounts"),f=d.findWhere(e,{billingAccountNumber:a.billingAccountNumber}),g=d.indexOf(e,f);e[g]=a,this.set("accounts",e)},setSubscriptionInd:function(a,b,c,e){var f=this.get("accounts"),g=d.find(f,function(b){return b.billingAccountNumber==a.billingAccountNumber});g&&(b=d.find(g.subscribers,function(a){return a.subscriberResourceVal===b.subscriberResourceVal}));var h=this.get("autoLaunchBoCatalogIds"),i=this.seachBO(e.Product.services,h);b.subscriptionBillInd=!!i,this.set("accounts",f)},seachBO:function(a,b){for(var c=0;c<a.length;c++){var e=a[c];if(e.pricePackages&&e.pricePackages.length>0)for(var f=e.pricePackages,g=0;g<f.length;g++)if(d.contains(b,f[g].catalogItemID))return f[g];if(e.containedServices&&e.containedServices.length>0){var h=this.seachBO(e.containedServices,b);if(h)return h}}},onAccountLoadFailure:function(){this.set("changePreferenceVmStatus","accountsFailed")},setTypeIndicatorFlag:function(a){var b=this.get("accounts");if(a){var c=d.find(b,function(b){return b.billingAccountNumber===a});d.each(c.subscribers,function(a){a.subscriptionBillInd=!!a.subscriptionBillInd}),c.currentChargeDetailsInd=!1,c.smsNotification=!1,c.passwordProtection=!1,c.paperBillInd=!1}else d.each(b,function(a){a.currentChargeDetailsInd=!1,a.smsNotification=!1,a.passwordProtection=!1,a.paperBillInd=!1,d.each(a.subscribers,function(a){a.subscriptionBillInd=!1})});this.set("accounts",b)},getAccountNumberHeader:function(a,b,c){var e=this;b||e.setTypeIndicatorFlag(a);var f=this.get("accounts");d.each(f,function(b){if(b.billingAccountNumber==a){if(b.isEasyMobile||e.get("ebillInd")||c&&c.ImplBillingArrangementHeaderResponse&&"E_BILL"==c.ImplBillingArrangementHeaderResponse.billType&&e.set("ebillInd",!0),c&&c.ImplBillingArrangementHeaderResponse){var f=c.ImplBillingArrangementHeaderResponse;f&&(f.deliveryMethod&&(b.deliveryMethod=f.deliveryMethod),f.billType&&(b.billType=f.billType),f.mcssBillPassword&&(b.billPassword=f.mcssBillPassword))}var g=e.get("mcssNotifications");if(("E_BILL"===b.billType||b.isEasyMobile)&&g&&g.implBarNotificationPreferences){var h=d.find(g.implBarNotificationPreferences,function(a){return a.barId===b.billingAccountNumber});h&&(b.smsNotification=h.isSmsNotify),b.currentChargeDetailsInd=!1,b.paperBillInd="METH_PAPER"==b.deliveryMethod,b.passwordProtection="Y"===b.billPassword}else{b.currentChargeDetailsInd="SUMMARY"===b.billType,b.paperBillInd=!1,b.passwordProtection=!1;var h=d.find(g.implBarNotificationPreferences,function(a){return a.barId===b.billingAccountNumber});h&&(b.smsNotification=h.isSmsNotify)}}}),e.set("accounts",f)},changePreferenceForPaperBill:function(a){var b=[],c=null,e=this;e.isEbillFlow=!!a&&a,this.set("changePreferenceVmStatus","changePaperBillPreferenceInitialize");var f=this.get("selectedAccount");if(f.paperBillInd&&!a){c={barId:f.billingAccountNumber,intFlowType:"paperBill",deliveryMethod:"METH_PAPER",mcssBillPassword:f.passwordProtection?"Y":"N",nickName:"Account Name"==f.nickName?"":f.nickName,avatarImageId:f.avatarImageId,billType:f.billType};var g=$.Deferred();g.resolve(),b.push(g)}else{if(!a){var c={barId:f.billingAccountNumber,intFlowType:"METH_EBILL"==f.deliveryMethod?"waiverPaperBill":"paperBill",deliveryMethod:"METH_NON_PAPER",mcssBillPassword:f.passwordProtection?"Y":"N",nickName:"Account Name"==f.nickName?"":f.nickName,avatarImageId:f.avatarImageId,billType:f.billType},g=$.Deferred();b.push(g),g.resolve()}d.each(f.subscribers,function(a){if(("WS"==a.subscriberType||"MOB"==a.subscriberType)&&a.subscriptionBillInd){isSubscriptionPaperBillOn=!0,e.set("selectedSubscription",a);var c=$.Deferred();b.push(c),e.changePreferenceForSubscription(c,!0)}})}b&&b.length>0&&$.when.apply(e,b).done(function(){e.UpdateDeliveryMethod("PaperBill",c,e.isEbillFlow)})},changePreferenceForSubscription:function(a,b){var c=this.get("selectedAccount"),d=this.get("selectedSubscription"),e=$.Deferred();if("WS"==d.subscriberType||"MOB"==d.subscriberType){var f={serviceId:d.subscriberResourceVal,action:"",billingOfferCode:this.get("autoLaunchBoCatalogIds")[0],executionMode:"WRITE"};b&&d.subscriptionBillInd?f.action="RM":d.subscriptionBillInd?f.action="AD":f.action="RM",this.checkAndUpdateAutoLaunch(f,c,f.serviceId,e,b||!1)}if("METH_EBILL"===c.deliveryMethod){var g={barId:c.billingAccountNumber,intFlowType:"waiverPaperBill",deliveryMethod:"METH_PAPER",mcssBillPassword:c.passwordProtection?"Y":"N",nickName:"Account Name"==c.nickName?"":c.nickName,avatarImageId:c.avatarImageId,billType:c.billType};this.UpdateDeliveryMethod("waiverPaperBill",g,!1)}return $.when.call(this,e).done(function(){if(a)return a.resolve()}),a},isValidContactMobileNumber:function(){var a=this.getValueByPath("contactInfo");if(a){var b=a.phone;if(b.length>8)return!1;var c=/^[(]{0,1}[8|9]{1}[)]{0,1}[0-9]{3}[-\s.]{0,1}[0-9]{4}/;return c.test(b)}return!1},changePreferenceForEbill:function(){var a,b=this;this.set("changePreferenceVmStatus","changeEbillPreferenceInitialize");var c=this.get("accounts");c=d.filter(c,function(a){return 79===a.faStatus});var e=d.clone(this.get("mcssNotifications")),f=[],g=!1;if(c&&c.length){if(d.each(c,function(c){if(!c.isEasyMobile){var h=$.Deferred();if(b.get("ebillInd"))a={barId:c.billingAccountNumber,billType:"E_BILL",deliveryMethod:"METH_NON_PAPER",mcssBillPassword:"Y",nickName:"Account Name"==c.nickName?"":c.nickName,avatarImageId:c.avatarImageId};else{var i=b.get("ebillDeregistrationReason");a={barId:c.billingAccountNumber,billType:"SUMMARY_WITH_COND_DTLS",deliveryMethod:"METH_PAPER",mcssBillPassword:"Y",nickName:"Account Name"==c.nickName?"":c.nickName,avatarImageId:c.avatarImageId,deRegisterReason:i},"Others"===i&&(a.otherComment=b.get("ebillDeregistrationReasonOther")),b.set("selectedAccount",c),b.changePreferenceForPaperBill(!0)}if(e&&e.implBarNotificationPreferences){var j=d.find(e.implBarNotificationPreferences,function(a){return a.barId===c.billingAccountNumber});j&&(j.isSmsNotify=b.get("ebillInd")&&b.isValidContactMobileNumber())}b.set("changePreferenceVmStatus","changeEbillPreferenceInProgress"),b.models.updateDeliveryMethod.setQueryParams({intFlowType:"ebill",skipNotification:g}),b.models.updateDeliveryMethod.save({customerId:c.customerId,faId:c.faid,barId:a.barId,ImplBillingDataInput:a},{success:function(a,b,c){return function(){var c={};c.ImplBillingArrangementHeaderResponse=b,a.resolve(c)}}(h,a,b),error:function(b,c,d){return function(c){b.reject(a)}}(h,c,b)}),f.push(h),g=!0}}),e&&e.implBarNotificationPreferences){var h=$.Deferred();b.models.notificationPreferencesModel.save({contactId:b.get("contactId"),ImplContactNotificationPreferences:e}).then(function(){this.set("mcssNotifications",e),h.resolve()}.bind(this),function(){h.resolve()}.bind(this)),f.push(h)}$.when.apply(b,f).then(function(){for(var a=0;a<arguments.length;a++){var c=arguments[a];c&&b.getAccountNumberHeader(c.ImplBillingArrangementHeaderResponse.barId,null,c)}b.set("changePreferenceVmStatus","changeEbillPreferenceSuccess")}.bind(this),function(){this.set("ebillInd",!this.get("ebillInd")),d.each(c,function(a){a.isEasyMobile||b.getAccountNumberHeader(a.billingAccountNumber)}),this.set("changePreferenceVmStatus","changeEbillPreferencePreferenceFailed")}.bind(this))}else setTimeout(function(){b.set("changePreferenceVmStatus","changeEbillPreferenceSuccess")},0)},changePreferenceForPrs:function(){var a=null;this.set("changePreferenceVmStatus","changePrsPreferenceInitialize");var b=this.get("selectedAccount");if(this.get("ebillInd"))this.set("changePreferenceVmStatus","ebillUserToPrsError");else{var c=b.billType;c=b.currentChargeDetailsInd?"E_BILL"===c?c:"SUMMARY":"E_BILL"===c?c:"SUMMARY_WITH_COND_DTLS",a={barId:b.billingAccountNumber,billType:c,deliveryMethod:b.deliveryMethod,intFlowType:"prs",mcssBillPassword:"Y",nickName:"Account Name"==b.nickName?"":b.nickName,avatarImageId:b.avatarImageId},this.UpdateDeliveryMethod("Prs",a)}},changePreferenceForSmsNotification:function(){this.set("changePreferenceVmStatus","changeSmsNotificationPreferenceInitialize");var a=this.get("selectedAccount"),b=this.get("mcssNotifications");if(b&&b.implBarNotificationPreferences)var c=d.find(b.implBarNotificationPreferences,function(b){return b.barId===a.billingAccountNumber});this.models.implChangeSmsNotificationModel.setQueryParams({isSmsNotify:a.smsNotification}),this.models.implChangeSmsNotificationModel.save({customerId:a.customerId,faId:a.faid,barId:a.billingAccountNumber}).then(d.bind(function(a,c,d){a.isSmsNotify=c.smsNotification,this.set("mcssNotifications",b),this.set("changePreferenceVmStatus","changeSmsPreferenceSuccess")},this,c,a),d.bind(function(a,b){this.getAccountNumberHeader(a.barId),this.set("changePreferenceVmStatus","changeSmsPreferenceFailed")},this,c))},changePreferenceForPasswordProtection:function(){this.set("changePreferenceVmStatus","changePasswordProtectionInitialize");var a=this.get("selectedAccount"),b={barId:a.billingAccountNumber,intFlowType:"passwordProtection",mcssBillPassword:a.passwordProtection?"Y":"N",nickName:"Account Name"==a.nickName?"":a.nickName,billType:a.billType,deliveryMethod:a.deliveryMethod,avatarImageId:a.avatarImageId};this.UpdateDeliveryMethod("PasswordProtection",b)},UpdateDeliveryMethod:function(a,b,c){var e=this.get("selectedAccount");this.set("changePreferenceVmStatus","change"+a+"PreferenceInProgress"),this.models.updateDeliveryMethod.setQueryParams({intFlowType:b.intFlowType}),delete b.intFlowType,this.models.updateDeliveryMethod.save({customerId:e.customerId,faId:e.faid,barId:b.barId,ImplBillingDataInput:b},{success:d.bind(this.updateDeliveryMethodSuccess,this,a,b,c),error:d.bind(this.updateDeliveryMethodError,this,a,b)})},updateDeliveryMethodSuccess:function(a,b,c,d,e){var e={};e.ImplBillingArrangementHeaderResponse=b,this.getAccountNumberHeader(b.barId,null,e),c||this.set("changePreferenceVmStatus","change"+a+"PreferenceSuccess")},updateDeliveryMethodError:function(a,b,c,d){this.getAccountNumberHeader(b.barId),this.set("changePreferenceVmStatus","changeBillPreferencePreferenceFailed"),this.set("changePreferenceVmStatus","change"+a+"PreferenceFailed")},createInteraction:function(a){var b={title:"update contact",medium:"Self Service",channel:"Web",notes:"Mr.",userId:this.get("contactId"),direction:{value:"1"},endTime:"02021989",startTime:"01011989",topic:[{reason1:a,reason2:"New Acquisition Made",result:"Data Cost",protocol:"Billing"}],contactId:this.get("contactId")};this.models.createInteractionModel.save({contactId:this.get("contactId"),ImplCreateInteractionInput:b,success:function(){console.log("Case created")},error:function(){console.log("Error Occured")}})},checkAndUpdateAutoLaunch:function(a,b,c,e,f){return this.set("changePreferenceVmStatus","checkAndUpdateAutoLaunchInitialized"),this.models.checkAndUpdateAutoLaunchModel.setQueryParams({faId:b.faid}),this.models.checkAndUpdateAutoLaunchModel.save({customerId:b.customerId,serviceId:c,ImplCheckNUpdateAutoLaunchResInput:a},{success:d.bind(this.checkAndUpdateAutoLaunchSuccess,this,b,e,f,c),error:d.bind(this.checkAndUpdateAutoLaunchError,this,b,e,f,c)}),e},checkAndUpdateAutoLaunchSuccess:function(a,b,c,e,f,g){if(g&&g.ImplCheckNUpdateAutoLaunchResOutput){var h=this.get("accounts"),i=d.find(h,function(b){return a.billingAccountNumber==b.billingAccountNumber});if(i&&(subscription=d.find(i.subscribers,function(a){return a.subscriberResourceVal==e}),subscription))if(g.ImplCheckNUpdateAutoLaunchResOutput&&"SUCCESS"===g.ImplCheckNUpdateAutoLaunchResOutput.responseStatus)if("RM"===g.ImplCheckNUpdateAutoLaunchResOutput.autoLaunchStatus)subscription.subscriptionBillInd=!1;else if("AD"===g.ImplCheckNUpdateAutoLaunchResOutput.autoLaunchStatus)subscription.subscriptionBillInd=!0;else if("NONE"===g.ImplCheckNUpdateAutoLaunchResOutput.autoLaunchStatus){var j=f.get("ImplCheckNUpdateAutoLaunchResInput");"RM"===j.action?subscription.subscriptionBillInd=!1:subscription.subscriptionBillInd=!0}else subscription.subscriptionBillInd=subscription.subscriptionBillInd;else subscription.subscriptionBillInd=!subscription.subscriptionBillInd;return this.set("accounts",h),c||this.set("changePreferenceVmStatus","checkAndUpdateAutoLaunchSuccess"),b.resolve()}},checkAndUpdateAutoLaunchError:function(a,b,c,d,e,f){return c||this.set("changePreferenceVmStatus","checkAndUpdateAutoLaunchError"),b.resolve()}});return u});
define("businesswidget/repository_l9_common/common/model/PVASValidateTopUpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/pvas/contact-person/:contactId/subscription/:subscriptionId/validate-top-up",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}});return d});
define("businesswidget/repository_l9_common/common/model/PVASCreateTopUpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/pvas/contact-person/:contactId/subscription/:subscriptionId/create-top-up",rest:{defaults:{method:"POST",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},payload:["ImplPrepaidTopUpRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/PVASRetrieveTopUpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/pvas/contact-person/:contactId/subscription/:subscriptionId/retrieve-top-up",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}});return d});
define("businesswidget/repository_l9_common/common/model/PVASUpdateTopUpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/pvas/contact-person/:contactId/subscription/:subscriptionId/update-top-up",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"PUT",payload:["ImplPrepaidTopUpRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/PVASCancelTopUpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/pvas/contact-person/:contactId/subscription/:subscriptionId/cancel-top-up",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"PUT",payload:["ImplPrepaidTopUpRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/PVASSubscriptionsModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/pvas/contact-person/:contactId/get-subscriptions",rest:{defaults:{method:"POST",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},payload:["ImplGetSubscriptionsInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/PrepaidTopUpViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/common/model/PVASValidateTopUpModel","businesswidget/repository_l9_common/common/model/PVASCreateTopUpModel","businesswidget/repository_l9_common/common/model/PVASRetrieveTopUpModel","businesswidget/repository_l9_common/common/model/PVASUpdateTopUpModel","businesswidget/repository_l9_common/common/model/PVASCancelTopUpModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/model/viewServiceDetailModel","businesswidget/repository_l9_common/common/model/PVASSubscriptionsModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=a.Core.ObservableViewModel.extend({models:{findCallerModel:c,viewUpdateCustomerProfileModel:d,pVASValidateTopUpModel:g,pVASCreateTopUpModel:h,pVASRetrieveTopUpModel:i,pVASUpdateTopUpModel:j,pVASCancelTopUpModel:k,pVASSubscriptionsModel:o,viewServiceDetailModel:n,viewServiceListModel:m},subViewModels:{customerInContextTopicViewModel:e,individualInContextTopicViewModel:f,onePassTopicViewModel:l},defaults:{customerId:null,contactId:null,prepaidTopupVmStatus:null,mobileSubscriber:null,subscription:null,delSubscriber:null,planAgainstSubscription:null,recurringPlans:null,createInteractionData:null,startInteractionTime:null,contactDetails:null,prepaidNumber:null,selectPlan:null,selectedServiceNumber:null,transactionId:null,emailTemplates:null,currentPlan:null},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){var a=this;b.bindAll(this,"findPrepaidTopupSubscriber","onFindCallerSuccess","onFindCallerFailure","findPrepaidSubscriber","findEmailId","onGetSubscriptionFailure","retrieveTopUp","getSubscriptions"),a.loadfindCallerSubDeferred=$.Deferred(),a.loadFVSubDeferred=$.Deferred(),this.on("change:contactId",this.findPrepaidTopupSubscriber),
this.set("prepaidTopupVmStatus","prepaidTopupInitialized"),$.when(a.loadfindCallerSubDeferred,a.loadFVSubDeferred).done(function(){a.getSubscriptions()})},findPrepaidTopupSubscriber:function(){if(this.get("contactId")){var a={implContactDetails:{contactId:this.get("contactId")}};this.getModel("findCallerModel").save({ImplFindCallerByContactInput:a},{success:this.onFindCallerSuccess,error:this.onFindCallerFailure})}},onFindCallerSuccess:function(a,c){var d=this;if(c.ImplFindCallerByContactOutput.contactCustomerDetails){d.findPrepaidSubscriber(c.ImplFindCallerByContactOutput.contactSubscriptionDetails);var e=b.find(c.ImplFindCallerByContactOutput.contactSubscriptionDetails,function(a){if("FV"==a.lineOfBusiness)return a});e?d.getModel("viewServiceListModel").fetch({customerId:d.get("customerId"),success:b.bind(d.onLoadServicesSuccess,d,e),error:function(a,b){d.set("prepaidTopupVmStatus","productRestFailure")}}):d.loadFVSubDeferred.resolve()}},onLoadServicesSuccess:function(a,c,d){var e=this,d=d.Products?d.Products.products:{},f=b.find(d,function(b){return b.serviceId==a.primaryResource});f?this.models.viewServiceDetailModel.fetch({customerId:this.get("customerId"),productId:f.id,success:b.bind(this.onProductDetailsReceived,this,a),error:function(){e.set("prepaidTopupVmStatus","productRestFailure")}}):this.loadFVSubDeferred.resolve(),this.set("prepaidTopupVmStatus","productRestSuccess")},onProductDetailsReceived:function(a,c,d){var e=!1;if(d.Product&&d.Product.services&&d.Product.services.length>0&&b.each(d.Product.services,function(a){if(a.parameters&&!e){var c=b.find(a.parameters,function(a){return"8609342"==a.catalogId&&"Copper without ADSL"==a.valueName});e=!!c}}),e){var f=this.get("subscription");f=f.concat(a),this.set("subscription",f)}this.set("prepaidTopupVmStatus","productDetailsRestSuccess"),this.loadFVSubDeferred.resolve()},onFindCallerFailure:function(){this.set("prepaidTopupVmStatus","findCallerFailed")},findPrepaidSubscriber:function(a){var c=b.filter(a,function(a){return"Postpaid"==a.subType}),d=b.filter(c,function(a){if("MOB"==a.lineOfBusiness||"Mobile"==a.lineOfBusiness||"WS"==a.lineOfBusiness)return a}),e=b.filter(c,function(a){if("FV"==a.lineOfBusiness)return a});this.set("mobileSubscriber",d),this.set("delSubscriber",e);var f=d.concat(e);this.set("subscription",f),this.loadfindCallerSubDeferred.resolve()},getSubscriptions:function(){var a=this,c=a.getModel("pVASSubscriptionsModel");c.set({contactId:a.get("contactId")});var d=this.get("subscription");d&&d.length<=0?this.set("prepaidTopupVmStatus","nosubscription"):this.set("prepaidTopupVmStatus","subscriptionSet");var e=[];b.each(d,function(a){a.primaryResource&&e.push("65"+a.primaryResource)});var f={ImplGetSubscriptionsInput:{subscriptionIds:e}};c.save(f,{success:function(b,c){a.set("recurringPlans",c.ImplValidateRetrieveTopUpRestOutput.implGetSubscriptionsOutput),d&&d.length&&a.retrieveTopUp(d)},error:b.bind(a.onGetSubscriptionFailure,a)})},retrieveTopUp:function(a){var c=this,d=c.getModel("pVASRetrieveTopUpModel");d.set({contactId:c.get("contactId"),subscriptionId:a[0].subscriberId}),d.fetch({success:b.bind(c.onRetrieveTopUpSuccess,c),error:b.bind(c.onGetSubscriptionFailure,c)})},onRetrieveTopUpSuccess:function(a,b){this.set("planAgainstSubscription",b.ImplValidateRetrieveTopUpRestOutput.implGetProductsOutput),this.set("prepaidTopupVmStatus","allPlansSet"),this.findEmailId(),this.set("prepaidTopupVmStatus","recurringPlansPlansSet")},findEmailId:function(){var a=this;a.models.viewUpdateCustomerProfileModel.set("id",a.get("contactId")),a.models.viewUpdateCustomerProfileModel.fetch({success:function(b,c){a.set("contactDetails",c.ImplContactPersonOutput.implContactPerson),a.set("prepaidTopupVmStatus","mailidFound")},error:function(b,c){a.set("prepaidTopupVmStatus","mailid doesnt retrived")}})},onGetSubscriptionFailure:function(){this.set("prepaidTopupVmStatus","subscriptionDetailsFailed")},validateMobile:function(){var a=this;a.set("prepaidTopupVmStatus","validRecipientNumberInProgress");var b=a.get("prepaidNumber"),c=a.getModel("pVASValidateTopUpModel");c.set({contactId:a.get("contactId"),subscriptionId:"65"+b}),c.fetch({success:function(b,c){"000"==c.ImplValidateRetrieveTopUpRestOutput.implValidateRecipientOutput.code||0==c.ImplValidateRetrieveTopUpRestOutput.implValidateRecipientOutput.code?a.set("prepaidTopupVmStatus","validRecipientNumber"):a.set("prepaidTopupVmStatus","notValidRecipientNumber")},error:function(b,c){a.set("prepaidTopupVmStatus","notValidRecipientNumber")}})},modifyPrepaidTopup:function(){var a=this,b=a.get("currentPlan"),c=a.get("selectPlan"),d=a.get("prepaidNumber"),e={ImplPrepaidTopUpRestInput:{isRecurrent:!0,newProductCode:c.opId+":"+c.planId,productCode:b.opId+":"+b.planId,newProductPrice:c.price,customer:"65"+a.get("selectedServiceNumber"),newProductDescription:c.description,nric:a.subViewModels.onePassTopicViewModel.get("nric")}},f=a.getModel("pVASUpdateTopUpModel");f.set({contactId:a.get("contactId"),subscriptionId:d}),f.save(e,{success:function(b,c){c.ImplPrepaidTopUpRestOutput&&c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput&&a.set("transactionId",c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput.interactionId),a.set("prepaidTopupVmStatus","topUpmodified"),a.set("updatedTopupData",c.ImplPrepaidTopUpRestOutput.implSubscriptionOutput)},error:function(b,c){a.set("prepaidTopupVmStatus","topUpmodificationFailed")}})},cancelPrepaidTopup:function(){var a=this,b=a.get("selectPlan");a.set("transactionId",""),a.set("prepaidTopupVmStatus","InProgress");var c=(a.get("prepaidNumber"),{ImplPrepaidTopUpRestInput:{isRecurrent:!0,productCode:b.optId+":"+b.planId,productPrice:b.price,customer:b.customer,productDescription:b.description,nric:a.subViewModels.onePassTopicViewModel.get("nric")}}),d=a.getModel("pVASCancelTopUpModel");d.set({contactId:a.get("contactId"),subscriptionId:b.user}),d.save(c,{success:function(b,c){c.ImplPrepaidTopUpRestOutput&&c.ImplPrepaidTopUpRestOutput.success?(a.set("transactionId",c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput.interactionId),a.set("prepaidTopupVmStatus","cancelTopupSuccessfull")):a.set("prepaidTopupVmStatus","cancelTopupFailed")},error:function(b,c){a.set("prepaidTopupVmStatus","cancelTopupFailed")}})},setOneTimeTopup:function(){var a=this,b=a.get("selectPlan"),c=a.get("prepaidNumber");a.set("transactionId",""),a.set("prepaidTopupVmStatus","InProgress");var d={ImplPrepaidTopUpRestInput:{isRecurrent:!1,productCode:b.opId+":"+b.planId,productPrice:b.price,customer:"65"+a.get("selectedServiceNumber"),productDescription:b.description,nric:a.subViewModels.onePassTopicViewModel.get("nric")}},e=a.getModel("pVASCreateTopUpModel");e.set({contactId:a.get("contactId"),subscriptionId:"65"+c}),e.save(d,{success:function(b,c){c.ImplPrepaidTopUpRestOutput&&c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput?(a.set("prepaidTopupVmStatus","oneTimeTopupSuccessfull"),a.set("transactionId",c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput.interactionId)):a.set("prepaidTopupVmStatus","oneTimeTopupFailed")},error:function(b,c){a.set("prepaidTopupVmStatus","oneTimeTopupFailed")}},a)},setRecurrentTopup:function(){var a=this,b=a.get("selectPlan"),c=a.get("prepaidNumber");a.set("transactionId",""),a.set("prepaidTopupVmStatus","InProgress");var d={ImplPrepaidTopUpRestInput:{isRecurrent:!0,productCode:b.opId+":"+b.planId,productPrice:b.price,customer:"65"+a.get("selectedServiceNumber"),productDescription:b.description,nric:a.subViewModels.onePassTopicViewModel.get("nric")}},e=a.getModel("pVASCreateTopUpModel");e.set({contactId:a.get("contactId"),subscriptionId:"65"+c}),e.save(d,{success:function(b,c){c.ImplPrepaidTopUpRestOutput&&c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput?(a.set("transactionId",c.ImplPrepaidTopUpRestOutput.implBaseRestIntrxnOutput.interactionId),a.set("prepaidTopupVmStatus","recurrentTopupSuccessfull")):a.set("prepaidTopupVmStatus","recurrentTopupFailed")},error:function(b,c){a.set("prepaidTopupVmStatus","oneTimeTopupFailed")}},a)}});return p});
define("l9_common.billingCareWidgets",{"billingAccountsListWidget":"businesswidget/repository_l9_common/widgetsLibrary/billingAccountsListWidget/web/BillingAccountsListWidget","createBillingAccountWidget":"businesswidget/repository_l9_common/widgetsLibrary/createBillingAccountWidget/web/createBillingAccountWidget","payBillButtonsWidget":"businesswidget/repository_l9_common/widgetsLibrary/payBillButtonsWidget/web/PayBillButtonsWidget","paymentHistoryWidget":"businesswidget/repository_l9_common/widgetsLibrary/paymentHistoryWidget/web/paymentHistoryWidget","payBillWidget":"businesswidget/repository_l9_common/widgetsLibrary/payBillWidget/web/PayBillWidget","BillSummaryChargesWidget":"businesswidget/repository_l9_common/widgetsLibrary/BillSummaryChargesWidget/web/BillSummaryChargesWidget","selectPaymentMethodWidget":"businesswidget/repository_l9_common/widgetsLibrary/selectPaymentMethodWidget/web/selectPaymentMethodWidget","usageDetailsWidget":"businesswidget/repository_l9_common/widgetsLibrary/usageDetailsWidget/web/usageDetailsWidget","viewBillCurrentChargesWidget":"businesswidget/repository_l9_common/widgetsLibrary/viewBillCurrentChargesWidget/web/ViewBillCurrentChargesWidget","viewBillNavigatorWidget":"businesswidget/repository_l9_common/widgetsLibrary/viewBillNavigatorWidget/web/ViewBillNavigatorWidget","changeBillPreferenceWidget":"businesswidget/repository_l9_common/widgetsLibrary/ChangeBillPreferenceWidget/web/ChangeBillPreferenceWidget","implLoginViewModel":"businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","prepaidTopicWidget":"businesswidget/repository_l9_common/common/viewmodel/business/PrepaidTopUpViewModel"});
define("l9_common.billingCareTopics",{"CreateBillingAccount":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/createBillingAccountViewModel","vmKeys":{"action.submitPostalCode":"submitPostalCode","action.submit":"submit","data.deliveryMethods":"deliveryMethods","data.nickName":"nickName","data.selectedDeliveryMethod":"selectedDeliveryMethod","data.plan":"plan","data.billingAddressPostalCode":"billingAddressPostalCode","data.billingAddressStreetName":"billingAddressStreetName","data.billingAddressHouseNo":"billingAddressHouseNo","data.billingAddressFloorNo":"billingAddressFloorNo","data.billingAddressUnitNo":"billingAddressUnitNo","data.submitSuccess":"submitSuccess"},"mode":"pubsub"},"ImplCustomerInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"customerInContextTopic":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"ImplUserContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","vmKeys":{"data.userInfo":"userInfo","data.permissions":"permissions"},"mode":"pubsub"},"AccountInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","vmKeys":{"data.barId":"barId","data.faId":"faId","data.accountName":"accountName"},"mode":"pubsub"},"BillAndBalanceInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/BillAndBalanceInContextViewModel","vmKeys":{"data.customerAccountID":"customerAccountID"},"mode":"pubsub"},"ImplBillAndBalanceInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/BillAndBalanceInContextTopicViewModel","vmKeys":{"data.customerAccountID":"customerAccountID"},"mode":"pubsub"},"BillInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/BillInContextTopicViewModel","vmKeys":{"data.billDetails":"billDetails","data.barId":"barId","data.faId":"faId","data.topBills":"topBills"},"mode":"pubsub"},"SubscribersInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/SubscribersInContextTopicViewModel","vmKeys":{"data.subscriberList":"subscriberList"},"mode":"pubsub"},"SelectPaymentMethodViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SelectPaymentMethodViewModel","vmKeys":{"data.dueAmount":"dueAmount","data.selectedPaymentMethod":"selectedPaymentMethod","data.accountId":"accountId","data.customerId":"customerId","data.customerStatus":"customerStatus","data.onePayURL":"onePayURL"},"mode":"sub"},"SelectPaymentMethodActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SelectPaymentMethodViewModel","vmKeys":{"action.selectPaymentMethod":"selectPaymentMethod"},"mode":"sub"},"usageDetailsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/usageDetailsViewModel","vmKeys":{"action.downloadXlsx":"downloadXlsx","action.changePage":"changePage","action.getUsageDetails":"getUsageDetails","data.barId":"barId","data.pageSize":"pageSize","data.bcd":"bcd","data.subscriptionId":"subscriptionId","data.serviceTypeID":"serviceTypeID","data.usageType":"usageType","data.accountNumber":"accountNumber","data.eventsPeriod":"eventsPeriod","data.phoneNumber":"phoneNumber","data.usageEventList":"usageEventList","data.totalResults":"totalResults"},"mode":"pubsub"},"ViewPayBillTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/PayBillViewModel","vmKeys":{"data.payBillVmStatus":"payBillVmStatus","data.selectedPaymentMethod":"selectedPaymentMethod","data.selectedAccounts":"selectedAccounts","data.confirmationMessage":"confirmationMessage","data.paymentConfirmation":"paymentConfirmation","data.mailParameters":"mailParameters","data.pgData":"pgData","data.accountId":"accountId","data.accountId3rdParty":"accountId3rdParty","data.goodAccount":"goodAccount","data.templateId":"templateId","data.totalAmountToPay":"totalAmountToPay","data.isNewConfirmationAPICall":"isNewConfirmationAPICall","action.startPayBill":"startPayBill","action.confirmPayBill":"confirmPayBill","action.sendEmailToCustomer":"sendEmailToCustomer","action.validateAccount":"validateAccount"},"mode":"pubsub"},"BillSummaryChargesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/BillSummaryChargesTopicViewModel","vmKeys":{"data.billId":"billId","data.barId":"barId","data.billDate":"billDate","data.billCycleStartDate":"billCycleStartDate","data.billingCycleEndDate":"billingCycleEndDate","data.deposit":"deposit","data.previousBalance":"previousBalance","data.payments":"payments","data.outstandingBalance":"outstandingBalance","data.currentCharges":"currentCharges","data.currentChargesDueDate":"currentChargesDueDate","data.totalAdjustments":"totalAdjustments","data.totalAmount":"totalAmount","data.dueDate":"dueDate","data.totalChargesWithoutBalance":"totalChargesWithoutBalance","action.getBillSummaryChargesData":"getBillSummaryChargesData"},"mode":"pubsub"},"PaymentHistoryTopicRead":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/paymentHistoryViewModel","vmKeys":{"data.accounts":"accounts","data.paymentHistoryVmStatus":"paymentHistoryVmStatus"},"mode":"sub"},"PaymentHistoryTopicWrite":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/paymentHistoryViewModel","vmKeys":{"data.refDays":"refDays","data.sortBy":"sortBy","data.sortConfig":"sortConfig","data.numberOfItems":"numberOfItems","action.sortDataByOrder":"sortDataByOrder","action.getPaymentHistoryForAllAccounts":"getPaymentHistoryForAllAccounts","action.getPaymentHistoryForSingleAccount":"getPaymentHistoryForSingleAccount"},"mode":"pubsub"},"ViewBillCurrentChargesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ViewBillCurrentChargesViewModel","vmKeys":{"data.customerId":"customerId","data.accountId":"accountId","data.barId":"barId","data.bcd":"bcd","data.billNumber":"billNumber","data.isBillExist":"isBillExist","data.bill":"bill","data.usageDetails":"usageDetails","data.viewBillCurrentChargesVmStatus":"viewBillCurrentChargesVmStatus","data.currentCharge":"currentCharge","data.currentSubscription":"currentSubscription","data.pageIndex":"pageIndex","data.pageSize":"pageSize","action.getBill":"getBill","action.payBill":"payBill","action.getUsageDetails":"getUsageDetails","action.changePage":"changePage","action.downloadXlsx":"downloadXlsx","action.printUsageDetails":"printUsageDetails"},"mode":"pubsub"},"ChangeBillPreferenceTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ChangeBillPreferenceViewModel","vmKeys":{"data.accounts":"accounts","data.reasons":"reasons","data.selectedAccount":"selectedAccount","data.ebillInd":"ebillInd","data.changePreferenceVmStatus":"changePreferenceVmStatus","data.ebillDeregistrationReason":"ebillDeregistrationReason","data.ebillDeregistrationReasonOther":"ebillDeregistrationReasonOther","data.selectedSubscription":"selectedSubscription","data.isAllEasyMobile":"isAllEasyMobile","data.isAnyEasyMobileExsist":"isAnyEasyMobileExsist","action.changePreferenceForPaperBill":"changePreferenceForPaperBill","action.changePreferenceForEbill":"changePreferenceForEbill","action.changePreferenceForPrs":"changePreferenceForPrs","action.changePreferenceForSubscription":"changePreferenceForSubscription","action.changePreferenceForSmsNotification":"changePreferenceForSmsNotification","action.changePreferenceForPasswordProtection":"changePreferenceForPasswordProtection","action.checkAndUpdateAutoLaunch":"checkAndUpdateAutoLaunch"},"mode":"pubsub"},"ViewBillNavigatorTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ViewBillNavigatorViewModel","vmKeys":{"data.customerId":"customerId","data.accountId":"accountId","data.selectedBillNumber":"selectedBillNumber","data.billList":"billList","action.getBillList":"getBillList","action.changeBill":"changeBill"},"mode":"pubsub"},"ImplIndividualInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","vmKeys":{"data.personId":"personId","data.contactFirstName":"contactFirstName","data.contactLastName":"contactLastName","data.contactFormattedName":"contactFormattedName"},"mode":"pubsub"},"ConsolidateBillingAccountsViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ConsolidateBillingAccountViewModel","vmKeys":{"data.billingAccountDetails":"billingAccountDetails","data.accountsToConsolidate":"accountsToConsolidate","data.error":"error","data.customerProblemId":"customerProblemId"},"mode":"sub"},"ConsolidateBillingAccountsUpdateTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ConsolidateBillingAccountViewModel","vmKeys":{"data.selectedMasterAccount":"selectedMasterAccount"},"mode":"pub"},"ConsolidateBillingAccountsActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ConsolidateBillingAccountViewModel","vmKeys":{"action.selectMasterAccount":"selectMasterAccount","action.consolidateAccounts":"consolidateAccounts"},"mode":"pubsub"},"SubscriptionInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/SubscriptionInContextTopicViewModel","vmKeys":{"data.ID":"ID","data.reference":"reference","data.lobCode":"lobCode","data.status":"status"},"mode":"pubsub"},"ImplSubscriptionInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/SubscriptionInContextTopicViewModel","vmKeys":{"data.ID":"ID","data.reference":"reference","data.lobCode":"lobCode","data.status":"status"},"mode":"pubsub"},"ImplLoginViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"data.implLoginVmStatus":"implLoginVmStatus","data.userInfo":"userInfo"},"mode":"sub"},"ImplLoginActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"action.login":"login"},"mode":"pub"},"OnePassDetailsViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","vmKeys":{"data.onePassVmStatus":"onePassVmStatus","data.nric":"nric","data.nickName":"nickName","data.userId":"userId","data.customerIdType":"customerIdType","data.status":"status","data.email":"email","data.GTMUserData":"GTMUserData","data.isWorryFreeLogin":"isWorryFreeLogin","data.isWorryFreeFaVerfied":"isWorryFreeFaVerfied","data.billPayer":"billPayer","data.familyName":"familyName","data.headers":"headers","data.newcustomer":"newcustomer"},"mode":"pubsub"},"OnePassDetailsActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","vmKeys":{"action.setOnePassFields":"setOnePassFields","action.sendOnePassDetails":"sendOnePassDetails"},"mode":"pubsub"},"PrepaidTopupTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PrepaidTopUpViewModel","vmKeys":{"data.prepaidTopupVmStatus":"prepaidTopupVmStatus","data.mobileSubscriber":"mobileSubscriber","data.delSubscriber":"delSubscriber","data.subscription":"subscription","data.planAgainstSubscription":"planAgainstSubscription","data.recurringPlans":"recurringPlans","data.createInteractionData":"createInteractionData","data.prepaidNumber":"prepaidNumber","data.currentPlan":"currentPlan","data.selectPlan":"selectPlan","data.updatedplan":"updatedplan","data.cancelPlan":"cancelPlan","action.validateMobile":"validateMobile","action.modifyPrepaidTopup":"modifyPrepaidTopup","action.cancelPrepaidTopup":"cancelPrepaidTopup","action.setOneTimeTopup":"setOneTimeTopup","action.setRecurrentTopup":"setRecurrentTopup","data.selectedServiceNumber":"selectedServiceNumber","data.emailTemplates":"emailTemplates","data.transactionId":"transactionId"},"mode":"pubsub"},"GlobalErrorTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplGlobalErrorViewModel","vmKeys":{"data.timestamp":"timestamp","data.modelName":"modelName","data.requestType":"requestType","data.errorObj":"errorObj"},"mode":"sub"},"GATopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","vmKeys":{"data.gtmData":"gtmData","data.gtmViewStatus":"gtmViewStatus","action.publishData":"publishData"},"mode":"pubsub"}});
define("l9_common.billingCareTopicsBinding",{"binding":[]});
define("l9_common.billingCareExpPackage",["l3_common.billingCareExpPackage","l9_common.billingCareWidgets","l9_common.billingCareTopics","l9_common.billingCareTopicsBinding","text!businesswidget/repository_l9_common/common/config/l9_common.billingCarePackage.config.json","single!businesswidget/repository_l9_common/common/core/ImplRepositoryGlobalErrorHandler"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l9_common/common/i18n/billingCare/web/nls/l9_common.billingCareStrings")});
define("l3_common.billingCare.custom",["replace","l9_common.billingCare.custom"],function() {});
define("l3_common.billingCareWidgets",{});
define("l3_common.billingCareTopics",{});
define("l3_common.billingCareTopicsBinding",{"binding":[]});
define("l3_common.billingCareExpPackage",["l0.billingCareExpPackage","l3_common.billingCareWidgets","l3_common.billingCareTopics","l3_common.billingCareTopicsBinding","text!businesswidget/repository_l3_common/common/config/l3_common.billingCarePackage.config.json"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l3_common/common/i18n/billingCare/web/nls/l3_common.billingCareStrings")});
define("text!businesswidget/repository/common/config/billingCarePackage.config.json",function (){return'({\n    "experiencePackage":"billingCare",    \n\n    // common\n    "NotesSizeMax" : 512,\n    "NumDigitsSizeMax" : 15,\n    \n    // Goodwill Adjustment Widget\n    "GoodwillAdjustmentAmountMax": 9999999999999.99,\n    "AdjustmentAmountLimit": 501,\n\n    // Bill Summary Widget\n    // Widget display mode "NARROW" or "FULL". FULL if not specified here\n    "DisplayMode" : "FULL",\n    // Number of days remaining to pay bill. 5 if not specified here\n    "RemainingDays" : "5",\n\t"BillingEntityBillsModel.numOfCycles": "12",\n\t"BillingArrangementSubscriptionModel.numOfCycles": "12",\n\t"touchPoint":"W",\n\n    "topSpendersWidget.defaultNoOfTopSpenders":3,\n      //LOB Charges widget\n\t"lobChargesWidget.defaultDisplayView":"Medium",\n\t"lobChargesWidget.viewAllPopupStyle":"List",\n\t"lobChargesWidget.displayOrder":"Amount",\n\t"lobChargesWidget.trendThresholdPercentage": 10,\n\t"lobChargesWidget.defaultProductsToDisplay": 4,\n\t"phonebook.extCharsToRemove" : /\\ |\\-|\\.|\\+|\\(|\\)|\\&nbsp;|\\&ndash;|\\,/g,\n\n\t"imageBaseUrl" : "businesswidget/repository/common/resources/billingCare/web",\n\t\n\t// Payment History Widget default configuration\n\t"paymentHistoryWidget.entriesPerPage" : 10,\n\t"paymentHistoryWidget.entriesToDisplayInNextSet" : 10,\n\t"paymentHistoryWidget.CustomerAccountPaymentHistoryModel.st": "1",\n\t"defaultNumberOfDecimalsKey" : "defaultNumberOfDecimals",\n    "currency_formatter": "cm_currency_formatter",\n    "cm_currency_formatter_defaults": {\n    \tcurrencyPosition: \'afterSign\',\n    \tamountFormatterOptions: {\n    \t\tformatType: \'number\'\n    \t}\n    },\n\n    //Total Charges Widget\n    "totalChargesWidget.defaultDisplayView" : "PIE",\n    \n    //used in Select charges widget\n    "NumBillingCycles" : 12,\n    \n    //Credit Tool widget\n    "promptOnClose" : false,\n    "skipSelectCharges" : true,\n\t"mgrOverrideApproval.loginHdrUNField":"overrideUserName",\n\t"mgrOverrideApproval.loginHdrPWField":"overridePassword",\n    \n    // manager approval\n    "passwordTimeOutSeconds" : "10",\n\t"allowOfflineApproval" : true,\n\t"showWidgetTitle" : true,\n\n    //Payment History CC Widget\n    "noOfDays" : "90",\n    //Credit Charges/Define credit\n    "PerChargeMinCreditAmt":0.01,\n    "CreditMethodsList.allAtOnce":[{"refId":"TOT_CHARGE","title":"credit_charge_total_charge_method"},{"refId":"PER_CHARGE","title":"credit_charge_per_charge_method"}],\n    "CreditMethodsList.oneByOne":[{"refId":"FULL_CHARGE","title":"credit_charge_full_charge_amount"},{"refId":"CUSTOM_CREDIT","title":"credit_charge_custom_credit"}],\n    "defaultCreditMethod.allAtOnce":"TOT_CHARGE",\n    "defaultCreditMethod.oneByOne":"FULL_CHARGE",\n    "showChargesDefaultSelect":false,\n    "isCreditReasonMandatory":true,\n    "defaultCreditResonRefId":"",\n    "carryReasonCodeToOnebyOneMode":true,\n    "CreditCharge.defaultDisplayMode":"allAtOnce",\n\n    //Previous Credit Widget\n    "numberOfCharacters":90,\n    "numberOfTotalIssueCreditLimit":4,\n    \n    //PayBillWidget - config params\n \n    "firstTimeSelection":"CC",\n     "showExpiryNotification": true,\n     "luhnValidation": true,\n     "expiryMonthNumber": "2"\n\n\n    \n})';
});
define("billingCareWidgets",{"accountLevelAdjustments":"businesswidget/repository/widgetsLibrary/goodwillAdjustmentWidget/web/GoodwillAdjustmentWidget","actionsGuidance":"businesswidget/repository/widgetsLibrary/actionGuidance/web/ActionsGuidanceWidget","billSummary":"businesswidget/repository/widgetsLibrary/billSummaryBannerWidget/web/BillSummaryBannerWidget","exception":"businesswidget/repository/widgetsLibrary/exceptionWidget/web/ExceptionWidget","billHistoryWidget":"businesswidget/repository/widgetsLibrary/billhistorywidget/web/BillHistoryGraphWidget","topSpendersWidget":"businesswidget/repository/widgetsLibrary/topspenderswidget/web/TopSpendersWidget","totalChargesWidget":"businesswidget/repository/widgetsLibrary/totalchargeswidget/web/TotalChargesWidget","lobChargesWidget":"businesswidget/repository/widgetsLibrary/lobchargeswidget/web/LOBChargesWidget","selectCharges":"businesswidget/repository/widgetsLibrary/selectCharges/web/SelectChargesWidget","adjustmentHistory":"businesswidget/repository/widgetsLibrary/adjustmentHistory/web/AdjustmentHistoryWidget","mostCalledNumbersWidget":"businesswidget/repository/widgetsLibrary/mostcallednumberswidget/web/MostCalledNumbersWidget","managerOverride":"businesswidget/repository/widgetsLibrary/ManagerOverrideWidget/web/ManagerOverrideWidget","paymentHistoryWidget":"businesswidget/repository/widgetsLibrary/paymentHistory/web/PaymentHistoryWidget","billSummaryWidget":"businesswidget/repository/widgetsLibrary/billsummarywidget/web/BillSummaryWidget","selectPaymentMethodWidget":"businesswidget/repository/widgetsLibrary/selectPaymentMethod/web/SelectPaymentMethodWidget","createPaymentMethodWidget":"businesswidget/repository/widgetsLibrary/createPaymentMethodWidget/web/CreatePaymentMethodWidget","payBillWidget":"businesswidget/repository/widgetsLibrary/payBillWidget/web/PayBillWidget","previousCredit":"businesswidget/repository/widgetsLibrary/previousCreditWidget/web/PreviousCreditWidget","creditTool":"businesswidget/repository/widgetsLibrary/creditToolWidget/web/CreditToolWidget","managerOverrideRealTime":"businesswidget/repository/widgetsLibrary/managerOverrideRealTimeWidget/web/ManagerOverrideRealTimeWidget","creditCharge":"businesswidget/repository/widgetsLibrary/creditChargeWidget/web/CreditChargeWidget","managerOverrideOffline":"businesswidget/repository/widgetsLibrary/managerOverrideOfflineWidget/web/ManagerOverrideOfflineWidget"});
define("billingCareTopics",{"amdocs.customer.CustomerInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.CustomerInContext":"CustomerInContext"},"mode":"pubsub"},"amdocs.customeraccountactivity.TopSpenders":{"vmId":"single!businesswidget/repository/common/viewmodel/TopSpendersWidgetViewModel","vmKeys":{"data.subscriptionID":"subscriptionID","data.numberOfSubscriptions":"numberOfSubscriptions","action.selectSubscription":"selectSubscription"},"mode":"sub"},"amdocs.customeraccountactivity.BillingDetailsInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.BillingDetailsInContext":"BillingDetailsInContext","data.CustomerBillSpecDetailsInContext":"BillingDetailsInContext","data.billMonth":"billMonth"},"mode":"pubsub"},"amdocs.customeraccountactivity.ChargeTotalsClicked":{"vmId":"single!businesswidget/repository/common/viewmodel/TotalChargesWidgetViewModel","vmKeys":{"data.totalCharge":"totalCharge","data.CustomerBillSpecInContext":"CustomerBillSpecInContext","data.billID":"billID","data.billCloseDate":"billCloseDate","data.billLobCode":"billLOB","data.subscriptionID":"billSubscriptionID","action.chargesTotalsZero":"chargesTotalsZero","action.chargeTypeClicked":"chargeTypeClicked"},"mode":"sub"},"amdocs.billingactivity.GoodwillAdjustments":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.GoodwillAdjustments":"GoodwillAdjustments","action.SubmitCredit":"SubmitCredit"},"mode":"pubsub"},"amdocs.billingactivity.AdjustedCharge":{"vmId":"single!businesswidget/repository/common/viewmodel/AdjustedChargesTopicViewModel","vmKeys":{"data.AdjustedCharges":"AdjustedCharges","data.totalCreditAmt":"totalCreditAmt","action.DisplayCharges":"DisplayCharges","action.refreshStatus":"refreshStatus"},"mode":"pubsub"},"amdocs.selectedException":{"vmId":"single!businesswidget/repository/common/viewmodel/PAGActivityViewModel","vmKeys":{"data.SelectedException":"SelectedException","action.SelectedException":"SelectedException"},"mode":"pubsub"},"amdocs.customeraccountactivity.BillingSummaryInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/BillingSummaryInContextViewModel","vmKeys":{"data.CustomerBillSpecInContext":"CustomerBillSpecInContext","data.CustomerAccountInContext":"CustomerAccountInContext","data.CustomerBillInContext":"CustomerBillInContext"},"mode":"pubsub"},"amdocs.product.SubscriptionInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/SubscriptionInContextViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"amdocs.customeraccountactivity.BillAndBalanceInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/BillAndBalanceInContextViewModel","vmKeys":{"data.billID":"billID","data.customerAccountID":"customerAccountID","data.customerBillSpecID":"customerBillSpecID","data.totalDue":"totalDue","data.currency":"currency","action.BillSelected":"BillSelected"},"mode":"pubsub"},"amdocs.customeraccountactivity.LOBChargeTotalSelected":{"vmId":"single!businesswidget/repository/common/viewmodel/LOBChargesWidgetViewModel","vmKeys":{"data.CustomerBillSpecInContext":"CustomerBillSpecInContext","data.CustomerBillInContext":"CustomerBillInContext","action.lobChargeTotalSelected":"lobChargeTotalSelected"},"mode":"sub"},"amdocs.customeraccountactivity.BillLOBsNumber":{"vmId":"single!businesswidget/repository/common/viewmodel/LOBChargesWidgetViewModel","vmKeys":{"data.numOfLOBs":"numOfLOBs","action.numberOfLOBs":"numberOfLOBs"},"mode":"sub"},"amdocs.customeraccountactivity.PaymentHistoryInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/PaymentHistoryWidgetViewModel","vmKeys":{"data.noOfPayments":"noOfPayments"},"mode":"sub"},"amdocs.customeraccountactivity.EntityForViewEvents":{"vmId":"single!businesswidget/repository/common/viewmodel/EntityForViewEventsViewModel","vmKeys":{"data.subscriptionID":"subscriptionID","data.billID":"billID","action.ViewEvents":"ViewEvents"},"mode":"pubsub"},"amdocs.customeraccountactivity.SubscriptionCharges":{"vmId":"single!businesswidget/repository/common/viewmodel/SubscriptionChargesTopicViewModel","vmKeys":{"data.subscriptionID":"subscriptionID","data.billID":"billID","data.subscriptionDisplayIdentifier":"subscriptionDisplayIdentifier","data.contactName":"contactName","action.SubscriptionSelected":"SubscriptionSelected"},"mode":"pubsub"},"amdocs.party.IndividualInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"amdocs.customeraccountactivity.PaymentMethodInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/PaymentMethodInContextTopicViewModel","vmKeys":{"data.paymentMethodInContext":"paymentMethodInContext","action.paymentMethodSelected":"paymentMethodSelected","action.paymentMethodCancelled":"paymentMethodCancelled","action.paymentMethodCreated":"paymentMethodCreated","action.validate":"validate","action.validatedResults":"validatedResults","action.validateAndSave":"validateAndSave","action.validateAndSavedResults":"validateAndSavedResults","action.createPaymentMethodCancelled":"createPaymentMethodCancelled","action.createPaymentMethodSkipped":"createPaymentMethodSkipped"},"mode":"pubsub"},"amdocs.customeraccountactivity.BillPaymentInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/BillPaymentInContextTopicViewModel","vmKeys":{"action.payBill":"payBill","action.setAutoPay":"setAutoPay","action.payBillResults":"payBillResults","action.setAutoPayResults":"setAutoPayResults"},"mode":"pubsub"},"amdocs.billingactivity.SelectedCharges":{"vmId":"single!businesswidget/repository/common/viewmodel/SelectedChargesTopicViewModel","vmKeys":{"data.selectedCharges":"selectedCharges","action.refreshWidgetDetails":"refreshWidgetDetails"},"mode":"pubsub"},"amdocs.RequestAction":{"vmId":"single!businesswidget/repository/common/viewmodel/ExternalActionViewModel","vmKeys":{"data.actionType":"actionType","data.actionTarget":"actionTarget","data.actionParams":"actionParams","action.requestAction":"requestAction"},"mode":"pubsub"},"amdocs.CancelLink":{"vmId":"single!businesswidget/repository/common/viewmodel/CancelLinkViewModel","vmKeys":{"action.LinkClicked":"LinkClicked","data.widgetID":"widgetID","data.widgetName":"widgetName","data.identifier":"identifier"},"mode":"pubsub"},"amdocs.ApprovalData":{"vmId":"single!businesswidget/repository/common/viewmodel/ManagerApprovalDataTopicViewModel","vmKeys":{"data.notes":"notes","data.approvalType":"approvalType","data.reason":"reason"},"mode":"pubsub"},"amdocs.customeraccountactivity.PaymentHistoryCCInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/PaymentHistoryTopicViewModel","vmKeys":{"data.fromDate":"fromDate"},"mode":"pubsub"},"amdocs.refreshAction":{"vmId":"single!businesswidget/repository/common/viewmodel/RefreshActionTopicViewModel","vmKeys":{"data.sourceWidgetName":"sourceWidgetName","data.sourceWidgetID":"sourceWidgetID","data.targetWidgetName":"targetWidgetName","data.targetWidgetID":"targetWidgetID","action.Delete":"Delete","action.Reset":"Reset","action.Undo":"Undo"},"mode":"pubsub"},"amdocs.customeraccountactivity.PaymentTypeInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/PaymentTypeInContextTopicViewModel","vmKeys":{"data.paymentType":"paymentType"},"mode":"pubsub"},"amdocs.creditRequest.RequestDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/CreditRequestDetailsTopicViewModel","vmKeys":{"data.ID":"ID","action.Overview":"Overview","action.Details":"Details","action.Approve":"Approve","action.Reject":"Reject","action.Save":"Save","action.RequestClosed":"RequestClosed"},"mode":"pubsub"},"amdocs.customeraccountactivity.SelectPaymentMethodInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/SelectPaymentMethodInContext","vmKeys":{"data.selectedPaymentMethodID":"selectedPaymentMethodID"},"mode":"pubsub"},"amdocs.creditRequest.RequestValidate":{"vmId":"single!businesswidget/repository/common/viewmodel/CreditRequestDetailsTopicViewModel","vmKeys":{"data.creditRequest":"creditRequest"},"mode":"pubsub"},"amdocs.common.ExternalException":{"vmId":"single!businesswidget/repository/common/viewmodel/ExternalExceptionTopicViewModel","vmKeys":{"data.widgetID":"widgetID","data.errorCode":"errorCode","data.errorMessage":"errorMessage","action.ExceptionPosted":"ExceptionPosted"},"mode":"pubsub"}});
define("billingCareTopicsBinding",{"binding":[]});
define("text!businesswidget/repository/common/config/web/billingCarePackage.web.config.json",function (){return'({\n    //test property\n    "touchPoint":"WEB",     \n     "topSpendersWidget.defaultNoOfTopSpenders":3,\n     \n     "Number_of_Years_To_Be_Visible_in_Expiry_Date_Field" : "10"\n})'});
define("l0.billingCareExpPackage",["experiencePackage","billingCareWidgets","billingCareTopics","billingCareTopicsBinding","text!businesswidget/repository/common/config/billingCarePackage.config.json","text!businesswidget/repository/common/config/web/billingCarePackage.web.config.json","repository.lightsaber.custom"],function (expPackage,billingCareWidgets,billingCareTopics,billingCareTopicsBinding,expPackageConfig,expPackageTouchPointConfig){"use strict";var expPackageConfigObj=eval(expPackageConfig),expPackageTouchPointConfigObj=eval(expPackageTouchPointConfig),extendedExpPackageConfigObj=_.extend({},expPackageConfigObj,expPackageTouchPointConfigObj);return new expPackage(billingCareWidgets,billingCareTopics,billingCareTopicsBinding,extendedExpPackageConfigObj,"businesswidget/repository/common/i18n/billingCare/web/nls/billingCareStrings")});
define("billingCareExpPackage",["l9_common.billingCareExpPackage","l3_common.billingCare.custom"],function (a){"use strict";return a});
define("businesswidget/repository/common/viewmodel/BillHubEventAdaptorViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/core/WidgetResourceBundle"],function (a,b,c){var d=b.Core.ObservableViewModel.extend({publishAction:function(b,c,d){if(b){var e=c||{};e.data=a.extend(e.data||{},d||{}),this.handleAction(b,e)}}}),e=d.extend({}),f={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"BillHubEventAdaptorViewModel",path:"src/modules/businesswidget/repository/common/viewmodel/BillHubEventAdaptorViewModel.js",savePath:"src/modules/businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"rb",pathName:"MCSSResourceBundle"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{publishAction:{name:"publishAction",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/SubscriptionInContextViewModel",["lightsaber","businesswidget/repository/common/viewmodel/BillHubEventAdaptorViewModel"],function (a,b){var c=b.extend({defaults:{ID:null}}),d=c.extend({}),e={path:"src/modules/businesswidget/repository/common/viewmodel/SubscriptionInContextViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"SubscriptionInContextViewModel",savePath:"src/modules/businesswidget/repository/common/viewmodel","extends":"BillHubEventAdaptorViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"BillHubEventAdaptorViewModel",pathName:"src/modules/businesswidget/repository/common/viewmodel/BillHubEventAdaptorViewModel"}],models:null,viewModels:null,dataBindings:null,methods:{},defaults:{ID:{key:"ID",value:"null"},reference:{key:"reference",value:"null"},lobCode:{key:"lobCode",value:"null"},status:{key:"status",value:"null"}},description:"SubscriptionInContext view model for topic"};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/BillAndBalanceInContextViewModel",["lightsaber","businesswidget/repository/common/viewmodel/BillHubEventAdaptorViewModel","single!businesswidget/repository/common/viewmodel/CustomerDetailsViewModel"],function (a,b,c){return b.extend({persistent:["billID","customerAccountID","customerBillSpecID","totalDue","currency"],defaults:{billID:null,customerAccountID:null,customerBillSpecID:null,totalDue:null,currency:null},subViewModels:{customerDetailsTopicViewModel:c},dataBindings:[{customerAccountID:"subViewModels.customerDetailsTopicViewModel.customerAccountId",options:{twoWay:!1,setOnBind:!0}},{customerBillSpecID:"subViewModels.customerDetailsTopicViewModel.customerBillSpecId",options:{twoWay:!1,setOnBind:!0}}]}).extend({})});
define("businesswidget/repository/common/model/ChoiceListModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{url:"/reference-data/choice/:choiceListId",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}},initialize:function(b){a.bindAll(this,"successHandler"),this._super()},successHandler:function(a){this.trigger("OnDataLoaded",a)},getChoiceList:function(){var a=this.get("ChoiceListResponse").choices;if(a.length>0)return a.sort(this.choicesSortFunction)},getChildren:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.ID==b&&null!==d.choices)return d.choices.sort(this.choicesSortFunction)}},choicesSortFunction:function(b,c){var d,e;return d=a.isUndefined(b["default"])?2:!0===b["default"]?0:1,e=a.isUndefined(c["default"])?2:!0===c["default"]?0:1,d-e},getDefaultValueFromChoiceList:function(a){if(a){for(var b=0;b<a.length;b++){var c=a[b];if(!0===c["default"])return c}return a[0]}},fetch:function(b){var c={children:this.get("children")};this.get("id")&&(c.ids=this.get("id")),a.extend(c,this.getQueryParams()),this.setQueryParams(c),this._super({success:this.successHandler})},addToQueryParameter:function(a,b,c,d,e){var f=a+":"+b;if(this.set({choiceListId:f,children:c}),e&&d){var g=[];g[0]=d,g[1]=e,this.set("id",g)}},getQueryParams:function(){return this.getDataSource().dynamicQueryParams},setChoiceListId:function(a,b){this.set("choiceListId",a+":"+b)}})});
define("businesswidget/repository/widgetsLibrary/selectPaymentMethod/common/selectPaymentMethodConstants",["jquery","lightsaber","businesswidget/repository/common/core/LSResourceBundleCust"],function (a,b,c){return{PAYMENT_METHOD:{CC:"CC",DD:"DD",ALL:"ALL"},PAYMENT_METHOD_ITEMTYPE:{CREDIT_CARD:"CREDIT_CARD",BANK_ACCOUNT:"BANK_ACCOUNT",DIRECT_DEBIT:"DIRECT_DEBIT"}}});
define("businesswidget/repository/common/viewmodel/ExceptionTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({defaults:{}})});
define("i18n!businesswidget/repository/common/i18n/billingCare/web/nls/billingCareStrings",{"root":{},"en":true,"fr":true,"zh":true,"de":true});
define("text!businesswidget/repository_l3_common/common/config/l3_common.billingCarePackage.config.json",function (){return"({\n\n})\n\n"});
define("i18n!businesswidget/repository_l3_common/common/i18n/billingCare/web/nls/l3_common.billingCareStrings",{"root":{},"en":true,"fr":true});
define("i18n!businesswidget/repository_l9_common/common/i18n/billingCare/web/nls/l9_common.billingCareStrings",{"root":{},"en":true,"fr":true});
define("l9_common.commerce.custom",["replace","businesswidget/repository_l9_common/common/utils/ImplCopySessionStorage"],function() {});
define("businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["rrpOrderId","appointmentId","lastDeviceReservationTime"],defaults:{rrpOrderId:null,appointmentId:null,lastDeviceReservationTime:null},subViewModels:{}});return d});
define("businesswidget/repository_l9_common/common/model/rrp/RRPCreateOrderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/rrp/order/create-order",rest:{defaults:{method:"PUT",contentType:"application/json",payload:["ImplRRPCreateOrderRequest"]},create:{method:"PUT"}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPAddOrderItemsModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/add-order-items",rest:{defaults:{method:"PUT",contentType:"application/json",payload:["ImplRRPAddOrderItemRequest"]},create:{method:"PUT"}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPDeleteOrderItemsModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/remove-order-items",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPRemoveOrderItemRequest"]},create:{method:"POST"}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPRetrieveOrderDetailsModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/retrieve-order-details",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPRetrieveOrderSummaryModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/retrieve-order-summary",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPExtendSessionModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/extend-session",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPSubmitOrderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/submit-order",rest:{defaults:{method:"POST",payload:["ImplRRPSubmitOrderRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPApplyCouponModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/apply-coupon",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPApplyPromoRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPRemoveCouponModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/remove-coupon",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPApplyPromoRequest"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic","businesswidget/repository_l9_common/common/model/rrp/RRPCreateOrderModel","businesswidget/repository_l9_common/common/model/rrp/RRPAddOrderItemsModel","businesswidget/repository_l9_common/common/model/rrp/RRPDeleteOrderItemsModel","businesswidget/repository_l9_common/common/model/rrp/RRPRetrieveOrderDetailsModel","businesswidget/repository_l9_common/common/model/rrp/RRPRetrieveOrderSummaryModel","businesswidget/repository_l9_common/common/model/rrp/RRPExtendSessionModel","businesswidget/repository_l9_common/common/model/rrp/RRPSubmitOrderModel","moment","businesswidget/repository_l9_common/common/model/rrp/RRPApplyCouponModel","businesswidget/repository_l9_common/common/model/rrp/RRPRemoveCouponModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a.Core.ObservableViewModel.extend({models:{rrpCreateOrderModel:e,rrpAddOrderItemsModel:f,rrpDeleteOrderItemsModel:g,rrpRetrieveOrderDetailsModel:h,rrpRetrieveOrderSummaryModel:i,rrpExtendSessionModel:j,rrpSubmitOrderModel:k,rrpApplyCouponModel:m,rrpRemoveCouponModel:n},subViewModels:{rrpOrderContextTopic:d},defaults:{rrpOrderId:null,newOrderItems:null,removeOrderItems:null,orderDetails:null,rrpOrderVmStatus:null,rrpSubmitOrderOutput:null,retrieveOrdersOnLoad:!0,withQuote:!1,orderSummary:!1,pgInfo:null,rrpOrderCouponVmStatus:null,couponCode:null},dataBindings:[{rrpOrderId:"subViewModels.rrpOrderContextTopic.rrpOrderId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){b.bindAll(this,"addOrderItems","removeOrderItems","retrieveOrderDetails","retrieveOrderSummary","retrieveShoppingCart","extendSessionTimeout","submitRrpOrder","_createOrder","_createOrderSuccess","_getAddOrderItemPayload","_getRemoveOrderItemPayload","_updateOrderAddOrderItems","_addOrderItemsSuccess","_getRemoveOrderItemsPayload","_removeOrderItemsSuccess","_retrieveOrderDetailsSuccess","_extendSessionTimeoutSuccess","setLastDeviceReservationTime","applyCoupon","_onApplyCouponSuccess","removeCoupon","_onRemoveCouponSuccess"),setTimeout(function(){this.set("rrpOrderVmStatus","RRPOrderVMInitialized"),this.get("rrpOrderId")&&this.get("orderSummary")?this.retrieveOrderSummary():this.get("rrpOrderId")&&this.get("retrieveOrdersOnLoad")&&this.retrieveOrderDetails()}.bind(this),0)},addOrderItems:function(){var a=this.get("rrpOrderId");return a?this._updateOrderAddOrderItems():this._createOrder()},retrieveShoppingCart:function(){this.set("rrpOrderVmStatus","RetrieveShoppingCartInProgress")},_createOrder:function(){this.set("rrpOrderVmStatus","CreateOrderInProgress");var a={ImplRRPCreateOrderRequest:{orderItemDetails:this._getAddOrderItemPayload()}};return this.models.rrpCreateOrderModel.save(a,{success:this._createOrderSuccess,error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo?("ExceedAllowedQuantity"==c.ErrorInfo.errorCode&&this.set("rrpOrderVmStatus","CreateOrderFailedExceedAllowedQuantity"),"ExceedAllowedPrice"==c.ErrorInfo.errorCode?this.set("rrpOrderVmStatus","CreateOrderFailedExceedAllowedPrice"):this.set("rrpOrderVmStatus","CreateOrderFailed")):this.set("rrpOrderVmStatus","CreateOrderFailed")}.bind(this)})},_getAddOrderItemPayload:function(){var a=this.get("newOrderItems"),c=[];return b.each(a,function(a){c.push(this._convertToOrderItemFromVariant(a))}.bind(this)),c},_convertToOrderItemFromVariant:function(a){var b={sku:a.sku,identifier:a.identifier,productDetails:{title:a.title,brand:a.brand,color:a.name||a.colorName,hexCode:a.hexCode,model:a.model,price:a.price,size:a.size,groupId:a.groupId}};return b},_createOrderSuccess:function(a,b){var c=b.ImplRRPCreateOrderResponse.rrpOrderId;this.subViewModels.rrpOrderContextTopic.set("rrpOrderId",c),this.setLastDeviceReservationTime(),this.set("rrpOrderVmStatus","CreateOrderSuccess")},_getRemoveOrderItemPayload:function(){var a=[];return a},_updateOrderAddOrderItems:function(){this.set("rrpOrderVmStatus","AddOrderItemsInProgress");var a={ImplRRPAddOrderItemRequest:{orderItemDetails:this._getAddOrderItemPayload()}};return this.models.rrpAddOrderItemsModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpAddOrderItemsModel.save(a,{success:this._addOrderItemsSuccess,error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo?("ExceedAllowedQuantity"==c.ErrorInfo.errorCode&&this.set("rrpOrderVmStatus","AddOrderItemsFailedExceedAllowedQuantity"),"ExceedAllowedPrice"==c.ErrorInfo.errorCode?this.set("rrpOrderVmStatus","AddOrderItemsFailedExceedAllowedPrice"):this.set("rrpOrderVmStatus","AddOrderItemsFailed")):this.set("rrpOrderVmStatus","AddOrderItemsFailed")}.bind(this)})},_addOrderItemsSuccess:function(a,c){var d="AddOrderItemsSuccess";b.filter(c.ImplRRPAddOrderItemResponse.orderItemDetails,function(a){return 0!==parseInt(a.mtposReservationId)||(d="AddOrderItemsPartiallySuccess",!1)}),this.setLastDeviceReservationTime(),this.set("rrpOrderVmStatus",d)},removeOrderItems:function(){this.set("rrpOrderVmStatus","RemoveOrderItemInProgress");var a={ImplRRPRemoveOrderItemRequest:{orderItemDetails:this._getRemoveOrderItemsPayload()}};return this.models.rrpDeleteOrderItemsModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpDeleteOrderItemsModel.save(a,{success:this._removeOrderItemsSuccess,error:function(a,b){this.set("rrpOrderVmStatus","RemoveOrderItemsFailed")}.bind(this)})},_getRemoveOrderItemsPayload:function(){var a=this.get("removeOrderItems"),c=[];return b.each(a,function(a){var b={orderItemId:a.orderItemId};c.push(b)}.bind(this)),c},_removeOrderItemsSuccess:function(a,b){this.set("rrpOrderVmStatus","RemoveOrderItemsSuccess")},retrieveOrderSummary:function(){return this.set("rrpOrderVmStatus","RetrieveOrderDetailsInProgress"),this.models.rrpRetrieveOrderSummaryModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpRetrieveOrderSummaryModel.setQueryParams({wq:this.get("withQuote"),os:this.get("orderSummary")}),this.models.rrpRetrieveOrderSummaryModel.fetch({success:this._retrieveOrderDetailsSuccess,error:function(a,b){this.set("rrpOrderVmStatus","RetrieveOrderDetailsFailed")}.bind(this)})},retrieveOrderDetails:function(){return this.set("rrpOrderVmStatus","RetrieveOrderDetailsInProgress"),this.models.rrpRetrieveOrderDetailsModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpRetrieveOrderDetailsModel.setQueryParams({wq:this.get("withQuote"),os:this.get("orderSummary")}),this.models.rrpRetrieveOrderDetailsModel.fetch({success:this._retrieveOrderDetailsSuccess,error:function(a,b){this.set("rrpOrderVmStatus","RetrieveOrderDetailsFailed")}.bind(this)})},_retrieveOrderDetailsSuccess:function(a,c){if(c.ImplRRPOrderDetails.promotions){var d=b.find(c.ImplRRPOrderDetails.promotions,function(a){return"Waiver"===a.promoType});c.ImplRRPOrderDetails.showDeliveryDiscount=!b.isUndefined(d),c.ImplRRPOrderDetails.promotions=b.reject(c.ImplRRPOrderDetails.promotions,function(a){return"Waiver"===a.promoType})}c.ImplRRPOrderDetails.validationMessages?(this.set("orderDetails",c.ImplRRPOrderDetails),this.set("rrpOrderVmStatus","RetrieveOrderPriceExceed")):(this.set("orderDetails",c.ImplRRPOrderDetails),this.set("rrpOrderVmStatus","RetrieveOrderDetailsSuccess"))},extendSessionTimeout:function(){return this.set("rrpOrderVmStatus","extendSessionTimeoutInProgress"),this.models.rrpExtendSessionModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpExtendSessionModel.fetch({success:this._extendSessionTimeoutSuccess,error:function(a,b){this.set("rrpOrderVmStatus","extendSessionTimeoutFailed")}.bind(this)})},_extendSessionTimeoutSuccess:function(a,b){b.ImplRRPExtendSessionResponse.sessionExtended?(this.setLastDeviceReservationTime(),this.set("rrpOrderVmStatus","extendSessionTimeoutSuccess")):this.set("rrpOrderVmStatus","sessionExtendedFalse")},submitRrpOrder:function(){this.set("rrpOrderVmStatus","submitRrpOrderInProgress"),this.models.rrpSubmitOrderModel.set("rrpOrderId",this.get("rrpOrderId"));var a={ImplRRPSubmitOrderRequest:{}};return this.models.rrpSubmitOrderModel.save(a,{success:function(a,b){var c=b.ImplRRPSubmitOrderResponse;if(c){var d=this.get("pgInfo")||{};d.referenceId=c.referenceId,d.processedDate=c.processedDate,d.paidAmount=c.pgAmount,d.paymentStatus=c.paymentStatus,d.id=c.id,d.paymentProviderId=c.paymentProviderId,this.set("pgInfo",d),"SUCCESS"===c.result?this.set("rrpOrderVmStatus","submitRrpOrderSuccess"):"PROCESSED"===c.result?this.set("rrpOrderVmStatus","submitRrpOrderSuccess"):this.set("rrpOrderVmStatus","submitRrpOrderFailed")}else this.set("rrpOrderVmStatus","submitRrpOrderFailed");this.set("rrpSubmitOrderOutput",b.ImplRRPSubmitOrderResponse),this.set("rrpOrderVmStatus","submitRrpOrderSuccess")}.bind(this),error:function(a,b){this.set("rrpOrderVmStatus","submitRrpOrderFailed")}.bind(this)})},setLastDeviceReservationTime:function(){var a=1e3*l().unix();this.subViewModels.rrpOrderContextTopic.set("lastDeviceReservationTime",a)},applyCoupon:function(){this.set("rrpOrderCouponVmStatus","ApplyCouponInProgress");var a={ImplRRPApplyPromoRequest:{couponCode:this.get("couponCode")}};return this.models.rrpApplyCouponModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpApplyCouponModel.save(a,{success:this._onApplyCouponSuccess,error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo&&"COUPON_ALREADY_APPLIED"==c.ErrorInfo.errorCode?this.set("rrpOrderCouponVmStatus","ApplyCouponAlreadyApplied"):this.set("rrpOrderCouponVmStatus","ApplyCouponFailed")}.bind(this)})},_onApplyCouponSuccess:function(a,b){var c=b.ImplRRPApplyPromoResponse;c&&("SUCCESS"===c.result?this.set("rrpOrderCouponVmStatus","ApplyCouponSuccess"):"COUPON_INVALID"===c.result?this.set("rrpOrderCouponVmStatus","ApplyCouponInvalidCoupon"):this.set("rrpOrderCouponVmStatus","ApplyCouponFailed"))},removeCoupon:function(){this.set("rrpOrderCouponVmStatus","RemoveCouponInProgress");var a={ImplRRPApplyPromoRequest:{couponCode:this.get("couponCode")}};return this.models.rrpRemoveCouponModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpRemoveCouponModel.save(a,{success:this._onRemoveCouponSuccess,error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo&&"COUPON_ALREADY_APPLIED"==c.ErrorInfo.errorCode?this.set("rrpOrderCouponVmStatus","COUPON_NOT_APPLIED"):this.set("rrpOrderCouponVmStatus","RemoveCouponFailed")}.bind(this)})},_onRemoveCouponSuccess:function(a,b){var c=b.ImplRRPApplyPromoResponse;c&&("SUCCESS"===c.result?this.set("rrpOrderCouponVmStatus","RemoveCouponSuccess"):this.set("rrpOrderCouponVmStatus","ApplyCouponFailed"))}});return o});
define("businesswidget/repository_l9_common/common/model/rrp/RRPCancelOrderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"rrp/order/rrp-order-id/:rrpOrderId/cancel-order",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/rrp/RRPShoppingCartViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic","businesswidget/repository_l9_common/common/model/rrp/RRPCancelOrderModel"],function (a,b,c,d,e){var f=a.Core.ObservableViewModel.extend({models:{rrpCancelOrderModel:e},subViewModels:{rrpOrderContextTopic:d},defaults:{rrpOrderId:null,rrpShoppingCartVmStatus:null,rrpEshopRedirectiontVmStatus:null,response:null},dataBindings:[{rrpOrderId:"subViewModels.rrpOrderContextTopic.rrpOrderId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){b.bindAll(this,"clearCart","_cancelOrderSuccess","clearContext","cancelOrderOnEshopRedirection","_cancelOrderEshopRedirectionSuccess")},clearCart:function(){return this.set("rrpShoppingCartVmStatus","ClearCartInProgress"),this.models.rrpCancelOrderModel.set("rrpOrderId",this.get("rrpOrderId")),this._cancelOrder().then(this._cancelOrderSuccess.bind(this),this._cancelOrderFailure.bind(this))},_cancelOrder:function(){return this.models.rrpCancelOrderModel.set("rrpOrderId",this.get("rrpOrderId")),this.models.rrpCancelOrderModel.fetch().then(this.clearContext.bind(this),this.clearContext.bind(this))},_cancelOrderSuccess:function(){var a=this.get("response");"SUCCESS"==a.ImpRRPCancelOrderResponse.result&&this.set("rrpShoppingCartVmStatus","RRPCancelOrderSuccess")},_cancelOrderFailure:function(a){this.set("rrpShoppingCartVmStatus","RRPCancelOrderFailed")},clearContext:function(a){this.set("response",a),this.set("rrpShoppingCartVmStatus","ClearContextInProgress");var b=c.get("clearRRPTopicsList");if(b){for(var d=0;d<b.length;d++){var e=b[d];window.sessionStorage.removeItem(e)}window.localStorage.removeItem("LightsaberSessionToken"),setTimeout(function(){this.set("rrpShoppingCartVmStatus","ClearContextSuccess")}.bind(this),0)}},cancelOrderOnEshopRedirection:function(){return this.set("rrpEshopRedirectiontVmStatus","RRPCancelOrderMenuInProgress"),this._cancelOrder().then(this._cancelOrderEshopRedirectionSuccess.bind(this),this._cancelOrderEshopRedirectionFailure.bind(this))},_cancelOrderEshopRedirectionSuccess:function(){var a=this.get("response");"SUCCESS"==a.ImpRRPCancelOrderResponse.result?this.set("rrpEshopRedirectiontVmStatus","RRPCancelOrderMenuSuccess"):this.set("rrpEshopRedirectiontVmStatus","RRPCancelOrderMenuFailure")},_cancelOrderEshopRedirectionFailure:function(a){this.set("rrpEshopRedirectiontVmStatus","RRPCancelOrderMenuAPIFailure")}});return f});
define("businesswidget/repository_l9_common/common/model/rrp/RRPSendOTPModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/rrp/customer/rrp-order-id/:orderId/send-otp",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPCustomerDetailsRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPResendOTPModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/rrp/customer/rrp-order-id/:orderId/resend-otp",
rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPCustomerDetailsRequest"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPVerifyOTPModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/rrp/customer/rrp-order-id/:orderId/register-customer",rest:{defaults:{method:"POST",payload:["ImplRRPCustomerDetailsRequest"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/rrp/RRPCustomerRegistrationViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/rrp/RRPSendOTPModel","businesswidget/repository_l9_common/common/model/rrp/RRPResendOTPModel","businesswidget/repository_l9_common/common/model/rrp/RRPVerifyOTPModel","single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic"],function (a,b,c,d,e,f){var g=a.Core.ObservableViewModel.extend({models:{rrpSendOTPModel:c,rrpResendOTPModel:d,rrpVerifyOTPModel:e},subViewModels:{rrpOrderContextTopic:f},defaults:{isOtpSend:null,rrpCustomerRegVmStatus:null,customerDetails:null,customerDetailsWithOTP:null,sendOTPResponse:null},dataBindings:[{rrpOrderId:"subViewModels.rrpOrderContextTopic.rrpOrderId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){b.bindAll(this,"sendOTP","_sendOTPSuccess","resendOTP","_resendOTPSuccess","verifyOTPAndRegister")},sendOTP:function(){this.set("rrpCustomerRegVmStatus","SendOTPInProgress");var a={ImplRRPCustomerDetailsRequest:this.get("customerDetails")},b=this.get("rrpOrderId");return this.models.rrpSendOTPModel.set("orderId",b),this.models.rrpSendOTPModel.save(a,{success:this._sendOTPSuccess,error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo&&"Exceed OTP limit"==c.ErrorInfo.errorCode?this.set("rrpCustomerRegVmStatus","ExceedOTPAttempt"):this.set("rrpCustomerRegVmStatus","SendOTPFailed")}.bind(this)})},_sendOTPSuccess:function(a,b){var c=b.ImplRRPCustomerRegistrationResponse;this.set("sendOTPResponse",c),c.isOtpSend&&!c.isCustomerRegistered&&this.set("rrpCustomerRegVmStatus","SendOTPSuccess"),c.isCustomerRegistered&&this.set("rrpCustomerRegVmStatus","SendOTPSuccessWithCustomerRegistered")},resendOTP:function(){this.set("rrpCustomerRegVmStatus","ResendOTPInProgress");var a={ImplRRPCustomerDetailsRequest:this.get("customerDetails")},b=this.get("rrpOrderId");return this.models.rrpResendOTPModel.set("orderId",b),this.models.rrpResendOTPModel.save(a,{success:this._resendOTPSuccess,error:function(a,b){var c=b.responseJSON;c&&c.ErrorInfo&&"Exceed OTP limit"==c.ErrorInfo.errorCode?this.set("rrpCustomerRegVmStatus","ExceedOTPAttempt"):this.set("rrpCustomerRegVmStatus","ResendOTPFailed")}.bind(this)})},_resendOTPSuccess:function(a,b){var c=b.ImplRRPCustomerRegistrationResponse;this.set("resendOTPResponse",c),this.set("rrpCustomerRegVmStatus","ResendOTPSuccess")},verifyOTPAndRegister:function(){var a=this.models.rrpVerifyOTPModel,b={ImplRRPCustomerDetailsRequest:this.get("customerDetailsWithOTP")};this.set("rrpCustomerRegVmStatus","processing"),a.save(b,{orderId:this.get("rrpOrderId"),success:this._verifyOTPAndRegisterSuccess.bind(this),error:function(a,b){this.set("rrpCustomerRegVmStatus","CustomerRegisteredFailed")}.bind(this)})},_verifyOTPAndRegisterSuccess:function(a){var b=a.ImplRRPCustomerRegistrationResponse;this.set("verifyOTPRegResponse",b),this.set("rrpCustomerRegVmStatus","CustomerRegisteredSuccess")}});return g});
define("businesswidget/repository_l9_common/common/model/rrp/RRPSelfCollectionTimeSlotsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/rrp/fs-popstation-timeslots",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},read:{method:"GET",payload:["[]"]},create:{method:"POST",payload:["ImplReserveSelfCollectionTimeSlotsRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/rrp/RRPRetrieveLogisticAppointmentSlotsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/rrp/retrieve-logistic-appointments-slots",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplLogisticDispatchAvailableAppointmentsSlotsInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/rrp/RRPReserveLogisticAppointmentModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/rrp/order/rrp-order-id/:orderId/reserve-logistics-appointment",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplReserveLogisticsDispatchAppointmentInput"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/rrp/RRPOrderDeliveryDetailsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/rrp/order/rrp-order-id/:orderId/set-delivery-details",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPOrderDeliveryDetailsRequest"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/rrp/RRPAppointmentManagerViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","businesswidget/repository_l9_common/common/model/RetrievePOPStationsModel","businesswidget/repository_l9_common/common/model/rrp/RRPSelfCollectionTimeSlotsModel","moment","businesswidget/repository_l9_common/common/model/rrp/RRPRetrieveLogisticAppointmentSlotsModel","single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPCustomerRegistrationViewModel","businesswidget/repository_l9_common/common/model/rrp/RRPReserveLogisticAppointmentModel","businesswidget/repository_l9_common/common/model/rrp/RRPOrderDeliveryDetailsModel"],function (a,b,c,d,e,f,g,h,i,j,k,l){var m=a.Core.ObservableViewModel.extend({models:{retrievePOPStationsModel:e,rrpSelfCollectionTimeSlotsModel:f,rrpRetrieveLogisticAppointmentSlotsModel:h,rrpReserveLogisticAppointmentModel:k,rrpOrderDeliveryDetailsModel:l},subViewModels:{rrpOrderContextTopic:i,rrpCustomerRegistrationViewModel:j},defaults:{popStations:null,popStationPostalCode:null,checkoutFullfillmentVMStatus:null,appointmentSlotsCom:null,queryParam:null,selfCollection:null,appointmentSlots:null,appointmentSlotsVmStatus:null,courierDetails:null,reserveLogisticStatus:null,deliveryDetailsStatus:null},dataBindings:[{rrpOrderId:"subViewModels.rrpOrderContextTopic.rrpOrderId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){b.bindAll(this,"getPOPStations","getComTimeSlots","formatAppointments","reformatDate","onRetrieveAppointmentsSlots","fetchSlots","formatDate","reserveLogisticDispatch","reservePopComAppointment","orderDeliveryDetails")},getPOPStations:function(){var a=this,c=a.get("popStationPostalCode"),d=a.getModel("retrievePOPStationsModel");a.set("checkoutFullfillmentVMStatus","fetching"),d.set({postcode:c}),d.fetch({success:function(c,d){if("undefined"!=typeof d.ImplRetrievePOPStationsResponse){var e=d.ImplRetrievePOPStationsResponse.implPOPStationDetails;e&&e.length>0?(b.each(e,function(a){a.Distance=a.Distance/1e3}),a.set("popStations",e),a.set("checkoutFullfillmentVMStatus","popStationsFound")):a.set("checkoutFullfillmentVMStatus","noPopStationsFound")}else a.set("checkoutFullfillmentVMStatus","failure")},error:function(b,c){a.set("checkoutFullfillmentVMStatus","failure")}})},reserveLogisticDispatch:function(){var a=this,b=a.get("reserveLogisticData"),c=a.subViewModels.rrpCustomerRegistrationViewModel.get("customerDetails");c&&(b.msisdn=c.phone),a.set("reserveLogisticStatus","inProgress");var d=a.getModel("rrpReserveLogisticAppointmentModel");d.set({orderId:this.get("rrpOrderId")});var e={ImplReserveLogisticsDispatchAppointmentInput:b};d.save(e,{success:function(b,c){if("undefined"!=typeof c.ImplReserveLogisticsDispatchAppointmentOutput){var d=c.ImplReserveLogisticsDispatchAppointmentOutput.statusCode;"SUCCESS"===d?a.set("reserveLogisticStatus","reservedSlotSuccess"):a.set("reserveLogisticStatus","reservedSlotFailed")}},error:function(b,c){a.set("reserveLogisticStatus","reservedSlotFailed")}})},reservePopComAppointment:function(){var a=this;a.set("reserveLogisticStatus","inProgress");var b=a.get("reserveLogisticData"),c=a.get("queryParam"),d=a.getModel("rrpSelfCollectionTimeSlotsModel");d.setQueryParams(c);var e={ImplReserveSelfCollectionTimeSlotsRequest:b};d.save(e,{success:function(b,c){if("undefined"!=typeof c.ImplReserveSelfCollectionTimeSlotsResponse){var d=c.ImplReserveSelfCollectionTimeSlotsResponse.response;"True"===d?a.set("reserveLogisticStatus","reservedSlotSuccess"):a.set("reserveLogisticStatus","reservedSlotFailed")}},error:function(b,c){a.set("reserveLogisticStatus","reservedSlotFailed")}})},orderDeliveryDetails:function(){var a=this,b=a.get("deliveryDetailsData");a.set("deliveryDetailsStatus","inProgress");var c=a.getModel("rrpOrderDeliveryDetailsModel");c.set({orderId:this.get("rrpOrderId")});var d={ImplRRPOrderDeliveryDetailsRequest:b};c.save(d,{success:function(b,c){if("undefined"!=typeof c.ImplRRPOrderDeliveryDetailsResponse){var d=c.ImplRRPOrderDeliveryDetailsResponse.result;"SUCCESS"===d?a.set("deliveryDetailsStatus","orderDeliverySuccess"):a.set("deliveryDetailsStatus","orderDeliveryFailed")}},error:function(b,c){a.set("deliveryDetailsStatus","orderDeliveryFailed")}})},getComTimeSlots:function(){var a=this;a.set("appointmentSlotsCom",null);var b=a.get("selfCollection");if(a.set("collectionTimeSlotVmStatus","retrieveTimeSlots"),null!==b){var c=a.getModel("rrpSelfCollectionTimeSlotsModel"),d={cdf:"",dealer:b.dealer,documentRequired:b.documentRequired,outlet:b.outlet,ld:b.leadDays};b.orderActionId&&(d.ld=1,d.appointmentOrderActionId=b.orderActionId),a.set("queryParam",d),c.setQueryParams(d),c.fetch({success:function(c,d){"undefined"!=typeof d.ImplSelfCollectionTimeSlotsResponse?(a.formatAppointments(d.ImplSelfCollectionTimeSlotsResponse.implSelfCollectionTimeSlots,b.leadDays),a.set("collectionTimeSlotVmStatus","slotsRetrieved")):a.set("collectionTimeSlotVmStatus","slotsNotRetrieved")},error:function(b,c){a.set("collectionTimeSlotVmStatus","failed")}})}else a.set("collectionTimeSlotVmStatus","failed")},formatAppointments:function(a,c){var d={enabledDays:[],dateTimeSlots:{},dateTimeSlotsObj:{}},e=this,f=[];a.sort(function(a,b){var c=g(a.slotDate,"M/D/YYYY").unix(),d=g(b.slotDate,"M/D/YYYY").unix();return c-d}),b.each(a,function(a){if(d.enabledDays.length<6){a.slotDate=e.reformatDate(a.slotDate,"/");1e3*g(a.slotDate,"YYYY-MM-DD").unix();f.push(a),b.contains(d.enabledDays,a.slotDate)||d.enabledDays.push(a.slotDate);var c=d.dateTimeSlots[a.slotDate],h=d.dateTimeSlotsObj[a.slotDate];"undefined"==typeof c&&(c=[],h=[]),h.push(b.extend({id:a.id,value:a.slotCode,title:a.slotDesc,text:a.slotDesc},a)),c.push(a.slotDesc),c=b.uniq(c),d.dateTimeSlots[a.slotDate]=c,d.dateTimeSlotsObj[a.slotDate]=h}});var h=b.uniq(d.enabledDays);d.enabledDays=h,e.set("appointmentSlotsCom",d),e.set("slots",f),e.set("collectionTimeSlotVmStatus","success")},reformatDate:function(a,b){dArr=a.split(b);var c=parseInt(dArr[0]);c=c<10?"0"+c:c;var d=parseInt(dArr[1]);return d=d<10?"0"+d:d,dArr[2]+"-"+c+"-"+d},onRetrieveAppointmentsSlots:function(){var a=this;a.set("appointmentSlots",null);var b=$.Deferred(),c=a.get("courierDetails"),d=c.leadDays,e=(c.slotType,(new Date).getTime());a.getDateStringInSGP(parseInt(e),!1,10),a.getDateStringInSGP(parseInt(d),!1,10);return a.fetchSlots(c,b),b},fetchSlots:function(a,b){var c=this,d={slotType:a.slotType,paymentMode:a.paymentMode,dealerCode:a.dealerCode,documentRequired:a.documentRequired,leadDay:a.leadDays};c.set("appointmentSlotsVmStatus","slotsRetrieveInProgress"),a.orderActionId&&c.getModel("rrpRetrieveLogisticAppointmentSlotsModel").setQueryParams({appointmentOrderActionId:a.orderActionId}),c.getModel("rrpRetrieveLogisticAppointmentSlotsModel").save({ImplLogisticDispatchAvailableAppointmentsSlotsInput:d},{success:function(d,e){"undefined"!=typeof e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput&&"undefined"!=typeof e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput.slots&&e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput.slots.length>0?(c.formatDate(e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput.slots,a.slotType,a.leadDays),c.set("appointmentSlotsVmStatus","slotsRetrieved"),b.resolve("SUCCESS")):(c.set("appointmentSlotsVmStatus","slotsNotRetrieved"),b.resolve("SUCCESS"))},error:function(a,d){c.set("appointmentSlotsVmStatus","failure"),b.resolve("failure")}})},formatDate:function(a,c,d){var e=this,f=e.get("appointmentSlots");null===f&&(f={enabledDays:[],dateTimeSlots:{},dateTimeSlotsObj:{}});var g=[],h=(new Date).getTime(),i=e.getDateStringInSGP(parseInt(h),!1,10);b.each(a,function(a){var d=!0;if(a.slotDate=e.getDateStringInSGP(parseInt(a.slotStartDate),!1,10),"D"===c&&i!==a.slotStartDate&&(d=!1),a.slotDate=e.getDateStringInSGP(parseInt(a.slotStartDate),!1,10),d&&(f.enabledDays.length<5||5===f.enabledDays.length&&b.contains(f.enabledDays,a.slotDate))){a.slotType=c,g.push(a);var h=b.filter(f.enabledDays,function(b){return b===a.slotDate});"undefined"!=typeof h&&0!==h.length||f.enabledDays.push(a.slotDate);var j=f.dateTimeSlots[a.slotDate],k=f.dateTimeSlotsObj[a.slotDate];"undefined"==typeof j&&(j=[],k=[]),k.push(b.extend({id:a.slotCode,value:a.timeDescription,title:a.timeDescription,text:a.timeDescription},a)),j.push(a.timeDescription),f.dateTimeSlots[a.slotDate]=j,f.dateTimeSlotsObj[a.slotDate]=k}});var j=b.uniq(f.enabledDays);g.enabledDays=j,e.set("slots",g),e.set("appointmentSlots",f)},getDateStringInSGP:function(a,b,c){var e=g(g(a).utcOffset("+0800").format("YYYY-MM-DD HH:mm:ss")).toDate(),f={full:0,"short":1,general:2,monthYear:3,monthNameYear:4,dayMonth:5,dayMonthName:6,"YYYY-MM":7,"YYYY/MM/DD":8,"DD/MM/YYYY":9,"YYYY-MM-DD":10,"mm:ss":11,"DD-MMM":12,"MMM-YY":13,"DD MMM YYYY":14,"MM/DD/YYYY":15},h=d.getLocale();h=h.toLowerCase();var i,j=e.getHours(),k=e.getMinutes(),l=e.getSeconds(),m=e.getFullYear(),n=""+new String(e.getFullYear()).substring(2,4),o=e.getDate(),p=e.getMonth()+1,q=this.monthName(e.getMonth()),r=this.shortMonthName(e.getMonth()),s="";switch(k<10&&(k="0"+k),l<10&&(l="0"+l),"en-us"==h?(j>12?(j=j-12+"",i=" PM"):i=j<12?" AM":" PM",p<10&&(p="0"+p),o<10&&(o="0"+o)):(p<10&&(p="0"+p),o<10&&(o="0"+o)),c){case f.full:switch(h){case"en-us":s=q+" "+o+", "+m;break;case"fr-fr":s=o+" "+q+m;break;default:s=q+" "+o+", "+m}break;case f["short"]:switch(h){case"en-us":s=p+"/"+o+"/"+n;break;case"fr-fr":s=o+"/"+p+"/"+n;break;default:s=o+"/"+p+"/"+n}break;case f.general:switch(h){case"en-us":s=p+"/"+o+"/"+m;break;case"fr-fr":s=o+"/"+p+"/"+m;break;default:s=o+"/"+p+"/"+m}break;case f["YYYY/MM/DD"]:s=m+"/"+p+"/"+o;break;case f["YYYY-MM-DD"]:s=m+"-"+p+"-"+o;break;case f["DD/MM/YYYY"]:s=p+"/"+o+"/"+m;break;case f["mm:ss"]:s=k+":"+l;break;case f.monthYear:s=p+"/"+n;break;case f.monthNameYear:s=q+" "+m;break;case f.dayMonth:switch(h){case"en-us":s=p+"/"+o;break;case"fr-fr":s=o+"/"+p;break;default:s=o+"/"+p}break;case f.dayMonthName:switch(h){case"en-us":var t=o.toString(),u=t.substr(t.length-1);"1"==u?t+="st":"2"==u?t+="nd":"3"==u?v=t+"rd":t+="th",s=q+" "+t;break;case"fr-fr":s=o+" "+q;break;default:s=o+" "+q}break;case f["YYYY-MM"]:s=m+"-"+p;break;case f["DD-MMM"]:s=o+"-"+r;break;case f["MMM-YY"]:s=r+"-"+m.toString().substring(2,4);break;case f["DD MMM YYYY"]:s=o+" "+r.toUpperCase()+" "+m+" ";break;case f["MM/DD/YYYY"]:s=p+"/"+o+"/"+m}if(b)if(c==f.full)switch(h){case"en-us":s=s+" "+j+":"+k+":"+l+i;break;case"fr-fr":s=s+" "+j+":"+k+":"+l;break;default:s=s+" "+j+":"+k+":"+l}else switch(h){case"en-us":s=s+"- "+j+":"+k+i;break;case"fr-fr":s=s+" "+j+":"+k;break;default:s=s+" "+j+":"+k}return s},monthName:function(a){switch(a){case 0:return c.getString("util_mo_Jan");case 1:return c.getString("util_mo_Feb");case 2:return c.getString("util_mo_Mar");case 3:return c.getString("util_mo_Apr");case 4:return c.getString("util_mo_May");case 5:return c.getString("util_mo_Jun");case 6:return c.getString("util_mo_Jul");case 7:return c.getString("util_mo_Aug");case 8:return c.getString("util_mo_Sep");case 9:return c.getString("util_mo_Oct");case 10:return c.getString("util_mo_Nov");case 11:return c.getString("util_mo_Dec");default:return c.getString("util_mo_Jan")}},shortMonthName:function(a){switch(a){case 0:return c.getString("util_mo_short_Jan");case 1:return c.getString("util_mo_short_Feb");case 2:return c.getString("util_mo_short_Mar");case 3:return c.getString("util_mo_short_Apr");case 4:return c.getString("util_mo_short_May");case 5:return c.getString("util_mo_short_Jun");case 6:return c.getString("util_mo_short_Jul");case 7:return c.getString("util_mo_short_Aug");case 8:return c.getString("util_mo_short_Sep");case 9:return c.getString("util_mo_short_Oct");case 10:return c.getString("util_mo_short_Nov");case 11:return c.getString("util_mo_short_Dec");default:return c.getString("util_mo_short_Jan")}}});return m});
define("businesswidget/repository_l9_common/common/model/rrp/RRPPaymentDetailsToDBModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){return a.extend({options:{url:"/rrp/payment/rrp-order-id/:orderId/onepay/V2/payment/requests",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplRRPOnePayPaymentRequest"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/rrp/RRPPaymentGatewayViewModel",["lightsaber","underscore","Configuration","moment","single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic","businesswidget/repository_l9_common/common/model/rrp/RRPPaymentDetailsToDBModel"],function (a,b,c,d,e,f){var g=a.Core.ObservableViewModel.extend({models:{rrpPaymentDetailsToDBModel:f},subViewModels:{rrpOrderContextTopic:e},defaults:{paymentGatewayWithDBStatus:null,paymentGatewayOutput:null,pgData:null,onePayPaymentMethods:{cc:"CREDIT_CARD",mCash:"MCASH",enets:"ENETS_IB",2:"CREDIT_CARD",4:"ENETS_IB",3:"MCASH"},rrpPaymentSimulator:c.get("rrpPaymentSimulator")},dataBindings:[{rrpOrderId:"subViewModels.rrpOrderContextTopic.rrpOrderId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){b.bindAll(this,"startPayment")},startPayment:function(){var a=this.get("onePayPaymentMethods"),b=this.get("pgData");b.payment_method=a[b.payment_method],this.set("paymentGatewayWithDBStatus","vmInitialized");var c=this.getModel("rrpPaymentDetailsToDBModel");c.set({orderId:this.get("rrpOrderId")});var d={ImplRRPOnePayPaymentRequest:b};c.setQueryParams({flowType:"rrp"}),c.save(d,{success:function(a,c){if("undefined"!=typeof c.ImplRRPOnePayPaymentResponse){var d=c.ImplRRPOnePayPaymentResponse;this.get("rrpPaymentSimulator")&&(d.redirect_url=d.redirect_url.concat("&gateway_reference="+d.gateway_reference).concat("&amount="+b.cart_details.total_amount_inc_gst)),this.set("paymentGatewayOutput",d),this.set("paymentGatewayWithDBStatus","paymentGatewaySuccess")}else this.set("paymentGatewayWithDBStatus","paymentGatewayFailed")}.bind(this),error:function(a,b){b.responseJSON&&b.responseJSON.ErrorInfo&&"MtposAccessoriesExtensionFailed"===b.responseJSON.ErrorInfo.errorCode?this.set("paymentGatewayWithDBStatus","MtposAccessoriesExtensionFailed"):this.set("paymentGatewayWithDBStatus","paymentGatewayFailed")}.bind(this)})}});return g});
define("businesswidget/repository_l9_common/common/model/PlanDetailsModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){var c=a.extend({options:{url:"ecommerce/catalog/plan/:catalogPlanId",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},method:"GET"}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/PlanDetailsViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/PlanDetailsModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f,g,h,i){var j=b.Core.ObservableViewModel.extend({models:{PlanDetailsModel:e},subViewModels:{customerInContextTopicViewModel:f,productConfigurationTopicViewModel:g,myProductsAndServicesWidgetViewModel:h},dataBindings:[{catalogPlanId:"subViewModels.myProductsAndServicesWidgetViewModel.catalogItemID",options:{twoWay:!1,setOnBind:!0}},{po:"subViewModels.productConfigurationTopicViewModel.productOfferingID",options:{twoWay:!1,setOnBind:!0}},{opi:"subViewModels.productConfigurationTopicViewModel.productOfferingProductSpecID",options:{twoWay:!1,setOnBind:!0}},{cpi:"subViewModels.myProductsAndServicesWidgetViewModel.assignedProductID",options:{twoWay:!1,setOnBind:!0}},{ci:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{locale:c.get("locale"),sc:c.get("salesChannel"),customerId:null,ImplCatalogPlan:null,po:null,opi:null,cpi:null,ci:null,rch:!0},config:{actions:{planIdDeviceIdSetInTopic:function(){this.get("planId")&&this.get("relationId")&&(i.set("planId",this.get(planId)),i.set("relationId",this.get(relationId)))}}},onFetchSuccess:function(a,b){this.set("ImplCatalogPlan",b.ImplCatalogPlan)},formatNumber:function(a,b){var c="\\d(?=(\\d{"+(a||3)+"})+"+(b>0?"\\.":"$")+")",d=a.toFixed(Math.max(0,~~b)).replace(new RegExp(c,"g"),"$&,");return d},imageResizer:function(){this.trigger("imageResizerView")},initialize:function(a){d.bindAll(this,"onFetchSuccess","formatNumber","imageResizer"),this.set("catalogPlanId",this.subViewModels.myProductsAndServicesWidgetViewModel.get("catalogItemID")),this.set("po",this.subViewModels.productConfigurationTopicViewModel.get("productOfferingID")),this.set("opi",this.subViewModels.productConfigurationTopicViewModel.get("productOfferingProductSpecID")),this.set("cpi",this.subViewModels.myProductsAndServicesWidgetViewModel.get("assignedProductID")),this.set("ci",this.subViewModels.customerInContextTopicViewModel.get("ID")),this.set("formatNumber",this.formatNumber),this.set("imageResizer",this.imageResizer),this.setQueryParamsRequest(),e.fetch({catalogPlanId:this.get("catalogPlanId"),success:this.onFetchSuccess})},setQueryParamsRequest:function(){var a=this.models.PlanDetailsModel.getDataSource().methods.defaults.qParams;a||(a={}),$.extend(a,{rch:this.get("rch")}),this.subViewModels.productConfigurationTopicViewModel.get("productOfferingID")&&$.extend(a,{po:this.subViewModels.productConfigurationTopicViewModel.get("productOfferingID")}),this.subViewModels.productConfigurationTopicViewModel.get("productOfferingProductSpecID")&&$.extend(a,{opi:this.subViewModels.productConfigurationTopicViewModel.get("productOfferingProductSpecID")}),this.subViewModels.myProductsAndServicesWidgetViewModel.get("assignedProductID")&&$.extend(a,{cpi:this.subViewModels.myProductsAndServicesWidgetViewModel.get("assignedProductID")}),d.isUndefined(this.subViewModels.customerInContextTopicViewModel.get("ID"))||d.isEmpty(this.subViewModels.customerInContextTopicViewModel.get("ID"))||$.extend(a,{ci:this.subViewModels.customerInContextTopicViewModel.get("ID")}),this.models.PlanDetailsModel.setQueryParams(a)},isAllDataAvailable:function(){return!0}});return j});
define("businesswidget/repository_l9_common/common/model/DeviceDetailsModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){var c=a.extend({options:{url:"ecommerce/catalog/device/:deviceId",rest:{defaults:{qParams:{lo:b.get("locale"),sc:b.get("salesChannel")}}}}});return c});
define("businesswidget/repository_l9_common/common/model/DeviceDetails_CheckEquipmentAvailableModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){var c=a.extend({options:{url:"sku/:itemsCode/availability",rest:{defaults:{method:"GET",qParams:{lo:b.get("locale"),sc:b.get("salesChannel")}}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/DeviceDetailsViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/DeviceDetailsModel","single!businesswidget/repository_l9_common/common/model/DeviceDetails_CheckEquipmentAvailableModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f,g,h){var i=b.Core.ObservableViewModel.extend({models:{DeviceDetailsModel:e,DeviceDetails_CheckEquipmentAvailableModel:f},subViewModels:{customerInContextTopicViewModel:g},dataBindings:[],defaults:{customerId:null,deviceId:0,ImplCatalogDevice:null,ImplCheckEquipmentAvailablityOutput:null,doi:"",cpi:"",opi:"",srp:!1,salesChannel:"",locale:""},getDeviceDetailsSuccess:function(a,b){this.set("ImplCatalogDevice",b.ImplCatalogDevice);var c=d.find(b.ImplCatalogDevice.summary,function(a){return"SKU"===a.name});c&&null!=c&&f.fetch({itemsCode:c.values[0].value,success:this.getDeviceDetails_CheckEquipmentAvailableSuccess})},getDeviceDetails_CheckEquipmentAvailableSuccess:function(a,b){b.ImplCheckEquipmentAvailablityOutput.getStatus=function(){var a=[{key:"PU",value:"Available (to Pick Up at a store)"},{key:"PO",value:"Available (to Pre Order as a store)"},{key:"BO",value:"Available (to Back Order at a store)"},{key:"NA",value:"Not available"},{key:"AL",value:"Available"}];return function(b){var c=d.find(a,function(a){return a.key===b});return c&&null!=c?c.value:"Status not found"}}(),this.set("ImplCheckEquipmentAvailablityOutput",b.ImplCheckEquipmentAvailablityOutput)},formatNumber:function(a,b){var c="\\d(?=(\\d{"+(a||3)+"})+"+(b>0?"\\.":"$")+")",d=a.toFixed(Math.max(0,~~b)).replace(new RegExp(c,"g"),"$&,");return d},initialize:function(a){d.bindAll(this,"getDeviceDetailsSuccess","getDeviceDetails_CheckEquipmentAvailableSuccess","formatNumber","onDeviceIdChanged"),this.set("formatNumber",this.formatNumber),this.set("deviceIdTopic",this.onDeviceIdChanged),this.get("deviceId",!0).subscribe(this.onDeviceIdChanged);var b=this.get("deviceId");b&&this.onDeviceIdChanged(b)},onDeviceIdChanged:function(a){var b={doi:this.data.doi(),opi:this.data.opi(),srp:this.data.srp(),sc:this.data.salesChannel(),lo:this.data.locale()},c=this.data.cpi();void 0!=c&&""!=c&&(b.cpi=c),this.models.DeviceDetailsModel.setQueryParams(b),e.fetch({deviceId:a,success:this.getDeviceDetailsSuccess})},isAllDataAvailable:function(){return null!=this.get("customerId")},config:{actions:{deviceIdSetInTopic:function(){this.get("deviceId")&&h.set("deviceId",this.get(deviceId))}}}});return i});
define("businesswidget/repository_l9_common/common/viewmodel/business/MiniCartViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/SearchAddressinCRMModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"],function (a,b,c,d,e,f,g,h){var i=a.Core.ObservableViewModel.extend({subViewModels:{miniCartInContextTopic:d,deviceIdAndPlanIdInContextTopic:c,shoppingCartViewModel:e,orderInContextTopicViewModel:f,onePassTopicViewModel:h},models:{searchAddressinCRMModel:g},dataBindings:[{id:"subViewModels.miniCartInContextTopic.id",options:{twoWay:!1,setOnBind:!0}},{currentStepNumber:"subViewModels.miniCartInContextTopic.currentStepNumber",options:{twoWay:!1,setOnBind:!0}}],defaults:{initialSteps:null,miniCartVmStatus:"",previousStepNumber:-1,currentStepNumber:"",id:null,reverse:!1,orderData:{},oneTimePrice:null,prices:null,customerNric:null,mobileContentList:null},initialize:function(){b.bindAll(this,"createInitialSteps","onPopulateSteps","onAddAndRemoveAddon","populateSteps","setDeviceDetails","setDetails","loadMiniCartData","setAddons","setLandlineSingnetDetails","setPrices","getMiniCartData"),setTimeout(function(){this.set("miniCartVmStatus","vmInitialized")}.bind(this),0)},getMiniCartData:function(){var a=this.subViewModels.orderInContextTopicViewModel.get(),b=this.subViewModels.miniCartInContextTopic.get("id");a.productOrderID&&a.productOrderID.length>0?a.currentOrderActions&&a.currentOrderActions.length>0?this.loadMiniCartData():"deviceFirst"!==b&&"tabletFirst"!==b&&"mBBDeviceFirst"!==b&&"TV"!==b&&"FIBER"!==b||this.createInitialSteps():"deviceFirst"!==b&&"mBBDeviceFirst"!==b&&"TV"!==b&&"FIBER"!==b&&"tabletFirst"!==b||this.createInitialSteps(),this.set("customerNric",this.subViewModels.onePassTopicViewModel.get("nric"))},loadMiniCartData:function(){var a=this,b=a.subViewModels.orderInContextTopicViewModel.get();if("undefined"!=typeof b.productOrderID&&null!==b.productOrderID){a.subViewModels.shoppingCartViewModel.set("mobileContentList",a.get("mobileContentList"));var c=a.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);c.done(function(b){if("SUCCESS"===b){var c=this.get("orderData")||{};c.order=a.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order"),a.set("orderData",c),a.createInitialSteps(c.order),a.set("miniCartVmStatus","miniCartLoaded")}}.bind(a))}},createInitialSteps:function(a){var c=(this.subViewModels.orderInContextTopicViewModel.get(),this.subViewModels.miniCartInContextTopic.get("id")),d={deviceFirst:["Phone","Plan","Number","Add-ons","Accessories"],planFirst:["Plan","Phone","Number","Add-ons","Accessories"],simOnlyPlan:["Plan","Number","Add-ons","Accessories"],mBBPlanFirst:["Plan","Tablet","Number","Add-ons","Accessories"],tabletFirst:["Tablet","Plan","Number","Add-ons","Accessories"],tabletPlanFirst:["Plan","Tablet","Number","Add-ons","Accessories"],mBBDeviceFirst:["Tablet","Plan","Number","Add-ons","Accessories"],mobileSharePlan:["Plan","MobileShare Number","MainLine","Add-ons"],FIBER:["Broadband Plan","Address","Landline & Singnet ID","Add-ons","Premium Add-ons"],TV:["TV Pack","Address","Add-ons","Top-ups"]},e=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");if("undefined"!=typeof a){var f=e[0].productOrderItemID,g=b.find(a.mobile,function(a){return a.productOrderItemID==f}),h=b.find(a.tv,function(a){return a.productOrderItemID==f}),i=(a.fv,a.bundle);"undefined"!=typeof g&&g.productOrderItemID===f?"8517942"===g.productOfferingID||"14308172"===g.productOfferingID||"14317472"===g.productOfferingID||"25972184"===g.productOfferingID||"25988684"===g.productOfferingID||"26019054"===g.productOfferingID?this.populateSteps(d.mobileSharePlan,a):this.populateSteps(d[c],a):"undefined"!=typeof h&&h.productOrderItemID===f?this.populateSteps(d.TV,a):"undefined"!=typeof i&&i.length>0&&this.populateSteps(d.FIBER,a)}else this.populateSteps(d[c],a);this.set("miniCartVmStatus","default values set")},populateSteps:function(a,c){var d=[];b.each(a,function(a,b){var c={title:a,id:"step-"+b,keyValues:[],oneTimeFee:null,recurringFee:null,changeFlag:!0};d.push(c)}),this.onPopulateSteps(d,c)},onAddAndRemoveAddon:function(){var a=this.get("addOrRemoveFlag"),b=this.subViewModels.miniCartInContextTopic.get("flowData"),c=this.get("initialSteps")||miniCartTopicData.initialSteps;currentStepNumber=this.subViewModels.miniCartInContextTopic.get("currentStepNumber");var d=currentStepNumber-1;if(b.addons&&"step-3"==c[d].id){var e={name:"addons",value:b.addons};if("add"===a)c[d].keyValues.push(e);else{var f=c[d].keyValues.length;f>0&&c[d].keyValues.splice(f-1,1)}this.set("initialSteps",c),this.set("miniCartVmStatus","setps value changes")}},onPopulateSteps:function(a,c){var d=this,e=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");if("undefined"!=typeof c){var f=e[0].productOrderItemID,g=b.find(c.mobile,function(a){return a.productOrderItemID==f}),h=b.find(c.tv,function(a){return a.productOrderItemID==f}),i=c.fv,j=c.bundle;"undefined"!=typeof g&&g.productOrderItemID===f?(this.setPrices(g),this.createStepsForMobile(a,g)):"undefined"!=typeof h&&h.productOrderItemID===f?(this.setPrices(h),this.createStepsForTV(a,h,i)):"undefined"!=typeof j&&j.length>0&&(this.setPrices(j[0]),this.createStepsForFibre(a,j))}else{var k=d.subViewModels.miniCartInContextTopic.get(),l=k.flowData;b.each(a,function(a){if("Phone"!==a.title&&"Tablet"!==a.title||d.setDeviceDetails(l,a),"Broadband Plan"===a.title||"TV Pack"===a.title){var b=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"),c=l.planName;b&&"staff"===b&&(c+="(Staff)"),d.setDetails(c,a)}});var m=l.devicePrice||0,n={oneTimeCost:m||0,upfront:l.devicePrice||0,additionCost:0,monthly:k.monthlyCharges};d.set("prices",n)}d.set("initialSteps",a),d.set("miniCartVmStatus","setps value changes")},createStepsForMobile:function(a,c){var d=this;b.each(a,function(a){if("undefined"!=typeof c){if(("Phone"===a.title||"Tablet"===a.title)&&"undefined"!=typeof c.deviceDetails&&c.deviceDetails.length>0)d.setDeviceDetails(c.deviceDetails[0],a);else if("Phone"===a.title||"Tablet"===a.title){var b=d.subViewModels.miniCartInContextTopic.get(),e=b.flowData;b&&e&&d.setDeviceDetails(e,a)}if("Plan"===a.title&&"undefined"!==c.planDetails&&c.planDetails.length>0&&d.setDetails(c.planDetails[0].planName,a),"MainLine"===a.title&&"undefined"!=typeof c.mainLineDetails&&d.setDetails(c.mainLineDetails.singtelMobile,a),"Number"!==a.title&&"MobileShare Number"!==a.title||d.setDetails(c.subscriptionId,a),"Add-ons"===a.title){var f=c.addons||[];c.mobileContents&&c.mobileContents.length>0&&(f=f.concat(c.mobileContents)),d.setAddons(f,a)}"Accessories"===a.title&&"undefined"!=typeof c.accessories&&d.setAddons(c.accessories,a)}})},createStepsForFibre:function(a,c){var d=this;b.each(a,function(a){"undefined"!=typeof c&&c.length>0&&("Broadband Plan"===a.title&&"undefined"!=typeof c[0].serviceDetails&&c[0].serviceDetails.length>0&&d.setDetails(c[0].categoryName,a),"Address"===a.title&&"undefined"!=typeof c[0].installationAddressID&&d.getInstallationAddress(c[0].installationAddressID,a),"Landline & Singnet ID"===a.title&&"undefined"!=typeof c[0].landlineNumber&&d.setLandlineSingnetDetails(c[0],a),"Add-ons"===a.title&&d.setAddons(c[0].addons,a),"Premium Add-ons"===a.title&&d.setAddons(c[0].premiumAddons,a))})},createStepsForTV:function(a,c,d){var e=this;b.each(a,function(a){"undefined"!=typeof c&&("TV Pack"===a.title&&"undefined"!=typeof c.tvPlanDetails&&e.setDetails(c.tvPlanDetails.serviceType,a),"Address"===a.title&&e.getInstallationAddress(c.installationAddressID,a),"Add-ons"===a.title&&e.setAddons(c.addons,a),"Top-ups"===a.title&&e.setAddons(c.topup,a))})},setDeviceDetails:function(a,c){if("undefined"!=typeof a){var d=[],e="";if(e=a.deviceName&&a.deviceSize?a.deviceName+" "+a.deviceSize:a.deviceSize,a.deviceSize){var f={name:"model",value:e};d.push(f)}if(a.colour||a.deviceColor){var f={name:"color",value:a.colour||a.deviceColor};d.push(f)}0===c.keyValues.length?b.each(d,function(a){c.keyValues.push(a)}):d.length>0&&(c.keyValues.length=0,b.each(d,function(a){c.keyValues.push(a)}))}},setDetails:function(a,b){if("undefined"!=typeof a&&null!==a&&""!==a){var c=this.subViewModels.deviceIdAndPlanIdInContextTopic.get(),d=(this.subViewModels.orderInContextTopicViewModel.get("mobileFlow"),{name:b.title,value:a});(("MBB"===c.planType||c.mobileReContractFlag||c.mobilePortinFlag)&&"Number"===b.title||"MobileShare Number"===b.title)&&(b.changeFlag=!1),"Plan"!==b.title&&"Broadband Plan"!==b.title&&"TV Pack"!==b.title||(d.planStep=!0),0===b.keyValues.length?b.keyValues.push(d):b.keyValues[0]=d}},getInstallationAddress:function(a,c){if("undefined"!=typeof a&&null!==a){var d=this,e=d.getModel("searchAddressinCRMModel");e.setQueryParams({addressIds:[a]}),e.fetch({success:b.bind(d.setAddress,d,a,c),error:b.bind(d._onError,d)})}},setAddress:function(a,c,d,e){var f=e.HashMap[a],g=this.get("initialSteps");b.each(g,function(a){if("Address"===a.title){var b={name:a.title,value:"Singapore "+f.postcode};0===a.keyValues.length?a.keyValues.push(b):a.keyValues[0]=b}}),this.set("initialSteps",g)},setAddons:function(a,c){var d=[];b.each(a,function(a){a.recurringPrice&&a.recurringPrice.finalAmountIncludingTax>=0&&d.push({name:c.title,value:a.name})}),c.keyValues=d},_onError:function(a,b){this.set("miniCartVmStatus","initialized")},setLandlineSingnetDetails:function(a,b){var c=[];c.push({name:b.title,value:a.landlineNumber.details},{name:b.title,value:a.subscriptionId}),b.keyValues=c},setPrices:function(a){var b=a.oneTimePrice.finalAmountIncludingTax||0,c=a.checkoutPrice.finalAmountIncludingTax||0,d=b+c;a.checkoutPrice.finalAmountIncludingTax||0;var e={oneTimeCost:d,upfront:c,additionCost:b,monthly:a.recurringPrice.finalAmountIncludingTax||0};this.set("prices",e)}});return i});
define("businesswidget/repository_l9_common/common/model/ShippingAddressModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/ecommerce/order/:orderId/shipping-address",rest:{defaults:{method:"GET"}}}});return b});
define("businesswidget/repository_l9_common/common/viewmodel/ShippingAddressViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/ShippingAddressModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel"],function (a,b,c,d,e,f){var g=b.Core.ObservableViewModel.extend({models:{ShippingAddressModel:e},subViewModels:{customerInContextTopicViewModel:f},defaults:{locale:c.get("locale"),sc:c.get("salesChannel"),customerId:null,ImplShippingAddressResponse:null},onFetchSuccess:function(a,b){this.set("ImplShippingAddressResponse",b.ImplShippingAddressResponse)},initialize:function(a){d.bindAll(this,"onFetchSuccess"),this.customerId=this.subViewModels.customerInContextTopicViewModel.get("id"),e.fetch({id:this.customerId,success:this.onFetchSuccess})},isAllDataAvailable:function(){return null!=this.get("customerId")}});return g});
define("businesswidget/repository_l9_common/common/model/InstallationAddressModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/commerce/customer/:customerId/installation-addresses",rest:{defaults:{method:"GET"}}}});return b});
define("businesswidget/repository_l9_common/common/model/GeneralConfirmationAutoCreateCustomerProblemModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/support/customer/:customerId/contact-person/:contactId/auto-customer-problem",rest:{defaults:{method:"POST",contentType:"application/json",payload:["Map"]}}}});return b});
define("businesswidget/repository_l9_common/common/viewmodel/GeneralConfirmationViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/GeneralConfirmationAutoCreateCustomerProblemModel","single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerOrdersViewModel","single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/ShippingAddressViewModel"],function (a,b,c,d,e,f,g,h,i){var j=b.Core.ObservableViewModel.extend({models:{GeneralConfirmationAutoCreateCustomerProblemModel:e},subViewModels:{customerInContextTopicViewModel:f,customerOrdersViewModel:g,individualInContextTopicViewModel:h,shippingAddressViewModel:i},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{orderId:"subViewModels.customerOrdersViewModel.orderId",options:{twoWay:!1,setOnBind:!0}},{orderStatuses:"subViewModels.customerOrdersViewModel.orderStatuses",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{locale:c.get("locale"),sc:c.get("salesChannel"),customerId:null,orderId:null,orderStatuses:null,contactId:null,customerProblemId:null,displayErrorMessage:"not",displayOnePas:!0,displayShippingAddress:!1,displayInstallation:!1,shippingAddressViewModelData:null},initialize:function(a){d.bindAll(this,"onFetchSuccess","onFetchError","setShippingAddress","setInstallationAddress","createCustomerProblem"),this.set("orderId",this.subViewModels.customerOrdersViewModel.get("orderId")),this.set("orderStatuses",this.subViewModels.customerOrdersViewModel.get("orderStatuses")),this.set("shippingAddressViewModelData",this.subViewModels.shippingAddressViewModel.data),this._bindEvents(),this.checkSubmitOrderResponse()},_bindEvents:function(){this.subViewModels.customerInContextTopicViewModel.on("change:ID",this.checkSubmitOrderResponse,this),this.subViewModels.customerOrdersViewModel.on("change:orderId",this.checkSubmitOrderResponse,this),this.subViewModels.customerOrdersViewModel.on("change:orderStatuses",this.checkSubmitOrderResponse,this),this.subViewModels.individualInContextTopicViewModel.on("change:personId",this.checkSubmitOrderResponse,this)},checkSubmitOrderResponse:function(a){"success"!=this.get("orderStatuses")?this.createCustomerProblem():(this.set("displayErrorMessage",!1),this.subViewModels.shippingAddressViewModel.data.ImplShippingAddressResponse.subscribe(this.setShippingAddress))},createCustomerProblem:function(){e.set({Map:{orderId:this.get("orderId")}}),e.fetch({customerId:this.get("customerId"),contactId:this.get("contactId"),success:this.onFetchSuccess,error:this.onFetchError,type:"POST"})},setInstallationAddress:function(a){null!=a&&this.set("displayInstallation",!0)},setShippingAddress:function(a){null!=a&&this.set("displayShippingAddress",!0)},onFetchSuccess:function(a,b){this.set("customerProblemId",b),this.set("displayErrorMessage",!0)},onFetchError:function(a){return this.set("customerProblemId",null),this.set("displayErrorMessage",!0),!0},isAllDataAvailable:function(){return null!=this.get("customerId")},config:{actions:{printScreen:function(a){delay=1,$(".ux-accordion__arrow--collapsed").trigger("click"),$(".printIcon").hide(),console.log("print button was clicked"),setTimeout(function(){window.print()},1e3*delay),setTimeout(function(){$(".ux-accordion__arrow--ux-accordion__arrow--expanded").trigger("click")},1e3*delay),setTimeout(function(){$(".printIcon").show()},1e3*delay)}}}});return j});
define("businesswidget/repository_l9_common/common/model/CommerceAnonymousProductOrderProductOrderItemModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({options:{rest:{"delete":{method:"DELETE",url:"commerce/anonymous/product-order/:productOrderId/product-order-item/:productOrderItemId"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}}},url:"commerce/anonymous/product-order/:productOrderId/product-order-item/:productOrderItemId",id:"productOrderItemId"});return e});
define("businesswidget/repository_l9_common/common/model/CustomerProductOrderProductOrderItemModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({options:{rest:{"delete":{method:"DELETE",url:"commerce/customer/:customerId/order/:productOrderId/order-action/:productOrderItemId"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}}},url:"commerce/customer/:customerId/order/:productOrderId/order-action/:productOrderItemId",id:"productOrderItemId"});return e});
define("businesswidget/repository_l9_common/common/model/GenerateAndDisplayContractModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/ordering/order/:orderId/billing-arrangement/:barId/contract",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/CheckExistingDashAccountModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/sdp/manage-customer-payments/check-exist-account",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplManageCustomerPaymentsRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/GetPromoDataModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ordering/getpromos",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplPromoDisplayRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetPromoDataViewModel",["lightsaber","underscore","Configuration","businesswidget/repository_l9_common/common/model/GetPromoDataModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel"],function (a,b,c,d,e,f){return a.Core.ObservableViewModel.extend({models:{getPromoDataModel:d},subViewModels:{orderInContextTopicViewModel:e,getCustomerIdValueViewModel:f},defaults:{upcStatus:""},initialize:function(a){b.bindAll(this,"getPromoData","setDefaultQueryParams")},getPromoData:function(a,c){var d=this,e=$.Deferred(),f=d.subViewModels.getCustomerIdValueViewModel.createPromoString(a.productOffer,a.brand,a.model,a.transactionType,a.ciTier,a.customerType,a.subSegment,c,a.coupon),g=d.getModel("getPromoDataModel");d.setDefaultQueryParams(g);var h="QuoteSDAllPromo+++promoCode+++EMPTY";f&&""!==f&&(h+=f);var i={ImplPromoDisplayRequest:{activityForConfiguration:h}};return g.save(i,{success:b.bind(d.getPromoDataSuccess,d,e),error:b.bind(d.getPromoDataFailure,d,e)}),e},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getPromoDataSuccess:function(a,b,c){a.resolve(c)},getPromoDataFailure:function(a,b,c){a.resolve("failed")}})});
define("businesswidget/repository_l9_common/common/model/RecalculateBlockOrderModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/ecommerce/order/:orderId/recalculate-block-flag",rest:{defaults:{contentType:"application/json",qParams:{lo:b.get("locale"),sc:b.get("salesChannel")}},create:{method:"POST",payload:["ImplRecalculateBlockFlagRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/UpdateContactDetailsModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"customer-management/contact-person/:id",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")
}},create:{contentType:"application/json",payload:["ImplContactPerson"],method:"PUT"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel"],function (a,b,c,d,e,f,g,h){return a.Core.ObservableViewModel.extend({models:{customerUPCModel:e,anonymousUPCModel:d,customerRPCModel:g,anonymousRPCModel:h},subViewModels:{orderInContextTopicViewModel:f},defaults:{upcStatus:""},initialize:function(a){b.bindAll(this,"_updateProductConfiguration","setHeaders","setDefaultQueryParams","_retrieveProductConfiguration","getOrderItemId")},_updateProductConfiguration:function(a,c,d,e){var f=this,g=$.Deferred(),h=f.subViewModels.orderInContextTopicViewModel.get(),i=(h.currentOrderActions,""),j=h.customerID;return"undefined"!=typeof j&&null!==j&&""!==j?(i=f.getModel("customerUPCModel"),i.set({customerId:j,productOrderItemId:d})):(i=f.getModel("anonymousUPCModel"),i.set({productOrderItemId:d})),f.setHeaders(i),f.setDefaultQueryParams(i),i.setQueryParams({rp:!1,rpc:!1}),i.save(c,{success:b.bind(f.onUpdateSuccess,f,g),error:b.bind(f.onUpdateFailure,f,g)}),g},_retrieveProductConfiguration:function(a,c,d){var e=this,f=$.Deferred(),g=e.subViewModels.orderInContextTopicViewModel.get(),h=(g.customerID,g.currentOrderActions),i="";i="undefined"!=typeof c?c:{activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};var j=e.getOrderItemId(h,a,d),k="",l=g.customerID;return"undefined"!=typeof l&&null!==l&&""!==l?(k=e.getModel("customerRPCModel"),k.set({customerId:l,productOrderItemId:j})):(k=e.getModel("anonymousRPCModel"),k.set({productOrderItemId:j})),e.setHeaders(k),e.setDefaultQueryParams(k),k.setQueryParams({rp:!1,rpc:!1}),k.set("RetrieveProductInOrderConfigurationRequest",i),k.fetch({success:b.bind(e.onFetchRetrieveProductConfigurationSuccess,e,f),error:b.bind(e.onFetchProductConfigurationError,e,f)}),f},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onUpdateSuccess:function(a,b,c){a.resolve(c)},onUpdateFailure:function(a,b,c){a.reject("failed")},onFetchRetrieveProductConfigurationSuccess:function(a,b,c){a.resolve(c)},onFetchProductConfigurationError:function(a,b,c){a.reject("failed")},getOrderItemId:function(a,c,d){var e="";return a="undefined"!=typeof d?b.filter(a,function(a){return a.lob===c&&a.level===d}):b.filter(a,function(a){return a.lob===c}),a&&a.length>0&&(e=a[0].productOrderItemID),e}})});
define("businesswidget/repository_l9_common/common/model/ReserveLogisticsDispatchAppointmentModel",["lightsaber"],function (a){return a.Core.RESTModel.extend({options:{url:"/sdp/manageAppointment/contact-person/:personId/reserve-logistics-appointment",rest:{defaults:{method:"POST",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplReserveLogisticsDispatchAppointmentInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/RetrieveLogisticDispatchAvailableAppointmentsSlotsModel",["lightsaber"],function (a){return a.Core.RESTModel.extend({options:{url:"/sdp/manageAppointment/logistic-appointments-slots",rest:{defaults:{method:"POST",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplLogisticDispatchAvailableAppointmentsSlotsInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ImplFsGetRedeliveryTimeslotsModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/fs/order/getRedeliveryTimeslot",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplFsGetRedeliveryTimeslotRequest"]}}},parse:function(a){return a.ImplFsGetRedeliveryTimeslotResponse.redeliveryTimeslotList=c.map(a.ImplFsGetRedeliveryTimeslotResponse.redeliveryTimeslotList,function(a){return a.slotCode=a.code,a.slotStartDate=a.dateMilli,a.timeDescription=a.statusChangeDatetime,a}),a}});return d});
define("businesswidget/repository_l9_common/common/model/CheckFSOrderConsolidationModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/fs/order/checkOrderConsolidation",rest:{defaults:{qParams:{lo:b.get("locale"),sc:b.get("salesChannel")}},create:{method:"POST",payload:["ImplFsCheckOrderConsolidationRequest"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","Configuration","businesswidget/repository_l9_common/common/model/ReserveLogisticsDispatchAppointmentModel","businesswidget/repository_l9_common/common/model/RetrieveLogisticDispatchAvailableAppointmentsSlotsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository/common/util/Util","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","businesswidget/repository_l9_common/common/model/ImplFsGetRedeliveryTimeslotsModel","businesswidget/repository_l9_common/common/model/CheckFSOrderConsolidationModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","moment"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a.Core.ObservableViewModel.extend({models:{ReserveAppointmentModel:e,RetrieveAppointmentsSlotsModel:f,implFsGetRedeliveryTimeslotsModel:j,checkFSOrderConsolidationModel:k},subViewModels:{individualInContextTopicViewModel:g,MiniCartInContextTopic:i,getCustomerIdValueViewModel:l,implUserContextTopicViewModel:m},defaults:{slots:[],appointmentSlotsVmStatus:"",courierDetails:{msisdn:null,dealerCode:null,slotType:"",slotQuantity:null,slotCode:"",slotStartDate:null,paymentMode:""},appointmentSlots:null,reservePayload:"",orderConsolidationInput:null,orderConsolidationResult:null,orderConsolidationResponse:null},initialize:function(){b.bindAll(this,"onRetrieveAppointmentsSlots","onReserveAppointmentSlots","formatDate","fetchSlots","onRetrieveRedeliveryAppointmentsSlots","checkForOrderConsolidation","formatOrderConsolidationResponse")},checkForOrderConsolidation:function(){var a=this,b=a.get("orderConsolidationInput"),c=a.subViewModels.implUserContextTopicViewModel.get("userInfo"),d=$.Deferred();if(c&&b){var e=a.subViewModels.getCustomerIdValueViewModel.getCustomerIdTypeForFS(b.nricType),f={ImplFsCheckOrderConsolidationRequest:{customerID:b.nricId,docVerified:e,productType:b.productType,itemsInCart:b.itemsInCart,leadDays:b.leadDays}};a.getModel("checkFSOrderConsolidationModel").save(f).then(function(c){"undefined"!=typeof c.ImplFsCheckOrderConsolidationResponse&&c.ImplFsCheckOrderConsolidationResponse.implOrderInfoList?(a.formatOrderConsolidationResponse(c.ImplFsCheckOrderConsolidationResponse.implOrderInfoList,b.hasTradeIn),a.set("appointmentSlotsVmStatus","consolidationSlotsRetrieved")):a.set("appointmentSlotsVmStatus","consolidationSlotsNotFound"),d.resolve("success")},function(){a.set("appointmentSlotsVmStatus","consolidationSlotsNotFound"),d.resolve("fsFailure")})}else a.set("appointmentSlotsVmStatus","consolidationSlotsNotFound"),d.resolve("fsFailure");return d},formatOrderConsolidationResponse:function(a,c){var d=this;if(a&&a.length>0){var e=[];b.each(a,function(a){var d=[];if(a.implFsSalesItems&&a.implFsSalesItems.implFsSalesItemsForMobileList&&a.implFsSalesItems.implFsSalesItemsForMobileList.length>0){var f=b.find(a.implFsSalesItems.implFsSalesItemsForMobileList,function(a){return a&&a.equipmentModel&&a.equipmentBrand});if(f){var g=f.equipmentModel+", ";a&&a.serviceNo&&(g+=a.serviceNo),f&&f.implFsPlan&&f.implFsPlan.productOfferID&&(g=g+" ( on "+f.implFsPlan.productOfferID+" plan)"),d.push(g)}else b.find(a.implFsSalesItems.implFsSalesItemsForMobileList,function(b){var c="";return b&&b.equipmentModel&&b.equipmentBrand&&(c=c+b.equipmentModel+", "),a&&a.serviceNo&&(c+=a.serviceNo),b&&b.implFsPlan&&b.implFsPlan.productOfferID&&(c=c+" ( on "+b.implFsPlan.productOfferID+" plan)"),d.push(c),!0})}else if(a.implFsSalesItems&&a.implFsSalesItems.implFsSalesItemsForFixList&&a.implFsSalesItems.implFsSalesItemsForFixList.length>0){var f=b.find(a.implFsSalesItems.implFsSalesItemsForFixList,function(a){return a&&a.equipmentModel&&a.equipmentBrand});if(f){var g=f.equipmentModel+", ";a&&a.serviceNo&&(g+=a.serviceNo),f&&f.implFsPlan&&f.implFsPlan.productOfferID&&(g=g+" ( on "+f.implFsPlan.productOfferID+" plan)"),d.push(g)}else b.find(a.implFsSalesItems.implFsSalesItemsForFixList,function(b){var c="";return b&&b.equipmentModel&&b.equipmentBrand&&(c=c+b.equipmentModel+", "),a&&a.serviceNo&&(c+=a.serviceNo),b&&b.implFsPlan&&b.implFsPlan.productOfferID&&(c=c+" ( on "+b.implFsPlan.productOfferID+" plan)"),d.push(c),!0})}(!c||c&&"P"!==a.slotType&&"S"!==a.slotType)&&e.push({deliveryOrderNo:a.deliveryOrderNo,purchasedItems:d,deliveryDate:n(a.implFsDeliveryData.deliveryDate,"YYYY-MM-DD").format("DD/MM/YYYY"),deliveryTime:a.implFsDeliveryData.deliverySlot,deliverySlotCode:a.implFsDeliveryData.deliverySlotCode,outletCode:a.implFsDeliveryData.outletCode,slotId:a.implFsDeliveryData.timeSlotID,slotType:a.slotType,deliveryAddress:a.implFsDeliveryData.implPhysicalAddress,id:a.orderActionID})}),d.set("orderConsolidationResponse",e)}},onRetrieveRedeliveryAppointmentsSlots:function(){var a=this;a.set("appointmentSlots",null);var b=a.get("courierDetails");b.slotType;a.set("appointmentSlotsVmStatus","GetRedeliveryTimeslotsInitialized");var c={ImplFsGetRedeliveryTimeslotRequest:{salesOrderNo:b.orderActionId,dealerCode:b.dealerCode}};return this.models.implFsGetRedeliveryTimeslotsModel.save(c).then(function(c){a.formatDate(c.ImplFsGetRedeliveryTimeslotResponse.redeliveryTimeslotList,b.slotType,b.leadDays),this.set("appointmentSlotsVmStatus","GetRedeliveryTimeslotsSuccess")}.bind(this),function(){this.set("appointmentSlotsVmStatus","GetRedeliveryTimeslotsFailure")}.bind(this))},onRetrieveAppointmentsSlots:function(){var a=this;a.set("appointmentSlots",null);var b=$.Deferred(),c=a.get("courierDetails"),d=c.leadDays,e=(c.slotType,(new Date).getTime());a.getDateStringInSGP(parseInt(e),!1,10),a.getDateStringInSGP(parseInt(d),!1,10);return a.fetchSlots(c,b),b},fetchSlots:function(a,b){var c=this,d={slotType:a.slotType,paymentMode:a.paymentMode,dealerCode:a.dealerCode,documentRequired:a.documentRequired,leadDay:a.leadDays};c.set("appointmentSlotsVmStatus","slotsRetrieveInProgress"),c.getModel("RetrieveAppointmentsSlotsModel").save({ImplLogisticDispatchAvailableAppointmentsSlotsInput:d},{success:function(d,e){"undefined"!=typeof e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput&&"undefined"!=typeof e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput.slots&&e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput.slots.length>0?(c.formatDate(e.ImplLogisticDispatchAvailableAppointmentsSlotsOutput.slots,a.slotType,a.leadDays),c.set("appointmentSlotsVmStatus","slotsRetrieved"),b.resolve("SUCCESS")):(c.set("appointmentSlotsVmStatus","failure"),b.resolve("failure"))},error:function(a,d){c.set("appointmentSlotsVmStatus","failure"),b.resolve("failure")}})},formatDate:function(a,c,d){var e=this,f=e.get("appointmentSlots");null===f&&(f={enabledDays:[],dateTimeSlots:{},dateTimeSlotsObj:{}});var g=[],h=(new Date).getTime(),i=e.getDateStringInSGP(parseInt(h),!1,10);b.each(a,function(a){var d=!0;if(a.slotDate=e.getDateStringInSGP(parseInt(a.slotStartDate),!1,10),"D"===c&&i!==a.slotStartDate&&(d=!1),a.slotDate=e.getDateStringInSGP(parseInt(a.slotStartDate),!1,10),d&&(f.enabledDays.length<5||5===f.enabledDays.length&&b.contains(f.enabledDays,a.slotDate))){a.slotType=c,g.push(a);var h=b.filter(f.enabledDays,function(b){return b===a.slotDate});"undefined"!=typeof h&&0!==h.length||f.enabledDays.push(a.slotDate);var j=f.dateTimeSlots[a.slotDate],k=f.dateTimeSlotsObj[a.slotDate];"undefined"==typeof j&&(j=[],k=[]),k.push(b.extend({id:a.slotCode,value:a.timeDescription,title:a.timeDescription},a)),j.push(a.timeDescription),f.dateTimeSlots[a.slotDate]=j,f.dateTimeSlotsObj[a.slotDate]=k}});var j=b.uniq(f.enabledDays);g.enabledDays=j,e.set("slots",g),e.set("appointmentSlots",f)},onReserveAppointmentSlots:function(a,c){var d,e=this,f=$.Deferred(),g=e.get("courierDetails"),h=e.get("slots");if(d=c&&h.length>0?h[0]:b.find(h,function(a){if(a.timeDescription===g.slotCode&&a.slotDate===g.slotStartDate)return a})){var i;!a||"undefined"!=typeof i&&null!==i||"undefined"!==a&&null!==a&&a.mobile&&a.mobile.length>0&&b.each(a.mobile,function(a){a.orderDetails&&a.orderDetails.msisdn&&(i=a.orderDetails.msisdn)}),!a||"undefined"!=typeof i&&null!==i||"undefined"!==a&&null!==a&&a.bundle&&a.bundle.length>0&&b.each(a.bundle,function(a){a.subscriptionId&&(i=a.subscriptionId)}),"undefined"!=typeof i&&null!==i||(i=g.msisdn||e.subViewModels.MiniCartInContextTopic.getValueByPath("flowData.selectedNumber"));var j={action:"R",slotType:d.slotType||g.slotType,contactId:e.subViewModels.individualInContextTopicViewModel.get("personId"),msisdn:i,slotQuantity:g.slotQuantity||1,paymentMode:g.paymentMode||"CASH",dealerCode:g.dealerCode||"20002",implTimeSlot:{slotCode:d.slotCode,slotStartDate:d.slotStartDate}},k={slotCode:d.slotCode,slotStartDate:d.slotStartDate,timeDescription:d.timeDescription};this.set("reservePayload",k);var l=e.getModel("ReserveAppointmentModel");l.set("personId",e.subViewModels.individualInContextTopicViewModel.get("personId")),l.save({ImplReserveLogisticsDispatchAppointmentInput:j},{success:b.bind(e.onReserveSuccess,e,f),error:function(a){return function(b){a.reject(b)}}(f)})}else f.resolve("SUCCESS");return f},onReserveSuccess:function(a,b,c){var d=this;if("undefined"!=typeof c.ImplReserveLogisticsDispatchAppointmentOutput){var e=c.ImplReserveLogisticsDispatchAppointmentOutput.statusCode;"SUCCESS"===e?d.set("appointmentSlotsVmStatus","slotReserved"):d.set("appointmentSlotsVmStatus","slotReservationFailed"),a.resolve(e)}else d.set("appointmentSlotsVmStatus","failure"),a.reject()},getDateStringInSGP:function(a,b,c){var e=n(n(a).utcOffset("+0800").format("YYYY-MM-DD HH:mm:ss")).toDate(),f={full:0,"short":1,general:2,monthYear:3,monthNameYear:4,dayMonth:5,dayMonthName:6,"YYYY-MM":7,"YYYY/MM/DD":8,"DD/MM/YYYY":9,"YYYY-MM-DD":10,"mm:ss":11,"DD-MMM":12,"MMM-YY":13,"DD MMM YYYY":14,"MM/DD/YYYY":15},g=d.getLocale();g=g.toLowerCase();var h,i=e.getHours(),j=e.getMinutes(),k=e.getSeconds(),l=e.getFullYear(),m=""+new String(e.getFullYear()).substring(2,4),o=e.getDate(),p=e.getMonth()+1,q=this.monthName(e.getMonth()),r=this.shortMonthName(e.getMonth()),s="";switch(j<10&&(j="0"+j),k<10&&(k="0"+k),"en-us"==g?(i>12?(i=i-12+"",h=" PM"):h=i<12?" AM":" PM",p<10&&(p="0"+p),o<10&&(o="0"+o)):(p<10&&(p="0"+p),o<10&&(o="0"+o)),c){case f.full:switch(g){case"en-us":s=q+" "+o+", "+l;break;case"fr-fr":s=o+" "+q+l;break;default:s=q+" "+o+", "+l}break;case f["short"]:switch(g){case"en-us":s=p+"/"+o+"/"+m;break;case"fr-fr":s=o+"/"+p+"/"+m;break;default:s=o+"/"+p+"/"+m}break;case f.general:switch(g){case"en-us":s=p+"/"+o+"/"+l;break;case"fr-fr":s=o+"/"+p+"/"+l;break;default:s=o+"/"+p+"/"+l}break;case f["YYYY/MM/DD"]:s=l+"/"+p+"/"+o;break;case f["YYYY-MM-DD"]:s=l+"-"+p+"-"+o;break;case f["DD/MM/YYYY"]:s=p+"/"+o+"/"+l;break;case f["mm:ss"]:s=j+":"+k;break;case f.monthYear:s=p+"/"+m;break;case f.monthNameYear:s=q+" "+l;break;case f.dayMonth:switch(g){case"en-us":s=p+"/"+o;break;case"fr-fr":s=o+"/"+p;break;default:s=o+"/"+p}break;case f.dayMonthName:switch(g){case"en-us":var t=o.toString(),u=t.substr(t.length-1);"1"==u?t+="st":"2"==u?t+="nd":"3"==u?v=t+"rd":t+="th",s=q+" "+t;break;case"fr-fr":s=o+" "+q;break;default:s=o+" "+q}break;case f["YYYY-MM"]:s=l+"-"+p;break;case f["DD-MMM"]:s=o+"-"+r;break;case f["MMM-YY"]:s=r+"-"+l.toString().substring(2,4);break;case f["DD MMM YYYY"]:s=o+" "+r.toUpperCase()+" "+l+" ";break;case f["MM/DD/YYYY"]:s=p+"/"+o+"/"+l}if(b)if(c==f.full)switch(g){case"en-us":s=s+" "+i+":"+j+":"+k+h;break;case"fr-fr":s=s+" "+i+":"+j+":"+k;break;default:s=s+" "+i+":"+j+":"+k}else switch(g){case"en-us":s=s+"- "+i+":"+j+h;break;case"fr-fr":s=s+" "+i+":"+j;break;default:s=s+" "+i+":"+j}return s},monthName:function(a){switch(a){case 0:return c.getString("util_mo_Jan");case 1:return c.getString("util_mo_Feb");case 2:return c.getString("util_mo_Mar");case 3:return c.getString("util_mo_Apr");case 4:return c.getString("util_mo_May");case 5:return c.getString("util_mo_Jun");case 6:return c.getString("util_mo_Jul");case 7:return c.getString("util_mo_Aug");case 8:return c.getString("util_mo_Sep");case 9:return c.getString("util_mo_Oct");case 10:return c.getString("util_mo_Nov");case 11:return c.getString("util_mo_Dec");default:return c.getString("util_mo_Jan")}},shortMonthName:function(a){switch(a){case 0:return c.getString("util_mo_short_Jan");case 1:return c.getString("util_mo_short_Feb");case 2:return c.getString("util_mo_short_Mar");case 3:return c.getString("util_mo_short_Apr");case 4:return c.getString("util_mo_short_May");case 5:return c.getString("util_mo_short_Jun");case 6:return c.getString("util_mo_short_Jul");case 7:return c.getString("util_mo_short_Aug");case 8:return c.getString("util_mo_short_Sep");case 9:return c.getString("util_mo_short_Oct");case 10:return c.getString("util_mo_short_Nov");case 11:return c.getString("util_mo_short_Dec");default:return c.getString("util_mo_short_Jan")}}});return o});
define("businesswidget/repository_l9_common/common/model/BillMethodPreferenceModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"billing/type/:NRIC_TYPE/id/:NRIC/contact-person/:CONTACT_ID/opebinfo",rest:{read:{method:"GET",qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplBillingDataInput"],qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel",["underscore","lightsaber","Configuration","businesswidget/repository_l9_common/common/model/BillMethodPreferenceModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel"],function (a,b,c,d,e,f){var g=b.Core.ObservableViewModel.extend({subViewModels:{onePassTopicViewModel:e,individualInContextTopicViewModel:f},models:{billMethodPreferenceModel:d},defaults:{isEbillCus:!0},initialize:function(){a.bindAll(this,"getBillMethodPreference","getCustomerType","setBillMethodPreference")},getBillMethodPreference:function(){var b=this,d=this.subViewModels.onePassTopicViewModel.get()||{},e=$.Deferred();if(d.nric){var f=b.getCustomerType(d.customerIdType),g=b.getModel("billMethodPreferenceModel"),h=["O","T"];g.setQueryParams({includeBAStatus:h}),g.set({NRIC_TYPE:f,CONTACT_ID:b.subViewModels.individualInContextTopicViewModel.get("personId")}),g.fetch({NRIC:d.nric}).then(function(b){var d=c.get("e_bill").type;if(b&&b.ImplBillingAccountDetailsResponse&&b.ImplBillingAccountDetailsResponse.billingAccountDetails){var b=b.ImplBillingAccountDetailsResponse.billingAccountDetails,f=a.find(b,function(a){if(a.billType!==d&&("O"===a.baStatus||"T"===a.baStatus))return a});this.set("isEbillCus",!f)}else this.set("isEbillCus",!1);e.resolve(this.get("isEbillCus"))}.bind(this),function(a){this.set("isEbillCus",!1),e.resolve(!1)}.bind(this))}return e},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a},setBillMethodPreference:function(a){var b=this,d=b.subViewModels.onePassTopicViewModel.get()||{},e=$.Deferred();if(d.nric&&a){var f=b.getCustomerType(d.customerIdType),g=b.getModel("billMethodPreferenceModel");g.set({NRIC_TYPE:f,CONTACT_ID:b.subViewModels.individualInContextTopicViewModel.get("personId"),NRIC:d.nric});var a=c.get(a);d.newcustomer&&(a.skipNotification=!0),g.setQueryParams({skipNotification:a.skipNotification,intFlowType:a.intFlowType});var h={ImplBillingDataInput:{deliveryMethod:a.method,billType:a.type}};g.save(h).then(function(a){e.resolve()}.bind(this),function(a){e.reject()}.bind(this))}else e.resolve();return e}});return g});
define("businesswidget/repository_l9_common/common/viewmodel/business/ChargeableEmailViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c){return a.Core.ObservableViewModel.extend({subViewModels:{deviceIdAndPlanIdInContextTopic:c},initialize:function(){this._super();var a=this;b.bindAll(a,"updatePayload")},updatePayload:function(a,c,d){var e=this,f={newAssignedBillingOffers:[],removedAssignedBillingOffers:[],removedContainedProducts:[]},g=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if(g&&g.productOrderItemID===d&&g.productID)if("NA"===c)f.removedContainedProducts.push({productID:g.productID});else{var h;g.paidBOID===c&&(h=g.paidPricingID),h&&f.newAssignedBillingOffers.push({productSpecPricingID:h,parentProductID:g.productID,parentProductSpecContainmentID:g.productSpecContainmentID}),a&&a.length>0&&b.each(a,function(a){var c,d;if(b.find(g.freeBOIDs,function(b){if(b.freeBOID===a.freeBOID)return c=b.freePricingID,d=b.billingOfferID,!0}),c){var e={billingOfferID:d,productSpecPricingID:c};f.removedAssignedBillingOffers.push(e)}})}return f}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ExpressCheckoutViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/model/RecalculateBlockOrderModel","businesswidget/repository/common/model/CustomerProductOrderIdValidateProductConfigurationsModel","businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel","businesswidget/repository/common/model/CommerceCustomerProductOrderPayChannelModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","businesswidget/repository_l9_common/common/model/UpdateContactDetailsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateOrderDeliveryAddressModel","businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository_l9_common/common/model/GenerateAndDisplayContractModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ChargeableEmailViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D=a.Core.ObservableViewModel.extend({defaults:{customerId:null,productOrderItemID:null,expressCheckoutVmStatus:null,billingAccountDetails:null,selectedRecontractDetails:null,orderDetail:null,isEbillCus:!0},models:{anonymousUpdateProductConfigurationModel:i,updateProductConfigurationModel:h,updateContactModel:j,getBillingAccountDetailedListModel:m,recalculateBlockOrderModel:o,customerProductOrderIdValidateProductConfigurationsModel:p,billSpecIdPayChannelModel:q,productOrderPayChannelModel:r,updateContactDetailsModel:t,updateOrderDeliveryAddressModel:v,viewUpdateCustomerProfileModel:w,generateAndDisplayContractModel:x},subViewModels:{orderInContextTopicViewModel:d,shoppingCartViewModel:e,getCustomerIdValueViewModel:f,deviceIdAndPlanIdInContextTopic:g,implUserContextTopicViewModel:k,onePassTopicViewModel:l,clearContextInContextTopic:n,updateProductConfigurationCustomizedViewModel:s,individualInContextTopicViewModel:u,updateProductConfigurationViewModel:y,logisticsDispatchAppointmetSlotViewModel:z,billMethodPreferenceViewModel:A,chargeableEmailViewModel:B,contactContextTopicViewModel:C},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"setHeaders","setDefaultQueryParams","getSuccessMessage","getErrorMessage","updateOrderToRunRules","updateCustomerContact","updateContactSuccess","getPersonDetails","onPersonalDetailsSuccess","runConfigurationRules","runValidationConfigurationRules","onConfigurationValidationSuccess","onConfigurationValidationError","createPayloadForValidation","processFulfillmentScreen","getBillSpecIdPayChannel","updateContactDetails","getContactDetails","getContactDetailsSuccess","updateOrderDeliveryAddress","searchAttachment","updateDeliverDetails","createPayload"),this.set("expressCheckoutVmStatus","vmInitialized")},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getSuccessMessage:function(a,b,d){var e=this;if("undefined"==typeof a||null===a){a=e.subViewModels.orderInContextTopicViewModel.get("orderActions");var f=e.get("selectedRecontractDetails");f&&f.chargeableEmail&&e.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",f.chargeableEmail)}var g;if(b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0,"BB"===a.lob&&(g="Change"===a.orderType?"recon":"new"))}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus)return e.set("expressCheckoutVmStatus","failure"),!1;if("BB"===d.productConfiguration.lineOfBusiness){var h=d.productConfiguration.displayableItems,i={};i.customerType="public",i.productOrderItemId=b,i.transactionType=g;var j=d.productConfiguration.rootProductOfferingID;i.productOffer=j,i.customerType=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");var k=[];k=e.subViewModels.getCustomerIdValueViewModel.getSelectedAddonIDs(h,k),i.selectedAddonIds=k,e.set("orderDetail",i)}}a&&a.length>0?e.updateOrderToRunRules(a):e.updateCustomerContact()},getErrorMessage:function(){return this.set("expressCheckoutVmStatus","failure"),!0},updateOrderToRunRules:function(a){var b,d,e,f,g,h=this,i=[],j=[],k=[],l=[],m=[],n={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"SD Add Comp Stage",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},o=h.subViewModels.orderInContextTopicViewModel.get(),p=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});p&&p.length>0&&(b=p[0].productOrderItemID,e=p[0].productID,f=p[0].flowType,i.push({productID:e}),g=p[0].lob,d=p[0].orderType);var q=h.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if(q&&q.productOrderItemID===b&&"BB"===g&&"Change"===d&&q.productID){var r=h.subViewModels.chargeableEmailViewModel.updatePayload(q.freeBOIDs,q.selectedBoID,b);l=l.concat(r.newAssignedBillingOffers),m=m.concat(r.removedAssignedBillingOffers),k=k.concat(r.removedContainedProducts)}i.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=i),k.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].removedContainedProducts=k),j.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].newContainedProducts=j,n.UpdateProductInOrderConfigurationRequest.addDefaultChildItemsImplicitly=!0),m.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].removedAssignedBillingOffers=m),
l.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].newAssignedBillingOffers=l);var s=o.customerID;if(s){var t=h.getModel("updateProductConfigurationModel");t.set({customerId:s,productOrderItemId:b}),h.setHeaders(t),h.setDefaultQueryParams(t),t.setQueryParams({rp:!1,rpc:!1}),t.save(n,{success:function(c,d){h.getSuccessMessage(a,b,d.UpdateProductInOrderConfigurationResponse)},error:h.getErrorMessage})}else{var u=h.getModel("anonymousUpdateProductConfigurationModel");u.set({productOrderItemId:b}),h.setHeaders(u),h.setDefaultQueryParams(u),u.setQueryParams({rp:!1,rpc:!1}),u.save(n,{success:function(c,d){h.getSuccessMessage(a,b,d.UpdateProductInOrderConfigurationResponse)},error:h.getErrorMessage})}},updateCustomerContact:function(){var a=this,b=a.getModel("updateContactModel");a.subViewModels.implUserContextTopicViewModel.get("userInfo");b.setQueryParams({isAnonymous:!1});var d=a.subViewModels.orderInContextTopicViewModel.get();b.set({customerId:d.customerID,orderId:d.productOrderReferenceNumber});var e=d.orderActions,f=d.updatedOrderActions;e=c.filter(e,function(a){return!c.contains(f,a.productOrderItemID)});var g=[],h=[];if(c.each(e,function(b){g.push({orderActionId:b.productOrderItemID,contactId:a.subViewModels.individualInContextTopicViewModel.get("ID")||a.subViewModels.contactContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),h.push(b.productOrderItemID)}),g.length>0){var i={ImplAddCustomerContactRestInput:{orderAction:g}};b.save(i,{success:c.bind(a.updateContactSuccess,a,h),error:c.bind(a.getErrorMessage,a,h)})}},updateContactSuccess:function(a){var b=this,d=b.subViewModels.orderInContextTopicViewModel.get("updatedOrderActions")||[];c.each(a,function(a){d.push(a)}),b.subViewModels.orderInContextTopicViewModel.set("updatedOrderActions",d),b.set("expressCheckoutVmStatus","validating");var e=b.subViewModels.onePassTopicViewModel.get("nric"),f=b.subViewModels.deviceIdAndPlanIdInContextTopic.get(),g=f.customerType;if("staff"===g){var h=f.staffDetails;if(h&&h.custId&&h.custId!==e)return b.set("checkoutStatus","inValidUser"),!1}b.getPersonDetails(e)},getPersonDetails:function(a){var b=this;if(a){var d=b.getModel("getBillingAccountDetailedListModel"),e=b.subViewModels.getCustomerIdValueViewModel.getCustomerType(b.subViewModels.onePassTopicViewModel.get("customerIdType"));d.set("type",e),d.fetch({id:a,success:c.bind(b.onPersonalDetailsSuccess,b),error:c.bind(b.getErrorMessage,b)})}},onPersonalDetailsSuccess:function(a,b){var d,e=this;if(b&&b.ImplBillingAccountDetailsResponse&&b.ImplBillingAccountDetailsResponse.billingAccountDetails){var f=b.ImplBillingAccountDetailsResponse.billingAccountDetails;d=c.find(f,function(a){return a.paInd}),e.set("billingAccountDetails",b.ImplBillingAccountDetailsResponse.billingAccountDetails)}d?(e.set("expressCheckoutVmStatus","ipaUser"),e.subViewModels.clearContextInContextTopic.clearAllTopics(!0)):e.runConfigurationRules()},runConfigurationRules:function(){var a,b=this,d=b.getModel("recalculateBlockOrderModel"),e=b.subViewModels.orderInContextTopicViewModel.get("orderActions"),f=!1;e&&e.length>0&&(a=c.find(e,function(a){return"Provide"===a.orderType&&("BB"===a.lob||"TV"===a.lob)})),a&&(f=!0);var g=b.subViewModels.orderInContextTopicViewModel.get("productOrderID");d.set("orderId",g);var h={ImplRecalculateBlockFlagRequest:{orderId:g,isBlockOrder:f}};d.save(h,{success:c.bind(b.runValidationConfigurationRules,b),error:c.bind(b.getErrorMessage,b)})},runValidationConfigurationRules:function(){var b,d=this,e=this.getModel("customerProductOrderIdValidateProductConfigurationsModel"),f=[];e.setQueryParams({sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")});var g=d.subViewModels.orderInContextTopicViewModel.get();e.set({customerId:g.customerID,productOrderId:g.productOrderID});var h=g.orderActions;c.each(h,function(a){var b;b={productOrderItemID:a.productOrderItemID,productID:a.productID},f.push(b)},this),b=this.createPayloadForValidation(f),f&&f.length>0?(e.set("ValidateMultiProductsConfigurationRequest",b),e.fetch({success:c.bind(this.onConfigurationValidationSuccess,this),error:c.bind(this.onConfigurationValidationError,this)})):this.handleValidationSuccess({})},onConfigurationValidationSuccess:function(a,b){var d={},e=[],f=!1;if("undefined"!=typeof b.ValidateMultiProductConfigurationsResponse){var g=b.ValidateMultiProductConfigurationsResponse.productConfigurations;c.each(g,function(a){var a=a.productConfiguration;"BLOCKING"===a.compatibilityStatus&&(f||(f=!0)),a.messages&&a.messages.length>0&&c.each(a.messages,function(a){e.push({text:a.text,severity:a.severity})},this)},this),d={isSeverityBlocking:f,validationMessages:e},this.handleValidationSuccess(d)}else this.onConfigurationValidationError()},onConfigurationValidationError:function(){this.set("expressCheckoutVmStatus","failure"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0)},createPayloadForValidation:function(a){var b=this,c=b.get("orderDetail"),d="SDRulesForCheckout+++promoCode+++EMPTY",e=b.subViewModels.getCustomerIdValueViewModel.createPromoString(c.productOffer,c.brand,c.model,c.transactionType,c.ciTier,c.customerType,c.subSegment,c.selectedAddonIds);return e&&""!==e&&(d+=e),{activityForConfiguration:d,returnRemovedItems:!1,settingsView:"FULL",productOrderItems:a,retrieveComponentPricing:!1,retrieveSchemaPricing:!1,performSave:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}}},handleValidationSuccess:function(a){var b=this;b.set("validationMessages",""),null!==a&&a.isSeverityBlocking?(b.set("expressCheckoutVmStatus","failure"),b.set("validationMessages",a.validationMessages),b.subViewModels.clearContextInContextTopic.clearAllTopics(!0)):b.processFulfillmentScreen()},processFulfillmentScreen:function(){var a=this,b=a.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);b.done(function(b){if("SUCCESS"===b){var d=a.get("billingAccountDetails"),e={order:a.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order")};e.order.bundle&&e.order.bundle.length>0&&d&&d.length>0&&c.find(d,function(b){if(b&&b.subscribers){var d=c.find(b.subscribers,function(d){var f=c.find(e.order.bundle,function(c){if(c.subscriptionId===d.subscriberResourceVal||c.landlineNumber&&c.landlineNumber.details==="+65 "+d.subscriberResourceVal)return a.subViewModels.orderInContextTopicViewModel.set("barId",b.billingAccountNumber),!0});if(f)return!0});if(d)return!0}});var f=a.get("selectedRecontractDetails");a.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutOrderID",a.subViewModels.orderInContextTopicViewModel.get("productOrderID")),f&&a.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutServiceID",f.id);var g=a.subViewModels.billMethodPreferenceViewModel.getBillMethodPreference();g.then(function(b){a.subViewModels.deviceIdAndPlanIdInContextTopic.set("skipOF",!0),a.set("isEbillCus",b),a.set("expressCheckoutVmStatus","checkoutCompleted")}.bind(a))}}),b.fail(function(b){a.onConfigurationValidationError()}.bind(a))},getBillSpecIdPayChannel:function(){var a=this,b=$.Deferred(),c=a.subViewModels.orderInContextTopicViewModel.get("barId");if(void 0!==typeof c||null!==c){var d=this.getModel("billSpecIdPayChannelModel");d.set("customerBillSpecId",c),d.fetch({success:function(c,d){a.updateProductOrderPayChannel(d,b)},error:function(){a.set("expressCheckoutVmStatus","failure"),b.reject("failure")}})}else a.set("expressCheckoutVmStatus","failure"),b.reject("failure");return b},updateProductOrderPayChannel:function(a,b){var d=this;if(void 0!==typeof a&&null!==a){var e=d.subViewModels.orderInContextTopicViewModel.get("orderActions"),f=[];c.each(e,function(b){f.push({paymentCatergory:"POST",pcnId:a,productOrderItemId:b.productOrderItemID})});var g={PayChannelProductOrderDetails:{productOrderDetails:f}},h=d.getModel("productOrderPayChannelModel");h.save(g,{productOrderId:d.subViewModels.orderInContextTopicViewModel.get("productOrderID"),customerId:d.subViewModels.orderInContextTopicViewModel.get("customerID"),success:c.bind(d.getContactDetails,d,e,b),error:function(){d.set("expressCheckoutVmStatus","failure"),b.reject("failure")}})}else d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("expressCheckoutVmStatus","failure")},getContactDetails:function(a,b){var d=this,e=d.subViewModels.individualInContextTopicViewModel.get("ID")||d.subViewModels.contactContextTopicViewModel.get("personId");if("undefined"!=typeof e&&null!==e){var f=d.getModel("viewUpdateCustomerProfileModel");f.set("id",e),f.fetch({success:c.bind(d.getContactDetailsSuccess,d,a,b),error:function(){d.set("expressCheckoutVmStatus","failure"),b.reject("failure")}})}},getContactDetailsSuccess:function(a,b,d,e){var f=this,g={},h=e.ImplContactPersonOutput.implContactPerson;g.emailId=h.emailId,g.contactNumber=h.phone;var i=c.find(a,function(a){return a.isFreeMBB}),j=f.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);j.done(function(c){if("SUCCESS"===c)if(i){var d={order:f.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order")},e=f.subViewModels.shoppingCartViewModel.get("selectedDevices");d.order.selectedDevices=e;var h=f.subViewModels.shoppingCartViewModel.get("selectedFreebies");d.order.selectedFreebies=h;var j=f.subViewModels.shoppingCartViewModel.get("selectedAccessories");d.order.selectedAccessories=j;var k=f.subViewModels.logisticsDispatchAppointmetSlotViewModel,l={slotType:"N",paymentMode:"CASH",dealerCode:"D2519",leadDays:1,documentRequired:!1};k.set("courierDetails",l);var m=k.onRetrieveAppointmentsSlots();m.done(function(c){if("SUCCESS"===c){var e=k.onReserveAppointmentSlots(d.order,!0);e.done(function(c){"SUCCESS"===c&&f.updateOrderDeliveryAddress(a,b,g)}.bind(f)),e.fail(function(a){f.set("expressCheckoutVmStatus","failure"),b.reject("failure")}.bind(f))}else f.set("expressCheckoutVmStatus","failure"),b.reject("failure")}.bind(f))}else f.updateOrderDeliveryAddress(a,b,g)}.bind(f)),j.fail(function(a){f.set("expressCheckoutVmStatus","failure"),b.reject("failure")}.bind(f))},updateOrderDeliveryAddress:function(a,b,d){var e,f,g,h,i=this,j=i.subViewModels.implUserContextTopicViewModel.get("userInfo"),k=c.find(a,function(a){return a.isFreeMBB});k?(e="Courier To Home (Snail Mail)",h="sms-mail",f=i.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("reservePayload"),g=i.subViewModels.deviceIdAndPlanIdInContextTopic.get("installationAddressID")):e="Not Applicable";var l=[];i.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedOption",h);var m={ImplUpdateOrderDeliveryAddressRestInput:{deliveryMethod:e,transactionType:"NEW_SIGN_UP",addressId:g,recipientDocumentType:i.subViewModels.onePassTopicViewModel.get("customerIdType"),recipientDocumentId:i.subViewModels.onePassTopicViewModel.get("nric"),recipientFirstName:j.contactDetails.firstName,recipientLastName:j.contactDetails.lastName,recipientPhone:d.contactNumber,recipientEmail:d.emailId,shippingInstructions:"shippingInstructions",newSIMList:l,documentRequired:!1,isSnailMail:!1}};k&&void 0!==f&&""!==f&&(m.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:f.slotStartDate,slotEndDate:f.slotStartDate,slotCode:f.slotCode,timeDescription:f.timeDescription},f.slotId&&f.outletCode&&(m.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.slotId=f.slotId,m.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.popStationCode=f.outletCode),m.ImplUpdateOrderDeliveryAddressRestInput.isSnailMail=!0);var n=i.getModel("updateOrderDeliveryAddressModel");n.setQueryParams({isExpressCheckout:!0}),n.save(m,{customerId:i.subViewModels.orderInContextTopicViewModel.get("customerID"),orderId:i.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),success:c.bind(i.updateOrderSummaryRules,i,a,b),error:function(){i.set("expressCheckoutVmStatus","failure"),b.reject("failure")}})},updateOrderSummaryRules:function(a,b){var d=this,e=[],a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),f="Not Applicable",g=d.subViewModels.shoppingCartViewModel.get("cartPurchaseDetails");g&&(g.hasPurchasedRG||g.hasSharedEquipment||g.hasPurchasedWifi)&&(f="Self-Collect (w/o appt)",d.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedOption",f)),a&&a.length>0&&c.each(a,function(a){var b=[];f&&"WS"!==a.lob&&"S"===a.level?b.push({productID:a.productID,changedCharacteristics:[{characteristicID:8710102,value:f}]}):b.push({productID:a.productID});var c={productOrderItemId:a.productOrderItemID,returnFullUpcResponse:!1,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:b,newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}};e.push(c)});var h=d.subViewModels.updateProductConfigurationCustomizedViewModel,i=h._updateProductConfigurationCustomized(e,!0,"QuoteSDOrderSummary+++promoCode+++EMPTY");i.done(function(a,e){if("updateSuccess"===a){var f=e.ImplUpdateOrderProductsResponse,g=!1;if(f&&f.implUpdateOrderProductList){var h=f.implUpdateOrderProductList;h&&h.length>0&&c.each(h,function(a){if(!a.isSuccess){var b=a.ruleExecutionMessages;c.find(b,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return g=!0,!0}})}})}if(g)return d.set("expressCheckoutVmStatus","failure"),b.reject("failure"),!1;d.set("expressCheckoutVmStatus","success"),d.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutRulesCompleted",!0),b.resolve("updateSuccess")}}.bind(d)),i.fail(function(a){d.set("expressCheckoutVmStatus","failure"),b.reject("failure")}.bind(d))},createPayload:function(a,b){var c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=[];b.emailId&&d.push({productID:a.productID,changedCharacteristics:[{characteristicID:a.characteristicID,value:b.emailId}]});var k={removedContainedProducts:c,changedContainedProducts:d,suspendedContainedProducts:[],changedSimpleProducts:j,newAssignedBillingOffers:f,newContainedProducts:e,newSimpleProducts:g,removedSimpleProducts:h,removedAssignedBillingOffers:i,resumedContainedProducts:[]},l={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:"QuoteSDOrderSummary",confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[k],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return l},updateContactDetails:function(){var a=this;a.set("expressCheckoutVmStatus","contactDetailsUpdateStarted");var b=a.get("newContactDetails"),d={ImplContactPerson:{}};b.phone&&(d.ImplContactPerson.phone=b.phone),b.emailId&&(d.ImplContactPerson.emailId=b.emailId);var e=a.getModel("updateContactDetailsModel");e.save(d,{id:a.subViewModels.individualInContextTopicViewModel.get("ID")||a.subViewModels.contactContextTopicViewModel.get("personId"),success:function(d,e){var f=b.gamerVasChanges;if(f&&f.productOrderItemID&&b.emailId){var g=a.createPayload(f,b),h=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("BB",g,f.productOrderItemID);h.done(function(b){if("undefined"!=typeof b.UpdateProductInOrderConfigurationResponse){var d=b.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===d.compatibilityStatus){var e=[];c.each(d.messages,function(a){"ERROR"===a.severity&&e.push(a.text)}),a.set("expressCheckoutVmStatus","contactDetailsFailed")}else a.searchAttachment()}else a.set("expressCheckoutVmStatus","contactDetailsFailed")}.bind(a)),h.fail(function(b){a.set("expressCheckoutVmStatus","contactDetailsFailed")}.bind(a))}else a.searchAttachment()},error:function(b,c){a.set("expressCheckoutVmStatus","contactDetailsFailed")}})},updateDeliverDetails:function(a){var b=this,c=(b.subViewModels.orderInContextTopicViewModel.get("orderActions"),b.subViewModels.implUserContextTopicViewModel.get("userInfo")),d="Not Applicable",e=[],f={ImplUpdateOrderDeliveryAddressRestInput:{deliveryMethod:d,transactionType:"NEW_SIGN_UP",addressId:b.get("addressId"),recipientDocumentType:b.subViewModels.onePassTopicViewModel.get("customerIdType"),recipientDocumentId:b.subViewModels.onePassTopicViewModel.get("nric"),recipientFirstName:c.contactDetails.firstName,recipientLastName:c.contactDetails.lastName,recipientPhone:a.phone,recipientEmail:a.emailId,shippingInstructions:"shippingInstructions",newSIMList:e,documentRequired:!1,isSnailMail:!1}},g=b.getModel("updateOrderDeliveryAddressModel");g.setQueryParams({isExpressCheckout:!0}),g.save(f,{customerId:b.subViewModels.orderInContextTopicViewModel.get("customerID"),orderId:b.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),success:function(){b.searchAttachment()},error:function(){b.set("expressCheckoutVmStatus","contactDetailsFailed")}})},searchAttachment:function(){var a=this,b=a.getModel("generateAndDisplayContractModel"),d=a.subViewModels.orderInContextTopicViewModel;b.set("orderId",d.get("productOrderID")),b.set("barId",d.get("barId")),b.fetch({success:function(b,e){if(e.ImplGenerateAndDisplayContractRestOutput){var f=e.ImplGenerateAndDisplayContractRestOutput;if(f.contractList&&f.contractList.length>0){var g=[];c.each(f.contractList,function(a){g.push({documentID:a.documentId})})}d.set("contractList",g),a.set("expressCheckoutVmStatus","contactDetailsUpdated")}else a.set("expressCheckoutVmStatus","contactDetailsFailed")},error:function(b,c){a.set("expressCheckoutVmStatus","contactDetailsFailed")}})}});return D});
define("businesswidget/repository_l9_common/common/viewmodel/business/ExistingOrderSummaryWidgetViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/CommerceAnonymousProductOrderProductOrderItemModel","businesswidget/repository_l9_common/common/model/CustomerProductOrderProductOrderItemModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository/widgetsLibrary/existingOrderSummaryWidget/common/ExistingOrderSummaryWidgetMetadataEngine","businesswidget/repository/widgetsLibrary/existingOrderSummaryWidget/common/ExistingOrderSummaryWidgetTemplateConfig","businesswidget/repository/common/model/CommerceAnonymousProductOrderQuoteModel","businesswidget/repository/common/util/Util","single!businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","single!businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateBillingAddressModel","businesswidget/repository_l9_common/common/model/GenerateAndDisplayContractModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/model/CheckExistingDashAccountModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetPromoDataViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ExpressCheckoutViewModel","businesswidget/repository_l9_common/common/model/viewServiceListModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){var B=a.Core.ObservableViewModel.extend({dataBindings:[{customerId:"subViewModels.productOrderTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{locale:"subViewModels.applicationInContextTopicViewModel.locale",options:{twoWay:!1,setOnBind:!0}},{saleschannel:"subViewModels.applicationInContextTopicViewModel.salesChannel",options:{twoWay:!1,setOnBind:!0}},{productOrderReferenceNumber:"subViewModels.productOrderTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}},{implProductOrderId:"subViewModels.productOrderTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{methodType:"subViewModels.productOrderTopicViewModel.methodType",options:{twoWay:!0,setOnBind:!0}},{nric:"subViewModels.OnePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}}],defaults:{orderData:null,methodType:null,orderStatus:"",currentAccountId:null,contractGen:"",selectedDevices:null,selectedDevicesSku:null,orderSummaryVMStatus:null,couponCode:null,plansData:[],broadbandInstallationIds:[]},initialize:function(){this._super(),c.bindAll(this,"getPersonDetails","setBillingAndDeliveryAddress","activateLoadData","searchAttachment","setFreebiesInOrder","formatAddress","checkForDashAccount","removePromoCode","applyPromoCode","updatePromoCode","populateSummaryData","populateSourcePlans"),this.models.CommerceAnonymousProductOrderProductOrderItemModel=this.create("CommerceAnonymousProductOrderProductOrderItemModel",d),this.models.CustomerProductOrderProductOrderItemModel=this.create("CustomerProductOrderProductOrderItemModel",e),this.models.CommerceAnonymousProductOrderQuoteModel=this.create("CommerceAnonymousProductOrderQuoteModel",l),this.models.ViewUpdateCustomerProfileModel=f,this.models.UpdateBillingAddressModel=this.create("UpdateBillingAddressModel",r),this.models.GenerateAndDisplayContractModel=this.create("GenerateAndDisplayContractModel",s),this.models.CheckExistingDashAccountModel=this.create("CheckExistingDashAccountModel",u),this.models.viewServiceListModel=this.create("viewServiceListModel",A),this.set("itemIdToRemove",null),this.subViewModels.productOrderTopicViewModel=i,this.subViewModels.individualInContextTopicViewModel=h,this.subViewModels.OnePassTopicViewModel=o,this.subViewModels.GetBillingAccountDetailedListViewModel=n,this.subViewModels.ShoppingCartViewModel=p,this.subViewModels.applicationInContextTopicViewModel=q,this.subViewModels.clearContextInContextTopic=t,this.subViewModels.deviceIdAndPlanIdInContextTopic=v,this.subViewModels.pickAndGoViewModel=this.create("PickAndGoViewModel",w),this.subViewModels.getPromoDataViewModel=this.create("GetPromoDataViewModel",x),this.subViewModels.updateProductConfigurationCustomizedViewModel=this.create("UpdateProductConfigurationCustomizedViewModel",y),this.subViewModels.expressCheckoutViewModel=this.create("ExpressCheckoutViewModel",z),this.on("change:productOrderReferenceNumber",this.activateLoadData),this.set("implProductOrderId",this.subViewModels.productOrderTopicViewModel.get("productOrderID")),this.set("customerId",this.subViewModels.productOrderTopicViewModel.get("customerID")),this.set("productOrderReferenceNumber",this.subViewModels.productOrderTopicViewModel.get("productOrderReferenceNumber")),this.on("change:contactId",this.getPersonDetails);var a=this;setTimeout(function(){a.set("orderSummaryVMStatus","vmInitialized")},0)},updatePromoCode:function(a,b){var d=this,e=d.subViewModels.pickAndGoViewModel.updateCode(a,!0);e.done(function(a){if("pickAndGoUpdated"===a){var e=d.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);e.done(function(a){if("SUCCESS"===a){var e=d.subViewModels.updateProductConfigurationCustomizedViewModel,f=[],g=d.subViewModels.productOrderTopicViewModel.get("orderActions");c.each(g,function(a){var b=[],c={productOrderItemId:a.productOrderItemID,returnFullUpcResponse:!1,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:b,newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}};f.push(c)});var h=e._updateProductConfigurationCustomized(f,!0,"QuoteSDOrderSummary+++promoCode+++EMPTY");h.done(function(a,e){if("updateSuccess"===a){var f=d.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);f.done(function(a){if("SUCCESS"===a){var f=!1;if(b&&(f=d.subViewModels.ShoppingCartViewModel.get("invalidPromo")),f)d.set("orderSummaryVMStatus","InvalidPromoCode");else{var g=e.ImplUpdateOrderProductsResponse,h=!1;if(g&&g.implUpdateOrderProductList){var i=g.implUpdateOrderProductList;i&&i.length>0&&c.each(i,function(a){if(!a.isSuccess){var b=a.ruleExecutionMessages;c.find(b,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return h=!0,!0}})}})}h?b?d.set("orderSummaryVMStatus","applyCodeFailed"):d.set("orderSummaryVMStatus","removeCodeFailed"):b?d.set("orderSummaryVMStatus","applyCodeDone"):d.set("orderSummaryVMStatus","removeCodeDone")}}}.bind(d)),f.fail(function(a){d.set("orderData",d.subViewModels.productOrderTopicViewModel.get("productOrderID")),a&&0!==a.status&&d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b?d.set("orderSummaryVMStatus","applyCodeFailed"):d.set("orderSummaryVMStatus","removeCodeFailed")}.bind(d))}}.bind(d)),h.fail(function(a){b?d.set("orderSummaryVMStatus","applyCodeFailed"):d.set("orderSummaryVMStatus","removeCodeFailed")}.bind(d))}}.bind(d)),e.fail(function(a){d.set("orderData",d.subViewModels.productOrderTopicViewModel.get("productOrderID")),a&&0!==a.status&&d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b?d.set("orderSummaryVMStatus","applyCodeFailed"):d.set("orderSummaryVMStatus","removeCodeFailed")}.bind(d))}else"pickAndGoFailed"===a&&(b?d.set("orderSummaryVMStatus","applyCodeFailed"):d.set("orderSummaryVMStatus","removeCodeFailed"))})},removePromoCode:function(){var a=this;a.set("orderSummaryVMStatus","startRemovalofCode");var b={code:"EMPTY"};a.updatePromoCode(b,!1)},applyPromoCode:function(){var a=this,b=a.get("couponCode");b||(b="NA"),b=b.toUpperCase(),a.set("orderSummaryVMStatus","startApplyofCode");var d={coupon:b},e=a.subViewModels.getPromoDataViewModel.getPromoData(d,null);e.done(function(d){if(d.ImplPromoDisplayResponse&&d.ImplPromoDisplayResponse.implPromoDisplayItemList&&d.ImplPromoDisplayResponse.implPromoDisplayItemList.length>0){var e=d.ImplPromoDisplayResponse.implPromoDisplayItemList,f=c.find(e,function(a){return a.promoId===b&&(a.promoDescription&&a.promoDescription.length>0||a.isValid)});if(f){var g={code:b};a.updatePromoCode(g,!0)}else a.set("orderSummaryVMStatus","InvalidPromoCode")}else a.set("orderSummaryVMStatus","InvalidPromoCode")}.bind(a))},activateLoadData:function(a){var b=this;if(void 0!=b.get("productOrderReferenceNumber")&&""!=b.get("productOrderReferenceNumber")){var d=b.subViewModels.productOrderTopicViewModel.get("orderActions"),e=[];c.each(d,function(a){e.push(a.lob)}),b.set("lobs",e);var f=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),g=b.subViewModels.productOrderTopicViewModel.get("productOrderID"),h=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutRulesCompleted");if(f&&f===g&&!h){var i=b.subViewModels.expressCheckoutViewModel.getBillSpecIdPayChannel();i.done(function(a){"updateSuccess"===a&&b.populateSourcePlans()}.bind(b)),i.fail(function(a){b.set("orderData",b.subViewModels.productOrderTopicViewModel.get("productOrderID")),b.set("orderStatus","restFailed"),b.subViewModels.clearContextInContextTopic.clearAllTopics(!0)}.bind(b))}else b.populateSourcePlans()}},populateSourcePlans:function(){var a=this,b=a.subViewModels.productOrderTopicViewModel.get("orderActions"),d=c.find(b,function(a){if("Change"===a.orderType&&"WS"===a.lob&&!a.isFreeMBB)return!0});if(d)a.getModel("viewServiceListModel").fetch({customerId:a.get("customerId"),success:function(d,e){if(e.Products&&e.Products.products){var f=e.Products.products,g=a.get("plansData");c.each(b,function(a){if("WS"===a.lob&&!a.isFreeMBB){var b=c.find(f,function(b){if(a.productID===b.id)return g.push({sourcePlan:b.offeringId,productID:a.productID}),!0});"undefined"!=typeof b&&null!==b||g.push({sourcePlan:"NA",productID:a.productID})}}),a.set("plansData",g),a.populateSummaryData()}else{var h=c.filter(b,function(a){if("Provide"===a.orderType&&"WS"===a.lob&&!a.isFreeMBB)return!0});if(h&&h.length>0){var g=a.get("plansData");c.each(h,function(a){g.push({sourcePlan:"NA",productID:a.productID})}),a.set("plansData",g)}a.populateSummaryData()}},error:function(d,e){var f=c.filter(b,function(a){if("Provide"===a.orderType&&"WS"===a.lob&&!a.isFreeMBB)return!0});if(f&&f.length>0){var g=a.get("plansData");c.each(f,function(a){g.push({sourcePlan:"NA",productID:a.productID})}),a.set("plansData",g)}a.populateSummaryData()}});else{var e=c.filter(b,function(a){if("Provide"===a.orderType&&"WS"===a.lob&&!a.isFreeMBB)return!0});if(e&&e.length>0){var f=a.get("plansData");c.each(e,function(a){f.push({sourcePlan:"NA",productID:a.productID})}),a.set("plansData",f)}a.populateSummaryData()}},populateSummaryData:function(){var a=this,b=a.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!0);b.done(function(b){if("SUCCESS"===b){var d=a.get("orderData")||{},e=a.subViewModels.productOrderTopicViewModel.get("orderActions"),f=this.subViewModels.ShoppingCartViewModel.get("address"),g=a.setBillingAndDeliveryAddress(f,d),h=a.subViewModels.ShoppingCartViewModel.get("orderData"),i=a.subViewModels.ShoppingCartViewModel.get("gamerVasChanges"),j=a.subViewModels.ShoppingCartViewModel.get("premiumAddonDetails"),k=a.get("plansData");c.each(e,function(a){"WS"!==a.lob||a.isFreeMBB||c.find(k,function(b){if(b.productID===a.productID)return"WS"===a.lob&&h.order.mobile&&c.find(h.order.mobile,function(a){if(a.productID===b.productID){var c=a.planDetails;if(c&&c.length>0)return b.targetPlan=c[0].planId,!0}}),!0})}),d.premiumAddonDetails=j,d.plansData=k,d.gamerVasChanges=i,d.billingAddress=g.billingAddress,d.deliveryDetails=g.deliveryDetails,f.deliveryStartDateAndTime&&("undefined"!=typeof d.deliveryDetails&&null!==d.deliveryDetails||(d.deliveryDetails={}),d.deliveryDetails.deliveryDate=f.deliveryStartDateAndTime),f.deliveryTimeSlot&&("undefined"!=typeof d.deliveryDetails&&null!==d.deliveryDetails||(d.deliveryDetails={}),d.deliveryDetails.deliveryTime=f.deliveryTimeSlot);var l=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");if("collect-now"===l&&("undefined"!=typeof d.deliveryDetails&&null!==d.deliveryDetails||(d.deliveryDetails={}),d.deliveryDetails.deliveryDate=Date.now(),d.deliveryDetails.deliveryTime="00:00 AM - 11:59 PM"),d.installationRequired=!1,f.isBlockOrder&&(d.isBlockOrder=f.isBlockOrder),(f.isAmbassadorOrder||f.isUpgradePromoOrder)&&(d.isAmbassadorOrder=f.isAmbassadorOrder||f.isUpgradePromoOrder),c.each(e,function(a){"Change"===a.orderType?"TV"!==a.lob&&"BB"!==a.lob||d.installationRequired||(d.installationRequired=!1):"TV"===a.lob||"BB"===a.lob?d.installationRequired=!0:"undefined"!=typeof a.lob&&null!==a.lob||(d.installationRequired=!0)}),d.order=h.order,!d.installationRequired&&d.order.bundle){var m=a.get("broadbandInstallationIds")||[],n=c.find(m,function(a){var b=a.split("_"),e=c.find(d.order.bundle,function(a){
if(b&&a&&a.broadBandPlanDetails&&a.broadBandPlanDetails.serviceId&&c.contains(b,a.broadBandPlanDetails.serviceId))return!0});if(e)return!0});n&&(d.installationRequired=!0)}var o=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),p=a.subViewModels.productOrderTopicViewModel.get("productOrderID");d.installationRequired&&o!==p&&(g.installationDetails&&(d.installationDetails=g.installationDetails),f.installationDate&&(d.installationDetails.installationDate=f.installationDate),f.netlinkInstallationDate&&(d.installationDetails.netlinkInstallationDate=f.netlinkInstallationDate),f.installationTime&&(d.installationDetails.installationTime=f.installationTime),f.netlinkInstallationTime&&(d.installationDetails.netlinkInstallationTime=f.netlinkInstallationTime)),d.needsOnlyMBBDelivery=a.subViewModels.ShoppingCartViewModel.get("needsOnlyMBBDelivery"),!d.installationRequired&&a.subViewModels.ShoppingCartViewModel.getValueByPath("cartPurchaseDetails.hasPurchasedRG")?d.needsOnlyMBBDelivery=!1:a.subViewModels.ShoppingCartViewModel.get("hasFreeMBB")&&d.order.mobile&&1===d.order.mobile.length&&(d.needsOnlyMBBDelivery=!0);var q=a.subViewModels.ShoppingCartViewModel.get("minTenure"),r=a.subViewModels.ShoppingCartViewModel.get("deposite"),s=a.subViewModels.ShoppingCartViewModel.get("allBillingOffers");d=a.dataToFilterPaymentMethod(d,q,r,s),e&&e.length>0&&a.setFreebiesInOrder(d.order.mobile,e),d.pgInfo=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo"),d.couponInfo=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("couponDetails"),a.set("orderData",d),a.searchAttachment(),a.set("selectedDevices",a.subViewModels.ShoppingCartViewModel.get("selectedDevices")),a.set("selectedDevicesSku",a.subViewModels.ShoppingCartViewModel.get("selectedDevicesSku")),a.set("orderStatus","detailsAvailable")}}.bind(a)),b.fail(function(b){a.set("orderData",a.subViewModels.productOrderTopicViewModel.get("productOrderID")),b&&0!==b.status&&a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("orderStatus","restFailed")}.bind(a))},dataToFilterPaymentMethod:function(a,b,d,e){var f=this,g=[],h=[];return c.each(a.order.mobile,function(a){g=f.getIds(a.deviceDetails,"deviceId"),h=f.getIds(a.planDetails,"planId")}),c.each(a.order.bundle,function(a){h=h.concat(f.getIds(a.serviceDetails,"serviceId"))}),c.each(a.order.tv,function(a){h=h.concat(f.getIds(a.serviceDetails,"serviceId"))}),c.each(a.order.fv,function(a){h=h.concat(f.getIds(a.serviceDetails,"serviceId"))}),a.paymentMethodFilters||(a.paymentMethodFilters={}),a.paymentMethodFilters={amount:a.order.checkoutPrice.finalAmountIncludingTax,creditRating:a.paymentMethodFilters.creditRating,minTenure:b.length>0?b:"NA",device:g.length>0?g:"NA",plan:h.length>0?h:"NA",deposite:d,billingOffer:e?e:"NA"},a},getIds:function(a,b){var d=c.pluck(a,b);return d.length>0?d:[]},searchAttachment:function(){var a=this,b=a.get("orderData"),d=!0;if(b&&b.isBlockOrder&&(d=!1),d){var e=a.getModel("GenerateAndDisplayContractModel"),f=a.subViewModels.productOrderTopicViewModel;e.set("orderId",f.get("productOrderID")),e.set("barId",f.get("barId")),e.fetch({success:function(b,d){if(d.ImplGenerateAndDisplayContractRestOutput){var e=d.ImplGenerateAndDisplayContractRestOutput;if(e.contractList&&e.contractList.length>0){var g=[];c.each(e.contractList,function(a){g.push({documentID:a.documentId})})}f.set("contractList",g)}else a.set("orderStatus","failed")},error:function(b,c){a.set("orderStatus","failed")}})}},getPersonDetails:function(){var a=this.get("contactId"),b=this;if("undefined"!=typeof a&&null!==a){var d=this.get("orderData")||{},e=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),f=b.subViewModels.productOrderTopicViewModel.get("productOrderID");e&&e===f?d.isExpressCheckout=!0:d.isExpressCheckout=!1,this.set("orderData",d);var g=this.getModel("ViewUpdateCustomerProfileModel");g.set("id",this.get("contactId")),this.getModel("ViewUpdateCustomerProfileModel").fetch({success:c.bind(this.onPersonalDetailsSuccess,this),error:c.bind(this.onPersonalDetailsError,this)})}},onPersonalDetailsSuccess:function(a,b){var d=this,e={},f=b.ImplContactPersonOutput.implContactPerson;void 0!=f.implPhysicalAddressDetails&&(e.postalCode=f.implPhysicalAddressDetails.postcode),e.gender=f.personGender,e.fullName=f.name,e.firstName=f.firstName,e.lastName=f.lastName,e.dateOfBirth=f.birthDate,e.emailId=f.emailId,e.contactNumber=f.phone,"undefined"!=typeof f.nricNumber&&(e.nricNumber=f.nricNumber,e.nricType=f.nricType),"undefined"!=typeof f.documentId&&(e.nricNumber=f.documentId,e.nricType=f.documentType);var g=this.get("orderData")||{};g.personalInformation=e,f.currentCreditRating&&(g.paymentMethodFilters||(g.paymentMethodFilters={}),g.paymentMethodFilters.creditRating=f.currentCreditRating);var h=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),i=d.subViewModels.productOrderTopicViewModel.get("productOrderID");h&&h===i?g.personalInformation.isExpressCheckout=!0:g.personalInformation.isExpressCheckout=!1,this.set("orderData",g);var j=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("dashPayment"),k=d.subViewModels.productOrderTopicViewModel.get("orderActions"),l=c.find(k,function(a){return"WS"===a.lob});!j&&l&&this.checkForDashAccount(e)},onPersonalDetailsError:function(){this.set("orderStatus","failed")},setBillingAndDeliveryAddress:function(a){var b={};return"undefined"!=typeof a&&null!==a&&("undefined"!=typeof a.billingAddress&&(billingAddress=this.formatAddress(a.billingAddress),b.billingAddress=billingAddress,b.billingAddress.srdDate=a.billingAddress.serviceRequiredDate),"undefined"!=typeof a.deliveryAddress&&(deliveryAddress=this.formatAddress(a.deliveryAddress,!0),b.deliveryDetails=deliveryAddress,b.deliveryDetails.srdDate=a.deliveryAddress.serviceRequiredDate),"undefined"!=typeof a.installationAddress&&(installationAddress=this.formatAddress(a.installationAddress),b.installationDetails={},b.installationDetails.installationAddress=installationAddress)),b},formatAddress:function(a,b){var c=this,d="";a.buildingName&&(d=a.buildingName);var e="",f=a.houseNumber||a.blockOrHouseNum;f&&(e=f+" "),a.streetName&&(e+=a.streetName);var g="";(a.apartment||a.unitNumber||a.unitNo)&&(g=a.apartment||a.unitNumber||a.unitNo);var h;if(b){var i=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");if("pop-station"===i||"singtel-pop-station"===i||"collect-now"===i){var j=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("postalCode");if(j){h=j;var k=c.subViewModels.OnePassTopicViewModel.get("isWorryFreeLogin");k&&h&&(h=""+h,h=h.substr(0,h.length-1)+"*")}}else"singtel-store"===i&&(d="",e="",g="")}var l="Singapore "+(h||a.postcode||a.postCode);return a={addressLine1:d,addressLine2:e,addressLine3:g,addressLine4:l}},removeLOB:function(){var a=this.get("itemIdToRemove");null!=a?this.isAnonymousFlow()?this.removeCartForAnonymous(a):this.removeCartForNonAnonymous(a):console.log("Item ID is undefined")},removeCartForAnonymous:function(a){this.models.CommerceAnonymousProductOrderProductOrderItemModel=this.create("CommerceAnonymousProductOrderProductOrderItemModel",d);var e=this.models.CommerceAnonymousProductOrderProductOrderItemModel;e.errorHandler=null,e.set({productOrderId:this.get("implProductOrderId"),productOrderItemId:a}),e.setQueryParams({lo:this.get("locale")?this.get("locale"):b.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):b.get("salesChannel")}),e.destroy({success:c.bind(this._onRemoveCartSuccess,this),error:c.bind(this._onRemoveCartError,this)})},removeCartForNonAnonymous:function(a){this.models.CustomerProductOrderProductOrderItemModel=this.create("CustomerProductOrderProductOrderItemModel",e);var d=this.models.CustomerProductOrderProductOrderItemModel;d.errorHandler=null,d.set({customerId:this.get("customerId"),productOrderId:this.get("implProductOrderId"),productOrderItemId:a}),d.setQueryParams({lo:this.get("locale")?this.get("locale"):b.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):b.get("salesChannel")}),d.destroy({success:c.bind(this._onRemoveCartSuccess,this),error:c.bind(this._onRemoveCartError,this)})},_onRemoveCartSuccess:function(){this.handleAction("removeItemFailed"),this.refreshCart()},_onRemoveCartError:function(){this.handleAction("removeItemFailed"),this.set("orderStatus","failed")},refreshCart:function(a){this.isAnonymousFlow()?this.fetchAnonymousShoppingCartModel(a):this.getOrderSummaryData(a)},updateAccountAddress:function(){var a=this.subViewModels.ShoppingCartViewModel.get("barId");this.set("orderStatus","updateAccountAddress");var b=this.get("newAddress"),d=b.unitNumber||b.unitNo,e=(b.floorNo,{contactRoleName:"Primary",billingArrangementId:a,implPhysicalAddress:{apartment:d,blockOrHouseNum:b.blockOrHouseNum,room:b.blockOrHouseNum,buildingName:b.buildingName,floor:b.floorNo,postcode:b.postCode,unitNumber:d,streetName:b.streetName,country:"SGP",state:"SNG",countryCode:"65"}});this.models.UpdateBillingAddressModel.save({billingArrangementId:a,ImplContactRoleBillArrangemntUpdateRequest:e},{success:c.bind(this.onUpdateBillingAdressSuccess,this),error:c.bind(this.onUpdateBillingAdressFailure,this)})},onUpdateBillingAdressSuccess:function(a,b){if(b&&b.CreateContactRoleIDStruct){var c=this,d=c.get("orderData"),e={billingAddress:this.get("newAddress")},f=c.setBillingAndDeliveryAddress(e),g=d.billingAddress.srdDate;d.billingAddress=f.billingAddress,d.billingAddress.srdDate=g,d.billingAddress=f.billingAddress,c.set("orderData",d),c.searchAttachment(),c.set("orderStatus","addressUpdateSuccess")}else this.set("orderStatus","addressUpdateFailed")},onUpdateBillingAdressFailure:function(a,b){this.set("orderStatus","addressUpdateFailed")},setFreebiesInOrder:function(a,b){var d=this.subViewModels.productOrderTopicViewModel.get("freebiesFailed");d&&d.length>0&&c.each(a,function(a){var b=c.filter(d,function(b){return a.productOrderItemID==b.productOrderItemID});b&&b.length>0&&(a.unAvailableFreeGifts=b)})},checkForDashAccount:function(a){var b=this;b.set("orderStatus","checkForDashAccount");var c=b.getModel("CheckExistingDashAccountModel"),d={ImplManageCustomerPaymentsRestInput:{mobileNumber:"65"+a.contactNumber,accountId:a.nricNumber}};c.save(d,{success:function(a,c){if(c&&c.ImplManageCustomerPaymentsRestOutput){var d=c.ImplManageCustomerPaymentsRestOutput.statusCode;0===d&&b.set("orderStatus","dashStatusPassed")}},error:function(a,c){b.set("orderStatus","dashStatusFailed")}})}});return B});
define("businesswidget/repository_l9_common/common/model/eligibilityCheckModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},read:{contentType:"application/json",payload:["[]"]}}}});return d});
define("businesswidget/repository_l9_common/widgetsLibrary/eligibilityCheckWidget/common/constants",["jquery","lightsaber","businesswidget/repository/common/core/LSResourceBundleCust"],function (a,b,c){var d={NRIC_TYPE:["S","G","T","F"]};return d});
define("businesswidget/repository_l9_common/common/viewmodel/eligibilityCheckViewModel",["underscore","knockout","lightsaber","single!businesswidget/repository_l9_common/common/model/eligibilityCheckModel","businesswidget/repository_l9_common/widgetsLibrary/eligibilityCheckWidget/common/constants","businesswidget/repository/common/core/Configuration","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/utils/utility","businesswidget/repository_l9_common/common/core/WidgetResourceBundle"],function (a,b,c,d,e,f,g,h,i){return c.Core.ObservableViewModel.extend({models:{eligibilityCheckModel:d},defaults:{nricId:"",nricType:"",selectedNricType:"",nricValid:!1},config:{actions:{validateNRIC:function(){this.checkAvailability()}}},setQueryParameters:function(){var a=new Object;return a},checkAvailability:function(){var b=this.setQueryParameters();this.models.eligibilityCheckModel.set("nricId",this.get("nricId")),this.models.eligibilityCheckModel.fetch({data:b,success:a.bind(this.oneligibilityCheckSuccess,this),error:a.bind(this.oneligibilityCheckError,this)})},setData:function(){this.set("nricType",e.NRIC_TYPE)},initialize:function(c){this.setData(),this.set("errors",b.validation.group(this,{deep:!0})),b.validation.rules.validNricId={validator:a.bind(function(a,b){var c=h.validateNRIC(a);return this.set("nricValid",c),c},this),message:i.getString("cm_eligibility_check_error")},b.validation.registerExtenders(),b.validation.addRule(this.data.nricId,{rule:"validNricId",params:this.get("selectedNRICType")})},oneligibilityCheckSuccess:function(a,b){},oneligibilityCheckError:function(){}})});
define("businesswidget/repository_l9_common/common/model/ScheduleAppointmentModel",["lightsaber","underscore","Configuration"],function (a,b,c){var d=a.Core.RESTModel.extend({options:{url:"/ecommerce/customer/:customerId/order/:productOrderId/appointment/schedule",rest:{defaults:{method:"POST"},payload:["ImplAppointmentScheduleInput"]}}});return d});
define("businesswidget/repository_l9_common/common/model/ManageAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/ecommerce/customer/:customerId/order/:productOrderId/appointment/manage",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplManagaAppointmentResInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/ProductOrderTopicViewModel",["lightsaber"],function (a){var b=a.Core.ObservableViewModel.extend({persistent:["productOrderID","productOrderReferenceNumber"],defaults:{productOrderID:null,productOrderReferenceNumber:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductOrderTopicViewModel",path:"businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{productOrderID:{key:"productOrderID",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository_l9_common/common/model/OrderConfirmationAutoCreateCustomerProblemModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/support/customer/:customerId/contact-person/:contactId/auto-customer-problem",rest:{defaults:{method:"POST",contentType:"application/json",payload:["Map"]}}}});return b});
define("businesswidget/repository_l9_common/common/model/IdUploadDocumentPersistModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/document/upload/persist/order/:orderId/contact-person/:contactId",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{payload:["[]"],method:"POST"}}}});return c});
define("businesswidget/repository_l9_common/common/model/UpdateOrderForCodModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/ecommerce/customer/:customerId/order/:orderId/update-order/payment-details-cod",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},method:"POST",contentType:"application/json",payload:["[]"]}}}})});
define("businesswidget/repository_l9_common/common/model/UpdatePaymentMethodModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"ecommerce/customer/:customerId/order/:orderId/update-order-actions",rest:{defaults:{method:"POST",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}});return d});
define("businesswidget/repository_l9_common/common/model/SaveWhiteListInputModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/cce/order/:orderId/SubmitOrderAndUpdateWhiteList",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},update:{contentType:"application/json",method:"POST",payload:["ImplSubmitOrderAndUpdateWhiteList"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ViewContractPdfModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/amdd/contact-person/:contactId/view-pdf",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},method:"POST",payload:["ImplViewPDFDocumentRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/UpdateEquipmentStatusModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/pos/contact-person/:contactId/update-status",rest:{create:{contentType:"application/json",method:"PUT",payload:["ImplUpdateEquipmentStatusRestInput"],qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/ConfirmScheduleAppointmentModel",["lightsaber","underscore","Configuration"],function (a,b,c){var d=a.Core.RESTModel.extend({options:{url:"/ecommerce/customer/:customerId/order/:productOrderId/appointment/schedule",rest:{defaults:{method:"PUT"},create:{method:"PUT",payload:["ImplAppointmentScheduleInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/PaymentRecordModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/sales/onepay/contact-person/:contactId/payment-request",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplCreatePaymentRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/SubmitAndSendNotificationModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/contact/:contactId/customer/:customerId/order/:orderId/submitOrderAndSendNotification",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplSubmitOrderNSendNotficationInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/DistributePromoCodeModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"ordering/customer/:customerId/order/:orderId/distribute-promo-code",rest:{defaults:{method:"POST",payload:["ImplDistributePromoCodeRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/SendPromoCodeModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"ordering/promotions/email-promo-code",rest:{defaults:{method:"POST",payload:["ImplEmailPromoCodeRequest"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/OrderConfirmationViewModel",["lightsaber","underscore","Configuration","businesswidget/repository_l9_common/common/model/OrderConfirmationAutoCreateCustomerProblemModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","businesswidget/repository_l9_common/common/model/PayBillVerifyModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/model/ChangePlanModel","businesswidget/repository_l9_common/common/model/SearchAvailableNumbersModel","businesswidget/repository_l9_common/common/model/PayBillReferenceModel","businesswidget/repository_l9_common/common/model/IdUploadDocumentPersistModel","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","businesswidget/repository_l9_common/common/model/UpdateOrderForCodModel","businesswidget/repository_l9_common/common/model/SelectedNumberModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository_l9_common/common/model/UpdatePaymentMethodModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/model/GenerateAndDisplayContractModel","businesswidget/repository_l9_common/common/model/SaveWhiteListInputModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/ViewContractPdfModel","businesswidget/repository_l9_common/common/model/UpdateEquipmentStatusModel","single!businesswidget/repository_l9_common/common/model/ConfirmScheduleAppointmentModel","businesswidget/repository_l9_common/common/model/PaymentRecordModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel","businesswidget/repository_l9_common/common/model/SubmitAndSendNotificationModel","businesswidget/repository_l9_common/common/model/DistributePromoCodeModel","businesswidget/repository_l9_common/common/model/SendPromoCodeModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J){var K=a.Core.ObservableViewModel.extend({models:{orderConfirmationAutoCreateCustomerProblemModel:d,customerSubmitOrderModel:e,payBillVerifyModel:f,changePlanModel:k,searchAvailableNumbersModel:l,payBillReferenceModel:m,getBillingAccountDetailedListModel:o,idUploadDocumentPersistModel:n,retrieveProductConfigurationOptionsModel:p,updateOrderForCodModel:q,selectedNumberModel:r,implSendNotificationModel:s,viewUpdateCustomerProfileModel:t,updatePaymentMethodModel:u,generateAndDisplayContractModel:w,saveWhiteListOrderModel:x,viewContractPdfModel:A,updateEquipmentStatusModel:B,scheduleAppointmentModel:C,paymentRecordModel:D,submitAndSendNotificationModel:H,distributePromoCodeModel:I,sendPromoCodeModel:J},subViewModels:{customerInContextTopicViewModel:g,orderInContextTopicViewModel:h,individualInContextTopicViewModel:i,shoppingCartViewModel:j,clearContextInContextTopic:v,deviceIdAndPlanIdInContextTopic:y,onePassTopicViewModel:z,selfCollectNowViewModel:E,singtelStoreEAppointmentViewModel:F,billMethodPreferenceViewModel:G},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{"models.orderConfirmationAutoCreateCustomerProblemModel.customerId":"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{orderId:"subViewModels.orderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}},{isOrderAccepted:"subViewModels.orderInContextTopicViewModel.isOrderAccepted",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{"models.orderConfirmationAutoCreateCustomerProblemModel.contactId":"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{contactFirstName:"subViewModels.individualInContextTopicViewModel.contactFirstName",options:{twoWay:!1,setOnBind:!0}},{"models.payBillReferenceModel.customerId":"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{"models.payBillReferenceModel.billingAccountId":"subViewModels.orderInContextTopicViewModel.barId",options:{twoWay:!1,setOnBind:!0}},{promoCriteria:"subViewModels.deviceIdAndPlanIdInContextTopic.promoCriteria",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerId:null,contactId:null,contactFirstName:null,orderId:null,isOrderAccepted:null,customerProblemId:null,customerProblemState:null,orderData:null,paymentData:null,paymentStatus:"",orderStatus:"",imsiNumber:null,upcItems:null,templateId:null,attachmentsList:null,documentId:null,billPayer:null,submitOrder:!0,customerNric:null,broadbandInstallationIds:[],eAppointmentCrOn:c.get("eAppointmentCrOn"),fhbSelfCollectionDetails:[],homeLineDeliveryrequired:!1,surveyData:null,rrpDistributePromoVmStatus:null,distributePromoData:null,rrpEmailPromoVmStatus:null,emailPromoData:null,promoCriteria:null,emailIndicator:!1,smsIndicator:!1,mobileContentList:[]},initialize:function(a){this._super(a),b.bindAll(this,"_onSaveCustomerProblemSuccess","paymentFailure","_onSaveCustomerProblemError","submitOrder","submitOrderSuccess","paymentSuccess","updateProductConfiguration","getImsiNumber","onVerifyPayment","formatAddress","persistDocument","setHeaders","setDefaultQueryParams","sendEmailToCustomer","onFetchSuccess","sendEmail","activateLoadData","getPersonalDetails","clearContextTopics","setOrderIdQueryParams","searchAttachment","submitWhiteListPhoneOrder","allocateOrReserveDevice","updateDeviceConfiguration","allocateOrReserveConfirmDevice","confirmAppointment","_isConfirmScheduleAppointment","submitOrderData","setCookieData","createCookieData","distributePromoCode","_distributePromoCodeSuccess","emailPromoCode","_emailPromoCodeSuccess"),this.set("orderStatus","Available"),this.set("billPayer",this.subViewModels.onePassTopicViewModel.get("billPayer"))},setOrderIdQueryParams:function(){this.getModel("customerSubmitOrderModel").setQueryParams({orderIds:this.get("orderId"),us:!0})},sendEmailToCustomer:function(){var a=this,c=a.subViewModels.individualInContextTopicViewModel.get("personId");if(void 0!==c&null!==c){var d=a.getModel("viewUpdateCustomerProfileModel");d.set("id",c),a.setDefaultQueryParams(d),d.fetch({success:b.bind(a.onFetchSuccess,a),error:function(){a.clearContextTopics()}})}else a.clearContextTopics()},onFetchSuccess:function(a,b){var c=this,d=b.ImplContactPersonOutput.implContactPerson;"undefined"!=typeof d.emailId&&null!==d.emailId&&""!==d.emailId?c.sendEmail(d.emailId):c.clearContextTopics()},emailPromoCode:function(){this.set("rrpEmailPromoVmStatus","EmailInProgress");var a=this.get("emailPromoData"),b={ImplEmailPromoCodeRequest:{couponCode:a.couponCode,campaignGroup:a.campaignGroup,redumptionStartDate:a.redumptionStartDate,redumptionEndDate:a.redumptionEndDate,lob:a.lob,emailId:a.emailId,url:a.url,text:a.text,hash:a.hash}};return this.models.sendPromoCodeModel.save(b,{success:this._emailPromoCodeSuccess,error:function(a,b){this.set("rrpEmailPromoVmStatus","EmailPromoFailed")}.bind(this)})},_emailPromoCodeSuccess:function(a,b){this.set("rrpEmailPromoVmStatus","EmailPromoSuccess")},distributePromoCode:function(){this.set("rrpDistributePromoVmStatus","DistributeInProgress");var a=this.get("orderId"),c=this.get("customerId"),d=this.get("promoCriteria"),e=$.Deferred(),f=this.subViewModels.deviceIdAndPlanIdInContextTopic.get(),g="";if(f.deviceResDetails&&f.deviceResDetails.length&&(deviceResDetails=f.deviceResDetails,b.each(deviceResDetails,function(a){"Accessory"===a.id&&(g=g+a.itemCodeX9+",")})),a&&c&&d){g&&(d=d+"&ACCESSORY="+g.substr(0,g.length-1));var h=d.split("####"),i=h[1].replace(/\s/g,"+").replace(/@@/g,"&"),j={ImplDistributePromoCodeRestInput:{promoCriteria:i,id:a,orderId:a}};this.models.distributePromoCodeModel.set("orderId",a),this.models.distributePromoCodeModel.set("customerId",c),this.models.distributePromoCodeModel.save(j,{success:this._distributePromoCodeSuccess,error:function(a,b){this.set("rrpDistributePromoVmStatus","DistributePromoFailed")}.bind(this)}).then(function(a){e.resolve(a)},function(a){e.reject(a)})}else e.resolve();return e},_distributePromoCodeSuccess:function(a,b){this.set("distributePromoData",b.ImplDistributePromoCodeRestOutput),this.set("rrpDistributePromoVmStatus","DistributePromoSuccess")},sendEmail:function(a){var b=this,c=b.get("templateId"),d=[],e={ImplSendNotificationRequest:{target:[a],templateId:c,notificationChannel:"EMAIL",templateSimpleParameters:d,templateURLParameters:[]}},f=b.getModel("implSendNotificationModel");b.setDefaultQueryParams(f),f.save(e,{success:function(a,c){b.clearContextTopics()},error:function(a,c){b.clearContextTopics()}})},_checkIfOrderAccepted:function(){this.set("customerProblemState",null),this.get("isOrderAccepted")===!1&&this._saveCustomerProblem()},_saveCustomerProblem:function(){var a=this.get("orderId"),b=this.get("customerId"),c=this.get("contactId");if(a&&b&&c){var d=this.getModel("orderConfirmationAutoCreateCustomerProblemModel"),e={Map:{orderId:a}};this.setDefaultQueryParams(d),d.save(e,{success:this._onSaveCustomerProblemSuccess,error:this._onSaveCustomerProblemError}),this.set("customerProblemState","Saving")}else this.set("customerProblemState","SaveError")},_onSaveCustomerProblemSuccess:function(a,b){this.set("customerProblemId",b),this.set("customerProblemState","SaveSuccess")},_onSaveCustomerProblemError:function(a){this.clearContextTopics(),this.set("customerProblemId",null),this.set("customerProblemState","SaveError")},config:{actions:{verifyPayment:function(a,b){var c=this;c.activateLoadData(),c.getPersonalDetails(),c.set("customerNric",c.subViewModels.onePassTopicViewModel.get("nric"))}}},getPersonalDetails:function(){var a=this.subViewModels.individualInContextTopicViewModel.get("personId");if("undefined"!=typeof a&&null!==a){var c=this.getModel("viewUpdateCustomerProfileModel");c.set("id",this.get("contactId")),this.setDefaultQueryParams(c),c.fetch({success:b.bind(this.onPersonalDetailsSuccess,this),error:b.bind(this.onPersonalDetailsError,this)})}},onPersonalDetailsSuccess:function(a,b){var c={},d=b.ImplContactPersonOutput.implContactPerson;void 0!=d.implPhysicalAddressDetails&&(c.postalCode=d.implPhysicalAddressDetails.postcode),c.gender=d.personGender,c.fullName=d.name,c.firstName=d.firstName,c.lastName=d.lastName,c.dateOfBirth=d.birthDate,c.emailId=d.emailId,c.contactNumber=d.phone,"undefined"!=typeof d.nricNumber&&(c.nricNumber=d.nricNumber,c.nricType=d.nricType),"undefined"!=typeof d.documentId&&(c.nricNumber=d.documentId,c.nricType=d.documentType);var e=this.get("orderData")||{};e.personalInformation=c,e.selectedOption=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption"),this.set("orderData",e)},onPersonalDetailsError:function(){this.set("orderStatus","error"),this.set("paymentStatus","restFailed")},activateLoadData:function(a){var c=this,d=c.subViewModels.orderInContextTopicViewModel.get();if(void 0!=d.productOrderReferenceNumber&&""!=d.productOrderReferenceNumber){var e=d.orderActions,f=[];b.each(e,function(a){f.push(a.lob)}),c.set("lobs",f);var g=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("dashPayment");c.subViewModels.shoppingCartViewModel.set("dashPayment",g),c.subViewModels.shoppingCartViewModel.set("mobileContentList",c.get("mobileContentList"));var h=c.subViewModels.shoppingCartViewModel.loadShoppingCartData(!0);h.done(function(a){if("SUCCESS"===a){c.setOrderIdQueryParams();var d=c.subViewModels.shoppingCartViewModel.get("address"),f=c.setBillingAndDeliveryAddress(d,h),g=c.subViewModels.shoppingCartViewModel.get("orderData"),h=c.get("orderData")||{},i=c.subViewModels.shoppingCartViewModel.get("premiumAddonDetails");h.premiumAddonDetails=i,h.billingAddress=f.billingAddress,h.deliveryDetails=f.deliveryDetails,h.cartPurchaseDetails=c.subViewModels.shoppingCartViewModel.get("cartPurchaseDetails"),d.deliveryStartDateAndTime&&("undefined"!=typeof h.deliveryDetails&&null!==h.deliveryDetails||(h.deliveryDetails={}),h.deliveryDetails.deliveryDate=d.deliveryStartDateAndTime),d.deliveryTimeSlot&&("undefined"!=typeof h.deliveryDetails&&null!==h.deliveryDetails||(h.deliveryDetails={}),h.deliveryDetails.deliveryTime=d.deliveryTimeSlot);var j=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");if("collect-now"===j&&("undefined"!=typeof h.deliveryDetails&&null!==h.deliveryDetails||(h.deliveryDetails={}),h.deliveryDetails.deliveryDate=Date.now(),h.deliveryDetails.deliveryTime="00:00 AM - 11:59 PM"),h.installationRequired=!1,d.isBlockOrder&&(h.isBlockOrder=d.isBlockOrder),b.each(e,function(a){"Change"===a.orderType?("TV"===a.lob||"BB"===a.lob&&!h.installationRequired)&&(h.installationRequired=!1):"TV"===a.lob||"BB"===a.lob?h.installationRequired=!0:"undefined"!=typeof a.lob&&null!==a.lob||(h.installationRequired=!0)}),h.order=g.order,!h.installationRequired&&h.order.bundle){var k=c.get("broadbandInstallationIds")||[],l=b.find(k,function(a){var c=a.split("_"),d=b.find(h.order.bundle,function(a){if(c&&a&&a.broadBandPlanDetails&&a.broadBandPlanDetails.serviceId&&b.contains(c,a.broadBandPlanDetails.serviceId))return!0});if(d)return!0});l&&(h.installationRequired=!0)}var m=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),n=c.subViewModels.orderInContextTopicViewModel.get("productOrderID");h.installationRequired&&m!==n&&(f.installationDetails&&(h.installationDetails=f.installationDetails),d.installationDate&&(h.installationDetails.installationDate=d.installationDate),d.netlinkInstallationDate&&(h.installationDetails.netlinkInstallationDate=d.netlinkInstallationDate),d.installationTime&&(h.installationDetails.installationTime=d.installationTime),d.netlinkInstallationTime&&(h.installationDetails.netlinkInstallationTime=d.netlinkInstallationTime)),m===n&&(h.isExpressCheckout=!0),h.isIppPlan=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan"),c.set("orderData",h),c.set("orderStatus","orderDataAvaialble");try{c.createCookieData()}catch(o){console.log("Error creating cookie")}c.doVerifyPayment()}}.bind(c)),h.fail(function(a){403===a.status?c.set("paymentStatus","orderAmendedInOtherFlow"):c.set("paymentStatus","paymentFailure")}.bind(c))}},createCookieData:function(){var a=this,c=a.get("orderData"),d=a.subViewModels.orderInContextTopicViewModel.get();if(c){var e,f=c.order,g=d.methodType;e="cc"===g?"Credit Card":"enets"===g?"eNets":"cod"===g?"Cash":"NA";var h,i=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");h="pop-station"===i||"singtel-pop-station"===i?"POPStation Collection":"singtel-store"===i?"Collect at Singtel Shop":"sms-mail"===i?"Snail Mail":"courier"===i?"Courier to home":"NA";var j={customerName:c.personalInformation.fullName,paymentMethod:e,orderId:d.productOrderID,fulfillmentMethod:h,product:[]};f.mobile&&f.mobile.length>0&&b.each(f.mobile,function(a){var b={product:"WS",transactionType:a.productOrderItemType,planDetails:a.planDetails[0].planName};j.product.push(b)}),f.bundle&&f.bundle.length>0&&b.each(f.bundle,function(a){var b={product:"FHB",transactionType:a.productOrderItemType,planDetails:a.broadBandPlanDetails.serviceType};j.product.push(b)}),f.tv&&f.tv.length>0&&b.each(f.tv,function(a){var b={product:"TV",transactionType:a.productOrderItemType,planDetails:a.tvPlanDetails.serviceType};j.product.push(b)}),a.set("surveyData",j)}},setCookieData:function(a){a&&(window.surveyData=JSON.stringify(a),window.QSI&&window.QSI.API&&(window.QSI.API.load(),window.QSI.API.run()))},setBillingAndDeliveryAddress:function(a){var b={};return"undefined"!=typeof a&&null!==a&&("undefined"!=typeof a.billingAddress&&(billingAddress=this.formatAddress(a.billingAddress),b.billingAddress=billingAddress,b.billingAddress.srdDate=a.billingAddress.serviceRequiredDate),"undefined"!=typeof a.deliveryAddress&&(deliveryAddress=this.formatAddress(a.deliveryAddress,!0),b.deliveryDetails={deliveryAddress:deliveryAddress},b.deliveryDetails.srdDate=a.deliveryAddress.serviceRequiredDate),"undefined"!=typeof a.installationAddress&&(installationAddress=this.formatAddress(a.installationAddress),b.installationDetails={},b.installationDetails.installationAddress=installationAddress)),b},formatAddress:function(a,b){var c=this,d="";a.buildingName&&(d=a.buildingName);var e="",f=a.houseNumber||a.blockOrHouseNum;f&&(e=f+" "),a.streetName&&(e+=a.streetName);var g="";(a.apartment||a.unitNumber)&&(g=a.apartment||a.unitNumber);var h;if(b){var i=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");if("pop-station"===i||"singtel-pop-station"===i||"collect-now"===i){var j=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("postalCode");if(j){h=j;var k=c.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin");k&&h&&(h=""+h,h=h.substr(0,h.length-1)+"*")}}}var l="Singapore "+(h||a.postcode||a.postCode);return a={addressLine1:d,addressLine2:e,addressLine3:g,addressLine4:l}},doVerifyPayment:function(){var a=this,c=a.subViewModels.orderInContextTopicViewModel.get("barId"),d=a.subViewModels.orderInContextTopicViewModel.get("customerID"),e=this.getModel("getBillingAccountDetailedListModel"),f=["X","T"];e.setQueryParams({includeBAStatus:f,barId:c}),e.set("type","CUSTOMER"),e.fetch({id:d,success:function(d,e){if("undefined"!=typeof e.ImplBillingAccountDetailsResponse){var f=b.where(e.ImplBillingAccountDetailsResponse.billingAccountDetails,{billingAccountNumber:c});a.onVerifyPayment(f[0].faid)}else a.set("paymentStatus","failure")},error:function(){a.set("paymentStatus","failure")}})},onVerifyPayment:function(a){var c=this,d=c.get("paymentData"),e=c.subViewModels.orderInContextTopicViewModel.get("methodType");if("cod"===e||"pop-station"===e||"singtel-pop-station"===e||"collect-now"===e||"NA"===e){var f=c.getModel("updateOrderForCodModel");f.set({customerId:c.get("customerId"),orderId:c.subViewModels.orderInContextTopicViewModel.get("productOrderID")}),c.setDefaultQueryParams(f),f.save(g,{success:function(a,b){var d=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption"),e=c.subViewModels.selfCollectNowViewModel.get("collectNowData")||{};b.errorInfo?c.set("paymentStatus","paymentFailure"):"collect-now"===d&&e.imsi?c.updateProductConfiguration(d):c.getImsiNumber()},error:function(a,b){var d=b.responseJSON.ErrorInfo.backendErrorInfo,e=/Current\ order.*is amended in other flow\.\ Continue with order in other flow\./g;400===b.status&&d&&e.test(d)?(c.set("paymentStatus","orderAmendedInOtherFlow"),c.clearContextTopics()):c.set("paymentStatus","paymentFailure")}})}else if("undefined"!=typeof d.implPaymentDetails&&(d.implPaymentDetails.paymentMethodType=e),"undefined"==typeof d.responseCode||""===d.responseCode){b.each(d.implPaymentDetails.implAccountAmountDetails,function(b){b.accountId=a});var g={ImplValidateOnePayRequest:{implPaymentDetails:d.implPaymentDetails,purchaseToken:d.purchaseToken,referenceId:d.referenceId,isSkipArPayment:!0}},f=c.getModel("payBillVerifyModel");f.setQueryParams({ci:c.get("customerId"),oi:c.subViewModels.orderInContextTopicViewModel.get("productOrderID"),us:!0}),f.save(g,{success:c.paymentSuccess,error:c.paymentFailure})}else c.paymentFailure()},paymentSuccess:function(a,b){var c=this;if(b&&b.ImplPaymentConfirmation&&b.ImplPaymentConfirmation.isSkipArPayment){"undefined"!=typeof b.ImplPaymentConfirmation.implValidateOnePayApiResponse&&null!==b.ImplPaymentConfirmation.implValidateOnePayApiResponse&&"COMPLETED"===b.ImplPaymentConfirmation.implValidateOnePayApiResponse.status||c.set("submitOrder",!1);var d=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption"),e=c.subViewModels.selfCollectNowViewModel.get("collectNowData")||{};"collect-now"===d&&e.imsi?c.updateProductConfiguration(d):c.getImsiNumber()}},paymentFailure:function(a,b){this.set("paymentStatus","paymentGatewayReturnedFailure")},updateDeviceConfiguration:function(a){var c=this,d=c.subViewModels.deviceIdAndPlanIdInContextTopic.get(),e=c.subViewModels.selfCollectNowViewModel.get("collectNowData")||{},f=[],g=c.get("orderData"),h=[];b.each(g.order.mobile,function(a){a.orderDetails&&h.push(a)}),b.each(h,function(a,g){var h=$.Deferred(),i=b.filter(d.deviceResDetails,function(b){return a.productOrderItemID===b.orderActionIDX9}),j=[],k=[];if(a&&a.orderDetails&&a.orderDetails.deviceProductId){var l=b.find(i,function(b){return b.itemCodeX9===a.deviceDetails[0].skuId}),m={characteristicID:"8425972",value:"Yes"},n={characteristicID:"8425962",value:l.reservationId&&"collect-now"!=d.selectedOption?l.reservationId:""};l&&k.push({productID:a.orderDetails.deviceProductId,changedCharacteristics:[{characteristicID:"8322",value:l.storeID},m,n]});var o={characteristicID:"8425982",value:"Store"};if(k.length>0&&"singtel-store"===d.selectedOption&&k[0].changedCharacteristics.push(o),"collect-now"==d.selectedOption&&e){var p={characteristicID:"8302",value:e.imei};k.length>0?k[0].changedCharacteristics.push(p):k.push({productID:a.orderDetails.deviceProductId,changedCharacteristics:[p,m,n]})}}if(a&&a.orderDetails&&a.orderDetails.simProductId){var l;l=i&&i.length>0?i[0]:{},k.push({productID:a.orderDetails.simProductId,changedCharacteristics:[{characteristicID:"8322",value:l.storeID},{characteristicID:"8832",value:"381187130N"},{characteristicID:"8425972",value:"Yes"},{characteristicID:"8425962",value:l&&l.simReservationId?l.simReservationId:a.orderDetails.deviceProductId}]});var q=k.length-1,o={characteristicID:"8425982",value:"Store"};k.length>0&&"singtel-store"===d.selectedOption&&k[q].changedCharacteristics.push(o)}a&&a.freeGifts&&a.freeGifts.length>0&&b.each(a.freeGifts,function(a){if(a&&a.skuId){var c=b.find(i,function(b){return b.itemCodeX9===a.skuId});c&&k.push({productID:a.productID,changedCharacteristics:[{characteristicID:"8425972",value:"Yes"},{characteristicID:"8425962",value:c.reservationId}]})}}),a&&a.accessories&&a.accessories.length>0&&b.each(a.accessories,function(a){if(a&&a.skuId){var c=b.find(i,function(b){return b.itemCodeX9===a.skuId});if(c){k.push({productID:a.productID,changedCharacteristics:[{characteristicID:"8322",value:c.storeID},{characteristicID:"8425972",value:"Yes"},{characteristicID:"8425962",value:c.reservationId}]});var e=k.length-1,f={characteristicID:"8425982",value:"Store"};k.length>0&&"singtel-store"===d.selectedOption&&k[e].changedCharacteristics.push(f)}}});var r={UpdateProductInOrderConfigurationRequest:{links:[],confirmationMessagesApproved:!1,runCompatibilityRules:!1,activityForConfiguration:"QuoteSDAllDiscounts",productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:k,newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[],
changedSimpleProducts:j}],configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},s=c.getModel("changePlanModel");s.set({customerId:c.subViewModels.orderInContextTopicViewModel.get("customerID"),productOrderItemId:a.productOrderItemID}),c.setDefaultQueryParams(s),s.save(r,{success:function(a,b){return function(b){a.resolve()}}(h,c),error:function(a,b){return function(c){b.set("paymentStatus","failure"),a.reject()}}(h,c)}),f.push(h)}),$.when.apply(c,f).done(function(){c.allocateOrReserveConfirmDevice()})},getImsiNumber:function(){var a=this,c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get();if("singtel-store"!==c.selectedOption){var d=a.subViewModels.orderInContextTopicViewModel.get(),e=a.get("orderData"),f=b.filter(d.orderActions,function(a){return"WS"===a.lob}),g=!1;if("undefined"!==f&&null!==f&&f.length>0&&e.order.mobile&&e.order.mobile.length>0){var h=b.filter(e.order.mobile,function(a){return a&&a.orderDetails&&a.orderDetails.simProductId});h&&h.length>0&&(g=!0)}if(g){var i={ImplSearchAviableInput:{type:"SIM",numberOfResources:f.length,mobileBBRequired:!1}},j=a.getModel("searchAvailableNumbersModel"),k=e.order.mobile[0].orderDetails.productOrderItemType;j.setQueryParams({oaType:"Provide"===k||"Change Ownership"===k?"PR":"CH"}),j.set({orderId:d.productOrderID,orderItemId:f[0].productOrderItemID,productID:f[0].productID}),j.save(i,{success:b.bind(a.onGetImsiNumberSuccess,a),error:b.bind(a.onGetImsiNumberError,a)})}else a.persistDocument()}else a.persistDocument()},onGetImsiNumberSuccess:function(a,b){if("undefined"!=typeof b.ImplSearchAviableOutput){var c=b.ImplSearchAviableOutput.implSimSpec;this.set("imsiNumber",c),this.updateProductConfiguration()}else this.set("paymentStatus","failure"),imsiDeferred.reject()},onGetImsiNumberError:function(a,b){this.set("paymentStatus","failure"),imsiDeferred.reject()},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc||c.get("salesChannel")})},updateProductConfiguration:function(a){var c=this,d=c.get("orderData"),e=c.get("imsiNumber"),f=[],g=[],h=c.subViewModels.selfCollectNowViewModel.get("collectNowData")||{};b.each(d.order.mobile,function(a){a.orderDetails&&a.orderDetails.simProductId&&g.push(a)}),b.each(g,function(d,g){var i,j=$.Deferred(),k=[];"collect-now"===a&&h.imsi?(k=[{characteristicID:"8858992",value:h.imsi},{characteristicID:"132395",value:h.imsi}],i=h.imsi):k=[{characteristicID:"8858992",value:e[g].number},{characteristicID:"132395",value:e[g].number}];var l={UpdateProductInOrderConfigurationRequest:{links:[],confirmationMessagesApproved:!1,runCompatibilityRules:!1,activityForConfiguration:"QuoteSDAllDiscounts",productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:[{productID:d.orderDetails.simProductId,productSpecContainmentID:"8363722",changedCharacteristics:k}],newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},m=c.getModel("changePlanModel");m.set({customerId:c.subViewModels.orderInContextTopicViewModel.get("customerID"),productOrderItemId:d.productOrderItemID}),c.setDefaultQueryParams(m),m.save(l,{success:b.bind(c.reserveImsiNumber,c,j,a,i||e[g].number),error:function(a,b){return function(c){b.set("paymentStatus","failure"),a.reject()}}(j,c)}),f.push(j)}),$.when.apply(c,f).done(function(){c.persistDocument()})},reserveImsiNumber:function(a,b,c,d,e){var f=this;if("collect-now"===b)return a.resolve();var g={ImplUpdateStatusInput:{resourceData:[{toReserveSIM:!0,simNumber:c}]}},d=f.getModel("selectedNumberModel");f.setDefaultQueryParams(d),d.save(g,{success:function(a,b){return function(b){a.resolve()}}(a,f),error:function(a,b){return function(c){b.set("paymentStatus","failure"),a.reject()}}(a,f)})},persistDocument:function(){var a=this,b=a.getModel("idUploadDocumentPersistModel");b.set({orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),contactId:a.get("contactId")}),a.setDefaultQueryParams(b),b.save(null,{success:function(b,c){a.updatePaymentMethod()},error:function(b){return a.set("paymentStatus","failure"),!0}})},updatePaymentMethod:function(){var a=this,c=a.getModel("updatePaymentMethodModel"),d=a.get("orderData"),e=a.subViewModels.orderInContextTopicViewModel.get(),f=b.filter(e.orderActions,function(a){return"WS"===a.lob}),g=b.filter(e.orderActions,function(a){return"BB"===a.lob}),h=a.subViewModels.deviceIdAndPlanIdInContextTopic.get(),i=[];(h.reservationIDs||h.allocationIDs)&&(i=h.deviceResDetails);var j=a.get("broadbandInstallationIds")||[],k=b.find(j,function(a){var c=a.split("_"),e=b.find(d.order.bundle,function(a){if(c&&a&&a.broadBandPlanDetails&&a.broadBandPlanDetails.serviceId&&b.contains(c,a.broadBandPlanDetails.serviceId))return!0});if(e)return!0}),l=d.cartPurchaseDetails&&d.cartPurchaseDetails.hasPurchasedRG&&!d.cartPurchaseDetails.hasSharedEquipment&&!k;if(a.set("homeLineDeliveryrequired",l),f.length>0||g.length>0&&l){var m=[];if("NA"===e.methodType&&(e.methodType="cod"),b.each(f,function(a,c){var f,g=!1,j=!1;if(i&&i.length>0&&(f=b.find(i,function(b){return b.orderActionIDX9===a.productOrderItemID})),f){var k=h.selectedOption;"singtel-store"===k&&h.reservationIDs&&h.reservationIDs.length>0&&(g=!0),j=!0}if(!j&&d.order.mobile&&d.order.mobile.length>0){var l=b.filter(d.order.mobile,function(b){return b&&b.orderDetails&&b.orderDetails.orderActionId===a.productOrderItemID&&(b.orderDetails.simProductId||b.accessories&&b.accessories.length>0)});l&&l.length>0&&(j=!0)}var n={orderActionId:a.productOrderItemID,implUpdateOrderAction:{orderActionType:"Change"===a.orderType?"CH":"Change Ownership"===a.orderType?"CW":"PR"},isMTCalledForSave:g};j&&(n.implUpdateOrderAction.implUpdateWirelessAppointmentDetails={paymentMethod:e.methodType,msisdn:d.order.mobile[c].orderDetails.msisdn}),m.push(n)}),!k&&d.cartPurchaseDetails&&d.cartPurchaseDetails.hasPurchasedRG&&!d.cartPurchaseDetails.hasSharedEquipment){var n=b.filter(e.orderActions,function(a){return"BB"===a.lob});b.each(n,function(a){var b={orderActionId:a.productOrderItemID,implUpdateOrderAction:{orderActionType:"Change"===a.orderType?"CH":"Change Ownership"===a.orderType?"CW":"PR"},isMTCalledForSave:!1};b.implUpdateOrderAction.implUpdateWirelessAppointmentDetails={paymentMethod:e.methodType,msisdn:d.order.bundle[0].subscriptionId},m.push(b)})}var o={ImplUpdateOrderActionsRequest:{implUpdateOrderActionDataList:m}};a.setDefaultQueryParams(c),c.save(o,{customerId:a.subViewModels.orderInContextTopicViewModel.get("customerID"),orderId:e.productOrderReferenceNumber,success:b.bind(a.onUpdatePaymentMethodSuccess,a),error:b.bind(a.onUpdatePaymentMethodError,a)})}else a.submitWhiteListPhoneOrder()},onUpdatePaymentMethodSuccess:function(a,b){var c=this;b&&b.ImplUpdateOrderActionsResponse&&b.ImplUpdateOrderActionsResponse.isOperationSuccessful?c.submitWhiteListPhoneOrder():c.onUpdatePaymentMethodError()},onUpdatePaymentMethodError:function(){this.set("paymentStatus","failure")},submitWhiteListPhoneOrder:function(){var a=this,d=c.get("isRoiFlag"),e=a.subViewModels.shoppingCartViewModel.get("selectedDevices"),f=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("priorityPhoneDetails"),g=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("roiDetails"),h=a.getModel("saveWhiteListOrderModel");if(d)if(e&&g){var i={ImplSubmitOrderAndUpdateWhiteListInput:{campaignId:g.campaignId,nric:a.subViewModels.onePassTopicViewModel.get("nric"),token:g.token}},j=a.subViewModels.orderInContextTopicViewModel.get("productOrderID");a.setDefaultQueryParams(h),h.save(i,{orderId:j,success:b.bind(a.onSubmitRoiSuccess,a),error:b.bind(a.onSubmitRoiFailure,a)})}else a.allocateOrReserveDevice();else if(e&&f&&f.length>0){var k=[];b.each(f,function(c){if(c.queueNo){var d=$.Deferred(),e={ImplSubmitOrderAndUpdateWhiteListInput:{campaignId:c.campaignId,nric:a.subViewModels.onePassTopicViewModel.get("nric"),queueNo:c.queueNo}},f=a.subViewModels.orderInContextTopicViewModel.get("productOrderID");a.setDefaultQueryParams(h),h.save(e,{orderId:f,success:b.bind(a.onSubmitOrderSuccess,a,d),error:b.bind(a.onSubmitOrderFailure,a,d)}),k.push(d)}}),$.when.apply(a,k).done(function(){a.allocateOrReserveDevice()})}else a.allocateOrReserveDevice()},onSubmitRoiSuccess:function(a,b){b.ImplSubmitOrderAndUpdateWhiteListOutput?b.ImplSubmitOrderAndUpdateWhiteListOutput.status&&(this.set("orderStatus","orderSubmitted"),this.allocateOrReserveDevice()):this.set("paymentStatus","failure")},onSubmitRoiFailure:function(){this.set("paymentStatus","failure")},onSubmitOrderSuccess:function(a,b,c){this.subViewModels.selfCollectNowViewModel.set("collectNowData",null),this.subViewModels.singtelStoreEAppointmentViewModel.set("storeAptDetails",{apptId:"",apptState:""}),a.resolve(),c.ImplSubmitOrderAndUpdateWhiteListOutput&&c.ImplSubmitOrderAndUpdateWhiteListOutput.status&&this.set("orderStatus","orderSubmitted")},onSubmitOrderFailure:function(a,b,c){a.reject(c),this.set("paymentStatus","failure")},allocateOrReserveDevice:function(){var a=this,b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get();if(b.reservationIDs&&b.reservationIDs.length>0||b.allocationIDs&&b.allocationIDs.length>0){var c=b.deviceResDetails;c&&c.length>0?a.updateDeviceConfiguration():a.allocateOrReserveConfirmDevice()}else a.allocateOrReserveConfirmDevice()},allocateOrReserveConfirmDevice:function(){var a=this,c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get(),d=a.getModel("updateEquipmentStatusModel");a.subViewModels.selfCollectNowViewModel.set("collectNowData",null),d.set("contactId",a.get("contactId")),a.setDefaultQueryParams(d);var e,f=c.selectedOption;if((c.reservationIDs||c.allocationIDs)&&"collect-now"!==f){if("singtel-store"===f){if(c.reservationIDs&&c.reservationIDs.length>0){var g=[];b.each(c.reservationIDs,function(a){g.push({reservationID:a,reservationStatus:"Conf"})}),e={ImplUpdateEquipmentStatusRestInput:{reservationStatusInfo:g}}}}else if(c.allocationIDs&&c.allocationIDs.length>0){var g=[];b.each(c.allocationIDs,function(a){g.push({allocationID:a,allocationStatus:"Conf"})}),e={ImplUpdateEquipmentStatusRestInput:{allocationStatusInfo:g}}}d.save(e,{success:function(d,e){if(e&&e.ImplUpdateEquipmentStatusRestOutput&&e.ImplUpdateEquipmentStatusRestOutput.allocationStatusResponse&&e.ImplUpdateEquipmentStatusRestOutput.allocationStatusResponse.length>0||e.ImplUpdateEquipmentStatusRestOutput.reservationStatusResponse&&e.ImplUpdateEquipmentStatusRestOutput.reservationStatusResponse.length>0){var g;c.reservationIDs&&c.reservationIDs.length>0?g=b.find(e.ImplUpdateEquipmentStatusRestOutput.reservationStatusResponse,function(a){return a.updateStatus===!1}):c.allocationIDs&&c.allocationIDs.length>0&&(g=b.find(e.ImplUpdateEquipmentStatusRestOutput.allocationStatusResponse,function(a){return a.updateStatus===!1})),g?a.onUpdatePaymentMethodError():("singtel-store"===f&&a.get("eAppointmentCrOn")&&a.subViewModels.singtelStoreEAppointmentViewModel.confirmEshopAppointment(),a._isConfirmScheduleAppointment())}else a.onUpdatePaymentMethodError()},error:function(){a.set("paymentStatus","failure")}})}else a._isConfirmScheduleAppointment()},submitOrder:function(){var a=this;a.distributePromoCode().always(function(){if(a.get("submitOrder")){var b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedBillOption");if(b){var c=a.subViewModels.billMethodPreferenceViewModel.setBillMethodPreference(b);c.then(function(){var b=a.get("orderData"),c=!0;if(b&&b.isBlockOrder&&(c=!1),c){var d=a.getModel("generateAndDisplayContractModel"),e=a.subViewModels.orderInContextTopicViewModel.get();d.set("orderId",e.productOrderID),d.set("barId",e.barId),a.setDefaultQueryParams(d),d.fetch({success:function(b,c){c.ImplGenerateAndDisplayContractRestOutput?a.submitOrderData():a.submitOrderData()},error:function(b,c){a.submitOrderData()}})}else a.submitOrderData()}.bind(a),function(){a.submitOrderData()}.bind(a))}else a.submitOrderData()}else a.set("paymentStatus","submitOrderPending"),a.clearContextTopics()})},submitOrderData:function(){var a=this,c=a.get("orderData"),d=a.get("fhbSelfCollectionDetails"),e=!0,f=[],g=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),h=a.subViewModels.orderInContextTopicViewModel.get("productOrderID");if(c&&c.premiumAddonDetails&&c.premiumAddonDetails.length>0&&d&&d.length>0&&g&&g===h&&(f=b.filter(d,function(a){if(a){var d=b.find(c.premiumAddonDetails,function(b){return b.sku===a.productId||b.name===a.productMecName||b.spsid===a.productId});if(d)return!0}}),f&&f.length>0&&(e=!1)),e){var i=a.getModel("customerSubmitOrderModel");i.set("customerId",a.subViewModels.orderInContextTopicViewModel.get("customerID")),a.setDefaultQueryParams(i),i.save(null,{success:function(b,c){a.submitOrderSuccess(b,c)},error:function(){a.set("paymentStatus","failure")}})}else{var i=a.getModel("submitAndSendNotificationModel");i.set("customerId",a.subViewModels.orderInContextTopicViewModel.get("customerID")),i.set("orderId",a.get("orderId")),i.set("contactId",a.get("contactId")),a.setDefaultQueryParams(i);var j=a.subViewModels.orderInContextTopicViewModel.get("orderActions"),k=b.find(j,function(a){return"BB"===a.lob&&"Change"===a.orderType}),l=[],m=[];b.each(f,function(c){if(c){var d=[];d.push({key:"productName",value:c.productDisplayName}),d.push({key:"actionType",value:c.actionType}),d.push({key:"actionDetails",value:c.actionDetails}),k&&c.reconRemarks?d.push({key:"remarks",value:c.reconRemarks}):c.gaRemarks&&d.push({key:"remarks",value:c.gaRemarks});var e=b.clone(d);e.push({key:"contactDetails",value:c.contactDetails}),a.get("emailIndicator")&&l.push({templateSimpleParameters:e,templateURLParameters:[]}),a.get("smsIndicator")&&m.push({templateSimpleParameters:d,templateURLParameters:[]})}});var n={ImplSubmitOrderNSendNotficationInput:{emailNotification:l,smsNotification:m}};i.save(n,{success:function(b,c){a.submitOrderSuccess(b,c)},error:function(){a.set("paymentStatus","failure")}})}},submitOrderSuccess:function(a,b){b&&(this.subViewModels.selfCollectNowViewModel.set("collectNowData",null),this.subViewModels.singtelStoreEAppointmentViewModel.set("storeAptDetails",{apptId:"",apptState:""}),this.setCookieData(this.get("surveyData")),this.set("paymentStatus","paymentSuccess"),this.clearContextTopics())},clearContextTopics:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0,!0)},fetchAttachedDocument:function(){var a=this,b=a.getModel("viewContractPdfModel");a.setDefaultQueryParams(b),b.set({contactId:a.get("contactId")});var c={ImplViewPDFDocumentRestInput:{contractId:a.get("documentId")}};b.save(c,{success:function(b,c){var d=c.ImplViewPDFDocumentRestOutput;if(d.implPDFDocument){for(var e=Date.now()+"_"+a.get("documentId")+".pdf",f="application/pdf",g=window.Blob||window.MozBlob||window.WebKitBlob,h=atob(d.implPDFDocument.pDFBuffer),i=h.length,j=new Uint8Array(i),k=0;k<i;k++)j[k]=h.charCodeAt(k);var l=new g([j],{type:f});if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(l,e);else{var m=window.URL||window.webkitURL,n=m.createObjectURL(l),o=document.createElement("a");o.href=n,o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},error:function(b){return a.set("orderStatus","fetchAttachedDocumentFailed"),console.log("fetchAttachedDocument"),!0}})},searchAttachment:function(){var a=this,c=a.getModel("generateAndDisplayContractModel"),d=a.subViewModels.orderInContextTopicViewModel.get();c.set("orderId",d.productOrderID),c.set("barId",d.barId),c.setQueryParams({fromCache:!0}),c.fetch({success:function(c,d){var e=d.ImplGenerateAndDisplayContractRestOutput,f=[],g=a.subViewModels.orderInContextTopicViewModel.get("contractList");e&&e.contractList&&e.contractList.length>0?f=e.contractList:g&&g.length>0&&(f=g),b.each(f,function(a,b){a.documentName="attachment "+(b+1)}),a.set("attachmentsList",f),a.clearContextTopics()},error:function(b,c){a.clearContextTopics()}}),a.set("paymentStatus","paymentSuccess")},_isConfirmScheduleAppointment:function(){var a=this,b=c.get("isConfirmScheduleAppointment");b?a.confirmAppointment():a.submitOrder()},confirmAppointment:function(){var a=this,c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("dwfmTokenId");if(c){var d={ImplAppointmentScheduleInput:{tokenId:c}},e=a.subViewModels.orderInContextTopicViewModel.get(),f=a.getModel("scheduleAppointmentModel");a.setDefaultQueryParams(f),f.save(d,{customerId:e.customerID,productOrderId:e.productOrderID,success:b.bind(a.onReserveAppintmentSuccess,a),error:function(){a.set("paymentStatus","failure")}})}else a.submitOrder()},onReserveAppintmentSuccess:function(a,b){var c=this;void 0!==b?(c.set("confirmAppointmentObject",b),c.submitOrder()):c.set("paymentStatus","failure")}});return K});
define("businesswidget/repository_l9_common/common/model/SaveShoppingCartModel",["lightsaber","underscore","Configuration"],function (a,b,c){var d=a.Core.RESTModel.extend({options:{url:"/ecommerce/shoppingcart/order/:orderId/save",orderId:"orderId",rest:{create:{method:"PUT"},defaults:{contentType:"application/json",qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/NewProductInOfferingInstanceViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/CustomerProductOfferingInstanceModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/CustomerProductOfferingInstanceAnonymousModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/model/SaveShoppingCartModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel","businesswidget/repository_l9_common/common/model/PickAndGoUpdateModel","businesswidget/repository_l9_common/common/viewmodel/business/SimOnlyPlanViewModel","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=a.Core.ObservableViewModel.extend({defaults:{customerIds:null,productOfferingId:null,productOfferingProductSpecID:null,simpleProductSpecID:null,easyMobilePlans:null,orderActionList:{},packType:null,updateDeviceInOrder:!1,fixedLineActions:null,anonymousOrder:!1,isBundle:!1,planOnly:!1,addonDetails:null,installmentPayment:!1,dealerID:null,vendorID:null,mbbWithDevice:!1,deviceProductID:null,flowType:null,updateFVOrder:!1,fvNumber:null,fvProductID:null,pgInfo:null,createOrderScenario:!1,runTVRules:!1,runTVSelectRules:!1,pricingId:null,isGuestCheckoutFlow:!1,addComponentList:null,isUpdateOrderReq:!1,orderingData:null,defaultSTBType:null,mainTemporaryID:null,preTickAddonDetails:null},models:{productOfferingInstanceModel:d,productOfferingAnonymousModel:h,anonymousProductOrderItemProductConfigurationModel:j,customerProductOrderItemProductConfigurationModel:i,customerProductOrderProductOrderItemsModel:l,anonymousProductOrderProductOrderItemsModel:k,saveShoppingCartModel:n,viewUpdateCustomerProfileModel:o,anonymousRetrieveProductConfigOptionsModel:r,CustomerRetrieveProductConfigOptionsModel:q,pickAndGOUpdateModel:s},subViewModels:{customerInContextTopicViewModel:e,orderInContextTopicViewModel:f,deviceIdAndPlanIdInContextTopic:g,implUserContextTopicViewModel:m,individualInContextTopicViewModel:p,simOnlyPlanViewModel:t,pickAndGoViewModel:u,onePassTopicViewModel:v,selfCollectNowViewModel:w,preTickAddonViewModel:x},dataBindings:[{customerIds:"subViewModels.customerInContextTopicViewModel.customerIds",options:{twoWay:!1,setOnBind:!0}},{productOfferingId:"subViewModels.deviceIdAndPlanIdInContextTopic.planId",options:{twoWay:!1,setOnBind:!0}},{priceSchemaId:"subViewModels.deviceIdAndPlanIdInContextTopic.priceSchemaId",options:{twoWay:!1,setOnBind:!0}},{productOfferingProductSpecID:"subViewModels.deviceIdAndPlanIdInContextTopic.relationId",options:{twoWay:!1,setOnBind:!0}},{simpleProductSpecID:"subViewModels.deviceIdAndPlanIdInContextTopic.deviceId",options:{twoWay:!1,setOnBind:!0}}],createModels:function(){this.productOfferingInstanceModel=this.create("productOfferingInstanceModel",d),this.productOfferingAnonymousModel=this.create("productOfferingAnonymousModel",h),this.anonymousProductOrderItemProductConfigurationModel=this.create("anonymousProductOrderItemProductConfigurationModel",j),this.customerProductOrderItemProductConfigurationModel=this.create("customerProductOrderItemProductConfigurationModel",i)},initialize:function(){c.bindAll(this,"createOrder","createModels","createFixedVoiceOrder","updateOrder","onProductOfferingInstanceSuccess","onProductOfferingInstanceError","onUpdateOrderSuccess","triggerSuccess","returnSuccess","onSaveOrderSuccess","updateMBBDeviceInOrder","onFixedOfferingInstance","getErrorMessage","createCancelOrder","processOutput","retrieveProductConfiguration","addOrRemoveDevice","getSuccessMessage","updateOrderToRunRules","updateContractForFHB","populateContractForFHB","processCancelOutput","createOrderAfterCancel"),this.createModels();var a=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("deviceId");a&&this.set("updateDeviceInOrder",!0)},createOrder:function(a,d){var e=this;e.set("planOnly",a),e.set("runTVRules",!1);var f=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"),g=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),h=[];g&&g.length>0&&c.each(g,function(a){h.push(a.productOrderItemID)});var i,j,k,l=this.get("flowType"),m=[],n=["deviceFirst","planFirst","mobileSharePlan","simOnlyPlan","tabletFirst","tabletPlanFirst"],o=this.subViewModels.orderInContextTopicViewModel.get("orderActions");c.each(o,function(a){"TV"===a.lob?j=a.productOrderItemID:"BB"===a.lob?k=a.productOrderItemID:"undefined"!=typeof a.lob&&null!==a.lob||m.push(a.productOrderItemID),c.isEmpty(l)||!c.contains(n,l)||l===a.flowType||c.contains(h,a.productOrderItemID)||h.push(a.productOrderItemID)});var p=b.get("multiCartEnabled");if("FIBER"===l)o&&o.length>0&&(c.each(o,function(a){c.contains(h,a.productOrderItemID)||"FV"!==a.lob||(e.set("updateFVOrder",!0),i=a.productOrderItemID,h.push(a.productOrderItemID)),!c.contains(h,a.productOrderItemID)&&a.isFreeMBB&&h.push(a.productOrderItemID)}),c.isEmpty(m)||"undefined"!=typeof j&&null!==j||(h=c.union(h,m)));else if("TV"===l){var q=e.get("packType")||e.subViewModels.deviceIdAndPlanIdInContextTopic.get("packType");q&&e.set("runTVRules",!0),c.isEmpty(m)||"undefined"!=typeof k&&null!==k||(h=c.union(h,m))}else"deviceFirst"!==l&&"planFirst"!==l&&"mobileSharePlan"!==l&&"simOnlyPlan"!==l||p||o&&o.length>0&&c.each(o,function(a){c.contains(h,a.productOrderItemID)||"WS"!==a.lob||"mBBPlanFirst"!==a.flowType&&"mBBDeviceFirst"!==a.flowType||h.push(a.productOrderItemID)});var r=e.get("updateFVOrder");r&&i?this.retrieveProductConfiguration(i,!0,a,d,h,f):this.createCancelOrder(a,d,h,f)},createFixedVoiceOrder:function(a,b,d,e){var f=this.subViewModels.orderInContextTopicViewModel,g={returnConfiguration:"ALL",runCompatibilityRules:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}},h=f.get("productOrderID");h&&(g.productOrderID=h),"undefined"!=typeof b&&null!==b&&(g.installationAddressID=b);var i,j=this.get("customerIds"),k=f.get("customerID");if("undefined"!=typeof k&&null!==k?i=k:"undefined"!=typeof j&&null!==j&&1===j.length&&(i=j[0]),e&&"staff"===e){var l=[{productOfferingProductSpecID:"8675882",temporaryID:"c"+Math.random().toString(36).substr(2,9),productChanges:{changedContainedProducts:[{productSpecContainmentID:"8613592",changedCharacteristics:[{characteristicID:8363382,value:"Staff"}],temporaryID:"c"+Math.random().toString(36).substr(2,9)}]}}];g.newProducts=l}"undefined"!=typeof i&&null!==i?(f.set("customerID",i),this.productOfferingInstanceModel.set({customerId:i,productOfferingId:8675982}),this.productOfferingInstanceModel.save({CreateNewOfferingConfigurationRequest:g},{success:c.bind(this.onFixedOfferingInstance,this,a,b,d,e),error:c.bind(this.onProductOfferingInstanceError,this)})):(this.productOfferingAnonymousModel.set({productOfferingId:8675982}),this.productOfferingAnonymousModel.save({CreateNewOfferingConfigurationRequest:g},{success:c.bind(this.onFixedOfferingInstance,this,a,b,d,e),error:c.bind(this.onProductOfferingInstanceError,this)}))},onFixedOfferingInstance:function(a,b,c,d,e,f,g){var h=this,i=f.CreateNewOfferingConfigurationResponse;
if("undefined"!=typeof i){var j=(i.productOrderReferenceNumber,i.productOrderID),k=i.newProductsInNewOfferings[0].productID,l=i.newProductsInNewOfferings[0].productOrderItemID,m=i.newProductsInNewOfferings[0].productConfiguration.lineOfBusiness,n=i.newProductsInNewOfferings[0].productConfiguration.productSpecification.level,o=i.newProductsInNewOfferings[0].productOrderItemType,p=[],q=!1;h.get("installmentPayment")&&h.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan")&&h.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration")&&(q=!0),p.push({productOrderItemID:l,productID:k,level:n,lob:m,flowType:h.get("flowType"),orderType:o,isPPOrder:q}),this.set("fixedLineActions",p),this.subViewModels.orderInContextTopicViewModel.set("productOrderID",j),this.createCancelOrder(a,b,c,d)}else this.get("isGuestCheckoutFlow")?this.trigger("tvOrderFailed"):this.trigger("orderFailure")},createCancelOrder:function(a,b,d,e){var f=this;if(f.subViewModels.selfCollectNowViewModel.cancelAppointment(),d&&d.length>0){var g,h=f.subViewModels.orderInContextTopicViewModel,i=h.get("customerID"),j=h.get("productOrderID");i?(g=f.models.customerProductOrderProductOrderItemsModel,g.set("customerId",i)):g=f.models.anonymousProductOrderProductOrderItemsModel,g.set("productOrderId",j),f.setDefaultQueryParams(g);var k=c.clone(d);g.setQueryParams({poi:d}),g.set("id",d[0]),g.destroy({success:c.bind(f.processCancelOutput,f,a,b,k,e),error:c.bind(f.onProductOfferingInstanceError,f)})}else f.processCancelOutput(a,b,d,e)},processCancelOutput:function(a,b,c,d,e,f,g){var h=this,i=!1;if(c&&c.length>0){var j=h.subViewModels.orderInContextTopicViewModel.get("orderActions")||[];if(j&&j.length===c.length){h.subViewModels.orderInContextTopicViewModel.emptyTopic();var k=[];if(k.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),k.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),this.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin")||window.localStorage.removeItem("LightsaberSessionToken"),window.localStorage.setItem("clearSessionStorage",!0),k.length>0)for(var l=0;l<k.length;l++){var m=k[l];window.sessionStorage.removeItem(m)}window.localStorage.removeItem("clearSessionStorage"),i=!0}}h.set("isUpdateOrderReq",i),h.createOrderAfterCancel(a,b,c,d)},createOrderAfterCancel:function(a,b,d,e){var f=this.subViewModels.orderInContextTopicViewModel,g=[],h=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType"),i=[],j=[],k=[],l=[],m=[],n=this.get("flowType");if("WIRELESS"===h)if(e&&"cis"===e){var o=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails"),p=o.childCompanyName;o.childCompanyId&&(p=p+" (BRN: "+o.childCompanyId+")");var q=[{characteristicID:8480012,value:o.companyId},{characteristicID:8582,value:o.companyName},{characteristicID:8592,value:p}];i.push({productSpecContainmentID:"11762",changedCharacteristics:q,temporaryID:"c"+Math.random().toString(36).substr(2,9)})}else e&&"staff"===e&&i.push({productSpecContainmentID:"11822",temporaryID:"c"+Math.random().toString(36).substr(2,9)});if(!a){var r=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("planType");if("MBB"===r)this.set("mbbWithDevice",!0);else{var s={businessType:"DEVICE",simpleProductSpecID:this.get("simpleProductSpecID"),temporaryID:"c"+Math.random().toString(36).substr(2,9)};if(this.get("installmentPayment")){var q=[];q.push({characteristicID:8272,value:this.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration")||"24"}),q.push({characteristicID:13897781,value:"Instalments"}),s.changedCharacteristics=q}l.push(s)}}var t=this.get("easyMobilePlans");if("undefined"!=typeof t&&null!==t){var u;"8480002"===t.planId?u="8494592":"11627591"===t.planId?u="11621331":"11640191"===t.planId?u="11633931":"11621291"===t.planId&&(u="11615031"),j.push({temporaryID:"c"+Math.random().toString(36).substr(2,9),productSpecContainmentID:u,changedCharacteristics:[{characteristicID:8192,value:t.talktime.unit},{characteristicID:8202,value:t.sms.unit},{characteristicID:8212,value:t.data.unit}]})}if(console.log("flowType ----> ",n),console.log("defaultSTBType",this.get("defaultSTBType")),"TV"==n){var v=this.get("defaultSTBType")||"DVR";j.push({temporaryID:"c"+Math.random().toString(36).substr(2,9),productSpecContainmentID:"10797291",changedCharacteristics:[{characteristicID:8631732,value:v}]})}var w=this.get("packType")||this.subViewModels.deviceIdAndPlanIdInContextTopic.get("packType");w&&(j.push({productSpecContainmentID:"8861282",changedCharacteristics:[{characteristicID:8822,value:w}],temporaryID:"c"+Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9)}),e&&"staff"===e&&i.push({productSpecContainmentID:"8635162",temporaryID:"c"+Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9)}));var x=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("tradeInDetails");if(x){var y={productSpecContainmentID:11952,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:8035352,value:"Available"},{characteristicID:13142,value:"Available"},{characteristicID:13162,value:"Available"},{characteristicID:13182,value:"Available"},{characteristicID:13152,value:"Available"},{characteristicID:13132,value:"Available"},{characteristicID:8852,value:x.deviceName},{characteristicID:8842,value:x.brand}],parentProductSpecContainmentID:8363682};i.push(y)}"WIRELESS"===h&&j.push({productSpecContainmentID:8363722,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:8022652,value:"3IN1"}]});var z=this.get("orderingData");if(z&&z.startDate){var A="c"+Math.random().toString(36).substr(2,9)+"-"+Math.random().toString(36).substr(2,9),q=[];!z.accountNo||8!==z.accountNo.substring(0,1)&&"8"!==z.accountNo.substring(0,1)||q.push({characteristicID:18611491,value:z.accountNo}),z.startDate&&q.push({characteristicID:18611511,value:z.startDate}),q.push({characteristicID:18683321,value:"No"}),j.push({productSpecContainmentID:18628731,temporaryID:A,changedCharacteristics:q}),this.set("mainTemporaryID",A),j.push({productSpecContainmentID:18645531,temporaryID:"c"+Math.random().toString(36).substr(2,9)+"-"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:18611551,value:"Owner"},{characteristicID:18611501,value:z.housingDetails}]})}var B=this.get("dealerID"),C=this.get("vendorID");if(B&&C)if("FIBER"===n){var D=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("bbRelationIds");g.push({productOfferingProductSpecID:D.groupRelId,temporaryID:"c"+Math.random().toString(36).substr(2,9),vendorCodeX8:C,dealerCodeX8:B}),g.push({productOfferingProductSpecID:D.fvRelId,temporaryID:"c"+Math.random().toString(36).substr(2,9),vendorCodeX8:C,dealerCodeX8:B}),g.push({productOfferingProductSpecID:D.bbRelId,temporaryID:"c"+Math.random().toString(36).substr(2,9),vendorCodeX8:C,dealerCodeX8:B})}else 0===g.length&&(g=[{productOfferingProductSpecID:this.get("productOfferingProductSpecID"),temporaryID:this.get("mainTemporaryID")||"c"+Math.random().toString(36).substr(2,9)}]),g[0].vendorCodeX8=C,g[0].dealerCodeX8=B;var E={},F=!1;i.length>0&&(E.newContainedProducts=i,F=!0),j.length>0&&(E.changedContainedProducts=j,F=!0),k.length>0&&(E.newAssignedBillingOffers=k,F=!0),l.length>0&&(E.newSimpleProducts=l,F=!0),m.length>0&&(E.changedSimpleProducts=m,F=!0),F&&(0===g.length&&(g=[{productOfferingProductSpecID:this.get("productOfferingProductSpecID"),temporaryID:"c"+Math.random().toString(36).substr(2,9)}]),g[0].productChanges=E);this.get("runTVSelectRules");payloadInput={returnConfiguration:"ALL",runCompatibilityRules:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1},newProducts:g};var G=f.get("productOrderID");G?payloadInput.productOrderID=G:this.set("createOrderScenario",!0),"undefined"!=typeof b&&null!==b&&(payloadInput.installationAddressID=b);var H,I=this.get("customerIds"),J=f.get("customerID");"undefined"!=typeof J&&null!==J?H=J:"undefined"!=typeof I&&null!==I&&1===I.length&&(H=I[0]),"undefined"!=typeof H&&null!==H?(f.set("customerID",H),this.productOfferingInstanceModel.set({customerId:H,productOfferingId:this.get("productOfferingId")}),this.productOfferingInstanceModel.save({CreateNewOfferingConfigurationRequest:payloadInput},{success:c.bind(this.onProductOfferingInstanceSuccess,this,d,e),error:c.bind(this.onProductOfferingInstanceError,this)})):(this.productOfferingAnonymousModel.set({productOfferingId:this.get("productOfferingId")}),"undefined"!=typeof G&&null!==G||this.set("anonymousOrder",!0),this.productOfferingAnonymousModel.save({CreateNewOfferingConfigurationRequest:payloadInput},{success:c.bind(this.onProductOfferingInstanceSuccess,this,d,e),error:c.bind(this.onProductOfferingInstanceError,this)}))},onProductOfferingInstanceSuccess:function(a,b,c,d,e){var f=this;f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutOrderID",null),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutServiceID",null),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutRulesCompleted",!1),f.processOutput(c,d,e,a,b)},processOutput:function(a,b,d,e,f){var g,h=this.subViewModels.orderInContextTopicViewModel.get("orderActions")||[],i=this;h&&h.length>0&&(h=c.filter(h,function(a){return!c.contains(e,a.productOrderItemID)}));var j=b.CreateNewOfferingConfigurationResponse,k=this.subViewModels.orderInContextTopicViewModel,l=j.productOrderReferenceNumber,m=j.productOrderID,n=this.get("mbbWithDevice");this.get("fvNumber");k.set("productOrderReferenceNumber",l),k.set("productOrderID",m);var o=this.get("fixedLineActions");if(("undefined"==typeof o||null===o)&&1===j.newProductsInNewOfferings.length){var p=j.newProductsInNewOfferings[0].productOrderItemID,q=j.newProductsInNewOfferings[0].productID;k.set("productOrderItemID",p),k.set("productID",q)}var r=[];if(j.newProductsInNewOfferings.length>1&&this.set("isBundle",!0),n){var s=j.newProductsInNewOfferings[0].productConfiguration;c.each(s.displayableItems,function(a){void 0!==a.displayableSimpleProductReferences&&a.displayableSimpleProductReferences.length>0&&c.find(a.displayableSimpleProductReferences,function(a){if("DEVICE"===a.businessType)return g=a.productID,!0})})}var t=i.get("updateFVOrder"),u=this.get("planOnly");i.get("flowType"),i.get("productOfferingId");c.each(j.newProductsInNewOfferings,function(a){var b=!1;i.get("installmentPayment")&&i.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan")&&i.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration")&&(b=!0);var d={productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productConfiguration.productSpecification.level,lob:a.productConfiguration.lineOfBusiness,planOnly:u,flowType:i.get("flowType"),orderType:a.productOrderItemType,isPPOrder:b};if(r.push(d),h.push(d),t&&"FV"===a.productConfiguration.lineOfBusiness&&"S"===a.productConfiguration.productSpecification.level){c.each(a.productConfiguration.displayableItems,function(a){"8613592"===a.productSpecContainmentID&&i.set("fvProductID",a.productID)})}"FV"===a.productConfiguration.lineOfBusiness&&"G"===a.productConfiguration.productSpecification.level&&c.each(a.productConfiguration.displayableItems,function(a){"8854312"===a.productSpecContainmentID&&c.each(a.displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema&&"INCLUDED_BY_DEFAULT"===a.productSpecPricing.includeByDefault&&i.set("pricingId",a.productSpecPricingID)})})}),"undefined"!=typeof o&&null!==o&&c.each(o,function(a){r.push(a),h.push(a)}),k.set("orderActions",h),k.set("currentOrderActions",r),k.set("packType",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("flowType",null);var v=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("tradeInDetails");v&&this.subViewModels.deviceIdAndPlanIdInContextTopic.set("tradeInDetails",null);var w=this.subViewModels.individualInContextTopicViewModel.get("personId"),x=this.get("addonDetails"),y=this.get("addComponentList"),z=k.get("customerID"),A=this.get("orderingData");A&&A.accountNo&&(9===A.accountNo.substring(0,1)||"9"===A.accountNo.substring(0,1))&&this.subViewModels.simOnlyPlanViewModel.set("accountNo",A.accountNo);var B=this.subViewModels.simOnlyPlanViewModel.updateAddonDetailsOrder(b,x,y,z);B.done(function(a){if("failed"!==a){if(this.subViewModels.deviceIdAndPlanIdInContextTopic.set("addonDetails",this.get("addonDetails")),this.get("anonymousOrder")&&void 0!==w&&null!==w){var b=this.getModel("viewUpdateCustomerProfileModel");b.set("id",w),b.fetch({success:c.bind(this.onFetchProfileSuccess,this,f),error:this.getErrorMessage})}else n||t?this.updateMBBDeviceInOrder(g):this.updateStaffInOrder(f);var d=this.get("easyMobilePlans");"undefined"!=typeof d&&null!==d&&this.subViewModels.deviceIdAndPlanIdInContextTopic.set("easyMobileId",p)}else i.onProductOfferingInstanceError()}.bind(i))},onFetchProfileSuccess:function(a,d,e){var d=this.getModel("saveShoppingCartModel");d.setQueryParams({email:e.ImplContactPersonOutput.implContactPerson.emailId,orderDetailsInd:"No",lo:this.get("locale")?this.get("locale"):b.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):b.get("salesChannel"),order:this.subViewModels.orderInContextTopicViewModel.get("productOrderID")}),d.set({orderId:this.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber")}),d.save({},{success:c.bind(this.updateStaffInOrder,this,a),error:this.getErrorMessage})},updateStaffInOrder:function(a){var b=this;if(this.get("isBundle")&&"staff"===a&&b.get("pricingId")){var d="c"+Math.random().toString(36).substr(2,9),e={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[{productSpecPricingID:b.get("pricingId"),parentProductSpecContainmentID:"8854312",parentTemporaryID:d}],newContainedProducts:[{productSpecContainmentID:"8854312",temporaryID:d}],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},f=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),g=null;c.each(f,function(a){"G"===a.level&&(g=a.productOrderItemID)});var h=(this.subViewModels.orderInContextTopicViewModel.get("productOrderID"),this.subViewModels.orderInContextTopicViewModel.get("customerID"));if("undefined"!=typeof h&&null!==h&&""!==h){var i=b.getModel("customerProductOrderItemProductConfigurationModel");i.set({customerId:h,productOrderItemId:g}),b.setHeaders(i),b.setDefaultQueryParams(i),i.setQueryParams({rp:!1,rpc:!1}),i.save(e,{success:b.onSaveOrderSuccess,error:b.getErrorMessage})}else{var j=b.getModel("anonymousProductOrderItemProductConfigurationModel");j.set({productOrderItemId:g}),b.setHeaders(j),b.setDefaultQueryParams(j),j.setQueryParams({rp:!1,rpc:!1}),j.save(e,{success:b.onSaveOrderSuccess,error:b.getErrorMessage})}}else this.onSaveOrderSuccess()},updateMBBDeviceInOrder:function(a){var b=this;if(this.get("mbbWithDevice")&&a){var c={productID:a,simpleProductSpecID:this.get("simpleProductSpecID"),temporaryID:"c"+Math.random().toString(36).substr(2,9)},d=this.get("installmentPayment");if(d){var e=[];e.push({characteristicID:8272,value:"24"}),e.push({characteristicID:13897781,value:"Instalments"}),c.changedCharacteristics=e,this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installmentPayment",!0)}else this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installmentPayment",!1);var f={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[c],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},g=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),h=g[0].productOrderItemID,i=(this.subViewModels.orderInContextTopicViewModel.get("productOrderID"),this.subViewModels.orderInContextTopicViewModel.get("customerID"));if("undefined"!=typeof i&&null!==i&&""!==i){var j=b.getModel("customerProductOrderItemProductConfigurationModel");j.set({customerId:i,productOrderItemId:h}),b.setHeaders(j),b.setDefaultQueryParams(j),j.setQueryParams({rp:!1,rpc:!1}),j.save(f,{success:b.onSaveOrderSuccess,error:b.getErrorMessage})}else{var k=b.getModel("anonymousProductOrderItemProductConfigurationModel");k.set({productOrderItemId:h}),b.setHeaders(k),b.setDefaultQueryParams(k),k.setQueryParams({rp:!1,rpc:!1}),k.save(f,{success:b.onSaveOrderSuccess,error:b.getErrorMessage})}}else this.onSaveOrderSuccess()},onSaveOrderSuccess:function(a,b){var d=this.get("updateFVOrder"),e=this.get("fvNumber"),f=this.get("fvProductID"),g=this;if(d&&e&&f){var h=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");if(h=c.filter(h,function(a){return"FV"===a.lob&&"S"===a.level}),h&&h.length>0){var i={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[{productSpecContainmentID:"8613592",productID:f,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:2420019,value:e}]}],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},j=h[0].productOrderItemID,k=(this.subViewModels.orderInContextTopicViewModel.get("productOrderID"),this.subViewModels.orderInContextTopicViewModel.get("customerID"));if("undefined"!=typeof k&&null!==k&&""!==k){var l=g.getModel("customerProductOrderItemProductConfigurationModel");l.set({customerId:k,productOrderItemId:j}),g.setHeaders(l),g.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(i,{success:g.triggerSuccess,error:g.getErrorMessage})}else{var m=g.getModel("anonymousProductOrderItemProductConfigurationModel");m.set({productOrderItemId:j}),g.setHeaders(m),g.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save(i,{success:g.triggerSuccess,error:g.getErrorMessage})}}}else this.triggerSuccess()},triggerSuccess:function(){var a=this,b=a.get("pgInfo");"undefined"!=typeof b&&null!==b&&("undefined"!=typeof b.code&&null!==b.code&&""!==b.code||"undefined"!=typeof b.campaign&&null!==b.campaign&&""!==b.campaign||"undefined"!=typeof b.parentLine&&null!==b.parentLine&&""!==b.parentLine)||(b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo"));var c=(a.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType"),a.get("runTVRules")),d=this.get("runTVSelectRules"),e=a.get("createOrderScenario");if(e&&b&&(b.code||b.campaign&&b.parentLine)){var f=a.subViewModels.pickAndGoViewModel.updateCode(b,!1);f.done(function(b){"pickAndGoUpdated"===b?c||d?a.updateOrderToRunRules(!0):a.returnSuccess():"pickAndGoFailed"===b&&a.getErrorMessage()})}else c||d?a.updateOrderToRunRules(!0):a.returnSuccess()},updateOrderToRunRules:function(a){var b,d,e,f=this,g=[],h={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},i=f.subViewModels.orderInContextTopicViewModel.get();e=a?c.filter(i.currentOrderActions,function(a){return"TV"===a.lob&&"S"===a.level}):c.filter(i.currentOrderActions,function(a){return"FV"===a.lob&&"G"===a.level}),e&&e.length>0&&(b=e[0].productOrderItemID,d=e[0].productID,g.push({productID:d})),g.length>0&&(h.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=g);var j=i.customerID;if(j){var k=f.getModel("customerProductOrderItemProductConfigurationModel");k.set({customerId:j,productOrderItemId:b}),f.setHeaders(k),f.setDefaultQueryParams(k),k.setQueryParams({rp:!1,rpc:!1}),k.save(h,{success:f.getSuccessMessage,error:f.onProductOfferingInstanceError})}else{var l=f.getModel("anonymousProductOrderItemProductConfigurationModel");l.set({productOrderItemId:b}),f.setHeaders(l),f.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(h,{success:f.getSuccessMessage,error:f.onProductOfferingInstanceError})}},getSuccessMessage:function(a,b,c){var d=b.UpdateProductInOrderConfigurationResponse.productConfiguration.compatibilityStatus,e=this;if("BLOCKING"===d)e.onProductOfferingInstanceError();else{var f=e.get("preTickAddonDetails");if(f&&f.preTickAddons){var g=e.subViewModels.preTickAddonViewModel;g.set("preTickAddons",f.preTickAddons),g.createInputPayload(b.UpdateProductInOrderConfigurationResponse,f.addComponentList);var h=g._updateProductConfiguration();h.done(function(a){e.returnSuccess()}.bind(e))}else e.returnSuccess()}},returnSuccess:function(){this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mbbWithDevice",!1),this.get("isGuestCheckoutFlow")?this.trigger("tvOrderCreated"):this.trigger("dataSet")},onProductOfferingInstanceError:function(a,b,c){this.get("isGuestCheckoutFlow")?this.trigger("tvOrderFailed"):this.trigger("orderFailure")},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},updateOrder:function(){var a,b=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");a=b&&b.length>0?b[0].productOrderItemID:this.subViewModels.orderInContextTopicViewModel.get("productOrderItemID"),this.retrieveProductConfiguration(a,!1)},onUpdateOrderSuccess:function(a,b){var d=this.subViewModels.orderInContextTopicViewModel.get("orderActions");c.each(d,function(a){a.productOrderItemID===b.UpdateProductInOrderConfigurationResponse.productOrderItemID&&(a.freebiesRemoved=null)}),this.subViewModels.orderInContextTopicViewModel.set("orderActions",d),this.get("isGuestCheckoutFlow")?this.trigger("tvOrderCreated"):this.trigger("dataSet")},getErrorMessage:function(a,b){this.get("isGuestCheckoutFlow")?this.trigger("tvOrderFailed"):this.trigger("orderFailure")},retrieveProductConfiguration:function(a,b,d,e,f,g){var h=this.subViewModels.orderInContextTopicViewModel.get(),i=h.customerID,j=(h.currentOrderActions,{activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}});if(i){var k=this.getModel("CustomerRetrieveProductConfigOptionsModel");k.set({customerId:i,productOrderItemId:a}),k.setQueryParams({rp:!1,rpc:!1}),k.set("RetrieveProductInOrderConfigurationRequest",j),this.setHeaders(k),this.setDefaultQueryParams(k),k.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this,b,d,e,f,g),error:c.bind(this.onFetchProductConfigurationError,this)})}else{var l=this.getModel("anonymousRetrieveProductConfigOptionsModel");l.set({productOrderItemId:a}),l.setQueryParams({rp:!1,rpc:!1}),l.set("RetrieveProductInOrderConfigurationRequest",j),this.setHeaders(l),this.setDefaultQueryParams(l),l.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this,b,d,e,f,g),error:c.bind(this.onFetchProductConfigurationError,this)})}},onFetchRetrieveProductConfigurationSuccess:function(a,b,d,e,f,g,h,i){var j=this,k=h.RetrieveProductInOrderConfigurationResponse.currentOrderActionStatus;if("NE"===k){var l=h.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems;if(l)if(a)l=c.filter(l,function(a){return"8613592"===a.productSpecContainmentID}),l&&l.length>0&&(j.set("fvNumber",l[0].serviceID),j.createCancelOrder(b,d,e,f));else{var m,n="",o=(c.each(l,function(a){void 0!==a.displayableSimpleProductReferences&&a.displayableSimpleProductReferences.length>0&&c.find(a.displayableSimpleProductReferences,function(a){if("DEVICE"===a.businessType&&a.productID)return n={productID:a.productID,parentProductID:a.parentProductID,productSpecContainmentID:a.productSpecContainmentID},a.simpleProductSpecID&&(n.simpleProductSpecID=a.simpleProductSpecID),!0})}),j.subViewModels.deviceIdAndPlanIdInContextTopic.get("changeCartflag"));"deviceDetails"===o?o=!0:(o=!1,m="NPCFirstLoad");var p={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:o,activityForConfiguration:m,addDefaultChildItemsImplicitly:!0,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],removedSimpleProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[{businessType:"DEVICE",simpleProductSpecID:this.get("simpleProductSpecID"),temporaryID:"c"+Math.random().toString(36).substr(2,9)}],removedAssignedBillingOffers:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:o,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};"undefined"!=typeof n&&""!==n&&(p.UpdateProductInOrderConfigurationRequest.productChanges[0].removedContainedProducts.push({productID:n.productID}),n.parentProductID&&p.UpdateProductInOrderConfigurationRequest.productChanges[0].removedContainedProducts.push({productID:n.parentProductID}));var q=this.get("installmentPayment");if(q){var r=p.UpdateProductInOrderConfigurationRequest.productChanges[0].newSimpleProducts[0],s=[];s.push({characteristicID:8272,value:this.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration")||"24"}),s.push({characteristicID:13897781,value:"Instalments"}),r.changedCharacteristics=s,p.UpdateProductInOrderConfigurationRequest.productChanges[0].newSimpleProducts[0]=r,this.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan")||this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installmentPayment",!0)}else this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installmentPayment",!1);this.addOrRemoveDevice(p)}}else this.trigger("orderFailure")},onFetchProductConfigurationError:function(a,b,c){this.set("retrieveProductConfigurationError","retrieveProductConfigurationError"),this.trigger("orderFailure")},addOrRemoveDevice:function(a){var b=this,c=this.subViewModels.orderInContextTopicViewModel.get(),d=c.customerID,e=c.currentOrderActions;if("undefined"!=typeof d&&null!==d&&""!==d){var f=b.getModel("customerProductOrderItemProductConfigurationModel");f.set({customerId:d,productOrderItemId:e[0].productOrderItemID}),b.setHeaders(f),b.setDefaultQueryParams(f),f.setQueryParams({rp:!1,rpc:!1}),f.save(a,{success:b.onUpdateOrderSuccess,error:b.getErrorMessage})}else{var g=b.getModel("anonymousProductOrderItemProductConfigurationModel");g.set({productOrderItemId:e[0].productOrderItemID}),b.setHeaders(g),b.setDefaultQueryParams(g),g.setQueryParams({rp:!1,rpc:!1}),g.save(a,{success:b.onUpdateOrderSuccess,error:b.getErrorMessage})}},updateContractForFHB:function(a){var b=this,d=b.populateContractForFHB(a),e=[],f=[];d&&(d.billingOfferToBeRemoved&&e.push(d.billingOfferToBeRemoved),d.newAssignedBillingOffers&&f.push(d.newAssignedBillingOffers));var g=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"),h=[];"staff"===g&&h.push({productSpecContainmentID:"8854312",temporaryID:"c"+Math.random().toString(36).substr(2,9)});var i={removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:f,newContainedProducts:h,newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:e,resumedContainedProducts:[]},j={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[i],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},k=d.orderActions,l=(b.subViewModels.orderInContextTopicViewModel.get("productOrderID"),b.subViewModels.orderInContextTopicViewModel.get("customerID"));if("undefined"!=typeof l&&null!==l&&""!==l){var m=b.getModel("customerProductOrderItemProductConfigurationModel");m.set({customerId:l,productOrderItemId:k.productOrderItemID}),b.setHeaders(m),b.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save(j,{success:c.bind(b.onChangeContractForFHB,b),error:b.getErrorMessage})}else{var n=b.getModel("anonymousProductOrderItemProductConfigurationModel");n.set({productOrderItemId:k.productOrderItemID}),b.setHeaders(n),b.setDefaultQueryParams(n),n.setQueryParams({rp:!1,rpc:!1}),n.save(j,{success:c.bind(b.onChangeContractForFHB,b),error:b.getErrorMessage})}},onChangeContractForFHB:function(){console.log("contract changed")},populateContractForFHB:function(a){var b={},d={},e={};c.each(a,function(a){"G"===a.productConfiguration.productSpecification.level&&(e=a,c.each(a.productConfiguration.displayableItems,function(a){var e=a.displayableBillingOffers;c.each(e,function(c){var e=c.productSpecPricing;e&&"8707562"===e.childPricingSchema.id&&(b={billingOfferID:c.billingOfferID,parentProductID:a.parentProductID}),e&&"12285891"===e.childPricingSchema.id&&(d={productSpecPricingID:c.productSpecPricingID,parentProductID:a.parentProductID,parentProductSpecContainmentID:a.parentProductSpecContainmentID
})})}))});var f={billingOfferToBeRemoved:b,newAssignedBillingOffers:d,orderActions:e};return f}});return y});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/EasyMobileTweakingTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["easyMobilePlans"],defaults:{easyMobilePlans:""}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetDmpCommerceViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d){return a.Core.ObservableViewModel.extend({subViewModels:{deviceIdAndPlanIdInContextTopic:d,miniCartInContextTopic:c},initialize:function(){this._super();b.bindAll(this,"formatProductData","setProductData","getCartData","getPlanSelectionData","onPhoneSelection","setDataObject")},defaults:{phoneData:null,gtmViewStatus:null},getCartData:function(a){try{if(window.dataObject){var b=this;if(a&&a.order){var c=[];a=a.order;var d=a.mobile,e=a.tv,f=a.bundle;d&&d.length>0&&(c=b.formatProductData(d,c)),e&&e.length>0&&(c=b.formatProductData(e,c)),f&&f.length>0&&(c=b.formatProductData(f,c));var g={eCommerceCheckout:c};b.setDataObject(g)}}}catch(h){console.log("unable to send DMP data")}},formatProductData:function(a,c){var d=this;return b.each(a,function(a){var e="",f=a.deviceDetails;f&&f.length>0&&!a.isfreeMbb&&(f=f[0],f.offerName=e.concat(f.deviceName," ",f.colour," ",f.deviceSize,";"),f.offerID=f.deviceId,c=d.setProductData(f,c));var g=a.planDetails;g&&g.length>0&&(g=g[0],g.offerName=g.planName,g.offerID=g.planId,c=d.setProductData(g,c));var h=a.addons;h&&h.length>0&&b.each(h,function(a){a.offerName=a.name,c=d.setProductData(a,c)});var i=a.broadBandPlanDetails;i&&(a.offerName=i.serviceType,a.offerID=i.serviceId,c=d.setProductData(a,c));var j=a.tvPlanDetails;j&&(a.offerName=j.serviceType,a.offerID=j.serviceId,c=d.setProductData(a,c))}),c},setProductData:function(a,b){var c={offerID:a.offerID,offerName:a.offerName,oneTimePriceWithTax:a.oneTimePrice.finalAmountIncludingTax,MonthlyPriceWithTax:a.recurringPrice.finalAmountIncludingTax,UpfrontPriceWithTax:a.checkoutPrice.finalAmountIncludingTax};return b.push(c),b},getPlanSelectionData:function(a){try{var b=this;if(window.dataObject){var c=this.subViewModels.miniCartInContextTopic.get(),d=this.subViewModels.deviceIdAndPlanIdInContextTopic.get();if(d){var e;c&&c.flowData&&(e=c.flowData.planName);var f={triggerAction:"createOrUpdateOrder",flowSelection:{planId:d.planId,planName:e}};b.setDataObject(f)}}}catch(g){console.log("unable to send DMP data")}},onPhoneSelection:function(){var a=this.get("phoneData"),b=this;try{if(a)var c={flowSelection:{deviceName:a}};b.setDataObject(c)}catch(d){console.log("unable to send DMP data")}},setDataObject:function(a){if(this.set("gtmViewStatus",""),window.dataObject.length>0){var c=window.dataObject[0];c=b.extend(c,a),window.dataObject[0]=c}else window.dataObject.push(a);this.set("gtmViewStatus","dataObjectUpdated")}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/PlanAndDeviceIdCatalogueViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/NewProductInOfferingInstanceViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/EasyMobileTweakingTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/GetDmpCommerceViewModel"],function (a,b,c,d,e,f,g,h,i,j,k){var l=a.Core.ObservableViewModel.extend({subViewModels:{easyMobileTweakingTopicViewModel:f,deviceIdAndPlanIdInContextTopic:e,orderInContextTopicViewModel:g,newProductInOfferingInstanceViewModel:d,onePassTopicViewModel:h,miniCartInContextTopic:i,clearContextInContextTopic:j,getDmpCommerceViewModel:k},defaults:{salesChannel:"",locale:"",orderStatus:"",easyMobilePlans:null,deviceId:"",installationAddressId:null,updateDevice:!1,customerType:null,cisDetails:null,staffDetails:null,addonDetails:null,installmentPayment:!1,dealerID:null,vendorID:null,userId:null,flowType:null,isFvOrder:!1,currentOrderActions:null,orderActions:null,isEasyMobile:null,pgInfo:null,addComponentList:null,vmStatus:null,preTickAddonDetails:null},dataBindings:[{cisDetails:"subViewModels.deviceIdAndPlanIdInContextTopic.cisDetails",options:{twoWay:!1,setOnBind:!0}},{staffDetails:"subViewModels.deviceIdAndPlanIdInContextTopic.staffDetails",options:{twoWay:!1,setOnBind:!0}},{customerType:"subViewModels.deviceIdAndPlanIdInContextTopic.customerType",options:{twoWay:!1,setOnBind:!0}}],config:{actions:{createOrUpdateOrder:function(){var a=this,b=this.get("installationAddressId");this.set("orderStatus","");var d=this.subViewModels.deviceIdAndPlanIdInContextTopic.get(),e=d.planId,f=d.packType,g=d.relationId,h=d.deviceId,i=(d.customerType,this.subViewModels.orderInContextTopicViewModel.get()),j=i.productOrderID,k=i.productOrderItemID;if(c.isUndefined(k)||c.isNull(k)){var l=i.currentOrderActions;if(l&&l.length>0)if(l.length>1){var m=c.filter(l,function(a){return"WS"===a.lob&&"S"===a.level});m&&m.length>0&&(k=m[0].productOrderItemID)}else 1===l.length&&(k=l[0].productOrderItemID)}var n=this.get("updateDevice"),o=this.get("dealerID"),p=this.get("vendorID");"undefined"!=typeof o&&null!==o&&this.subViewModels.newProductInOfferingInstanceViewModel.set("dealerID",o),"undefined"!=typeof p&&null!==p&&this.subViewModels.newProductInOfferingInstanceViewModel.set("vendorID",p);var q=this.get("easyMobilePlans");"undefined"!=typeof q&&null!==q&&this.subViewModels.newProductInOfferingInstanceViewModel.set("easyMobilePlans",q);var r=this.get("addonDetails");"undefined"!=typeof r&&null!==r&&this.subViewModels.newProductInOfferingInstanceViewModel.set("addonDetails",r);var s=this.get("installmentPayment")||this.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan")&&this.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration");s&&this.subViewModels.newProductInOfferingInstanceViewModel.set("installmentPayment",s);var t=this.get("addComponentList");if(t&&this.subViewModels.newProductInOfferingInstanceViewModel.set("addComponentList",t),f&&(this.subViewModels.newProductInOfferingInstanceViewModel.set("preTickAddonDetails",this.get("preTickAddonDetails")),this.subViewModels.newProductInOfferingInstanceViewModel.set("packType",f),i.orderActions)){var u=c.filter(i.orderActions,function(a){return"FV"===a.lob});u&&u.length>0&&a.set("isFvOrder",!0)}this.subViewModels.newProductInOfferingInstanceViewModel.set("flowType",this.get("flowType"));var v=this.get("pgInfo");"undefined"!=typeof v&&null!==v&&("undefined"!=typeof v.code&&null!==v.code||"undefined"!=typeof v.campaign&&null!==v.campaign||"undefined"!=typeof v.parentLine&&null!==v.parentLine)||(v=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo")),this.subViewModels.newProductInOfferingInstanceViewModel.set("pgInfo",v),n&&j&&k&&h?this.subViewModels.newProductInOfferingInstanceViewModel.updateOrder():e&&h&&g?this.subViewModels.newProductInOfferingInstanceViewModel.createOrder(!1):e&&g?this.subViewModels.newProductInOfferingInstanceViewModel.createOrder(!0,b):this.set("dataMissing","Manadatory parameters are missing"),this.subViewModels.getDmpCommerceViewModel.getPlanSelectionData()},setCISAndStaffDetails:function(){var a=this.get("cisDetails"),b=this.get("staffDetails");this.subViewModels.deviceIdAndPlanIdInContextTopic.set("staffDetails",b);var c="normal";if(a){c="cis";var d=a.cisRates;this.subViewModels.deviceIdAndPlanIdInContextTopic.set("cisRates",d),delete a.cisRates,this.subViewModels.deviceIdAndPlanIdInContextTopic.set("cisDetails",a)}else b&&(c="staff");this.subViewModels.deviceIdAndPlanIdInContextTopic.set("customerType",c)}}},initialize:function(a){this._super(a),c.bindAll(this,"_saveOrderData","orderFailure"),this.subViewModels.newProductInOfferingInstanceViewModel.on("dataSet",this._saveOrderData,this),this.subViewModels.newProductInOfferingInstanceViewModel.on("orderFailure",this.orderFailure,this),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectPayment",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("tempDeviceId",null),this.subViewModels.onePassTopicViewModel.on("change:nric",function(a){a&&this.set("userId",!0)}),setTimeout(function(){var a=this.subViewModels.orderInContextTopicViewModel.get(),b=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails");this.set("cisDetails",b);var c=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("staffDetails");this.set("staffDetails",c);var d=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");"undefined"!=typeof d&&null!==d||(d="normal"),this.set("customerType",d),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("customerType",d),this.set("orderActions",a.orderActions),this.set("currentOrderActions",a.currentOrderActions),this.set("vmStatus","initialized")}.bind(this),0)},_saveOrderData:function(){this.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1);var a=this.get("flowType"),b=this.subViewModels.miniCartInContextTopic.get("id");!a||"undefined"!=typeof b&&null!==b||this.subViewModels.miniCartInContextTopic.set("id",a);var d=this.get("isFvOrder");if(d)this.set("orderStatus","successWithFHBOrder");else if("FIBER"===a){var e=this.subViewModels.orderInContextTopicViewModel.get(),f=e.orderActions,g=c.filter(f,function(a){return"TV"===a.lob});g&&g.length>0?this.set("orderStatus","successWithTVOrder"):this.set("orderStatus","orderSuccesfull")}else this.set("orderStatus","orderSuccesfull")},orderFailure:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("orderStatus","orderFailure")}});return l});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplCustomerEligibilityTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel"],function (a,b,c,d,e){var f=c.extend({persistent:["catalogOfferEligibilityInfo","catalogItemEligibilityInfo","eligibilityCheckDone"],defaults:{catalogItemEligibilityInfo:null,catalogOfferEligibilityInfo:null,eligibilityCheckDone:null},initialize:function(){this._super(),this.on("change:eligibilityCheckDone",this.resetDetails,this)},resetDetails:function(){this.set("catalogOfferEligibilityInfo",null),this.set("catalogItemEligibilityInfo",null)},subViewModels:{customerInContextTopicViewModel:d,coreCustomerEligibilityTopicViewModel:e},dataBindings:[{catalogOfferEligibilityInfo:"subViewModels.coreCustomerEligibilityTopicViewModel.catalogOfferEligibilityInfo",options:{twoWay:!0,setOnBind:!0}},{catalogItemEligibilityInfo:"subViewModels.coreCustomerEligibilityTopicViewModel.catalogItemEligibilityInfo",options:{twoWay:!0,setOnBind:!0}},{eligibilityCheckDone:"subViewModels.coreCustomerEligibilityTopicViewModel.eligibilityCheckDone",options:{twoWay:!0,setOnBind:!0}}],handleDependencies:function(){this.subViewModels.customerInContextTopicViewModel.on("change:ID",a.bind(this.empty,this))}});return f});
define("businesswidget/repository_l9_common/common/viewmodel/business/TradeInViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f,g,h){return a.Core.ObservableViewModel.extend({models:{anonymousUpdateProductConfigurationModel:f,customerProductOrderItemProductConfigurationModel:g},subViewModels:{CustomerInContextTopicViewModel:d,OrderInContextTopicViewModel:e,deviceIdAndPlanIdInContextTopic:h},dataBindings:[{customerId:"subViewModels.OrderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{productOrderID:"subViewModels.OrderInContextTopicViewModel.productOrderItemID",options:{twoWay:!1,setOnBind:!0}}],defaults:{tradeInDetails:null,tradeInVmStatus:""},initialize:function(a){this._super(a),b.bindAll(this,"setHeaders","setDefaultQueryParams","saveTradeInDetails","onUpdateProductConfigurationError","onUpdateProductConfigurationSuccess","removeTradeInDetails","onremoveTradeInSuccess","onFailure")},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},saveTradeInDetails:function(a){var c=this,d=$.Deferred(),e=c.get("tradeInDetails")||a,f={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"SD Add Comp Stage",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedSimpleProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[{productSpecContainmentID:11952,temporaryID:"c"+Math.random().toString(36).substr(2,9),changedCharacteristics:[{characteristicID:8035352,value:"Available"},{characteristicID:13142,value:"Available"},{characteristicID:13162,value:"Available"},{characteristicID:13182,value:"Available"},{characteristicID:13152,value:"Available"},{characteristicID:13132,value:"Available"},{characteristicID:8852,value:e.deviceName},{characteristicID:8842,value:e.brand}],parentProductSpecContainmentID:8363682}],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[],removedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},g=c.get("customerId");if("undefined"==typeof g||null===g){var h=c.getModel("anonymousUpdateProductConfigurationModel");h.set({productOrderItemId:c.get("productOrderID")}),c.setHeaders(h),c.setDefaultQueryParams(h),h.setQueryParams({rp:!1,rpc:!1}),h.save(f,{success:b.bind(c.onUpdateProductConfigurationSuccess,c,d),error:b.bind(c.onUpdateProductConfigurationError,c,d)})}else{var h=c.getModel("customerProductOrderItemProductConfigurationModel");h.set({customerId:g,productOrderItemId:e.tradeInOrderItemId}),h.setQueryParams({rp:!1,rpc:!1}),h.set("RetrieveProductInOrderConfigurationRequest",f),c.setHeaders(h),c.setDefaultQueryParams(h),h.save(f,{success:b.bind(c.onUpdateProductConfigurationSuccess,c,d),error:b.bind(c.onUpdateProductConfigurationError,c,d)})}return d},onUpdateProductConfigurationError:function(a,b,c){var d=this;d.set("tradeInVmStatus","failure"),a.reject("failure")},onUpdateProductConfigurationSuccess:function(a,b,c){var d=c.UpdateProductInOrderConfigurationResponse;if(void 0!==typeof d){if(d.productConfiguration&&"BLOCKING"===d.productConfiguration.compatibilityStatus)return this.set("tradeInVmStatus","failure"),a.reject("failure"),!1;this.subViewModels.deviceIdAndPlanIdInContextTopic.set("tradeInFlag",!0),this.set("tradeInVmStatus","success"),a.resolve("success")}},removeTradeInDetails:function(a){var c=this;c.set("tradeInVmStatus","removing");var d=$.Deferred(),e=c.get("tradeInDetails")||a,f={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedSimpleProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[],removedContainedProducts:[{productID:e.productID}]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},g=c.get("customerId");if("undefined"==typeof g||null===g){var h=c.getModel("anonymousUpdateProductConfigurationModel");h.set({productOrderItemId:c.get("productOrderID")||e.productOrderItemID}),c.setHeaders(h),c.setDefaultQueryParams(h),h.setQueryParams({rp:!1,rpc:!1}),h.save(f,{success:b.bind(c.onremoveTradeInSuccess,c,d),error:b.bind(c.onFailure,c,d)})}else{var h=c.getModel("customerProductOrderItemProductConfigurationModel");h.set({customerId:g,productOrderItemId:c.get("productOrderID")||e.productOrderItemID}),h.setQueryParams({rp:!1,rpc:!1}),h.set("RetrieveProductInOrderConfigurationRequest",f),c.setHeaders(h),c.setDefaultQueryParams(h),h.save(f,{success:b.bind(c.onremoveTradeInSuccess,c,d),error:b.bind(c.onFailure,c,d)})}return d},onremoveTradeInSuccess:function(a,b,c){this.subViewModels.deviceIdAndPlanIdInContextTopic.set("tradeInFlag",!1),this.set("tradeInVmStatus","success"),a.resolve("success")},onFailure:function(a,b,c){this.set("tradeInVmStatus","failure"),a.reject("failure")}})});
define("businesswidget/repository_l9_common/common/model/UpdateOrderWithVouchersModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/contact-person/:contactId/order/:orderIdReference/voucher-update-order",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplUpdateOrderWithVoucherRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/SearchCartOrderModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return a.Core.RESTModel.extend({options:{url:"/ordering/searchOrder",rest:{defaults:{method:"POST"},create:{contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},payload:["ImplSearchOrderRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/ReserveAllocateMTPOSEquipmentsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/pos/reserveOrAllocateEquipment",rest:{create:{contentType:"application/json",method:"POST",payload:["ImplReserveOrAllocateEquipmentRestInput"],qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/StockAvailabilityViewModel",["knockout","lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/DeviceDetails_CheckEquipmentAvailableModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f){var g=b.Core.ObservableViewModel.extend({defaults:{itemsCodes:[],stockAvailabilityVmStatus:"",availableStocks:[]},models:{deviceDetailsCheckEquipmentAvailableModel:e},subViewModels:{deviceIdAndPlanIdInContextTopic:f},initialize:function(){d.bindAll(this,"getAvailableItemsList","onGetAvailableItemsListGSuccess","onGetAvailableItemsListError","_findItemAvailability"),setTimeout(function(){this.set("stockAvailabilityVmStatus","initialized")}.bind(this),0)},getAvailableItemsList:function(a){var c=$.Deferred(),e=this,f=this.getModel("deviceDetailsCheckEquipmentAvailableModel"),g={sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")};a&&(g.storeIdPickUp=a),f.setQueryParams(g);var h=this.get("itemsCodes");return h=d.uniq(d.pluck(h,"sku")).join("_"),this.set("stockAvailabilityVmStatus","inprogress"),f.fetch({itemsCode:h,success:d.bind(this.onGetAvailableItemsListGSuccess,this,c),error:function(a){return function(b){e.set("stockAvailabilityVmStatus","failure"),a.reject("failure")}}(c)}),c},onGetAvailableItemsListGSuccess:function(a,b,c){var e=this,f=[{key:"PU",value:"Available"},{key:"PO",value:"Available"},{key:"BO",value:"Available"},{key:"NA",value:"Not available"},{key:"AL",value:"Available"}],g=c.ImplCheckEquipmentAvailablityOutput.itemAvailability||[];g&&g.length>0&&d.each(g,function(a){var b=d.find(f,function(b){return b.key===a.status});b.value&&(a.status=b.value)});var h=[],i=e.get("itemsCodes");i=d.uniq(i,function(a,b,c){return a.sku}),d.each(i,function(a){var b=d.find(g,function(b){return b.itemCode===a.sku});b?a.lowerLimit>0&&a.upperLimit>0&&(b=e._findItemAvailability(a,b)):b={itemCode:a.sku,status:"Not available"},h.push(b)}),e.set("availableStocks",h),e.set("stockAvailabilityVmStatus","ready"),a.resolve("Success")},onGetAvailableItemsListError:function(a,b){this.set("stockAvailabilityVmStatus","failure")},_findItemAvailability:function(a,b){return b.availableQty<a.lowerLimit?b.status="Not available":b.availableQty>=a.lowerLimit&&b.availableQty<a.upperLimit?b.status="Selling Fast":b.status="Available",b}});return g});
define("businesswidget/repository_l9_common/common/viewmodel/business/StoreAvailabilityDetailsViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/StockAvailabilityViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{},subViewModels:{deviceIdAndPlanIdInContextTopic:d,orderInContextTopicViewModel:e,stockAvailabilityViewModel:f,updateProductConfigurationCustomizedViewModel:g},dataBindings:[{orderId:"subViewModels.orderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}}],defaults:{storeAvailabilityVmStatus:null,orderId:null,notAvailableDeviceDetails:[],removedItemDetails:[]},initialize:function(a){c.bindAll(this,"checkStockAvailability","checkStoreAvailability","handleStockUnavailableItems","createActionObject","addToActionList"),this.set("storeAvailabilityVmStatus","vmInitialized")},checkStockAvailability:function(a,b,d,e){var f=this,g=$.Deferred();if(a&&a.length>0){var h=[],i=c.groupBy(a,"sku");c.map(i,function(a,b){if(a&&a.length>0){var c=a[0];h.push({sku:c.sku,groupId:c.groupId,lowerLimit:a.length,upperLimit:a.length+1})}});var j=f.subViewModels.stockAvailabilityViewModel,k=c.uniq(h,"sku");j.set("itemsCodes",k);var l=j.getAvailableItemsList();l.done(function(h){if("Success"===h){var i=j.get("availableStocks"),l=[];if(c.each(i,function(a){"Not available"===a.status&&l.push(a.itemCode)}),l&&l.length>0){var m=[];c.each(a,function(a){c.contains(l,a.sku)&&m.push(a)}),f.set("notAvailableDeviceDetails",m),f.checkStoreAvailability(k,g,b,d,e)}else g.resolve("success")}else g.resolve("restFailed")}.bind(f)),l.fail(function(a){g.resolve("restFailed")}.bind(f))}else g.resolve("success");return g},checkStoreAvailability:function(a,b,d,e,f){b||(b=$.Deferred());var g=[];c.each(a,function(a){a.groupId&&!c.contains(g,a.groupId)&&g.push(a.groupId)});var h=new XMLHttpRequest,i="/bin/services/singtel/getEshopStockData.:groupId="+g.join("_")+".json",j=this;return h.open("GET",encodeURI(i)),h.setRequestHeader("Content-Type","application/json"),h.onload=function(){if(200===h.status){var g=JSON.parse(h.responseText);if(g&&g.length>0){var i=!0,k=[];c.each(a,function(a){c.each(g,function(b){var d=[];a.groupId===b.groupId&&c.each(b.items,function(b){a.sku===b.skuId&&c.each(b.data,function(b){"Available"===b.stock_status,a.lowerLimit<=b.available_quantity&&(d.push(b.store_id),i&&k.push(b.store_id))})}),i=!1,k=c.intersection(k,d)})}),k.length>0?j.handleStockUnavailableItems(b,d,e,f):b.resolve("failure")}else b.resolve("failure")}else b.resolve("failure")},h.send(),b},createActionObject:function(a,b,c){var d={productOrderItemId:c,returnFullUpcResponse:!1,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:[],newContainedProducts:[],removedContainedProducts:[{productID:b}],suspendedContainedProducts:[]}};a.push(d)},addToActionList:function(a,b,d){if(a.length>0){var e=c.find(a,function(a){if(a.productOrderItemId===b){var c=a.productConfigurationChanges.removedContainedProducts||[];return c.push({productID:d}),a.productConfigurationChanges.removedContainedProducts=c,!0}});e||this.createActionObject(a,d,b)}else this.createActionObject(a,d,b)},isKeepFreeGift:function(){var a=window.location.href,b=!1;return a.indexOf("/personal/products-services/login-guest-checkout")===-1&&a.indexOf("/personal/products-services/shopping-cart")===-1||(b=!0),b},handleStockUnavailableItems:function(a,b,d,e){var f=[],g=[],h=this;if(b&&b.length>0&&c.each(b,function(a){h.addToActionList(f,a.productOrderItemID,a.productID),c.contains(g,a.name)||g.push(a.name)}),this.isKeepFreeGift()&&(f=[]),d&&d.length>0&&c.each(d,function(a){h.addToActionList(f,a.productOrderItemID,a.productID),c.contains(g,a.name)||g.push(a.name)}),e&&e.length>0&&c.each(e,function(a){h.addToActionList(f,a.productOrderItemID,a.productID);var b="Trade-in of "+a.tradeInName;c.contains(g,b)||g.push(b)}),f.length>0){var i=h.subViewModels.updateProductConfigurationCustomizedViewModel,j=i._updateProductConfigurationCustomized(f,!0,"SDRulesForCheckout");j.done(function(b,d){if("updateSuccess"===b){var e=d.ImplUpdateOrderProductsResponse,f=!1;if(e&&e.implUpdateOrderProductList){var i=e.implUpdateOrderProductList;i&&i.length>0&&c.each(i,function(a){if(!a.isSuccess){var b=a.ruleExecutionMessages;c.find(b,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return f=!0,!0}})}})}f?a.resolve("failure"):(h.set("removedItemDetails",g),h.subViewModels.deviceIdAndPlanIdInContextTopic.set("isStoreScenario",!0),a.resolve("success"))}}.bind(h)),j.fail(function(b){a.resolve("failure")}.bind(h))}else this.isKeepFreeGift()&&h.set("removedItemDetails",g),h.subViewModels.deviceIdAndPlanIdInContextTopic.set("isStoreScenario",!0),a.resolve("success")}});return h});
define("businesswidget/repository_l9_common/common/viewmodel/business/ReserveAllocateMTPOSEquipmentsViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/ReserveAllocateMTPOSEquipmentsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/StockAvailabilityViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/StoreAvailabilityDetailsViewModel"],function (a,b,c,d,e,f,g,h){var i=a.Core.ObservableViewModel.extend({models:{reserveAllocateEquipmentsModel:c},subViewModels:{customerInContextTopicViewModel:d,orderInContextTopicViewModel:e,deviceIdAndPlanIdInContextTopic:f,stockAvailabilityViewModel:g,storeAvailabilityDetailsViewModel:h},dataBindings:[],defaults:{reserveEquipmentVmStatus:"",selectedDevicesSkuIds:null,selectedStoreId:null,reserveDevices:null,shoppingCartMobileData:null,selectedFreebiesSkuIds:null,selectedAccessoriesSkuIds:null,tradeInDetails:null,removedItemDetails:[]},initialize:function(){b.bindAll(this,"_reserveEquipment","_reserveSelectedDeviceInStore","setSelectedDevices","handleReservation","_reserveSimInStore"),this.set("reserveEquipmentVmStatus","initializing")},setSelectedDevices:function(a){a&&this.set("selectedDevicesSkuIds",a)},_reserveEquipment:function(){var a=this,c=a.get("selectedDevicesSkuIds"),d=a.get("selectedFreebiesSkuIds"),e=a.get("selectedAccessoriesSkuIds"),f=a.get("tradeInDetails"),g=a.subViewModels.orderInContextTopicViewModel.get(),h=[],i=$.Deferred();if(c&&c.length>0||d&&d.length>0||e&&e.length>0){if(c&&c.length>0){var j=b.groupBy(c,"sku");b.map(j,function(a,b){if(a&&a.length>0){var c=a[0];h.push({sku:c.sku,lowerLimit:a.length,upperLimit:a.length+1})}})}if(d&&d.length>0){var k=b.groupBy(d,"skuId");b.map(k,function(a,b){if(a&&a.length>0){var c=a[0];h.push({sku:c.skuId,lowerLimit:a.length,upperLimit:a.length+1})}})}if(e&&e.length>0){var l=b.groupBy(e,"skuId");b.map(l,function(a,b){if(a&&a.length>0){var c=a[0];h.push({sku:c.skuId,lowerLimit:a.length,upperLimit:a.length+1})}})}if(h.length>0){var m=a.subViewModels.stockAvailabilityViewModel,n=b.uniq(h,"sku");m.set("itemsCodes",n);var o=m.getAvailableItemsList();o.done(function(h){if("Success"===h){var j=[],k=[],l=[],n=[],o=[],p=[],q=[],r=m.get("availableStocks");if(r&&r.length>0&&b.each(r,function(a){c&&c.length>0&&b.each(c,function(b){b.sku===a.itemCode&&("Not available"!=a.status?j.push(b):(b.size&&(b.title=b.title+" "+b.size),(b.color||b.colour)&&(b.title=b.title+" "+(b.color||b.colour)),k.push(b)))}),d&&d.length>0&&b.each(d,function(b){b.skuId===a.itemCode&&("Not available"!=a.status?l.push(b):n.push(b))}),e&&e.length>0&&b.each(e,function(b){b.skuId===a.itemCode&&("Not available"!=a.status?o.push(b):p.push(b))})}),k&&k.length>0){var s=[];if(c&&c.length>0){var t=b.groupBy(c,"sku");b.map(t,function(a,b){if(a&&a.length>0){var c=a[0];s.push({sku:c.sku,lowerLimit:a.length,upperLimit:a.length+1,groupId:c.groupId})}})}var u=b.uniq(s,"sku");a.subViewModels.deviceIdAndPlanIdInContextTopic.set("isStoreScenario",!1);var v=a.subViewModels.storeAvailabilityDetailsViewModel.checkStoreAvailability(u,null,d,e,f);v.done(function(b){if("failure"===b||"restFailed"===b){var c={notAvailableDeviceDetails:k};i.resolve(c)}else{var d=a.subViewModels.storeAvailabilityDetailsViewModel.get("removedItemDetails");d&&d.length>0&&a.set("removedItemDetails",d),i.resolve("success")}}.bind(a))}else if(p&&p.length>0){var w={notAvailableAccessoriesDetails:p,notAvailableFreebiesDetails:n};i.resolve(w)}else if(j&&j.length>0||l&&l.length>0||o&&o.length>0){var x=[];if(j&&j.length>0){var t=b.groupBy(j,"sku");b.map(t,function(a,c){var d=a[0];x.push({itemCodeX9:d.sku,qtyX9:a.length,reservationState:"PEND"}),b.each(a,function(a){q.push({itemCodeX9:a.sku,orderActionIDX9:a.productOrderItemID,storeID:"D2519",id:"Device"})})})}if(l&&l.length>0&&b.each(l,function(a,b){x.push({itemCodeX9:a.skuId,qtyX9:1,reservationState:"PEND"}),q.push({itemCodeX9:a.skuId,orderActionIDX9:a.productOrderItemID,storeID:"D2519",id:"Freebie"})}),o&&o.length>0){var y=b.groupBy(o,"skuId");b.map(y,function(a,c){var d=a[0];x.push({itemCodeX9:d.skuId,qtyX9:a.length,reservationState:"PEND"}),b.each(a,function(a){q.push({itemCodeX9:a.skuId,orderActionIDX9:a.productOrderItemID,
storeID:"D2519",id:"Accessory"})})})}if(x.length>0){var z=(a.subViewModels.deviceIdAndPlanIdInContextTopic.get("warehouseId"),a.getModel("reserveAllocateEquipmentsModel")),A={ImplReserveOrAllocateEquipmentRestInput:{allocationInfoX9:{itemInfoX9:x,extOrderIDX9:g.productOrderID,channelX9:"O",storeIDOrderX9:0,cfuX9:"C",vipIndX9:!1}}};z.save(A,{success:b.bind(a.onReserveEquipment,a,i,k,n,q,p),error:function(a){return function(b){a.reject(b)}}(i)})}else i.resolve("success")}}}.bind(a)),o.fail(function(a){i.reject(a)}.bind(a))}else a.subViewModels.deviceIdAndPlanIdInContextTopic.set("allocationIDs",null),i.resolve("success")}else a.subViewModels.deviceIdAndPlanIdInContextTopic.set("allocationIDs",null),i.resolve("success");return i},onReserveEquipment:function(a,c,d,e,f,g,h){var i=h.ImplReserveOrAllocateEquipmentRestOutput;if(i&&i.allocationStatusX9){var j=[];this.set("reserveEquipmentVmStatus","reserved");var k=[],l=[];b.each(i.allocationStatusX9,function(a){a.allocationOKX9?(k.push(a.allocationIDX9),b.contains(l,a.itemCodeX9)||b.each(e,function(b){b.itemCodeX9===a.itemCodeX9&&(l.push(b.itemCodeX9),b.reservationId=a.allocationIDX9,j.push(b))})):b.filter(e,function(e){if(e.itemCodeX9===a.itemCodeX9)if("Device"===e.id){var g=self.get("selectedDevicesSkuIds");b.each(g,function(a){a.sku===e.itemCodeX9&&(a.size&&(a.title=a.title+" "+a.size),(a.color||a.colour)&&(a.title=a.title+" "+(a.color||a.colour)),c.push(a))})}else if("Freebie"===e.id){var h=self.get("selectedFreebiesSkuIds");b.each(h,function(a){a.sku===e.itemCodeX9&&d.push(a)})}else if("Accessory"===e.id){var i=self.get("selectedAccessoriesSkuIds");b.each(i,function(a){a.sku===e.itemCodeX9&&f.push(a)})}})}),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("allocationIDs",k),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("deviceResDetails",j),sessionStorage.setItem("lastActivity",new Date)}i.selectedDevicesSkuIds=this.get("selectedDevicesSkuIds"),i.selectedAccessoriesSkuIds=this.get("selectedAccessoriesSkuIds"),i.notAvailableDeviceDetails=c,i.notAvailableFreebiesDetails=d,i.notAvailableAccessoriesDetails=f,a.resolve(i)},_reserveSelectedDeviceInStore:function(){var a=this,c=$.Deferred(),d=a.subViewModels.orderInContextTopicViewModel.get(),e=a.get("selectedDevicesSkuIds"),f=a.get("selectedFreebiesSkuIds"),g=a.get("selectedAccessoriesSkuIds"),h=a.get("shoppingCartMobileData"),i=[];if(e&&e.length>0){var j=b.groupBy(e,"sku");b.map(j,function(a,b){if(a&&a.length>0){var c=a[0];i.push({sku:c.sku,lowerLimit:a.length,upperLimit:a.length+1})}})}if(f&&f.length>0){var k=b.groupBy(f,"skuId");b.map(k,function(a,b){if(a&&a.length>0){var c=a[0];i.push({sku:c.skuId,lowerLimit:a.length,upperLimit:a.length+1})}})}if(g&&g.length>0){var l=b.groupBy(g,"skuId");b.map(l,function(a,b){if(a&&a.length>0){var c=a[0];i.push({sku:c.skuId,lowerLimit:a.length,upperLimit:a.length+1})}})}if(i.length>0){var m=a.subViewModels.stockAvailabilityViewModel,n=b.uniq(i,"sku");m.set("itemsCodes",n);var o=m.getAvailableItemsList(a.get("selectedStoreId"));o.done(function(i){if("Success"===i){var j=[],k=[],l=[],n=[],o=[],p=[],q=m.get("availableStocks");if(q&&q.length>0&&b.each(q,function(a){e&&e.length>0&&b.each(e,function(b){b.sku===a.itemCode&&("Not available"!=a.status?j.push(b):k.push(b))}),f&&f.length>0&&b.each(f,function(b){b.skuId===a.itemCode&&("Not available"!=a.status?l.push(b):n.push(b))}),g&&g.length>0&&b.each(g,function(b){b.skuId===a.itemCode&&("Not available"!=a.status?o.push(b):p.push(b))})}),(k&&k.length>0||p&&p.length>0)&&c.reject("stockNotAvailable"),j&&j.length>0){var r=[],s=[],t=b.groupBy(j,"sku");if(b.map(t,function(c,d){if(c){var e=(c[0],c.length);r.push({itemCodeX9:d,qtyX9:e,reservationState:"PEND"}),b.each(c,function(b){s.push({itemCodeX9:b.sku,orderActionIDX9:b.productOrderItemID,storeID:a.get("selectedStoreId"),id:"Device"})})}}),l&&l.length>0){var u=b.groupBy(l,"skuId");b.map(u,function(c,d){if(c){var e=(c[0],c.length);r.push({itemCodeX9:d,qtyX9:e,reservationState:"PEND"}),b.each(c,function(b){s.push({itemCodeX9:b.skuId,orderActionIDX9:b.productOrderItemID,storeID:a.get("selectedStoreId"),id:"Freebie"})})}})}if(o&&o.length>0){var v=b.groupBy(o,"skuId");b.map(v,function(c,d){var e=c[0];r.push({itemCodeX9:e.skuId,qtyX9:c.length,reservationState:"PEND"}),b.each(c,function(b){s.push({itemCodeX9:b.skuId,orderActionIDX9:b.productOrderItemID,storeID:a.get("selectedStoreId"),id:"Accessory"})})})}h&&h.length>0&&r.push({itemCodeX9:"381187130N",qtyX9:h.length,reservationState:"PEND"}),r.length>0?a.handleReservation(r,d,c,s,k,n,p):(a.subViewModels.deviceIdAndPlanIdInContextTopic.set("reservationIDs",null),c.resolve("success"))}else a.subViewModels.deviceIdAndPlanIdInContextTopic.set("reservationIDs",null),c.resolve("success")}}),o.fail(function(a){c.reject(a)}.bind(a))}else this.subViewModels.deviceIdAndPlanIdInContextTopic.set("reservationIDs",null),c.resolve("success");return c},_reserveSimInStore:function(){var a=this,c=$.Deferred(),d=a.subViewModels.orderInContextTopicViewModel.get(),e=a.get("shoppingCartMobileData"),f=[],g=[];return e&&e.length>0?(f.push({itemCodeX9:"381187130N",qtyX9:e.length,reservationState:"PEND"}),b.each(e,function(b){g.push({itemCodeX9:"381187130N",orderActionIDX9:b.productOrderItemID,storeID:a.get("selectedStoreId"),id:"Sim"})}),c=a.handleReservation(f,d,c,g)):c.resolve("success"),c},handleReservation:function(a,c,d,e,f,g,h){var i=this,j=i.getModel("reserveAllocateEquipmentsModel"),k={ImplReserveOrAllocateEquipmentRestInput:{reservationInfoX9:{itemInfoX9:a,orderIDX9:c.productOrderID,customerIDX9:c.customerID,channelX9:"O",storeIDOrderX9:"D2519",storeIDPickupX9:i.get("selectedStoreId"),vipIndX9:!1}}};return j.save(k,{success:b.bind(i.onReserveSelectedDevice,i,d,e,f,g,h),error:function(a){return function(b){a.reject(b)}}(d)}),d},onReserveSelectedDevice:function(a,c,d,e,f,g,h){var i=h.ImplReserveOrAllocateEquipmentRestOutput;if(i&&i.reservationStatusX9){var j,k=[],l=[],m=[];b.each(i.reservationStatusX9,function(a){a.reservationOKX9&&("381187130N"===a.itemCodeX9&&(j=a.reservationIDX9),k.push(a.reservationIDX9),b.contains(l,a.itemCodeX9)||b.each(c,function(b){b.itemCodeX9===a.itemCodeX9&&(l.push(b.itemCodeX9),b.reservationId=a.reservationIDX9,m.push(b))}))}),j&&b.each(m,function(a){a.simReservationId=j}),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("reservationIDs",k),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("deviceResDetails",m)}i.selectedDevicesSkuIds=this.get("selectedDevicesSkuIds"),i.notAvailableDeviceDetails=d,i.notAvailableFreebiesDetails=e,i.notAvailableAccessoriesDetails=f,a.resolve(i)}});return i});
define("businesswidget/repository_l9_common/common/model/ValidateOrderVouchersModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/contact-person/:contactId/order/:orderId/validate-order-vouchers",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplValidateOrderVouchersRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/UpdateOrderActionCharacteristicsRequestModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/contact-person/:contactId/order/:orderId/update-characteristics",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplUpdateOrderActionCharacteristicsRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/UpdateOrderActionAttributesModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/ecommerce/customer/:customerId/order/:orderId/update-order-action-attributes",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"POST",payload:["ImplUpdateOrderDetailRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/UpdateOrderActionAttributesAnonymousModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/ecommerce/anonymous/order/:orderId/update-order-action-attributes",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"POST",payload:["ImplUpdateOrderDetailRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/UpdateOrderActionAttributesViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateOrderActionAttributesModel","businesswidget/repository_l9_common/common/model/UpdateOrderActionAttributesAnonymousModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"],function (a,b,c,d,e,f,g,h){return a.Core.ObservableViewModel.extend({models:{customerUPAModel:e,anonymousUPAModel:f},subViewModels:{orderInContextTopicViewModel:d,getCustomerIdValueViewModel:g,onePassTopicViewModel:h},defaults:{upaStatus:""},initialize:function(a){b.bindAll(this,"_updateOrderCustomized","setHeaders","setDefaultQueryParams","onCustomizedUpdateSuccess","onCustomizedUpdateFailure","updateCollectNowAttributes")},_updateOrderCustomized:function(a){var c=this;c.set("upaStatus","Start Processing");var d=c.subViewModels.orderInContextTopicViewModel.get(),e=$.Deferred(),f=c.subViewModels.onePassTopicViewModel.get(),g=[];if(a&&a.length>0&&b.each(a,function(a){b.each(a.productOrderItemIDs,function(e){var h=b.find(d.orderActions,function(a){return a.productOrderItemID===e});if(h){var i=c.subViewModels.getCustomerIdValueViewModel.getPromoObject(a.planCode,a.deviceBrandName,a.deviceModelName,a.transactionType,a.ciTier,a.customerType,a.subSegment,a.selectedAddonIds,a.coupon,a.pickAndGo,f.nric,f.customerIdType);i&&i.length>0&&g.push({orderActionId:h.productOrderItemID,orderActionType:"Change"===h.orderType?"CH":"PR",attributes:i})}})}),g.length>0){var h,i=d.customerID;i?(h=c.getModel("customerUPAModel"),h.set({customerId:i})):h=c.getModel("anonymousUPAModel");var j={ImplUpdateOrderDetailRequest:{orderActionData:g}};h.set({orderId:d.productOrderID}),c.setHeaders(h),c.setDefaultQueryParams(h),h.save(j,{success:b.bind(c.onCustomizedUpdateSuccess,c,e,a),error:b.bind(c.onCustomizedUpdateFailure,c,e)})}else e.resolve("success");return e},updateCollectNowAttributes:function(a){var c=this;c.set("upaStatus","Start Processing");var d=c.subViewModels.orderInContextTopicViewModel.get(),e=$.Deferred(),f=(c.subViewModels.onePassTopicViewModel.get(),[]);b.each(a,function(a){var c=b.find(d.orderActions,function(b){return b.productOrderItemID===a.productOrderItemID});f.push({orderActionId:c.productOrderItemID,orderActionType:"Change"===c.orderType?"CH":"PR",attributes:a.dynamicAttributList})});var g=c.getModel("customerUPAModel"),d=c.subViewModels.orderInContextTopicViewModel.get(),h=d.customerID;h?(g=c.getModel("customerUPAModel"),g.set({customerId:h})):g=c.getModel("anonymousUPAModel");var i={ImplUpdateOrderDetailRequest:{orderActionData:f}};return g.set({orderId:d.productOrderID}),c.setHeaders(g),c.setDefaultQueryParams(g),g.save(i).then(function(a){e.resolve()},function(){e.reject()}),e},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:c.get("salesChannel")||d.sc})},onCustomizedUpdateSuccess:function(a,c,d,e){var f=this,g=f.subViewModels.orderInContextTopicViewModel.get("promoOrderActions")||[];b.each(c,function(a){b.each(a.productOrderItemIDs,function(a){b.contains(g,a)||g.push(a)})}),f.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",g),this.set("upaStatus","updateSuccess"),a.resolve("success")},onCustomizedUpdateFailure:function(a,b,c){this.set("upaStatus","updateFailure"),a.resolve("failure")}})});
define("businesswidget/repository_l9_common/common/model/IsUploadDocumentNeededModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/document/upload/needed/contact-person/:contactId/order/:orderId",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplIsUploadDocumentNeededResInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetFulfillmentDetailsViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","businesswidget/repository_l9_common/common/model/IsUploadDocumentNeededModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository/common/model/CommerceCustomerProductOrderPayChannelModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateOrderDeliveryAddressModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.Core.ObservableViewModel.extend({models:{isUploadDocumentNeededModel:h,billSpecIdPayChannelModel:k,productOrderPayChannelModel:m,updateOrderDeliveryAddressModel:o},subViewModels:{deviceIdAndPlanIdInContextTopic:d,orderInContextTopicViewModel:e,onePassTopicViewModel:f,getCustomerIdValueViewModel:g,individualInContextTopicViewModel:i,shoppingCartViewModel:j,clearContextInContextTopic:l,implUserContextTopicViewModel:n,updateProductConfigurationCustomizedViewModel:p,logisticsDispatchAppointmetSlotViewModel:q},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{orderId:"subViewModels.orderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}}],defaults:{fulfillmentDetailsVmStatus:null,isFulFillmentRequired:!1,contactId:null,orderId:null,broadbandInstallationIds:null,selectedBar:null,needsOnlyMBBDelivery:!1},initialize:function(a){c.bindAll(this,"checkIfUploadDocumentNeeded","checkIfDeliveryRequired","checkIfInstallationRequired","checkIfNewBARequired","checkIfFulFillmentRequired","_findMatchingServiceId","loadAddressForRecontract","updateProductOrderPayChannel","getBillSpecIdPayChannel","updateOrderSummaryRules","updateOrderDeliveryAddress","getBillSpecDetails"),this.set("fulfillmentDetailsVmStatus","vmInitialized")},checkIfFulFillmentRequired:function(a){var b=this,d=$.Deferred(),e=this.subViewModels.orderInContextTopicViewModel.get("orderActions"),f=[];if(c.each(e,function(a){"Change"===a.orderType&&f.push(a.productOrderItemID)}),f.length>0){var g=b.checkIfNewBARequired(a,f);if(g)b.set("isFulFillmentRequired",!0),d.resolve("success");else{var h=b.checkIfInstallationRequired();if(h)b.set("isFulFillmentRequired",!0),d.resolve("success");else{var i=b.checkIfDeliveryRequired();i?(b.set("isFulFillmentRequired",!0),d.resolve("success")):b.checkIfUploadDocumentNeeded(d)}}}else b.set("isFulFillmentRequired",!0),d.resolve("success");return d},checkIfNewBARequired:function(a,b){var d=this,e=d.subViewModels.shoppingCartViewModel.get("barId"),f=!1;if("undefined"==typeof e||null===e){var g=d.subViewModels.shoppingCartViewModel.getValueByPath("cartPurchaseDetails.isEasyMobileOrder"),h=d.subViewModels.orderInContextTopicViewModel.get("customerID");if(a=g?c.filter(a,function(a){return!!(a.subscribers&&a.subscribers.length>0)&&("T"!==a.baStatus&&(("Y"===a.easyMobileInd||"y"===a.easyMobileInd)&&(!h||String(a.customerId)===h)))}):c.filter(a,function(a){return!!(a.subscribers&&a.subscribers.length>0)&&("T"!==a.baStatus&&(("N"===a.easyMobileInd||"n"===a.easyMobileInd)&&(!h||String(a.customerId)===h)))}),a&&a.length>0){var i=d.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order"),j=d.loadAddressForRecontract(a,i,b,g);j?(d.set("selectedBar",j),d.subViewModels.orderInContextTopicViewModel.set("barId",j.billingAccountNumber),f=!1):f=!0}else f=!0}else d.subViewModels.orderInContextTopicViewModel.set("barId",e),f=!1;return f},checkIfUploadDocumentNeeded:function(a){var b=this;b.set("fulfillmentDetailsVmStatus","UploadDocumentNeededStart");var d=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("hasCisStaff"),e=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("hasYouthSilverPlans"),f=!1,g=this.subViewModels.orderInContextTopicViewModel.get();if(d)f=!0;else if(e)f=!0;else{var h=c.find(g.orderActions,function(a){return"simOnlyPlan"===a.flowType&&"Provide"===a.orderType});h&&(f=!0)}if(f)b.set("isFulFillmentRequired",!0),a.resolve("success");else{var i=b.subViewModels.onePassTopicViewModel.get(),j=b.subViewModels.getCustomerIdValueViewModel.getDocumentType(i.customerIdType),k=!1,l={documentType:j,isHighEndDevice:k},m=this.getModel("isUploadDocumentNeededModel");m.set("contactId",this.subViewModels.individualInContextTopicViewModel.get("personId")),m.set("orderId",g.productOrderReferenceNumber),m.save({ImplIsUploadDocumentNeededResInput:l},{success:function(c,d){var e=d.ImplIsUploadDocumentNeededResOutput;e?(b.set("isFulFillmentRequired",e.answer),b.set("fulfillmentDetailsVmStatus","UploadDocumentNeededEnd"),a.resolve("success")):(b.set("fulfillmentDetailsVmStatus","UploadDocumentNeededError"),a.resolve("failure"))},error:function(c){b.set("fulfillmentDetailsVmStatus","UploadDocumentNeededError"),a.resolve("failure")}})}return a},checkIfDeliveryRequired:function(){var a,b=this,d=b.subViewModels.shoppingCartViewModel.get("selectedDevices"),e=b.subViewModels.shoppingCartViewModel.get("needsOnlyMBBDelivery");return e?(a=!1,b.set("needsOnlyMBBDelivery",e)):a=b.subViewModels.shoppingCartViewModel.get("hasSim")||d&&!c.isEmpty(d)||b.subViewModels.shoppingCartViewModel.getValueByPath("cartPurchaseDetails.hasPurchasedAccessories")||b.subViewModels.shoppingCartViewModel.getValueByPath("cartPurchaseDetails.hasPurchasedRG"),a},checkIfInstallationRequired:function(){var a=this,b=a.subViewModels.orderInContextTopicViewModel.get("orderActions"),d=a.subViewModels.orderInContextTopicViewModel.get("productOrderID"),e=!1,f=a.subViewModels.deviceIdAndPlanIdInContextTopic.set("blockOrderID");if(f&&f===d)e=!1;else if(c.each(b,function(a){"Change"===a.orderType||"undefined"!=typeof a.lob&&null!==a.lob&&"TV"!==a.lob&&"BB"!==a.lob||(e=!0)}),!e){var g=a.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order"),h=a.get("broadbandInstallationIds");if(g&&g.bundle&&g.bundle.length>0&&h&&h.length>0){var i=c.find(h,function(a){var b=a.split("_"),d=c.find(g.bundle,function(a){if(b&&a&&a.broadBandPlanDetails&&a.broadBandPlanDetails.serviceId&&c.contains(b,a.broadBandPlanDetails.serviceId))return!0});if(d)return!0});i&&(e=!0)}}return e},_findMatchingServiceId:function(a,b,d,e){var f=null;return d.mobile&&d.mobile.length>0&&c.each(d.mobile,function(d){var g=c.filter(e,function(a){return a===d.productOrderItemID});g&&g.length>0&&d.serviceId===b.subscriberResourceVal&&(f=a.billingAccountNumber)}),null===f&&d.tv&&d.tv.length>0&&c.each(d.tv,function(d){var g=c.filter(e,function(a){return a===d.productOrderItemID});g&&g.length>0&&d.subscriptionId===b.subscriberResourceVal&&(f=a.billingAccountNumber)}),null===f&&d.fv&&d.fv.length>0&&c.each(d.fv,function(d){var g=c.filter(e,function(a){return a===d.productOrderItemID});g&&g.length>0&&d.landlineNumber.details==="+65 "+b.subscriberResourceVal&&(f=a.billingAccountNumber)}),null===f&&d.bundle&&d.bundle.length>0&&c.each(d.bundle,function(d){var g=c.filter(e,function(a){return c.contains(d.productOrderItemIDs,a)});g&&g.length>0&&(d.subscriptionId===b.subscriberResourceVal||d.landlineNumber&&d.landlineNumber.details==="+65 "+b.subscriberResourceVal)&&(f=a.billingAccountNumber)}),f},loadAddressForRecontract:function(a,b,d,e){var f=this,g=null;return c.each(a,function(a){(a.dataEligible&&a.subscribers&&a.subscribers.length>0&&e&&"Y"===a.easyMobileInd.toUpperCase()||!e&&"N"===a.easyMobileInd.toUpperCase())&&c.each(a.subscribers,function(c){"undefined"!=typeof g&&null!==g||(g=f._findMatchingServiceId(a,c,b,d),g&&(g=a))})}),g},getBillSpecIdPayChannel:function(a){var b=this,c=$.Deferred(),d=b.get("needsOnlyMBBDelivery");if(d){var e=b.subViewModels.logisticsDispatchAppointmetSlotViewModel,f={slotType:"N",paymentMode:"CASH",dealerCode:"D2519",leadDays:1,documentRequired:!1};e.set("courierDetails",f);var g=e.onRetrieveAppointmentsSlots(),h=b.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order");g.done(function(d){if("SUCCESS"===d){var f=e.onReserveAppointmentSlots(h,!0);f.done(function(d){"SUCCESS"===d&&b.getBillSpecDetails(a,c)}.bind(b)),f.fail(function(a){b.set("fulfillmentDetailsVmStatus","failure"),c.reject("failure")}.bind(b))}else b.set("fulfillmentDetailsVmStatus","failure"),c.reject("failure")}.bind(b))}else b.getBillSpecDetails(a,c);return c},getBillSpecDetails:function(a,b){var c=this,d=c.subViewModels.orderInContextTopicViewModel.get("barId");if("undefined"!=typeof d&&null!==d){var e=c.getModel("billSpecIdPayChannelModel");e.set("customerBillSpecId",d),e.fetch({success:function(d,e){c.updateProductOrderPayChannel(e,b,a)},error:function(){c.set("fulfillmentDetailsVmStatus","failure"),b.reject("failure")}})}else c.set("fulfillmentDetailsVmStatus","failure"),b.reject("failure")},updateProductOrderPayChannel:function(a,b,d){var e=this;if(void 0!==typeof a&&null!==a){var f=e.subViewModels.orderInContextTopicViewModel.get("orderActions"),g=[];c.each(f,function(b){g.push({paymentCatergory:"POST",pcnId:a,productOrderItemId:b.productOrderItemID})});var h={PayChannelProductOrderDetails:{productOrderDetails:g}},i=e.getModel("productOrderPayChannelModel");i.save(h,{productOrderId:e.subViewModels.orderInContextTopicViewModel.get("productOrderID"),customerId:e.subViewModels.orderInContextTopicViewModel.get("customerID"),success:c.bind(e.updateOrderDeliveryAddress,e,f,b,d),error:function(){e.set("fulfillmentDetailsVmStatus","failure"),b.reject("failure")}})}else e.subViewModels.clearContextInContextTopic.clearAllTopics(!0),e.set("fulfillmentDetailsVmStatus","failure")},updateOrderDeliveryAddress:function(a,b,d){var e,f,g=this,h=g.subViewModels.implUserContextTopicViewModel.get("userInfo"),i="Not Applicable",j=g.get("needsOnlyMBBDelivery"),k=g.get("addressId"),l=!1;j&&(i="Courier To Home (Snail Mail)",e="sms-mail",f=g.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("reservePayload"),k=g.subViewModels.deviceIdAndPlanIdInContextTopic.get("installationAddressID"),l=!0),g.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedOption",e);var m=[],n={ImplUpdateOrderDeliveryAddressRestInput:{deliveryMethod:i,transactionType:"NEW_SIGN_UP",addressId:k,recipientDocumentType:g.subViewModels.onePassTopicViewModel.get("customerIdType"),recipientDocumentId:g.subViewModels.onePassTopicViewModel.get("nric"),recipientFirstName:h.contactDetails.firstName,recipientLastName:h.contactDetails.lastName,recipientPhone:d.contactNumber,recipientEmail:d.email,shippingInstructions:"shippingInstructions",newSIMList:m,documentRequired:!1,isSnailMail:l}},o=g.getModel("updateOrderDeliveryAddressModel");j&&void 0!==f&&""!==f&&(n.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:f.slotStartDate,slotEndDate:f.slotStartDate,slotCode:f.slotCode,timeDescription:f.timeDescription},f.slotId&&f.outletCode&&(n.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.slotId=f.slotId,n.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.popStationCode=f.outletCode),o.setQueryParams({isExpressCheckout:!0})),o.save(n,{customerId:g.subViewModels.orderInContextTopicViewModel.get("customerID"),orderId:g.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),success:c.bind(g.updateOrderSummaryRules,g,a,b,d),error:function(){g.set("fulfillmentDetailsVmStatus","failure"),b.reject("failure")}})},updateOrderSummaryRules:function(a,b,d){var e=this,f=[],a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),g="Not Applicable",h=e.subViewModels.shoppingCartViewModel.get("gamerVasChanges");a&&a.length>0&&c.each(a,function(a){var b=[];if(g&&"WS"!==a.lob&&"S"===a.level?b.push({productID:a.productID,changedCharacteristics:[{characteristicID:8710102,value:g}]}):b.push({productID:a.productID}),h&&h.productOrderItemID===a.productOrderItemID&&d.email){e.get("deliveryDetails");b.push({productID:h.productID,changedCharacteristics:[{characteristicID:h.characteristicID,value:d.email}]})}var c={productOrderItemId:a.productOrderItemID,returnFullUpcResponse:!1,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:b,newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}};f.push(c)});var i=e.subViewModels.updateProductConfigurationCustomizedViewModel,j=i._updateProductConfigurationCustomized(f,!0,"QuoteSDOrderSummary+++promoCode+++EMPTY");j.done(function(a,d){if("updateSuccess"===a){var f=d.ImplUpdateOrderProductsResponse,g=!1;if(f&&f.implUpdateOrderProductList){var h=f.implUpdateOrderProductList;h&&h.length>0&&c.each(h,function(a){if(!a.isSuccess){var b=a.ruleExecutionMessages;c.find(b,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return g=!0,!0}})}})}if(g)return e.set("fulfillmentDetailsVmStatus","failure"),b.reject("failure"),!1;e.set("fulfillmentDetailsVmStatus","success"),e.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutRulesCompleted",!0),b.resolve("updateSuccess")}}.bind(e)),j.fail(function(a){e.set("fulfillmentDetailsVmStatus","failure"),b.reject("failure")}.bind(e))}});return r});
define("businesswidget/repository_l9_common/common/viewmodel/business/MicroCartWidgetViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/SaveShoppingCartModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository/common/model/CustomerEligibilityWidgetModel","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplCustomerEligibilityTopicViewModel","businesswidget/repository/common/model/CustomerProductOrderIdValidateProductConfigurationsModel","businesswidget/repository/common/model/CommerceCustomerAnonymousProductOrderIdValidateProductConfigurationsModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/TradeInViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/UpdateOrderWithVouchersModel","businesswidget/repository_l9_common/common/model/SearchCartOrderModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ReserveAllocateMTPOSEquipmentsViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/NewProductInOfferingInstanceViewModel","businesswidget/repository_l9_common/common/model/ValidateOrderVouchersModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","businesswidget/repository_l9_common/common/model/UpdateOrderActionCharacteristicsRequestModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetDmpCommerceViewModel","businesswidget/repository_l9_common/common/model/ApplyVoucherModel","businesswidget/repository_l9_common/common/model/RecalculateBlockOrderModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateOrderActionAttributesViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetFulfillmentDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/StoreAvailabilityDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P){var Q=a.Core.ObservableViewModel.extend({models:{UpdateContactModel:m,saveShoppingCartModel:d,getBillingAccountDetailedListModel:i,CommerceCustomerAnonymousProductOrderIdValidateProductConfigurationsModel:l,CustomerEligibilityModel:h,CustomerProductOrderIdValidateProductConfigurationsModel:k,searchCartOrderModel:u,UpdateOrderWithVouchersModel:t,customerProductOrderProductOrderItemsModel:x,anonymousProductOrderProductOrderItemsModel:y,validateOrderVouchersModel:A,updateCharacteristicsRequestModel:C,viewUpdateCustomerProfileModel:D,implSendNotificationModel:E,applyVoucherModel:I,recalculateBlockOrderModel:J},subViewModels:{customerInContextTopicViewModel:e,productOrderTopicViewModel:f,deviceIdAndPlanIdInContextTopic:s,individualInContextTopicViewModel:g,CustomerEligibilityTopicViewModel:j,OnePassTopicViewModel:n,ShoppingCartViewModel:o,ImplUserContextTopicViewModel:p,tradeInViewModel:q,updateProductConfigurationViewModel:r,reserveAllocateMTPOSEquipmentsViewModel:v,clearContextInContextTopic:w,newProductInOfferingInstanceViewModel:z,miniCartInContextTopic:B,getCustomerIdValueViewModel:F,storeContextDataViewModel:G,getDmpCommerceViewModel:H,updateOrderActionAttributesViewModel:K,updateProductConfigurationCustomizedViewModel:L,getFulfillmentDetailsViewModel:M,storeAvailabilityDetailsViewModel:N,billMethodPreferenceViewModel:O,validateSessionTokenViewModel:P},dataBindings:[{customerId:"subViewModels.productOrderTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{customerIds:"subViewModels.customerInContextTopicViewModel.customerIds",options:{twoWay:!1,setOnBind:!0}},{orderMapped:"subViewModels.productOrderTopicViewModel.orderMapped",options:{twoWay:!0,setOnBind:!0}},{emailNotificationRequired:"subViewModels.productOrderTopicViewModel.emailNotificationRequired",options:{twoWay:!0,setOnBind:!0}},{productOrderReferenceNumber:"subViewModels.productOrderTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}},{productOrderItemID:"subViewModels.productOrderTopicViewModel.productOrderItemID",options:{twoWay:!1,setOnBind:!0}},{catalogItemEligibilityInfo:"subViewModels.CustomerEligibilityTopicViewModel.catalogItemEligibilityInfo",options:{twoWay:!1,setOnBind:!0}},{catalogOfferEligibilityInfo:"subViewModels.CustomerEligibilityTopicViewModel.catalogOfferEligibilityInfo",options:{twoWay:!1,setOnBind:!0}},{eligibilityCheckDone:"subViewModels.CustomerEligibilityTopicViewModel.eligibilityCheckDone",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{orderActions:"subViewModels.productOrderTopicViewModel.orderActions",options:{twoWay:!1,setOnBind:!0}},{productOrderID:"subViewModels.productOrderTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0}}],defaults:{emailInput:"",orderData:null,itemToRemove:null,cartSaveStatus:"",checkoutStatus:"",emptyCartStatus:"",continueShoppingStatus:"",eligibilityStatus:"ELIGIBILE",productOrderReferenceNumber:null,customerId:null,customerIds:null,emailNotificationRequired:"",validationMessages:null,lobs:null,microCartVmStatus:"",changeDeviceStatus:"",tradeInDetails:null,selectedDevices:null,shoppingCartStatus:null,saveCartParams:null,selectedOrderItemId:null,selectedShoppingCartVouchers:null,checkVouchers:null,mbbDetails:null,mbbCheckDone:!1,tvSelectData:null,removeComponents:null,allAddons:null,orderToBeRemoved:null,registerInterest:null,selectedDevicesSkuIds:null,customerNric:null,reservedVouchersList:null,isTVOrderRequired:!1,shoppingCartDeferred:null,notAvailableAccessoriesDetails:null,callReserveEquipment:!1,completeDataLoaded:!1,cartDeferred:null,cancelInvalidOrderAction:!1,isGoToAccessory:!1,isPortinAttributeSet:!1,billingAccountDetails:null,isFullCheckoutScenario:!1,broadbandInstallationIds:null,displayModalWindowFlag:!1,removedItemDetails:[],deliveryOptions:null},ELIGIBILTY_CONSTANTS:{OFFER_NAME:"offerName",EL_VALUE:"eligibililityValue",EL_OFFER_NAME:"catalogOfferName",EL_RESULT:"eligibilityResult",EL_REASON:"eligibilityReason",REASON:"offerRejectionReason",B:"1",I:"2",C:"3",NOT_ELIGIBLE:"DD",USER_NOT_ALLOWED_TO_SELL_DU:"DU",USER_NOT_ALLOWED_TO_SELL_RD:"RD"},initialize:function(a){this._super(a),c.bindAll(this,"getPersonDetails","onPersonalDetailsSuccess","onSaveCart","saveCart","onUpdateOrder","updateContact","updateVouchers","saveTradeInDetails","onSaveCartParams","failureScenario","onCartItemChange","createTVSelectOrder","populateCartDetails","setHeaders","setDefaultQueryParams","validateConfigurationForNonAnonymous","validateConfiguration","validateConfigurationForAnonymous","checkout","setRemoveLinkFlag","checkRemoveForBb","checkRemoveForTv","checkRemoveForWs","validateVouchers","checkVoucherInOrder","removeSelectedSetTopBox","updatePortinCharacteristicsRequest","validateConfiguration","getCustomerIdType","runConfigurationRules","populatePersonalDetails","addCustomerContact","removeMultiCartItem","removeBroaband","removeTV","createCookie","getCookieVal","findCartItemAvailability","findMobileItemAvailability","removeFreebieFromOrder","setFreebiesInOrder","populateRemovedAddonObject","reserveEquipments","_handleEmptyCartSuccess","setRemovedVouchersInOrder","onPersonalDetailsFailure","onupdateContactError","findBundleItemsAvailability","createTVOrder","removeAccessoriesFromOrder","runValidationConfigurationRules","removeAccessoriesFromOrderImpl","populatePromoObject"),this.set("shoppingCartStatus","initializing"),this.subViewModels.newProductInOfferingInstanceViewModel.on("dataSet",this.checkout,this),this.subViewModels.newProductInOfferingInstanceViewModel.on("orderFailure",this.failureScenario,this),this.on("change:productOrderReferenceNumber",this.loadDataCondition);var b=this.subViewModels.productOrderTopicViewModel.get("productOrderReferenceNumber");"undefined"!=typeof b&&null!==b&&""!==b||this.loadDataCondition(),this.populatePersonalDetails(!1)},populatePromoObject:function(a){var b=a.productOrderItemID,d=[];"undefined"==typeof b||null===b?d=a.productOrderItemIDs:d.push(b);var e={productOrderItemIDs:d,selectedAddonIds:[]};return e.customerType="public",a.planDetails&&a.planDetails.length>0?e.planCode=a.planDetails[0].planId:a.broadBandPlanDetails&&a.broadBandPlanDetails.serviceId?e.planCode=a.broadBandPlanDetails.serviceId:a.tvPlanDetails&&a.tvPlanDetails.planId&&(e.planCode=a.tvPlanDetails.planId),a.deviceDetails&&a.deviceDetails.length>0&&(e.deviceBrandName=a.deviceDetails[0].brandName,e.deviceModelName=a.deviceDetails[0].modelName,e.deviceType=a.deviceDetails[0].deviceType),a.isPortin&&(e.numberPortIn=!0),a.ciTier&&(e.ciTier=a.ciTier),a.serviceDetails&&a.serviceDetails.length>0&&(a.staffDiscountTemp=c.find(a.serviceDetails,function(a){return"Staff Discount"===a.serviceType})),a.staffDiscount||a.staffDiscountTemp?e.customerType="staff":a.cisDiscount&&(e.customerType="cis"),a.isRecon?e.transactionType="recon":a.isPortin?e.transactionType="port-in":e.transactionType="new",a.premiumAddons&&a.premiumAddons.length>0&&c.each(a.premiumAddons,function(a){a.offerID&&!a.hideRemoveLink&&(e.selectedAddonIds.push(a.offerID),a.simpleProductSpecID&&e.selectedAddonIds.push(a.simpleProductSpecID))}),a.addons&&a.addons.length>0&&c.each(a.addons,function(a){a.offerID&&!a.hideRemoveLink&&e.selectedAddonIds.push(a.offerID)}),a.mobileContents&&a.mobileContents.length>0&&c.each(a.mobileContents,function(a){a.offerID&&!a.hideRemoveLink&&(e.selectedAddonIds.push(a.offerID),e.selectedAddonIds.push(a.simpleProductSpecID))}),a.appleCare&&a.appleCare.length>0&&c.each(a.appleCare,function(a){a.offerID&&!a.hideRemoveLink&&e.selectedAddonIds.push(a.offerID)}),a.accessories&&a.accessories.length>0&&c.each(a.accessories,function(a){a.offerID&&!a.hideRemoveLink&&(e.selectedAddonIds.push(a.offerID),e.selectedAddonIds.push(a.simpleProductSpecID))}),e},loadDataCondition:function(){var a=this,b=a.get("productOrderReferenceNumber"),c=a.get("cancelInvalidOrderAction");"undefined"==typeof b||""===b||null===b||c?c||a.set("shoppingCartStatus","vmInitialized"):a.populateCartDetails()},getCookieVal:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},createTVSelectOrder:function(){var a=this;a.set("isTVOrderRequired",!0);var b=this.subViewModels.customerInContextTopicViewModel.get("customerIds");this.isAnonymousFlow()&&b&&b.length>1?a.createTVOrder():a.checkout()},createTVOrder:function(){var a,b=this,c=this.get("tvSelectData"),d=b.get("orderData"),e=d.order;e&&e.bundle&&e.bundle.length>0&&(a=e.bundle[0].installationAddressID),this.subViewModels.productOrderTopicViewModel.set("contnueShoppingFlag",!0),this.subViewModels.productOrderTopicViewModel.set("currentOrderActions",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("planId",c.planId),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("relationId",c.relationId),this.subViewModels.newProductInOfferingInstanceViewModel.set("packType",c.packType),this.subViewModels.newProductInOfferingInstanceViewModel.set("runTVSelectRules",!0),this.subViewModels.newProductInOfferingInstanceViewModel.set("dealerID",c.dealerID),this.subViewModels.newProductInOfferingInstanceViewModel.set("vendorID",c.vendorID),this.subViewModels.newProductInOfferingInstanceViewModel.createOrder(!0,a)},populateCartDetails:function(a){var b=this,d=b.get("cartDeferred")||$.Deferred();b.subViewModels.ShoppingCartViewModel.set("isShoppingCartFlag",!0);var e=b.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1,a);return e.done(function(e){if("SUCCESS"===e){var f=b.subViewModels.productOrderTopicViewModel.get("orderActions"),g=[];f&&c.each(f,function(a){a.lob&&g.push(a.lob)}),b.set("lobs",g);var h=b.get("orderData")||{};h.order=b.subViewModels.ShoppingCartViewModel.getValueByPath("orderData.order"),h.order.selectedDevices=b.subViewModels.ShoppingCartViewModel.get("selectedDevices"),h.order.selectedFreebies=b.subViewModels.ShoppingCartViewModel.get("selectedFreebies"),h.order.selectedAccessories=b.subViewModels.ShoppingCartViewModel.get("selectedAccessories"),f&&f.length>1&&h&&h.order&&b.setRemoveLinkFlag(f,h.order),f&&f.length>0&&h&&h.order&&b.findCartItemAvailability(f,h);var i=b.subViewModels.ShoppingCartViewModel.get("negativeAmountOrderActions");if(i&&i.length>0){var j=h.missingListItems,k=[];j&&j.length>0&&c.each(j,function(a){k.push(a.productOrderItemID)}),i=c.difference(i,k)}if(i&&i.length>0){var l,m=b.subViewModels.productOrderTopicViewModel,n=m.get("customerID"),o=m.get("productOrderID"),f=m.get("orderActions");n?(l=b.models.customerProductOrderProductOrderItemsModel,l.set("customerId",n)):l=b.models.anonymousProductOrderProductOrderItemsModel,l.set("productOrderId",o),b.setDefaultQueryParams(l),l.setQueryParams({poi:i}),l.set("id",i[0]),l.destroy({success:c.bind(b.handleInvalidOASuccess,b,d,i,f,a),error:c.bind(b.handleInvalidOAFailure,b,d,i,a)})}else{var m=b.subViewModels.productOrderTopicViewModel,p=m.get("promoOrderActions"),f=m.get("orderActions"),q=!0;if("undefined"==typeof h.missingListItems||null===h.missingListItems||0===h.missingListItems.length)if(p){var r=[],s=h.order,t=s.mobile,u=s.bundle,v=s.tv;if(t&&t.length>0&&c.each(t,function(a){if(!c.contains(p,a.productOrderItemID)){var d=b.populatePromoObject(a);r.push(d)}}),v&&v.length>0&&c.each(v,function(a){if(!c.contains(p,a.productOrderItemID)){var d=b.populatePromoObject(a);r.push(d)}}),u&&u.length>0&&c.each(u,function(a){var d=c.find(a.productOrderItemIDs,function(a){if(!c.contains(p,a))return!0});if(d){var e=b.populatePromoObject(a);r.push(e)}}),r&&r.length>0){q=!1;var w=b.subViewModels.updateOrderActionAttributesViewModel._updateOrderCustomized(r);w.done(function(e){if("success"===e){var g=[],h=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if(c.each(f,function(a){var b=[];if(h&&h.isPresent&&a.productOrderItemID===h.productOrderItemID&&h.productID&&b.push({productID:h.productID}),!c.contains(p,a.productOrderItemID)){var d=!1,e={productOrderItemId:a.productOrderItemID,returnFullUpcResponse:d,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:[{productID:a.productID}],newContainedProducts:[],removedContainedProducts:b,suspendedContainedProducts:[]}};g.push(e)}}),g.length>0){var i=b.subViewModels.updateProductConfigurationCustomizedViewModel,j=i._updateProductConfigurationCustomized(g,!0,"SD Add Comp Stage+++promoCode+++EMPTY");j.done(function(e,f){if("updateSuccess"===e){var g=f.ImplUpdateOrderProductsResponse,h=!1;if(g&&g.implUpdateOrderProductList){var i=g.implUpdateOrderProductList;i&&i.length>0&&c.each(i,function(a){if(!a.isSuccess){var b=a.ruleExecutionMessages;c.find(b,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return h=!0,!0}})}})}if(h)b.set("orderData",b.subViewModels.productOrderTopicViewModel.get("productOrderID")),b.set("emptyCartStatus","quotationFailed"),b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.trigger("shopingCartLoadFailed"),d.resolve("shopingCartLoadFailed");else{var j=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");j&&j.isPresent&&b.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null);var k=b.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1,a);k.done(function(c){"SUCCESS"===c&&(b.set("cartDeferred",d),b.populateCartDetails(a))}),k.fail(function(a){b.set("orderData",b.subViewModels.productOrderTopicViewModel.get("productOrderID")),b.set("emptyCartStatus","quotationFailed"),a&&0!==a.status&&(b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.trigger("shopingCartLoadFailed")),d.resolve("shopingCartLoadFailed")}.bind(b))}}}.bind(b)),j.fail(function(a){b.set("orderData",b.subViewModels.productOrderTopicViewModel.get("productOrderID")),b.set("emptyCartStatus","quotationFailed"),b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.trigger("shopingCartLoadFailed"),d.resolve("shopingCartLoadFailed")}.bind(b))}else b.set("cartDeferred",d),b.populateCartDetails(a)}else b.set("orderData",b.subViewModels.productOrderTopicViewModel.get("productOrderID")),b.set("emptyCartStatus","quotationFailed"),b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.trigger("shopingCartLoadFailed"),d.resolve("shopingCartLoadFailed")}.bind(b))}}else q=!1;q&&(h.orderDataIsLoaded=!0,b.set("orderData",h),b.set("customerNric",b.subViewModels.OnePassTopicViewModel.get("nric")),b.set("microCartVmStatus","shopingCartLoaded"),b.get("cancelInvalidOrderAction")&&b.set("microCartVmStatus","invalidOrderActionCanceled"),b.trigger("shopingCartLoaded"),d.resolve("shopingCartLoaded"))}}}.bind(b)),e.fail(function(a){b.set("orderData",b.subViewModels.productOrderTopicViewModel.get("productOrderID")),b.set("emptyCartStatus","quotationFailed"),a&&0!==a.status&&(b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.trigger("shopingCartLoadFailed")),d.resolve("shopingCartLoadFailed")}.bind(b)),d},handleInvalidOASuccess:function(a,b,c,d,e,f){var g=this;c.length===b.length?(g.set("displayModalWindowFlag",!0),g.subViewModels.clearContextInContextTopic.clearAllTopics(!0),g.set("cancelInvalidOrderAction",!0),g.set("emptyCartStatus","emptyCartCompleted"),g.set("microCartVmStatus","invalidOrderCanceled"),a.resolve("shopingCartLoadFailed")):(g.set("cartDeferred",a),g.set("cancelInvalidOrderAction",!0),g.populateCartDetails(d))},handleInvalidOAFailure:function(){var a=this;a.set("displayModalWindowFlag",!0),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("cancelInvalidOrderAction",!0),a.set("emptyCartStatus","emptyCartCompleted"),a.set("microCartVmStatus","invalidOrderCanceled")},createCookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+6048e5);var e="expires="+d.toUTCString(),f=a+"_"+b;document.cookie="orderValue="+f+";"+e+";path=/",document.cookie="orderActions="+JSON.stringify(c)+";"+e+";path=/"},setRemoveLinkFlag:function(a,b){var d=b.mobile,e=b.bundle,f=(b.tv,b.fv,c.filter(a,function(a){return"BB"===a.lob})),g=c.filter(a,function(a){return"WS"===a.lob}),h=c.filter(a,function(a){return"TV"===a.lob});c.filter(a,function(a){return"FV"===a.lob});f&&f.length>0&&e&&e.length>0&&this.checkRemoveForBb(a,b,g,h),h&&h.length>0&&this.checkRemoveForTv(a,b,g),g&&g.length>0&&d&&d.length>0&&this.checkRemoveForWs(a,d,g,f,h)},checkRemoveForBb:function(a,b,d,e){var f=(b.mobile,b.bundle),g=!1,h=!1;e&&e.length>0?h=!0:d&&d.length>0&&d.length>1&&(g=!0),g&&!h&&c.each(f,function(a){a.showRemoveLink=!0})},checkRemoveForTv:function(a,b,d){var e=(b.mobile,b.bundle),f=b.tv,g=!1,h=!1;e&&e.length>0?g=!0:d&&d.length>0&&(h=!0),h&&!g&&c.each(f,function(a){a.showRemoveLink=!0})},checkRemoveForWs:function(a,d,e,f,g){var h=b.get("mbbOfferIds"),i=c.filter(d,function(a){return!c.contains(h,a.productOfferingID)});i&&i.length>0&&(i.length>1||f&&f.length>0||g&&g.length>0)&&c.each(i,function(a){a.showRemoveLink=!0})},failureScenario:function(){this.set("displayModalWindowFlag",!0),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("microCartVmStatus","failure")},findCartItemAvailability:function(a,b){var d=b.order.mobile,e=b.order.bundle,f=c.filter(a,function(a){return"WS"===a.lob});f&&f.length>0&&d&&d.length>0&&this.findMobileItemAvailability(b,f);var g=c.filter(a,function(a){return"BB"===a.lob});g&&g.length>0&&e&&e.length>0&&this.findBundleItemsAvailability(b,g,a)},findMobileItemAvailability:function(a,b){var d=[],e=0,f=a.order.selectedDevices,g=a.order.mobile;c.each(b,function(a){var b;if("WS"===a.lob&&!a.isFreeMBB&&"mobileSharePlan"!==a.flowType&&"simOnlyPlan"!==a.flowType&&(b=f[a.productOrderItemID],"undefined"==typeof b||null===b)){e+=1;var h="device";c.each(g,function(b){if(b.orderDetails&&b.orderDetails.orderActionId===a.productOrderItemID&&b.planDetails&&b.planDetails.length>0){var c=b.planDetails[0].planName;(c&&c.toUpperCase().indexOf("BROADBAND")>-1||a.flowType&&a.flowType.toUpperCase().indexOf("TABLET")>-1)&&(h="tablet")}}),d.push({id:h,productOrderItemID:a.productOrderItemID})}}),c.each(g,function(a){a.subscriptionId||(e+=1,d.push({id:"number",productOrderItemID:a.productOrderItemID}))}),d&&d.length>0&&(a.numberOfMissingItems=e,a.missingListItems=d),a.missingListItems=d},findBundleItemsAvailability:function(a,b,d){var e=a.missingListItems||[],f=a.numberOfMissingItems||0,g=a.order.bundle;c.each(g,function(a){a.landlineNumber||(f+=1,e.push({id:"fvNumber",productOrderItemIDs:a.productOrderItemIDs}))}),e&&e.length>0&&(a.numberOfMissingItems=f,a.missingListItems=e),a.missingListItems=e},onSaveCartParams:function(){var a=this,b=a.get("saveCartParams");if("undefined"!=typeof b&&null!==b){var d=b.orderRefNumber;if("undefined"!=typeof d&&null!==d&&""!==d){var e=b.customerId;e&&a.subViewModels.productOrderTopicViewModel.set("customerID",e);var f={ImplSearchOrderRestInput:{categoryType:"OrderID",categoryId:d,hashString:b.hashString}},g=a.getModel("searchCartOrderModel");g.save(f,{success:c.bind(a.onSearchCartOrderSuccess,a,b),error:function(){a.set("displayModalWindowFlag",!0),a.set("emptyCartStatus","emptyCartCompleted"),a.set("microCartVmStatus","saveCartFailed")}})}}},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onSearchCartOrderSuccess:function(a,b,c){var d=this,e=d.get("saveCartParams");e&&e.chargeableEmail&&d.subViewModels.ShoppingCartViewModel.set("chargeableEmail",e.chargeableEmail),d.subViewModels.productOrderTopicViewModel.set("customerID",a.customerId),d.subViewModels.productOrderTopicViewModel.set("productOrderID",a.orderId),d.subViewModels.productOrderTopicViewModel.set("productOrderReferenceNumber",a.orderRefNumber)},saveTradeInDetails:function(){var a=this;a.set("microCartVmStatus","savingTradeIn");var b=a.subViewModels.tradeInViewModel.saveTradeInDetails(this.get("tradeInDetails"));b.done(function(b){"success"===b&&a.set("microCartVmStatus","resetDetails")}.bind(a)),b.fail(function(b){a.set("microCartVmStatus","failure")}.bind(a))},removeTradeInDetails:function(){var a=this;a.set("microCartVmStatus","removingTradeIn");var b=a.subViewModels.tradeInViewModel.removeTradeInDetails(this.get("tradeInDetails"));b.done(function(b){"success"===b&&a.set("microCartVmStatus","resetDetails")}.bind(a)),b.fail(function(b){a.set("microCartVmStatus","failure")}.bind(a))},populatePersonalDetails:function(a){var b=this.subViewModels.individualInContextTopicViewModel.get("personId");if(b){var d=this.getModel("viewUpdateCustomerProfileModel");d.set("id",b),d.fetch({success:c.bind(this.onPopulatePersonalDetailsSuccess,this,a),error:c.bind(this.onPopulatePersonalDetailsError,this)})}},onPopulatePersonalDetailsSuccess:function(a,b,c){var d=this.get("orderData")?this.get("orderData"):{};d.personalInformation={};var e,f=d.personalInformation;c.ImplContactPersonOutput?e=c.ImplContactPersonOutput.implContactPerson:c.ImplContactPerson&&(e=c.ImplContactPerson),e.implPhysicalAddressDetails&&(f.postalCode=e.implPhysicalAddressDetails.postcode),e&&(f.gender=e.personGender,f.fullName=e.name,f.firstName=e.firstName,f.lastName=e.lastName,f.dateOfBirth=new Date(e.birthDate).getTime(),f.contactNumber=e.phone,f.email=e.emailId,f.address=e.implPhysicalAddressDetails),e.nricNumber&&(f.nricNumber=e.nricNumber,f.nricType=e.nricType),d.personalInformation=f,this.set("orderData",d),a&&this.onSaveCart(e.emailId)},onPopulatePersonalDetailsError:function(a,b){this.set("microCartVmStatus","error")},getPersonDetails:function(a){var b=this,d=b.subViewModels.OnePassTopicViewModel.get("nric");if(d){var e=b.getModel("getBillingAccountDetailedListModel"),f=b.subViewModels.getCustomerIdValueViewModel.getCustomerType(b.subViewModels.OnePassTopicViewModel.get("customerIdType"));e.set("type",f),e.fetch({id:d,success:c.bind(this.onPersonalDetailsSuccess,this,a),error:c.bind(this.onPersonalDetailsFailure,this,a)})}},onPersonalDetailsFailure:function(a,b,c){var d=this;d.set("displayModalWindowFlag",!0),d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("emptyCartStatus","emptyCartCompleted"),a.reject("failure"),d.set("microCartVmStatus","error")},onPersonalDetailsSuccess:function(a,b,d){var e,f=this;if(d&&d.ImplBillingAccountDetailsResponse&&d.ImplBillingAccountDetailsResponse.billingAccountDetails){var g=d.ImplBillingAccountDetailsResponse.billingAccountDetails;e=c.find(g,function(a){return a.paInd}),f.set("billingAccountDetails",g)}if(e)f.set("displayModalWindowFlag",!0),f.set("emptyCartStatus","emptyCartCompleted"),f.set("microCartVmStatus","ipaUser"),f.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.reject("ipaUser");else{var h=this.subViewModels.productOrderTopicViewModel.get("orderActions"),i=!1;c.each(h,function(a){"WS"===a.lob&&(i=!0)}),i&&!f.get("isPortinAttributeSet")?f.updatePortinCharacteristicsRequest(a):f.runConfigurationRules(a)}},onPersonalDetailsError:function(){this.set("microCartVmStatus","error")},isAnonymousFlow:function(){var a=this.get("customerId");return void 0==a||null===a||""==a},onUpdateOrder:function(){var a=this.getModel("CustomerEligibilityModel");a.setQueryParams({orderDetailsInd:"No",lo:this.get("locale")?this.get("locale"):b.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):b.get("salesChannel")}),a.set({productOrderId:this.get("productOrderReferenceNumber")}),a.save({CommerceProductOrderCustomerEligibilityInput:{customerID:this.get("customerId")}},{success:c.bind(this.onUpdateOrderSuccess,this),error:c.bind(this.onUpdateOrderError,this)})},onUpdateOrderSuccess:function(){this.set("eligibilityRuleStatus","rulesPassed")},onUpdateOrderError:function(){this.set("eligibilityRuleStatus","rulesFailed"),this.set("microCartVmStatus","failure")},saveCart:function(){var a=this.get("emailNotificationRequired")||sessionStorage.getItem("email");if("undefined"!=typeof a&&"1"===a){var b=this.subViewModels.productOrderTopicViewModel.get(),d=this.subViewModels.customerInContextTopicViewModel.get("customerIds");if(!this.isAnonymousFlow()||d&&d.length>0){this.get("orderData");if(b.customerID)setTimeout(function(){this.set("cartSaveStatus","cartSavedSuccessfully")}.bind(this),10);else if(null===b.customerID&&d&&1===d.length)this.addCustomerContact(b,!0);else if(d&&d.length>1){c.contains(d,b.customerID);this.set("cartSaveStatus","startDisplayNow")}}else this.onSaveCart(this.get("emailInput"));this.set("emailNotificationRequired","0")}else this.set("cartSaveStatus","startDisplayNow");var e=this.get("orderMapped");"undefined"!=typeof e&&"0"===e&&(this.onUpdateOrder(),this.set("orderMapped","1")),sessionStorage.removeItem("email")},onSaveCart:function(a,e){this.models.saveShoppingCartModel=this.create("ShoppingCartWidget_MicroCartWidgetViewModel_saveCart",d);var f=this.models.saveShoppingCartModel;f.setQueryParams({email:a,orderDetailsInd:"No",lo:this.get("locale")?this.get("locale"):b.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):b.get("salesChannel"),order:this.get("productOrderID")});var g=this.subViewModels.productOrderTopicViewModel.get("customerID");g&&f.setQueryParams({email:a,customerId:g,orderDetailsInd:"No",lo:this.get("locale")?this.get("locale"):b.get("locale"),sc:this.get("saleschannel")?this.get("saleschannel"):b.get("salesChannel"),order:this.get("productOrderID")}),f.set({orderId:this.get("productOrderReferenceNumber")}),f.save(null,{orderId:this.get("productOrderReferenceNumber"),success:c.bind(this.onSaveShoppingCartSuccess,this,e),error:c.bind(this.onSaveShoppingCartError,this)})},onSaveShoppingCartSuccess:function(a,b,c){this.set("cartSaveStatus","cartSavedSuccessfully")},addCustomerContact:function(a,b){var d=this,e=(d.subViewModels.ImplUserContextTopicViewModel.get("userInfo"),a.orderActions||d.get("orderActions")),f=a.updatedOrderActions;if(e=c.filter(e,function(a){return!c.contains(f,a.productOrderItemID)}),b||(b=!1),e.length>0){var g=[],h=[];c.each(e,function(a){g.push({orderActionId:a.productOrderItemID,contactId:d.get("contactId"),userOnBehalf:"Online"}),h.push(a.productOrderItemID)});var i={ImplAddCustomerContactRestInput:{orderAction:g}},j=d.getModel("UpdateContactModel");j.setQueryParams({isAnonymous:!0}),j.set({customerId:customerID,orderId:d.get("productOrderReferenceNumber")}),j.save(i,{success:c.bind(d.onAddCustomerContactSuccess,d,h,b),error:function(){return function(a){d.set("cartSaveStatus","failed")}}()})}else if(b)this.set("cartSaveStatus","cartSavedSuccessfully");else{var k=d.get("orderData");void 0!==k&&null!==k&&void 0!==k.personalInformation&&null!==k.personalInformation?this.onSaveCart(k.personalInformation.email):d.populatePersonalDetails(!0);
}},onSaveShoppingCartError:function(){this.set("cartSaveStatus","erorrWhenTryingToSaveCart")},onAddCustomerContactSuccess:function(a,b,d,e){var f=this,g=f.subViewModels.productOrderTopicViewModel.get("updatedOrderActions")||[];if(c.each(a,function(a){g.push(a)}),f.subViewModels.productOrderTopicViewModel.set("updatedOrderActions",g),b)this.set("cartSaveStatus","cartSavedSuccessfully");else{var h=f.get("orderData");void 0!==h&&null!==h&&void 0!==h.personalInformation&&null!==h.personalInformation?this.onSaveCart(h.personalInformation.email):f.populatePersonalDetails(!0)}},customerEligibilityCheckSuccessHandler:function(a,b,c){var d=this.subViewModels.CustomerEligibilityTopicViewModel;if(d.set("eligibilityCheckDone",!0),void 0!=b.CommerceProductOrderCustomerEligibilityOutput){var e=void 0===b.CommerceProductOrderCustomerEligibilityOutput.eligibilityStatus?"":b.CommerceProductOrderCustomerEligibilityOutput.eligibilityStatus;if(e==this.get("eligibilityStatus"))d.handleAction("success");else{var f=this.getCustomerEligibilityInfoForView(b.CommerceProductOrderCustomerEligibilityOutput.catalogOfferEligibilityInfo,b.CommerceProductOrderCustomerEligibilityOutput.catalogItemEligibilityInfo);this.set("nonEligibilityOfferInfo",f.offerNameAndReasonList),this.set("messageInfo",b.CommerceProductOrderCustomerEligibilityOutput.messageInfo),this.set("catalogItemEligibility",f.catalogItemEligibilityInfoList),d.set("catalogItemEligibilityInfo",f.catalogItemEligibilityInfoList),d.set("messageInfo",[]),d.set("catalogOfferEligibilityInfo",f.catalogOfferEligibilityInfoList),this.trigger("fail:eligibility")}}},checkEligibilityStatus:function(a){var b=!1;return this.ELIGIBILTY_CONSTANTS.NOT_ELIGIBLE===a&&(b=!0),this.ELIGIBILTY_CONSTANTS.USER_NOT_ALLOWED_TO_SELL_DU===a&&(b=!0),this.ELIGIBILTY_CONSTANTS.USER_NOT_ALLOWED_TO_SELL_RD===a&&(b=!0),b},getCatalogOfferEligibilityInfo:function(a){var b,d=this,e=(this.get("eligibile"),[]),f=[];return c.each(a,function(a){b={},void 0!=a&&d.checkEligibilityStatus(a[d.ELIGIBILTY_CONSTANTS.EL_VALUE])&&(b[d.ELIGIBILTY_CONSTANTS.OFFER_NAME]=void 0!==a[d.ELIGIBILTY_CONSTANTS.EL_OFFER_NAME]?a[d.ELIGIBILTY_CONSTANTS.EL_OFFER_NAME]:"",void 0!==a[d.ELIGIBILTY_CONSTANTS.EL_RESULT]&&c.each(a[d.ELIGIBILTY_CONSTANTS.EL_RESULT],function(a){b[d.ELIGIBILTY_CONSTANTS.REASON]=void 0!==a[d.ELIGIBILTY_CONSTANTS.EL_REASON]?a[d.ELIGIBILTY_CONSTANTS.EL_REASON]:""}),e.push(b),f.push(a))}),{offerNameAndReasonList:e,catalogOfferEligibilityInfoList:f}},getCatalogItemEligibilityInfo:function(a){var b=this,d=(this.get("eligibile"),[]);return c.each(a,function(a){void 0!=a&&a.catalogItemId&&a.eligibilityValueCode&&b.checkEligibilityStatus(a.eligibilityValueCode)&&d.push(a)}),{catalogItemEligibilityInfoList:d}},getCustomerEligibilityInfoForView:function(a,b){var c;return catalogOfferDetails=this.getCatalogOfferEligibilityInfo(a),c=this.getCatalogItemEligibilityInfo(b),catalogOfferDetails.catalogItemEligibilityInfoList=c.catalogItemEligibilityInfoList,catalogOfferDetails},customerEligibilityCheckErrorHandler:function(a,b,c){console.log("Error in customerEligibilityCheckErrorHandler")},emptyCart:function(){var a,b=this,d=b.subViewModels.productOrderTopicViewModel,e=d.get("customerID"),f=d.get("productOrderID");e?(a=b.models.customerProductOrderProductOrderItemsModel,a.set("customerId",e)):a=b.models.anonymousProductOrderProductOrderItemsModel,a.set("productOrderId",f),b.setDefaultQueryParams(a);var g=[];c.each(d.get("orderActions"),function(a){g.push(a.productOrderItemID)}),a.setQueryParams({poi:g}),a.set("id",g[0]),a.destroy({success:c.bind(b._handleEmptyCartSuccess,b,!1),error:c.bind(b._handleEmptyCartFailure,b,!1)})},_handleEmptyCartSuccess:function(a){a&&a.resolve("emptyCartContinue"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a?this.set("emptyCartStatus","emptyCartContinue"):(this.set("displayModalWindowFlag",!1),this.set("emptyCartStatus","emptyCartCompleted"))},_handleEmptyCartFailure:function(a){a&&a.reject("failure"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a?this.set("emptyCartStatus","emptyCartContinue"):(this.set("displayModalWindowFlag",!1),this.set("emptyCartStatus","emptyCartCompleted"))},continueShopping:function(){this.subViewModels.productOrderTopicViewModel.set("contnueShoppingFlag",!0),this.subViewModels.productOrderTopicViewModel.set("currentOrderActions",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),this.subViewModels.miniCartInContextTopic.emptyTopic(),this.set("continueShoppingStatus","continueShoppingCompleted")},createPayloadForValidation:function(a){return{activityForConfiguration:"SDRulesForCheckout+++promoCode+++EMPTY",returnRemovedItems:!1,settingsView:"FULL",productOrderItems:a,retrieveComponentPricing:!1,retrieveSchemaPricing:!1,performSave:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}}},createProductOrderItems:function(a){var b=this.subViewModels.productOrderTopicViewModel.get("orderActions");c.each(b,function(b){var c;c={productOrderItemID:b.productOrderItemID,productID:b.productID},a.push(c)},this)},validateConfigurationForAnonymous:function(){var a=$.Deferred();return this.runConfigurationRules(a,!0),a},validateConfigurationForNonAnonymous:function(a){this.set("checkoutStatus","validating");var b=this,c=b.subViewModels.OnePassTopicViewModel.get("nric"),d=b.subViewModels.deviceIdAndPlanIdInContextTopic.get(),e=d.customerType;if("staff"===e){var f=d.staffDetails;if(f&&f.custId&&f.custId!==c)return b.set("checkoutStatus","inValidUser"),!1}this.getPersonDetails(a)},updatePortinCharacteristicsRequest:function(a){var b=this,d=b.subViewModels.OnePassTopicViewModel.get(),e=b.subViewModels.ImplUserContextTopicViewModel.getValueByPath("userInfo.contactDetails"),f=b.getCustomerIdType(d.customerIdType),g={ImplUpdateOrderActionCharacteristicsRequest:{productSpecContainmentId:"11812",implUpdateOrderActionCharacteristics:[{id:"8482",value:d.familyName||e.registeredName},{id:"8502",value:f},{id:"8492",value:d.nric}]}},h=b.getModel("updateCharacteristicsRequestModel");h.set({contactId:b.subViewModels.individualInContextTopicViewModel.get("personId"),orderId:b.subViewModels.productOrderTopicViewModel.get("productOrderID")}),h.save(g,{success:c.bind(b.onUpdateCharSuccess,b,a),error:c.bind(b.onPersonalDetailsFailure,b,a)})},getCustomerIdType:function(a){var b="";switch(a){case"National Registration ID Card (NRIC)":b="NRIC";break;case"Foreign Identification Number (FIN)":b="4";break;case"Foreigner Dependent Pass":b="4";break;case"Foreigner Employment Pass":b="4";break;case"Foreigner S Pass":b="4";break;case"Foreigner Student Pass":b="4";break;case"Passport Number":b="6";break;case"Foreigner Social Visit Pass":b="7";break;case"Foreigner Work Permit":b="4";break;case"Diplomat":b="600";break;case"Others":b="99"}return b},onUpdateCharSuccess:function(a,b,c){c&&c.ImplUpdateOrderActionCharacteristicsResponse?this.runConfigurationRules(a):this.onPersonalDetailsFailure(a)},runConfigurationRules:function(a,b){var d=this,e=d.get("customerIds");if(e&&e.length>0){var f,g=d.getModel("recalculateBlockOrderModel"),h=d.subViewModels.productOrderTopicViewModel.get("orderActions"),i=!1;h&&h.length>0&&(f=c.find(h,function(a){return"Provide"===a.orderType&&("BB"===a.lob||"TV"===a.lob)})),f&&(i=!0);var j=d.subViewModels.productOrderTopicViewModel.get("productOrderID");g.set("orderId",j);var k={ImplRecalculateBlockFlagRequest:{orderId:j,isBlockOrder:i}};g.save(k,{success:c.bind(d.runValidationConfigurationRules,d,a,b),error:c.bind(d.onPersonalDetailsFailure,d,a)})}else d.handleValidationSuccess(a,{})},runValidationConfigurationRules:function(b,d,e,f){var g=this;if(f&&f.ImplRecalculateBlockFlagResponse&&f.ImplRecalculateBlockFlagResponse.isBlockOrder?g.subViewModels.deviceIdAndPlanIdInContextTopic.set("blockOrderID",g.subViewModels.productOrderTopicViewModel.get("productOrderID")):g.subViewModels.deviceIdAndPlanIdInContextTopic.set("blockOrderID",null),d){var h=g.get("customerIds"),i=g.subViewModels.reserveAllocateMTPOSEquipmentsViewModel.get("selectedDevicesSkuIds");if(i&&i.length>0)if(h&&h.length>1){var j=g.subViewModels.ShoppingCartViewModel.get("selectedFreebies"),k=g.subViewModels.ShoppingCartViewModel.get("selectedAccessories"),l=[],m=g.get("orderData"),n=m.order.mobile;n&&n.length>0&&c.each(n,function(a){a.tradeIn&&l.push(a.tradeIn)}),g.subViewModels.deviceIdAndPlanIdInContextTopic.set("isStoreScenario",!1);var o=g.subViewModels.storeAvailabilityDetailsViewModel.checkStockAvailability(i,j,k,l);o.done(function(a){if("failure"===a){var d=(g.get("selectedDevicesSkuIds"),g.subViewModels.storeAvailabilityDetailsViewModel.get("notAvailableDeviceDetails")),e=g.get("orderData");if(d&&d.length>0){e.numberOfOutOfStockItems=d.length;var f=[],h=[],i=e.order.mobile;c.each(d,function(a){var b="device";c.each(i,function(c){if(c.orderDetails&&c.orderDetails.orderActionId===a.productOrderItemID&&c.planDetails&&c.planDetails.length>0){var d=c.planDetails[0].planName;d&&d.toUpperCase().indexOf("BROADBAND")>-1&&(b="tablet")}});var d=c.contains(h,a.title);f.push({name:a.title,productOrderItemID:a.productOrderItemID,id:b,hide:d}),h.push(a.title)}),e.informationListItems=f,g.set("orderData",e),g.set("microCartVmStatus","deviceReservedFailed"),b.resolve("deviceReservedFailed")}}else if("restFailed"===a)g.onPersonalDetailsFailure(b);else{var j=g.subViewModels.storeAvailabilityDetailsViewModel.get("removedItemDetails");j&&j.length>0?(g.set("removedItemDetails",j),g.handleValidationSuccess(b,{})):g.handleValidationSuccess(b,{})}}.bind(g))}else g.handleValidationSuccess(b,{});else g.handleValidationSuccess(b,{})}else{var p,q=this.getModel("CustomerProductOrderIdValidateProductConfigurationsModel"),r=[];q.setQueryParams({sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}),q.set({customerId:this.get("customerId"),productOrderId:this.get("productOrderID")}),this.createProductOrderItems(r),p=this.createPayloadForValidation(r),r&&r.length>0?(q.set("ValidateMultiProductsConfigurationRequest",p),q.fetch({success:c.bind(this.onConfigurationValidationSuccess,this,b),error:c.bind(this.onConfigurationValidationError,this,b)})):this.handleValidationSuccess(b,{})}},onConfigurationValidationSuccess:function(a,b,d){var e={},f=[],g=!1;if("undefined"!=typeof d.ValidateMultiProductConfigurationsResponse){var h=d.ValidateMultiProductConfigurationsResponse.productConfigurations;c.each(h,function(a){var a=a.productConfiguration;"BLOCKING"===a.compatibilityStatus&&(g||(g=!0)),a.messages&&a.messages.length>0&&c.each(a.messages,function(a){f.push({text:a.text,severity:a.severity})},this)},this),e={isSeverityBlocking:g,validationMessages:f},this.handleValidationSuccess(a,e)}else this.set("displayModalWindowFlag",!0),this.set("emptyCartStatus","emptyCartCompleted"),this.set("microCartVmStatus","failure"),a.reject("failure"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0)},onConfigurationValidationError:function(a,b,c){this.set("displayModalWindowFlag",!0),this.set("emptyCartStatus","emptyCartCompleted"),this.set("checkoutStatus","failure"),a.reject("failed"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0)},validateConfiguration:function(){var a=this;if(this.isAnonymousFlow())this.validateConfigurationForAnonymous();else{var b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");if("cis"===b){var c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails");if(c&&"MY_INFO"===c.appType&&c.sessionToken){var d=a.subViewModels.validateSessionTokenViewModel.getCISInfo(c.sessionToken);d.done(function(b){if("cisInfoSuccess"===b){var c=a.subViewModels.validateSessionTokenViewModel.get("cisCustomerDetails");a.set("cisCustomerDetails",c);var d=a.subViewModels.ImplUserContextTopicViewModel.get("userInfo");a.updateContact(d.contactDetails.registeredName,!1,this.get("customerId"),c)}else"cisMismatchError"===b?(a.set("displayModalWindowFlag",!0),a.set("emptyCartStatus","emptyCartCompleted"),a.set("microCartVmStatus","fraudUser"),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0)):a.failureScenario()}.bind(a)),d.fail(function(b){a.failureScenario()}.bind(a))}else{var e=this.subViewModels.ImplUserContextTopicViewModel.get("userInfo");this.updateContact(e.contactDetails.registeredName,!1,this.get("customerId"),null)}}else{var e=this.subViewModels.ImplUserContextTopicViewModel.get("userInfo");this.updateContact(e.contactDetails.registeredName,!1,this.get("customerId"),null)}}},handleValidationSuccess:function(a,b){var c=this;if(c.set("validationMessages",""),null!==b&&b.isSeverityBlocking)c.set("displayModalWindowFlag",!0),c.set("validationMessages",b.validationMessages),c.set("emptyCartStatus","emptyCartCompleted"),a.resolve("failed"),c.subViewModels.clearContextInContextTopic.clearAllTopics(!0);else{var d=c.get("billingAccountDetails"),e=c.subViewModels.getFulfillmentDetailsViewModel;e.set("broadbandInstallationIds",c.get("broadbandInstallationIds"));var f=e.checkIfFulFillmentRequired(d);f.done(function(b){if("success"===b){var d=e.get("isFulFillmentRequired"),f=c.subViewModels.productOrderTopicViewModel.get("barId");if(d||"undefined"==typeof f||null===f)c.set("checkoutStatus","checkoutCompleted"),a.resolve("checkoutCompleted");else{var g=c.subViewModels.billMethodPreferenceViewModel.getBillMethodPreference(),h=this.get("orderData"),i=h.personalInformation,j=e.getBillSpecIdPayChannel(i);$.when(g,j).done(function(b,d){c.set("isEbillCus",b);var e=this.get("orderData");e.isEbillCus=b,this.set("orderData",e),"updateSuccess"===d?(c.subViewModels.deviceIdAndPlanIdInContextTopic.set("skipOF",!0),c.set("isFullCheckoutScenario",!0),c.set("checkoutStatus","checkoutCompleted"),a.resolve("checkoutCompleted")):"failure"===d&&c.onPersonalDetailsFailure(a)}.bind(this))}}else c.onPersonalDetailsFailure(a)}.bind(c))}},checkout:function(){var a=this.get("customerIds"),b=this.get("customerId");null!==a&&1===a.length&&null===b&&this.set("customerId",a[0]),this.validateConfiguration(),this.subViewModels.getDmpCommerceViewModel.getCartData(this.get("orderData"))},validateVouchers:function(){var a=this;a.set("microCartVmStatus","validateVouchers");var b=a.get("orderData");if(b&&b.order){var d=b.order.mobile;if(d&&d.length>0&&d[0].vouchers&&d[0].vouchers.length>0){var e=a.checkVoucherInOrder(d),f=a.getModel("validateOrderVouchersModel");if(f.set({contactId:a.subViewModels.individualInContextTopicViewModel.get("personId"),orderId:a.subViewModels.productOrderTopicViewModel.get("productOrderID")}),e){var g=a.subViewModels.productOrderTopicViewModel.get("orderActions"),h=[];c.each(d,function(a){var b,d=e[a.productOrderItemID],f=c.pluck(d,"idX8");c.each(g,function(c){c.productOrderItemID===a.productOrderItemID&&(b="Change"===c.orderType?"CH":"PR")}),h.push({orderActionId:a.productOrderItemID,voucherNumbersToValidate:f,orderActionType:b})});var i=a.subViewModels.customerInContextTopicViewModel.get("customerIds");i&&i.length>0&&(i=i[0]);var j={ImplValidateOrderVouchersRequest:{customerId:i,activityForConfiguration:"QuoteSDAllDiscounts",implVouchersForOrderActionList:h}};f.save(j,{success:c.bind(a.onValidateVouchersSuccess,a),error:c.bind(a.onValidateVouchersError,a)})}else a.validateConfiguration()}else a.validateConfiguration()}else a.validateConfiguration()},checkVoucherInOrder:function(a){var b=[];return c.each(a,function(a){a.vouchers&&a.vouchers.length>0&&c.each(a.vouchers,function(a){b.push(a)})}),c.groupBy(b,"productOrderItemID")},onValidateVouchersSuccess:function(a,b){var c=b.ImplValidateOrderVouchersResponse;!c.isValidationSuccess&&c.implVouchersForOrderActionList&&c.implVouchersForOrderActionList.length>0?this.set("microCartVmStatus","resetDetails"):this.validateConfiguration()},onValidateVouchersError:function(a,b){this.set("displayModalWindowFlag",!0),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("microCartVmStatus","failure")},updateContact:function(a,b,d,e,f,g){var h=this;g||(g=h.get("shoppingCartDeferred")||$.Deferred()),h.set("shoppingCartDeferred",null);var i,j=h.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"),k=!0,l=h.subViewModels.OnePassTopicViewModel.get("nric");if("staff"===j||"normal"===j){var m=h.subViewModels.deviceIdAndPlanIdInContextTopic.get("staffDetails");m&&(i=m.custId)}if(i&&i!==l&&(k=!1),k&&e&&e.custId&&e.custId!==l&&(k=!1),k){var n=h.subViewModels.deviceIdAndPlanIdInContextTopic.get("roiDetails");n&&n.nric&&n.nric!==l&&(k=!1)}if(k){h.set("checkoutStatus","");var o=h.getModel("UpdateContactModel"),p=h.subViewModels.OnePassTopicViewModel.get("newcustomer"),q=!1;!b&&!p||"undefined"!=typeof f&&null!==f&&f!==!1?o.setQueryParams({isAnonymous:!1}):(o.setQueryParams({isAnonymous:!0}),q=!0),o.set({customerId:d,orderId:h.get("productOrderReferenceNumber")});var r=h.subViewModels.productOrderTopicViewModel.get("orderActions")||h.get("orderActions"),s=this.subViewModels.productOrderTopicViewModel.get("updatedOrderActions");r=c.filter(r,function(a){return!c.contains(s,a.productOrderItemID)});var t=[],u=[];if(c.each(r,function(a){t.push({orderActionId:a.productOrderItemID,contactId:h.get("contactId"),userOnBehalf:"Online"}),u.push(a.productOrderItemID)}),t.length>0){var v={ImplAddCustomerContactRestInput:{orderAction:t}};o.save(v,{success:c.bind(h.onupdateContactSuccess,this,g,u,q,d,b),error:c.bind(h.onupdateContactError,this,g,a,b,d,e,f)})}else{var w=h.get("completeDataLoaded");w?(h.set("callReserveEquipment",!0),h.reserveEquipments(g)):(h.set("shoppingCartDeferred",g),h.set("callReserveEquipment",!0))}}else h.set("displayModalWindowFlag",!0),h.set("emptyCartStatus","emptyCartCompleted"),h.set("microCartVmStatus","fraudUser"),h.subViewModels.clearContextInContextTopic.clearAllTopics(!0),g.reject("fraudUser");return g},onupdateContactError:function(a,b,c,d,e,f,g,h){var i=this;f?i.onPersonalDetailsFailure(a):i.updateContact(b,!1,d,e,!0,a)},onupdateContactSuccess:function(a,b,d,e,f,g,h){var i=this,j=i.subViewModels.productOrderTopicViewModel.get("updatedOrderActions")||[];c.each(b,function(a){j.push(a)}),d&&(i.subViewModels.productOrderTopicViewModel.set("customerID",e),this.set("customerId",e)),i.subViewModels.productOrderTopicViewModel.set("updatedOrderActions",j);var k=i.get("isTVOrderRequired");if(k)i.set("shoppingCartDeferred",a),i.set("isTVOrderRequired",!1),i.createTVOrder();else{var l=i.get("completeDataLoaded");l||f?(i.set("callReserveEquipment",!0),i.reserveEquipments(a)):(i.set("shoppingCartDeferred",a),i.set("callReserveEquipment",!0))}},reserveEquipments:function(a){var b=this;if(b.set("microCartVmStatus","reserveEquipmentsStart"),b.get("callReserveEquipment")){"undefined"!=typeof a&&null!==a||(a=b.get("shoppingCartDeferred"));var d=b.subViewModels.reserveAllocateMTPOSEquipmentsViewModel;d.set("selectedFreebiesSkuIds",b.subViewModels.ShoppingCartViewModel.get("selectedFreebies")),d.set("selectedAccessoriesSkuIds",b.subViewModels.ShoppingCartViewModel.get("selectedAccessories"));var e=[],f=b.get("orderData");if(f&&f.order){var g=f.order.mobile;g&&g.length>0&&c.each(g,function(a){a.tradeIn&&e.push(a.tradeIn)}),d.set("tradeInDetails",e);var h=d._reserveEquipment();h.done(function(e){if(e&&e.allocationStatusX9&&e.allocationStatusX9.length>0){var f=e.allocationStatusX9,g=c.filter(f,function(a){return!a.allocationOKX9}),h=e.notAvailableDeviceDetails,i=e.notAvailableFreebiesDetails;if(g&&g.length>0||h&&h.length>0||i&&i.length>0){var j=b.get("selectedDevicesSkuIds")||e.selectedDevicesSkuIds,k=[];c.each(f,function(a){if(!a.allocationOKX9){var b=c.find(j,function(b){return a.itemCodeX9==b.sku});b&&k.push(b)}}),h&&h.length>0&&(k=k.concat(h));var l=b.getValueByPath("orderData.order.selectedFreebies"),m=[];l&&l.length>0&&c.each(l,function(a){var b=c.find(g,function(b){return b.itemCodeX9===a.skuId});("undefined"==typeof b||null===b)&&i&&i.length>0&&(b=c.find(i,function(b){return b.skuId===a.skuId})),b&&(b.productID=a.productID,b.productOrderItemID=a.productOrderItemID,b.name=a.name,m.push(b))});var n=b.get("orderData");if(k&&k.length>0){n.numberOfOutOfStockItems=k.length;var o=[],p=[],q=n.order.mobile;c.each(k,function(a){var b="device";q&&c.each(q,function(c){if(c.orderDetails&&c.orderDetails.orderActionId===a.productOrderItemID&&c.planDetails&&c.planDetails.length>0){var d=c.planDetails[0].planName;d&&d.toUpperCase().indexOf("BROADBAND")>-1&&(b="tablet")}});var d=c.contains(p,a.title);o.push({name:a.title,productOrderItemID:a.productOrderItemID,id:b,hide:d}),p.push(a.title)}),n.informationListItems=o}if(m&&m.length>0){b.set("freebiesFailed",m),b.subViewModels.productOrderTopicViewModel.set("freebiesFailed",m);var r=b.subViewModels.OnePassTopicViewModel.get(),s=b.subViewModels.ImplUserContextTopicViewModel.getValueByPath("userInfo.contactDetails"),t=b.getCustomerIdType(r.customerIdType),u={ImplUpdateOrderActionCharacteristicsRequest:{productSpecContainmentId:"11812",implUpdateOrderActionCharacteristics:[{id:"8482",value:r.familyName||s.registeredName},{id:"8502",value:t},{id:"8492",value:r.nric}]}},v=b.getModel("updateCharacteristicsRequestModel");v.set({contactId:b.subViewModels.individualInContextTopicViewModel.get("personId"),orderId:b.subViewModels.productOrderTopicViewModel.get("productOrderID")}),v.save(u,{success:c.bind(b.removeFreebieFromOrder,b,m,a,!0),error:c.bind(b.onPersonalDetailsFailure,b,a)})}b.set("orderData",n),k&&k.length>0&&b.set("microCartVmStatus","deviceReservedFailed")}else b.set("microCartVmStatus","deviceReserved"),b.validateConfigurationForNonAnonymous(a)}else if("success"===e){var w=d.get("removedItemDetails");b.set("removedItemDetails",w),b.validateConfigurationForNonAnonymous(a)}else if(e&&e.notAvailableDeviceDetails&&e.notAvailableDeviceDetails.length>0){var j=b.get("selectedDevicesSkuIds")||e.selectedDevicesSkuIds,h=e.notAvailableDeviceDetails,n=b.get("orderData");if(h&&h.length>0){n.numberOfOutOfStockItems=h.length;var o=[],p=[],q=n.order.mobile;c.each(h,function(a){var b="device";c.each(q,function(c){if(c.orderDetails&&c.orderDetails.orderActionId===a.productOrderItemID&&c.planDetails&&c.planDetails.length>0){var d=c.planDetails[0].planName;d&&d.toUpperCase().indexOf("BROADBAND")>-1&&(b="tablet")}});var d=c.contains(p,a.title);o.push({name:a.title,productOrderItemID:a.productOrderItemID,id:b,hide:d}),p.push(a.title)}),n.informationListItems=o,b.set("orderData",n),b.set("microCartVmStatus","deviceReservedFailed"),a.resolve("deviceReservedFailed")}}else if(e&&e.notAvailableAccessoriesDetails&&e.notAvailableAccessoriesDetails.length>0){var x=e.notAvailableAccessoriesDetails,n=b.get("orderData");if(x&&x.length>0){var o=[],p=[],q=n.order.mobile;c.each(x,function(a){var b="accessory",d=c.contains(p,a.name);o.push({name:a.name,productOrderItemID:a.productOrderItemID,productID:a.productID,id:b,hide:d}),p.push(a.name)});var i=e.notAvailableFreebiesDetails;i&&i.length>0&&c.each(i,function(a){var b="accessory",d=c.contains(p,a.name);o.push({name:a.name,productOrderItemID:a.productOrderItemID,productID:a.productID,id:b,hide:d}),p.push(a.name)}),n.informationListItems=o,b.set("orderData",n),b.set("microCartVmStatus","accessoryReservedFailed"),a.resolve("accessoryReservedFailed")}}}.bind(b)),h.fail(function(c){b.onPersonalDetailsFailure(a)}.bind(b)),b.set("callReserveEquipment",!1)}else b.set("shoppingCartDeferred",a)}else b.set("completeDataLoaded",!0)},updateVouchers:function(){var a,a,b=this,d=b.getValueByPath("selectedShoppingCartVouchers.vouchers"),e=b.getValueByPath("selectedShoppingCartVouchers.flag"),f=b.subViewModels.productOrderTopicViewModel.get("orderActions");if(e){if(d&&d.length){var g=[],h=c.groupBy(d,"productOrderItemID");c.each(h,function(a,b){var d=[];c.each(a,function(a){d.push(a.selectedVouchers.idX8)});var e;c.each(f,function(a){a.productOrderItemID===b&&(e="Change"===a.orderType?"CH":"PR")}),g.push({orderActionId:b,voucherIdsToAdd:d,orderActionType:e})}),a={ImplUpdateOrderWithVoucherRequest:{customerId:b.subViewModels.productOrderTopicViewModel.get("customerID"),implVouchersForOrderActionList:g,isCallProductOrderQuote:!1}}}}else{var i,j=b.getValueByPath("selectedShoppingCartVouchers.removeVouchers");c.each(f,function(a){a.productOrderItemID===j[0].orderActionId&&(i="Change"===a.orderType?"CH":"PR")}),a={ImplUpdateOrderWithVoucherRequest:{customerId:b.subViewModels.productOrderTopicViewModel.get("customerID"),implVouchersForOrderActionList:[{orderActionId:j[0].orderActionId,voucherIdsToRemove:[j[0].voucherIdsToRemove],orderActionType:i}],isCallProductOrderQuote:!1}}}var k=b.getModel("UpdateOrderWithVouchersModel");k.set({contactId:b.subViewModels.individualInContextTopicViewModel.get("personId"),orderIdReference:b.subViewModels.productOrderTopicViewModel.get("productOrderReferenceNumber")}),k.save(a,{success:c.bind(b.onUpdateVouchers,b),error:function(a,c){b.set("microCartVmStatus","error")}})},onUpdateVouchers:function(a,b){var d=this;if(d.get("productOrderReferenceNumber")&&""!=d.get("productOrderReferenceNumber")){var e=d.subViewModels.productOrderTopicViewModel.get("orderActions"),f=[];c.each(e,function(a){a.lob&&f.push(a.lob)}),d.set("lobs",f),d.subViewModels.ShoppingCartViewModel.set("isShoppingCartFlag",!0);var g=d.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);g.done(function(a){if("SUCCESS"===a){var b=this.get("orderData")||{},c=sessionStorage.getItem("removedVouchers");c&&(c=JSON.parse(c)),c&&c.length>0&&d.setRemovedVouchersInOrder(c,b.order.mobile),b.order=d.subViewModels.ShoppingCartViewModel.getValueByPath("orderData.order"),b.orderDataIsLoaded=!0,d.set("orderData",b);var e=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("changeCartflag");"deviceDetails"===e&&d.set("changeDeviceStatus","vouchersRemoved"),d.set("microCartVmStatus","resetDetails")}}.bind(d)),g.fail(function(a){d.set("microCartVmStatus","failure")}.bind(d))}else d.set("displayModalWindowFlag",!0),d.set("emptyCartStatus","emptyCartCompleted"),d.set("microCartVmStatus","failure"),d.subViewModels.clearContextInContextTopic.clearAllTopics(!0)},setRemovedVouchersInOrder:function(a,b){c.each(b,function(a){var b=[],d=c.filter(b,function(b){return a.productOrderItemID==b.orderActionId});d&&d.length>0&&(a.removedVouchers=d)})},onCartItemChange:function(){var a=this.get("selectedOrderItemId"),b=this,d=b.subViewModels.productOrderTopicViewModel.get("orderActions");if(a&&d){var e=[],f=[],g=a.productOrderItemID;if("undefined"==typeof g||null===g?e=a.productOrderItemIDs:e.push(g),e&&e.length>0){var h,i,f=[];c.each(d,function(a){c.contains(e,a.productOrderItemID)&&(f.push(a),"TV"===a.lob?h=a.productOrderItemID:"FV"===a.lob&&(i=a.productOrderItemID))}),b.subViewModels.productOrderTopicViewModel.set("currentOrderActions",f);var j=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("oneClickData");if(b.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),h){var k=b.subViewModels.ShoppingCartViewModel.get("selectedTVPlans");if(k){var l=k[h];l&&l.length>0&&b.subViewModels.deviceIdAndPlanIdInContextTopic.set("packType",l[0])}}else i?b.subViewModels.deviceIdAndPlanIdInContextTopic.set("numberType","LANDLINE"):b.subViewModels.deviceIdAndPlanIdInContextTopic.set("numberType","WIRELESS");j&&b.subViewModels.deviceIdAndPlanIdInContextTopic.set("oneClickData",j)}}},populateRemovedAddonObject:function(a,b,d,e,f,g,h){var i=this,j=b.removeComponentList,k=b.removeParentForLastChildList;g&&(j=b.removeComponentDiscountList,k=b.removeParentForLastChildDiscountList);var l=!1;if("BB"===a.lob){var m=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");m&&m.productID===a.productID&&(l=!0)}if(l||a.productID&&c.contains(j,a.productSpecContainmentID))d.push({productID:a.productID});else if(a.productID&&c.contains(k,a.productSpecContainmentID)){var n=i.get("allAddons"),o=c.filter(n,function(b){return b.parentProductSpecContainmentID===a.parentProductSpecContainmentID});o&&1===o.length?d.push({productID:a.parentProductID}):d.push({productID:a.productID})}else{var p={billingOfferID:a.billingOfferID,productSpecPricingID:a.productSpecPricingID};e.push(p)}a.specialAddon&&a.mainProductId&&f.push({productID:a.mainProductId,changedCharacteristics:[{characteristicID:"12373511",value:"No"}]})},removeSelectedAddons:function(){var a=this;a.set("microCartVmStatus","removeSelectedAddons");var b=a.get("selectedAddons"),c=a.get("removeComponents"),d="SD Add Comp Stage",e=[],f=[],g=[],h=[];if("WS"===b.lob){var i=a.subViewModels.getCustomerIdValueViewModel.calculateSpecialDiscount(b.specialDiscounts,b.deviceBrandName,b.planCode,b.transactionType,b.dataX3,b.dataXinfinity,b.customerType,b.deviceType);i=i?i:"EMPTY",d=d+"+++promoCode+++"+i}else d+="+++promoCode+++EMPTY";var j=a.subViewModels.getCustomerIdValueViewModel.createPromoString(b.planCode,b.deviceBrandName,b.deviceModelName,b.transactionType,b.ciTier,b.customerType,b.subSegment,b.selectedAddonIds);j&&""!==j&&(d+=j),"addon"===b.type?(a.populateRemovedAddonObject(b,c,e,f,g,!1,h),b.discountItem&&a.populateRemovedAddonObject(b.discountItem,c,e,f,g,!0,h)):"sps"===b.type&&(e.push({productID:b.productID}),b.removeParent&&b.parentProductID&&e.push({productID:b.parentProductID}));var k={removedContainedProducts:e,changedContainedProducts:g,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:h,newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:f,resumedContainedProducts:[]},l={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:d,confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[k],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},m=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration(b.lob,l,b.productOrderItemID);m.done(function(b){if("undefined"!=typeof b.UpdateProductInOrderConfigurationResponse){var c=b.UpdateProductInOrderConfigurationResponse;if(c.productConfiguration&&"BLOCKING"===c.productConfiguration.compatibilityStatus)return a.set("microCartVmStatus","error"),!1;var d=a.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);d.done(function(b){"SUCCESS"===b&&a.set("microCartVmStatus","resetDetails")}.bind(a)),d.fail(function(b){a.set("microCartVmStatus","error")}.bind(a))}}.bind(a)),m.fail(function(b){a.set("microCartVmStatus","error")}.bind(a))},removeSelectedSetTopBox:function(){var a=this;a.set("microCartVmStatus","removeSelectedSetTopBox");var b=a.get("selectedSettopBox"),c=[{productSpecContainmentID:b.productSpecContainmentID,productID:b.productID,changedCharacteristics:[{characteristicID:8631732,value:b.value}]}],d={removedContainedProducts:c,changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]},e={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"SD Add Comp Stage",confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[d],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},f=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("TV",e,b.productOrderItemID);f.done(function(b){if("undefined"!=typeof b.UpdateProductInOrderConfigurationResponse){var c=b.UpdateProductInOrderConfigurationResponse;if(c.productConfiguration&&"BLOCKING"===c.productConfiguration.compatibilityStatus)return a.set("microCartVmStatus","error"),
!1;a.set("microCartVmStatus","resetDetails")}}.bind(a)),f.fail(function(b){a.set("microCartVmStatus","error")}.bind(a))},removeMultiCartItem:function(){var a=this,b=a.get("orderToBeRemoved");if(null!==b){var d=a.subViewModels.productOrderTopicViewModel,e=d.get("orderActions"),f=[];"bundle"!==b.lineOfBusiness&&"Bundle"!==b.lineofBusiness||a.removeBroaband(e,f),"mobile"===b.lob&&f.push(b.productOrderItemID),"TV"!==b.lineOfBusiness&&"TV"!==b.lob&&"tv"!==b.lob||a.removeTV(e,f);var g,h=d.get("customerID"),i=d.get("productOrderID");h?(g=a.models.customerProductOrderProductOrderItemsModel,g.set("customerId",h)):g=a.models.anonymousProductOrderProductOrderItemsModel,g.set("productOrderId",i),a.setDefaultQueryParams(g),g.setQueryParams({poi:f}),g.set("id",f[0]),g.destroy({success:c.bind(a._handleMutliCartRemoveSuccess,a,f),error:c.bind(a._handleMutliCartRemoveFailure,a)})}},removeBroaband:function(a,b){c.each(a,function(a){"FIBER"===a.flowType&&("WS"===a.lob&&b.push(a.productOrderItemID),"FV"===a.lob&&b.push(a.productOrderItemID),"BB"===a.lob&&b.push(a.productOrderItemID))})},removeTV:function(a,b){c.each(a,function(a){"TV"===a.flowType&&"TV"===a.lob&&b.push(a.productOrderItemID)})},_handleMutliCartRemoveSuccess:function(a,b,d){var e=this;if(a&&a.length>0){var f=e.subViewModels.productOrderTopicViewModel,g=f.get("orderActions");g&&g.length>0&&(g=c.filter(g,function(b){return!c.contains(a,b.productOrderItemID)}),f.set("orderActions",g),f.set("currentOrderActions",null))}e.set("continueShoppingStatus","multiItemRemoveDone")},_handleMutliCartRemoveFailure:function(){this.set("continueShoppingStatus","failure")},sendEmailToCustomer:function(){var a=this,b=[],c=a.get("registerInterest"),d=c.address,e=a.subViewModels.storeContextDataViewModel.get(),f=a.subViewModels.miniCartInContextTopic.getValueByPath("flowData.planName"),g=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId"),h=a.subViewModels.orderInContextTopicViewModel.get("productOrderID"),i=a.subViewModels.OnePassTopicViewModel.get();!g&&e.deviceTopicValues&&(g=e.deviceTopicValues.planId),!f&&e.miniCartTopicValues&&(f=e.miniCartTopicValues.planName),!h&&e.orderContextValues&&(h=e.orderContextValues.productOrderID);var j,k;i&&i.nric&&null!==i.nric&&""!==i.nric?(j=i.nric,k=i.customerIdType):(j=c.customerIdNumberPrefix+c.customerIdNumber,k=c.customerIdType);var l=c.customerName;new Date;b.push({key:"customerIC",value:j},{key:"customerName",value:l},{key:"custContactNo",value:c.contactNumber},{key:"custEmailId",value:c.emailId},{key:"custContactNo",value:c.contactNumber},{key:"planId",value:g},{key:"planName",value:f},{key:"addrBlock",value:d.blockOrHouseNum||"NA"},{key:"addrStreetName",value:d.streetName||"NA"},{key:"addrUnitNo",value:d.unitNo||d.apartment},{key:"addrPostalCode",value:d.postCode||d.postcode||"NA"},{key:"mainCoverageStatus",value:"NA"},{key:"subCoverageStatus",value:"NA"},{key:"transaction",value:"NA"},{key:"plan",value:f},{key:"orderId",value:h});var m={ImplSendNotificationRequest:{target:[c.emailId],templateId:c.templateId,notificationChannel:"EMAIL",templateSimpleParameters:b,templateURLParameters:[]}};a.getModel("implSendNotificationModel").save(m,{success:function(b,c){a.set("continueShoppingStatus","mailSent")},error:function(b,c){a.set("continueShoppingStatus","failure")}})},removeAccessoriesFromOrder:function(){var a=this,b=$.Deferred();a.set("microCartVmStatus","removeAccessoriesFromOrder");var d=a.get("isPortinAttributeSet");if(d)a.removeAccessoriesFromOrderImpl();else{var e=a.subViewModels.OnePassTopicViewModel.get(),f=a.subViewModels.ImplUserContextTopicViewModel.getValueByPath("userInfo.contactDetails"),g=a.getCustomerIdType(e.customerIdType),h={ImplUpdateOrderActionCharacteristicsRequest:{productSpecContainmentId:"11812",implUpdateOrderActionCharacteristics:[{id:"8482",value:e.familyName||f.registeredName},{id:"8502",value:g},{id:"8492",value:e.nric}]}},i=a.getModel("updateCharacteristicsRequestModel");i.set({contactId:a.subViewModels.individualInContextTopicViewModel.get("personId"),orderId:a.subViewModels.productOrderTopicViewModel.get("productOrderID")}),i.save(h,{success:c.bind(a.removeAccessoriesFromOrderImpl,a,b),error:c.bind(a.onPersonalDetailsFailure,a,b)})}return b},removeAccessoriesFromOrderImpl:function(a){var b=this;a||(a=$.Deferred());var d=!0;b.set("isPortinAttributeSet",!0),b.set("microCartVmStatus","removeAccessoriesFromOrder");var e=b.get("orderData").informationListItems,f=c.groupBy(e,"productOrderItemID"),g=[];return f&&(c.map(f,function(a,d){if(d){var e=c.uniq(a,function(a,b,c){return a.productID}),f=[];e&&e.length>0&&c.each(e,function(a){f.push({productID:a.productID})});var h={removedContainedProducts:f,changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]},i={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"SDRulesForCheckout",confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[h],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},j=b.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("WS",i,d);g.push(j)}}),$.when.apply(b,g).done(function(){if(b.get("isGoToAccessory"))b.onCartItemChange(),b.set({isGoToAccessory:!1,microCartVmStatus:"navigateToAccessoryPage"});else{b.subViewModels.ShoppingCartViewModel.set("isShoppingCartFlag",!0),b.subViewModels.ShoppingCartViewModel.set("selectedDevices",{}),b.subViewModels.ShoppingCartViewModel.set("selectedFreebies",null);var c=b.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);c.done(function(c){if("SUCCESS"===c){var e=b.get("orderData")||{};e.order=b.subViewModels.ShoppingCartViewModel.getValueByPath("orderData.order"),e.order.selectedDevices=b.subViewModels.ShoppingCartViewModel.get("selectedDevices"),e.order.selectedFreebies=b.subViewModels.ShoppingCartViewModel.get("selectedFreebies"),e.fireEvent=d,b.set("orderData",e),b.set("microCartVmStatus","shopingCartLoaded"),a.resolve("SUCCESS")}}.bind(b)),c.fail(function(c){b.set("displayModalWindowFlag",!1),b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("emptyCartStatus","emptyCartCompleted"),a.reject("failure")}.bind(b))}}.bind(b))),a},removeFreebieFromOrder:function(a,b,d){var e=this;d&&d===!0?e.set("isPortinAttributeSet",!0):e.set("isPortinAttributeSet",!1),e.set("microCartVmStatus","removeFreebieFromOrder");var f=c.groupBy(a,"productOrderItemID"),g=[];f&&c.map(f,function(a,b){if(b){var d=c.uniq(a,function(a,b,c){return a.productID}),f=[];d&&d.length>0&&c.each(d,function(a){f.push({productID:a.productID})});var h={removedContainedProducts:f,changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]},i={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:"QuoteSDOrderSummary",confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[h],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},j=e.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("WS",i,b),k=e.subViewModels.productOrderTopicViewModel.get("orderActions");k&&k.length>0&&(c.each(k,function(a){if(a.productOrderItemID===b){var e=a.freebiesRemoved||[];c.each(d,function(a){e.push({name:a.name})}),a.freebiesRemoved=e}}),e.subViewModels.productOrderTopicViewModel.set("orderActions",k)),g.push(j)}}),$.when.apply(e,g).done(function(){e.validateConfigurationForNonAnonymous(b)}.bind(e))},setFreebiesInOrder:function(a,b){c.each(a,function(a){var d=c.filter(b,function(b){return a.productOrderItemID==b.productOrderItemID});d&&d.length>0&&(a.unAvailableFreeGifts=d)})},cancelOutOfStockItem:function(a){var b=this;a=!0;var d=$.Deferred();b.set("microCartVmStatus","cancelOutOfStockItem");var e,f=b.get("orderData").informationListItems,g=b.subViewModels.productOrderTopicViewModel,h=g.get("customerID"),i=g.get("productOrderID");e=b.models.customerProductOrderProductOrderItemsModel,e.set("customerId",h),e.set("productOrderId",i),b.setDefaultQueryParams(e);var j=[];return c.each(f,function(a){j.push(a.productOrderItemID)}),e.setQueryParams({poi:j}),e.set("id",j[0]),e.destroy({success:c.bind(b._processOutput,b,j,a,d),error:c.bind(b._handleEmptyCartFailure,b,d)}),d},_processOutput:function(a,b,d,e,f){var g=this,h=g.subViewModels.productOrderTopicViewModel.get();if(h.orderActions&&h.orderActions.length>0){var i=c.filter(h.orderActions,function(b){return!c.contains(a,b.productOrderItemID)});if(g.subViewModels.productOrderTopicViewModel.set("orderActions",i),g.subViewModels.productOrderTopicViewModel.set("currentOrderActions",null),i&&0===i.length)g._handleEmptyCartSuccess(d);else{g.subViewModels.ShoppingCartViewModel.set("isShoppingCartFlag",!0),g.subViewModels.ShoppingCartViewModel.set("selectedDevices",{}),g.subViewModels.ShoppingCartViewModel.set("selectedFreebies",null);var j=g.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);j.done(function(a){if("SUCCESS"===a){var c=g.get("orderData")||{};c.order=g.subViewModels.ShoppingCartViewModel.getValueByPath("orderData.order"),c.order.selectedDevices=g.subViewModels.ShoppingCartViewModel.get("selectedDevices"),c.order.selectedFreebies=g.subViewModels.ShoppingCartViewModel.get("selectedFreebies"),c.fireEvent=b,g.set("orderData",c),g.set("microCartVmStatus","shopingCartLoaded"),d.resolve("SUCCESS")}}.bind(g)),j.fail(function(a){g.set("displayModalWindowFlag",!1),g.subViewModels.clearContextInContextTopic.clearAllTopics(!0),g.set("emptyCartStatus","emptyCartCompleted"),d.reject("failure")}.bind(g))}}},unReserveVouchersAction:function(){var a=this,b=a.get("reservedVouchersList"),d=[];c.each(b,function(a){d.push({voucherNoX8:a.voucherNoX8})});var e={flag:!1,voucherList:d},f=a.getModel("applyVoucherModel");f.set("contactId",a.subViewModels.individualInContextTopicViewModel.get("personId")),f.save({ImplManageVoucherResInput:e},{success:function(){a.set("microCartVmStatus","ureservedSuccessfull")},error:function(){a.set("microCartVmStatus","failure")}})}});return Q});
define("businesswidget/repository_l9_common/common/model/ImplProductConfigurationOptionsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product/:assignedProductId/product-configuration-options",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["RetrieveProductConfigurationRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplSpecialAddonHandlingViewModel",["lightsaber","businesswidget/repository_l9_common/common/core/Configuration"],function (a,b){var c=a.Core.ObservableViewModel.extend({defaults:{vasSpecialHandlingOn:!1,BB:{freeInternetFilterBoCatlogId:"12357531",freeInternetFilterAddedCharacteristicCatlogId:"12373531",internetFilterDecisionCharacteristicCatlogId:"12373511",internetFilterComponentCatlogIds:["12650391","14396101"],main:"Broadband Main",mainCatlogId:"8625612",updateDefaultUserNameOnComponents:[{productSpecId:"8625512_DISCARD",catlogId:"8623732_DISCARD",enabled:!0,visible:!0,name:"Security Suite_DISCARD",displayFormat:"DROPDOWN_LISTBOX"},{productSpecId:"8625502_DISCARD",catlogId:"8623702_DISCARD",enabled:!0,visible:!0,name:"Family Protection_DISCARD",displayFormat:"DROPDOWN_LISTBOX"},{productSpecId:"9620723",catlogId:"8623882",enabled:!0,visible:!0,name:"Anti-Virus",displayFormat:"DROPDOWN_LISTBOX"},{productSpecId:"9620623",catlogId:"8623852",enabled:!0,visible:!0,name:"Anti-Spam",displayFormat:"DROPDOWN_LISTBOX"}],updateCharacteristicsComponents:[{productSpecId:"8625512",catlogId:"8623732",name:"Security Suite",characteristics:[{charId:"12171391",enabled:!1,visible:!0,name:"License Type",displayFormat:"DROPDOWN_LISTBOX"}]}],billingOfferCharConfgurtaion:[{productSpecPricingID:"9620353",catlogId:"8796222",name:"Security Suite (MacOS) (CT: 0)",action:"update",charConfig:[{charId:"12171391",enabled:!1,visible:!0,name:"License Type",value:"Mac",displayFormat:"DROPDOWN_LISTBOX"}]},{productSpecPricingID:"9620383",catlogId:"8796212",name:"Security Suite (WinOS) (CT: 0)",action:"update",charConfig:[{charId:"12171391",enabled:!1,visible:!0,name:"License Type",value:"Windows",displayFormat:"DROPDOWN_LISTBOX"}]}],userNameCharId:"8622642",emailComponentProductSpecId:"8625582"},WS:{freeInternetFilterBoCatlogId:"12357521",freeInternetFilterAddedCharacteristicCatlogId:"12373531",internetFilterDecisionCharacteristicCatlogId:"12373511",internetFilterComponentCatlogIds:["11982"],main:"Mobile Main",mainCatlogId:"8363682",drsComponentCatlogId:"11495051",drs100MBComponentCatlogId:"11495061",endDateCharacteristicCatlogId:"8128562",readyRoamCompCatlogIdList:["14418321"],removeCatelogItems:[{catlogId:"10321931",name:"Mobile One time Bill Rebate for DataRoam Pass - $19"},{catlogId:"10322021",name:"Mobile One time Bill Rebate for DataRoam Pass - $20"},{catlogId:"10322031",name:"Mobile One time Bill Rebate for DataRoam Pass - $30"},{catlogId:"10322011",name:"Mobile One time Bill Rebate for DataRoam Saver (Daily) plan - $15"},{catlogId:"10322041",name:"Mobile One time Bill Rebate for DataRoam Saver Travel Pass - $45"},{catlogId:"103219410",name:"Mobile One time Bill Rebate for DataRoam Saver plan - $100"}],updateCharacteristicsComponents:[{productSpecId:"9752",catlogId:"8027002",name:"Messaging",characteristics:[{charId:"8462",enabled:!1,visible:!0,name:"Muslim Prayer",displayFormat:"DROPDOWN_LISTBOX"}]}],billingOfferCharConfgurtaion:[{productSpecPricingID:"10893501",catlogId:"10893501",name:"SMS Plus Services VAS (Unlimited Activity)",action:"update",charConfig:[{charId:"8462",enabled:!1,visible:!0,name:"Muslim Prayer",value:"No",displayFormat:"DROPDOWN_LISTBOX"}]}]},freeInternetFilterAddedCharacteristicValYes:"Yes",freeInternetFilterAddedCharacteristicValNo:"No",parentVMContext:null},initialize:function(){var a=window.location.href.indexOf("vasspecialhandlingon")!==-1||b.get("vasSpecialHandlingOn");this.set("vasSpecialHandlingOn",a)},isFreeInternetAdded:function(a){var b=a.allProductsByCatalogId[this.getValueByPath(a.lineOfBusiness+".mainCatlogId")],c=b.allCharacteristics,d=this.getValueByPath(a.lineOfBusiness+".freeInternetFilterAddedCharacteristicCatlogId"),e=null;if(c&&c.length)for(var f=0;f<c.length;f++)if(c[f].productSpecCharacteristicID===d){e=c[f];break}return!!e&&!(!e.value||e.value!==this.get("freeInternetFilterAddedCharacteristicValYes"))},handleSpecialConditionsAfterRetrieve:function(a){return"BB"===a.lineOfBusiness?(a=this.applyMDAFilter(a),this.get("vasSpecialHandlingOn")&&(a=this.applyUpdateDefaultUserNameOnComponentsFilter(a),a=this.applyUpdateCharacteristicsComponentsFilter(a))):"WS"===a.lineOfBusiness&&(a=this.applyMDAFilter(a),a=this.applyDRSFilter(a),a=this.applyDRS100MBFilter(a),a=this.applyReadyRoamFilter(a),this.get("vasSpecialHandlingOn")&&(a=this.applyUpdateCharacteristicsComponentsFilter(a),a=this.applyRemoveCatelogItemsFilter(a))),a},applyRemoveCatelogItemsFilter:function(a){for(var b=this.getValueByPath(a.lineOfBusiness+".removeCatelogItems"),c=0;c<b.length;c++){var d=b[c];delete a.allProductsByCatalogId[d.catlogId]}return a},applyUpdateCharacteristicsComponentsFilter:function(a){for(var b=this.getValueByPath(a.lineOfBusiness+".updateCharacteristicsComponents"),c=0;c<b.length;c++){var d=b[c],e=d.name,f=a.allProductsByCatalogName[e];if(f&&f.allCharacteristics)for(var g=0;g<f.allCharacteristics.length;g++){var h=f.allCharacteristics[g],i=_.find(d.characteristics,function(a){return a.charId==h.productSpecCharacteristic.ID});i&&(h.displayInformation.enabled=i.enabled,h.displayInformation.visible=i.visible,i.displayFormat&&(h.displayInformation.displayFormat=i.displayFormat),i.value&&!h.value&&(h.value=i.value))}}return a},applyUpdateDefaultUserNameOnComponentsFilter:function(a){var b=this.getValueByPath(a.lineOfBusiness+".userNameCharId"),c=this.getValueByPath(a.lineOfBusiness+".emailComponentProductSpecId"),d=_.filter(a.implementedProductByAssignedProductId,function(a){return a.productSpecContainmentID===c}),e=_.map(d,function(a){var c=_.find(a.allCharacteristics,function(a){return a.productSpecCharacteristic.ID===b});return{value:c.value,valueForDisplay:c.value}});if(e.length)for(var f=a.serviceID,g=this.getValueByPath(a.lineOfBusiness+".updateDefaultUserNameOnComponents"),h=0;h<g.length;h++){var i=g[h],j=i.name,k=a.allProductsByCatalogName[j];if(k&&k.allCharacteristics)for(var l=0;l<k.allCharacteristics.length;l++){var m=k.allCharacteristics[l];m.productSpecCharacteristic.ID==b&&(m.displayInformation.displayFormat=i.displayFormat,m.displayInformation.enabled=e.length>1,m.displayInformation.visible=i.visible,m.value||(m.value=f),m.productSpecCharacteristic.defaultValue={value:f},m.productSpecCharacteristic.values=e)}}return a},applyReadyRoamFilter:function(a){for(var b=this.getValueByPath(a.lineOfBusiness+".readyRoamCompCatlogIdList"),c=0;c<b.length;c++){var d=b[c],e=a.implementedProductByCatlogId[d];if(e){var f=e.optedBillingOffersIds;if(f)for(var g=0;g<f.length;g++){billingOfferId=f[g];var h=a.implementedProductByAssignedProductId[billingOfferId];h.allowedActions.RM=!1}}}return a},applyDRSFilter:function(a){var b=this.getValueByPath(a.lineOfBusiness+".drsComponentCatlogId"),c=a.allProductsByCatalogId[b];return this.updateDRSComponentChars(c),a},applyDRS100MBFilter:function(a){var b=this.getValueByPath(a.lineOfBusiness+".drs100MBComponentCatlogId"),c=a.allProductsByCatalogId[b];return this.updateDRSComponentChars(c),a},updateDRSComponentChars:function(a){if(a&&a.characteristics)for(var b=a.characteristics,c=0;c<b.length;c++)"8128572"!==b[c].productSpecCharacteristicID&&"8034942"!==b[c].productSpecCharacteristicID||(b[c].displayInformation.enabled=!0,b[c].displayInformation.visible=!0)},applyMDAFilter:function(a){var b=this.getValueByPath(a.lineOfBusiness+".freeInternetFilterBoCatlogId");if(this.isFreeInternetAdded(a))delete a.availableProductByCatlogId[b],delete a.allProductsByCatalogId[b];else{var c=a.allProductsByCatalogId[b];if(c){var d=a.allProductsByCatalogId[c.parentProductSpecContainmentID];if(billingOffers=d.billingOffers,billingOffers&&billingOffers.length)for(var e=0;e<billingOffers.length;e++)billingOffers[e]!=b&&(delete a.availableProductByCatlogId[billingOffers[e]],delete a.allProductsByCatalogId[billingOffers[e]])}}return a},updatePayloadForSpecialAddons:function(a,b){return"BB"===b.lineOfBusiness?(a=this.updateMDAConfiguraion(a,b),this.get("vasSpecialHandlingOn")&&(a=this.updateComponentConfigForBo(a,b))):"WS"===b.lineOfBusiness&&(a=this.updateMDAConfiguraion(a,b),a=this.updateDRSConfiguration(a,b),this.get("vasSpecialHandlingOn")&&(a=this.updateComponentConfigForBo(a,b))),a=this.removeCatlogIdFromInput(a)},removeCatlogIdFromInput:function(a){var b=a.productChanges[0];return _.each(b.newAssignedBillingOffers,function(a){delete a.catlogId}),_.each(b.newContainedProducts,function(a){delete a.catlogId}),_.each(b.newSimpleProducts,function(a){delete a.catlogId}),_.each(b.changedContainedProducts,function(a){delete a.catlogId}),_.each(b.changedContainedProducts,function(a){delete a.catlogId}),a},updateComponentConfigForBo:function(a,b){var c=this.getValueByPath(b.lineOfBusiness+".billingOfferCharConfgurtaion");if(c)for(var d=0;d<c.length;d++){var e=c[d];if(e){var f=_.find(a.productChanges[0].newAssignedBillingOffers,function(a){return a.catlogId==e.catlogId});if(f&&"update"===e.action&&e.charConfig)for(var g=0;g<e.charConfig.length;g++){var h=e.charConfig[g];_.each(a.productChanges[0].newContainedProducts,function(a){_.each(a.changedCharacteristics,function(a){a.characteristicID==h.charId&&(a.value=h.value)})})}}}return a},updateDRSConfiguration:function(a,b){var c=this.getValueByPath(b.lineOfBusiness+".endDateCharacteristicCatlogId"),d=a.productChanges[0].newContainedProducts;return _.each(d,function(a){_.each(a.changedCharacteristics,function(a){a.characteristicID===c&&(a.value=null)})}),a},updateMDAConfiguraion:function(a,b){var c=a.productChanges[0],d=this.getValueByPath(b.lineOfBusiness+".mainCatlogId"),e=b.allProductsByCatalogId[d],f=null,g=c.newAssignedBillingOffers;if(g.length)for(var h=0;h<g.length;h++){var i=g[h],j=this.getValueByPath(b.lineOfBusiness+".internetFilterComponentCatlogIds");j.indexOf(i.parentProductSpecContainmentID)!==-1&&(f={changedCharacteristics:[{characteristicID:this.getValueByPath(b.lineOfBusiness+".internetFilterDecisionCharacteristicCatlogId"),value:this.getValueByPath("freeInternetFilterAddedCharacteristicValYes")}],productID:e.productID,temporaryID:this.generateTemporaryId()},c.changedContainedProducts.push(f))}var k=c.removedAssignedBillingOffers;if(k.length)for(var h=0;h<k.length;h++){var i=k[h],l=b.implementedProductByAssignedProductId[i.billingOfferID];l.parentProductSpecContainmentID==this.getValueByPath(b.lineOfBusiness+".internetFilterComponentCatlogId")&&(f={changedCharacteristics:[{characteristicID:this.getValueByPath(b.lineOfBusiness+".internetFilterDecisionCharacteristicCatlogId"),value:this.getValueByPath("freeInternetFilterAddedCharacteristicValNo")}],productID:e.productID,temporaryID:this.generateTemporaryId()},c.changedContainedProducts.push(f))}return a},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"D-"+a}});return c});
define("businesswidget/repository_l9_common/common/model/ImplValidateVasModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/express-otp/ecommerce/validate-vas",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplValidateVASResInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ImplSendExpressOTPModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/express-otp/user/send-express-otp",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplSendExpressOTPInput"]}}}});return d;
});
define("businesswidget/repository_l9_common/common/model/ImplValidateExpressOTPModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/express-otp/user/verify-express-otp",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplVerifyExpressOTPInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ImplManageOTPVasModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/express-otp/manage/vas",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplManageVasResInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ImplSubmitOrderOTPVasModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/express-otp/submit-order",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplSubmitVasOrderInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/ImplMstaLoginModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"/msta-login",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplMstaLoginRequest"],qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/ImplExpressOTPViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/ImplValidateVasModel","single!businesswidget/repository_l9_common/common/model/ImplSendExpressOTPModel","single!businesswidget/repository_l9_common/common/model/ImplValidateExpressOTPModel","single!businesswidget/repository_l9_common/common/model/ImplManageOTPVasModel","single!businesswidget/repository_l9_common/common/model/ImplSubmitOrderOTPVasModel","single!businesswidget/repository_l9_common/common/model/ImplMstaLoginModel"],function (a,b,c,d,e,f,g,h,i){var j=a.Core.ObservableViewModel.extend({defaults:{otp:null,mobileNo:null,catlogItemId:null,addonToAdd:null,implExpressOTPVmStatus:null,otpData:null,isMstaFlow:!1,mstaLoginToken:null},models:{implValidateVasModel:d,implSendExpressOTPModel:e,implValidateExpressOTPModel:f,implManageOTPVasModel:g,implSubmitOrderOTPVasModel:h,implMstaLoginModel:i},validateVas:function(){this.set("implExpressOTPVmStatus","ValidateVasInProgress");var a=this.get("addonToAdd"),b={msisdn:"65-"+this.get("mobileNo"),billingOfferId:a.productSpecContainmentID},d=this.models.implValidateVasModel.save({ImplValidateVASResInput:b},{success:c.bind(this.onValidateVasSuccess,this),error:c.bind(this.onValidateVasFailure,this)});return d},onValidateVasSuccess:function(a,b){var c=b.ImplValidateVASResOutput;this.set("otpData",c),c.eligible||this.set("implExpressOTPVmStatus","VasNotEligible")},onValidateVasFailure:function(){this.set("implExpressOTPVmStatus","ValidateVasFailure")},sendExpressOtp:function(){this.validateVas().then(function(){var a=this.get("otpData");if(a.eligible){this.set("implExpressOTPVmStatus","SendOTPInProgress");var b={ImplSendExpressOTPInput:{token:a.token}};return this.models.implSendExpressOTPModel.save(b,{success:c.bind(this.onSendExpressOtpSuccess,this),error:c.bind(this.onSendExpressOtpFailure,this)})}}.bind(this))},onSendExpressOtpSuccess:function(){this.set("implExpressOTPVmStatus","sendExpressOtpSuccess")},onSendExpressOtpFailure:function(){this.set("implExpressOTPVmStatus","sendExpressOtpFailure")},validateExpressOtp:function(){this.set("implExpressOTPVmStatus","ValidateOtpInProgress");var a=this.get("otpData"),b={otp:this.get("otp"),token:a.token};return this.models.implValidateExpressOTPModel.save({ImplVerifyExpressOTPInput:b},{success:c.bind(this.onValidateExpressOtpSuccess,this),error:c.bind(this.onValidateExpressOtpFailure,this)})},onValidateExpressOtpSuccess:function(a,b){var c=b.ImplVerifyExpressOTPOutput;if(c.validOTP){var d=this.get("otpData");d.customerId=c.customerId,d.assignedProductId=c.assignedProductId,d.isValidPin=c.isValidPin,d.token=c.token||d.token,d.isMstaFlow=this.get("isMstaFlow"),this.set("otpData",d),this.set("implExpressOTPVmStatus","ValidateOtpSuccess")}else this.set("implExpressOTPVmStatus","InvalidOTP")},onValidateExpressOtpFailure:function(){this.set("implExpressOTPVmStatus","ValidateOtpFailure")},createOrderForOTPExpressAddon:function(a){var b={updateProductConfigurationRequest:a,token:this.getValueByPath("otpData.token")};return this.models.implManageOTPVasModel.save({ImplManageVasResInput:b})},submitOrderForOTPExpressAddon:function(a,b){return this.models.implSubmitOrderOTPVasModel.save({ImplSubmitVasOrderInput:{token:this.getValueByPath("otpData.token")}})},mstaLogin:function(){this.set("implExpressOTPVmStatus","MstaLoginInProgress");var a=this.get("mstaLoginToken"),b=$.Deferred();if(this.set("otpData",{mstaLoginToken:a,isMstaFlow:!0}),a){var d={ImplMstaLoginRequest:{tokenId:a}};b=this.models.implMstaLoginModel.save(d,{success:c.bind(this.onMstaLoginSuccess,this),error:c.bind(this.onMstaLoginFailure,this)})}else this.set("implExpressOTPVmStatus","MstaLoginFailedNoTokenSet"),b.reject("MstaLoginFailedNoTokenSet");return b},onMstaLoginSuccess:function(a,b){var c=b.ImplMstaLoginResponse,d=this.get("otpData");d.customerId=c.customerId,d.assignedProductId=c.assignedProductId,d.isValidPin=!0,d.token=c.token,d.addonTab=c.addonTab,d.addonId=c.addonId,d.serviceIdentifier=c.serviceIdentifier,d.serviceNumber=c.serviceNumber,d.customerIdentifier=c.customerIdentifier,d.isMstaFlow=this.get("isMstaFlow"),this.set("otpData",d),this.set("implExpressOTPVmStatus","MstaLoginSuccess")},onMstaLoginFailure:function(){this.set("implExpressOTPVmStatus","MstaLoginFailure")}});return j});
define("businesswidget/repository_l9_common/common/model/RetrieveVasModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/cce/customer/:customerId/product/:productId/retrieveListOfVas",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplRetrieveListOfExtVasInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/ResendProvModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/cce/customer/:customerId/product/:productId/resendProvNotification",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{contentType:"application/json",payload:["ImplRetrieveListOfExtVasInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/VasActivationViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/RetrieveVasModel","businesswidget/repository_l9_common/common/model/ResendProvModel"],function (a,b,c,d,e){var f=a.Core.ObservableViewModel.extend({defaults:{vasActivationVmStatus:null,productConfiguration:null},models:{retrieveVasModel:d,resendProvModel:e},initialize:function(){c.bindAll(this,"getActivationAddons","sendActivationOfAddons","onGetActivationAddonsSuccess","onGetActivationAddonsFailure","sendActivationOfAddonsSuccess","sendActivationOfAddonsFailure")},getActivationAddons:function(b,d,e){var f=$.Deferred(),g=this,h=g.getModel("retrieveVasModel");h.set({customerId:d,productId:e});var i={sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")};if(b&&("BB"===b.lineOfBusiness||"WS"===b.lineOfBusiness)&&b.implementedProductByAssignedProductId){var j=[],k=b.implementedProductByAssignedProductId;if(c.map(k,function(a){"BillingOffers"===a.type&&(c.contains(j,a.productSpecContainmentID)||j.push(a.productSpecContainmentID))}),j.length>0){h.setQueryParams(i),g.set("vasActivationVmStatus","inprogress");var l={ImplRetrieveListOfExtVasInput:{svcNo:b.serviceID,svcType:"WS"===b.lineOfBusiness?"MT":"SG",billingOfferIdList:j}};h.save(l,{success:c.bind(g.onGetActivationAddonsSuccess,g,f,b),error:c.bind(g.onGetActivationAddonsFailure,g,f,b)})}else g.onGetActivationAddonsFailure(f,b)}else g.onGetActivationAddonsFailure(f,b);return f},onGetActivationAddonsFailure:function(a,b){this.set("productConfiguration",b),this.set("vasActivationVmStatus","failed"),a.resolve()},onGetActivationAddonsSuccess:function(a,b,d,e){var f=this;if(e&&e.ImplRetrieveListOfExtVasOutput&&"000"===e.ImplRetrieveListOfExtVasOutput.statusCode){var g=b.implementedProductByAssignedProductId;c.each(e.ImplRetrieveListOfExtVasOutput.billingOfferInfo,function(a){c.find(g,function(b,c){if(b.catlogId===a.billingOfferId)return b.reactivationDetails=a,!0})}),b.implementedProductByAssignedProductId=g,f.set("productConfiguration",b),f.set("vasActivationVmStatus","success"),a.resolve()}else f.onGetActivationAddonsFailure(a,b)},sendActivationOfAddons:function(b,d,e,f){var g=$.Deferred(),h=this,i=h.getModel("resendProvModel");i.set({customerId:d,productId:e});var j={sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")};if(b&&("BB"===b.lineOfBusiness||"WS"===b.lineOfBusiness)&&f){i.setQueryParams(j),h.set("vasActivationVmStatus","inprogress");var k={ImplRetrieveListOfExtVasInput:{svcNo:b.serviceID,svcType:"WS"===b.lineOfBusiness?"MT":"SG",svcOfferID:f.svcOfferID,billingOfferId:f.billingOfferId,contactNumber:f.contactNumber,contactEmail:f.contactEmail}};i.save(k,{success:c.bind(h.sendActivationOfAddonsSuccess,h,g),error:c.bind(h.sendActivationOfAddonsFailure,h,g)})}else h.sendActivationOfAddonsFailure(g);return g},sendActivationOfAddonsSuccess:function(a,b,c){var d=this;c&&c.ImplRetrieveListOfExtVasOutput&&"000"===c.ImplRetrieveListOfExtVasOutput.statusCode?(d.set("vasActivationVmStatus","success"),a.resolve()):d.sendActivationOfAddonsFailure(a)},sendActivationOfAddonsFailure:function(a){var b=this;b.set("vasActivationVmStatus","failure"),a.reject()}});return f});
define("businesswidget/repository_l9_common/common/viewmodel/business/AddOnsRetrieveUpdateConfigurationViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ProductInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/ImplProductConfigurationOptionsModel","single!businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","single!businesswidget/repository_l9_common/common/viewmodel/ImplPendingProductsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/ImplSpecialAddonHandlingViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/UserInformationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ImplExpressOTPViewModel","businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/NotificationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/VasActivationViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=a.Core.ObservableViewModel.extend({defaults:{assignedProductId:null,subscriptionId:null,customerId:null,myAccountCustomerId:null,productOrderID:null,retrieveProductConfigurationOsgResponse:null,isConfirmationMessagesApprovedByUser:!1,update:!1,isAllAddonsDisplayed:null,retrieveProductConfigurationError:"",updatedAddOn:null,actionType:"",retrieveProductConfigResponse:null,addonToAdd:null,addonToRemove:null,completedAddon:null,addonsVmStatus:null,productConfiguration:null,permissions:null,addonContractCatlogId:"9722",isAnonymous:!0,interactionData:null,isMobileOrder:!1,planAndContractDetails:null,orderProductConfigurationInput:null,reactivationData:null,userInfo:null},orderMap:{},models:{customerProductOrderItemProductConfigurationOptionsModel:f,anonymousProductOrderItemRetrieveProductConfigurationOptionsModel:g,anonymousProductOrderItemProductConfigurationModel:i,customerProductOrderItemProductConfigurationModel:h,implProductConfigurationOptionsModel:k,implSubmitProductConfigurationModel:l,customerProductOrderProductOrderItemsModel:n,customerSubmitOrderModel:o},subViewModels:{customerInContextTopicViewModel:d,orderInContextTopicViewModel:e,productInContextTopicViewModel:j,contactInContextTopicViewModel:m,implPendingProductsViewModel:p,implUserContextTopicViewModel:q,implSpecialAddonHandlingViewModel:s,userInformationViewModel:t,implExpressOTPViewModel:u,GATopicViewModel:v,notificationViewModel:w,vasActivationViewModel:x},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{myAccountCustomerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productOrderID:"subViewModels.orderInContextTopicViewModel.productOrderItemID",options:{twoWay:!1,setOnBind:!0}},{assignedProductId:"subViewModels.productInContextTopicViewModel.assignedProduct.id",options:{twoWay:!1,setOnBind:!0}},{subscriptionId:"subViewModels.productInContextTopicViewModel.assignedProduct.subscriptionId",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.contactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{permissions:"subViewModels.implUserContextTopicViewModel.permissions",options:{twoWay:!1,setOnBind:!0}},{userInfo:"subViewModels.implUserContextTopicViewModel.userInfo",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){c.bindAll(this,"onFetchRetrieveProductConfigurationSuccess","onFetchProductConfigurationError","loadDisplayableItems","retrieveProductConfiguration","setDefaultQueryParams","setHeaders","onUpdateProductConfigurationSuccess","fillAddonInformation","populateAllowedActions","updateAssignedProductConfiguration","getProductConfigurationInput","onUserInfoReceived","setProductConfiguration","reactivateAddonLink"),this.subViewModels.userInformationViewModel.retrieveUserInfo().then(this.onUserInfoReceived),this.on("change:productOrderID",this.retrieveProductConfiguration,this),this.on("change:assignedProductId change:myAccountCustomerId",this.retrieveAssignedProductConfiguration,this),this.set("isAllAddonsDisplayed",!1),setTimeout(function(){this.set("addonsVmStatus","addonsVmInitialized")}.bind(this),0)},onUserInfoReceived:function(a){this.set("isAnonymous",a.anonymousUser),this.set("addonsVmStatus","userInformationSet")},createOrderRemoveAddon:function(){this.set("addonsVmStatus","RemoveAddonCreateOrderInProgress"),this.initializeOrderingFlow();var a=this.get("addonToRemove");a.actionType="remove",this.set("actionType","remove"),this.set("updatedAddOn",a),console.log(a);this.updateAssignedProductConfiguration(!1)},createOrderUpgradeAddon:function(){this.set("addonsVmStatus","UpgradeAddonokCreateOrderInProgress"),this.initializeOrderingFlow();var a=this.get("addonToRemove");a.action="remove",a.actionType="remove",this.set("actionType","remove"),this.set("updatedAddOn",a);var b=this.getProductConfigurationInput(!1),d=this.get("addonToAdd");d.action="upgrade",d.actionType="add",this.set("actionType","add"),this.set("updatedAddOn",d),b=this.getProductConfigurationInput(!1),b.orderActionReasonX8="CREQ",b.orderActionTypeX8="CH";var e={updateProductConfigurationRequest:b,subscriberId:this.get("subscriptionId")},f=this.get("myAccountCustomerId"),g=this.getModel("implSubmitProductConfigurationModel"),h={contactId:this.get("contactId"),customerId:f,productId:this.get("assignedProductId")};return g.set(h),g.save({ImplSubmitProductConfigurationRestInput:e},{success:c.bind(this.onUpdateAssignedProductConfigurationSuccess,this,this.get("updatedAddOn")),error:c.bind(this.onProductConfigurationError,this)})},createOrderExpressOtpAddAddon:function(){this.set("addonsVmStatus","AddOTPExpressAddonCreateOrderInProgress"),this.initializeOrderingFlow();var a=this.get("addonToAdd");a.actionType="add",this.set("actionType","add"),this.set("updatedAddOn",a);var b=this.getProductConfigurationInput(!1);b.runCompatibilityRules=!0,b.returnConfigurationData.productConfigurationInd=!0,b.returnConfigurationData.catalogDataInd=!0;var d=this.subViewModels.implExpressOTPViewModel.createOrderForOTPExpressAddon(b);return d.then(function(a){var b=this.get("updatedAddOn"),c=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse;this.setCreateOrderResponse(c,b);var d={UpdateProductInOrderConfigurationResponse:c};this.upcSuccess(b,null,d)}.bind(this),c.bind(this.onProductConfigurationError,this)).then(function(){this.set("addonsVmStatus","AddOTPExpressAddonCreateOrderSuccess")}.bind(this))},createOrderExpressOtpRemoveAddon:function(){this.set("addonsVmStatus","AddOTPExpressAddonCreateOrderInProgress"),this.initializeOrderingFlow();var a=this.get("addonToRemove");a.actionType="remove",this.set("actionType","remove"),this.set("updatedAddOn",a);var b=this.getProductConfigurationInput(!1);b.runCompatibilityRules=!0,b.returnConfigurationData.productConfigurationInd=!0,b.returnConfigurationData.catalogDataInd=!0;var d=this.subViewModels.implExpressOTPViewModel.createOrderForOTPExpressAddon(b);return d.then(function(a){var b=this.get("updatedAddOn"),c=a.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse;this.setCreateOrderResponse(c,b);var d={UpdateProductInOrderConfigurationResponse:c};this.upcSuccess(b,null,d)}.bind(this),c.bind(this.onProductConfigurationError,this)).then(function(){this.set("addonsVmStatus","RemoveOTPExpressAddonCreateOrderSuccess")}.bind(this))},submitOrderExpressOtpAddon:function(){this.set("addonsVmStatus","SubmitOrderInProgress");var a=this.get("completedAddon"),b=a.productOrderReferenceNumber,d=this.subViewModels.implExpressOTPViewModel.submitOrderForOTPExpressAddon(b,a);return d.then(function(a){this.onSubmitOrderSuccess(a,b),this.set("addonsVmStatus","ExpressOTPSubmitOrderSuccess")}.bind(this),c.bind(this.onSubmitOrderFailure,this))},createOrderAddAddon:function(){this.set("addonsVmStatus","AddAddonCreateOrderInProgress"),this.initializeOrderingFlow();var a=this.get("addonToAdd");a.actionType="add",this.set("actionType","add"),this.set("updatedAddOn",a),console.log(a);this.updateAssignedProductConfiguration(!1)},cancelOrder:function(){this.set("addonsVmStatus","CancelOrderInProgress");var a=this.get("completedAddon"),b=a.productOrderID;if(null!==b){delete this.orderMap[a.productOrderReferenceNumber];var c=this.getModel("customerProductOrderProductOrderItemsModel");c.set("productOrderId",b);var d=[];return d.push(a.productOrderItemID),c.setQueryParams({poi:d}),c.set("id",d),c.set("customerId",this.get("myAccountCustomerId")),c.destroy()}},submitOrder:function(){this.set("addonsVmStatus","SubmitOrderInProgress");var a=this.get("completedAddon"),b=a.productOrderReferenceNumber,c=this.getModel("customerSubmitOrderModel");return c.setQueryParams({orderIds:b}),c.set({customerId:this.get("myAccountCustomerId")}),c.save().then(function(a){this.onSubmitOrderSuccess(a,b),this.set("addonsVmStatus","SubmitOrderSuccess"),this.triggerInteraction()}.bind(this),function(){this.onSubmitOrderFailure()}.bind(this))},triggerInteraction:function(){var a={},b=null,d=this.get("completedAddon");if("add"==d.actionType&&"upgrade"==d.action){a.type="GENERAL_ADDON_VAS_UPGRADE";var e=this.get("addonToRemove");b=e.productTitle||e.catalogItemName}else if("add"==d.actionType)if(d.characteristics&&d.characteristics.length>2){var f=c.find(d.characteristics,function(a){return"8128572"==a.productSpecCharacteristicID}),g=c.find(d.characteristics,function(a){return"8128562"==a.productSpecCharacteristicID});f&&g?(a.type="DRS_VAS",a.startDate=f.value,a.endDate=g.value):a.type="GENERAL_ADDON_VAS"}else a.type="GENERAL_ADDON_VAS";else a.type="CEASING_VAS";a.serviceId=d.serviceID,a.addOnName=d.productTitle||d.catalogItemName,a.type&&this.subViewModels.notificationViewModel.getInteractionData().then(function(c){var d,e,f,g=[];switch(c=c[a.type],d=c.title,e=c.topic,a.type){case"GENERAL_ADDON_VAS_UPGRADE":g=[b,a.addOnName,a.serviceId];break;case"GENERAL_ADDON_VAS":case"CEASING_VAS":g=[a.addOnName,a.serviceId];break;case"DRS_VAS":g=[a.addOnName,a.serviceId,r(parseInt(a.startDate,10)).format("DD/MM/YYYY"),r(parseInt(a.endDate,10)).format("DD/MM/YYYY")]}f=this.subViewModels.notificationViewModel.getKeyMapping(c.description,g),this.subViewModels.notificationViewModel.createInteraction(d,e,f)}.bind(this))},onSubmitOrderSuccess:function(a,b){var c=a.SubmitOrderResponse.failedOrders;if(c&&c.length)this.set("addonsVmStatus","SubmitOrderFailed");else{var d=this.orderMap,e=d[b],f=this.subViewModels.implPendingProductsViewModel.get("pendingProductsByCatlogId"),g=this.getBlankProductConfiguration(),h=this.loadDisplayableItems(e.productConfiguration.displayableItems,f,g);h.done(function(){this.setProductConfiguration(),delete d[b]}.bind(this))}},onSubmitOrderFailure:function(){this.set("addonsVmStatus","SubmitOrderFailed")},initializeOrderingFlow:function(){this.setOrderProductConfigurationInput(null)},setOrderProductConfigurationInput:function(a){this.set("orderProductConfigurationInput",a)},getOrderProductConfigurationInput:function(){var a=this.get("orderProductConfigurationInput");return a||(a={removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}),a},getProductConfigurationInput:function(a){var b=this.getOrderProductConfigurationInput(),c=this.generateTemporaryId(),d=this.get("actionType"),e=this.get("updatedAddOn");if("add"===d)if("ContainedProducts"===e.type){if(e.isBillingOfferConfiguration){var f=this.isParentComponentRequiredWithBillingOffer(e.billingOffer);f&&(this.populateContainedProducts(e,b.newContainedProducts),e.billingOffer.parentTemporaryID=e.temporaryID)}else this.populateContainedProducts(e,b.newContainedProducts),e.billingOffer.parentTemporaryID=e.temporaryID;var g=this.getBillingOfferToBeAdded(e.billingOffer);b.newAssignedBillingOffers.push(g),this.attachTempIdToAddon(b.newContainedProducts)}else if("mobileContent"===e.baseType){var h=this.getValueByPath("productConfiguration.implementedProductByCatlogId.8363682"),i="10141011";e.temporaryID=c;var j={temporaryID:c,productSpecContainmentID:i,simpleProductSpecID:e.simpleProductSpecID||e.productSpecContainmentID,parentProductID:h.productID};b.newSimpleProducts.push(j);
}else if(e.baseType||e.simpleProductSpecID){var j=null;if(e.baseType&&"alacarte"===e.baseType){var k="8635152";j={productSpecContainmentID:"8635142",temporaryID:c,simpleProductSpecID:e.simpleProductSpecID||e.productSpecContainmentID,parentProductSpecContainmentID:k};var l=this.getValueByPath("productConfiguration.implementedProductByCatlogId."+k);l?j.parentProductID=l.productID:b.newContainedProducts.push({productSpecContainmentID:k,temporaryID:c}),b.newSimpleProducts.push(j)}else j={businessType:"TV_PACKAGE",simpleProductSpecID:e.simpleProductSpecID||e.productSpecContainmentID,temporaryID:c},b.newSimpleProducts.push(j);this.attachTempIdToAddon(b.newSimpleProducts)}else{var g=this.getBillingOfferToBeAdded(e),f=this.isParentComponentRequiredWithBillingOffer(e);if(f){e.parentProductID=null;var m=this.getContainedProductToBeAdded(this.getValueByPath("productConfiguration.allProductsByCatalogId."+e.parentProductSpecContainmentID));b.newContainedProducts.push(m),g=this.getBillingOfferToBeAdded(e),g.parentTemporaryID=m.temporaryID}b.newAssignedBillingOffers.push(g)}else if("remove"===d)if("ContainedProducts"===e.type)this.populateContainedProductToBeRemoved(e,b.removedContainedProducts);else if("SimpleContainedProducts"===e.type){var n={};"undefined"!=typeof e.parentProductSpecContainmentID&&(n.parentTemporaryID=c),n.productID=e.productID,b.removedSimpleProducts.push(n)}else this.populateBillingOffersToBeRemoved(e,b.removedAssignedBillingOffers,b.removedContainedProducts);this.set("updatedAddOn",e),this.setOrderProductConfigurationInput(b);var o=b,p={runCompatibilityRules:!1,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",submitProductOrder:a,productChanges:[o],returnConfigurationData:{catalogDataInd:!1,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}};return p=this.subViewModels.implSpecialAddonHandlingViewModel.updatePayloadForSpecialAddons(p,this.getValueByPath("productConfiguration"))},isParentComponentRequiredWithBillingOffer:function(a){var b=this.get("addonContractCatlogId");if(a.parentProductSpecContainmentID===b)return!0;var c=this.getValueByPath("productConfiguration.implementedProductByCatlogId."+a.parentProductSpecContainmentID);return!c||!c.cardinality||c.cardinality.maximumQuantity>1},attachTempIdToAddon:function(a){for(var b=this.get("updatedAddOn"),c=0;c<a.length;c++){var d=a[c];if(b.productSpecContainmentID===d.productSpecContainmentID||b.productSpecContainmentID===d.simpleProductSpecID){b.temporaryID=d.temporaryID,this.set("updatedAddOn",b);break}}},populateBillingOffersToBeRemoved:function(a,b,c){var d=a.parentProductID,e=this.getValueByPath("productConfiguration.implementedProductByAssignedProductId."+d);if(a.homeInsuranceAddonFlag)this.populateContainedProductToBeRemoved(e,c);else{var f={billingOfferID:a.billingOfferID,parentProductID:d};b.push(f),1!==e.optedNonPromoBillingOffers.length||e.isChildComponentExist||this.populateContainedProductToBeRemoved(e,c)}},populateContainedProductToBeRemoved:function(a,b){var c={},d=this.generateTemporaryId();a.parentTemporaryID?c.parentTemporaryID=a.parentTemporaryID:"undefined"!=typeof a.parentProductSpecContainmentID&&(c.parentTemporaryID=d),c.productID=a.productID,b.push(c)},populateContainedProducts:function(a,b){var c=this.getContainedProductToBeAdded(a);if(!c.parentProductID){var d="productConfiguration.allProductsByCatalogId."+c.parentProductSpecContainmentID,e=this.getValueByPath(d);this.populateContainedProducts(e,b)}b.push(c)},getContainedProductToBeAdded:function(a){var b=this.generateTemporaryId();a.temporaryID=b;var c={catlogId:a.catlogId,productSpecContainmentID:a.productSpecContainmentID,parentProductSpecContainmentID:a.parentProductSpecContainmentID,temporaryID:b};a.parentProductID&&(c.parentProductID=a.parentProductID);var d=this.populateCharacteristics(a);return d&&d.length&&(c.changedCharacteristics=d),c},getBillingOfferToBeAdded:function(a){var b={catlogId:a.catlogId,productSpecPricingID:a.productSpecPricingID,parentProductSpecContainmentID:a.parentProductSpecContainmentID};return a.parentTemporaryID&&(b.parentTemporaryID=a.parentTemporaryID),b},populateCharacteristics:function(a){var b=[];if(a.characteristics&&a.characteristics.length)for(var c=0;c<a.characteristics.length;c++){var d=a.characteristics[c],e=this.getCharacteristicValue(d);b.push({characteristicID:d.productSpecCharacteristicID,value:e})}return b},getCharacteristicValue:function(a){var b=a.value;if(b)switch(a.productSpecCharacteristic.valueBasicType){case"DATE":var c=b.split("-");b=Date.UTC(c[2],parseInt(c[1])-1,c[0]);break;case"INTEGER":b=parseFloat(b,10)}return b},updateAssignedProductConfiguration:function(a){this.set("addonsVmStatus","UpdateAssignedProductConfiguration");var b=this.getProductConfigurationInput(a);b.orderActionReasonX8="CREQ",b.orderActionTypeX8="CH";var d={updateProductConfigurationRequest:b,subscriberId:this.get("subscriptionId")},e=this.get("myAccountCustomerId"),f=this.getModel("implSubmitProductConfigurationModel"),g={contactId:this.get("contactId"),customerId:e,productId:this.get("assignedProductId")};f.set(g),f.save({ImplSubmitProductConfigurationRestInput:d},{success:c.bind(this.onUpdateAssignedProductConfigurationSuccess,this,this.get("updatedAddOn")),error:c.bind(this.onProductConfigurationError,this)})},onUpdateAssignedProductConfigurationSuccess:function(a,b,c,d){var e=c.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse;this.setCreateOrderResponse(e,a),this.runUPCWithRules()},setCreateOrderResponse:function(a,b){a.productConfiguration&&(b.lineOfBusiness=a.productConfiguration.lineOfBusiness,b.serviceID=a.productConfiguration.serviceID),b.productOrderID=a.productOrderID,b.productOrderItemID=a.productOrderItemID,b.productOrderReferenceNumber=a.productOrderReferenceNumber,b.productOrderItemReferenceNumber=a.productOrderItemReferenceNumber,this.set("updatedAddOn",b)},runUPCWithRules:function(){var a=this.getModel("customerProductOrderItemProductConfigurationModel"),b=this.get("updatedAddOn");a.set({customerId:this.get("myAccountCustomerId"),productOrderItemId:b.productOrderItemID}),a.setQueryParams({rp:!1,rpc:!1});var d=this.createInputPayloadforUpdate();a.save(d,{success:c.bind(this.upcSuccess,this,b),error:function(){this.set("addonsVmStatus","upcRestFailed")}.bind(this)})},createInputPayloadforUpdate:function(){var a={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},b=this.getModel("implSubmitProductConfigurationModel").get("ImplSubmitProductConfigurationRestInput");if(b){var c=b.updateProductConfigurationRequest.productChanges[0];(c.newContainedProducts.length||c.newSimpleProducts.length)&&(a.UpdateProductInOrderConfigurationRequest.activityForConfiguration="SD Add Comp Stage")}return a},upcSuccess:function(a,b,d){var e=d.UpdateProductInOrderConfigurationResponse.productConfiguration,f=this.getErrorsFromUpdateProductConfiguration(e);if(f.isError)a.errorObj=f,this.set("completedAddon",a),this.set("addonsVmStatus","UpdateAssignedProductConfigurationError"),this.cancelOrder();else{var g=this.orderMap;g[a.productOrderReferenceNumber]=d.UpdateProductInOrderConfigurationResponse;var h=e.displayableItems;e.displayableSimpleProductReferences&&(h=h.concat(e.displayableSimpleProductReferences));var i=[],j=this.getBlankProductConfiguration(),k=h[0],l=this.subViewModels.implPendingProductsViewModel.get("pendingProductsByCatlogId");j=this.fillAddonInformation(h,i,j,"ContainedProducts",k,l);var m=null;if(a.temporaryID)m=c.clone(j.implementedProductByTemporaryId[a.temporaryID]);else if("add"===a.action||"upgrade"===a.action){var n=this.getNewAssignedBillingOffer(a,j);m=c.clone(n)}if(m&&(m.characteristics&&(a.characteristics=m.characteristics),a=c.extend(m,a)),e.totalOneTimeCalculatedPrice&&e.totalOneTimeCalculatedPrice.finalAmountIncludingTax?a.totalOrderOneTimeCalculatedPrice=e.totalOneTimeCalculatedPrice:a.totalOrderOneTimeCalculatedPrice=j.totalOneTimeCustomCalculatedPrice,a.baseType&&"mobileContent"===a.baseType&&!a.totalRecurringCalculatedPrice.finalAmount){var o=c.find(a.allCharacteristics,function(a){return"10048781"===a.productSpecCharacteristic.ID});if(o){var p=o.value||a.price;p&&(a.totalRecurringCalculatedPrice={discountAmount:0,discountPercentage:0,finalAmount:p,finalTaxAmount:0,finalAmountIncludingTax:p,originalAmount:p,currency:"SGD"})}}a.totalOrderRecurringCalculatedPrice=e.totalRecurringCalculatedPrice,this.set("completedAddon",a),this.set("addonsVmStatus","UpdateAssignedProductConfigurationSuccess")}},getNewAssignedBillingOffer:function(a,b){var d=b.implementedProductByAssignedProductId,e=c.find(d,function(b){return b.productSpecContainmentID===a.productSpecContainmentID&&b.parentProductSpecContainmentID===a.parentProductSpecContainmentID});return e},getErrorsFromUpdateProductConfiguration:function(a){var b=a.messages,d={isError:!1,messages:[]};return b&&c.each(b,function(a){"ERROR"===a.severity&&(d.isError=!0,d.messages.push(a.text))}),d},getProductConfigurationPayload:function(){var a={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!0,summaryInd:!1}};return a},retrieveAssignedProductConfiguration:function(){this.set("addonsVmStatus","RetrieveAssignedProductConfiguration");var a=this.get("myAccountCustomerId"),b=this.get("assignedProductId");if(a&&b){var d=this.subViewModels.implPendingProductsViewModel.getPendingProducts(),e=this.getProductConfigurationPayload(),f=this.getModel("implProductConfigurationOptionsModel");f.set({customerId:a,assignedProductId:b}),f.setQueryParams({rp:!1,rpc:!1}),f.set("RetrieveProductConfigurationRequest",e),this.setHeaders(f),this.setDefaultQueryParams(f);var g=f.fetch({error:c.bind(this.onFetchProductConfigurationError,this)});$.when(d,g).done(function(a,b){var a=this.subViewModels.implPendingProductsViewModel.get("pendingProductsByCatlogId");this.onFetchRetrieveAssignedProductConfigurationSuccess(a,b[0])}.bind(this))}},onFetchRetrieveAssignedProductConfigurationSuccess:function(a,b){var d=b.RetrieveProductConfigurationResponse.productConfiguration,e=this.getBlankProductConfiguration();e.lineOfBusiness=d.lineOfBusiness,e.serviceID=d.serviceID,"TV"==e.lineOfBusiness&&(d.displayableItems=d.displayableItems.concat(d.displayableSimpleProductReferences)),"WS"===e.lineOfBusiness?this.set("isMobileOrder",!0):this.set("isMobileOrder",!1),d.displayableSimpleProductReferences&&(d.displayableItems=d.displayableItems.concat(d.displayableSimpleProductReferences));var f=this.loadDisplayableItems(d.displayableItems,a,e);f.done(function(){this.setProductConfiguration(),this.set("addonsVmStatus","RetrieveAssignedProductConfigurationSuccess");var a=this.subViewModels.userInformationViewModel.getValueByPath("clientContext.subscriptions"),b=this.get("productConfiguration");if(a&&b&&b.lineOfBusiness&&b.serviceID){var d=c.find(a,function(a){return a.primaryResource==b.serviceID});if(d){var e={contextServiceNum:d.primaryResourceDmpX8,contextServiceType:this.getLineOfBusinessValue(d.lineOfBusiness)};this.subViewModels.GATopicViewModel.set("gtmData",e),this.subViewModels.GATopicViewModel.publishData()}}}.bind(this))},getLineOfBusinessValue:function(a){var b={WS:"Mobile",MOB:"Mobile",FV:"FV",TV:"TV",EASY_MOB:"Mobile",MBB:"MBB",BB:"BB",FBB:"FBB",FEB:"FEB",FEBP:"FEBP",FHB:"FHB"};return b[a]||a},loadAssignedProductConfiguration:function(a){},retrieveProductConfiguration:function(){var a=this.getProductConfigurationPayload(),b=this.get("customerId");if("undefined"!=typeof b){var d=this.get("productOrderID");if(d){var e=this.getModel("customerProductOrderItemProductConfigurationOptionsModel");e.set({customerId:b,productOrderID:d}),e.setQueryParams({rp:!1,rpc:!1}),e.set("RetrieveProductInOrderConfigurationRequest",a),this.setHeaders(e),this.setDefaultQueryParams(e),e.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this),error:c.bind(this.onFetchProductConfigurationError,this)})}}else{var f=this.getModel("anonymousProductOrderItemRetrieveProductConfigurationOptionsModel");f.set({productOrderItemId:this.get("productOrderID")}),f.setQueryParams({rp:!1,rpc:!1}),f.set("RetrieveProductInOrderConfigurationRequest",a),this.setHeaders(f),this.setDefaultQueryParams(f),f.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this),error:c.bind(this.onFetchProductConfigurationError,this)})}},onFetchRetrieveProductConfigurationSuccess:function(a,b,c){var d=b.RetrieveProductInOrderConfigurationResponse.productConfiguration,e=this.getBlankProductConfiguration();e.lineOfBusiness=d.lineOfBusiness;var f=this.loadDisplayableItems(d.displayableItems,null,e);f.done(function(){this.setProductConfiguration()}.bind(this))},onFetchProductConfigurationError:function(a,b,c){this.set("retrieveProductConfigurationError","retrieveProductConfigurationError","")},getBlankProductConfiguration:function(){return{lineOfBusiness:null,implementedProductByAssignedProductId:{},implementedProductByCatlogId:{},availableProductByCatlogId:{},allProductsByCatalogId:{},allProductsByCatalogName:{},characteristicsByCatelogId:{},implementedProductByTemporaryId:{},serviceID:null}},loadDisplayableItems:function(a,b,c){var d=[];c=c||this.getBlankProductConfiguration();var e=a[0];this.fillAddonInformation(a,d,c,"ContainedProducts",e,b),c=this.subViewModels.implSpecialAddonHandlingViewModel.handleSpecialConditionsAfterRetrieve(c);var f,g=this.get("myAccountCustomerId"),h=this.get("assignedProductId");return g&&h?f=this.subViewModels.vasActivationViewModel.getActivationAddons(c,g,h):(f=$.Deferred(),f.resolve()),f},fillAddonInformation:function(a,b,d,e,f,g){var h=this;return a&&a.length>0&&c.each(a,function(a){var i={};if(this.setTotalOneTimeCustomCalculatedPrice(d,a),i.productID=a.productID,i.productSpecContainmentID=a.productSpecContainmentID,i.totalOneTimeCalculatedPrice=a.totalOneTimeCalculatedPrice,i.totalRecurringCalculatedPrice=a.totalRecurringCalculatedPrice,i.selected=a.selected,i.productID=a.productID,i.type=e,i.isChildImplementedProductPresent=!1,i.isChildComponentExist=!1,i.allowedActions={},"ContainedProducts"===e||"SimpleContainedProducts"===e){i.productTitle=a.name,"SimpleContainedProducts"===e&&(i.productSpecContainmentIDOrig=a.productSpecContainmentID,i.productSpecContainmentID=a.productSpecContainment.containedProduct.id,i.simpleProductSpecID=a.simpleProductSpecID),a.productSpecContainment&&(i.cardinality={defaultQuantity:a.productSpecContainment.defaultQuantity,maximumQuantity:a.productSpecContainment.maximumQuantity,minimumQuantity:a.productSpecContainment.minimumQuantity},i.catlogId=a.productSpecContainment.containedProduct.id),i.parentProductSpecContainmentID=a.parentProductSpecContainmentID,i.parentProductID=a.parentProductID,i.parentTemporaryID=a.parentTemporaryID;var j=this.getCharacteristics(a,d);if(j.displaybleChars.length&&(i.characteristics=j.displaybleChars),j.allChars.length&&(i.allCharacteristics=j.allChars),h.get("isMobileOrder")&&"11782"===a.productSpecContainmentID&&"8363712"===a.parentProductSpecContainmentID&&a.displayableCharacteristics){var k={};c.each(a.displayableCharacteristics,function(a){"8242"===a.productSpecCharacteristicID?k.contractStartDate=a.value:"8430382"===a.productSpecCharacteristicID&&(k.planId=a.value)}),k.contractStartDate&&k.planId&&h.set("planAndContractDetails",k)}this.populateBillingOffersForContanedProduct(i,a)}else if(i.productTitle=a.productSpecPricing.childPricingSchema.name,i.productID=a.billingOfferID,i.productSpecContainmentID=a.productSpecPricing.childPricingSchema.id,i.catlogId=a.productSpecPricing.childPricingSchema.id,i.productSpecPricingID=a.productSpecPricingID,i.parentProductSpecContainmentID=f.productSpecContainmentID,i.parentProductID=f.productID,i.billingOfferID=a.billingOfferID,"18985921"===f.productSpecContainmentID||"Insurance"===a.name){i.homeInsuranceAddonFlag=!0;var l=h.getValueByPath("userInfo.contactDetails");l&&(i.phone=l.phone,i.email=l.email)}if(h.populateAllowedActions(i,a,g),b.push(i),d.allProductsByCatalogId[i.productSpecContainmentID]=i,i.simpleProductSpecID&&(d.allProductsByCatalogId[i.simpleProductSpecID]=i),d.allProductsByCatalogName[i.productTitle]=i,a.selected){var m=d.implementedProductByAssignedProductId[i.parentProductID];m&&(m.isChildImplementedProductPresent=!0),m&&a.productSpecContainment&&(m.isChildComponentExist=!0),d.implementedProductByAssignedProductId[i.productID]=i,d.implementedProductByCatlogId[i.productSpecContainmentID]=i,i.simpleProductSpecID&&(d.implementedProductByCatlogId[i.simpleProductSpecID]=i),a.temporaryID&&(d.implementedProductByTemporaryId[a.temporaryID]=i)}else d.availableProductByCatlogId[i.productSpecContainmentID]=i,i.simpleProductSpecID&&(d.availableProductByCatlogId[i.simpleProductSpecID]=i);a.displayableItems&&a.displayableItems.length>0&&h.fillAddonInformation(a.displayableItems,b,d,"ContainedProducts",a,g),a.displayableSimpleProductReferences&&a.displayableSimpleProductReferences.length>0&&h.fillAddonInformation(a.displayableSimpleProductReferences,b,d,"SimpleContainedProducts",a,g),a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&h.fillAddonInformation(a.displayableBillingOffers,b,d,"BillingOffers",a,g)},this),d},setTotalOneTimeCustomCalculatedPrice:function(a,b){a.totalOneTimeCustomCalculatedPrice||(a.totalOneTimeCustomCalculatedPrice={discountAmount:0,discountPercentage:0,finalAmount:0,finalTaxAmount:0,finalAmountIncludingTax:0,originalAmount:0,currency:"SGD"});var c=a.totalOneTimeCustomCalculatedPrice,d=b.oneTimeCalculatedPrices;if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f.discountAmount&&(c.discountAmount+=f.discountAmount),f.discountPercentage&&(c.discountPercentage+=f.discountPercentage),f.finalAmount&&(c.finalAmount+=f.finalAmount,c.finalAmountIncludingTax+=f.finalAmount),f.finalTaxAmount&&(c.finalTaxAmount+=f.finalTaxAmount,c.finalAmountIncludingTax+=f.finalTaxAmount)}},populateBillingOffersForContanedProduct:function(a,b){var d=[],e=[],f=[],g=[];if(b.displayableBillingOffers&&b.displayableBillingOffers.length){var h=b.displayableBillingOffers;h=c.sortBy(h,function(a){return a.productSpecPricing.childPricingSchema.name.toUpperCase()});for(var i=h.length,j=0;j<i;j++)billingOffer=h[j],billingOffer.displayInformation.enabled&&billingOffer.displayInformation.visible&&billingOffer.productSpecPricing&&billingOffer.productSpecPricing.childPricingSchema&&"10321941"!==billingOffer.productSpecPricing.childPricingSchema.id&&d.push(billingOffer.productSpecPricing.childPricingSchema.id),billingOffer.selected&&(e.push(billingOffer.productSpecPricingID),g.push(billingOffer.billingOfferID)),billingOffer.selected&&billingOffer.productSpecPricing&&billingOffer.productSpecPricing.childPricingSchema&&billingOffer.productSpecPricing.childPricingSchema.description&&"Promo"!==billingOffer.productSpecPricing.childPricingSchema.description&&f.push(billingOffer.productSpecPricingID)}d.length&&(a.billingOffers=d,a.selectedBillingOffer=d[0]),e.length&&(a.optedBillingOffers=e,a.optedBillingOffersIds=g),f.length&&(a.optedNonPromoBillingOffers=f)},getCharacteristics:function(a,b){var d=[],e=[];if(a.displayableCharacteristics&&a.displayableCharacteristics.length)for(var f=a.displayableCharacteristics,g=f.length,h=0;h<g;h++)characteristic=f[h],"DROPDOWN_LISTBOX"===characteristic.displayInformation.displayFormat&&(characteristic.productSpecCharacteristic&&characteristic.productSpecCharacteristic.values?("INTEGER"===characteristic.productSpecCharacteristic.valueBasicType?characteristic.productSpecCharacteristic.values=c.sortBy(characteristic.productSpecCharacteristic.values,function(a){return parseInt(a.value,10)}):characteristic.productSpecCharacteristic.values=c.sortBy(characteristic.productSpecCharacteristic.values,"value"),characteristic.productSpecCharacteristic.defaultValue.value=characteristic.productSpecCharacteristic.defaultValue.value||(characteristic.productSpecCharacteristic.values[0]?characteristic.productSpecCharacteristic.values[0].value:"")):(characteristic.displayInformation.visible=!1,characteristic.displayInformation.enabled=!1)),characteristic.value||(characteristic.productSpecCharacteristic&&characteristic.productSpecCharacteristic.defaultValue?characteristic.value=characteristic.productSpecCharacteristic.defaultValue.value||null:characteristic.value=null),characteristic.displayInformation.visible&&d.push(characteristic),e.push(characteristic),b.characteristicsByCatelogId[characteristic.productSpecCharacteristicID]=characteristic;var i={displaybleChars:d,allChars:e};return i},populateAllowedActions:function(a,b,d){c.each(b.allowedActions,function(b){var c=null;this.get("permissions")&&(c=this.get("permissions").contactPermissions),d&&d[a.productSpecContainmentID]?(a.isPendingOrder=!0,a.pendingOrderDetails=d[a.productSpecContainmentID],a.allowedActions[b.type]=!1):c&&(c.ipa||c.blacklisted)&&"AD"===b.type?(a.allowedActions.AD=!1,a.ipa=c.ipa,a.blacklisted=c.blacklisted):a.allowedActions[b.type]=b.allowed}.bind(this))},populateAddRemoveButton:function(a,b){c.each(b.allowedActions,function(c){"undefined"!=typeof b.productID?"AD"!==c.type&&"RM"!==c.type||("AD"===c.type&&c.allowed?(a.isAddButton=!0,a.isAddButtonDisabled=!1):"RM"===c.type&&c.allowed&&(a.isRemoveButton=!0,a.isRemoveButtonDisabled=!1)):"AD"===c.type&&c.allowed&&(a.isAddButton=!0,a.isAddButtonDisabled=!1)})},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onUpdateProductConfigurationSuccess:function(a,b,c){var d=this.getBlankProductConfiguration(),e=this.loadDisplayableItems(b.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems,null,d);e.done(function(){this.setProductConfiguration()}.bind(this))},onProductConfigurationError:function(a,b,c){this.set("productConfigurationError","productConfigurationError"),this.set("addonsVmStatus","upcRestFailed")},setProductConfiguration:function(){var a=this.subViewModels.vasActivationViewModel.get("productConfiguration");this.set("productConfiguration",a)},reactivateAddonLink:function(){var a=this;a.set("addonsVmStatus","sendingLink");var b=a.get("productConfiguration"),c=a.get("myAccountCustomerId"),d=a.get("assignedProductId"),e=a.get("reactivationData"),f=a.subViewModels.vasActivationViewModel.sendActivationOfAddons(b,c,d,e);f.done(function(){a.set("addonsVmStatus","activationSuccess")}.bind(a)),f.fail(function(){a.set("addonsVmStatus","activationFailed")}.bind(a))}});return y});
define("businesswidget/repository_l9_common/common/model/SelfCollectionTimeSlotsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/fs/selfcollection/timeslots",rest:{defaults:{contentType:"application/json",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},read:{method:"GET",payload:["[]"]},create:{method:"POST",payload:["ImplReserveSelfCollectionTimeSlotsRequest"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectionTimeSlotsViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/SelfCollectionTimeSlotsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","moment"],function (a,b,c,d,e,f){var g=a.Core.ObservableViewModel.extend({models:{SelfCollectionTimeSlotsModel:c},subViewModels:{CustomerInContextTopicViewModel:d,OnePassTopicViewModel:e},defaults:{appointmentSlots:null,collectionTimeSlotVmStatus:"",popStationData:null,selfCollection:null,slots:[],reservePayload:""},dataBindings:[{nric:"subViewModels.OnePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){b.bindAll(this,"retrieveTimeSlots","reserveTimeSlot","formatAppointments","reformatDate")},retrieveTimeSlots:function(){var a=this;a.set("appointmentSlots",null);var b=a.get("selfCollection");if(a.set("collectionTimeSlotVmStatus","retrieveTimeSlots"),null!==b){var c=a.getModel("SelfCollectionTimeSlotsModel"),d={cdf:"",dealer:b.dealer,documentRequired:b.documentRequired,outlet:b.outlet,ld:b.newLeadDays||b.leadDays};b.orderActionId&&(d.ld=1,d.appointmentOrderActionId=b.orderActionId),c.setQueryParams(d),c.fetch({success:function(c,d){"undefined"!=typeof d.ImplSelfCollectionTimeSlotsResponse?(a.formatAppointments(d.ImplSelfCollectionTimeSlotsResponse.implSelfCollectionTimeSlots,b.leadDays),a.set("collectionTimeSlotVmStatus","slotsRetrieved")):a.set("collectionTimeSlotVmStatus","failed")},error:function(b,c){a.set("collectionTimeSlotVmStatus","failed")}})}else a.set("collectionTimeSlotVmStatus","failed")},formatAppointments:function(a,c){var d={enabledDays:[],dateTimeSlots:{},dateTimeSlotsObj:{}},e=this,g=[];a.sort(function(a,b){var c=f(a.slotDate,"M/D/YYYY").unix(),d=f(b.slotDate,"M/D/YYYY").unix();return c-d}),b.each(a,function(a){if(d.enabledDays.length<6){a.slotDate=e.reformatDate(a.slotDate,"/");1e3*f(a.slotDate,"YYYY-MM-DD").unix();g.push(a),b.contains(d.enabledDays,a.slotDate)||d.enabledDays.push(a.slotDate);var c=d.dateTimeSlots[a.slotDate],h=d.dateTimeSlotsObj[a.slotDate];"undefined"==typeof c&&(c=[],h=[]),h.push(b.extend({id:a.id,value:a.slotCode,title:a.slotDesc},a)),c.push(a.slotDesc),c=b.uniq(c),d.dateTimeSlots[a.slotDate]=c,d.dateTimeSlotsObj[a.slotDate]=h}});var h=b.uniq(d.enabledDays);d.enabledDays=h,e.set("appointmentSlots",d),e.set("slots",g),e.set("collectionTimeSlotVmStatus","success")},reformatDate:function(a,b){dArr=a.split(b);var c=parseInt(dArr[0]);c=c<10?"0"+c:c;var d=parseInt(dArr[1]);return d=d<10?"0"+d:d,dArr[2]+"-"+c+"-"+d},reserveTimeSlot:function(){var a=this;a.set("collectionTimeSlotVmStatus","");var c=$.Deferred(),d=a.get("popStationData"),e=a.get("slots"),f=b.find(e,function(a){if(a.slotDesc===d.slotDesc&&a.slotDate===d.slotDate)return a});if(null!==d&&f){d.id=f.id;var g={ImplReserveSelfCollectionTimeSlotsRequest:{mode:"R",id:d.id,serviceNo:d.serviceNo,custId:this.get("nric")}},h=a.get("selfCollection"),i={slotCode:f.slotCode,slotId:f.id,slotStartDate:f.slotDate,timeDescription:f.slotDesc,outlet:h.outlet};this.set("reservePayload",i);var j=a.getModel("SelfCollectionTimeSlotsModel");j.save(g,{success:function(b,d){d.ImplReserveSelfCollectionTimeSlotsResponse.response?(a.set("collectionTimeSlotVmStatus","success"),c.resolve("SUCCESS")):a.set("collectionTimeSlotVmStatus","failed")},error:function(b){return function(c){a.set("collectionTimeSlotVmStatus","failed"),b.reject(c)}}(c)})}else a.set("collectionTimeSlotVmStatus","failed");return c}});return g});
define("businesswidget/repository_l9_common/common/model/RetrieveOrderDeliveryDetailsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/ordering/order/:orderId/contact-person/:contactId/retrieve-delivery-details",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/RetrieveOrderBillingDetailsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"/ordering/order/:orderId/contact-person/:contactId/retrieve-billing-details",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/ScheduleTechnicalAppointmentViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/ScheduleAppointmentModel","single!businesswidget/repository_l9_common/common/model/ManageAppointmentModel","single!businesswidget/repository_l9_common/common/model/CancelInstallationAppointment","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic"],function (a,b,c,d,e,f,g,h,i,j,k){var l=a.Core.ObservableViewModel.extend({models:{scheduleAppointmentModel:d,ManageAppointmentModel:e,cancelInstallationAppointment:f},subViewModels:{customerInContextTopicViewModel:h,OrderInContextTopicViewModel:g,implUserContextTopicViewModel:i,deviceIdAndPlanIdInContextTopic:j,clearContextInContextTopic:k},dataBindings:[{contactId:"subViewModels.implUserContextTopicViewModel.userInfo.contactDetails.contactId",options:{twoWay:!1,setOnBind:!0}},{contactFormattedName:"subViewModels.implUserContextTopicViewModel.userInfo.contactDetails.registeredName",options:{twoWay:!1,setOnBind:!0}},{contactFirstName:"subViewModels.implUserContextTopicViewModel.userInfo.contactDetails.firstName",options:{twoWay:!1,setOnBind:!0}},{contactLastName:"subViewModels.implUserContextTopicViewModel.userInfo.contactDetails.lastName",options:{twoWay:!1,setOnBind:!0}},{gender:"subViewModels.implUserContextTopicViewModel.userInfo.contactDetails.gender",
options:{twoWay:!1,setOnBind:!0}},{contactNo:"subViewModels.implUserContextTopicViewModel.userInfo.contactDetails.phone",options:{twoWay:!1,setOnBind:!0}}],defaults:{scheduleAppStatus:"",confirmAppointmentPayload:null,confirmAppointmentObject:null,manageAppointmentObject:null,customerId:null,productDetails:[],schedulePayload:null,scheduleResponse:null},initialize:function(a){c.bindAll(this,"onFailure","manageAppointment","confirmAppointment","cancelPreviousAppointment")},manageAppointment:function(){var a=this;a.set("scheduleAppStatus","manageAppointment");var b="Ms";"M"===a.get("gender")&&(b="Mr");var c=a.get("contactLastName");"undefined"==typeof c||null===c||0===c.length?c="..":1===c.length&&(c+=".");var d={contactId:a.get("contactId"),customerFormattedName:b+"#^#"+a.get("contactFirstName")+"#^#"+c,createdContactNo:"65"+a.get("contactNo"),productDetails:a.get("productDetails")},e=a.models.ManageAppointmentModel,f=a.get("customerId")||a.subViewModels.OrderInContextTopicViewModel.get("customerID");"undefined"!=typeof f&&null!==f||(f=a.subViewModels.customerInContextTopicViewModel.get("ID")),e.set("customerId",f),e.set("productOrderId",a.subViewModels.OrderInContextTopicViewModel.get("productOrderID")),e.save({ImplManagaAppointmentResInput:d},{success:function(b,c){void 0!==c.ImplManagaAppointmentResOutput?a.set("manageAppointmentObject",c.ImplManagaAppointmentResOutput):a.onFailure},error:a.onFailure})},onFailure:function(a,b){return this.set("scheduleAppStatus","failure"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),!0},confirmAppointment:function(){var a=this;a.set("scheduleAppStatus","");var b=$.Deferred(),d=a.get("confirmAppointmentPayload");a.subViewModels.deviceIdAndPlanIdInContextTopic.set("dwfmTokenId",d.token);var e={ImplAppointmentScheduleInput:{tokenId:d.token,appointments:d.confirmAppointments}},f=a.getModel("scheduleAppointmentModel");return f.save(e,{customerId:a.subViewModels.OrderInContextTopicViewModel.get("customerID"),productOrderId:a.subViewModels.OrderInContextTopicViewModel.get("productOrderID"),success:c.bind(a.onReserveAppintmentSuccess,a,b),error:function(b){return function(c){a.set("schedulePayload",e),a.set("scheduleResponse",c),a.set("scheduleAppStatus","failure"),b.reject(c)}}(b)}),b},onReserveAppintmentSuccess:function(a,b,c){var d=this;void 0!==c?(d.set("confirmAppointmentObject",c),a.resolve("SUCCESS")):d.set("scheduleAppStatus","failure")},cancelPreviousAppointment:function(){var a=this,b=a.getModel("cancelInstallationAppointment");b.set({contactId:a.get("contactId"),appointmentId:a.get("previousAppointmentId")}),b.destroy({success:function(b,c){c.status?(a.set("scheduleAppStatus","appointmentCancelled"),a.set("manageAppointmentObject",null),a.manageAppointment()):a.set("scheduleAppStatus","failure")},error:a.onFailure})}});return l});
define("businesswidget/repository_l9_common/common/model/CheckSingtelStoreAvailabilityModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){return b.extend({options:{url:"/pos/store-availability",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplStoreAvailabilityRestInput"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplBreadcrumbTopicViewModel",["underscore","lightsaber","businesswidget/repository_l9_common/common/viewmodel/contextTopics/BaseContextTopicViewModel"],function (a,b,c){var d=c.extend({persistent:["bcConfig"],defaults:{displayState:!1,defaultRoute:null,bcConfig:null,stepToAdd:null},addMultipleSteps:function(b){var c=this.get("bcConfig")||[];c=c.concat(b),c=a.uniq(c,!1,function(a){return a.hash}),c=this.sortStepsByRank(c),this.set("bcConfig",c)},addStep:function(b){var c=this.get("bcConfig")||[];(b||this.get("stepToAdd"))&&c.push(b||this.get("stepToAdd")),c=a.uniq(c,!1,function(a){return a.hash}),c=this.sortStepsByRank(c),this.set("bcConfig",c)},sortStepsByRank:function(b){return b=a.sortBy(b,function(a){return a.rank})},syncWith3rdParty:function(){setTimeout(function(){this.sortStepsByRank()}.bind(this),0)},changeDisplayState:function(a){this.set("displayState",a)}});return d});
define("businesswidget/repository_l9_common/common/model/IdUploadDocumentStoreModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/document/upload/store/order/:orderId",rest:{defaults:{method:"POST",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{payload:["ImplUploadDocumentStoreData"],contentType:"multipart/form-data"}}}});return c});
define("businesswidget/repository_l9_common/common/model/IdDocumentDetailsRetrievalModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/retrieve/documentdetails/store/order/:orderId",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")},method:"GET"}}}});return c});
define("businesswidget/repository_l9_common/common/model/IdDocumentRemoveModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/delete/document/order/:orderId",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",payload:["ImplRemoveDocumentFromStoreRestInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/IdDocumentPreviewModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/ecommerce/retrieve/document/order/:orderId/document/:documentId",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")},method:"GET"}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/ImplImageReducerViewModel",function (){var a=function(a){this.originalImage=null,this.originalBase64Img=null,this.reducedImage=null,this.reducedBase64ImageDataUri=null,this.reductionPromise=null,this.reader=null,this.reductionParams=null,this.config={defaultHeight:400,defaultWidth:400,reductionPercentage:30,threshold:a||1048576}},a=function(a){this.originalImage=null,this.originalBase64Img=null,this.reducedImage=null,this.reducedBase64ImageDataUri=null,this.reductionPromise=null,this.reader=null,this.reductionParams=null,this.displayBase64ImageDataUri=null,this.config={defaultHeight:400,defaultWidth:400,reductionPercentage:30,threshold:a||1048576}};return a.prototype={setOriginalImage:function(a){this.originalImage=a},init:function(){this.reductionPromise=$.Deferred(),this.reader=new FileReader,this.reader.onload=this.onOriginalImageRead.bind(this),this.originalBase64Img=document.createElement("img"),this.originalBase64Img.onload=this.onBase64ImageLoad.bind(this)},reduceImageSize:function(){return this.reader.readAsDataURL(this.originalImage),this.reductionPromise},onOriginalImageRead:function(a){this.originalBase64Img.src=a.target.result},onBase64ImageLoad:function(){this.reducedImage=this.createNewImageUsingCanvas(this.originalBase64Img),this.reductionPromise.resolve(this.reducedImage,this.reducedBase64ImageDataUri,this.displayBase64ImageDataUri)},createNewImageUsingCanvas:function(a){this.config.reductionPercentage=30,this.reductionParams=this.getReductionParams(a);var b=this.drawImage(a,null,this.reductionParams);this.config.reductionPercentage=100,this.displayImageReductionParams=this.getReductionParams(a);var c=this.drawImage(a,null,this.displayImageReductionParams),d=this.getFileTypeFromBase64Img(a);if(this.reducedBase64ImageDataUri=b.toDataURL(d),this.displayBase64ImageDataUri=c.toDataURL(d),this.originalImage.size>this.config.threshold)var e=this.dataURLToBlob(this.reducedBase64ImageDataUri);else e=this.originalImage;return e},drawImage:function(a,b,c){var b=b||document.getElementById("myCanvas")||document.createElement("canvas"),d=b.getContext("2d");return b.setAttribute("height",c.height),b.setAttribute("width",c.width),d.drawImage(a,0,0,c.height,c.width),b},getFileTypeFromBase64Img:function(a){var b=a.src.split(";base64,")[0].split(":")[1];return b},getReductionParams:function(a){var b=a.height||this.config.defaultHeight,c=a.width||this.config.defaultWidth,d=this.config.reductionPercentage,e=b-b*d/100;e=e<this.config.defaultHeight?this.config.defaultHeight:e;var f=c-c*d/100;f=f<this.config.defaultWidth?this.config.defaultWidth:f;var g={height:e,width:f};return g},showStats:function(){var a=this.originalImage.size,b=this.reducedImage.size,c=1048576,d=a-b,e=d/a*100;console.log("originalSize - reducedSize = totalReduction"),console.log(a+" - "+b+" = "+d),console.log(a/c+"MB - "+b/c+"MB = "+d/c+"MB"),console.log("Perntage = "+e+"%")},destroy:function(){this.originalImage=null,this.reducedImage=null,this.reducedBase64ImageDataUri=null,this.originalBase64Img=null,this.displayBase64ImageDataUri=null,this.reader.onload=null},dataURLToBlob:function(a){var b=";base64,";if(a.indexOf(b)==-1){var c=a.split(","),d=c[0].split(":")[1],e=c[1];return new Blob([e],{type:d})}for(var c=a.split(b),d=c[0].split(":")[1],e=window.atob(c[1]),f=e.length,g=new Uint8Array(f),h=0;h<f;++h)g[h]=e.charCodeAt(h);return new Blob([g],{type:d})}},a});
define("businesswidget/repository_l9_common/common/viewmodel/business/IdDocumentUploadViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/IdUploadDocumentStoreModel","businesswidget/repository_l9_common/common/model/IsUploadDocumentNeededModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/IdDocumentDetailsRetrievalModel","businesswidget/repository_l9_common/common/model/IdDocumentRemoveModel","businesswidget/repository_l9_common/common/model/IdDocumentPreviewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/ImplImageReducerViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplBreadcrumbTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=a.Core.ObservableViewModel.extend({models:{IsUploadDocumentNeededModel:e,IdDocumentDetailsRetrievalModel:i,IdDocumentRemoveModel:j,IdDocumentPreviewModel:k},subViewModels:{individualInContextTopicViewModel:g,OrderInContextTopicViewModel:f,onePassTopicViewModel:h,getCustomerIdValueViewModel:l,deviceIdAndPlanIdInContextTopic:m,implBreadcrumbTopicViewModel:o,validateSessionTokenViewModel:p},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{orderId:"subViewModels.OrderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}}],defaults:{fileList:[],file:{},userType:"",documentId:null,documentType:"",documentNeeded:!1,uploadedDocumentVmStatus:"",orderId:"",contactId:"",fileTypes:null,maxImageForResize:null,fileListTemp:[],fileToRemove:null,previewImage:null,fileName:null,myInfoEntry:!1},config:{actions:{fileUpload:function(){var a,b=this,c=b.get("file");if(window.OSG_UXF&&window.OSG_UXF.BlobStorage&&(a=OSG_UXF.BlobStorage[c],delete OSG_UXF.BlobStorage[c],"undefined"!=typeof a)){b.resetErrors();var d=this.get("maxImageForResize"),e=new n(d);e.setOriginalImage(a),e.init(),e.reduceImageSize().then(function(c,d,f){e.showStats();var g=b.get("fileList");g.push({fileName:b.get("fileName"),size:a.size,imgSrc:f});var h=new FormData;h.append("UploadedFile1",c,b.get("fileName")),b.set("fileListTemp",g),b.onUploadDocumentStore(h),b.set("uploadedDocumentVmStatus","startUpload"),e.destroy()})}},previewImage:function(){var a=this;a.set("uploadedDocumentVmStatus","inProgress");var b=a.getModel("IdDocumentPreviewModel");b.set({orderId:a.subViewModels.OrderInContextTopicViewModel.get("productOrderReferenceNumber"),documentId:a.get("documentId")}),b.fetch({success:function(b,c){a.set("previewImage",c.ImplRetrieveDocumentFromStoreRestOutput.implFileDetails),a.set("uploadedDocumentVmStatus","previewImageDone")},error:function(b){return a.set("uploadedDocumentVmStatus","error"),!0}})}}},getFilesFormData:function(){var a=new FormData;return c.each(uploadedFileList,function(b,c){a.append("UploadedFile"+c,b.file)}),a},initialize:function(a){c.bindAll(this,"resetErrors","onUploadDocumentStore","checkIfUploadDocumentIsNeeded","getFilesFormData","retrieveDocumentDetails","removeSelectedFile","populateUserType","calculateUploadDocument"),this.set("documentType","Student Pass"),this.set("uploadedDocumentVmStatus","vmInitialized"),this.retrieveDocumentDetails()},populateUserType:function(){var a=this,b=a.subViewModels.onePassTopicViewModel.get("nric"),c=a.get("myInfoEntry");b&&(b.toUpperCase().startsWith("S")||b.toUpperCase().startsWith("T"))?c?a.set("userType","myInfoCitizen"):a.set("userType","citizen"):c?a.set("userType","myInfoEp"):a.set("userType","ep")},onUploadDocumentStore:function(a){var b=this;b.set("uploadedDocumentVmStatus","onUploadDocumentStore"),b.models.IdUploadDocumentStoreModel=b.create("IdUploadDocumentStoreModel",d);var e=b.models.IdUploadDocumentStoreModel.save({ImplUploadDocumentStoreData:a},{orderId:this.get("orderId"),success:function(a,d){b.set("uploadedDocIds",d.ImplUploadDocumentStoreRestOutput.documentIds),b.set("isFileSelected",!0);var e=b.get("fileListTemp");e.length>0&&c.each(e,function(a){a.documentID||(a.documentID=d.ImplUploadDocumentStoreRestOutput.documentIds[0])}),setTimeout(function(){b.set("fileList",e)},0),b.set("uploadedDocumentVmStatus","storeSuccess")},error:function(a){return b.set("uploadedDocumentVmStatus","uploadError"),!0}});e.progress(function(a){if(console.log(a),a.lengthComputable){var b=a.loaded/a.total;console.log(Math.round(100*b)+"%")}})},removeSelectedFile:function(){var a=this;a.set("uploadedDocumentVmStatus","EnteringRemoveSelectedFile");var b={ImplRemoveDocumentFromStoreRestInput:{documentIDs:[a.get("fileToRemove")]}},d=a.getModel("IdDocumentRemoveModel");d.set("orderId",a.get("orderId")),d.save(b,{success:function(b,d){a.set("uploadedDocumentVmStatus","removed");var e=a.get("fileList"),f=a.get("fileToRemove"),g=c.reject(e,function(a){return a.documentID===f});a.set("fileList",g)},error:function(b){return a.set("uploadedDocumentVmStatus","error"),!0}})},retrieveDocumentDetails:function(){var a=this,b=a.getModel("IdDocumentDetailsRetrievalModel");a.set("uploadedDocumentVmStatus","retrieveDocumentDetails");var d=a.subViewModels.OrderInContextTopicViewModel.get("productOrderReferenceNumber");d&&(b.set("orderId",d),b.fetch({success:c.bind(a.onRetriveDocumentSuccess,a),error:function(b){return a.set("uploadedDocumentVmStatus","error"),!0}}))},addDocumentUploadStepToBreadcrumb:function(){this.subViewModels.implBreadcrumbTopicViewModel.addStep({hash:"fulfillment/upload-document",target:"upload-document",title:"Upload Document",icon:"upload_documents",rank:40});var a=this.subViewModels.implBreadcrumbTopicViewModel.get("defaultRoute");a||this.subViewModels.implBreadcrumbTopicViewModel.set("defaultRoute","fulfillment/upload-document")},onRetriveDocumentSuccess:function(a,b){var d=this,e=b.ImplRetrieveDocumentsDetailsForOrderRestOutput;if(e&&e.implFileDetails&&e.implFileDetails.length>0){var f=[];c.each(e.implFileDetails,function(a){f.push({fileName:a.fileName,documentID:a.documentID})}),setTimeout(function(){if(d.populateUserType(),f&&f.length>0){var a="LP_"+d.subViewModels.OrderInContextTopicViewModel.get("productOrderReferenceNumber")+"_",b="MC_"+d.subViewModels.OrderInContextTopicViewModel.get("productOrderReferenceNumber")+"_",e=c.find(f,function(c){return c.fileName&&c.fileName.indexOf(a)===-1&&c.fileName.indexOf(b)===-1});e?(d.set("documentNeeded",!0),d.addDocumentUploadStepToBreadcrumb()):d.checkIfUploadDocumentIsNeeded()}d.set("fileList",f)},0),this.set("uploadedDocumentVmStatus","documentsRetrieved")}else this.checkIfUploadDocumentIsNeeded()},checkIfUploadDocumentIsNeeded:function(){var a=this,b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("hasCisStaff"),c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("hasYouthSilverPlans"),d=!1;if(b){var e=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails"),f=a.subViewModels.onePassTopicViewModel.get("nric");if(e&&"MY_INFO"===e.appType&&e.sessionToken){var g=a.subViewModels.validateSessionTokenViewModel.getCISInfo(e.sessionToken);g.done(function(b){if("cisInfoSuccess"===b){var c=a.subViewModels.validateSessionTokenViewModel.get("cisCustomerDetails");a.set("cisDetails",c),c.custId===f?(a.set("myInfoEntry",!0),a.calculateUploadDocument(d)):(d=!0,a.calculateUploadDocument(d))}else d=!0,a.calculateUploadDocument(d)}.bind(a)),g.fail(function(b){d=!0,a.calculateUploadDocument(d)}.bind(a))}else d=!0,a.calculateUploadDocument(d)}else c?(d=!0,a.calculateUploadDocument(d)):a.calculateUploadDocument(d)},calculateUploadDocument:function(a){var b=this;if(a)b.populateUserType(),b.set("documentNeeded",!0),b.addDocumentUploadStepToBreadcrumb(),b.set("uploadedDocumentVmStatus","success");else{var d=b.subViewModels.onePassTopicViewModel.get(),e=this.subViewModels.OrderInContextTopicViewModel.get(),f=!0;if(e&&e.orderActions){var g=c.find(e.orderActions,function(a){return"simOnlyPlan"===a.flowType&&"Provide"===a.orderType});g&&(f=!1,b.populateUserType(),b.set("documentNeeded",!0),b.addDocumentUploadStepToBreadcrumb(),b.set("uploadedDocumentVmStatus","success"))}if(f){var h=b.subViewModels.getCustomerIdValueViewModel.getDocumentType(d.customerIdType),i=!1,j={documentType:h,isHighEndDevice:i},k=(this.get("userType"),this.getModel("IsUploadDocumentNeededModel"));k.set("contactId",this.subViewModels.individualInContextTopicViewModel.get("personId")),k.set("orderId",e.productOrderReferenceNumber),k.save({ImplIsUploadDocumentNeededResInput:j},{success:function(a,c){var d=c.ImplIsUploadDocumentNeededResOutput;b.populateUserType(),d&&d.answer&&(b.set("documentNeeded",d.answer),b.addDocumentUploadStepToBreadcrumb()),d.isLocal||b.set("uploadedDocumentVmStatus","warningMessage"),b.set("uploadedDocumentVmStatus","success")},error:function(a){return b.set("uploadedDocumentVmStatus","error"),!0}})}}},resetErrors:function(){this.set("isFileTypeValid",!0),this.set("isMaxFileSizeValid",!0),this.set("isFileAlreadyUpload",!1),this.set("isFileSelected",!1)},isAllDataAvailable:function(){return!0}});return q});
define("businesswidget/repository_l9_common/common/viewmodel/business/CheckoutFullfillmentDetailsViewModel",["lightsaber","underscore","Configuration","businesswidget/repository_l9_common/common/model/CreateAddressModel","businesswidget/repository_l9_common/common/model/BillingAccountDetailedListModel","businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","businesswidget/repository_l9_common/common/model/findCallerByContactModel","businesswidget/repository/common/model/CommerceCustomerProductOrderPayChannelModel","businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel","businesswidget/repository_l9_common/common/model/UpdateOrderDeliveryAddressModel","single!businesswidget/repository_l9_common/common/viewmodel/business/MicroCartWidgetViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectionTimeSlotsViewModel","businesswidget/repository_l9_common/common/model/RetrieveOrderDeliveryDetailsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/RetrieveOrderBillingDetailsModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ScheduleTechnicalAppointmentViewModel","businesswidget/repository_l9_common/common/model/RetrievePOPStationsModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/model/UpdateContactDetailsModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository_l9_common/common/model/CheckSingtelStoreAvailabilityModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ReserveAllocateMTPOSEquipmentsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","businesswidget/repository_l9_common/common/model/UpdateDeliveryMethodModel","businesswidget/repository_l9_common/common/model/NotificationPreferencesModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplBreadcrumbTopicViewModel","businesswidget/repository_l9_common/common/model/viewServiceListModel","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateOrderActionAttributesViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/IdDocumentUploadViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R){var S=a.Core.ObservableViewModel.extend({models:{createAddressModel:d,billingAccountDetailedListModel:e,findCallerModel:g,productOrderPayChannelModel:h,billSpecIdPayChannelModel:i,updateOrderDeliveryAddressModel:p,retrieveOrderDeliveryDetailsModel:s,retrieveOrderBillingDetailsModel:u,retrievePOPStationsModel:w,updateContactDetailsModel:y,updateProductConfigurationModel:z,anonymousUpdateProductConfigurationModel:A,checkStoreAvailabilityModel:B,updateDeliveryMethodModel:G,notificationPreferencesModel:H,viewServiceListModel:J},subViewModels:{customerInContextTopicViewModel:j,implUserContextTopicViewModel:l,onePassTopicViewModel:m,orderInContextTopicViewModel:k,individualInContextTopicViewModel:n,logisticsDispatchAppointmetSlotViewModel:o,getBillingAccountDetailedListViewModel:f,microCartWidgetViewModel:q,selfCollectionTimeSlotsViewModel:r,deviceIdAndPlanIdInContextTopic:t,scheduleTechnicalAppointmentViewModel:v,shoppingCartViewModel:x,reserveAllocateMTPOSEquipmentsViewModel:C,updateProductConfigurationViewModel:D,clearContextInContextTopic:E,updateProductConfigurationCustomizedViewModel:F,implBreadcrumbTopicViewModel:I,pickAndGoViewModel:K,selfCollectNowViewModel:L,updateOrderActionAttributesViewModel:N,billMethodPreferenceViewModel:O,idDocumentUploadViewModel:P,singtelStoreEAppointmentViewModel:Q,validateSessionTokenViewModel:R},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{productOrderId:"subViewModels.orderInContextTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0}},{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productOrderItemId:"subViewModels.orderInContextTopicViewModel.productOrderItemID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{orderActions:"subViewModels.orderInContextTopicViewModel.orderActions",options:{twoWay:!1,setOnBind:!0}}],persistent:["billType"],defaults:{firstCall:!0,productOrderItemId:null,confirmAppointment:null,billingAccountSummaryVmStatus:"",checkoutFullfillmentVMStatus:"",addressData:{createBillingAddress:null,createDeliveryAddress:null,selectedBillingId:null,selectedDeliveryAddress:null,nickName:""},selectedOption:"",fulfilmentOptions:{popStation:0,collectFromStore:0,smsMail:0,netLinkRequired:0,installationRequire:0},paperBill:!0,netLink:null,singTelInstallation:null,selectedInstalOption:null,storeIds:[],selectedStore:null,deliveryDetails:null,postalCode:"",popStation:{selectedPopStationAddress:null,availavblePopStations:[]},contactUpdateNeeded:!1,singTelStore:{},billingDetails:null,addressesLoaded:!1,addressId:"",cartPurchaseDetails:null,installationAddress:null,existingWirelineAppointments:null,existingWirelessAppointments:null,popStationPostalCode:null,contactDetails:{},shoppingCartOrderData:null,documentRequired:!1,easyMobileInd:!1,singtelStoreList:[],selectedDevices:null,availableStores:[],popStations:null,billingAccountData:null,quoteCalled:!1,deliveryMethod:null,isEbillSaved:!1,orderCompleted:!1,validationMessages:null,selectedOrderItemId:null,selectedAccessories:null,broadbandInstallationIds:[],instalReq:!1,plansData:[],selectedPromotion:null,pickNGoCodeList:[],isEbillCus:!0,billType:"",eAppointmentCrOn:c.get("eAppointmentCrOn"),cisCustomerDetails:null,hideCollectNow:!1},config:{actions:{updateOrder:function(){var a=this,c=a.get("addressData");a.subViewModels.deviceIdAndPlanIdInContextTopic.set("isNewBar",!1);var d=a.subViewModels.orderInContextTopicViewModel.get("barId"),e=a.getValueByPath("billingDetails.selectedAddress");if(null===d||null!==c.selectedBillingId||null!==c.createBillingAddress&&"undefined"!=typeof c.createBillingAddress.blockOrHouseNum&&null!==c.createBillingAddress.blockOrHouseNum||"undefined"!=typeof e&&null!==e)if(null!==c.selectedBillingId||"undefined"!=typeof e&&null!==e){e&&e.billingAccountNumber&&(c.selectedBillingId=e.billingAccountNumber);var f=a.subViewModels.orderInContextTopicViewModel.get("customerID");if(f)a.subViewModels.orderInContextTopicViewModel.set("barId",c.selectedBillingId),a.getBillSpecIdPayChannel(c.selectedBillingId);else{var g=a.getValueByPath("billingDetails.billingAccountDetails"),h=b.filter(g,function(a){return a.billingAccountNumber===c.selectedBillingId});if(h&&h.length>0){var i=h[0];a.subViewModels.onePassTopicViewModel.set("newcustomer",!1),a.subViewModels.microCartWidgetViewModel.set("customerId",i.customerId),a.subViewModels.orderInContextTopicViewModel.set("customerID",i.customerId);var j=this.subViewModels.implUserContextTopicViewModel.get("registeredName");a.subViewModels.microCartWidgetViewModel.set("completeDataLoaded",!0);var k=a.get("cisCustomerDetails"),l=a.subViewModels.microCartWidgetViewModel.updateContact(j,!0,i.customerId,k,null,null);l.done(function(b){if("checkoutCompleted"===b)a.subViewModels.orderInContextTopicViewModel.set("barId",c.selectedBillingId),a.getBillSpecIdPayChannel(c.selectedBillingId);else if("failed"===b)a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.set("checkoutFullfillmentVMStatus","validationFailure"),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0);else if("deviceReservedFailed"===b){var d=a.get("shoppingCartOrderData");d.numberOfOutOfStockItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.numberOfOutOfStockItems"),d.informationListItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.informationListItems"),a.set("shoppingCartOrderData",d),a.set("checkoutFullfillmentVMStatus","deviceReserveFailedinWareHouse")}else if("accessoryReservedFailed"===b){var d=a.get("shoppingCartOrderData");d.numberOfOutOfStockItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.numberOfOutOfStockItems"),d.informationListItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.informationListItems"),a.set("shoppingCartOrderData",d),a.set("checkoutFullfillmentVMStatus","accessoryReservedFailed")}else a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure")}.bind(a)),l.fail(function(b){"ipaUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","ipaUser")):"fraudUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","fraudUser")):(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure"))}.bind(a))}}}else{var f=a.subViewModels.orderInContextTopicViewModel.get("customerID");if(f)a.createBillingAddress();else{a.subViewModels.onePassTopicViewModel.set("newcustomer",!1),a.subViewModels.microCartWidgetViewModel.set("customerId",a.get("customerId")),a.subViewModels.orderInContextTopicViewModel.set("customerID",a.get("customerId"));var j=a.subViewModels.implUserContextTopicViewModel.get("registeredName");a.subViewModels.microCartWidgetViewModel.set("completeDataLoaded",!0);var k=a.get("cisCustomerDetails"),l=a.subViewModels.microCartWidgetViewModel.updateContact(j,!0,a.get("customerId"),k,null,null);l.done(function(b){if("checkoutCompleted"===b)a.createBillingAddress();else if("failed"===b)a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.set("checkoutFullfillmentVMStatus","validationFailure"),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0);else if("deviceReservedFailed"===b){var c=a.get("shoppingCartOrderData");c.numberOfOutOfStockItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.numberOfOutOfStockItems"),c.informationListItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.informationListItems"),
a.set("shoppingCartOrderData",c),a.set("checkoutFullfillmentVMStatus","deviceReserveFailedinWareHouse")}else if("accessoryReservedFailed"===b){var c=a.get("shoppingCartOrderData");c.numberOfOutOfStockItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.numberOfOutOfStockItems"),c.informationListItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.informationListItems"),a.set("shoppingCartOrderData",c),a.set("checkoutFullfillmentVMStatus","accessoryReservedFailed")}else a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure")}.bind(a)),l.fail(function(b){"ipaUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","ipaUser")):"fraudUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","fraudUser")):(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure"))}.bind(a))}}else a.checkIfDeliveryAddressRequired()},updateBillPreference:function(){var a=this.get("billType");this.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedBillOption",a),this.set("checkoutFullfillmentVMStatus","orderSuccesfull")}}},initialize:function(){b.bindAll(this,"onSaveBillingAddressSuccess","onCreateDeliveryAddressSuccess","updateProductOrderPayChannel","createBillingAddress","createDeliveryAddress","getBillSpecIdPayChannel","createBillAddress","fetchBillingAccountDetails","updateOrderDeliveryAddress","associateCustomerwithOrder","reserveTimeSlots","retrieveDeliveryAddress","confirmAppointment","setCartPurchaseDetails","getPOPStations","loadAddressForRecontract","_findMatchingServiceId","setHeaders","setDefaultQueryParams","getExistingSuccessMessage","updateOrderToRunRules","reserveDeviceInStore","callReservation","removeFreebieFromOrder","setOrderData","clearContextData","setShoppingCartValue","saveEbillPreference","navigateToSummary","cancelOutOfStockItem","onCartItemChange","fetchCustomerProductDetails","updateOrderDeliveryAddressDetails","getPayloadForCollectNow","getCollectNowAddress","getCollectNowDynamicAttributesPayload","doCheckCollectNowFlow","getCISData","handleHideShowDeliveryOptions"),this.getCISData(),this.subViewModels.microCartWidgetViewModel.on("shopingCartLoaded",this.setOrderData,this),this.subViewModels.microCartWidgetViewModel.on("shopingCartLoadFailed",this.clearContextData,this),this.fetchBillingAccountDetails();var a=this;setTimeout(function(){a.set("checkoutFullfillmentVMStatus","vmInitialized")},0)},getCISData:function(){var a=this,b=a.subViewModels.orderInContextTopicViewModel.get("customerID");if("undefined"==typeof b&&null===b){var c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");if("cis"===c){var d=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails");if(d&&"MY_INFO"===d.appType&&d.sessionToken){var e=a.subViewModels.validateSessionTokenViewModel.getCISInfo(d.sessionToken);e.done(function(b){if("cisInfoSuccess"===b){var c=a.subViewModels.validateSessionTokenViewModel.get("cisCustomerDetails");a.set("cisCustomerDetails",c)}else a.clearContextData()}.bind(a)),e.fail(function(b){a.clearContextData()}.bind(a))}}}},cancelOutOfStockItem:function(){var a=this,b=a.subViewModels.microCartWidgetViewModel.cancelOutOfStockItem(!0);b.done(function(b){"SUCCESS"!==b&&"emptyCartContinue"!==b||a.set("checkoutFullfillmentVMStatus","orderCancelledSuccess")}.bind(a)),b.fail(function(b){a.set("checkoutFullfillmentVMStatus","failure")}.bind(a))},onCartItemChange:function(){this.subViewModels.microCartWidgetViewModel.set("selectedOrderItemId",this.get("selectedOrderItemId")),this.subViewModels.microCartWidgetViewModel.onCartItemChange()},setOrderData:function(){this.set("quoteCalled",!0);var a=this.get("billingAccountData");a&&this.setShoppingCartValue(a.orderData,a.billingDetails,a.addressOutput,a.reconActions),this.associateCustomerwithOrder(),this.fetchCustomerProductDetails(this.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order"))},clearContextData:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("checkoutFullfillmentVMStatus","failure")},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},associateCustomerwithOrder:function(){var a=this,b=a.subViewModels.orderInContextTopicViewModel.get("customerID");a.set("checkoutFullfillmentVMStatus","associateCustomer");var c=a.subViewModels.customerInContextTopicViewModel.get("customerIds");if("undefined"==typeof b&&null===b&&1===c.length){var d=this.subViewModels.implUserContextTopicViewModel.get("registeredName");a.subViewModels.microCartWidgetViewModel.set("completeDataLoaded",!0);var e=a.get("cisCustomerDetails"),f=a.subViewModels.microCartWidgetViewModel.updateContact(d,!0,c[0],e,null,null);f.done(function(b){if("checkoutCompleted"===b)a.fetchBillingAccountDetails(),a.set("checkoutFullfillmentVMStatus","orderAssociated");else if("failed"===b)a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.set("checkoutFullfillmentVMStatus","validationFailure"),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0);else if("deviceReservedFailed"===b){var c=a.get("shoppingCartOrderData");c.numberOfOutOfStockItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.numberOfOutOfStockItems"),c.informationListItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.informationListItems"),a.set("shoppingCartOrderData",c),a.set("checkoutFullfillmentVMStatus","deviceReserveFailedinWareHouse")}else if("accessoryReservedFailed"===b){var c=a.get("shoppingCartOrderData");c.numberOfOutOfStockItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.numberOfOutOfStockItems"),c.informationListItems=a.subViewModels.microCartWidgetViewModel.getValueByPath("orderData.informationListItems"),a.set("shoppingCartOrderData",c),a.set("checkoutFullfillmentVMStatus","accessoryReservedFailed")}else a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure")}.bind(a)),f.fail(function(b){"ipaUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","ipaUser")):"fraudUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","fraudUser")):(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure"))}.bind(a))}},fetchBillingAccountDetails:function(){var a=this,c=a.getModel("retrieveOrderBillingDetailsModel");a.set("checkoutFullfillmentVMStatus","fetchBillingAccountDetails"),c.set({orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderID"),contactId:a.subViewModels.individualInContextTopicViewModel.get("ID")}),c.fetch({success:function(c,d){var e=d.ImplRetrieveOrderBillingDetailsRestOutput;if("undefined"!=typeof e&&null!==e){var f=e.billingAccountDetails;f&&f.length>0&&(f=b.filter(f,function(a){return 83!==a.faStatus&&78!==a.faStatus}));var g=a.subViewModels.orderInContextTopicViewModel.get("orderActions"),h=[],i={};i.installationRequired=!1,i.reContractFlag=!1;var j=[],k=!1,l=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("easyMobileId");b.each(g,function(a){a.lob&&h.push(a.lob),"Change"===a.orderType?(j.push(a.productOrderItemID),"TV"!==a.lob&&"BB"!==a.lob&&"WS"!==a.lob&&"FV"!==a.lob||(i.reContractFlag=!0)):"undefined"!=typeof a.lob&&null!==a.lob&&"TV"!==a.lob&&"BB"!==a.lob||(i.installationRequired=!0),l==a.productOrderItemID&&(k=!0)}),i.lobs=h;var m={};e.installationAddress&&i.installationRequired&&(i.installationAddress=e.installationAddress),e.contactAddress&&a.subViewModels.onePassTopicViewModel.get("newcustomer")&&(i.contactAddress=e.contactAddress);var n=a.subViewModels.orderInContextTopicViewModel.get("customerID");e.easyMobileOrderIndicator?(k=!0,b.each(f,function(a){a.dataEligible=!0,"T"===a.baStatus&&e.selectedBarId!==a.billingAccountNumber?a.dataEligible=!1:"Y"===a.easyMobileInd||"y"===a.easyMobileInd?n?String(a.customerId)===n&&(a.dataEligible=!0):a.dataEligible=!0:a.dataEligible=!1})):(k=!1,b.each(f,function(a){a.dataEligible=!0,"T"===a.baStatus&&e.selectedBarId!==a.billingAccountNumber?a.dataEligible=!1:"N"===a.easyMobileInd||"n"===a.easyMobileInd?n?String(a.customerId)===n&&(a.dataEligible=!0):a.dataEligible=!0:a.dataEligible=!1})),a.set("easyMobileInd",k),i.billingAccountDetails=f,i.billPayer=a.subViewModels.onePassTopicViewModel.get("billPayer");var o=a.get("quoteCalled");o?a.setShoppingCartValue(m,i,e,j):a.set("billingAccountData",{orderData:m,billingDetails:i,addressOutput:e,reconActions:j})}else a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","accuntsfailure")},error:function(b,c){c&&0!==c.status&&a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","accuntsfailure")}});var d=a.subViewModels.billMethodPreferenceViewModel.getBillMethodPreference();d.then(function(a){this.set("isEbillCus",a)}.bind(this))},fetchCustomerProductDetails:function(a){var c=this,d=c.subViewModels.orderInContextTopicViewModel.get("customerID"),e=c.subViewModels.onePassTopicViewModel.get("newcustomer");if(d&&!e){var f=c.subViewModels.orderInContextTopicViewModel.get("orderActions"),g=b.find(f,function(a){if("Change"===a.orderType&&"WS"===a.lob&&!a.isFreeMBB)return!0});g&&c.getModel("viewServiceListModel").fetch({customerId:d,success:function(d,e){var g=c.get("plansData");b.each(f,function(c){var d=e.Products.products;if("WS"===c.lob&&!c.isFreeMBB){b.find(d,function(d){if(c.productID===d.id){var e={sourcePlan:d.offeringId,productID:c.productID};return b.find(a.mobile,function(a){if(a.productID===c.productID){var b=a.planDetails;if(b&&b.length>0)return e.targetPlan=b[0].planId,!0}}),g.push(e),!0}})}}),c.set("plansData",g)},error:function(a,b){console.log("error during retrieval of services")}})}},setBreadcrumbsData:function(a,b,c,d,e){var f=[{hash:"fulfillment/order-summary",target:"order-summary",title:"Order Summary",icon:"order_summary",rank:50}];this.subViewModels.implBreadcrumbTopicViewModel.empty(),this.subViewModels.implBreadcrumbTopicViewModel.addMultipleSteps(f);var g;!d&&this.get("isEbillCus")||(g="fulfillment/billing-details",this.subViewModels.implBreadcrumbTopicViewModel.addStep({hash:"fulfillment/billing-details",target:"billing-details",title:"Billing Details",icon:"billing_details",rank:1}));var h=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("skipOF");!h&&b&&(g||(g="fulfillment/installation-appointment"),this.subViewModels.implBreadcrumbTopicViewModel.addStep({hash:"fulfillment/installation-appointment",target:"installation-appointment",title:"Installation Appointment",icon:"installation_appointment",rank:10})),!h&&a&&(g||(g="fulfillment/delivery-and-installation"),this.subViewModels.implBreadcrumbTopicViewModel.addStep({hash:"fulfillment/delivery-and-installation",target:"delivery-and-installation",title:"Delivery",icon:"delivery_installation",rank:20})),!h&&e&&(g||(g="fulfillment/contact-information"),this.subViewModels.implBreadcrumbTopicViewModel.addStep({hash:"fulfillment/contact-information",target:"contact-information",title:"Contact Information",icon:"billing_details",rank:30})),!h&&c&&(g||(g="fulfillment/upload-document"),this.subViewModels.implBreadcrumbTopicViewModel.addStep({hash:"fulfillment/upload-document",target:"upload-document",title:"Upload Document",icon:"upload_documents",rank:40})),g&&this.subViewModels.implBreadcrumbTopicViewModel.set("defaultRoute",g),this.subViewModels.implBreadcrumbTopicViewModel.changeDisplayState(!0)},setShoppingCartValue:function(a,c,d,e){var f=this;a.order=f.subViewModels.shoppingCartViewModel.getValueByPath("orderData.order");var g=f.subViewModels.shoppingCartViewModel.get("selectedDevices");a.order.selectedDevices=g;var h=f.subViewModels.shoppingCartViewModel.get("selectedFreebies");a.order.selectedFreebies=h;var i=f.subViewModels.shoppingCartViewModel.get("selectedAccessories");a.order.selectedAccessories=i;var j=f.subViewModels.shoppingCartViewModel.get("cartPurchaseDetails");f.set("selectedDevices",g),f.set("selectedAccessories",i),f.set("shoppingCartOrderData",a.order);var k=f.subViewModels.deviceIdAndPlanIdInContextTopic.get("reContractFlag");if(c.reContractFlag||k?(c.selectedAddress=f.loadAddressForRecontract(c.billingAccountDetails,a.order,e,d.easyMobileOrderIndicator),c.selectedAddress&&(c.recontractAccount=c.selectedAddress)):d.selectedBarId&&(c.selectedAddress=b.find(c.billingAccountDetails,function(a){return a.billingAccountNumber===d.selectedBarId&&a.dataEligible})),a.order&&a.order.bundle&&a.order.bundle.length>0){var l=f.get("broadbandInstallationIds"),m=b.find(l,function(c){var d=c.split("_"),e=b.find(a.order.bundle,function(a){if(d&&a&&a.broadBandPlanDetails&&a.broadBandPlanDetails.serviceId&&b.contains(d,a.broadBandPlanDetails.serviceId))return!0});if(e)return!0});m?(f.set("instalReq",!0),c.installationRequired=!0):f.set("instalReq",!1),m||c.installationRequired||!j.hasPurchasedRG?c.homeLineDeliveryRequired=!1:c.homeLineDeliveryRequired=!0}else c.homeLineDeliveryRequired=!1;c.hasSim=f.subViewModels.shoppingCartViewModel.get("hasSim")||g&&!b.isEmpty(g)||j.hasPurchasedAccessories;var n=f.subViewModels.shoppingCartViewModel.get("productDetails");c.productDetails=n,c.isEbillCus=f.get("isEbillCus");var o=f.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedBillOption");c.selectedBillOption=o,c.hasFreeMBB=f.subViewModels.shoppingCartViewModel.get("hasFreeMBB"),c.needsOnlyMBBDelivery=f.subViewModels.shoppingCartViewModel.get("needsOnlyMBBDelivery"),c.homeLineDeliveryRequired?c.needsOnlyMBBDelivery=!1:c.hasFreeMBB&&a.order.mobile&&1===a.order.mobile.length&&(c.needsOnlyMBBDelivery=!0),f.set("billingDetails",c),f.set("addressesLoaded",!0);var p=f.subViewModels.shoppingCartViewModel.get("selectedDevicesSkuList"),q=[];p&&p.length>0&&(p=b.unique(p),b.each(p,function(a){q.push({sku:a})}));var i=f.get("selectedAccessories"),r=f.subViewModels.deviceIdAndPlanIdInContextTopic.get("isStoreScenario"),s=j.hasPurchasedHandset,t=j.hasPurchasedTablet,u=f.subViewModels.shoppingCartViewModel.get("hasSim"),v=!(!s&&!t);if(v&&(retrieveCollectNowDeferred=f.subViewModels.selfCollectNowViewModel.retrieveCollectNowStores(!1)),!r&&i&&i.length>0||q&&q.length>0){var w=f.checkStoreAvailablity(q,i,!0);v?$.when(w,retrieveCollectNowDeferred).done(function(b,d){this.handleHideShowDeliveryOptions(c,a.order.selectedDevices,u,b,d)}.bind(this)):w.then(function(b){this.handleHideShowDeliveryOptions(c,a.order.selectedDevices,u,b,"na")}.bind(f))}else v?retrieveCollectNowDeferred.then(function(b){this.handleHideShowDeliveryOptions(c,a.order.selectedDevices,u,"na",b)}.bind(f)):this.handleHideShowDeliveryOptions(c,a.order.selectedDevices,u,"na","na")},handleHideShowDeliveryOptions:function(a,b,c,d,e){var f=!1,g=!1;"storeNotFound"===d&&(f=!0),"storeNotFound"===e&&(g=!0),this.retrieveDeliveryAddress(a,b,c,f,g)},loadAddressForRecontract:function(a,c,d,e){var f=this,g=null;return b.each(a,function(a){(a.dataEligible&&a.subscribers&&a.subscribers.length>0&&e&&"Y"===a.easyMobileInd.toUpperCase()||!e&&"N"===a.easyMobileInd.toUpperCase())&&b.each(a.subscribers,function(b){"undefined"!=typeof g&&null!==g||(g=f._findMatchingServiceId(a,b,c,d),g&&(g=a))})}),g},_findMatchingServiceId:function(a,c,d,e){var f=null;return d.mobile&&d.mobile.length>0&&b.each(d.mobile,function(d){var g=b.filter(e,function(a){return a===d.productOrderItemID});g&&g.length>0&&d.serviceId===c.subscriberResourceVal&&(f=a.billingAccountNumber)}),null===f&&d.tv&&d.tv.length>0&&b.each(d.tv,function(d){var g=b.filter(e,function(a){return a===d.productOrderItemID});g&&g.length>0&&d.subscriptionId===c.subscriberResourceVal&&(f=a.billingAccountNumber)}),null===f&&d.fv&&d.fv.length>0&&b.each(d.fv,function(d){var g=b.filter(e,function(a){return a===d.productOrderItemID});g&&g.length>0&&d.landlineNumber.details==="+65 "+c.subscriberResourceVal&&(f=a.billingAccountNumber)}),null===f&&d.bundle&&d.bundle.length>0&&b.each(d.bundle,function(d){var g=b.filter(e,function(a){return b.contains(d.productOrderItemIDs,a)});g&&g.length>0&&(d.subscriptionId===c.subscriberResourceVal||d.landlineNumber&&d.landlineNumber.details==="+65 "+c.subscriberResourceVal)&&(f=a.billingAccountNumber)}),f},retrieveDeliveryAddress:function(a,c,d,e,f){var g=this,h=a.installationRequired,i=(a.reContractFlag,g.getModel("retrieveOrderDeliveryDetailsModel"));g.set("checkoutFullfillmentVMStatus","retrieveDeliveryAddress"),i.set({orderId:g.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),contactId:g.get("contactId")}),i.fetch({success:function(c,d){var i=d.ImplRetrieveOrderDeliveryDetailsRestOutput;if("undefined"!=typeof i&&null!==i){var j=g.get("deliveryDetails")||{},k=i.billingAccountDetails;k&&k.length>0&&(k=b.filter(k,function(b){if(83!==b.faStatus&&("T"!==b.baStatus||a.selectedAddress&&a.selectedAddress.billingAccountNumber===b.billingAccountNumber))return!0})),g.subViewModels.onePassTopicViewModel.get("newcustomer")&&(j.contactAddress=i.contactAddress),j.billingAddress=k,j.deliveryAddress=i.deliveryAddress,j.emailId=i.email,j.addressDeliveryMethod=i.deliveryMethod,j.existingDeliveryAddress=i.existingDeliveryAddress,i.isBlockOrder?j.installationRequired=!1:j.installationRequired=h,j.phone=i.phone,j.billPayer=g.subViewModels.onePassTopicViewModel.get("billPayer"),i.installationAddress&&(j.installationAddress=i.installationAddress),g.set("deliveryDetails",j),"undefined"!=typeof i.wirelessAppointmentDetailsOutput&&g.set("existingWirelessAppointments",i.wirelessAppointmentDetailsOutput),"undefined"!=typeof i.wirelineAppointmentDetailsOutput&&g.set("existingWirelineAppointments",i.wirelineAppointmentDetailsOutput);var l=g.subViewModels.shoppingCartViewModel.get("cartPurchaseDetails"),m=g.get("nric");l.nric=m,l.nricType=g.subViewModels.onePassTopicViewModel.get("customerIdType"),m&&(m.toUpperCase().startsWith("S")||m.toUpperCase().startsWith("T"))?l.isLocal=!0:l.isLocal=!1;var n={phone:i.phone,emailId:i.email},o=g.subViewModels.implUserContextTopicViewModel.get("userInfo"),p=o.contactSubscriptionDetails||o.subscriptions;o&&p&&p.length>0?(l.existingNewPortin=l.isPortin,l.existingNewNumber=l.isNewNumber,l.newNewPortin=!1,l.newNewNumber=!1):(l.newNewPortin=l.isPortin,l.newNewNumber=l.isNewNumber,l.existingNewPortin=!1,l.existingNewNumber=!1),g.set("contactDetails",n);var q=g.subViewModels.orderInContextTopicViewModel.get("orderActions"),r=b.find(q,function(a){return"BB"===a.lob&&"Change"!==a.orderType});if(r){var s=g.get("selectedDevices");s&&!b.isEmpty(s)||g.subViewModels.shoppingCartViewModel.getValueByPath("cartPurchaseDetails.hasPurchasedAccessories")?l.checkConsolidation=!0:l.checkConsolidation=!1}else l.checkConsolidation=!0;var t=i.pickNGoCode;if(t){var u=g.get("pickNGoCodeList");u&&u.length>0&&b.contains(u,t)?(l.pickNGoValue=t,l.pickNGoValueMatched=!0):l.pickNGoValueMatched=!1}l.hideStore=e,l.hideCollectNow=f,g.set("cartPurchaseDetails",l),g.set("checkoutFullfillmentVMStatus","deliveryAddressLoaded");var v=!1,w=a.recontractAccount;"undefined"!=typeof w&&null!==w||(v=!0);var x=!1;!o||!o.contactDetails||o.contactDetails.phone&&"55555555"!==o.contactDetails.phone&&"****5555"!==o.contactDetails.phone||(x=!0),g.set("contactUpdateNeeded",x);var y,z=l.pickNGoValueMatched||g.subViewModels.idDocumentUploadViewModel.get("documentNeeded");y=!a.needsOnlyMBBDelivery&&(a.hasSim||a.homeLineDeliveryRequired),g.setBreadcrumbsData(y,j.installationRequired,z,v,x)}else g.subViewModels.clearContextInContextTopic.clearAllTopics(!0),g.set("checkoutFullfillmentVMStatus","accuntsfailure")},error:function(a,b){b&&0!==b.status&&g.subViewModels.clearContextInContextTopic.clearAllTopics(!0),g.set("checkoutFullfillmentVMStatus","accuntsfailure")}})},setCartPurchaseDetails:function(a,c,d){var e={hasPurchasedSim:d,hasPurchasedTablet:!1,hasPurchasedHandset:!1,hasTradeIn:!1,hasRecontract:!1,hasPurchasedAccessories:!1,hasPurchasedFreegifts:!1},f=!1;return c&&!b.isEmpty(c)&&(f=!0),b.each(a,function(a){switch(a.productType){case"Sim":e.hasPurchasedSim=d;break;case"Tablet":case"Mobile Broadband":e.hasPurchasedTablet=f;break;case"Mobile":e.hasPurchasedHandset=f}}),e},createBillingAddress:function(){var a=this,b=a.get("addressData"),c="",d=a.get("paperBill");c=d?"METH_NON_PAPER":"METH_PAPER",a.set("deliveryMethod",c);var e=b.createBillingAddress;if("undefined"!=typeof e&&""!==e&&null!==e){var f=a.subViewModels.orderInContextTopicViewModel.get("customerID");void 0!==f&&null!==f&&a.createBillAddress(c,e)}},createBillAddress:function(a,b){var c=this;c.subViewModels.deviceIdAndPlanIdInContextTopic.set("isNewBar",!0);var d=c.get("easyMobileInd"),e=b.unitNo||b.unitNumber||b.apartment,f={ImplBillingAccountCreateRequest:{deliveryMethod:a,nickName:b.nickName||"singtelAccount",isEasyMobile:!!d,contactId:c.get("contactId"),physicalAddress:{floor:e,room:e,houseNumber:b.blockOrHouseNum,postcode:b.postcode||b.postCode,streetName:b.streetName,unitNumber:e,blockOrHouseAddr:"APT Blk",state:b.state,apartment:e,country:b.country,buildingName:b.buildingName}}},g=c.getModel("billingAccountDetailedListModel");g.save(f,{customerId:c.subViewModels.orderInContextTopicViewModel.get("customerID")||c.get("customerId"),success:c.onSaveBillingAddressSuccess,error:function(){c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure")}})},onSaveBillingAddressSuccess:function(a,c){var d=this;if(void 0!==c.ImplBillingAccountCreateResponse||null!==c.ImplBillingAccountCreateResponse){var e=d.get("addressData");d.subViewModels.orderInContextTopicViewModel.set("barId",c.ImplBillingAccountCreateResponse.billingArangmentId),d.subViewModels.orderInContextTopicViewModel.set("billingAddress",e.billingAddress);var f=d.get("nric");if(f){var h={implContactDetails:{indentValue:f,indentType:d.subViewModels.onePassTopicViewModel.get("customerIdType")}};d.models.findCallerModel=d.create("findCallerByContactModel",g),d.models.findCallerModel.save({ImplFindCallerByContactInput:h},{success:b.bind(d.onFindCallerSuccess,d),error:function(){d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("checkoutFullfillmentVMStatus","failure")}})}}else d.set("checkoutFullfillmentVMStatus","failure")},onFindCallerSuccess:function(a,b){void 0!==typeof b.ImplFindCallerByContactOutput?(this.subViewModels.implUserContextTopicViewModel.set("userInfo",b.ImplFindCallerByContactOutput),this.getBillSpecIdPayChannel(this.subViewModels.orderInContextTopicViewModel.get("barId"))):this.set("checkoutFullfillmentVMStatus","failure")},getBillSpecIdPayChannel:function(a){if(void 0!==typeof a||null!==a){var b=this;b.subViewModels.orderInContextTopicViewModel.set("barId",a);var c=this.getModel("billSpecIdPayChannelModel");c.set("customerBillSpecId",a),c.fetch({success:function(a,c){b.updateProductOrderPayChannel(c)},error:function(){b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("checkoutFullfillmentVMStatus","failure")}});var d=b.get("isEbillCus");if(d)b.set("isEbillSaved",!0),b.navigateToSummary();else{var e=b.get("billType");b.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedBillOption",e),b.set("isEbillSaved",!0),b.navigateToSummary()}b.set("billType","")}else b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("checkoutFullfillmentVMStatus","failure")},updateProductOrderPayChannel:function(a){var c=this;if(void 0!==typeof a&&null!==a){var d=c.get("orderActions"),e=[];b.each(d,function(b){e.push({paymentCatergory:"POST",pcnId:a,productOrderItemId:b.productOrderItemID})});var f={PayChannelProductOrderDetails:{productOrderDetails:e}},g=c.getModel("productOrderPayChannelModel");g.save(f,{productOrderId:c.get("productOrderId"),customerId:c.subViewModels.orderInContextTopicViewModel.get("customerID"),success:b.bind(c.checkIfDeliveryAddressRequired,c),error:function(){c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure")}})}else c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure")},checkIfDeliveryAddressRequired:function(){var a,b=this,c=this.get("addressData"),d=b.get("selectedOption"),e=b.get("selectedInstalOption"),f=b.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("orderConsolidationResult")||b.subViewModels.singtelStoreEAppointmentViewModel.get("storeAptDetails");if(b.subViewModels.deviceIdAndPlanIdInContextTopic.set("postalCode",null),"orderConsolidate"===d?"N"===f.slotType?a="sms-mail":"P"===f.slotType||"S"===f.slotType?a="pop-station":"V"===f.slotType||"M"===f.slotType||"D"===f.slotType?a="courier":"EA"===f.slotType&&(a="singtel-store"):a=d,this.subViewModels.deviceIdAndPlanIdInContextTopic.set("selectedOption",a),"courier"===d||"sms-mail"===d){var g=b.get("addressData");g.selectedDeliveryAddress&&g.selectedDeliveryAddress.addressId?(this.set("addressId",g.selectedDeliveryAddress.addressId),b.reserveTimeSlots(d)):b.createDeliveryAddress()}else if("pop-station"===d){var h=b.subViewModels.selfCollectionTimeSlotsViewModel.getValueByPath("selfCollection.selectedStore"),g=b.get("addressData");g.createDeliveryAddress={postCode:h.ZipCode,streetName:h.StreetName,blockOrHouseNum:h.HouseBlockNumber,country:h.country,state:h.state,city:h.city,buildingName:h.BuildingName,blockOrHouseAddr:h.blockOrHouseAddr},b.set("addressData",g),b.subViewModels.deviceIdAndPlanIdInContextTopic.set("postalCode",h.ZipCode),b.createDeliveryAddress()}else if("singtel-pop-station"===d){var h=b.subViewModels.selfCollectionTimeSlotsViewModel.getValueByPath("selfCollection.selectedStore"),g=b.get("addressData");g.createDeliveryAddress={postCode:h.postcode,streetName:h.streetName,blockOrHouseNum:h.blockOrHouseNum,country:h.country,state:h.state,city:h.city,buildingName:h.buildingName,blockOrHouseAddr:h.blockOrHouseAddr,unitNumber:h.floorNo+"-"+h.unitNumber},b.set("addressData",g),b.subViewModels.deviceIdAndPlanIdInContextTopic.set("postalCode",h.zipCode),b.createDeliveryAddress()}else if("collect-now"===d){var i=b.subViewModels.selfCollectNowViewModel.getValueByPath("selfCollectNowInputInfo.selectedLocker"),g=b.get("addressData");g.createDeliveryAddress={postCode:i.PostCode,streetName:i.StreetName,blockOrHouseNum:i.HouseBlockNumber,country:i.country,state:i.state,city:i.city,buildingName:i.BuildingName,blockOrHouseAddr:i.blockOrHouseAddr,unitNumber:i.UnitNumber},b.set("addressData",g),b.subViewModels.deviceIdAndPlanIdInContextTopic.set("postalCode",i.PostCode),b.createDeliveryAddress()}else if("orderConsolidate"===d){var g=b.get("addressData"),c=f.deliveryAddress;g.createDeliveryAddress={postCode:c.postcode,streetName:c.streetName,blockOrHouseNum:c.blockOrHouseNum,country:c.country,state:c.state,city:c.city,buildingName:c.buildingName,unitNumber:c.unitNumber,blockOrHouseAddr:c.blockOrHouseAddr},b.set("addressData",g),"EA"===f.slotType?this.reserveTimeSlots("orderConsolidate"):b.createDeliveryAddress()}else"singtel-installation"===e?b.confirmAppointment():"singtel-store"===d&&b.get("eAppointmentCrOn")?b.createEAppointmentAndProceedToUpdateOrderDelivery():b.updateOrderDeliveryAddress()},createDeliveryAddress:function(){var a=this,b=this.get("addressData"),c=b.createDeliveryAddress,e=c.unitNo||c.unitNumber;if(""!==c&&null!==c){var f={CreateAddressRequest:{address:{apartment:e,floor:e,postalCode:c.postCode||c.postcode,street:c.streetName,streetNumber:c.blockOrHouseNum||c.houseNumber,address2:c.blockOrHouseNum,country:c.country,state:c.state,city:c.city,address1:c.blockOrHouseAddr,address3:c.buildingName,buildingClassificationX8:c.buildingClassification||"Commercial/Factory/JTC"}}};a.models.createAddressModel=a.create("createAddressModel",d),a.getModel("createAddressModel").save(f,{success:a.onCreateDeliveryAddressSuccess,error:function(){a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure")}})}},onCreateDeliveryAddressSuccess:function(a,b){this.set("addressId",b.CreateAddressResponse.address.ID);var c=this.get("selectedOption");if("orderConsolidate"===c||"courier"===c||"pop-station"===c||"singtel-pop-station"===c||"sms-mail"===c)this.reserveTimeSlots(c);else if("collect-now"===c){var d=this.subViewModels.selfCollectNowViewModel.createAppointment();d.then(function(){this.updateOrderDeliveryAddress()}.bind(this),function(){this.set("checkoutFullfillmentVMStatus","collectNowReservationFailed")}.bind(this))}else this.updateOrderDeliveryAddress()},confirmAppointment:function(a){var b=this,a=b.get("selectedInstalOption");b.set("checkoutFullfillmentVMStatus","confirmAppointment");var c="";if("undefined"!=typeof a&&("self-installation"===a||"singtel-installation"===a)){var d=b.subViewModels.scheduleTechnicalAppointmentViewModel,e=b.get("confirmAppointment");d.set("confirmAppointmentPayload",e),c=d.confirmAppointment()}""===c?b.updateOrderDeliveryAddress():(c.done(function(a){"SUCCESS"===a&&b.updateOrderDeliveryAddress()}.bind(b)),c.fail(function(a){b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("checkoutFullfillmentVMStatus","failure")}.bind(b)))},reserveTimeSlots:function(a){var b=this,a=b.get("selectedOption");b.set("checkoutFullfillmentVMStatus","reserveTimeSlots");var c="";if("undefined"==typeof a||"pop-station"!==a&&"singtel-pop-station"!==a){if("undefined"!=typeof a&&("courier"===a||"sms-mail"===a)){var d=!1;"sms-mail"===a&&(d=!0),c=b.subViewModels.logisticsDispatchAppointmetSlotViewModel.onReserveAppointmentSlots(b.get("shoppingCartOrderData"),d)}}else c=b.subViewModels.selfCollectionTimeSlotsViewModel.reserveTimeSlot();""===c?b.confirmAppointment():(c.done(function(a){"SUCCESS"===a&&b.confirmAppointment()}.bind(b)),c.fail(function(a){b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("checkoutFullfillmentVMStatus","failure")}.bind(b)))},createEAppointmentAndProceedToUpdateOrderDelivery:function(){var a=this.subViewModels.singtelStoreEAppointmentViewModel.checkAndCancelEAppointment(),b=$.when(a).then(function(){this.subViewModels.singtelStoreEAppointmentViewModel.createEShopStoreAppointment().then(function(a){var b=this.get("singTelStore");b.confirmedSingTelSore=a.site.dealerCode,this.set("singTelStore",b),this.updateOrderDeliveryAddress()}.bind(this),function(a){this.set("checkoutFullfillmentVMStatus","eAppointmentReservationFailed")}.bind(this))}.bind(this),function(){this.set("checkoutFullfillmentVMStatus","eAppointmentReservationFailed")}.bind(this));return b},updateOrderDeliveryAddress:function(){var a=this,b=a.get("selectedPromotion");if(b){var c={code:b,promoCode:b},d=a.subViewModels.pickAndGoViewModel.updateCode(c,!0);d.done(function(b){if("pickAndGoUpdated"===b){var c=a.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);c.done(function(b){"SUCCESS"===b&&a.updateOrderDeliveryAddressDetails()}.bind(a)),c.fail(function(b){a.updateOrderDeliveryAddressDetails()}.bind(a))}else"pickAndGoFailed"===b&&a.updateOrderDeliveryAddressDetails()})}else a.updateOrderDeliveryAddressDetails()},updateOrderDeliveryAddressDetails:function(){var a=this,c=a.subViewModels.implUserContextTopicViewModel.get("userInfo"),d=a.get("deliveryDetails"),e=d.quonomyAptSelected,f=a.get("selectedOption"),g=!1,h="";switch(f){case"courier":f="Courier to Home",
h=a.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("reservePayload");break;case"pop-station":case"singtel-pop-station":f="Courier To Home (PoPStation)",h=a.subViewModels.selfCollectionTimeSlotsViewModel.get("reservePayload");break;case"singtel-store":f="Pick Up from another store";break;case"sms-mail":f="Courier To Home (Snail Mail)",h=a.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("reservePayload");break;case"orderConsolidate":var i=a.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("orderConsolidationResult")||a.subViewModels.singtelStoreEAppointmentViewModel.get("storeAptDetails");g=!0,"N"===i.slotType?f="Courier To Home (Snail Mail)":"P"===i.slotType||"S"===i.slotType?f="Courier To Home (PoPStation)":"M"===i.slotType||"D"===i.slotType||"V"===i.slotType?f="Courier to Home":"EA"===i.slotType&&(f="Pick Up from another store",g=!1),h={slotCode:i.slotCode,slotStartDate:i.slotStartDate,timeDescription:i.timeDescription,outletCode:i.outletCode,slotId:i.slotId};break;case"collect-now":f="Collect Now";break;default:f="Not Applicable"}var j=[],k=a.get("shoppingCartOrderData");"undefined"!==k&&null!==k&&k.mobile&&k.mobile.length>0&&b.each(k.mobile,function(a){var b=!1;a.orderDetails&&(a.orderDetails.simProductId&&(b=!0),j.push({newSimAdded:b,orderAction:a.orderDetails.orderActionId}))});var l=[],m=[],n=a.get("billingDetails"),o=n.homeLineDeliveryRequired;if(o){var p=a.subViewModels.orderInContextTopicViewModel.get("orderActions");p&&p.length>0&&b.each(p,function(a){a&&"BB"===a.lob&&l.push(a.productOrderItemID),a&&("BB"===a.lob||"FV"===a.lob||a.isFreeMBB||"undefined"==typeof a.lob||null===a.lob)&&m.push(a.productOrderItemID)})}var q=[],r={key:"IS_FSORDER_CONSOLIDATED",value:g};q.push(r);var s={ImplUpdateOrderDeliveryAddressRestInput:{deliveryMethod:f,transactionType:"NEW_SIGN_UP",addressId:a.get("addressId"),recipientDocumentType:a.get("customerIdType"),recipientDocumentId:a.get("nric"),recipientFirstName:c.contactDetails.firstName,recipientLastName:c.contactDetails.lastName,recipientPhone:d.phone,recipientEmail:d.emailId,shippingInstructions:"shippingInstructions",newSIMList:j,documentRequired:a.get("documentRequired"),orderActionsForDelivery:l,orderActionsForFsSrd:m,isSharedEquipmentExist:a.get("instalReq")||a.get("billingDetails.installationRequired"),implKeyPairList:q}};if(void 0!==h&&""!==h){s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:h.slotStartDate,slotEndDate:h.slotStartDate,slotCode:h.slotCode,timeDescription:h.timeDescription};var t=a.get("selectedOption");if("pop-station"===t||"singtel-pop-station"===t){var u=a.subViewModels.selfCollectionTimeSlotsViewModel.get("reservePayload")||{};s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.slotId=u.slotId,s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.popStationCode=u.outlet}else h.slotId&&h.outletCode&&(s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.slotId=h.slotId,s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot.popStationCode=h.outletCode)}if(this.get("eAppointmentCrOn"))if("singtel-store"===a.get("selectedOption")){var v=this.subViewModels.singtelStoreEAppointmentViewModel.get("storeAptDetails");s.ImplUpdateOrderDeliveryAddressRestInput.appointmentId=v.apptId,s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:v.startTimestamp,slotEndDate:v.endTimestamp,slotCode:v.site.siteId,slotId:v.apptId,timeDescription:v.slotDesc}}else this.subViewModels.singtelStoreEAppointmentViewModel.checkAndCancelEAppointment();else e&&e.appointmentId&&(s.ImplUpdateOrderDeliveryAddressRestInput.appointmentId=e.appointmentId,s.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:e.slotStartDate,slotEndDate:e.slotStartDate,slotCode:e.appointmentId,timeDescription:e.timeDescription});"sms-mail"===a.get("selectedOption")?s.ImplUpdateOrderDeliveryAddressRestInput.isSnailMail=!0:s.ImplUpdateOrderDeliveryAddressRestInput.isSnailMail=!1,"collect-now"===a.get("selectedOption")&&this.getPayloadForCollectNow(s);var w=a.getModel("updateOrderDeliveryAddressModel");w.save(s,{customerId:a.subViewModels.orderInContextTopicViewModel.get("customerID"),orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),success:b.bind(a.onUpdateOrderDeliveryAddress,a),error:function(){a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("checkoutFullfillmentVMStatus","failure")}})},onUpdateOrderDeliveryAddress:function(a,b){var c=this;if(b&&b.ImplBaseRestOutput&&b.ImplBaseRestOutput.errorInfo&&b.ImplBaseRestOutput.errorInfo.length>0)c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure");else{var d=c.doCheckCollectNowFlow();d.then(function(){var a=c.get("contactDetails"),b=c.get("deliveryDetails");if(a.phone===b.phone&&"undefined"!=typeof a.emailId&&"undefined"!=typeof b.emailId&&a.emailId.toUpperCase()===b.emailId.toUpperCase()){var d=c.subViewModels.orderInContextTopicViewModel.get("orderActions");c.callReservation(d)}else{var e={ImplContactPerson:{phone:b.phone,emailId:b.emailId}},f=c.getModel("updateContactDetailsModel");f.save(e,{id:c.subViewModels.individualInContextTopicViewModel.get("ID"),success:function(a,b){var d=c.subViewModels.orderInContextTopicViewModel.get("orderActions");c.callReservation(d)},error:function(a,b){c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure")}})}}.bind(c),function(){c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure")}.bind(c))}},doCheckCollectNowFlow:function(){var a,b=this.subViewModels.selfCollectNowViewModel.get(),c=this.get("selectedOption"),d=$.Deferred();return b.collectNowData&&b.collectNowData.lampTrackingID?"collect-now"===c?(address=this.getCollectNowAddress(b.selfCollectNowInputInfo.selectedLocker),a=this.getCollectNowDynamicAttributesPayload(),this.subViewModels.updateOrderActionAttributesViewModel.updateCollectNowAttributes(a),d.resolve()):(d=this.subViewModels.selfCollectNowViewModel.cancelAppointment(),d.then(function(){this.subViewModels.selfCollectNowViewModel.set("collectNowData",null),d.resolve()}.bind(this),function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("checkoutFullfillmentVMStatus","failure"),d.reject()}.bind(this))):d.resolve(),d},getPOPStations:function(){var a=this,c=a.get("popStationPostalCode"),d=a.getModel("retrievePOPStationsModel");a.set("checkoutFullfillmentVMStatus","fetching"),d.set({postcode:c}),d.fetch({success:function(c,d){if("undefined"!=typeof d.ImplRetrievePOPStationsResponse){var e=d.ImplRetrievePOPStationsResponse.implPOPStationDetails;e&&e.length>0?(b.each(e,function(a){a.Distance=a.Distance/1e3}),a.set("popStations",e),a.set("checkoutFullfillmentVMStatus","popStationsFound")):a.set("checkoutFullfillmentVMStatus","noPopStationsFound")}else a.set("checkoutFullfillmentVMStatus","failure")},error:function(b,c){a.set("checkoutFullfillmentVMStatus","failure")}})},checkStoreAvailablity:function(a,c,d){var e=this,f=$.Deferred();e.set("firstCall",!0),e.set("checkoutFullfillmentVMStatus","checkStoreAvailablity");var g=e.getValueByPath("singTelStore.allSingtelStores"),h=e.getModel("checkStoreAvailabilityModel"),i=[];if("undefined"!=typeof a&&null!==a||(a=e.getValueByPath("singTelStore.deviceDetails")),"undefined"!=typeof c&&null!==c||(c=e.get("selectedAccessories")),g&&g.length>0&&a){e.get("productOrderItemId");c&&c.length>0&&(c=b.unique(c,function(a){return a.skuId}),b.each(c,function(b){a.push({sku:b.skuId})})),b.each(g,function(a){i.push(a.mtposId)});var j=[];b.each(a,function(a){var c=$.Deferred(),d={ImplStoreAvailabilityRestInput:{itemCode:a.sku,storeIdPickup:i}};h.save(d,{success:b.bind(e.checkStoreAvailablitySuccess,e,c),error:b.bind(e.checkStoreAvailablityError,e,c)}),j.push(c)}),$.when.apply(e,j).done(function(){var a=e.get("availableStores");a&&a.length>0?(d||(e.set("singtelStoreList",a),e.set("checkoutFullfillmentVMStatus","storeFound")),f.resolve("storeFound")):(d||e.set("checkoutFullfillmentVMStatus","storeNotFound"),f.resolve("storeNotFound"))})}else f.resolve("storeNotFound");return f},checkStoreAvailablityError:function(a,b,c){this.get("firstCall")&&(this.set("firstCall",!1),this.set("availableStores",[])),a.resolve()},checkStoreAvailablitySuccess:function(a,c,d){var e=d.ImplStoreAvailabilityRestOutput;if(e&&e.itemAvailability){var f,g=this.getValueByPath("singTelStore.allSingtelStores"),h=["PU","PO","BO","AL"];this.get("firstCall")?(this.set("firstCall",!1),f=g):f=this.get("availableStores");var i=[];b.each(e.itemAvailability,function(a){if(b.contains(h,a.available)){var c=b.find(g,function(b){return b.mtposId===a.storeID});if(c){var d=b.findWhere(i,{id:c.id});d||i.push(c)}}});var j=[];b.each(f,function(a){var c=b.find(i,function(b){return b.id===a.id});c&&j.push(a)}),this.set("availableStores",j)}else this.set("availableStores",[]);this.subViewModels.singtelStoreEAppointmentViewModel.set("availableStores",this.get("availableStores")),a.resolve()},callReservation:function(a){var b=this,c=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");"singtel-store"===c?b.reserveDeviceInStore(a):(b.subViewModels.deviceIdAndPlanIdInContextTopic.set("reservationIDs",null),b.getExistingSuccessMessage(a))},getExistingSuccessMessage:function(a,c,d){var e=this;return c&&b.each(a,function(a){a.productOrderItemID===c&&(a.updated=!0)}),a=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration&&"BLOCKING"===d.productConfiguration.compatibilityStatus?(e.subViewModels.clearContextInContextTopic.clearAllTopics(!0),e.set("checkoutFullfillmentVMStatus","failure"),!1):void(a&&a.length>0?e.updateOrderToRunRules(a):(e.set("orderCompleted",!0),e.navigateToSummary()))},reserveDeviceInStore:function(a){var c=this,d=c.getValueByPath("singTelStore.confirmedSingTelSore"),e=c.getValueByPath("singTelStore.deviceDetails"),f=c.subViewModels.reserveAllocateMTPOSEquipmentsViewModel;f.set("selectedDevicesSkuIds",e),f.set("selectedStoreId",d);var g=c.subViewModels.orderInContextTopicViewModel.get(),h=c.get("shoppingCartOrderData"),a=b.filter(g.currentOrderActions,function(a){return"WS"===a.lob});if("undefined"!==a&&null!==a&&a.length>0&&h.mobile&&h.mobile.length>0){var i=b.filter(h.mobile,function(a){return a&&a.orderDetails&&a.orderDetails.simProductId});i&&i.length>0&&f.set("shoppingCartMobileData",i)}f.set("selectedFreebiesSkuIds",h.selectedFreebies);var j,k=c.get("cartPurchaseDetails");j=!k.hasPurchasedSim||k.hasPurchasedHandset||k.hasPurchasedTablet||k.hasPurchasedAccessories?f._reserveSelectedDeviceInStore():f._reserveSimInStore(),j.done(function(d){if(d&&d.reservationStatusX9&&d.reservationStatusX9.length>0){var e=d.reservationStatusX9,f=b.filter(e,function(a){return!a.reservationOKX9}),g=d.notAvailableDeviceDetails,i=d.notAvailableFreebiesDetails;if(f&&f.length>0||g&&g.length>0||i&&i.length>0){var j=[],k=h.selectedFreebies;k&&k.length>0&&b.each(k,function(a){var c=b.find(f,function(b){return b.itemCodeX9===a.skuId});("undefined"==typeof c||null===c)&&i&&i.length>0&&(c=b.find(i,function(b){return b.skuId===a.skuId})),c&&(c.productID=a.productID,c.productOrderItemID=a.productOrderItemID,c.name=a.name,j.push(c))});var l=f.length-j.length;l&&l>0||g&&g.length>0?c.set("checkoutFullfillmentVMStatus","deviceReservedFailed"):(c.set("freebiesFailed",j),c.removeFreebieFromOrder(j))}else a&&a.length>0?c.updateOrderToRunRules(a):(c.set("orderCompleted",!0),c.navigateToSummary())}else c.set("checkoutFullfillmentVMStatus","deviceReservedFailed")}.bind(c)),j.fail(function(a){"stockNotAvailable"===a?c.set("checkoutFullfillmentVMStatus","singtelStoreOutOfStock"):(c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("checkoutFullfillmentVMStatus","failure"))})},updateOrderToRunRules:function(a){var c,d=this,e=[],f=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),g=!1,h=d.get("selectedInstalOption");if("singtel-installation"===h)c="Tech Install";else if("self-installation"===h);else{var i=d.get("billingDetails");if(i.homeLineDeliveryRequired){var j=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption");switch(j){case"courier":c="Home Delivery",g=!0;break;case"pop-station":case"singtel-pop-station":c="Home Delivery (Pop Station)",g=!0}}else c="Not Applicable"}var k=d.subViewModels.shoppingCartViewModel.get("gamerVasChanges");f&&f.length>0&&b.each(f,function(a){var b=[];if(c)if("WS"!==a.lob&&"S"===a.level){var f=c;g&&"BB"!==a.lob&&(f="Not Applicable"),b.push({productID:a.productID,changedCharacteristics:[{characteristicID:8710102,value:f}]})}else b.push({productID:a.productID});else b.push({productID:a.productID});var h=d.get("deliveryDetails");k&&k.productOrderItemID===a.productOrderItemID&&h.emailId&&b.push({productID:k.productID,changedCharacteristics:[{characteristicID:k.characteristicID,value:h.emailId}]});var i={productOrderItemId:a.productOrderItemID,returnFullUpcResponse:!1,productConfigurationChanges:{links:[],resumedContainedProducts:[],changedContainedProducts:b,newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}};e.push(i)});var l=d.subViewModels.updateProductConfigurationCustomizedViewModel,m=l._updateProductConfigurationCustomized(e,!0,"QuoteSDOrderSummary+++promoCode+++EMPTY");m.done(function(a,c){if("updateSuccess"===a){var e=c.ImplUpdateOrderProductsResponse,f=!1;if(e&&e.implUpdateOrderProductList){var g=e.implUpdateOrderProductList;g&&g.length>0&&b.each(g,function(a){if(!a.isSuccess){var c=a.ruleExecutionMessages;b.find(c,function(a){if(a.severity){var b=a.severity.toUpperCase();if("ERROR"===b||"BLOCKING"===b)return f=!0,!0}})}})}if(f)return d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("checkoutFullfillmentVMStatus","failure"),!1;d.set("orderCompleted",!0),d.navigateToSummary()}}.bind(d)),m.fail(function(a){d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("checkoutFullfillmentVMStatus","failure")}.bind(d))},removeFreebieFromOrder:function(a){var c=this;c.set("checkoutFullfillmentVMStatus","removeFreebieFromOrder");var d=b.unique(b.pluck(a,"productID")),e=[];b.each(d,function(b){var d=[{productID:b}],f={removedContainedProducts:d,changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]},g={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:"QuoteSDOrderSummary",confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[f],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}},h=c.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("WS",g,a[0].productOrderItemID);e.push(h)}),$.when.apply(c,e).done(function(){var a=c.subViewModels.orderInContextTopicViewModel;c.subViewModels.orderInContextTopicViewModel.set("freebiesFailed",c.get("freebiesFailed")),c.updateOrderToRunRules(a.get("orderActions"))}.bind(c))},saveEbillPreference:function(){var a=[],c=this,d=c.getValueByPath("billingDetails.billingAccountDetails");d=b.filter(d,function(a){return 79===a.faStatus}),d.length?(b.each(d,function(b){if(!b.isEasyMobile){var d=$.Deferred();c.models.updateDeliveryMethodModel.setQueryParams({intFlowType:"ebill"}),c.models.updateDeliveryMethodModel.save({customerId:b.customerId,faId:b.faId,barId:b.billingAccountNumber,ImplBillingDataInput:{barId:b.billingAccountNumber,deliveryMethod:"METH_NON_PAPER",billType:"E_BILL",nickName:b.name,avatarImageId:b.avatarImageId,mcssBillPassword:b.billPassword}},{success:function(a){return function(b){a.resolve()}}(d),error:function(a){return function(b){a.reject()}}(d)}),a.push(d)}}),$.when.apply(c,a).then(function(){var a=[];b.each(d,function(b){b.isEasyMobile||a.push({isSmsNotify:!0,barId:b.billingAccountNumber})}),c.models.notificationPreferencesModel.save({contactId:c.get("contactId"),ImplContactNotificationPreferences:{implBarNotificationPreferences:a,contactId:c.get("contactId")}},{success:function(a,b){c.set("isEbillSaved",!0),c.navigateToSummary()},error:function(){c.set("isEbillSaved",!0),c.navigateToSummary()}})},function(){c.set("isEbillSaved",!0),c.navigateToSummary()})):setTimeout(function(){c.set("isEbillSaved",!0),c.navigateToSummary()},0)},navigateToSummary:function(){var a=this.get("isEbillSaved"),b=this.get("paperBill");!a&&b||!this.get("orderCompleted")||this.set("checkoutFullfillmentVMStatus","orderSuccesfull")},getPayloadForCollectNow:function(a){var b=this.subViewModels.selfCollectNowViewModel.get(),c=b.selfCollectNowInputInfo.selectedLocker||{};this.getCollectNowAddress(c),"From "+M().format("YYYY-MM-DD, h:mm:ss a")+" Onwards";a.ImplUpdateOrderDeliveryAddressRestInput.deliveryTimeSlot={slotStartDate:Date.now(),slotEndDate:null,slotCode:c.slotCode||"S4",timeDescription:"00:00 AM - 11:59 PM",slotId:null,popStationCode:c.KioskId}},getCollectNowDynamicAttributesPayload:function(a){var b=this.subViewModels.selfCollectNowViewModel.get(),c=[],d=b.selfCollectNowInputInfo.selectedLocker||{},e=[];return e.push({name:"popStationName",value:a?"":d.POPStationName},{name:"popStationAddress",value:a?"":address},{name:"popStationCode",value:a?"":d.KioskId},{name:"lampTrackingId",value:a?"":b.collectNowData.lampTrackingID},{name:"trackingID",value:a?"":b.collectNowData.trackingID}),d.collectionPointType&&e.push({name:"collectionPointType",value:a?"":d.collectionPointType}),c.push({productOrderItemID:b.collectNowData.orderActionIDX9,dynamicAttributList:e}),c},getCollectNowAddress:function(a){var b="";return a.HouseBlockNumber&&(b=a.HouseBlockNumber+";"),a.UnitNumber&&(b=b.concat(a.UnitNumber,";")),a.BuildingName&&(b=b.concat(a.BuildingName,";")),a.StreetName&&(b=b.concat(a.StreetName,";")),a.city&&(b=b.concat(a.city,";")),a.PostCode&&(b=b.concat(a.PostCode)),b}});return S});
define("businesswidget/repository_l9_common/common/viewmodel/business/OrderSummaryViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository/common/model/CMCustomerSubmitOrderModel","businesswidget/repository_l9_common/common/model/PayBillReferenceModel","single!businesswidget/repository_l9_common/common/viewmodel/business/MicroCartWidgetViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillingAccountSummaryViewModel","businesswidget/repository_l9_common/common/model/InstallationAddressModel"],function (a,b,c,d,e,f,g,h,i,j){var k=a.Core.ObservableViewModel.extend({dataBindings:[{"models.customerSubmitOrderModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{productOrderId:"subViewModels.orderInContextTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0}},{orderData:"subViewModels.microCartWidgetViewModel.orderData",options:{twoWay:!1,setOnBind:!0}},{"subViewModels.orderInContextTopicViewModel.orderSubmissionStatus":"submitOrderStatus",options:{twoWay:!1,setOnBind:!0}},{"models.billingAccountDetailedListModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.installationAddressModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.PayBillReferenceModel.customerId":"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{"models.PayBillReferenceModel.billingAccountId":"subViewModels.orderInContextTopicViewModel.barId",options:{twoWay:!1,setOnBind:!0}},{accounts:"subViewModels.BillingAccountSummaryViewModel.accounts",options:{twoWay:!1,setOnBind:!0}},{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{productOrderId:null,orderData:null,billingAddress:null,deliveryDetails:null,submitOrderStatus:null,billingAddressStatus:null,deliveryDetailsStatus:null,pgData:null},models:{customerSubmitOrderModel:f,installationAddressModel:j,PayBillReferenceModel:g},subViewModels:{customerInContextTopicViewModel:d,orderInContextTopicViewModel:e,microCartWidgetViewModel:h,BillingAccountSummaryViewModel:i},initialize:function(){this._super(),c.bindAll(this,"submitOrder","onSubmitOrderSuccess","onSubmitOrderError","paymentValidation","onPaymentValidationSuccess"),this.on("change:customerId",this.loadBillingAddress,this),this.models.installationAddressModel.on("change:customerId",this.loadInstallationAddress,this),this.subViewModels.microCartWidgetViewModel.on("change:orderData",this.updateOrderData,this)},updateOrderData:function(){if(void 0!=this.get("orderData")&&""!=this.get("orderData")){var a=this.get("billingAddress"),b=this.get("deliveryDetails");if(null!==a){var c=this.get("orderData");c.billingAddress=a,this.set("orderData",c)}if(null!==b){var c=this.get("orderData");c.deliveryDetails=b,this.set("orderData",c)}}},loadBillingAddress:function(a,b){this.set("billingAddressStatus","SUCCESS");for(var c=this.get("accounts"),d=c.length,e=0;e<d;e++)if(c[e].billingAccountNumber===this.subViewModels.orderInContextTopicViewModel.get("accountId")){var f=this.get("orderData");void 0==f?this.set("billingAddress",c[e].physicalAddress):(f.billingAddress=c[e].physicalAddress,this.set("orderData",f));break}console.log(this.get("orderData"))},loadInstallationAddress:function(){var a=this.getModel("installationAddressModel");void 0!=a.get("customerId")&&""!=a.get("customerId")&&(this.set("deliveryDetailsStatus","LOADING"),a.fetch({success:c.bind(this.onInstallationAddressSuccess,this),error:c.bind(this.onInstallationAddressError,this)}))},onInstallationAddressSuccess:function(a,b){this.set("deliveryDetailsStatus","SUCCESS");var c=this.get("orderData");void 0==c?this.set("deliveryDetails",b.postalAddress):(c.deliveryDetails=b.postalAddress,this.set("orderData",c))},onInstallationAddressError:function(a,b){this.set("deliveryDetailsStatus","ERROR")},submitOrder:function(){this.models.customerSubmitOrderModel.setQueryParams({orderIds:[this.get("productOrderId")],lo:b.get("locale"),sc:b.get("salesChannel")}),this.set("submitOrderStatus","IN_PROGRESS"),this.models.customerSubmitOrderModel.save({},{success:this.onSubmitOrderSuccess,error:this.onSubmitOrderError})},onSubmitOrderSuccess:function(a,b){this.set("submitOrderStatus","SUCCEEDDED")},onSubmitOrderError:function(a,b){this.set("submitOrderStatus","FAILED")},paymentValidation:function(){var a=this;a.getModel("PayBillReferenceModel").save(null,{success:a.onPaymentValidationSuccess,error:a.onInstallationAddressError})},onPaymentValidationSuccess:function(a,b){var c="";c.referenceId="req-id-20160225095253-"+(new Date).getTime().toString().substring(6,12),c.receiptEmailAddress="rohit.thakur@amdocs.com",c.items=JSON.stringify({items:[{itemCode:"0OK",quantity:1,price:c.totalPrice.toString(),description:"Singtelshop.com purchase total price:48.0"}]}),self.set("pgData",c)}});return k});
define("businesswidget/repository_l9_common/common/model/createCustomerModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return a.Core.RESTModel.extend({options:{url:"customer-management/create-customer",rest:{defaults:{method:"POST"},create:{contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/model/UserIdentityCheckModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/user/identity-check",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{contentType:"application/json",method:"POST",payload:["ImplUserIdentityCheckRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/GetOnePassOtpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/user/send-otp",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplSendOTPForAnonymousInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/VerifyOnePassOtpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/onepass/verifyOTP",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/GuestCheckoutViewModel",["lightsaber","Configuration","businesswidget/repository_l9_common/common/model/createCustomerModel","businesswidget/repository_l9_common/common/model/UserIdentityCheckModel","businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/MicroCartWidgetViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/GetOnePassOtpModel","businesswidget/repository_l9_common/common/model/VerifyOnePassOtpModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","single!businesswidget/repository_l9_common/common/viewmodel/NewProductInOfferingInstanceViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel","businesswidget/repository_l9_common/common/model/UpdateContactDetailsModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel","businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){return a.Core.ObservableViewModel.extend({models:{CreateCustomer:c,userIdentityCheckModel:d,findCallerModel:e,getOnePassOtpModel:m,verifyOnePassOtpModel:n,onePassInfoModel:o,implSendNotificationModel:r,updateContactDetailsModel:w},subViewModels:{individualInContextTopicViewModel:f,implUserContextTopicViewModel:h,contactInContextTopicViewModel:g,customerInContextTopicViewModel:i,microCartWidgetViewModel:j,onePassTopicViewModel:k,orderInContextTopicViewModel:l,newProductInOfferingInstanceViewModel:p,deviceIdAndPlanIdInContextTopic:q,miniCartInContextTopic:s,clearContextInContextTopic:t,getCustomerIdValueViewModel:u,storeContextDataViewModel:v,onePassDetailsViewModel:x,validateSessionTokenViewModel:y,retrieveAddressViewModel:z},dataBindings:[{"subViewModels.implUserContextTopicViewModel.userInfo":"userInfo",options:{twoWay:!1,setOnBind:!1}},{"subViewModels.individualInContextTopicViewModel.personId":"userInfo.contactDetails.contactId",
options:{twoWay:!1,setOnBind:!1}},{"subViewModels.contactInContextTopicViewModel.ID":"userInfo.contactDetails.contactId",options:{twoWay:!1,setOnBind:!1}}],defaults:{guestData:null,implLoginVmStatus:"",loginVmStatus:null,nric:null,customerMinimalInformation:{personalInfo:"",address:""},guestCheckoutVmStatus:"",loginStatus:null,userInfo:{contactDetails:{contactId:null,firstName:null,lastName:null,phone:null,gender:null,dateOfBirth:null},contactCustomerDetails:null,contactBillingArrangementDetails:null,contactFinancialAccountDetails:null,contactSubscriptionDetails:null},isLoggedInScenario:!1,loggedInData:null,validationMessages:null,tvSelectData:null,askForTVSubScription:null,contactSubscriptionExists:!1,customerIds:null,registerInterest:null,isFraudUser:!1,contactId:null,cisCustomerDetails:null},config:{actions:{checkUserExists:function(){var a=this,b=a.get("guestData");a.checkUser(b,!0)},register:function(){var a=this,b=a.get("customerMinimalInformation"),c=b.address;if(!c.postCode||"undefined"!=typeof c.buildingClassification&&null!==c.buildingClassification)a.wrapUpdateContact();else{a.subViewModels.retrieveAddressViewModel.set("postalCode",c.postCode);var d=a.subViewModels.retrieveAddressViewModel._retrieveAddress();d.done(function(d){d&&d.length>0&&(c.buildingClassification=d[0].buildingClassification,b.address=c,a.set("customerMinimalInformation",b)),a.wrapUpdateContact()}.bind(a)),d.fail(function(){a.wrapUpdateContact()}.bind(a))}},getOnePassOtp:function(){var a=this,b=a.getValueByPath("customerMinimalInformation.mobileNumber"),c="",d=a.getValueByPath("guestData.guestIdNumber"),e=a.getValueByPath("guestData.guestIdTypeSelected");b&&(b="65-"+b,c={ImplSendOTPForAnonymousInput:{msisdn:b,indentValue:d,indentType:e,purpose:"Register"}});var f=a.getModel("getOnePassOtpModel");f.save(c,{success:function(b,c){a.set("guestCheckoutVmStatus","getOtpSuccess")},error:function(b,c){a.set("guestCheckoutVmStatus","failed")}})}}},wrapUpdateContact:function(){var a=this;a.set("guestCheckoutVmStatus","register");var b=a.get("contactId");b?a.updateContact():a.onUpdateSuccess()},updateContact:function(){var a=this,c=(a.get("customerIds"),a.get("guestData")),d=(a.get("contactSubscriptionExists"),a.get("customerIds"),a.get("customerMinimalInformation")),e=d.personalInfo,f=d.address,g=a.get("contactId"),h=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");h="staff"===h?"Staff":"cis"===h?"CIS - IDD":null;var i=(c.guestIdNumber.substring(0,1),{ImplContactPerson:{birthDate:e.birthDate,emailId:c.email,name:e.registeredName,phone:e.phone,nationality:"Singaporean",salutation:e.salutation,personGender:e.gender,address:{apartment:f.apartment||f.floorNo,city:f.city,floor:f.floorNo,postcode:f.postCode||f.postCode,room:f.unitNo,unitNumber:f.apartment||f.floorNo,houseNumber:f.blockOrHouseNum,state:f.state,country:f.country,streetName:f.streetName,blockOrHouseNum:f.blockOrHouseNum,blockOrHouseAddr:b.get("IS_BLOCKORHOUSEADDR")?f.blockOrHouseAddr:"",buildingName:f.buildingName,countryCode:f.country,unstructAddress:!1,buildingClassification:f.buildingClassification||"HDB",addressType:"Standard"}}});h&&(i.ImplContactPerson.personVipCodeX9=h);var j=a.getModel("updateContactDetailsModel");j.save(i,{id:g,success:_.bind(a.onUpdateSuccess,a),error:_.bind(a.onUpdateFailure,a)})},onUpdateSuccess:function(a,c){var d=this,e=d.get("guestData"),f=(d.get("contactSubscriptionExists"),d.get("loginStatus"),d.get("customerIds")),g=d.get("customerMinimalInformation"),h=g.personalInfo,i=g.address,j=d.get("contactId"),k=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");k="staff"===k?"Staff":"cis"===k?"CIS - IDD":null;e.guestIdNumber.substring(0,1);if(f&&f.length>0){d.subViewModels.customerInContextTopicViewModel.set("ID",f[0]),d.subViewModels.orderInContextTopicViewModel.set("customerID",f[0]),d.set("nric",e.guestIdNumber);var l=d.subViewModels.onePassTopicViewModel;l.set("newcustomer",!0),l.set("nric",e.guestIdNumber),l.set("customerIdType",e.guestIdTypeSelected)}else{var m={personIdentificationDetails:{type:e.guestIdTypeSelected,docNumber:e.guestIdNumber},givenName:h.registeredName,familyName:h.registeredName,custType:"D",custSubType:"N",phone:h.phone,email:e.email,address:{apartment:i.apartment||i.floorNo,city:i.city,floor:i.floorNo,postcode:i.postCode||i.postCode,room:i.unitNo,unitNumber:i.apartment||i.floorNo,houseNumber:i.blockOrHouseNum,state:i.state,country:i.country,streetName:i.streetName,blockOrHouseNum:i.blockOrHouseNum,blockOrHouseAddr:b.get("IS_BLOCKORHOUSEADDR")?i.blockOrHouseAddr:"",buildingName:i.buildingName,countryCode:i.country,unstructAddress:!1,buildingClassification:i.buildingClassification||"HDB",addressType:"Standard"},billingAddressSame:!0,salutation:h.salutation,gender:h.gender,birthDate:h.birthDate,nationality:"Singaporean",race:"Others",customerOwningEntity:"Singapore",customerAccountCategory:"Non In-house",timeZone:"GMT+8",language:"zh-TW",contactId:j};k&&(m.contactVipCodeX9=k),d.set("registrationFinished",!1),d.models.CreateCustomer.save({ImplCreateCustomerInput:m},{success:function(a,b){if("undefined"!=typeof b.ImplCreateCustomerOutput){d.set("registerationOutput",b.ImplCreateCustomerOutput),d.subViewModels.customerInContextTopicViewModel.set("ID",b.ImplCreateCustomerOutput.customerId),d.subViewModels.orderInContextTopicViewModel.set("customerID",b.ImplCreateCustomerOutput.customerId);var c=d.subViewModels.onePassTopicViewModel;d.set("nric",e.guestIdNumber),c.set("newcustomer",!0),c.set("nric",e.guestIdNumber),c.set("customerIdType",e.guestIdTypeSelected),d.set("guestCheckoutVmStatus","success")}else d.set("guestCheckoutVmStatus","failed")},error:function(){d.set("guestCheckoutVmStatus","failed")}})}},onUpdateFailure:function(a,b,c){var d=this;d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("guestCheckoutVmStatus","failed"),d.set("loginVmStatus","anonymous")},initialize:function(){_.bindAll(this,"fetchUserInfo","validateOtp","setOnePassFields","checkUser","processRequest","onCreateTVFailure","continueShopping","deleteCookie","cancelOutOfStockItem","deleteCookieForFraud","updateContact","onUpdateSuccess","onUpdateFailure","removeAccessoriesFromOrder","checkCISAndSetData","wrapUpdateContact"),this.subViewModels.newProductInOfferingInstanceViewModel.on("tvOrderCreated",this.processRequest,this),this.subViewModels.newProductInOfferingInstanceViewModel.on("tvOrderFailed",this.onCreateTVFailure,this),this.subViewModels.microCartWidgetViewModel.set("ignoreError",!0),this.checkCISAndSetData(),this.on("change:nric",this.fetchUserInfo,this)},checkCISAndSetData:function(){var a=this,b=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");if("cis"===b){var c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails");if(c&&"MY_INFO"===c.appType&&c.sessionToken){var d=a.subViewModels.validateSessionTokenViewModel.getCISInfo(c.sessionToken);d.done(function(b){if("cisInfoSuccess"===b){var c=a.subViewModels.validateSessionTokenViewModel.get("cisCustomerDetails");a.set("cisCustomerDetails",c),a.setOnePassFields()}else a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),"cisMismatchError"===b?(a.set("guestCheckoutVmStatus","fraudUser"),a.set("isFraudUser",!0)):(a.set("guestCheckoutVmStatus","failed"),a.set("loginVmStatus","anonymous"))}.bind(a)),d.fail(function(b){a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("guestCheckoutVmStatus","failed"),a.set("loginVmStatus","anonymous")}.bind(a))}else a.setOnePassFields()}else a.setOnePassFields()},setOnePassFields:function(){this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(_.bind(this.onOnePassInfoSuccess,this),_.bind(this.onOnePassInfoFailure,this))},createTVSelectOrder:function(){var a=this,b=a.get("tvSelectData");a.subViewModels.microCartWidgetViewModel.set("tvSelectData",b);var c=a.get("userInfo"),d=[];if(_.each(c.contactCustomerDetails,function(a){d.push(a.customerId)}),d&&d.length>1){var e,f=a.subViewModels.microCartWidgetViewModel.get("orderData"),g=f.order;g&&g.bundle&&g.bundle.length>0&&(e=g.bundle[0].installationAddressID),this.subViewModels.orderInContextTopicViewModel.set("contnueShoppingFlag",!0),this.subViewModels.orderInContextTopicViewModel.set("currentOrderActions",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("planId",b.planId),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("relationId",b.relationId),this.subViewModels.newProductInOfferingInstanceViewModel.set("packType",b.packType),this.subViewModels.newProductInOfferingInstanceViewModel.set("runTVSelectRules",!0),this.subViewModels.newProductInOfferingInstanceViewModel.set("isGuestCheckoutFlow",!0),this.subViewModels.newProductInOfferingInstanceViewModel.set("dealerID",b.dealerID),this.subViewModels.newProductInOfferingInstanceViewModel.set("vendorID",b.vendorID),this.subViewModels.newProductInOfferingInstanceViewModel.createOrder(!0,e)}else a.subViewModels.microCartWidgetViewModel.set("isTVOrderRequired",!0),a.processRequest()},onOnePassInfoSuccess:function(a){var b=this,c=a.ImplLoginHeaderResOutput.headersMap;if(c.HTTP_CUST_ID&&null!==c.HTTP_CUST_ID&&""!==c.HTTP_CUST_ID){this.subViewModels.onePassTopicViewModel.set("loginVmStatus","OnePassInfoLoadedSuccessfully");var d=this.subViewModels.getCustomerIdValueViewModel.getCustomerIdType(c.HTTP_CUST_ID_TYPE);this.subViewModels.onePassTopicViewModel.set("nickName",c.HTTP_GIVEN_NAME),this.subViewModels.onePassTopicViewModel.set("userId",c.HTTP_LOGIN_ID),this.subViewModels.onePassTopicViewModel.set("customerIdType",d),this.subViewModels.onePassTopicViewModel.set("status",c.HTTP_LHTTP_CUST_STATUSOGIN_ID),this.subViewModels.onePassTopicViewModel.set("email",c.HTTP_CUST_EMAIL),this.subViewModels.onePassTopicViewModel.set("familyName",c.HTTP_SSO_FAMILY_NAME),this.subViewModels.onePassTopicViewModel.set("billPayer",c.HTTP_BILL_PAYER),this.subViewModels.onePassTopicViewModel.set("nric",c.HTTP_CUST_ID);var e=c.HTTP_CUST_ID,f=this.get("cisCustomerDetails"),g=!0;if(f&&f.custId&&f.custId!==e&&(g=!1),g){var h={guestIdNumber:e,guestIdTypeSelected:d,email:c.HTTP_CUST_EMAIL,name:c.HTTP_GIVEN_NAME,guestPrefix:e.charAt(0),guestIDNum:e.substring(1,9)};this.set("loggedInData",h),this.checkUser(h,!1)}else this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("isFraudUser",!0),setTimeout(function(){b.set("loginVmStatus","anonymous"),b.set("guestCheckoutVmStatus","fraudUser"),b.set("isFraudUser",!0)},0)}else this.set("loginVmStatus","anonymous")},onOnePassInfoFailure:function(){this.set("loginVmStatus","anonymous")},checkUser:function(a,c){var d=this,e=b.get("idmOn");if(e){d.set("guestCheckoutVmStatus","checkUser"),d.set("loginStatus",null);var f={ImplUserIdentityCheckRestInput:{identity:a.guestIdNumber,identityType:a.guestIdTypeSelected,email:a.email}};d.getModel("userIdentityCheckModel").save(f,{success:function(a,b){var e=b.ImplUserIdentityCheckRestOutput;if("undefined"!=typeof e.customerExists&&"undefined"!=typeof e.onePassUserExists){var f={crmUserExists:e.customerExists,onePassUser:e.onePassUserExists,subscriberMobileExist:e.mobileSubscriberExist,contactSubscriptionExists:e.contactSubscriptionExists,customerIds:e.customerIds,contactId:e.contactId};d.set("contactSubscriptionExists",e.contactSubscriptionExists),d.set("customerIds",e.customerIds),e.contactId&&d.set("contactId",e.contactId),c?d.set("loginStatus",f):e.contactSubscriptionExists?(d.set("isLoggedInScenario",!0),d.set("nric",d.subViewModels.onePassTopicViewModel.get("nric"))):d.set("loginVmStatus","missingCRM")}else d.set("guestCheckoutVmStatus","failed")},error:function(){d.subViewModels.clearContextInContextTopic.clearAllTopics(!0),d.set("guestCheckoutVmStatus","failed"),d.set("loginVmStatus","anonymous")}})}else{var g={crmUserExists:!1,onePassUser:!1};d.set("loginStatus",g)}},fetchUserInfo:function(){var a,b=this;b.set("implLoginVmStatus","fetchUserInfo"),b.set("guestCheckoutVmStatus","fetchUserInfo"),a=b.get("isLoggedInScenario")?b.get("loggedInData"):b.get("guestData");var c,d=b.get("nric"),f=!0,g=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"),h=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("roiDetails");if(h&&h.nric&&h.nric!==d&&(f=!1),"staff"===g||"normal"===g){var i=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("staffDetails");i&&(c=i.custId)}if(c&&c!==d&&(f=!1),f){if(d){var j={implContactDetails:{indentValue:d,indentType:a.guestIdTypeSelected}};b.models.findCallerModel=b.create("findCallerByContactModel",e),b.models.findCallerModel.save({ImplFindCallerByContactInput:j},{success:_.bind(this.onFindCallerSuccess,this),error:_.bind(this.onFindCallerFailure,this)})}}else b.subViewModels.clearContextInContextTopic.clearAllTopics(!0),b.set("isFraudUser",!0),setTimeout(function(){b.set("guestCheckoutVmStatus","fraudUser"),b.set("isFraudUser",!0)},10)},onFindCallerSuccess:function(a,b){var c=this;c.set("userInfo",b.ImplFindCallerByContactOutput);var d=c.subViewModels.orderInContextTopicViewModel.get("orderActions");if(d){var e=_.filter(d,function(a){return"BB"===a.lob});if(e&&e.length>0){var f=_.filter(d,function(a){return"TV"===a.lob});if(f&&0===f.length){var g=b.ImplFindCallerByContactOutput.contactSubscriptionDetails;if(g){var h=_.filter(g,function(a){return"TV"===a.lineOfBusiness});h.length>0?this.set("askForTVSubScription",!1):this.set("askForTVSubScription",!1)}else c.set("askForTVSubScription",!1)}else c.set("askForTVSubScription",!1)}else c.set("askForTVSubScription",!1)}var i=c.get("userInfo"),j=[];_.each(i.contactCustomerDetails,function(a){j.push(a.customerId)}),c.subViewModels.customerInContextTopicViewModel.set("customerIds",j),c.subViewModels.customerInContextTopicViewModel.set("ID",j[0]),c.subViewModels.microCartWidgetViewModel.set("ignoreError",!1),c.set("implLoginVmStatus","findCallerSuccess")},onCreateTVFailure:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("guestCheckoutVmStatus","failed")},continueShopping:function(){this.subViewModels.orderInContextTopicViewModel.set("contnueShoppingFlag",!0),this.subViewModels.orderInContextTopicViewModel.set("currentOrderActions",null),this.subViewModels.deviceIdAndPlanIdInContextTopic.continueShopping(),this.set("implLoginVmStatus","continueShoppingCompleted")},cancelOutOfStockItem:function(){var a=this,b=a.subViewModels.microCartWidgetViewModel.cancelOutOfStockItem(!0);b.done(function(b){"SUCCESS"!==b&&"emptyCartContinue"!==b||a.set("guestCheckoutVmStatus","orderCancelledSuccess")}.bind(a)),b.fail(function(b){a.set("guestCheckoutVmStatus","failed")}.bind(a))},removeAccessoriesFromOrder:function(){var a=this,b=a.subViewModels.microCartWidgetViewModel.removeAccessoriesFromOrder();b.done(function(b){"SUCCESS"===b&&a.set("guestCheckoutVmStatus","accessoriesRemoved")}.bind(a)),b.fail(function(b){a.set("guestCheckoutVmStatus","failed")}.bind(a))},processRequest:function(){var a=this;a.set("guestCheckoutVmStatus","processRequestStarted");var b=a.get("userInfo"),c=[];_.each(b.contactCustomerDetails,function(a){c.push(a.customerId)}),a.subViewModels.customerInContextTopicViewModel.set("customerIds",c),a.subViewModels.customerInContextTopicViewModel.set("ID",c[0]);var d=a.getValueByPath("customerMinimalInformation.personalInfo.registeredName");a.subViewModels.implUserContextTopicViewModel.set("userInfo",b);var e=a.subViewModels.implUserContextTopicViewModel.getValueByPath("userInfo.contactDetails.registeredName"),f=d||e,g=!1;if(1===c.length){g=!0;var h=a.get("cisCustomerDetails"),i=a.subViewModels.microCartWidgetViewModel.updateContact(f,g,c[0],h,null,null);i.done(function(b){"checkoutCompleted"===b?a.get("isLoggedInScenario")?a.set("loginVmStatus","loggedin"):a.set("implLoginVmStatus","userInfoLoadedSuccessfully"):"failed"===b?(a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("loginVmStatus","anonymous")):"deviceReservedFailed"===b?a.set("guestCheckoutVmStatus","deviceReservedFailed"):"accessoryReservedFailed"===b?a.set("guestCheckoutVmStatus","accessoryReservedFailed"):(a.set("validationMessages",a.subViewModels.microCartWidgetViewModel.get("validationMessages")),a.set("loginVmStatus","anonymous"))}.bind(a)),i.fail(function(b){"ipaUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("guestCheckoutVmStatus","ipaUser")):"fraudUser"===b?(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("guestCheckoutVmStatus","fraudUser"),a.set("isFraudUser",!0)):(a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("guestCheckoutVmStatus","failed"))})}else{var i=a.subViewModels.microCartWidgetViewModel.validateConfigurationForAnonymous();i.done(function(b){setTimeout(function(){a.get("isLoggedInScenario")?a.set("loginVmStatus","loggedin"):a.set("implLoginVmStatus","userInfoLoadedSuccessfully")},10)}.bind(a)),i.fail(function(b){a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("guestCheckoutVmStatus","failed")})}},onFindCallerFailure:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("implLoginVmStatus","userInfoLoadingFailed"),this.set("loginVmStatus","anonymous")},validateOtp:function(){var a=this,b=a.getModel("verifyOnePassOtpModel"),c=a.get("customerMinimalInformation");b.setQueryParams({mobileNumber:c.mobileNumber,OTP:c.otp}),b.fetch({success:function(b,c){if(c.Boolean){var d=a.subViewModels.onePassTopicViewModel,e=a.get("guestData");a.set("nric",e.guestIdNumber),d.set("newcustomer",!0),d.set("nric",e.guestIdNumber),d.set("customerIdType",e.guestIdTypeSelected),a.set("guestCheckoutVmStatus","success")}else a.set("guestCheckoutVmStatus","invalidOtp")},error:function(b,c){a.set("guestCheckoutVmStatus","failed")}})},sendEmailToCustomer:function(){var a=this,b=[],c=a.get("registerInterest"),d=a.subViewModels.microCartWidgetViewModel.get("orderData.personalInformation"),e=d.address,f=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId"),g=a.subViewModels.orderInContextTopicViewModel.get("productOrderID"),h=a.subViewModels.miniCartInContextTopic.getValueByPath("flowData.planName"),i=a.subViewModels.onePassTopicViewModel.get(),j=a.subViewModels.storeContextDataViewModel.get();!f&&j.deviceTopicValues&&(f=j.deviceTopicValues.planId),!h&&j.miniCartTopicValues&&(h=j.miniCartTopicValues.planName),!g&&j.orderContextValues&&(g=j.orderContextValues.productOrderID);var k,l;i&&i.nric&&null!==i.nric&&""!==i.nric?(k=i.nric,l=i.customerIdType):(k=d.customerIdNumberPrefix+d.customerIdNumber,l=d.customerIdType);var m=d.customerName;new Date;b.push({key:"customerIC",value:k},{key:"customerName",value:m},{key:"custContactNo",value:d.contactNumber},{key:"custEmailId",value:d.emailId},{key:"custContactNo",value:d.contactNumber},{key:"planId",value:f},{key:"planName",value:h},{key:"addrBlock",value:e.blockOrHouseNum||"NA"},{key:"addrStreetName",value:e.streetName||"NA"},{key:"addrUnitNo",value:e.unitNo||e.apartment},{key:"addrPostalCode",value:e.postCode||e.postcode||"NA"},{key:"mainCoverageStatus",value:"NA"},{key:"subCoverageStatus",value:"NA"},{key:"transaction",value:"NA"},{key:"plan",value:h},{key:"orderId",value:g});var n={ImplSendNotificationRequest:{target:[c.emailId],templateId:c.templateId,notificationChannel:"EMAIL",templateSimpleParameters:b,templateURLParameters:[]}};a.getModel("implSendNotificationModel").save(n,{success:function(b,c){a.set("guestCheckoutVmStatus","mailSent")},error:function(b,c){a.set("guestCheckoutVmStatus","failed")}})},deleteCookie:function(){document.cookie="orderValue=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/",document.cookie="orderActions=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/",sessionStorage.removeItem("cookieCreated")},deleteCookieForFraud:function(){var a=this.get("isFraudUser");a&&this.deleteCookie()}})});
define("businesswidget/repository_l9_common/common/model/PdpaCustomerProfileModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"/pdpa/contact-person/:contactId/customer-profile",rest:{defaults:{method:"GET",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},read:{contentType:"application/json",payload:["[]"]},update:{contentType:"application/json",method:"PUT",payload:["ImplPutContactCustomerOptInOutFlagsRequest"]}}}})});
define("businesswidget/repository_l9_common/common/model/PdpaConsentManagementModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"/pdpa/consent-management",rest:{defaults:{method:"POST",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{contentType:"application/json",payload:["ImplConsentQuery"]},update:{contentType:"application/json",method:"PUT",payload:["ImplConsentObject"]}}}})});
define("businesswidget/repository_l9_common/common/model/UpdatePdpaCmsAndCpsModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"/pdpa/update-preferences",rest:{defaults:{method:"PUT",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{contentType:"application/json",payload:["ImplUpdatePdpaCmsAndCpsResRequest"]}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/PdpaViewModel",["lightsaber","businesswidget/repository_l9_common/common/model/PdpaCustomerProfileModel","businesswidget/repository_l9_common/common/model/PdpaConsentManagementModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdatePdpaCmsAndCpsModel"],function (a,b,c,d,e,f,g){return a.Core.ObservableViewModel.extend({models:{CustomerProfileModel:b,ConsentManagementModel:c,updatePdpaCmsAndCpsModel:g},defaults:{customerFlags:null,pdpaStatus:"",cmsDetails:null,pdpaData:null,savePdpaData:null,cmsResponse:null,customerDetails:null,pdpaVmStatus:null,configData:null,onepassInfo:null,userInfo:null},subViewModels:{OnePassTopicViewModel:d,contactInContextTopicViewModel:e,implUserContextTopicViewModel:f},dataBindings:[{userInfo:"subViewModels.implUserContextTopicViewModel.userInfo",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){_.bindAll(this,"getConsentManagementSystemDetails","getCustomerProfileSystemDetails","getCMSDetailsSuccess","onError","getServiceType","getCPSDetailsSuccess","saveDataProtectionDetails","createPayloadForCms"),setTimeout(function(){this.set("pdpaVmStatus","initialized")}.bind(this),0)},getServiceType:function(a,b){var c=null;switch(a){case"WS":case"MOB":case"Mobile":c=b?"MT":"ME";break;case"TV":c="PT";break;case"BB":case"FHB":c="SG";break;case"FV":c="TS"}return c},getConsentManagementSystemDetails:function(){var a=this,b=a.subViewModels.OnePassTopicViewModel.get("nric"),c=a.subViewModels.OnePassTopicViewModel.get("email"),d=a.subViewModels.implUserContextTopicViewModel.getValueByPath("userInfo.contactSubscriptionDetails"),e=[];_.each(d,function(b){var c=a.getServiceType(b.lineOfBusiness,b.subType);c&&e.push({serviceNumber:b.subscriberId,serviceType:c})});var f=this.get("configData");"undefined"!=typeof f&&null!==f||(f=window.configData,this.set("configData",f),window.configData=null);var g={ImplConsentQuery:{consumerCode:c,consumerIdentification:b,mobileAppCode:f.mobileAppCode,resourceCode:f.resourceCode,resourceType:f.resourceType,sourceSystemCode:"GC",implServiceIdentification:e}};this.getModel("ConsentManagementModel").save(g,{success:this.getCMSDetailsSuccess,error:this.onError})},getCMSDetailsSuccess:function(a,b){var a=b.ImplConsentObject;if(this.set("cmsResponse",b),void 0!==typeof a){var c={partnerData:{},advertiserData:{},customerProfileDetails:{}};_.each(a.consumerConsent,function(a){switch(a.purposeCode){case"GCSTUIN01":c.partnerData.marketResearch=a.consent;break;case"GCSTUIN02":c.partnerData.bills=a.consent;break;case"GCSTUIN03":c.partnerData.webApp=a.consent;break;case"GCSTUIN04":c.partnerData.mail=a.consent;break;case"GCSTUIN05":c.partnerData.email=a.consent;break;case"GCADUIN01":c.advertiserData.bills=a.consent;break;case"GCADUIN02":c.advertiserData.email=a.consent;break;case"GCADUIN03":c.advertiserData.webApp=a.consent;break;case"GCADUIN04":c.advertiserData.mail=a.consent;break;case"GCAGUIN01":c.anonymous=a.consent}}),this.set("cmsDetails",c),this.getCustomerProfileSystemDetails()}},getCustomerProfileSystemDetails:function(){var a=this.getModel("CustomerProfileModel"),b=["WS","MOB","Mobile","FV"];a.setQueryParams({lob:b}),a.set("contactId",this.subViewModels.contactInContextTopicViewModel.get("ID")),a.fetch({success:this.getCPSDetailsSuccess,error:this.onError})},getCPSDetailsSuccess:function(a,b){var c=b.ImplCustomerOptInOutFlagsResponse.implCustomerOptInOutFlags;this.set("customerDetails",c);_.each(c,function(a){"undefined"!=typeof a.smsSTFlag&&null!==a.smsSTFlag||(a.smsSTFlag="dncr"),"undefined"!=typeof a.callSTFlag&&null!==a.callSTFlag||(a.callSTFlag="dncr"),"undefined"!=typeof a.smsAdsFlag&&null!==a.smsAdsFlag||(a.smsAdsFlag="dncr"),"undefined"!=typeof a.callAdsFlag&&null!==a.callAdsFlag||(a.callAdsFlag="dncr")});var d=this.get("cmsDetails");d.customerProfileDetails=c,this.set("pdpaData",d),this.set("pdpaStatus","success")},saveDataProtectionDetails:function(){var a=this,b=a.getValueByPath("savePdpaData.customerProfileDetails");b&&b.length>0&&_.each(b,function(a){"dncr"===a.smsSTFlag&&(a.smsSTFlag=null),"dncr"===a.callSTFlag&&(a.callSTFlag=null),"dncr"===a.smsAdsFlag&&(a.smsAdsFlag=null),"dncr"===a.callAdsFlag&&(a.callAdsFlag=null)});var c=a.createPayloadForCms(),d={ImplUpdatePdpaCmsAndCpsResRequest:{implConsentObject:c.ImplConsentObject}};b&&(d.ImplUpdatePdpaCmsAndCpsResRequest.implPutContactCustomerOptInOutFlagsRequest={implCustomerOptInOutFlags:b}),a.getModel("updatePdpaCmsAndCpsModel").save(d,{type:"PUT",success:_.bind(a.saveCPSDetailsSuccess,a),error:a.onError}),a.set("pdpaStatus","inprogress")},saveCPSDetailsSuccess:function(a,b){var b=b.ImplUpdatePdpaCmsAndCpsResResponse;b.implPutContactCustomerOptInOutFlagsResponse&&b.implPutContactCustomerOptInOutFlagsResponse.implPutCustomerOptInOutFlagsResponse&&"Not Successful"==b.implPutContactCustomerOptInOutFlagsResponse.implPutCustomerOptInOutFlagsResponse.resultCode?this.set("pdpaStatus","failure"):this.set("pdpaStatus","updationSuccessful")},createPayloadForCms:function(){var a=this.get("savePdpaData"),b=this.get("cmsResponse");return b.ImplConsentObject.serviceConsent&&delete b.ImplConsentObject.serviceConsent,_.each(b.ImplConsentObject.consumerConsent,function(b){switch(b.purposeCode){case"GCSTUIN01":b.consent=a.partnerData.marketResearch;break;case"GCSTUIN02":b.consent=a.partnerData.bills;break;case"GCSTUIN03":b.consent=a.partnerData.webApp;break;case"GCSTUIN04":b.consent=a.partnerData.mail;break;case"GCSTUIN05":b.consent=a.partnerData.email;break;case"GCADUIN01":b.consent=a.advertiserData.bills;break;case"GCADUIN02":b.consent=a.advertiserData.email;break;case"GCADUIN03":b.consent=a.advertiserData.webApp;break;case"GCADUIN04":b.consent=a.advertiserData.mail;break;case"GCAGUIN01":b.consent=a.anonymous}}),b},onError:function(){this.set("pdpaStatus","failure")}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/SubmitRegisterInterestViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d,e,f,g,h,i){return a.Core.ObservableViewModel.extend({models:{implSendNotificationModel:h},subViewModels:{deviceIdAndPlanIdInContextTopic:c,individualInContextTopicViewModel:d,onePassTopicViewModel:e,miniCartInContextTopic:f,orderInContextTopicViewModel:g},defaults:{registerInterestVmStatus:"",address:null,registerInterest:null},initialize:function(){this._super();b.bindAll(this,"sendEmailToCustomer"),this.set("registerInterestVmStatus","vmInitialized")},sendEmailToCustomer:function(){var a,b=this,c=[],d=b.subViewModels.deviceIdAndPlanIdInContextTopic.get();b.set("registerInterestVmStatus","sendEmailToCustomer");var e=d.recontractNumber?d.recontractNumber.address:null;if(e){var f=$.Deferred();a=b.get("registerInterest");var g,h,i=b.subViewModels.onePassTopicViewModel.get();i&&i.nric&&null!==i.nric&&""!==i.nric?(g=i.nric,h=i.customerIdType):(g=a.customerIdNumberPrefix+a.customerIdNumber,h=a.customerIdType);var j=a.customerName,k=e.unitNo||e.apartment,l=e.floorNo||e.floor,m=l&&k?"#"+l+"-"+k:" ";k&&k.indexOf("#")>-1&&(m=k);new Date;c.push({key:"customerIC",value:g},{key:"customerName",value:j},{key:"custContactNo",value:a.contactNumber},{key:"custEmailId",value:a.customerEmail},{key:"planId",value:d.planId},{key:"planName",value:b.subViewModels.miniCartInContextTopic.getValueByPath("flowData.planName")},{key:"addrBlock",value:e.blockOrHouseNum},{key:"addrStreetName",value:e.streetName},{key:"addrUnitNo",value:m},{key:"addrPostalCode",value:e.postCode||e.postcode},{key:"mainCoverageStatus",value:"NA"},{key:"subCoverageStatus",value:"NA"},{key:"transaction",value:a.transaction},{key:"plan",value:b.subViewModels.miniCartInContextTopic.getValueByPath("flowData.planName")},{key:"orderId",value:b.subViewModels.orderInContextTopicViewModel.get("productOrderID")||"NA"});var n={ImplSendNotificationRequest:{target:[a.emailId],templateId:a.templateId,notificationChannel:"EMAIL",templateSimpleParameters:c,templateURLParameters:[]}};return b.getModel("implSendNotificationModel").save(n,{success:function(a){return function(c){b.set("registerInterestVmStatus","mailSent"),a.resolve()}}(f),error:function(a){return function(c){b.set("registerInterestVmStatus","mailFailure"),a.reject()}}(f)}),f}},sendEmailToCRC:function(){var a=this,b=$.Deferred(),c=[];a.set("registerInterestVmStatus","sendEmailToCustomer");var d=a.get("registerInterest"),e=d.lob;switch(e){case"FHB":e="Fibre Home Service(s)";break;case"FIBER":e="Fibre Home Service(s)";break;case"TV":e="Singtel TV Service(s)"}c.push({key:"customerName",value:d.customerName},{key:"lobProduct",value:e},{key:"requestDate",value:d.date});var f={ImplSendNotificationRequest:{target:[d.customerEmail],templateId:d.crcTemplateId,notificationChannel:"EMAIL",templateSimpleParameters:c,templateURLParameters:[]}};return a.getModel("implSendNotificationModel").save(f,{success:function(b){return function(c){a.set("registerInterestVmStatus","crcMailSent"),b.resolve("passed")}}(b),error:function(b){return function(c){a.set("registerInterestVmStatus","crcMailFailed"),b.resolve("fail")}}(b)}),b}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetNetworkCoverageViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/CheckServiceCoverageModel","businesswidget/repository_l9_common/common/model/UpdateOrderNetworkCoverageModel","businesswidget/repository_l9_common/common/model/UpdateOrderNetworkCoverageAnonymousModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/common/model/CreateAddressModel","businesswidget/repository_l9_common/common/viewmodel/NewProductInOfferingInstanceViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestModel","businesswidget/repository_l9_common/common/model/RetrieveQuoteRequestAnonymousModel","businesswidget/repository_l9_common/common/model/SearchAddressinCRMModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SubmitRegisterInterestViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){return a.Core.ObservableViewModel.extend({models:{CheckServiceCoverageModel:c,createAddressModel:g,updateOrderNetworkCoverageModel:d,updateOrderNetworkCoverageAnonymousModel:e,implSendNotificationModel:l,onePassInfoModel:n,findCallerModel:o,updateContactModel:r,retrieveQuoteRequestModel:s,retrieveQuoteRequestAnonymousModel:t,searchAddressinCRMModel:u},subViewModels:{individualInContextTopicViewModel:f,newProductInOfferingInstanceViewModel:h,orderInContextTopicViewModel:i,deviceIdAndPlanIdInContextTopic:j,addressWidgetViewModel:k,onePassTopicViewModel:m,implUserContextTopicViewModel:p,customerInContextTopicViewModel:q,miniCartInContextTopic:v,contactInContextTopicViewModel:w,getCustomerIdValueViewModel:x,storeContextDataViewModel:y,submitRegisterInterestViewModel:z,clearContextInContextTopic:A,onePassDetailsViewModel:B},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{officeHours:null,networkCoverageVmstatus:"",address:null,installationAddress:[],contactId:null,result:null,coverageType:null,coverageStatus:null,registerInterest:null,loginVmStatus:null,s6Data:null,selectedAddress:null,flowType:null,coverageSubStatus:null,dealerID:null,vendorID:null,adslOrderActionId:null,runSaveOrderData:!1,defaultSTBType:null,isBlockOrder:!1,gaTaggingPayload:null,preTickAddonDetails:null},initialize:function(a){b.bindAll(this,"onFailure","checkForOfficeHours","onCheckServiceCoverageSuccess","onCreateAddressSuccess","checkCoverage","_saveOrderData","orderFailure","sendEmailToCustomer","setOnePassFields","fetchUserInfo","doUpdateContact","getInstallationAddress","_onRetrieveQuoteSuccess","_onRetrieveQuoteError","onCheckServiceCoverage","orderSuccess","onCheckServiceCoverageForRecon","handleNLTStatusNew");var c=this;this.subViewModels.newProductInOfferingInstanceViewModel.on("dataSet",this._saveOrderData,this),this.subViewModels.newProductInOfferingInstanceViewModel.on("orderFailure",this.orderFailure,this);var d=this.subViewModels.orderInContextTopicViewModel.get("productOrderID"),e=this.subViewModels.orderInContextTopicViewModel.get("orderActions");if(d&&e&&e.length>0){var f=b.find(e,function(a){return"TV"===a.lob||"BB"===a.lob});f?setTimeout(function(){c.set("networkCoverageVmstatus","vmInitialized")},0):setTimeout(function(){c.set("loginVmStatus","initialized")},0)}else setTimeout(function(){c.set("loginVmStatus","initialized")},0)},config:{actions:{createAddress:function(){var a=this.get("address"),b=this;if(void 0!==typeof a&&null!==a){var c=(a.unitNo||a.apartment,a.floorNo||a.floor,{CreateAddressRequest:{address:{apartment:a.apartment||a.floorNo||a.floor,floor:a.floor||a.floorNo,postalCode:a.postCode,street:a.streetName,streetNumber:a.blockOrHouseNum,address2:a.blockOrHouseNum,country:a.country,state:a.state,city:a.city,address1:a.blockOrHouseAddr,address3:a.buildingName,buildingClassificationX8:a.buildingClassification}}});b.getModel("createAddressModel").save(c,{success:b.onCreateAddressSuccess,error:function(){b.set("networkCoverageVmstatus","failure")}})}}}},onCheckServiceCoverageForRecon:function(a){var b=$.Deferred();return this.set("coverageType","HDB"),this.set("coverageStatus","In-Service"),b.resolve("success"),b},onCheckServiceCoverage:function(a){var b=$.Deferred(),c=this.get("address")||this.get("selectedAddress"),d=this;return d.set("result",""),void 0!==typeof c&&null!==c?("undefined"!=typeof c.buildingClassification&&null!==c.buildingClassification||(c.buildingClassification="Others Residential"),d.checkCoverage(c,b,a)):b.resolve("success"),b},getInstallationAddress:function(){var a=this,c=a.subViewModels.orderInContextTopicViewModel.get();if("undefined"!=typeof c.productOrderID&&null!==c.productOrderID){var d,e=c.customerID,f={RetrieveQuoteRequest:{links:[],productOrderReferenceNumber:c.productOrderReferenceNumber,activityForConfiguration:"QuoteSDAllDiscounts",returnQuoteData:{links:[],quotedItemsInd:!0,taxInformationInd:!0,configurationItemsInd:!0}}};"undefined"!=typeof e&&null!==e?(d=a.getModel("retrieveQuoteRequestModel"),d.save(f,{customerId:e,productOrderId:c.productOrderID,success:b.bind(a._onRetrieveQuoteSuccess,a),error:b.bind(a._onRetrieveQuoteError,a)})):(d=a.getModel("retrieveQuoteRequestAnonymousModel"),d.save(f,{productOrderId:c.productOrderID,success:b.bind(a._onRetrieveQuoteSuccess,a),error:b.bind(a._onRetrieveQuoteError,a)}))}else this.set("loginVmStatus","initialized")},_onRetrieveQuoteSuccess:function(a,c){if("undefined"!=typeof c.RetrieveQuoteResponse&&c.RetrieveQuoteResponse.order){var d,e=c.RetrieveQuoteResponse.order,f=this;if(e.productOfferings&&b.each(e.productOfferings,function(a){b.each(a.productOrderItems,function(a){a.installationAddressID&&(d=a.installationAddressID)})}),d){var a=f.getModel("searchAddressinCRMModel");a.setQueryParams({addressIds:[d]}),a.fetch({success:b.bind(f.setAddress,f,d),error:b.bind(f._onRetrieveQuoteError,f)})}else this.set("loginVmStatus","initialized")}else this.set("networkCoverageVmstatus","failure")},setAddress:function(a,c,d){var e=this,f=d.HashMap,g=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),h=f[a];if(g&&g.length>0){var i=b.find(g,function(a){return"Change"===a.orderType&&("TV"===a.lob||"BB"===a.lob)});if(i){h.hideProvide=!0;var j=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutOrderID"),k=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("expressCheckoutServiceID"),l=this.subViewModels.orderInContextTopicViewModel.get("productOrderID");j&&l&&k===l&&k&&(h.expressCheckoutServiceID=k)}else h.hideRecon=!0}this.set("selectedAddress",h),this.set("loginVmStatus","initialized"),this.onCheckServiceCoverage(!0)},_onRetrieveQuoteError:function(a,b){this.set("loginVmStatus","initialized")},setOnePassFields:function(){var a=sessionStorage.getItem("loginClicked");a?this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(b.bind(this.onOnePassInfoSuccess,this),b.bind(this.onOnePassInfoFailure,this)):this.set("loginVmStatus","anonymous")},onOnePassInfoSuccess:function(a){var b=a.ImplLoginHeaderResOutput.headersMap;if(b.HTTP_CUST_ID&&null!==b.HTTP_CUST_ID&&""!==b.HTTP_CUST_ID){this.subViewModels.onePassTopicViewModel.set("loginVmStatus","OnePassInfoLoadedSuccessfully");var c=this.subViewModels.getCustomerIdValueViewModel.getCustomerIdType(b.HTTP_CUST_ID_TYPE);this.subViewModels.onePassTopicViewModel.set("nickName",b.HTTP_GIVEN_NAME),this.subViewModels.onePassTopicViewModel.set("userId",b.HTTP_LOGIN_ID),this.subViewModels.onePassTopicViewModel.set("customerIdType",c),this.subViewModels.onePassTopicViewModel.set("status",b.HTTP_LHTTP_CUST_STATUSOGIN_ID),this.subViewModels.onePassTopicViewModel.set("email",b.HTTP_CUST_EMAIL),this.subViewModels.onePassTopicViewModel.set("familyName",b.HTTP_SSO_FAMILY_NAME),this.subViewModels.onePassTopicViewModel.set("billPayer",b.HTTP_BILL_PAYER),this.subViewModels.onePassTopicViewModel.set("nric",b.HTTP_CUST_ID),this.fetchUserInfo(b.HTTP_CUST_ID,c)}else sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","anonymous")},onOnePassInfoFailure:function(){this.set("loginVmStatus","anonymous"),sessionStorage.removeItem("loginClicked")},fetchUserInfo:function(a,c){var d=this;if(a){var e={implContactDetails:{indentValue:a,indentType:c}};d.models.findCallerModel=d.create("findCallerByContactModel",o),d.models.findCallerModel.save({ImplFindCallerByContactInput:e},{success:b.bind(this.onFindCallerSuccess,this),error:b.bind(this.onFindCallerFailure,this)})}},onFindCallerSuccess:function(a,c){var d=this,e=[];b.each(c.ImplFindCallerByContactOutput.contactCustomerDetails,function(a){e.push(a.customerId)}),d.subViewModels.customerInContextTopicViewModel.set("customerIds",e),d.subViewModels.customerInContextTopicViewModel.set("ID",e[0]),d.subViewModels.contactInContextTopicViewModel.set("ID",c.ImplFindCallerByContactOutput.contactDetails.contactId),d.subViewModels.implUserContextTopicViewModel.set("userInfo",c.ImplFindCallerByContactOutput),d.subViewModels.individualInContextTopicViewModel.set("personId",c.ImplFindCallerByContactOutput.contactDetails.contactId);var f=c.ImplFindCallerByContactOutput.contactDetails.registeredName,g=!1;1===e.length&&(g=!0);var h=d.subViewModels.orderInContextTopicViewModel.get("orderActions");"undefined"!=typeof h&&null!==h&&h.length>0?this.doUpdateContact(g,f,e[0],h):(sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","loggedin"))},doUpdateContact:function(a,c,d,e){var f=this,g=f.subViewModels.orderInContextTopicViewModel.get(),h=f.getModel("updateContactModel"),i=!1;a?(h.setQueryParams({isAnonymous:!0}),i=!0):h.setQueryParams({isAnonymous:!1}),h.set({customerId:d,orderId:g.productOrderReferenceNumber});var j=g.updatedOrderActions||[],k=b.filter(e,function(a){return!b.contains(j,a.productOrderItemID)}),l=[],m=[];if(b.each(k,function(a){l.push({orderActionId:a.productOrderItemID,contactId:f.subViewModels.individualInContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),m.push(a.productOrderItemID)}),l.length>0){var n={ImplAddCustomerContactRestInput:{orderAction:l}};h.save(n,{success:b.bind(f.onupdateContactSuccess,this,m,i,d),error:function(){f.set("loginVmStatus","failed"),sessionStorage.removeItem("loginClicked")}})}else sessionStorage.removeItem("loginClicked"),f.set("loginVmStatus","loggedin")},onupdateContactSuccess:function(a,c,d,e,f){var g=this.subViewModels.orderInContextTopicViewModel.get("updatedOrderActions")||[];b.each(a,function(a){g.push(a)}),c&&this.subViewModels.orderInContextTopicViewModel.set("customerID",d),this.subViewModels.orderInContextTopicViewModel.set("updatedOrderActions",g),sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","loggedin")},onFindCallerFailure:function(){this.set("implLoginVmStatus","userInfoLoadingFailed"),sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","anonymous")},onCreateAddressSuccess:function(a,b){this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installationAddressID",b.CreateAddressResponse.address.ID),this.subViewModels.newProductInOfferingInstanceViewModel.set("flowType",this.get("flowType")),this.subViewModels.newProductInOfferingInstanceViewModel.set("defaultSTBType",this.get("defaultSTBType")),this.subViewModels.newProductInOfferingInstanceViewModel.set("dealerID",this.get("dealerID")),this.subViewModels.newProductInOfferingInstanceViewModel.set("vendorID",this.get("vendorID")),this.subViewModels.newProductInOfferingInstanceViewModel.set("preTickAddonDetails",this.get("preTickAddonDetails")),this.set("runSaveOrderData",!0),this.subViewModels.newProductInOfferingInstanceViewModel.createOrder(!0,b.CreateAddressResponse.address.ID),this.set("networkCoverageVmstatus","addressCreated")},checkCoverage:function(a,c,d){var e={ImplPhysicalAddress:{postcode:a.postCode||a.postcode,streetName:a.streetName,buildingClassification:a.buildingClassification,blockOrHouseNum:a.blockOrHouseNum||a.streetNumber}};if(a.apartment)e.ImplPhysicalAddress.unitNumber=a.apartment;else{var f=a.floorNo||a.floor,g=a.unitNo||a.apartment;f&&f.indexOf("#")>-1?e.ImplPhysicalAddress.unitNumber=f:g&&g.indexOf("#")>-1?e.ImplPhysicalAddress.unitNumber=g:f&&g&&(e.ImplPhysicalAddress.unitNumber="#"+f+"-"+g)}var h={inputPayload:e};this.set("gaTaggingPayload",h),this.set("coverageType",a.buildingClassification),this.getModel("CheckServiceCoverageModel").save(e,{success:b.bind(this.onCheckServiceCoverageSuccess,this,c,d),error:b.bind(this.onFailure,this,c)})},onFailure:function(a){a&&a.reject("Failure"),this.set("networkCoverageVmstatus","failure")},_saveOrderData:function(a){var c,d=$.Deferred(),e=this;if(a||e.get("runSaveOrderData")){var f=this.subViewModels.orderInContextTopicViewModel.get("customerID")||this.subViewModels.customerInContextTopicViewModel.get("ID");f?(c=this.getModel("updateOrderNetworkCoverageModel"),c.set("customerId",f)):c=this.getModel("updateOrderNetworkCoverageAnonymousModel"),c.set("orderId",this.subViewModels.orderInContextTopicViewModel.get("productOrderID"));var g=this.get("isBlockOrder");a&&(g=!1),g&&this.subViewModels.deviceIdAndPlanIdInContextTopic.set("blockOrderID",this.subViewModels.orderInContextTopicViewModel.get("productOrderID"));var h={ImplUpdateOrderForCoverageCheckInput:{houseType:this.get("coverageType"),coverageStatus:this.get("coverageStatus"),coverageSubStatus:(this.get("coverageSubStatus")||"Empty").replace(";",""),isBlockOrder:g}},i=e.get("adslOrderActionId");i&&(h.ImplUpdateOrderForCoverageCheckInput.adslOrderActionId=i),c.save(h,{success:b.bind(e.orderSuccess,e,d,a),error:b.bind(e.orderFailure,e,!0,d)})}else e.set("runSaveOrderData",!1),d.resolve("success");return d},orderSuccess:function(a,b){var c=this;b||c.set("networkCoverageVmstatus","orderSuccesfull"),c.set("runSaveOrderData",!1),a.resolve("success")},orderFailure:function(a,b){a===!0&&b&&b.reject("Failure"),this.set("networkCoverageVmstatus","failure")},handleNLTStatusNew:function(a){var b=a.ImplCheckServiceCoverageRestOutput.coverageType,c=a.ImplCheckServiceCoverageRestOutput.singtelFibreAvailable;c&&(b="S3");var d={};switch(b){case"S1":case"S2":case"S4":case"S5":d.status="success";break;case"S3":c?d=this.checkForOfficeHours():d.status="success";break;case"S6":d.status="success";var e=this.get("s6Data");"undefined"!=typeof notSetResult&&null!==notSetResult||this.sendEmailToCustomer(e,a.ImplCheckServiceCoverageRestOutput.coverageStatus,a.ImplCheckServiceCoverageRestOutput.coverageSubStatus)}return d},onCheckServiceCoverageSuccess:function(a,b,c,d){var e=d;if("undefined"!=typeof e.ImplCheckServiceCoverageRestOutput){this.set("networkCoverageVmstatus","");var f=e.ImplCheckServiceCoverageRestOutput.coverageType,g=e.ImplCheckServiceCoverageRestOutput.singtelFibreAvailable;g&&(f="S3");var h,h={};h=this.handleNLTStatusNew(e);var i=e.ImplCheckServiceCoverageRestOutput.coverageStatus,j=e.ImplCheckServiceCoverageRestOutput.coverageSubStatus;this.set("coverageStatus",i),this.set("coverageSubStatus",j),"undefined"!=typeof b&&null!==b||this.set("result",h);var k=e.ImplCheckServiceCoverageRestOutput.buildingType;k&&(k=this.subViewModels.getCustomerIdValueViewModel.getBuildingType(k),this.set("coverageType",k));var l=!1;"S1"!==f&&(l=!0),this.set("isBlockOrder",l);var m={coverageType:this.get("coverageType"),coverageStatus:this.get("coverageStatus"),coverageSubStatus:this.get("coverageSubStatus"),isBlockOrder:this.get("isBlockOrder")},n=this.get("gaTaggingPayload");n.outputPayload=e,n.resultObject=m,this.set("gaTaggingPayload",n),this.set("networkCoverageVmstatus","successForGaTagging"),a.resolve(m)}else a.reject("Failure"),this.set("networkCoverageVmstatus","failure")},checkForOfficeHours:function(){var a=(new Date).getHours(),b=this.get("officeHours"),c={};return b&&(a>=b.startTime&&b.endTime>=a?c.failType="webChat":c.failType="Telesales",c.status="fail"),c},sendEmailToCustomer:function(a,b,c){var d=this;d.set("networkCoverageVmstatus","sendEmailToCustomer");var e,f=[],g=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId"),h=d.subViewModels.storeContextDataViewModel.get(),i=this.get("address")||this.get("selectedAddress"),j=d.subViewModels.miniCartInContextTopic.getValueByPath("flowData.planName"),k=d.subViewModels.orderInContextTopicViewModel.get("productOrderID");if(!g&&h.deviceTopicValues&&(g=h.deviceTopicValues.planId),!j&&h.miniCartTopicValues&&(j=h.miniCartTopicValues.planName),!k&&h.orderContextValues&&(k=h.orderContextValues.productOrderID),a){var l=i.unitNo||i.apartment,m=i.floorNo||i.floor,n=m&&l?"#"+m+"-"+l:" ";l&&l.indexOf("#")>-1&&(n=l),e={emailId:a.s6EmailId,templateId:a.s6TemplateId},f.push({key:"planId",value:g},{key:"planName",value:j},{key:"addrBlock",value:i.blockOrHouseNum},{key:"addrStreetName",value:i.streetName},{key:"addrUnitNo",value:n},{key:"addrPostalCode",value:i.postCode||i.postcode},{key:"mainCoverageStatus",value:b||"NA"},{key:"subCoverageStatus",value:c||"Empty"})}else{e=d.get("registerInterest");var o,p,q=d.subViewModels.onePassTopicViewModel.get();q&&q.nric&&null!==q.nric&&""!==q.nric?(o=q.nric,p=q.customerIdType):(o=e.customerIdNumberPrefix+e.customerIdNumber,p=e.customerIdType);var r=e.customerName,l=i.unitNo||i.apartment,m=i.floorNo||i.floor,n=m&&l?"#"+m+"-"+l:" ";l&&l.indexOf("#")>-1&&(n=l);new Date;f.push({key:"customerIC",value:o},{key:"customerName",value:r},{key:"custContactNo",value:e.contactNumber},{key:"custEmailId",value:e.customerEmail},{key:"planId",value:g},{key:"planName",value:j},{key:"addrBlock",value:i.blockOrHouseNum},{key:"addrStreetName",value:i.streetName},{key:"addrUnitNo",value:n},{key:"addrPostalCode",value:i.postCode||i.postcode},{key:"mainCoverageStatus",value:d.get("coverageStatus")||"NA"},{key:"subCoverageStatus",value:"NA"},{key:"transaction",value:e.transaction||"NEW"},{key:"plan",value:j},{key:"orderId",value:k||"NA"}),e.serviceNo&&f.push({key:"serviceNo",value:e.serviceNo})}var s={ImplSendNotificationRequest:{target:[e.emailId],templateId:e.templateId,notificationChannel:"EMAIL",templateSimpleParameters:f,templateURLParameters:[]}};d.getModel("implSendNotificationModel").save(s,{success:function(b,c){var e=d.subViewModels.submitRegisterInterestViewModel;e.set("registerInterest",d.get("registerInterest"));var f=e.sendEmailToCRC();f.done(function(b){a?d.set("networkCoverageVmstatus","s6DataMailSent"):(d.set("networkCoverageVmstatus","mailSent"),d.subViewModels.clearContextInContextTopic.clearAllTopics(!0))}.bind(d))},error:function(b,c){a?d.set("networkCoverageVmstatus","s6DataMailFailed"):d.set("networkCoverageVmstatus","mailFailure")}})}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/MobileShareViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/MobileShareAllowanceModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/SearchAvailableNumbersModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n){return a.Core.ObservableViewModel.extend({models:{MobileShareAllowanceModel:d,updateProductConfigurationModel:g,anonymousUpdateProductConfigurationModel:h,customerProductOrderItemProductConfigurationOptionsModel:i,anonymousProductOrderItemRetrieveProductConfigurationOptionsModel:j,searchAvailableNumbersModel:m},subViewModels:{ContactInContextTopicViewModel:e,IndividualInContextTopicViewModel:f,OrderInContextTopicViewModel:k,deviceIdAndPlanIdInContextTopic:l,clearContextInContextTopic:n},dataBindings:[{contactId:"subViewModels.ContactInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{existingLines:null,mainLineSelectionVmStatus:"",selectedLine:null,contactId:null,errorInRetrieval:null,groupComponentApId:null,existingPlanId:null},initialize:function(a){c.bindAll(this,"onFailure","getMainLineSelection","saveMainLineSelected","formatPlanDetails","onUpdateProductConfigurationSuccess","retrieveProductConfiguration","onFetchRetrieveProductConfigurationSuccess","onFetchProductConfigurationError","updatProductDetails","getNewNumber");var b=this;setTimeout(function(){var a=b.get("contactId")||b.subViewModels.IndividualInContextTopicViewModel.get("personId"),c=b.subViewModels.OrderInContextTopicViewModel.get("customerID");if("undefined"!=typeof a&&null!==a){var d=b.retrieveProductConfiguration(c),e=b.getMainLineSelection(a);$.when(d,e).done(function(a,c){"rpcSuccess"===a&&"mainLinesuccess"===c&&b.set("mainLineSelectionVmStatus","itemsLoaded")}.bind(b))}}.bind(b),0)},getMainLineSelection:function(a){var b=this,d=$.Deferred();if("undefined"!=typeof a&&null!==a){var e=b.getModel("MobileShareAllowanceModel");e.setQueryParams({isMBB:!1}),e.fetch({contactId:a,success:c.bind(b.getMainLineSelectionSuccess,b,d),error:c.bind(b.onFailure,b,d)})}else d.resolve("Failed");return d},getMainLineSelectionSuccess:function(a,b,d){var e=d.ImplGetGroupListOutput,f=this,g="success";"undefined"!=typeof e&&"undefined"!=typeof e.implCustomerGroupIdsList?(c.each(e.implCustomerGroupIdsList,function(a){a=f.formatPlanDetails(a)}),f.set("existingLines",e),g="mainLinesuccess"):f.set("mainLineSelectionVmStatus","ineligible"),a.resolve(g)},formatPlanDetails:function(a){return c.each(a.implGroupId,function(a){if("undefined"!=typeof a.implPlanDetails&&"undefined"!=typeof a.implPlanDetails.description&&(a.planDetailsdesc=a.implPlanDetails.description.split(",")),a.isBroadBand=!1,"undefined"!=typeof a.implPlanDetails&&"undefined"!=typeof a.implPlanDetails.name){var b=a.implPlanDetails.name;b&&b.toUpperCase().indexOf("BROADBAND")>-1&&(a.isBroadBand=!0)}}),a},saveMainLineSelected:function(){var a=this;a.getValueByPath("selectedLine.isMBB")?a.getNewNumber():a.updatProductDetails()},getNewNumber:function(){var a,b,d=this,e=d.subViewModels.OrderInContextTopicViewModel.get(),f=e.productOrderID;if(e.currentOrderActions&&1===e.currentOrderActions.length){var g=e.currentOrderActions[0];a=g.productOrderItemID,b=g.productID}var h={type:"WIRELESS",numberOfResources:1,mobileBBRequired:!0},i=d.getModel("searchAvailableNumbersModel");i.set({orderId:f,orderItemId:a,productID:b}),i.save({ImplSearchAviableInput:h},{success:c.bind(d.updatProductDetails,d,b),error:d.onFailure})},updatProductDetails:function(a,b,c){var d=this,e=[],f=d.get("groupComponentApId"),g=[];if(g.push({productSpecContainmentID:8363712,productID:f,changedCharacteristics:[{characteristicID:8518342,value:d.getValueByPath("selectedLine.groupId")}]}),c&&c.ImplSearchAviableOutput&&(e=c.ImplSearchAviableOutput.reservedNumbers,e&&e.length>0&&g.push({productID:a,changedCharacteristics:[{characteristicID:2409309,value:e[0]}]})),f){var h=d.subViewModels.OrderInContextTopicViewModel.get(),i={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:g,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},j=h.customerID;if(j){var k=d.getModel("updateProductConfigurationModel");k.set({customerId:j,productOrderItemId:h.productOrderItemID}),d.setHeaders(k),d.setDefaultQueryParams(k),k.setQueryParams({rp:!1,rpc:!1}),k.save(i,{success:d.onUpdateProductConfigurationSuccess,error:d.onFailure})}else{var l=d.getModel("anonymousUpdateProductConfigurationModel");l.set({productOrderItemId:h.productOrderItemID}),d.setHeaders(l),d.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(i,{success:d.onUpdateProductConfigurationSuccess,error:d.onFailure})}}},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},onUpdateProductConfigurationSuccess:function(a,b){var d=this,e=this.subViewModels.OrderInContextTopicViewModel.get("currentOrderActions"),f=this.subViewModels.OrderInContextTopicViewModel.get("orderActions");c.each(f,function(a){a.productOrderItemID===e[0].productOrderItemID&&(a.selectedLine=d.get("selectedLine"))}),e[0].selectedLine=this.get("selectedLine"),d.subViewModels.OrderInContextTopicViewModel.set("currentOrderActions",e),d.subViewModels.OrderInContextTopicViewModel.set("orderActions",f),
d.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),d.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!1),d.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobilePortinFlag",!1);var g=b.UpdateProductInOrderConfigurationResponse;return g&&g.productConfiguration&&"BLOCKING"===g.productConfiguration.compatibilityStatus?(d.set("mainLineSelectionVmStatus","failure"),!1):void d.set("mainLineSelectionVmStatus","success")},onFailure:function(a){this.set("mainLineSelectionVmStatus","failure"),a&&a.resolve&&a.resolve("failure")},retrieveProductConfiguration:function(a){var b=$.Deferred(),d={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};if("undefined"!=typeof a){var e=this.getModel("customerProductOrderItemProductConfigurationOptionsModel");e.set({customerId:a,productOrderItemId:this.subViewModels.OrderInContextTopicViewModel.get("productOrderItemID")}),e.setQueryParams({rp:!1,rpc:!1}),e.set("RetrieveProductInOrderConfigurationRequest",d),this.setHeaders(e),this.setDefaultQueryParams(e),e.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this,b),error:c.bind(this.onFetchProductConfigurationError,this,b)})}else{var f=this.getModel("anonymousProductOrderItemRetrieveProductConfigurationOptionsModel");f.set({productOrderItemId:this.subViewModels.OrderInContextTopicViewModel.get("productOrderItemID")}),f.setQueryParams({rp:!1,rpc:!1}),f.set("RetrieveProductInOrderConfigurationRequest",d),this.setHeaders(f),this.setDefaultQueryParams(f),f.fetch({success:c.bind(this.onFetchRetrieveProductConfigurationSuccess,this,b),error:c.bind(this.onFetchProductConfigurationError,this,b)})}return b},onFetchRetrieveProductConfigurationSuccess:function(a,b,d,e){this.set("existingPlanId",d.RetrieveProductInOrderConfigurationResponse.productConfiguration.rootProductOfferingID);var f=d.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems;if(f){var g=c.filter(f,function(a){return"8363682"===a.productSpecContainmentID});this.set("newNumberProductID",g[0].productID),f=c.filter(f,function(a){return"8363712"===a.productSpecContainmentID}),this.set("groupComponentApId",f[0].productID)}a.resolve("rpcSuccess")},onFetchProductConfigurationError:function(a,b,c){this.set("retrieveProductConfigurationError","retrieveProductConfigurationError"),this.set("mainLineSelectionVmStatus","failure"),rpcDeferred.resolve("rpcFailed")}})});
define("businesswidget/repository_l9_common/common/viewmodel/PaymentGatewayViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/PayBillReferenceModel","businesswidget/repository/common/util/Util","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/PaymentRecordModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","moment","single!businesswidget/repository_l9_common/common/model/ImplOnepayV2CreatePaymentModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.Core.ObservableViewModel.extend({models:{payBillReferenceModel:d,paymentRecordModel:i,implOnepayV2CreatePaymentModel:o},subViewModels:{customerInContextTopicViewModel:g,orderInContextTopicViewModel:h,deviceIdAndPlanIdInContextTopic:j,onePassTopicViewModel:k,individualInContextTopicViewModel:l,clearContextInContextTopic:m,singtelStoreEAppointmentViewMode:p,billMethodPreferenceViewModel:q},defaults:{paymentgateWayVmStatus:"",selectedPaymentMethod:"",selectedAccount:null,purchaseToken:null,confirmationNumber:null,allPayMethods:{cc:2,enets:4,mCash:3,2:"cc",4:"enets",3:"mCash"},emailId:null,customerId:null,pgData:{referenceId:"",authenticationHeader:"",custId:"",paymentMode:"",receiptEmailAddress:"",totalPrice:"",items:[],sales_channel:"",payer_identity:"",redirection_mode:"BROWSER",description:"",cart_details:null,merchantData:"",redirect_url:""},contactId:null,orderId:null,onePayPaymentMethodsV2:{cc:"CREDIT_CARD",mCash:"MCASH",enets:"ENETS_IB",2:"CREDIT_CARD",4:"ENETS_IB",3:"MCASH"},eAppointmentCrOn:b.get("eAppointmentCrOn")},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{selectedAccount:"subViewModels.orderInContextTopicViewModel.barId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){c.bind("startPayment","failedPaymentgateWay","createPaymentRecord",this),this.set("paymentgateWayVmStatus","Initialized"),this.set("contactId",this.subViewModels.individualInContextTopicViewModel.get("personId")),this.set("orderId",this.subViewModels.orderInContextTopicViewModel.get("productOrderID"))},startPayment:function(){var a=this;a.set("paymentgateWayVmStatus","BeforeStartPayment");var b=a.subViewModels.orderInContextTopicViewModel.get("barId");a.getModel("payBillReferenceModel").save({customerId:a.get("customerId"),billingAccountId:b},{success:c.bind(a.referenceModelSuccess,a),error:c.bind(a.referenceModelError,a)})},onePayV2APICall:function(){var a=this.get("pgData"),b=this.get("onePayPaymentMethodsV2"),d=(this.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),this.subViewModels.orderInContextTopicViewModel.get());a.merchantData={contactId:this.subViewModels.individualInContextTopicViewModel.get("personId"),accounts:[{faid:d.barId,amountToPay:a.totalPrice,totalDue:a.totalPrice,customerId:d.customerID}]},a.paymentMethod=b[a.paymentMode];var e={ImplCreatePaymentRequestV2:{gateway_reference:a.referenceId,payer_identity:this.get("contactId"),payment_method:a.paymentMethod,description:a.description,amount:a.totalPrice,currency:a.currency,merchant_data:JSON.stringify(a.merchantData),parameters:[{name:"merchant_data",value:JSON.stringify(a.merchantData)}],redirection_mode:a.redirection_mode,redirect_urls:a.redirect_urls,sales_channel:a.sales_channel,cart_details:a.cart_details}};this.set("pgData",a);var f=this.models.implOnepayV2CreatePaymentModel;return f.setQueryParams({flowType:"eshop"}),f.save(e,{success:c.bind(this.onepayV2CreatePaymentSuccess,this),error:c.bind(this.referenceModelError,this)})},onepayV2CreatePaymentSuccess:function(a,b){var c=this.get("pgData"),d=b.ImplCreatePaymentResponseV2;d?(c.id=d.id,c.referenceId=d.gateway_reference,c.redirect_url=d.redirect_url,c.internal_id=d.internal_id,c.paymentStatus="Pending",c.receiptEmailAddress||(c.receiptEmailAddress=this.get("emailId")),this.set("pgData",c),this.set("paymentgateWayVmStatus","OnepayV2PaymentCreated")):this.referenceModelError()},referenceModelSuccess:function(a,c){var d=this;if(c&&c.ImplOnePayReferenceResponse&&c.ImplOnePayReferenceResponse.referenceId){var e=d.get("pgData"),f=(d.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),n().format("YYYYMMDDHHmmss"));e.referenceId="req-id-"+f+"-"+(new Date).getTime().toString().substring(6,12),e.receiptEmailAddress=d.get("emailId");var g=e.paymentMode,h=d.get("allPayMethods");if("cc"===g?e.paymentMode=h.cc:"enets"===g?e.paymentMode=h.enets:"mCash"===g&&(e.paymentMode=h.mCash),d.set("pgData",e),b.get("isOnePayV2APICall")){var i=this.onePayV2APICall(),j=i.then(function(){return this.createPaymentRecord()}.bind(this),function(){this.set("paymentgateWayVmStatus","referenceIdSetFailed")}.bind(this));return j.then(function(){this.set("paymentgateWayVmStatus","initiatePaymentSuccess")}.bind(this),function(){this.referenceModelError(),this.set("paymentgateWayVmStatus","createTransactionEntryFailed")}.bind(this))}return d.createPaymentRecord()}},createPaymentRecord:function(){var a=this,d=a.get("pgData"),e=a.get("allPayMethods"),f=a.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber");d.items=JSON.stringify({items:[{itemCode:"2CI",quantity:1,price:d.totalPrice.toString(),description:"Singtelshop.com purchase for "+f}]}),a.set("pgData",d);var g=b.get("insertPaymentRecord");if(g){var h=a.subViewModels.orderInContextTopicViewModel.get(),i={methodType:h.methodType,customerID:h.customerID,orderId:h.productOrderID,orderDetails:d.paymentOrderActions,productOrderReferenceNumber:h.productOrderReferenceNumber,contactId:a.subViewModels.individualInContextTopicViewModel.get("personId"),barId:h.barId,dashPayment:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("dashPayment"),deviceResDetails:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("deviceResDetails"),selectedOption:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption"),reservationIDs:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("reservationIDs"),allocationIDs:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("allocationIDs"),dwfmTokenId:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("dwfmTokenId"),billPayer:a.subViewModels.onePassTopicViewModel.get("billPayer"),nric:a.subViewModels.onePassTopicViewModel.get("nric"),smsNotification:d.smsNotification,emailNotification:d.emailNotification};a.get("eAppointmentCrOn")&&"singtel-store"===a.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedOption")&&(i.eApptId=a.subViewModels.singtelStoreEAppointmentViewMode.get("newApptId"),i.eApptState=a.subViewModels.singtelStoreEAppointmentViewMode.get("newApptState"));var j=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("roiDetails");j&&d.selectedDevices&&(i.roiDetails=j);var k=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("selectedBillOption");if(k){var l=b.get(k),m=a.subViewModels.billMethodPreferenceViewModel.getCustomerType(a.subViewModels.onePassTopicViewModel.get("customerIdType"));a.subViewModels.onePassTopicViewModel.get("newcustomer")&&(l.skipNotification=!0);var n={type:m,contactId:a.subViewModels.individualInContextTopicViewModel.get("personId"),nric:a.subViewModels.onePassTopicViewModel.get("nric"),skipNotification:l.skipNotification,intFlowType:l.intFlowType,deliveryMethod:l.method,billType:l.type};i.selectedBillOption=n}var o={ImplCreatePaymentRequest:{orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderID"),referenceId:d.referenceId,paymentAmount:d.totalPrice,paymentStatus:"PENDING",paymentMethod:e[d.paymentMode],account:a.subViewModels.orderInContextTopicViewModel.get("barId"),email:d.email,customerName:d.fullName,customerDetails:JSON.stringify(a.subViewModels.onePassTopicViewModel.get()),orderDetails:JSON.stringify(a.subViewModels.orderInContextTopicViewModel.get()),contextDetails:JSON.stringify(i),merchantCode:d.merchantCode,comments:"Payment initiated for order "+f,currency:"SGD"}},p=a.getModel("paymentRecordModel");return p.set({contactId:a.subViewModels.individualInContextTopicViewModel.get("personId")}),p.save(o,{success:c.bind(a.successPaymentgateWay,a),error:c.bind(a.referenceModelError,a)})}var q=$.Deferred();return q.resolve(),a.successPaymentgateWay(),q},successPaymentgateWay:function(){var a=this;b.get("isOnePayV2APICall")||a.set("paymentgateWayVmStatus","referenceIdSet")},failedPaymentgateWay:function(){var a=this,d=b.get("insertPaymentRecord");if(d){var e=a.get("contactId"),f=a.get("orderId"),g=a.getModel("paymentRecordModel");g.set({contactId:e}),g.setQueryParams({us:!0});var h={ImplCreatePaymentRequest:{orderId:f,paymentStatus:"FAILED"}};g.save(h,{success:c.bind(a.successUpdateRecord,a),error:c.bind(a.referenceModelError,a)})}else a.set("paymentgateWayVmStatus","recordUpdated")},successUpdateRecord:function(a,b){var c=this;c.set("paymentgateWayVmStatus","recordUpdated")},referenceModelError:function(a,b){var c=b.responseJSON.ErrorInfo.backendErrorInfo,d=/Current\ order.*is amended in other flow\.\ Continue with order in other flow\./g;400===b.status&&c&&d.test(c)?this.set("paymentgateWayVmStatus","orderAmendedInOtherFlow"):this.set("paymentgateWayVmStatus","referenceIdSetFailed"),this.subViewModels.clearContextInContextTopic.clearAllTopics(!0)}});return r});
define("businesswidget/repository_l9_common/common/model/UpdateMessageReadStatusModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/inbox/account-onepass/:account/update-message/:timestamp",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},contentType:"application/json",method:"POST"},create:{payLoad:["ImplUpdateMessageResInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/UpdateInboxCategoryModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/inbox/category-changes",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},contentType:"application/json"},create:{method:"POST",payload:["ImplCategoryChangesResInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/GetActiveMessagesModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/inbox/message",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/DeleteOrArchieveMessageModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"/inbox/account-onepass/:account/delete-message/:timestamp",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},"delete":{method:"DELETE"}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/InboxViewmodel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/UpdateMessageReadStatusModel","businesswidget/repository_l9_common/common/model/UpdateInboxCategoryModel","businesswidget/repository_l9_common/common/model/GetActiveMessagesModel","businesswidget/repository_l9_common/common/model/DeleteOrArchieveMessageModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel"],function (a,b,c,d,e,f,g,h){var i=a.Core.ObservableViewModel.extend({models:{updateMessageReadStatusModel:c,getActiveMessagesModel:e,deleteMessageModel:f,inboxCategoryModel:d},subViewModels:{getBillingAccountDetailedListViewModel:g,customerInContextTopicViewModel:h},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{inboxVmStatus:"",activeMessages:null,readStatus:!1,readCount:-1,accountDetails:[],saveCategories:null,deleteUpdateMessage:null},initialize:function(){b.bindAll(this,"getActiveMessages","onfailure","deleteMessage","updateReadMessageCount","saveCategorySettings","loadSubscribers","onAccountsLoaded");this.get("customerId");this.on("change:customerId",this.loadSubscribers)},loadSubscribers:function(){var a=this,b=a.subViewModels.getBillingAccountDetailedListViewModel.getBillingAccountDetails();b.done(function(b){a.set("accounts",b),a.onAccountsLoaded(b)}.bind(a))},onAccountsLoaded:function(a){var c=[];void 0!==typeof a&&(null!==a||a.length>0)&&b.each(a,function(a){c.push({id:a.billingAccountNumber,name:"AC"}),void 0!==typeof a.subscribers&&a.subscribers.length>0&&b.each(a.subscribers,function(a){a.subscriberType&&67!=a.subscrStatus&&68!=a.subscrStatus&&76!=a.subscrStatus&&84!=a.subscrStatus&&c.push({id:a.subscriberResourceVal,name:a.subscriberType})})}),this.set("accountDetails",c),this.getActiveMessages()},getActiveMessages:function(){var a=this;return a.set("inboxVmStatus","getActiveMessages"),a.getModel("getActiveMessagesModel").fetch({success:function(c,d){var e=d.ImplRetrieveMessagesResOutput,f=e.categoryList,g=e.messageList,h=a.getCategoriesMap(f,g),i=JSON.parse(JSON.stringify(b.groupBy(g,"groupIndex"))),j=[];if(g&&g.length)for(var k=g.length,l=0;l<k;l++){var m=g[l];if(a.isDisplayableMessage(m,h)){if(m.groupIndex)m.groupedMessages=i[m.groupIndex];else{var n=JSON.parse(JSON.stringify(m));delete n.groupedMessages,m.groupedMessages=[n]}j.push(m)}}a.set("activeMessages",{unreadMessageCount:e.unreadMessageCount,categories:f,messageList:j}),a.set("unReadCount",e.unreadMessageCount),a.set("inboxVmStatus","success")},error:a.onfailure})},isDisplayableMessage:function(a,b){var c=b[a.categoryId];return!(!c||!c.subscribed)},getCategoriesMap:function(a,c){var d={},e=b.groupBy(c,"categoryId");if(a&&a.length)for(var f=a.length,g=0;g<f;g++){var h=a[g];h.msgCount=0,e[h.categoryId]&&(h.msgCount=e[h.categoryId].length),d[h.categoryId]=h}return d},deleteMessage:function(){var a=this;a.set("inboxVmStatus","deleteMessage");for(var b=a.get("deleteUpdateMessage"),c=[],d=0;d<b.groupedMessages.length;d++){var e=b.groupedMessages[d],f=a.getModel("deleteMessageModel");f.set("id",""),f.set({timestamp:e.createDate,account:e.account});var g=f.destroy();c.push(g)}$.when.apply(this,c).then(function(){this.getActiveMessages().then(function(){this.set("inboxVmStatus","messageDeleted")}.bind(this))}.bind(this),function(){this.set("inboxVmStatus","messageDeleteFailed")}.bind(this))},updateReadMessageCount:function(){var a=this;a.set("inboxVmStatus","updateReadMessageCount");var b=a.get("deleteUpdateMessage"),c={ImplUpdateMessageResInput:{readStatus:b.readStatus}};a.getModel("updateMessageReadStatusModel").save(c,{timestamp:b.createDate,account:b.account,success:function(b,c){a.set("readCount",c.ImplUpdateMessageResOutput.readCount)},error:function(b,c){a.set("inboxVmStatus","failure")}})},saveCategorySettings:function(){var a=this;a.set("inboxVmStatus","saveCategorySettings");var c=a.get("saveCategories"),d={ImplCategoryChangesResInput:{subscribers:[],unsubscribers:[],ssoGroupId:c[0].ssoGroupId}};b.each(c,function(a){a.subscribed?d.ImplCategoryChangesResInput.subscribers.push(a.categoryId):d.ImplCategoryChangesResInput.unsubscribers.push(a.categoryId)});var e=a.getModel("inboxCategoryModel");e.save(d,{success:function(b,c){a.set("inboxVmStatus","settingsSaved")},error:a.onfailure})},onfailure:function(){this.set("inboxVmStatus","failed")}});return i});
define("businesswidget/repository_l9_common/common/viewmodel/business/ReContractDetailsViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/viewServiceListModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","businesswidget/repository_l9_common/common/model/viewServiceDetailModel","businesswidget/repository_l9_common/common/model/SearchAddressinCRMModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository_l9_common/common/viewmodel/business/FreeMBBViewModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/viewmodel/business/GetNetworkCoverageViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/CheckPendingOnPendingOrderViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){
var D=a.Core.ObservableViewModel.extend({models:{viewServiceListModel:d,submitProductConfigurationModel:e,viewServiceDetailModel:f,searchAddressinCRMModel:g,updateProductConfigurationModel:m,anonymousUpdateProductConfigurationModel:n,updateContactModel:p,customerProductOrderProductOrderItemsModel:t,anonymousProductOrderProductOrderItemsModel:s},subViewModels:{customerInContextTopicViewModel:h,individualInContextTopicViewModel:i,deviceIdAndPlanIdInContextTopic:j,orderInContextTopicViewModel:k,updateProductConfigurationViewModel:l,freeMBBViewModel:o,implUserContextTopicViewModel:q,billingAccountsViewModel:r,getNetworkCoverageViewModel:u,clearContextInContextTopic:v,checkPendingOnPendingOrderViewModel:w,onePassTopicViewModel:x,getCustomerIdValueViewModel:y,pickAndGoViewModel:z,ShoppingCartViewModel:A,preTickAddonViewModel:C},dataBindings:[{customerIds:"subViewModels.customerInContextTopicViewModel.customerIds",options:{twoWay:!1,setOnBind:!0}}],defaults:{customerIds:null,customerID:null,reContractVMStatus:"",customerReContractDetails:null,reContractServices:null,selectedRecontractDetails:null,networkDetails:[],reContractFlag:!1,existingAddress:!1,flowType:null,bundlesByOffertingInstanceId:null,mbbOfferId:null,freeMBBProducts:null,mbbWithUserName:null,freeMBBData:null,staffComponentDetails:[],glpGroups:[],finalStaffComponentDetails:[],accounts:null,recontractBarId:null,productServicesTemp:null,isAdslPlan:!1,selectedAddress:null,staffOrderActionDetails:[],isFirstTime:!0,isMainFirstTime:!0,isPaymentPending:null,expressCheckout:{hasFreeMBB:!0,hasSharedEquipment:!1,hasWifiMesh:!1,hasRGDevice:!1},expressCheckoutAllowed:!1,contractEndDetails:[],finalContractEndDetails:[],blockingMessages:null,adslPlan:null,preTickAddonDetails:null},initialize:function(a){var b=this;b._super(a),c.bindAll(b,"initializeServices","loadServices","initServices","setProductIds","createInputPayload","saveRecontractDetails","getErrorMessage","getNetworkTechnology","getAllAddress","setAddressForAllProducts","cancelOrderActionsSuccess","cancelOrderActions","processOutput","getDetails","getSuccessMessage","updateOrderToRunRules","setHeaders","setDefaultQueryParams","getMBBDetails","getStaffComponent","onGetStaffComponentSuccess","addCustomerContact","triggerBuyFlow","fetchNetworkTech","checkPendingOrder","updateOrderSuccess","populateBBAddons","onsaveRecontractDetailsClearContextError","processVMvalue","createReconOrder","doSaveReconDetails","updateOrder","onVmInitialize","containsData"),this.set("reContractVMStatus","initialized");var d=this.subViewModels.customerInContextTopicViewModel.get("customerIds"),e=this.subViewModels.onePassTopicViewModel.get("newcustomer");(null===d||e)&&this.set("reContractVMStatus","anonymous");var f=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("recontractBarId");this.set("recontractBarId",f),this.subViewModels.freeMBBViewModel.on("dataSet",this.getSuccessMessage,this),this.subViewModels.freeMBBViewModel.on("orderFailure",this.getErrorMessage,this),this.on("change:customerIds",function(){setTimeout(function(){b.initializeServices()}.bind(b),0)},b),this.subViewModels.checkPendingOnPendingOrderViewModel.on("ordersDeleted",this.doSaveReconDetails,this)},onVmInitialize:function(){this.subViewModels.getNetworkCoverageViewModel.getInstallationAddress()},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},initializeServices:function(){var a=this,b=a.get("customerIds"),c=this.subViewModels.onePassTopicViewModel.get("newcustomer"),d=a.get("isMainFirstTime");d&&"undefined"!=typeof b&&null!==b&&b.length>0&&!c?(a.set("isMainFirstTime",!1),setTimeout(function(){a.set("reContractVMStatus","initializeServices");var b=a.get("isFirstTime");b&&a.set("reContractVMStatus","vmInitialized"),a.set("isFirstTime",!1)}.bind(a),0)):setTimeout(function(){var b=a.get("isFirstTime");b&&a.set("reContractVMStatus","vmInitialized"),a.set("isFirstTime",!1)}.bind(a),0)},loadServices:function(){var a=this,b=(this.subViewModels.orderInContextTopicViewModel.get("productOrderID"),a.get("customerIds")),c=this.subViewModels.onePassTopicViewModel.get("newcustomer");if("undefined"!=typeof b&&null!==b&&b.length>0&&!c){var d=this.subViewModels.billingAccountsViewModel.getBillingAccountDetails();d.done(function(b){a.set("accounts",b),a.getDetails()}.bind(a)),d.fail(function(b){a.set("reContractVMStatus","failure")}.bind(a))}},updateOrder:function(){var a=this,b=a.subViewModels.getNetworkCoverageViewModel,c=b._saveOrderData(!0);c.done(function(b){"success"===b?a.set("reContractVMStatus","updateOrderSuccess"):a.set("reContractVMStatus","failure")}),c.fail(function(b){a.set("reContractVMStatus","failure")}.bind(a))},getDetails:function(){var a=this,b=a.get("customerIds"),d=[];c.each(b,function(b){var e=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:b,success:c.bind(a.onLoadServicesSuccess,a,e,b),error:function(b){return function(c){a.set("reContractVMStatus","failure"),b.reject(c)}}(e)}),d.push(e)}),$.when.apply(a,d).done(function(){var b=a.get("reContractServices")||[];if("undefined"!=typeof b&&null!==b&&b.length>0){var d=c.groupBy(b,"lob"),e=c.groupBy(b,"productName"),f=d.FHB,g=d.FEB,h=d.TV,i=d.BB,j={FHB:f,FEB:g,TV:h,adslBBGroup:i};e&&e.Equipment&&(j.sharedGroups=e.Equipment);var k=c.flatten(c.map(j,c.values));a.set("tempContractObject",k);var l=a.get("freeMBBProducts");a.getMBBDetails(l);var m=(a.subViewModels.deviceIdAndPlanIdInContextTopic.get(),a.get("glpGroups"));a.getStaffComponent(m),a.getAllAddress(k)}else a.set("customerReContractDetails",b)})},getStaffComponent:function(a){var b=this,d=b.getModel("viewServiceDetailModel"),e=b.subViewModels.deviceIdAndPlanIdInContextTopic.get(),f=[];c.each(a,function(a){var e=$.Deferred();d.set({customerId:a.tempService.customerId,productId:a.id}),d.setQueryParams({allParams:!0}),d.fetch({success:c.bind(b.onGetStaffComponentSuccess,b,e,a),error:function(a){return function(c){b.set("reContractVMStatus","failure"),a.reject(c)}}(e)}),f.push(e)}),$.when.apply(b,f).done(function(){"staff"===e.customerType&&e.staffDetails&&b.set("finalStaffComponentDetails",b.get("staffComponentDetails")),b.set("finalContractEndDetails",b.get("contractEndDetails"))})},onGetStaffComponentSuccess:function(a,b,d,e){var f=this,g=f.get("staffComponentDetails")||[],h=f.get("contractEndDetails")||[],i=f.subViewModels.deviceIdAndPlanIdInContextTopic.get();e.Product.services&&e.Product.services.length>0?(c.each(e.Product.services,function(a){if("staff"===i.customerType&&i.staffDetails&&"11182"==a.catalogItemID&&(b.staffComponentID=a.id),"Bundle Plan"===a.catalogItemName){var d=c.max(a.containedServices,function(a){if("Contract"===a.catalogItemName){var b=c.findWhere(a.parameters,{catalogId:"8242",name:"Contract Start Date"}),d=b?B(b.valueName,"DD/MM/YYYY").unix():null;return d}});d&&d.parameters?c.find(d.parameters,function(a){if("8242"===a.catalogId||"Contract Start Date"===a.name){var c=B(a.valueName,"DD/MM/YYYY").add(21,"months");return b.isReconAllowed=B().unix()-B(a.valueName,"DD/MM/YYYY").add(21,"months").unix()>0,b.isGreaterThanC12=B().unix()-B(a.valueName,"DD/MM/YYYY").add(12,"months").unix()>0,b.contractStartDate=a.valueName,b.reconStartDate=c.format("MMM YYYY"),!0}}):(b.isReconAllowed=!0,b.isGreaterThanC12=!0)}}),h.push(b),f.set("contractEndDetails",h),"staff"===i.customerType&&i.staffDetails&&(g.push(b),f.set("staffComponentDetails",g)),a.resolve()):f.set("reContractVMStatus","failure")},onLoadServicesSuccess:function(a,b,d,e){if("undefined"!=typeof e.Products){this.set("reContractVMStatus","reContractListFetched");var f=e.Products.products,g=this.get("reContractServices")||{},h=this.get("freeMBBProducts")||[];if("undefined"!=typeof f&&f.length>0){var i=this.initServices(f,b,h);g&&g.length>0?c.each(i,function(a){g.push(a)}):g=i,this.set("reContractServices",g),this.set("freeMBBProducts",h),this.set("productServicesTemp",f)}a.resolve()}else this.set("reContractVMStatus","failure")},initServices:function(a,d,e){var f=[],g=this,h=this.subViewModels.orderInContextTopicViewModel.get("customerID");if(a){var i=c.groupBy(a,function(a){return a.bundle?"bundle":"services"});if(i.bundle){var j=c.groupBy(i.bundle,"offeringInstanceId");g.set("bundlesByOffertingInstanceId",j),c.map(j,function(a,b){var e=null,i=!1,j=c.filter(a,function(a){return"TV"===a.lob});j&&j.length>0&&(i=!0),j=c.filter(a,function(a){return"BB"===a.lob}),j&&j.length>0&&(e=j[0]);var k=c.find(a,function(a){return"FV"===a.lob&&"Bundle GLP"!==a.spoName});if(e&&k&&(e.fixedServices=k),e){if(e.customerId=d,e.isDisplayFlag=!0,"undefined"!=typeof h&&null!==h&&h!==d&&(e.isDisplayFlag=!1),i)e.lob="FEB",e.plan?e.planName=e.plan.displayName:e.planName=e.offeringName;else{e.lob="FHB";var l=c.filter(a,function(a){return"FV"===a.lob&&"Bundle GLP"===a.spoName});if(e.plan?e.planName=e.plan.displayName:e.planName=e.offeringName,l&&l.length>0){var m=g.get("glpGroups")||[],n=l[0];n.tempService=e,m.push(n),g.set("glpGroups",m)}}f.push(e)}})}if(i.services){var k=b.get("mbbOfferIds"),l=i.services,m=!1;c.each(l,function(a){"TV"===a.lob||"BB"===a.lob?(m=!0,a.customerId=d,a.isDisplayFlag=!0,"undefined"!=typeof h&&null!==h&&h!==d&&(a.isDisplayFlag=!1),a.plan?a.planName=a.plan.displayName:a.planName=a.offeringName,f.push(a)):"WS"===a.lob&&c.contains(k,a.offeringId)&&(a.customerId=d,e.push(a))}),m&&c.each(l,function(a){a.productName&&"Equipment"===a.productName&&(a.customerId=d,a.isDisplayFlag=!0,"undefined"!=typeof h&&null!==h&&h!==d&&(a.isDisplayFlag=!1),a.plan?a.planName=a.plan.displayName:a.planName=a.offeringName,a.sharedEquip=!0,f.push(a))})}}return f},setProductIds:function(a){var b=c.pluck(a,"id");return c.each(a,function(a){a.productIds=b}),a},getAllAddress:function(a){var b=this,d=[];if(c.each(a,function(a){a.address.id&&d.push(a.address.id)}),d.length>0){var e=b.getModel("searchAddressinCRMModel");e.setQueryParams({addressIds:d}),e.fetch({success:b.setAddressForAllProducts,error:b.getErrorMessage})}},setAddressForAllProducts:function(a,b){var d=this,e=d.get("tempContractObject"),f=b.HashMap;c.each(e,function(a){var b=f[a.address.id||a.address.addressId];"undefined"!=typeof b&&null!==b||(b=f[Number(a.address.id||a.address.addressId)]),a.address=b,a.address.blockOrHouseNum=a.address.blockOrHouseNum,a.address.floorNo=a.address.floor,a.address.postCode=a.address.postcode,a.address.unitNumber=a.address.unitNumber}),d.set("tempContractObject",e),d.getNetworkTechnology(e)},getNetworkTechnology:function(a){var b=this,d=(b.getModel("viewServiceDetailModel"),[]);c.each(a,function(a){var e,f=!1;if("TV"===a.lob||"BB"===a.lob?e=a:"FHB"===a.lob||"FEB"===a.lob?(f=!0,e=a.fixedServices||a,e.customerId=a.customerId):a.productName&&"Equipment"===a.productName&&(e=a),e){var g=$.Deferred();if(f){var h=b.getModel("viewServiceDetailModel");h.set({customerId:a.customerId,productId:a.id}),h.setQueryParams({allParams:!1}),e=a,h.fetch({success:c.bind(b.onGetBBAddonsSuccess,b,g,a),error:function(a){return function(c){b.set("reContractVMStatus","failure"),a.reject(c)}}(g)})}else b.fetchNetworkTech(e,a,g);d.push(g)}}),$.when.apply(b,d).done(function(){var a=b.get("networkDetails"),d=[];if(a&&a.length>0){var e=c.filter(a,function(a){return"ADSL"===a.serviceTech&&!a.bundle}),f=c.filter(a,function(a){return"ADSL"!==a.serviceTech||a.bundle});if(f&&f.length>0&&(d=d.concat(f)),e&&e.length>0){var g=c.groupBy(e,"accessLinkageId");c.map(g,function(a,b){var e,f=!1,g=c.find(a,function(a){return"TV"===a.lob});g&&(f=!0);var h=c.find(a,function(a){return"BB"===a.lob});if(h&&(e=h,e.lob="FHB"),f&&(e?(e.lob="FEB",e.tvProductID=g.id):e=g),e){var i=c.find(a,function(a){return a.sharedEquip});i&&(e.sharedEquipmentID=i.id),d.push(e)}})}var h=b.get("accounts");h&&h.length>0&&a&&a.length>0&&c.each(d,function(a){if(a){var b=a.serviceId;b&&c.each(h,function(d){c.each(d.subscribers,function(c){c.subscriberResourceVal===b&&(a.barNumber=d.billingAccountNumber)})})}})}b.set("customerReContractDetails",d),b.set("reContractVMStatus","success")})},fetchNetworkTech:function(a,b,d){var e=this,f=e.getModel("viewServiceDetailModel");f.set({customerId:a.customerId,productId:a.id}),f.setQueryParams({allParams:!1}),f.fetch({success:c.bind(e.onGetNetworkTechnologySuccess,e,d,b),error:function(a){return function(b){e.set("reContractVMStatus","failure"),a.reject(b)}}(d)})},onGetBBAddonsSuccess:function(a,b,d,e){var f,g=this;if(f=b.fixedServices||b,f.customerId=b.customerId,b.addonItems=[],b.emailItems=[],e.Product.services&&e.Product.services.length>0){var h;e.Product.parameters&&(h=c.find(e.Product.parameters,function(a){return"Service Technology"===a.name&&a.valueName}),h&&(b.networkTechnology=h.valueName)),c.each(e.Product.services,function(a){if("Email"===a.catalogItemName||"8623912"===a.catalogItemID){var d={productID:a.id,billingOffers:[]};c.each(a.pricePackages,function(a){d.billingOffers.push({boId:a.catalogItemID,boName:a.catalogItemName})}),c.each(a.parameters,function(a){"8622642"===a.catalogId&&(d.emailId=a.valueName)}),b.emailItems.push(d)}a.pricePackages&&a.pricePackages.length>0&&c.each(a.pricePackages,function(a){"AddOn"===a.catalogTechDescriptionX8&&b.addonItems.push(a)}),a.containedServices&&a.containedServices.length>0&&g.populateBBAddons(a.containedServices,b)})}this.fetchNetworkTech(f,b,a)},populateBBAddons:function(a,b){var d=this;c.each(a,function(a){a.pricePackages&&a.pricePackages.length>0&&c.each(a.pricePackages,function(a){"AddOn"===a.catalogTechDescriptionX8&&b.addonItems.push(a)}),a.containedServices&&a.containedServices.length>0&&d.populateBBAddons(a.containedServices,b)})},getMBBDetails:function(a){var b=this,d=b.getModel("viewServiceDetailModel"),e=[];c.each(a,function(a){if("WS"===a.lob){var f=$.Deferred();d.set({customerId:a.customerId,productId:a.id}),d.setQueryParams({allParams:!0}),d.fetch({success:c.bind(b.onGetMBBDetailsSuccess,b,f,a),error:function(a){return function(c){b.set("reContractVMStatus","failure"),a.reject(c)}}(f)}),e.push(f)}}),$.when.apply(b,e).done(function(){b.set("mbbWithUserName",b.get("mbbWithUserName")),b.set("reContractVMStatus","mbbWithUserNameFetched")})},onGetMBBDetailsSuccess:function(a,b,d,e){var f=this,g=f.get("mbbWithUserName")||[],h=e.Product;h&&"8363692"==h.catalogItemID&&c.each(h.parameters,function(a){"8622642"==a.catalogId&&(b.userName=a.valueName,g.push(b))}),f.set("mbbWithUserName",g),a.resolve()},onGetNetworkTechnologySuccess:function(a,b,d,e){var f=this,g=f.get("networkDetails")||[],h=f.get("freeMBBData"),i=!0;if(b.addonItems?i=!1:b.addonItems=[],b.setTopBoxes=[],e.Product.services&&e.Product.services.length>0){var j;if(b.networkTechnology?j=b.networkTechnology:e.Product.parameters&&(j=c.find(e.Product.parameters,function(a){return"Service Technology"===a.name&&a.valueName}),j&&(j=j.valueName)),c.each(e.Product.services,function(a){if("8611292"==a.catalogItemID)c.filter(a.parameters,function(a){if("8609342"==a.catalogId)return"Fibre"===a.valueName&&"Fibre"===j?"FHB"===b.lob?b.serviceTech="FTTH":"TV"===b.lob&&(b.serviceTech="Singtel TV"):"FHB"!==b.lob&&"FEB"!==b.lob||"Copper without ADSL"!==a.valueName||"Fibre"!==j?(b.serviceTech="ADSL",b.serviceType="TEL"):(b.serviceType="TEL",b.serviceTech="FIBRE"),!0;if("8609772"===a.catalogId){var d=f.get("productServicesTemp"),e=c.find(d,function(b){return b.serviceId===a.valueName});e&&(b.accessLinkageId=a.valueName,b.sharedEquip||(b.fvProductID=e.id))}});else if("8632892"==a.catalogItemID){var d={};c.filter(a.parameters,function(a){"8631732"==a.catalogId?a.valueName&&(d.stbType=a.valueName):"8629512"==a.catalogId&&a.valueName&&(d.stbBrandAndModel=a.valueName)}),d&&(d.stbType||d.stbBrandAndModel)&&b.setTopBoxes.push(d)}else"8635012"==a.catalogItemID?(b.recontractPlanId=a.id,b.planName=a.catalogItemName):"TV"===b.lob&&"11182"==a.catalogItemID?b.staffComponent=a.id:"TV"===b.lob&&"8633042"===a.catalogItemID&&a.containedServices&&a.containedServices.length>0&&(b.blockUser=!0,c.each(a.containedServices,function(a){var c={catalogItemName:a.catalogItemName};b.addonItems.push(c)}));i&&a.pricePackages&&a.pricePackages.length>0&&c.each(a.pricePackages,function(a){"AddOn"===a.catalogTechDescriptionX8&&b.addonItems.push(a)})}),"TV"===b.lob&&e.Product.packages&&e.Product.packages.length>=1){var k=c.filter(e.Product.packages,function(a){if(h&&h.ignoredContentPacks&&h.ignoredContentPacks.length>0){var b=c.find(h.ignoredContentPacks,function(b){return a.catalogItemName&&a.catalogItemName.toUpperCase().indexOf(b)>-1});return!b}return!0});k&&k.length>0&&(b.blockUser=!0,c.each(k,function(a){b.addonItems.push(a)}))}g.push(b),f.set("networkDetails",g),a.resolve()}else f.set("reContractVMStatus","failure")},containsData:function(a,b){if(a&&a.length>0&&b){var d=c.find(a,function(a){var d=a.split("_");return c.contains(d,b)});if(d)return!0}return!1},saveRecontractDetails:function(){var a=this;a.set("isPaymentPending",!1);var d=a.get("selectedRecontractDetails"),e=b.get("isPendingOrderCheck");a.set("reContractVMStatus","saveRecontractDetails");var f=a.get("finalContractEndDetails"),g=c.find(f,function(a){return a.tempService.id===d.id}),h=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId");d&&d.plan&&a.subViewModels.deviceIdAndPlanIdInContextTopic.set("oldOfferId",d.offeringId);var i=a.get("freeMBBData");if(i&&i.earlyReconBasedonPlans&&i.earlyReconBasedonPlans.length>0&&g&&!g.isReconAllowed&&("FIBER"===d.lob||"FHB"===d.lob)&&d.offeringId&&h){var j=c.find(i.earlyReconBasedonPlans,function(b){return(a.containsData(b.sourcePlans,d.offeringId)||c.contains(b.sourcePlans,"Any"))&&(a.containsData(b.targetPlans,h)||c.contains(b.targetPlans,"Any"))&&b.isAllowed});j&&j.duration&&g?(d.reconStartDate=B(g.contractStartDate,"DD/MM/YYYY").add(j.duration,"months").format("MMM YYYY"),g.reconStartDate=d.reconStartDate,B().isBefore(B(d.reconStartDate,"MMM YYYY"))?(d.isReconAllowed=!1,g.isReconAllowed=!1):(d.isReconAllowed=!0,g.isReconAllowed=!0)):d.isGreaterThanC12&&(d.isGamerPlan=!0)}if(g&&g.isReconAllowed||"FIBER"!==d.lob&&"FHB"!==d.lob)if(e){var k=a.subViewModels.checkPendingOnPendingOrderViewModel.getPendingOrdersForCop(d);$.when(k).done(function(c){if(c){var d=b.get("isPendingOrderConfirmationNeeded");"noPendingOrders"===c?a.doSaveReconDetails():"futureDatedSuspend"===c?a.set("isPaymentPending",c):"pendingPayment"===c?a.set("isPaymentPending",!0):"isOrderPending"===c&&d?a.set("reContractVMStatus",c):a.subViewModels.checkPendingOnPendingOrderViewModel.cancelPendingOrders()}}.bind(a))}else a.doSaveReconDetails();else g&&!g.isReconAllowed&&d.offeringId&&h&&j&&g.isGreaterThanC12?a.set("reContractVMStatus","interimForm"):a.set("reContractVMStatus","notAllowed")},doSaveReconDetails:function(){var a=this,b=a.get("selectedRecontractDetails");a.subViewModels.deviceIdAndPlanIdInContextTopic.set("tvSourceOfferId",b.plan.catalogItemID),a.set("recontractVMStatus","doSaveReconDetails");var d=this.subViewModels.orderInContextTopicViewModel.get(),e=[];if(d.currentOrderActions&&d.currentOrderActions.length>0){c.each(d.currentOrderActions,function(a){e.push(a.productOrderItemID)});var f=[],g=!1;"FHB"===b.lob?c.each(d.orderActions,function(a){!c.contains(e,a.productOrderItemID)&&a.isFreeMBB?e.push(a.productOrderItemID):("TV"===a.lob&&(g=!0),f.push(a))}):c.each(d.orderActions,function(a){c.contains(e,a.productOrderItemID)||("BB"===a.lob&&(g=!0),f.push(a))}),f&&f.length>0&&!g&&c.each(f,function(a){"undefined"!=typeof a.lob&&null!==a.lob||e.push(a.productOrderItemID)});var h,i=(d.orderActions||[],d.customerID||b.customerId),j=d.productOrderID;i?(h=a.models.customerProductOrderProductOrderItemsModel,h.set("customerId",i)):h=a.models.anonymousProductOrderProductOrderItemsModel,h.set("productOrderId",j),a.setDefaultQueryParams(h);var k=c.clone(e);h.setQueryParams({poi:e}),h.set("id",e[0]),h.destroy({success:c.bind(a.createReconOrder,a,b,k),error:c.bind(a.onsaveRecontractDetailsError,a)})}else this.createReconOrder(b,e)},createReconOrder:function(a,b){var d=this;if(b&&b.length>0){var e=d.subViewModels.orderInContextTopicViewModel.get("orderActions")||[];if(e=c.filter(e,function(a){return a.lob}),e&&e.length===b.length){d.subViewModels.orderInContextTopicViewModel.emptyTopic();var f=[];if(f.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),f.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),this.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin")||window.localStorage.removeItem("LightsaberSessionToken"),window.localStorage.setItem("clearSessionStorage",!0),f.length>0)for(var g=0;g<f.length;g++){var h=f[g];window.sessionStorage.removeItem(h)}window.localStorage.removeItem("clearSessionStorage")}}var i=d.createInputPayload(a),j=d.subViewModels.individualInContextTopicViewModel.get("personId"),k=d.getModel("submitProductConfigurationModel");k.setQueryParams({enableHardCancellation:!0}),k.set({contactId:j,customerId:a.customerId,productId:a.id}),d.set("customerID",a.customerId),k.save(i,{success:c.bind(d.onsaveRecontractDetailsSuccess,d,a,b),error:c.bind(d.onsaveRecontractDetailsClearContextError,d)})},createInputPayload:function(a){var b=this,d=b.subViewModels.deviceIdAndPlanIdInContextTopic.get(),e=[],f=[],g=d.bbRelationIds,h="NA";if("staff"===d.customerType&&d.staffDetails&&("undefined"==typeof a.staffComponent||null===a.staffComponent)){var i=b.get("finalStaffComponentDetails"),j=c.find(i,function(b){return b.tempService.id===a.id&&b.staffComponentID});"undefined"!=typeof j&&null!==j||(h="Add")}if("FHB"===a.lob){var k,l=d.priceSchemaId,m=d.planId,n=b.get("freeMBBData"),o=n.broadbandPlanDetails;if(o&&o.length>0)if("TEL"===a.serviceType){var p=c.filter(o,function(a){return a.hdlPlanId===l+"_"+m});p&&p.length>0&&(k=p[0]),b.set("adslPlan",k)}else if(o&&o.length>0){var p=c.filter(o,function(a){return a.hdlPlanId===l+"_"+m});p&&p.length>0&&b.set("adslPlan",p[0])}if("ADSL"===a.serviceTech){if(k){if(b.set("isAdslPlan",!0),a.fvProductID){var q=k.fvRelId,r={newProductOfferingProductSpecID:q,productID:a.fvProductID,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,productChanges:{}};e.push(r)}if(a.id){var s=k.bbRelId,r={newProductOfferingProductSpecID:s,productID:a.id,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,productChanges:{}};e.push(r)}}}else{var t=b.get("bundlesByOffertingInstanceId"),u=t[a.offeringInstanceId];c.each(u,function(b){var c;if("undefined"==typeof b.lob){var d;d=k?k.eqpRelId:g.eqpRelId,c={newProductOfferingProductSpecID:d,productID:b.id,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,productChanges:{}}}else if("BB"===b.lob||"FHB"===b.lob){var f;f=k?k.bbRelId:g.bbRelId,c={newProductOfferingProductSpecID:f,productID:b.id,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,productChanges:{}}}else if("FV"===b.lob)if("Bundle GLP"===b.spoName){var i=[];"Add"===h&&i.push({productSpecContainmentID:"8854312",temporaryID:"c"+Math.random().toString(36).substr(2,9)});var j;j=k?k.groupRelId:g.groupRelId,c={newProductOfferingProductSpecID:j,productID:b.id,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,productChanges:{}},i&&i.length>0&&(c.productChanges.newContainedProducts=i)}else{var l;l=k?k.fvRelId:g.fvRelId,c={newProductOfferingProductSpecID:l,productID:b.id,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,productChanges:{}}}c&&e.push(c)})}var m;if(k){var v=k.adslPlanId;if(v.indexOf("_")>-1){var w=v.split("_");m=w[1]}else m=v}else m=d.planId;f.push({productForReplacement:e,newProductOfferingID:m})}else{var x=[];"staff"===d.customerType&&d.staffDetails&&("undefined"!=typeof a.staffComponent&&null!==a.staffComponent||x.push({productSpecContainmentID:"8635162",temporaryID:"c"+Math.random().toString(36).substr(2,9)}));var y={newProductOfferingID:d.planId,existingProductOfferingID:a.offeringId,productForReplacement:[{productID:a.id,orderActionReasonX8:"RECON",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode,newProductOfferingProductSpecID:d.relationId,productChanges:{links:[],resumedContainedProducts:[],newAssignedBillingOffers:[],changedContainedProducts:[{productID:a.recontractPlanId,changedCharacteristics:[{characteristicID:8822,value:d.packType}]}],newContainedProducts:x,removedContainedProducts:[],suspendedContainedProducts:[]}}]};f.push(y)}var z={ImplSubmitProductConfigurationRestInput:{subscriberId:a.subscriptionId,updateProductConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:null,addDefaultChildItemsImplicitly:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:f,productChanges:[]}}},A=this.subViewModels.orderInContextTopicViewModel.get("productOrderID");return A&&(z.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.productOrderID=A),z},onsaveRecontractDetailsSuccess:function(a,b,d,e){var f,g=e.ImplSubmitProductConfigurationRestOutput;if(g.errorInfo&&g.errorInfo.length>0&&(f=c.find(g.errorInfo,function(a){return"EntityAlreadyExists"===a.errorCode})),f)return void this.set("reContractVMStatus","tbcOrderFound");this.processOutput(g,a,b)},cancelOrderActions:function(){var a=this,b=this.subViewModels.orderInContextTopicViewModel.get(),d=[];if(b.currentOrderActions&&b.currentOrderActions.length>0){c.each(b.currentOrderActions,function(a){d.push(a.productOrderItemID)});var e,f=(b.orderActions||[],b.customerID),g=b.productOrderID;f?(e=a.models.customerProductOrderProductOrderItemsModel,e.set("customerId",f)):e=a.models.anonymousProductOrderProductOrderItemsModel,e.set("productOrderId",g),a.setDefaultQueryParams(e),e.setQueryParams({poi:d}),e.set("id",d[0]),e.destroy({success:c.bind(a.cancelOrderActionsSuccess,a,d),error:c.bind(a.onsaveRecontractDetailsError,a)})}else this.cancelOrderActionsSuccess()},cancelOrderActionsSuccess:function(a,b,d){var e=this.subViewModels.orderInContextTopicViewModel,f=e.get();e.set("currentOrderActions",[]);var g=f.orderActions||[];g&&g.length>0&&(g=c.filter(g,function(b){return!c.contains(a,b.productOrderItemID)})),e.set("orderActions",g),this.set("reContractVMStatus","orderActionCancelled")},processVMvalue:function(a,b){var c=this,d="recontractFailed";try{if(b&&b.responseText){var e=JSON.parse(b.responseText);e&&e.ErrorInfo&&"SuspendedSubscription"===e.ErrorInfo.errorCode&&(d="failure")}}finally{c.set("reContractVMStatus",d)}},onsaveRecontractDetailsClearContextError:function(a,b){this.subViewModels.clearContextInContextTopic.clearCurrentContextTopic(),this.processVMvalue(a,b)},onsaveRecontractDetailsError:function(a,b){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.processVMvalue(a,b)},processOutput:function(a,b){var d=this;if(void 0!==typeof a.updateProductConfigurationResponse){var e=d.get("freeMBBData"),b=d.get("selectedRecontractDetails"),f=a.updateProductConfigurationResponse,g=this.subViewModels.orderInContextTopicViewModel,h=g.get("orderActions")||[],i=[],j=d.get("isAdslPlan"),k=g.get("currentOrderActions")||[];c.each(k,function(a){i.push(a.productOrderItemID)}),h&&h.length>0&&(h=c.filter(h,function(a){return!c.contains(i,a.productOrderItemID)})),k=[];var l=d.get("staffOrderActionDetails"),m=this.subViewModels.deviceIdAndPlanIdInContextTopic;if(c.each(f.productsInReplaceProductOffering,function(a){c.each(a.products,function(a){var e={productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productConfiguration.productSpecification.level,lob:a.productConfiguration.lineOfBusiness,flowType:d.get("flowType"),orderType:"Change"};k.push(e),h.push(e);var f=b.chargeableEmail||d.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if("BB"===e.lob&&f&&f.productID){var g;c.find(a.productConfiguration.displayableItems,function(d){if(d.productID===f.productID){var e=f.freeBOIDs;g={productID:d.productID,productOrderItemID:a.productOrderItemID,productSpecContainmentID:d.productSpecContainmentID,paidBOID:f.paidBOID,selectedBoID:f.selectedBoID,freeEmailIdFlag:b.freeEmailIdFlag||f.freeEmailIdFlag,emailId:f.emailId},c.find(d.displayableBillingOffers,function(a){c.find(e,function(b){if(a.productSpecPricing.childPricingSchema.id===b.freeBOID&&a.selected)return b.freePricingID=a.productSpecPricingID,b.billingOfferID=a.billingOfferID,!0});a.productSpecPricing.childPricingSchema.id===f.paidBOID&&(g.paidPricingID=a.productSpecPricingID)}),g.freeBOIDs=e}}),b.chargeableEmail=g,d.set("selectedRecontractDetails",b),d.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",g)}if("staff"!==m.customerType&&a.productConfiguration.displayableItems&&a.productConfiguration.displayableItems.length>0&&("TV"===e.lob&&"S"===e.level||"FV"===e.lob&&"G"===e.level)){var i=c.find(a.productConfiguration.displayableItems,function(a){return"8854312"===a.productSpecContainmentID&&"FV"===e.lob||"8635162"===a.productSpecContainmentID&&"TV"===e.lob});i&&i.productID&&l.push({orderActionID:e.productOrderItemID,staffComponentID:i.productID})}})}),d.set("staffOrderActionDetails",l),j){var n=c.find(k,function(a){return"BB"===a.lob||"TV"===a.lob});n&&d.subViewModels.getNetworkCoverageViewModel.set("adslOrderActionId",n.productOrderItemID)}g.set("orderActions",h),g.set("currentOrderActions",k),g.set("customerID",this.get("customerID")),g.set("productID",f.productID),g.set("productOrderReferenceNumber",f.productOrderReferenceNumber),g.set("productOrderID",f.productOrderID),g.set("productOrderItemID",f.productOrderItemID),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("reContractFlag",!0),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractBarId",b.barNumber),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installationAddressID",b.address.id);var o=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo");if(o&&(o.code||o.campaign&&o.parentLine)){var p=d.subViewModels.pickAndGoViewModel.updateCode(o,!1);p.done(function(a){"pickAndGoUpdated"===a?d.updateMBBOrderAndProcessFurther(b,e,g,k):"pickAndGoFailed"===a&&d.getErrorMessage()})}else d.updateMBBOrderAndProcessFurther(b,e,g,k)}},updateMBBOrderAndProcessFurther:function(a,b,d,e){var f=this;if("FIBER"===a.lob||"FHB"===a.lob){var g=a.serviceId,h=f.get("mbbWithUserName");if(h&&h.length>0)if(h=c.filter(h,function(a){return a.userName===g}),0===h.length)f.subViewModels.freeMBBViewModel.createFreeMBBOrder(b.dealerID,b.vendorID,b.mbbOfferId,b.mbbRelationId,d.get("productOrderID"),g);else{var i=f.get("expressCheckout");i.hasFreeMBB=!1,f.set("expressCheckout",i),f.getSuccessMessage(e)}else f.subViewModels.freeMBBViewModel.createFreeMBBOrder(b.dealerID,b.vendorID,b.mbbOfferId,b.mbbRelationId,d.get("productOrderID"),g)}else this.getSuccessMessage(e)},getErrorMessage:function(){return this.set("reContractVMStatus","failure"),!0},getSuccessMessage:function(a,b,d){var e=this;if("undefined"!=typeof a&&null!==a||(a=e.subViewModels.orderInContextTopicViewModel.get("currentOrderActions")),b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0)}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus){var f=d.productConfiguration.messages,g=!1;return e.set("blockingMessages",f),e.set("reContractVMStatus","gaBlockingMessagesRetrieved"),f=c.find(f,function(a){if(a.text&&a.text.indexOf("PENDING_SUBMITTED_ORDER_FORM")>-1)return g=!0,
!0}),g?e.set("reContractVMStatus","submittedReconOrderFound"):e.set("reContractVMStatus","failure"),!1}if("BB"===d.productConfiguration.lineOfBusiness||"TV"===d.productConfiguration.lineOfBusiness||"FV"===d.productConfiguration.lineOfBusiness&&"S"===d.productConfiguration.productSpecification.level){var h=e.get("preTickAddonDetails");if(h&&h.preTickAddons){var i=e.subViewModels.preTickAddonViewModel;i.set("preTickAddons",h.preTickAddons),i.createInputPayload(d,h.addComponentList)}}var j=e.get("expressCheckout"),k=e.subViewModels.orderInContextTopicViewModel.get("orderActions"),l=c.find(k,function(a){if("undefined"==typeof a.lob||null===a.lob)return!0});l&&(j.hasSharedEquipment=!0);var m=e.get("freeMBBData");if(m.isTargetFirst&&("undefined"!=typeof d.productConfiguration.lineOfBusiness&&null!==d.productConfiguration.lineOfBusiness||(j.hasSharedEquipment=!0),d.productConfiguration.displayableItems&&"BB"===d.productConfiguration.lineOfBusiness)){var n=c.find(d.productConfiguration.displayableItems,function(a){return a.selected&&"AD"===a.action&&("13051101"===a.productSpecContainmentID||"13051081"===a.productSpecContainmentID||"Additional RG"===a.name||"Additional AP"===a.name)});n&&(j.hasRGDevice=!0);var o=c.find(d.productConfiguration.displayableItems,function(a){if(("8704182"===a.productSpecContainmentID||"Broadband Accessories"===a.name)&&a.selected){var b=a.displayableSimpleProductReferences;b&&b.length>0&&c.each(b,function(a){if(("8704172"===a.productSpecContainmentID||"Broadband Accessory"===a.name)&&a.selected&&"AD"===a.action)return!0})}});o&&(j.hasWifiMesh=!0)}e.set("expressCheckout",j)}if(a&&a.length>0)e.updateOrderToRunRules(a);else{var i=e.subViewModels.preTickAddonViewModel,p=i._updateProductConfiguration();p.done(function(a){e.addCustomerContact()}.bind(e))}},addCustomerContact:function(){var a=this;a.set("reContractVMStatus","addCustomerContactStart");var b=a.subViewModels.getNetworkCoverageViewModel,d=a.get("selectedRecontractDetails");b.set("address",d.address);var e;e="ADSL"===d.serviceTech?b.onCheckServiceCoverage(!0):b.onCheckServiceCoverageForRecon(!0),e.done(function(d){if(d&&("success"===d||d.coverageType)){var e=b._saveOrderData(!0);e.done(function(b){if("success"===b){var d=a.get("expressCheckout"),e=a.get("adslPlan"),f=a.get("selectedRecontractDetails"),g=!1;g=e?"TEL"===f.serviceType?e.isAdslExpressRequired:e.isHdlExpressRequired:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("isExpressRequired");var h=a.get("freeMBBData"),i=h.broadbandInstallationIds,j=!1;if(i&&i.length>0){var k=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("priceSchemaId"),l=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId");j=c.contains(i,k+"_"+l)}var m=a.get("flowType");if("FIBER"===m&&h.isTargetFirst&&!j&&(!d.hasSharedEquipment||d.hasSharedEquipment&&g)){a.subViewModels.ShoppingCartViewModel.set("isShoppingCartFlag",!0);var n=a.subViewModels.ShoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts",!1);n.done(function(b){if("SUCCESS"===b){var e=a.subViewModels.orderInContextTopicViewModel.get(),h=e.orderActions,i=c.find(h,function(a){if("undefined"==typeof a.lob||null===a.lob)return!0});if(i&&(d.hasSharedEquipment=!0),!d.hasSharedEquipment||d.hasSharedEquipment&&g){var j=e.currentOrderActions,k=[];c.each(j,function(a){k.push(a.productOrderItemID)});var l=c.find(h,function(a){return!a.isFreeMBB&&a.lob&&!c.contains(k,a.productOrderItemID)});if(l)a.updateOrderSuccess();else{var m=a.subViewModels.onePassTopicViewModel.get("nric");a.subViewModels.getCustomerIdValueViewModel.isLocalCustomer(m)?(f.expressCheckout=d,a.set("selectedRecontractDetails",f),a.set("expressCheckoutAllowed",!0),a.set("reContractVMStatus","askExpressCheckout")):a.updateOrderSuccess()}}else a.updateOrderSuccess()}}),n.fail(function(b){a.set("reContractVMStatus","failure")}.bind(a))}else a.updateOrderSuccess()}else a.set("reContractVMStatus","failure")}),e.fail(function(b){a.set("reContractVMStatus","failure")}.bind(a))}else a.set("reContractVMStatus","failure")}),e.fail(function(b){a.set("reContractVMStatus","failure")}.bind(a))},updateOrderSuccess:function(){var a=this,b=a.subViewModels.customerInContextTopicViewModel.get("customerIds");if(a.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutOrderID",null),a.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutRulesCompleted",!1),a.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutServiceID",null),b&&1===b.length){var d=a.getModel("updateContactModel");a.subViewModels.implUserContextTopicViewModel.get("userInfo");d.setQueryParams({isAnonymous:!0});var e=a.subViewModels.orderInContextTopicViewModel.get();d.set({customerId:a.get("customerID"),orderId:e.productOrderReferenceNumber});var f=e.orderActions,g=e.updatedOrderActions;f=c.filter(f,function(a){return!c.contains(g,a.productOrderItemID)});var h=[],i=[];if(c.each(f,function(b){h.push({orderActionId:b.productOrderItemID,contactId:a.subViewModels.individualInContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),i.push(b.productOrderItemID)}),h.length>0){var j={ImplAddCustomerContactRestInput:{orderAction:h}};d.save(j,{success:c.bind(a.updateContactSuccess,a,i),error:c.bind(a.updateContactFailure,a,i)})}else a.set("reContractVMStatus","orderSuccesfull")}else a.set("reContractVMStatus","orderSuccesfull")},updateContactSuccess:function(a,b,d){var e=this,f=e.subViewModels.orderInContextTopicViewModel.get("updatedOrderActions")||[];c.each(d,function(a){f.push(a)}),e.subViewModels.orderInContextTopicViewModel.set("customerID",e.get("customerID")),sessionStorage.removeItem("loginClicked"),e.subViewModels.orderInContextTopicViewModel.set("updatedOrderActions",f),e.set("reContractVMStatus","orderSuccesfull")},updateContactFailure:function(a,b){this.set("reContractVMStatus","orderSuccesfull")},updateOrderToRunRules:function(a){var b,d,e,f,g,h=this,i=[],j=[],k=[],l=[],m=[],n={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},o=h.subViewModels.orderInContextTopicViewModel.get(),p=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});p&&p.length>0&&(b=p[0].productOrderItemID,d=p[0].productID,e=p[0].flowType,f=p[0].lob,g=p[0].orderType,i.push({productID:d}));var q=h.get("staffOrderActionDetails"),r=h.subViewModels.deviceIdAndPlanIdInContextTopic.get(),s=(h.get("selectedRecontractDetails"),!1);if(("staff"!==r.customerType||!r.staffDetails)&&q&&q.length>0){var t=c.find(q,function(a){return a.orderActionID===b});if(t){var u={productID:t.staffComponentID};k.push(u),s=!0}}if("TV"!==e&&!s){if(q&&q.length>0){var t=c.find(q,function(a){return a.orderActionID===b});if(t){var u={productID:t.staffComponentID};k.push(u),s=!0}}if(("staff"===r.customerType||r.staffDetails)&&s&&t){var v={productSpecContainmentID:"8854312",temporaryID:"c"+Math.random().toString(36).substr(2,9)};j.push(v)}}i.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=i),k.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].removedContainedProducts=k),j.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].newContainedProducts=j,n.UpdateProductInOrderConfigurationRequest.addDefaultChildItemsImplicitly=!0),m.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].newAssignedBillingOffers=m),l.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].removedAssignedBillingOffers=l);var w=o.customerID;if(w){var x=h.getModel("updateProductConfigurationModel");x.set({customerId:w,productOrderItemId:b}),h.setHeaders(x),h.setDefaultQueryParams(x),x.setQueryParams({rp:!1,rpc:!1}),x.save(n,{success:function(c,d){h.getSuccessMessage(a,b,d.UpdateProductInOrderConfigurationResponse)},error:h.getErrorMessage})}else{var y=h.getModel("anonymousUpdateProductConfigurationModel");y.set({productOrderItemId:b}),h.setHeaders(y),h.setDefaultQueryParams(y),y.setQueryParams({rp:!1,rpc:!1}),y.save(n,{success:function(c,d){h.getSuccessMessage(a,b,d.UpdateProductInOrderConfigurationResponse)},error:h.getErrorMessage})}},triggerBuyFlow:function(){var a=this;a.set("isPaymentPending",!1),a.set("reContractVMStatus","triggerBuyFlow");var d=a.get("selectedRecontractDetails"),e=a.get("customerReContractDetails");if(d&&d.productId){if(e){var f=c.filter(e,function(a){return a.id===d.productId});f&&f.length>0&&(d.customerId=f[0].customerId,a.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractNumber",f[0]))}}else if(d&&e){var f=c.filter(e,function(a){return a.id===d});if(f&&f.length>0){var g=a.get("finalContractEndDetails"),h=c.find(g,function(a){return a.tempService.id===f[0].id&&a.isReconAllowed});h||"FIBER"!==d.lob&&"FHB"!==d.lob?(d=f[0],a.subViewModels.deviceIdAndPlanIdInContextTopic.set("recontractNumber",f[0])):a.set("reContractVMStatus","notAllowed")}}d.chargeableEmail&&d.chargeableEmail.productID&&a.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",d.chargeableEmail);var i=b.get("isPendingOrderCheck");if(i){a.subViewModels.checkPendingOnPendingOrderViewModel.set("eCareFlow",!0);var j=a.subViewModels.checkPendingOnPendingOrderViewModel.getPendingOrdersForCop(d);$.when(j).done(function(c){if(c){var d=b.get("isPendingOrderConfirmationNeeded");"noPendingOrders"===c?a.set("reContractVMStatus","triggeredBuyFlow"):"futureDatedSuspend"===c?a.set("isPaymentPending",c):"pendingPayment"===c?a.set("isPaymentPending",!0):"isOrderPending"===c&&d?a.set("reContractVMStatus",c):a.subViewModels.checkPendingOnPendingOrderViewModel.cancelPendingOrders()}}.bind(a))}else a.set("reContractVMStatus","triggeredBuyFlow")},checkPendingOrder:function(a,b){if(b){var d=c.find(a,function(a){return!!b[a]});return d}return!1}});return D});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetCartOrderItemsViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/SearchCartOrderModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UserInformationViewModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i){return a.Core.ObservableViewModel.extend({models:{searchCartOrderModel:c,onePassInfoModel:f},subViewModels:{individualInContextTopicViewModel:d,userInformationViewModel:e,onePassDetailsViewModel:g,onePassTopicViewModel:h,worryFreeContextTopicViewModel:i},defaults:{cartItemsVmStatus:"",cartItems:null,userDetails:null,anonymousUser:!0,contactId:null},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){this._super();var a=this;b.bindAll(this,"getCartItems","getUserInformation","getOnePassFields","getCookie","getCookieVal"),this.on("change:contactId",function(a){this.get("contactId")&&this.getCartItems(this.get("contactId"))}.bind(this),this);var c=(a.subViewModels.onePassTopicViewModel.get("userId"),a.subViewModels.onePassTopicViewModel.get("newcustomer")),d=a.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin"),e=a.subViewModels.worryFreeContextTopicViewModel.get("otpData");c||d&&e&&("GOMO"===e.type||"PREPAID"===e.type)||(a.getOnePassFields(),a.getUserInformation())},getCartItems:function(a){var c=this;if("undefined"!=typeof a&&null!==a){c.set("cartItemsVmStatus","fetchingValues");var d={ImplSearchOrderRestInput:{categoryType:"ContactID",categoryId:a,hashString:"N/A"}},e=c.getModel("searchCartOrderModel");e.setQueryParams({os:"EX",checkPayment:!0}),e.save(d,{success:b.bind(c.onSearchCartOrderSuccess,c),error:function(){c.set("cartItemsVmStatus","failure")}})}},onSearchCartOrderSuccess:function(a,c){var d=c.ImplSearchOrderRestOutput;if(d&&d.orderActionHeader&&d&&d.cartHeader&&!d.cartHeader.isPendingPayment){var e=0,f=!1;b.each(d.orderActionHeader,function(a){a&&("WS"!==a.lineOfBusiness&&"TV"!==a.lineOfBusiness&&"BB"!==a.lineOfBusiness&&"FV"!==a.lineOfBusiness||(e+=1),"BB"===a.lineOfBusiness&&(f=!0))}),f&&(e-=2),d.cartHeader.productsCounter=e,this.set("cartItems",d),this.set("cartItemsVmStatus","successful")}},getUserInformation:function(){var a=this,b=a.subViewModels.userInformationViewModel.retrieveUserInfo();b.done(function(b){"undefined"!=typeof b&&(a.set("userDetails",b),a.set("cartItemsVmStatus","genderIdentified"))})},getOnePassFields:function(){this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(b.bind(this.onOnePassInfoSuccess,this),b.bind(this.onOnePassInfoFailure,this))},onOnePassInfoSuccess:function(a){var b=this,c=a.ImplLoginHeaderResOutput.headersMap,d=b.get("userDetails")||{};c.HTTP_CUST_ID&&null!==c.HTTP_CUST_ID&&""!==c.HTTP_CUST_ID?(d.anonymousUser=!1,b.set("userDetails",d)):(d.anonymousUser=!0,b.set("userDetails",d)),b.set("cartItemsVmStatus","userIdentified")},onOnePassInfoFailure:function(a,b){var c=this.get("userDetails")||{};c.anonymousUser=!0,this.set("userDetails",c),this.set("cartItemsVmStatus","userIdentified")},getCookieVal:function(){var a=this.getCookie("orderValue"),c=this.getCookie("orderActions");if(""!==a){c=$.parseJSON(c),a=a.split("_");var d=0,e=!1;c&&c.length>0&&b.each(c,function(a){a&&("WS"!==a.lob&&"TV"!==a.lob&&"BB"!==a.lob&&"FV"!==a.lob||(d+=1),"BB"===a.lob&&(e=!0),a.lineOfBusiness=a.lob)}),e&&(d-=2);var f={cartHeader:{cartId:a[0],productsCounter:d},orderActionHeader:c};this.set("cartItems",f),this.set("cartItemsVmStatus","successful")}},getCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/SetupBoxSetupViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f,g,h,i,j){var k=a.Core.ObservableViewModel.extend({defaults:{customerId:null,productOrderItemID:null,manageTopupVmStatus:null,topupData:null,selectedValue:null,updatedValue:null,promoOrderDetails:[]},models:{customerUPCModel:f,anonymousUPCModel:g},subViewModels:{orderInContextTopicViewModel:d,updateProductConfigurationViewModel:e,shoppingCartViewModel:h,getCustomerIdValueViewModel:i,deviceIdAndPlanIdInContextTopic:j},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){c.bindAll(this,"retrieveProductConfiguration","generateTemporaryId","setHeaders","setDefaultQueryParams","updateOrderToRunRules","callUpdateOrder","onUpdateOrderToRunRulesError","getTvItems");var a=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");a&&a.length>0&&(a=c.filter(a,function(a){return"TV"===a.lob}),a&&a.length>0&&(this.set("productOrderItemID",a[0].productOrderItemID),this.retrieveProductConfiguration()))},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},retrieveProductConfiguration:function(){var a=this,b=a.getProductConfigurationPayload(),c={};c.customerType="public",c.productOrderItemId=this.get("productOrderItemID");var d=a.subViewModels.updateProductConfigurationViewModel._retrieveProductConfiguration("TV",b);d.done(function(b){if("undefined"!=typeof b.RetrieveProductInOrderConfigurationResponse){a.getTvItems(b.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems,c);var d=null;"CH"===b.RetrieveProductInOrderConfigurationResponse.productOrderItemType?d="recon":"PR"===b.RetrieveProductInOrderConfigurationResponse.productOrderItemType&&(d="new"),c.transactionType=d;var e=b.RetrieveProductInOrderConfigurationResponse.productConfiguration.rootProductOfferingID;c.productOffer=e;var f=a.get("promoOrderDetails");f.push(c),a.set("promoOrderDetails",f)}else a.set("manageTopupVmStatus","failure")}.bind(a)),d.fail(function(b){a.set("manageTopupVmStatus","failure")}.bind(a))},getProductConfigurationPayload:function(){var a={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return a},getTvItems:function(a,b){var d=[],e=[];e=this.subViewModels.getCustomerIdValueViewModel.getSelectedAddonIDs(a,e),a&&c.each(a,function(a){if("10797291"===a.productSpecContainmentID){this.getSeletedValue(a.displayableCharacteristics);var c=a;c.name="Set Top Box",d.push(c)}else"8635162"===a.productSpecContainmentID&&a.selected&&(b.customerType="staff")},this),b.selectedAddonIds=e,this.set("topupData",d),this.set("manageTopupVmStatus","TopupDataSet")},getSeletedValue:function(a){var b=c.filter(a,function(a){return"8631732"==a.productSpecCharacteristicID});this.set("selectedValue",b[0].value||"HD")},updateProductConfiguration:function(){var a=this,b=a.getProductConfigurationInput(),c=a.get("productOrderItemID"),d=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("TV",b,c);d.done(function(b){b.UpdateProductInOrderConfigurationResponse&&"BLOCKING"!==b.UpdateProductInOrderConfigurationResponse.productConfiguration.compatibilityStatus?a.updateOrderToRunRules(a.subViewModels.orderInContextTopicViewModel.get("orderActions"),c,b.UpdateProductInOrderConfigurationResponse):a.set("manageTopupVmStatus","failure")}.bind(a)),d.fail(function(b){a.set("manageTopupVmStatus","failure")}.bind(a))},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},getProductConfigurationInput:function(a){var b=this,d=(this.generateTemporaryId(),this.get("topupData")),e=[{productSpecContainmentID:d[0].productSpecContainmentID,productID:d[0].productID,changedCharacteristics:[{characteristicID:8631732,value:b.get("updatedValue")},{characteristicID:8629532,value:1}]}],f="SD Add Comp Stage";f+="+++promoCode+++EMPTY";var g,h=b.get("promoOrderDetails"),i=b.get("productOrderItemID");if(h&&h.length>0&&(g=c.find(h,function(a){return a.productOrderItemId===i})),g){var j=b.subViewModels.getCustomerIdValueViewModel.createPromoString(g.productOffer,g.brand,g.model,g.transactionType,g.ciTier,g.customerType,g.subSegment,g.selectedAddonIds);j&&""!==j&&(f+=j)}var k={removedContainedProducts:[],changedContainedProducts:e,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]},l={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:f,confirmationMessagesApproved:!1,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",submitProductOrder:a,updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[k],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}}};return l},updateOrderToRunRules:function(a,b,d){var e=this;if("undefined"!=typeof a&&null!==a||(a=e.subViewModels.orderInContextTopicViewModel.get("orderActions")),b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0)}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration&&"BLOCKING"===d.productConfiguration.compatibilityStatus)return e.set("manageTopupVmStatus","failure"),!1;if(a&&a.length>0)e.callUpdateOrder(a);else{var f=e.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts");f.done(function(a){if("SUCCESS"===a){var b=e.subViewModels.orderInContextTopicViewModel.get("promoOrderActions")||[],d=e.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");c.each(d,function(a){c.contains(b,a.productOrderItemID)||b.push(a.productOrderItemID)}),e.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",b),e.set("manageTopupVmStatus","orderUpdated")}}.bind(e)),f.fail(function(a){e.set("manageTopupVmStatus","failure")}.bind(e))}},callUpdateOrder:function(a){var b=this,d=[],e="SD Add Comp Stage";e+="+++promoCode+++EMPTY";var f,g,h,i=b.get("promoOrderDetails"),j=b.subViewModels.orderInContextTopicViewModel.get(),k=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});if(k&&k.length>0&&(g=k[0].productOrderItemID,h=k[0].productID,d.push({productID:h})),i&&i.length>0&&(f=c.find(i,function(a){return a.productOrderItemId===g})),f){var l=b.subViewModels.getCustomerIdValueViewModel.createPromoString(f.productOffer,f.brand,f.model,f.transactionType,f.ciTier,f.customerType,f.subSegment,f.selectedAddonIds);l&&""!==l&&(e+=l)}var m={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:e,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};d.length>0&&(m.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=d);var n=j.customerID;if(n){var o=b.getModel("customerUPCModel");o.set({customerId:n,productOrderItemId:g}),b.setHeaders(o),b.setDefaultQueryParams(o),o.setQueryParams({rp:!1,rpc:!1}),o.save(m,{success:function(c,d){b.updateOrderToRunRules(a,g,d.UpdateProductInOrderConfigurationResponse)},error:b.onUpdateOrderToRunRulesError})}else{var p=b.getModel("anonymousUPCModel");p.set({productOrderItemId:g}),b.setHeaders(p),b.setDefaultQueryParams(p),p.setQueryParams({rp:!1,rpc:!1}),p.save(m,{success:function(c,d){b.updateOrderToRunRules(a,g,d.UpdateProductInOrderConfigurationResponse)},error:b.onUpdateOrderToRunRulesError})}},onUpdateOrderToRunRulesError:function(a,b){this.set("manageTopupVmStatus","failure")}});return k});
define("businesswidget/repository_l9_common/common/viewmodel/business/HandleLoginStatusVieWModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UserInformationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){return a.Core.ObservableViewModel.extend({models:{onePassInfoModel:d,findCallerModel:e,updateContactModel:i},subViewModels:{orderInContextTopicViewModel:k,onePassTopicViewModel:c,implUserContextTopicViewModel:f,customerInContextTopicViewModel:g,individualInContextTopicViewModel:j,contactInContextTopicViewModel:h,getCustomerIdValueViewModel:l,onePassDetailsViewModel:m,clearContextInContextTopic:n,deviceIdAndPlanIdInContextTopic:o,validateSessionTokenViewModel:p,userInformationViewModel:q,worryFreeContextTopicViewModel:r},defaults:{loginVmStatus:null,checkCIS:!1},initialize:function(a){b.bindAll(this,"fetchUserInfo","doUpdateContact","deleteCookie","clearContextData");var c=this;setTimeout(function(){c.set("loginVmStatus","initialized")},0)},clearContextData:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0)},setOnePassFields:function(){this.set("loginVmStatus","setOnePassFields");var a=this.subViewModels.onePassTopicViewModel.get("newcustomer");if(a)this.set("loginVmStatus","anonymous");else{var c=sessionStorage.getItem("loginClicked");c?this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(b.bind(this.onOnePassInfoSuccess,this),b.bind(this.onOnePassInfoFailure,this)):this.set("loginVmStatus","anonymous")}},onOnePassInfoSuccess:function(a){var b=this,c=a.ImplLoginHeaderResOutput.headersMap;if(c.HTTP_CUST_ID&&null!==c.HTTP_CUST_ID&&""!==c.HTTP_CUST_ID){this.subViewModels.onePassTopicViewModel.set("loginVmStatus","OnePassInfoLoadedSuccessfully");var d=this.subViewModels.getCustomerIdValueViewModel.getCustomerIdType(c.HTTP_CUST_ID_TYPE);this.subViewModels.onePassTopicViewModel.set("nickName",c.HTTP_GIVEN_NAME),this.subViewModels.onePassTopicViewModel.set("userId",c.HTTP_LOGIN_ID),this.subViewModels.onePassTopicViewModel.set("customerIdType",d),this.subViewModels.onePassTopicViewModel.set("status",c.HTTP_LHTTP_CUST_STATUSOGIN_ID),this.subViewModels.onePassTopicViewModel.set("email",c.HTTP_CUST_EMAIL),this.subViewModels.onePassTopicViewModel.set("familyName",c.HTTP_SSO_FAMILY_NAME),this.subViewModels.onePassTopicViewModel.set("billPayer",c.HTTP_BILL_PAYER),this.subViewModels.onePassTopicViewModel.set("nric",c.HTTP_CUST_ID);var e=this.get("checkCIS");if(e){var f=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");if("cis"===f){var g=!1,h=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("cisDetails");if(h&&"MY_INFO"===h.appType&&h.sessionToken){var i=b.subViewModels.validateSessionTokenViewModel.getCISInfo(h.sessionToken);i.done(function(a){if("cisInfoSuccess"===a){b.subViewModels.validateSessionTokenViewModel.get("cisCustomerDetails");g?(b.set("loginVmStatus","fraudUser"),b.clearContextData()):this.fetchUserInfo(c.HTTP_CUST_ID,d)}else b.set("loginVmStatus","fraudUser"),b.clearContextData()}.bind(b)),i.fail(function(a){b.set("loginVmStatus","fraudUser"),b.clearContextData()}.bind(b))}else b.fetchUserInfo(c.HTTP_CUST_ID,d)}else b.fetchUserInfo(c.HTTP_CUST_ID,d)}else b.fetchUserInfo(c.HTTP_CUST_ID,d)}else sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","anonymous")},onOnePassInfoFailure:function(){this.set("loginVmStatus","anonymous"),sessionStorage.removeItem("loginClicked")},fetchUserInfo:function(a,c){var d=this;if(this.set("loginVmStatus","fetchUserInfo"),a){var f={implContactDetails:{indentValue:a,indentType:c}};d.models.findCallerModel=d.create("findCallerByContactModel",e),d.models.findCallerModel.save({ImplFindCallerByContactInput:f},{success:b.bind(this.onFindCallerSuccess,this),error:b.bind(this.onFindCallerFailure,this)})}},onFindCallerSuccess:function(a,c){var d,e=this,f=[],g=e.subViewModels.onePassDetailsViewModel.get("isWorryFreeLogin"),h=e.subViewModels.worryFreeContextTopicViewModel.get("otpData");if(d=!g||!h||"GOMO"!==h.type&&"PREPAID"!==h.type||"undefined"!=typeof h.passportDetails&&null!==h.passportDetails||"Passport Number"===h.indentType?c.ImplFindCallerByContactOutput.contactCustomerDetails:c.ImplFindCallerByContactOutput.prepaidContactCustomerDetails,b.each(d,function(a){f.push(a.customerId)}),e.subViewModels.customerInContextTopicViewModel.set("customerIds",f),e.subViewModels.customerInContextTopicViewModel.set("ID",f[0]),c.ImplFindCallerByContactOutput.contactDetails){e.subViewModels.contactInContextTopicViewModel.set("ID",c.ImplFindCallerByContactOutput.contactDetails.contactId),e.subViewModels.implUserContextTopicViewModel.set("userInfo",c.ImplFindCallerByContactOutput),e.subViewModels.individualInContextTopicViewModel.set("personId",c.ImplFindCallerByContactOutput.contactDetails.contactId);var i=e.subViewModels.userInformationViewModel.retrieveContactInfo();i.done(function(){if(f.length>0){var a=c.ImplFindCallerByContactOutput.contactDetails.registeredName,b=!1;1===f.length&&(b=!0);var d=e.subViewModels.orderInContextTopicViewModel.get("orderActions");"undefined"!=typeof d&&null!==d&&d.length>0&&1===f.length?this.doUpdateContact(b,a,f[0],d):(sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","loggedin"))}else setTimeout(function(){sessionStorage.removeItem("loginClicked"),e.set("loginVmStatus","loggedin")},0)}.bind(e))}else c.ImplFindCallerByContactOutput.errorADT&&1===c.ImplFindCallerByContactOutput.errorADT.code&&c.ImplFindCallerByContactOutput.errorADT.message.indexOf("No contact found")>-1&&setTimeout(function(){sessionStorage.removeItem("loginClicked"),e.set("loginVmStatus","noContactFound")},0)},doUpdateContact:function(a,c,d,e){var f=this,g=f.subViewModels.orderInContextTopicViewModel.get(),h=f.getModel("updateContactModel"),i=!1;a?(h.setQueryParams({isAnonymous:!0}),i=!0):h.setQueryParams({isAnonymous:!1}),h.set({customerId:d,orderId:g.productOrderReferenceNumber});var j=g.updatedOrderActions||[],k=b.filter(e,function(a){return!b.contains(j,a.productOrderItemID)}),l=[],m=[];if(b.each(k,function(a){l.push({orderActionId:a.productOrderItemID,contactId:f.subViewModels.individualInContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),m.push(a.productOrderItemID);
}),l.length>0){var n={ImplAddCustomerContactRestInput:{orderAction:l}};h.save(n,{success:b.bind(f.onupdateContactSuccess,this,m,i,d),error:function(){sessionStorage.removeItem("loginClicked"),f.set("loginVmStatus","loggedin")}})}else sessionStorage.removeItem("loginClicked"),f.set("loginVmStatus","loggedin")},onupdateContactSuccess:function(a,c,d,e,f){var g=this.subViewModels.orderInContextTopicViewModel.get("updatedOrderActions")||[];b.each(a,function(a){g.push(a)}),c&&this.subViewModels.orderInContextTopicViewModel.set("customerID",d),this.subViewModels.orderInContextTopicViewModel.set("updatedOrderActions",g),sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","loggedin")},onFindCallerFailure:function(){this.set("implLoginVmStatus","userInfoLoadingFailed"),sessionStorage.removeItem("loginClicked"),this.set("loginVmStatus","anonymous")},deleteCookie:function(){document.cookie="orderValue=; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="orderActions=; expires=Thu, 01 Jan 1970 00:00:00 UTC",sessionStorage.removeItem("cookieCreated")}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/PremiumAddonsViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c,d){var e=a.Core.ObservableViewModel.extend({subViewModels:{updateProductConfigurationViewModel:c,orderInContextTopicViewModel:d},defaults:{premiumAddonVmStatus:"",selectedPremiumAddon:null,previousAddons:null,productOrderItemID:null,actionType:null,updatedAddOn:null,premiumAddonProductId:null,blockingMessages:null},initialize:function(){b.bindAll(this,"getAddons","getProductConfigurationPayload","onRetrieveProductConfig","saveSelectedAddon","createPayload","generateTemporaryId");var a=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");a&&a.length>0&&(a=b.filter(a,function(a){return"BB"===a.lob}),a&&a.length>0&&(this.set("productOrderItemID",a[0].productOrderItemID),this.getAddons())),this.set("premiumAddonVmStatus","initialize")},getAddons:function(){var a=this,b=a.getProductConfigurationPayload(),c=a.subViewModels.updateProductConfigurationViewModel._retrieveProductConfiguration("BB",b);c.done(function(b){"undefined"!=typeof b.RetrieveProductInOrderConfigurationResponse&&a.onRetrieveProductConfig(b.RetrieveProductInOrderConfigurationResponse)}.bind(a)),c.fail(function(b){a.set("premiumAddonVmStatus","failure")}.bind(a))},getProductConfigurationPayload:function(){var a={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return a},onRetrieveProductConfig:function(a){var c=this,d=a.productConfiguration.displayableItems,e=[];d&&d.length>0&&b.each(d,function(a){if("8704182"===a.productSpecContainmentID){c.set("premiumAddonProductId",a.productID);var d=a.displayableSimpleProductReferences;if(d&&d.length>0){var f=d.length;b.each(d,function(b){"8704172"===b.productSpecContainmentID&&(1===f&&(b.allowedActions=a.allowedActions),e.push(b))})}}});var f={spsAddons:e};c.set("previousAddons",f),c.set("premiumAddonVmStatus","DataLoaded")},saveSelectedAddon:function(){var a=this;a.set("premiumAddonVmStatus","saveSelectedAddon");var c=a.get("productOrderItemID"),d=this.createPayload(c),e=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("BB",d,c);e.done(function(c){if("undefined"!=typeof c.UpdateProductInOrderConfigurationResponse){var d=c.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===d.compatibilityStatus){var e=[];b.each(d.messages,function(a){"ERROR"===a.severity&&e.push(a.text)}),a.set("blockingMessages",e),a.set("premiumAddonVmStatus","failure")}else{var f=c.UpdateProductInOrderConfigurationResponse.productOrderItemID,g=a.subViewModels.orderInContextTopicViewModel.get("promoOrderActions");g&&g.length>0&&(g=b.without(g,f),a.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",g)),a.set("premiumAddonVmStatus","addonDataUpdated")}}else a.set("premiumAddonVmStatus","failure")}.bind(a)),e.fail(function(b){a.set("premiumAddonVmStatus","failure")}.bind(a))},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},createPayload:function(a){var b=this,c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=b.generateTemporaryId(),l=b.get("selectedPremiumAddon");if("add"===l.actionType){var m=b.get("premiumAddonProductId");"undefined"!=typeof m&&null!==m||e.push({productSpecContainmentID:"8704182",temporaryID:k});var n=l.selectedAddon.selectedMonthlySubscription||"1";n=Number(n);var o,p=l.selectedAddon.originalCount||0;for(o=0;o<n-p;o++){var q={productSpecContainmentID:"8704172",temporaryID:b.generateTemporaryId(),simpleProductSpecID:l.addonId,parentProductSpecContainmentID:"8704182",parentProductID:m};"monthlyTopup"===l.selectedPayment?q.changedCharacteristics=[{characteristicID:13897781,value:"Instalments"}]:q.changedCharacteristics=[{characteristicID:13897781,value:"Upfront"}],"undefined"!=typeof m&&null!==m||(q.parentTemporaryID=k),g.push(q)}}else if(l.addonId)i.push({billingOfferID:l.billingOfferID,productSpecPricingID:l.productSpecPricingID});else{var r=b.get("previousAddons");r&&r.spsAddons&&1===r.spsAddons.length&&c.push({productID:l.parentProductID}),c.push({productID:l.productID})}var s={removedContainedProducts:c,changedContainedProducts:d,suspendedContainedProducts:[],changedSimpleProducts:j,newAssignedBillingOffers:f,newContainedProducts:e,newSimpleProducts:g,removedSimpleProducts:h,removedAssignedBillingOffers:i,resumedContainedProducts:[]},t={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[s],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return t}});return e});
define("businesswidget/repository_l9_common/common/viewmodel/business/ProductConfigurationViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/GetPromoDataViewModel","moment","businesswidget/repository_l9_common/common/viewmodel/business/ChargeableEmailViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=a.Core.ObservableViewModel.extend({defaults:{customerId:null,productOrderID:null,isAllAddonsDisplayed:null,productConfigurationVmStatus:null,addOnOrderDetails:null,updatedAddOn:null,addonToRemove:null,actionType:null,lobs:null,simProductId:null,simAdded:!1,currentOrderActions:null,productOrderItemId:null,tvContentPacks:null,mobileContentPacks:null,selectedContentPack:null,blockingMessages:null,updateOrderDetails:null,bbUserNames:[],addedUserNames:[],specialAddons:null,alcarteProductId:null,orderProductConfigurationInput:null,aemAddons:null,deviceCareBOs:[],contractInsideContractCompCatlogId:["11306751","12351991"],contractCompCatlogId:["14433131","12351811"],promoOrderDetails:[],planId:null,finalDiscount:null,specialDiscounts:null,aemAddonIds:null,finalAemAddons:[],resetChargableEmailData:!1,isFreeBOProductPresent:!1,dataX2ObjDetails:[],dataX2BOs:["71194666","15154616","11417061","15154606","11417051","15154596","11417041","15154586","11417031","15154626","11417071"],deviceBenefits:[]},models:{customerUPCModel:g,anonymousUPCModel:h,customerRPCModel:e,anonymousRPCModel:f},subViewModels:{orderInContextTopicViewModel:d,shoppingCartViewModel:i,clearContextInContextTopic:j,getCustomerIdValueViewModel:k,deviceIdAndPlanIdInContextTopic:l,getPromoDataViewModel:m,chargeableEmailViewModel:o},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{productOrderID:"subViewModels.orderInContextTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0}},{currentOrderActions:"subViewModels.orderInContextTopicViewModel.currentOrderActions",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"retrieveProductConfiguration","getProductConfigurationPayload","onFetchRetrieveProductConfigurationSuccess","loadDisplayableItems","loadBillingOffers","onUpdateProductConfigurationSuccess","populateAddRemoveButton","generateTemporaryId","setHeaders","setDefaultQueryParams","getBillingOfferToBeAdded","onUpdateSimSuccess","getProductConfigurationInput","onProductConfigurationError","updateSimComponent","callUpdateOrder","getCharacteristics","populateCharacteristics","getCharacteristicValue","setBillingOffersForRemove","setDefaultDeviceCare","setBillingOffersForAdd","onUpdateOrderToRunRulesError","updateOrderToRunRules","populateMobileContents","setAemAddons","updateInputPayload"),this.set("isAllAddonsDisplayed",!1);var b=this;setTimeout(function(){b.set("currentOrderActions",b.subViewModels.orderInContextTopicViewModel.get("currentOrderActions")),b.set("productConfigurationVmStatus","VMInitialized")},0)},setAemAddons:function(){var a=this;setTimeout(function(){var b=a.get("deviceCareBOs"),d=a.get("aemAddonIds")&&a.get("aemAddonIds").allMobileSwopIds;c.each(d,function(a){b.push({name:"MobileSwop",id:a})}),a.set("deviceCareBOs",b),console.log(b)}.bind(a),0),a.retrieveProductConfiguration()},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},updateSimComponent:function(){var a=this,b=this.get("simProductId");if(a.set("productConfigurationVmStatus","updateSimComponent"),b){this.initializeOrderingFlow();var d=a.getProductConfigurationInput(b,a.get("productOrderItemId")),e=a.get("customerId"),f=a.subViewModels.orderInContextTopicViewModel.get("orderActions");if(e){var g=a.getModel("customerUPCModel");g.set({customerId:e,productOrderItemId:a.get("productOrderItemId")}),a.setHeaders(g),a.setDefaultQueryParams(g),g.setQueryParams({rp:a.get("retrievePricing")||!1,rpc:a.get("retrieveComponentPricing")||!1}),g.save({UpdateProductInOrderConfigurationRequest:d},{success:function(b,c){a.updateOrderToRunRules(f)},error:c.bind(a.onProductConfigurationError,a,!0)})}else{var h=a.getModel("anonymousUPCModel");h.set({productOrderItemId:a.get("productOrderItemId")}),a.setHeaders(h),a.setDefaultQueryParams(h),h.setQueryParams({rp:!1,rpc:!1}),h.save({UpdateProductInOrderConfigurationRequest:d},{success:function(b,c){a.updateOrderToRunRules(f)},error:c.bind(a.onProductConfigurationError,a,!0)})}}},onUpdateSimSuccess:function(){this.set("productConfigurationVmStatus","SimAddedSuccess")},getBillingOfferToBeAdded:function(a,b,d,e){return!e&&c.contains(d,a.productSpecContainmentID)||"undefined"==typeof a.productID||null===a.productID?billingOfferToBeAdded={productSpecPricingID:a.productSpecPricingID,parentProductSpecContainmentID:a.productSpecContainmentID,parentTemporaryID:b}:billingOfferToBeAdded={productSpecPricingID:a.productSpecPricingID,parentProductID:a.productID,parentProductSpecContainmentID:a.productSpecContainmentID},billingOfferToBeAdded},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},populateMobileContents:function(a,b,d){var e=[];a&&c.each(a,function(a){if(a.selected&&"10141011"===a.productSpecContainmentID){a.sales=!0,a.productOrderItemId=d;var f=a.displayableCharacteristics;f&&f.length>0&&c.find(f,function(b){if("10048781"===b.productSpecCharacteristicID)return"undefined"!=typeof a.totalRecurringCalculatedPrice&&null!==a.totalRecurringCalculatedPrice||(a.totalRecurringCalculatedPrice={}),a.totalRecurringCalculatedPrice.finalAmountIncludingTax=b.value,!0}),b.push(a.simpleProductSpecID),e.push(a)}}),this.set("mobileContentPacks",e)},initializeOrderingFlow:function(){this.setOrderProductConfigurationInput(null)},setOrderProductConfigurationInput:function(a){this.set("orderProductConfigurationInput",a)},getOrderProductConfigurationInput:function(){var a=this.get("orderProductConfigurationInput");return a||(a={removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}),a},getProductConfigurationInput:function(a,b){var d,e=this.getOrderProductConfigurationInput(),f=this,g=(this.generateTemporaryId(),this.get("actionType")),h=this.get("updatedAddOn"),i=f.generateTemporaryId(),j=f.get("selectedContentPack"),k=!0;if(a){var l={productID:a,changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:"8858992",value:null},{characteristicID:8022652,value:"3IN1"},{characteristicID:132395,value:null}]};e.changedContainedProducts.push(l),k=!0,d="WS"}else if(j){if("undefined"==typeof j.productID||null===j.productID){if("alacarte"===j.baseType){var m=f.get("alcarteProductId");"undefined"!=typeof m&&null!==m||e.newContainedProducts.push({productSpecContainmentID:"8635152",temporaryID:i}),e.newSimpleProducts.push({productSpecContainmentID:"8635142",temporaryID:i,simpleProductSpecID:j.packType,parentProductSpecContainmentID:"8635152",parentProductID:m})}else if("mobileContent"===j.baseType){var n={temporaryID:i,productSpecContainmentID:"10141011",simpleProductSpecID:j.simpleProductSpecID||j.productSpecContainmentID,parentProductID:j.parentProductID};e.newSimpleProducts.push(n)}else e.newSimpleProducts.push({businessType:"TV_PACKAGE",simpleProductSpecID:j.packType,temporaryID:i});if(j.discountItem){var o=!0;"8635142"!==j.discountItem.productSpecContainmentID&&"8635122"!==j.discountItem.productSpecContainmentID&&(i=f.generateTemporaryId(),o=!1);var i=f.generateTemporaryId();this.setBillingOffersForAdd(j.discountItem,i,g,e.newContainedProducts,e.newAssignedBillingOffers,!0,o,b)}}else if("mobileContent"===j.baseType){if(e.removedContainedProducts.push({productID:j.productID}),j.discountItem){var i=f.generateTemporaryId();this.setBillingOffersForRemove(j.discountItem,g,e.removedContainedProducts,e.removedAssignedBillingOffers,!0)}}else{var p=f.get("tvContentPacks"),q=c.groupBy(p,"parentProductID");if(c.map(q,function(a,b){j.parentProductID===b&&(1===a.length?e.removedContainedProducts.push({productID:j.parentProductID}):e.removedContainedProducts.push({productID:j.productID}))}),j.discountItem){var i=f.generateTemporaryId();this.setBillingOffersForRemove(j.discountItem,g,e.removedContainedProducts,e.removedAssignedBillingOffers,!0)}}d="mobileContent"===j.baseType?"WS":"TV"}else if("add"===g.actionFired){var r;if(r=h.selectBillingOffer?h.selectBillingOffer:h,this.setBillingOffersForAdd(r,i,g,e.newContainedProducts,e.newAssignedBillingOffers,!1,!1,b),h.discountItem){var o=!0;r.productSpecContainmentID!==h.discountItem.productSpecContainmentID&&(i=f.generateTemporaryId(),o=!1),this.setBillingOffersForAdd(h.discountItem,i,g,e.newContainedProducts,e.newAssignedBillingOffers,!0,o,b)}if(r.specialAddon){var s=this.get("specialAddons");s&&e.changedContainedProducts.push({productID:s.productID,changedCharacteristics:[{characteristicID:s.decisionIndiatorId,value:"Yes"}]})}if("BB"===r.lob){var t=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if(t&&t.productID&&r.addonId===t.paidBOID){var u=this.subViewModels.chargeableEmailViewModel.updatePayload(t.freeBOIDs,r.addonId,b);e.removedAssignedBillingOffers=e.removedAssignedBillingOffers.concat(u.removedAssignedBillingOffers)}}d=r.lob}else if("remove"===g.actionFired){var r;if(r=h.selectBillingOffer?h.selectBillingOffer:h,this.setBillingOffersForRemove(r,g,e.removedContainedProducts,e.removedAssignedBillingOffers,!1),h.discountItem){var i=f.generateTemporaryId();this.setBillingOffersForRemove(h.discountItem,g,e.removedContainedProducts,e.removedAssignedBillingOffers,!0)}if(r.specialAddon){var s=this.get("specialAddons");s&&e.changedContainedProducts.push({productID:s.productID,changedCharacteristics:[{characteristicID:s.decisionIndiatorId,value:"No"}]})}d=r.lob}this.setOrderProductConfigurationInput(e);var v=e,u={runCompatibilityRules:k,activityForConfiguration:"SD Add Comp Stage",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[v],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return u},populateAddRemoveButton:function(a){var b=this.get("aemAddonIds"),d=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");if(d&&d.freeEmailIdFlag&&b.chargeableEmail&&(c.contains(b.chargeableEmail.freeBillingOfferList,a.addonId)||b.chargeableEmail.chargeableBoId===a.addonId)&&d&&d.productID===a.productID){var e=d.freeBOIDs||[];if(b.chargeableEmail.chargeableBoId===a.addonId)if(d.paidBOID=a.addonId,d.paidPricingID=a.productSpecPricingID,a.selected)d.billingOfferID=a.billingOfferID;else{if(a.appendUserName=!0,a.characteristics)var f=!1,g=c.filter(a.characteristics,function(a){if("8622872"===a.productSpecCharacteristicID&&a.value&&!c.contains(["NA","N","No"],a.value))f=!0;else if("8622642"===a.productSpecCharacteristicID&&a.value)return!0});f&&g.length>0&&(a.primaryEmailId=g[0].value)}else if(b.chargeableEmail.freeBillingOfferList&&c.contains(b.chargeableEmail.freeBillingOfferList,a.addonId)){var h=!1;c.find(e,function(b){if(b.freeBOID===a.addonId)return b.freePricingID=a.productSpecPricingID,b.billingOfferID=a.billingOfferID,h=!0,!0}),h||e.push({freeBOID:a.addonId,freePricingID:a.productSpecPricingID,billingOfferID:a.billingOfferID}),this.set("isFreeBOProductPresent",!0)}d.freeBOIDs=e,this.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",d)}"undefined"!=typeof a.allowedActions&&c.each(a.allowedActions,function(b){"undefined"!=typeof a.billingOfferID?"AD"!==b.type&&"RM"!==b.type||("AD"===b.type&&b.allowed?(a.isAddButton=!0,a.isAddButtonDisabled=!1):"RM"===b.type&&b.allowed&&(a.isRemoveButton=!0,a.isRemoveButtonDisabled=!1)):"AD"===b.type&&b.allowed&&(a.isAddButton=!0,a.isAddButtonDisabled=!1)})},loadDisplayableItems:function(a,b,d,e,f,g,h,i,j){var k,l=this,m=[],n=j.selectedAddonIds||[],o=!1;if(h===!1&&("WS"===e?k={productSpecId:"8363682",characteristicId:"12373531",decisionIndiatorId:"12373511"}:"BB"===e&&(k={productSpecId:"8625612",characteristicId:"12373531",decisionIndiatorId:"12373511"}),k)){var p=c.find(f,function(a){var b=!1;if(a.productSpecContainmentID===k.productSpecId){k.productID=a.productID,l.set("specialAddons",k);var d=c.find(a.displayableCharacteristics,function(a){return a.productSpecCharacteristicID===k.characteristicId&&"Yes"===a.value});d&&(b=!0)}return b});p&&(o=!0)}if(l.loadBillingOffers(b,d,e,f,g,m,o,h,i,n),b&&b.length>0){var q=l.get("addOnOrderDetails")||[];q=q.concat(b);var r=l.get("aemAddons");if(r&&r.length>0){var s=[];c.each(r,function(a){if(a.subGroups&&a.subGroups.length>0)c.each(a.subGroups,function(a){var b=c.filter(q,function(b){return b.addonId===a.productSpecContainmentID});s=s.concat(b)});else{var b=c.filter(q,function(b){return b.addonId===a.productSpecContainmentID});s=s.concat(b)}});var t=c.filter(t,function(a){return("undefined"==typeof a.action||null===a.action||"UP"===a.action)&&a.billingOfferID&&!c.contains(myAddonOfferIDs,a.billingOfferID)&&(a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmountIncludingTax>0||a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmountIncludingTax>0)&&"STB"!==a.productSpecName&&"10797291"!==a.productSpecContainmentID&&"8861282"!==a.productSpecContainmentID&&"8861282"!==a.productSpecContainmentID&&"8363712"!==a.productSpecContainmentID});t=c.uniq(t.concat(s)),l.set("addOnOrderDetails",t)}else l.set("addOnOrderDetails",q)}if(g&&g.length>0){var u=l.get("tvContentPacks")||[];u=u.concat(g),l.set("tvContentPacks",u)}j.selectedAddonIds=n;var v=l.get("aemAddonIds"),w=[],x=l.get("finalAemAddons");if("WS"===e?(v.wsFeaturedAddOnIds&&(w=w.concat(v.wsFeaturedAddOnIds)),v.wsGeneralAddOnIds&&(w=w.concat(v.wsGeneralAddOnIds)),v.groupMobileContentPackIds&&(w=w.concat(v.groupMobileContentPackIds))):"TV"===e?(v.tvFeaturedAddOnIds&&(w=w.concat(v.tvFeaturedAddOnIds)),v.tvGeneralAddOnIds&&(w=w.concat(v.tvGeneralAddOnIds)),v.featuredContentPackIds&&(w=w.concat(v.featuredContentPackIds)),v.generalContentPackIds&&(w=w.concat(v.generalContentPackIds))):"BB"===e?(v.bbFeaturedAddOnIds&&(w=w.concat(v.bbFeaturedAddOnIds)),v.bbGeneralAddOnIds&&(w=w.concat(v.bbGeneralAddOnIds))):"FV"===e&&(v.fvFeaturedAddOnIds&&(w=w.concat(v.fvFeaturedAddOnIds)),v.fvGeneralAddOnIds&&(w=w.concat(v.fvGeneralAddOnIds))),w&&w.length>0){var y=l.subViewModels.getPromoDataViewModel.getPromoData(j,w);y.done(function(b){if(b.ImplPromoDisplayResponse&&b.ImplPromoDisplayResponse.implPromoDisplayItemList&&b.ImplPromoDisplayResponse.implPromoDisplayItemList.length>0){var d=b.ImplPromoDisplayResponse.implPromoDisplayItemList;c.each(w,function(a){var b=c.find(d,function(b){return b.promoId===a&&b.promoDescription});b&&x.push({addonId:b.promoId,promotionText:b.promoDescription})}),l.set("finalAemAddons",x)}a.resolve()}.bind(l))}else a.resolve()},populateCharacteristics:function(a){var b=[];if(a.oldcharacteristics&&a.oldcharacteristics.length){for(var c=0;c<a.oldcharacteristics.length;c++){var d=a.oldcharacteristics[c];if(d.displayInformation.enabled){var e=this.getCharacteristicValue(d);b.push({characteristicID:d.productSpecCharacteristicID,value:e})}}"8625582"===a.productSpecContainmentID&&b.push({characteristicID:"8622872",value:"No"})}return b},getCharacteristicValue:function(a){var b=a.value;if(b)switch(a.productSpecCharacteristic.valueBasicType){case"DATE":var c=b.split("-");b=Date.UTC(c[2],parseInt(c[1])-1,c[0]);break;case"INTEGER":b=parseFloat(b,10)}return b},loadBillingOffers:function(a,b,d,e,f,g,h,i,j,k){var l=this,m=l.get("aemAddonIds")&&l.get("aemAddonIds").mobileSwopAddonBOIds,o=c.groupBy(e,"productSpecContainmentID");o&&c.map(o,function(e,o){if(e){var p=e.length,q=[];if("8472632"==o&&p>=2){var r=[],s=[],t=!1,u=null;c.each(e,function(a){var b=c.find(a.displayableCharacteristics,function(a){return 8242==a.productSpecCharacteristicID});b&&b.value&&!n().isAfter(n(b.value-0),"day")?(u=a,t=!0):s.push(a),c.each(a.displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema.id&&c.contains(j.benefitValues,a.productSpecPricing.childPricingSchema.id)&&t&&r.push(a)})}),r.length>0&&t&&l.setDefaultDeviceCare(u,r,a,g,k,b,d,p),e=s}if(p>1){if("8625582"===o){var v=!1;if(e=c.sortBy(e,function(a){var b=c.find(a.displayableCharacteristics,function(a){return"8622872"===a.productSpecCharacteristicID&&"Yes"===a.value});return b?(v=!0,1):2}),!v){var w=l.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");w&&w.productID&&(e=c.sortBy(e,function(a){var b=a.productID===w.productID;return b?1:2}))}}c.each(e,function(e){var f=!0;if("WS"===d&&e.productSpecContainment&&e.productSpecContainment.containedProduct&&"Mobile_Content_Service"===e.productSpecContainment.containedProduct.code&&(f=!1),f){var h=l.getCharacteristics(e);q=c.filter(e.displayableBillingOffers,function(c){if(c.selected){c.productOrderItemId=b,c.selectedComponent=p,c.maximumQuantity=e.productSpecContainment.maximumQuantity,c.addonId=c.productSpecPricing.childPricingSchema.id,c.productSpecContainmentID=e.productSpecContainmentID;var f=!1;i===!1&&"WS"===d&&"11982"===e.productSpecContainmentID?f=!0:i!==!1||"BB"!==d||"14396101"!==e.productSpecContainmentID&&"14396081"!==e.productSpecContainmentID&&"Internet Filter"!==e.name||(f=!0),c.specialAddon=f,c.productID=e.productID,c.lob=d,"8472632"==e.productSpecContainmentID&&(c.rcCost=e.totalRecurringCalculatedPrice),c.productSpecName=e.name,c.sales=!0;return c.recurringCalculatedPrices&&c.recurringCalculatedPrices.length>0&&c.recurringCalculatedPrices[0]&&c.recurringCalculatedPrices[0].description?c.productTitle=c.recurringCalculatedPrices[0].description:c.productTitle=c.name,c.parentProductSpecContainmentID=e.parentProductSpecContainmentID,c.parentProductID=e.parentProductID,c.characteristics=h,l.populateAddRemoveButton(c),a.push(c),g.push(c.productSpecPricingID),"AD"===c.action&&k.push(c.addonId),!0}return!1})}})}if(c.each(e,function(e){if("BB"===d&&("8625582"===e.productSpecContainmentID||"8625612"===e.productSpecContainmentID)){var m=l.get("bbUserNames"),o=l.get("addedUserNames")||[],q={};c.each(e.displayableCharacteristics,function(a){"8625582"===e.productSpecContainmentID?"8622642"===a.productSpecCharacteristicID&&a.value&&!c.contains(o,a.value)?(q.valueForDisplay=a.value,q.value=a.value):"8622872"===a.productSpecCharacteristicID&&a.value&&"Yes"===a.value&&(q.primaryIndicator=!0):"8625612"===e.productSpecContainmentID&&"8640392"===a.productSpecCharacteristicID&&a.value&&!c.contains(o,a.value)&&(q.valueForDisplay=a.value,q.value=a.value,q.primaryIndicator=!0)}),q.value&&(o.push(q.value),m.push(q)),l.set("bbUserNames",m),l.set("addedUserNames",o)}if("TV"!==d||"8635132"!==e.productSpecContainmentID&&"8635152"!==e.productSpecContainmentID)if("WS"===d&&"8363722"===e.productSpecContainmentID){var r=c.filter(e.displayableBillingOffers,function(a){return"SIM Card Fee"===a.name&&a.selected});r&&r.length>0&&(l.set("simAdded",!0),l.set("productOrderItemId",b)),l.set("simProductId",e.productID),l.set("productOrderItemId",b)}else{var s=!0;if("WS"===d&&e.productSpecContainment&&e.productSpecContainment.containedProduct&&"Mobile_Content_Service"===e.productSpecContainment.containedProduct.code&&(s=!1),s){var t=l.getCharacteristics(e),r=[];if("WS"===d&&"8363712"===e.productSpecContainmentID&&e.displayableItems&&c.each(e.displayableItems,function(a){"11782"===a.productSpecContainmentID&&c.each(a.displayableCharacteristics,function(a){if("8430382"===a.productSpecCharacteristicID){var b=a.value;l.set("planId",b)}})}),i===!1&&("WS"===d&&"11982"===e.productSpecContainmentID||"BB"===d&&("14396101"===e.productSpecContainmentID||"14396081"===e.productSpecContainmentID||"Internet Filter"===e.name))){var u=c.find(e.displayableBillingOffers,function(a){return"12357521"===a.productSpecPricing.childPricingSchema.id||"14652366"===a.productSpecPricing.childPricingSchema.id||"12357531"===a.productSpecPricing.childPricingSchema.id}),v=c.filter(e.displayableBillingOffers,function(a){return"12357521"!==a.productSpecPricing.childPricingSchema.id&&"14652366"!==a.productSpecPricing.childPricingSchema.id&&"12357531"!==a.productSpecPricing.childPricingSchema.id});h?u&&u.selected?r.push(u):v&&v.length>0&&(r=v):u&&r.push(u)}else if(j&&j.benefitValues&&"WS"===d&&"8472632"===e.productSpecContainmentID&&e.displayableBillingOffers&&e.displayableBillingOffers.length>0&&p>1){var w=!1,x=c.find(e.displayableCharacteristics,function(a){return 8242==a.productSpecCharacteristicID});x&&x.value&&!n().isAfter(n(x.value-0),"day")&&(w=!0),c.each(e.displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema.id&&c.contains(j.benefitValues,a.productSpecPricing.childPricingSchema.id)&&w&&r.push(a)})}else j&&j.benefitValues&&"WS"===d&&("8472632"===e.productSpecContainmentID||"8472832"===e.productSpecContainmentID||"19086291"===e.productSpecContainmentID||"Apple Care"===e.name)&&e.displayableBillingOffers&&e.displayableBillingOffers.length>0?c.each(e.displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema.id&&c.contains(j.benefitValues,a.productSpecPricing.childPricingSchema.id)&&r.push(a)}):e.displayableBillingOffers&&e.displayableBillingOffers.length>0&&(r=e.displayableBillingOffers);c.each(r,function(f){if(!c.contains(g,f.productSpecPricingID)){f.productOrderItemId=b,f.addonId=f.productSpecPricing.childPricingSchema.id,f.productID=e.productID,f.lob=d,f.productSpecName=e.name,f.sales=!0,f.productSpecContainmentID=e.productSpecContainmentID;var h=!1;"WS"===d&&"11982"===e.productSpecContainmentID?h=!0:"BB"!==d||"14396101"!==e.productSpecContainmentID&&"14396081"!==e.productSpecContainmentID&&"Internet Filter"!==e.name||(h=!0),f.recurringCalculatedPrices&&f.recurringCalculatedPrices.length>0&&f.recurringCalculatedPrices[0]&&f.recurringCalculatedPrices[0].description?f.productTitle=f.recurringCalculatedPrices[0].description:f.name&&(f.productTitle=f.name),f.specialAddon=h,f.selectedComponent=p,f.maximumQuantity=e.productSpecContainment.maximumQuantity,f.parentProductSpecContainmentID=e.parentProductSpecContainmentID,f.parentProductID=e.parentProductID,"8472632"==e.productSpecContainmentID&&(f.rcCost=e.totalRecurringCalculatedPrice),f.characteristics=t,l.populateAddRemoveButton(f),a.push(f),g.push(f.productSpecPricingID),f.selected&&"AD"===f.action&&k.push(f.addonId)}}),e.displayableSimpleProductReferences&&e.displayableSimpleProductReferences.length>0&&c.each(e.displayableSimpleProductReferences,function(a){a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(a){a.selected&&"AD"===a.action&&k.push(a.productSpecPricing.childPricingSchema.id)})}),e.displayableItems&&e.displayableItems.length>0&&l.loadBillingOffers(a,b,d,e.displayableItems,f,g,h,i,j,k)}}else"8635152"===e.productSpecContainmentID&&e.productID&&l.set("alcarteProductId",e.productID),c.each(e.displayableSimpleProductReferences,function(a){"TV_PACKAGE"!==a.businessType&&"8635142"!==a.productSpecContainmentID||!a.productID||f.push(a),a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(a){a.selected&&"AD"===a.action&&k.push(a.productSpecPricing.childPricingSchema.id)})})}),"8472632"==o&&"WS"==d&&m&&m.length>0&&p>1){var r=[],x=e[0],y=l.getCharacteristics(x);x&&c.each(x.displayableBillingOffers,function(a){a.productSpecPricing&&a.productSpecPricing.childPricingSchema.id&&c.contains(j.benefitValues,a.productSpecPricing.childPricingSchema.id)&&r.push(a)}),c.each(r,function(e){if(!c.contains(g,e.productSpecPricingID)){e.productOrderItemId=b,e.addonId=e.productSpecPricing.childPricingSchema.id,e.lob=d,e.productSpecName=x.name,e.sales=!0,e.productSpecContainmentID=x.productSpecContainmentID;var f=!1;"WS"===d&&"11982"===x.productSpecContainmentID?f=!0:"BB"!==d||"14396101"!==x.productSpecContainmentID&&"14396081"!==x.productSpecContainmentID&&"Internet Filter"!==x.name||(f=!0),
e.recurringCalculatedPrices&&e.recurringCalculatedPrices.length>0&&e.recurringCalculatedPrices[0]&&e.recurringCalculatedPrices[0].description?e.productTitle=e.recurringCalculatedPrices[0].description:e.name&&(e.productTitle=e.name),e.specialAddon=f,e.selectedComponent=p,e.maximumQuantity=x.productSpecContainment.maximumQuantity,e.parentProductSpecContainmentID=x.parentProductSpecContainmentID,e.parentProductID=x.parentProductID,"8472632"==x.productSpecContainmentID&&(e.rcCost=x.totalRecurringCalculatedPrice),e.characteristics=y,l.populateAddRemoveButton(e),a.push(e),g.push(e.productSpecPricingID),e.selected&&"AD"===e.action&&k.push(e.addonId)}})}}})},setDefaultDeviceCare:function(a,b,d,e,f,g,h,i){var j=this,k=j.getCharacteristics(a);c.each(b,function(b){if(b.productSpecPricingID){b.productOrderItemId=g,b.addonId=b.productSpecPricing.childPricingSchema.id,b.productID=a.productID,b.lob=h,b.productSpecName=a.name,b.sales=!0,b.productSpecContainmentID=a.productSpecContainmentID;var c=!1;"WS"===h&&"11982"===a.productSpecContainmentID?c=!0:"BB"!==h||"14396101"!==a.productSpecContainmentID&&"14396081"!==a.productSpecContainmentID&&"Internet Filter"!==a.name||(c=!0),b.recurringCalculatedPrices&&b.recurringCalculatedPrices.length>0&&b.recurringCalculatedPrices[0]&&b.recurringCalculatedPrices[0].description?b.productTitle=b.recurringCalculatedPrices[0].description:b.name&&(b.productTitle=b.name),b.specialAddon=c,b.selectedComponent=i,b.maximumQuantity=a.productSpecContainment.maximumQuantity,b.parentProductSpecContainmentID=a.parentProductSpecContainmentID,b.parentProductID=a.parentProductID,"8472632"==a.productSpecContainmentID&&(b.rcCost=a.totalRecurringCalculatedPrice),b.characteristics=k,j.populateAddRemoveButton(b),d.push(b),e.push(b.productSpecPricingID),b.selected&&"AD"===b.action&&f.push(b.addonId)}})},onFetchRetrieveProductConfigurationSuccess:function(a,d,e,f,g,h,i,j){var k=this,l={};if(l.customerType="public",l.productOrderItemId=e,"FV"===i.RetrieveProductInOrderConfigurationResponse.productConfiguration.lineOfBusiness&&"CH"===i.RetrieveProductInOrderConfigurationResponse.productOrderItemType)a.resolve();else{var m,n=b.get("relaxInternetFilter"),o=!1,p=k.get("deviceBenefits");if("WS"===f){c.find(i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems,function(a){var b=!1;return("Data X"===a.name||"14438091"===a.productSpecContainmentID)&&a.selected&&a.displayableBillingOffers?c.each(a.displayableBillingOffers,function(b){if(b.selected&&b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&b.productSpecPricing.childPricingSchema.description&&(b.productSpecPricing.childPricingSchema.description.toUpperCase().indexOf("DATAXINFINITY")>-1||b.productSpecPricing.childPricingSchema.description.toUpperCase().indexOf("DATAX3")>-1)&&(b.productSpecPricing.childPricingSchema.description.toUpperCase().indexOf("DATAXINFINITY")>-1?l.dataXinfinity=!0:b.productSpecPricing.childPricingSchema.description.toUpperCase().indexOf("DATAX3")>-1&&(l.dataX3=!0)),"CH"===i.RetrieveProductInOrderConfigurationResponse.productOrderItemType&&b.selected&&b.productSpecPricing&&b.productSpecPricing.childPricingSchema&&(c.contains(k.get("dataX2BOs"),b.productSpecPricing.childPricingSchema.id)||b.productSpecPricing.childPricingSchema.description&&b.productSpecPricing.childPricingSchema.description.toUpperCase().indexOf("DATA X 2")>-1)){var d={orderItemId:i.RetrieveProductInOrderConfigurationResponse.productOrderItemID,productID:a.productID,productSpecContainmentID:a.productSpecContainmentID},e=k.get("dataX2ObjDetails");e.push(d),k.set("dataX2ObjDetails",e)}}):"8363682"===a.productSpecContainmentID&&a.selected?c.find(a.displayableCharacteristics,function(a){if("8469052"===a.productSpecCharacteristicID)return l.ciTier=a.value,!0}):!a.selected||"10482"!==a.productSpecContainmentID&&"Device Information"!==a.name?a.selected&&"11812"===a.productSpecContainmentID?o=!0:a.selected&&"11822"===a.productSpecContainmentID?l.customerType="staff":a.selected&&"11762"===a.productSpecContainmentID&&(l.customerType="cis"):a.displayableSimpleProductReferences&&c.find(a.displayableSimpleProductReferences,function(a){if("DEVICE"===a.businessType&&"AD"===a.action&&a.displayableCharacteristics){m={deviceType:null,specId:null,model:null,benefitValues:[]};var b=!1,d=!1;return c.find(a.displayableCharacteristics,function(a){if("8822"===a.productSpecCharacteristicID?(m.specId=a.value,d=!0):"8852"===a.productSpecCharacteristicID&&(m.model=a.value,b=!0),b&&d)return!0}),c.each(a.displayableCharacteristics,function(a){if("8607542"===a.productSpecCharacteristicID){var b=a.value.split(";");if(b&&b.length>0){var d=k.get("deviceCareBOs");c.each(b,function(a){c.each(d,function(b){b.name===a&&m.model&&m.specId&&("undefined"==typeof b.specIds||null===b.specIds||c.contains(b.specIds,m.model)||c.contains(b.specIds,m.specId))&&m.benefitValues.push(b.id)})})}}else"9012912"===a.productSpecCharacteristicID?(m.deviceType=a.value,a.value&&a.value.toUpperCase().indexOf("TABLET")>-1?l.deviceType="Tablet":l.deviceType="Mobile"):"8852"===a.productSpecCharacteristicID?(m.model=a.value,l.model=a.value,p.push(m)):"8842"===a.productSpecCharacteristicID&&(l.brand=a.value)}),k.set("deviceBenefits",p),!0}}),b});var q=[];i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableSimpleProductReferences&&i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableSimpleProductReferences.length>0&&k.populateMobileContents(i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableSimpleProductReferences,q,e),l.selectedAddonIds=q,l.planCode=i.RetrieveProductInOrderConfigurationResponse.productConfiguration.productOffering.code,l.productOffer=i.RetrieveProductInOrderConfigurationResponse.productConfiguration.rootProductOfferingID,l.updatePromo=!0}else"TV"===f?c.find(i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems,function(a){if("8635162"===a.productSpecContainmentID&&a.selected)return l.customerType="staff",!0}):"FV"===f?c.find(i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems,function(a){if("8613592"===a.productSpecContainmentID&&a.selected)return c.find(a.displayableCharacteristics,function(a){if("8363382"===a.productSpecCharacteristicID&&"Staff"===a.value)return l.customerType="staff",!0}),!0}):"BB"===f&&(l.customerType=k.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType"));var r=null;"CH"===i.RetrieveProductInOrderConfigurationResponse.productOrderItemType?r="recon":"PR"===i.RetrieveProductInOrderConfigurationResponse.productOrderItemType?r=o?"port-in":"new":"CW"===i.RetrieveProductInOrderConfigurationResponse.productOrderItemType&&(r="new"),l.transactionType=r;var s=i.RetrieveProductInOrderConfigurationResponse.productConfiguration.rootProductOfferingID;l.productOffer=s;var t=i.RetrieveProductInOrderConfigurationResponse.productConfiguration.displayableItems;console.log(t.length);var u=k.get("aemAddonIds");c.each(t,function(a){a.productSpecContainmentID==u.deviceCareCatalogId&&"Device Care"==a.name&&a.selected&&a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.currency&&(u.deviceCareAddons=u.deviceCareAddons.concat(a),u.deviceCareAddonlength=u.deviceCareAddonlength+1)}),k.set("aemAddonIds",u),k.loadDisplayableItems(a,d,e,f,t,g,n,m,l);var v=k.get("promoOrderDetails");v.push(l),k.set("promoOrderDetails",v)}},onFetchRetrieveProductConfigurationError:function(a,b,c){this.set("productConfigurationVmStatus","restFailed"),a.reject(c)},onUpdateProductConfigurationSuccess:function(a,b,d){var e=this;if(b.UpdateProductInOrderConfigurationResponse&&b.UpdateProductInOrderConfigurationResponse.productConfiguration){var f=b.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===f.compatibilityStatus){var g=[];c.each(f.messages,function(a){"ERROR"===a.severity&&g.push(a.text)}),e.set("blockingMessages",g),e.set("productConfigurationVmStatus","productConfigurationError")}else{var h=b.UpdateProductInOrderConfigurationResponse.productOrderItemID,i=e.subViewModels.orderInContextTopicViewModel.get("promoOrderActions");i&&i.length>0&&(i=c.without(i,h),e.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",i)),e.get("resetChargableEmailData")&&e.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null),e.set("productConfigurationVmStatus","productConfigurationSuccess")}}else e.set("productConfigurationVmStatus","productConfigurationError")},onUpdateProductConfigurationSuccessWithRules:function(a,b,d){var e=this;if(b.UpdateProductInOrderConfigurationResponse&&b.UpdateProductInOrderConfigurationResponse.productConfiguration){var f=b.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===f.compatibilityStatus){var g=[];c.each(f.messages,function(a){"ERROR"===a.severity&&g.push(a.text)}),e.set("blockingMessages",g),e.set("productConfigurationVmStatus","productConfigurationError")}else e.set("productConfigurationVmStatus","productConfigurationSuccess")}else e.set("productConfigurationVmStatus","productConfigurationError")},onProductConfigurationError:function(a,b,c,d){a===!0&&c&&0!==c.status&&this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("productConfigurationVmStatus",""),this.set("productConfigurationVmStatus","productConfigurationError")},retrieveProductConfiguration:function(){var a=this,b=a.getProductConfigurationPayload(),d=a.get("customerId"),e=a.get("productOrderID"),f=(a.get("")||{},[]),g=[];if(e){if(d){var h=a.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");c.each(h,function(e){if(e.lob&&"S"===e.level&&("undefined"==typeof e.isFreeMBB||null===e.isFreeMBB||e.isFreeMBB===!1)){g.push(e.lob);var h=$.Deferred(),i=[],j=[],k=a.getModel("customerRPCModel");k.set({productOrderItemId:e.productOrderItemID,customerId:d}),k.setQueryParams({rp:!1,rpc:!1}),k.set("RetrieveProductInOrderConfigurationRequest",b),a.setHeaders(k),a.setDefaultQueryParams(k),k.fetch({success:c.bind(a.onFetchRetrieveProductConfigurationSuccess,a,h,i,e.productOrderItemID,e.lob,j),error:c.bind(a.onFetchRetrieveProductConfigurationError,a,h)}),f.push(h)}})}else{var h=a.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");c.each(h,function(d){if(d.lob&&"S"===d.level){var e=$.Deferred(),h=[],i=[];g.push(d.lob);var j=a.getModel("anonymousRPCModel");j.set({productOrderItemId:d.productOrderItemID}),j.setQueryParams({rp:!1,rpc:!1}),j.set("RetrieveProductInOrderConfigurationRequest",b),a.setHeaders(j),a.setDefaultQueryParams(j),j.fetch({success:c.bind(a.onFetchRetrieveProductConfigurationSuccess,a,e,h,d.productOrderItemID,d.lob,i),error:c.bind(a.onFetchRetrieveProductConfigurationError,a,e)}),f.push(e)}})}$.when.apply(a,f).done(function(){a.set("lobs",g);var b=a.get("addOnOrderDetails"),d=c.groupBy(b,"parentProductSpecContainmentID");c.each(b,function(a){b.parentProductSpecContainmentID?a.grandParentSpecCount=d[b.parentProductSpecContainmentID].length:a.grandParentSpecCount=0}),b=c.groupBy(b,"lob"),setTimeout(function(){a.set("addOnOrderDetails",b),a.set("productConfigurationVmStatus","DataLoaded")}.bind(a),0)})}else a.set("productConfigurationVmStatus","OrderNotFound")},updateInputPayload:function(a,b,d){var e=c.filter(a,function(a){return a.orderItemId===d});return e&&e.length>0&&c.each(e,function(a){var d=b.productChanges[0].newContainedProducts;if(d&&d.length>0){var e=c.find(d,function(b){return b.productSpecContainmentID===a.productSpecContainmentID});if(e){var f=b.productChanges[0].removedContainedProducts||[],g=!1;f&&f.length>0&&(g=c.find(f,function(b){return b.productID===a.productID})),g||f.push({productID:a.productID}),b.productChanges[0].removedContainedProducts=f}}}),b},config:{actions:{doUpdateProductConfiguration:function(){var a=this;a.set("blockingMessages",null),a.set("productConfigurationVmStatus","updateProductConfiguration"),this.initializeOrderingFlow();var b=a.get("productConfigurationVmStatus");if("maxComponentError"===b)return!1;var d,e=a.get("updatedAddOn"),f=a.get("selectedContentPack");if(f){var g=a.get("currentOrderActions");g=c.filter(g,function(a){return"mobileContent"===f.baseType?"WS"===a.lob:"TV"===a.lob}),d=g[0].productOrderItemID}else d=e.productOrderItemId;var h=a.getProductConfigurationInput(null,d),i=a.get("addonToRemove");i&&(a.setValueByPath("actionType.actionFired","remove"),a.set("updatedAddOn",i),h=a.getProductConfigurationInput(null,d));var j=a.get("customerId"),k=a.get("dataX2ObjDetails");if(k&&k.length>0&&(h=a.updateInputPayload(k,h,d)),j){var l=a.getModel("customerUPCModel");l.set({customerId:j,productOrderItemId:d}),a.setHeaders(l),a.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save({UpdateProductInOrderConfigurationRequest:h},{success:c.bind(a.onUpdateProductConfigurationSuccess,a),error:c.bind(a.onProductConfigurationError,a,!1)})}else{var m=a.getModel("anonymousUPCModel");m.set({productOrderItemId:d}),a.setHeaders(m),a.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save({UpdateProductInOrderConfigurationRequest:h},{success:c.bind(a.onUpdateProductConfigurationSuccess,a),error:c.bind(a.onProductConfigurationError,a,!1)})}}}},getProductConfigurationPayload:function(){var a={activityForConfiguration:"SD Add Comp Stage",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}};return a},checkAndPopulateContractCharacteristics:function(a){if(a&&a.selected&&this.get("contractInsideContractCompCatlogId").indexOf(a.productSpecContainment.containedProduct.id)!==-1&&a.displayableItems&&a.displayableItems.length){var b=c.find(a.displayableItems,function(a){return this.get("contractCompCatlogId").indexOf(a.productSpecContainment.containedProduct.id)!==-1}.bind(this));if(b&&b.displayableCharacteristics&&b.displayableCharacteristics.length)if(a.displayableCharacteristics&&a.displayableCharacteristics.length)for(var d=0;d<b.displayableCharacteristics.length;d++)a.displayableCharacteristics.push(b.displayableCharacteristics[d]);else a.displayableCharacteristics=c.clone(b.displayableCharacteristics)}return a},getCharacteristics:function(a){var b=[];return a=this.checkAndPopulateContractCharacteristics(a),a&&a.displayableCharacteristics&&a.displayableCharacteristics.length>0&&c.each(a.displayableCharacteristics,function(a){"DROPDOWN_LISTBOX"===a.displayInformation.displayFormat&&("INTEGER"===a.productSpecCharacteristic.valueBasicType?a.productSpecCharacteristic.values=c.sortBy(a.productSpecCharacteristic.values,function(a){return parseInt(a.value,10)}):a.productSpecCharacteristic.values=c.sortBy(a.productSpecCharacteristic.values,"value"),a.productSpecCharacteristic.defaultValue.value=a.productSpecCharacteristic.defaultValue.value||(a.productSpecCharacteristic.values[0]?a.productSpecCharacteristic.values[0].value:"")),"undefined"!=typeof a.value&&null!==a.value||(a.value=a.productSpecCharacteristic.defaultValue.value||null),b.push(a)}),b},updateOrderToRunRules:function(a,b,d,e){var f=this;if(c.isUndefined(e)||c.isNull(e)||f.subViewModels.orderInContextTopicViewModel.set("promoRulesUpdated",e),"undefined"!=typeof a&&null!==a||(a=f.subViewModels.orderInContextTopicViewModel.get("orderActions")),b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0)}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus)return f.subViewModels.clearContextInContextTopic.clearAllTopics(!0),f.set("productConfigurationVmStatus","productConfigurationError"),!1;f.get("resetChargableEmailData")&&f.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null)}if(a&&a.length>0)f.callUpdateOrder(a);else{var g=f.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts");g.done(function(a){if("SUCCESS"===a){var b=f.subViewModels.orderInContextTopicViewModel.get("promoOrderActions")||[],d=f.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),e=!1;if(c.each(d,function(a){c.contains(b,a.productOrderItemID)||("BB"===a.lob&&(e=!0),b.push(a.productOrderItemID))}),e){var g=f.subViewModels.orderInContextTopicViewModel.get("orderActions");c.find(g,function(a){if(a.isFreeMBB&&!c.contains(b,a.productOrderItemID))return b.push(a.productOrderItemID),!0})}f.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",b),f.set("productConfigurationVmStatus","orderUpdated")}}.bind(f)),g.fail(function(a){f.subViewModels.clearContextInContextTopic.clearAllTopics(!0),f.set("productConfigurationVmStatus","productConfigurationError")}.bind(f))}},callUpdateOrder:function(a){var b,d,e=this,f=[],g=[],h="SD Add Comp Stage",i=e.get("promoOrderDetails"),j=e.subViewModels.orderInContextTopicViewModel.get(),k=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});k&&k.length>0&&(b=k[0].productOrderItemID,d=k[0].productID,f.push({productID:d}));var l=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails"),m=e.get("isFreeBOProductPresent");m&&l&&l.productOrderItemID===b&&l.productID?(g.push({productID:l.productID}),e.set("resetChargableEmailData",!0)):e.set("resetChargableEmailData",!1);var n,o=!1;if(i&&i.length>0&&(n=c.find(i,function(a){return a.productOrderItemId===b})),n){if(n.updatePromo){var p=e.get("specialDiscounts");if(p&&p.length>0){var q=e.subViewModels.getCustomerIdValueViewModel.calculateSpecialDiscount(p,n.brand,n.productOffer,n.transactionType,n.dataX3,n.dataXinfinity,n.customerType,n.deviceType);q=q?q:"EMPTY",h=h+"+++promoCode+++"+q}else h+="+++promoCode+++EMPTY"}else h+="+++promoCode+++EMPTY";var r=e.subViewModels.getCustomerIdValueViewModel.createPromoString(n.productOffer,n.brand,n.model,n.transactionType,n.ciTier,n.customerType,n.subSegment,n.selectedAddonIds);r&&""!==r&&(h+=r),o=!0}var s={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:h,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:g,changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};f.length>0&&(s.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=f);var t=j.customerID;if(t){var u=e.getModel("customerUPCModel");u.set({customerId:t,productOrderItemId:b}),e.setHeaders(u),e.setDefaultQueryParams(u),u.setQueryParams({rp:!1,rpc:!1}),u.save(s,{success:function(c,d){e.updateOrderToRunRules(a,b,d.UpdateProductInOrderConfigurationResponse,o)},error:e.onUpdateOrderToRunRulesError})}else{var v=e.getModel("anonymousUPCModel");v.set({productOrderItemId:b}),e.setHeaders(v),e.setDefaultQueryParams(v),v.setQueryParams({rp:!1,rpc:!1}),v.save(s,{success:function(c,d){e.updateOrderToRunRules(a,b,d.UpdateProductInOrderConfigurationResponse,o)},error:e.onUpdateOrderToRunRulesError})}},onUpdateOrderToRunRulesSuccess:function(a,b){this.set("productConfigurationVmStatus","orderUpdated")},onUpdateOrderToRunRulesError:function(a,b){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("productConfigurationVmStatus","productConfigurationError")},setBillingOffersForAdd:function(a,b,d,e,f,g,h,i){var j=this,k=this.get("addonToRemove"),l=d.addComponentList;g&&(l=d.addComponentDiscountList);var m=!1;if("BB"===a.lob){var n=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");n&&n.freeEmailIdFlag&&n.productID===a.productID&&(m=!0)}if(!m&&h!==!0&&("undefined"==typeof a.productID||null===a.productID||c.contains(l,a.productSpecContainmentID))){var o=j.get("dataX2ObjDetails"),p=!1;if(o&&o.length>0&&(p=c.filter(o,function(b){return b.orderItemId===i&&a.productSpecContainmentID===b.productSpecContainmentID})),!p&&a.productID&&c.contains(l,a.productSpecContainmentID)&&a.maximumQuantity===a.selectedComponent&&(c.isUndefined(k)||c.isNull(k)||k&&a.billingOfferID!==k.billingOfferID))this.set("productConfigurationVmStatus","maxComponentError");else{var q={productSpecContainmentID:a.productSpecContainmentID,temporaryID:b,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID},r=this.populateCharacteristics(a);q.changedCharacteristics=r,e.push(q)}}var s=this.getBillingOfferToBeAdded(a,b,l,m);f.push(s),this.set("resetChargableEmailData",m)},setBillingOffersForRemove:function(a,b,d,e,f){var g=b.removeComponentList,h=b.removeParentForLastChildList;f&&(g=b.removeComponentDiscountList,h=b.removeParentForLastChildDiscountList);var i=!1;if("BB"===a.lob){var j=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");j&&j.freeEmailIdFlag&&j.productID===a.productID&&(i=!0)}if(i||a.productID&&(c.contains(g,a.productSpecContainmentID)||a.specialAddon))d.push({productID:a.productID});else if(a.productID&&c.contains(h,a.productSpecContainmentID))a&&1===a.grandParentSpecCount?d.push({productID:a.parentProductID}):d.push({productID:a.productID});else if(a.billingOfferID){var k={billingOfferID:a.billingOfferID,productSpecPricingID:a.productSpecPricingID};e.push(k)}else a.productSpecContainment&&a.productSpecContainment.containedProduct&&"Mobile_Content_Service"===a.productSpecContainment.containedProduct.code&&d.push({productID:a.productID});this.set("resetChargableEmailData",i)}});return p});
define("businesswidget/repository_l9_common/common/viewmodel/business/FindTvSubscriptionViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{findCallerModel:e},subViewModels:{customerInContextTopicViewModel:c,contactInContextTopicViewModel:d,orderInContextTopicViewModel:f,onePassTopicViewModel:g},defaults:{tvStatus:"",askForTVSubScription:null},initialize:function(a){var c=this;this._super(a),b.bindAll(this,"findTvSubsription","onFindCallerSuccess"),this.set("tvStatus","Initialized");var d=c.subViewModels.orderInContextTopicViewModel.get("orderActions");if(d){var e=b.filter(d,function(a){return"BB"===a.lob&&"Change"!==a.orderType});if(e&&e.length>0){var f=b.filter(d,function(a){return"TV"===a.lob});f&&0===f.length?this.findTvSubsription():this.set("askForTVSubScription",!1)}else this.set("askForTVSubScription",!1)}},findTvSubsription:function(){var a=this;a.set("tvStatus","findingSubsc");var c=a.subViewModels.onePassTopicViewModel.get(),d=c.nric;if("undefined"!=typeof d&&null!==d){var e={implContactDetails:{indentValue:d,indentType:c.customerIdType}};a.getModel("findCallerModel").save({ImplFindCallerByContactInput:e},{success:b.bind(a.onFindCallerSuccess,a),error:function(){a.set("tvStatus","failure")}})}else this.set("askForTVSubScription",!1)},onFindCallerSuccess:function(a,c){var d=c.ImplFindCallerByContactOutput;if(d){var e=d.contactSubscriptionDetails;if(e){var f=b.filter(e,function(a){return"TV"===a.lineOfBusiness});f.length>0?this.set("askForTVSubScription",!1):this.set("askForTVSubScription",!1)}}}});return h});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpViewServiceListModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"tvselfhelp/portal/ecommerce/customer/:customerId/products",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},name:c.get("ERROR_CONST").ASSINGED_PRODUCTS});return d});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpViewServiceDetailModel",["lightsaber","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){var d=b.extend({options:{url:"tvselfhelp/portal/ecommerce/customer/:customerId/product/:productId",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale"),allParams:!0}}}},parse:function(a){if(a&&a.Product){var b=a.Product,c={catalogItemID:b.catalogItemID,links:b.links,id:b.id,status:b.status,parameters:b.parameters,pricePackages:b.pricePackages};b.services.push(c)}return a},name:c.get("ERROR_CONST").PRODUCT_DETAILS});return d});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpFindCallerByContactModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"tvselfhelp/portal/customer-management/caller-by-contact/",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},update:{contentType:"application/json",method:"POST",payload:["ImplFindCallerByContactInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpViewUpdateCustomerProfileModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({options:{url:"tvselfhelp/portal/customer-management/contact-person/",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},read:{contentType:"application/json",payload:["[]"]},update:{contentType:"application/json",method:"PUT",payload:["ImplContactPerson"]}}},name:d.get("ERROR_CONST").CONTACT_PERSON_RW,parse:function(a,b){var c=a.ImplContactPersonOutput.implContactPerson;return c&&(c.address.postCode=c.address.postcode,delete c.address.postcode,c.phone&&(c.phone=c.phone.substr(c.phone.length-8,c.phone.length))),a},toJSON:function(){var a=c.clone(this.attributes);return a&&a.ImplContactPerson&&a.ImplContactPerson.address.postCode&&(a.ImplContactPerson.address.postcode=a.ImplContactPerson.address.postCode,delete a.ImplContactPerson.vip,delete a.ImplContactPerson.address.postCode),a}});return e});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpSearchAddressinCRMModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"tvselfhelp/portal/customer-management/address",rest:{defaults:{method:"GET",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpSubmitProductConfigurationModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"tvselfhelp/portal/commerce/contact-person/:contactId/customer/:customerId/product/:productId/submit-product-configuration",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},create:{method:"PUT",payload:["ImplSubmitProductConfigurationRestInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpCustomerSubmitOrderModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){var d=a.extend({options:{url:"tvselfhelp/portal/ecommerce/customer/:customerId/submitOrder",rest:{defaults:{method:"POST",qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}}}}});return d});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpUpdateProductConfigurationModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"tvselfhelp/portal/commerce/customer/:customerId/product-order-item/:productOrderItemId/product-configuration",rest:{defaults:{contentType:"application/json"},create:{method:"PUT",payload:["UpdateProductInOrderConfigurationRequest"]}}}});return b});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpCustomerProductOrdersModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){var e=b.extend({id:"customerId",options:{url:"tvselfhelp/portal/commerce/customer/:customerId/product-orders",rest:{"delete":{method:"DELETE",url:"commerce/customer/:customerId/product-orders"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},readPage:{supportsPagination:!0,supportsSorting:!0,names:{pageSize:"pageSize",pageStart:"start"}}}}});return e});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpCreateInteractionModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"tvselfhelp/portal/contact-person/:contactId/interaction",rest:{defaults:{method:"POST",contentType:"application/json",payload:["ImplCreateInteractionInput"]}}}})});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpCheckPendingOnPendingOrderModel",["businesswidget/repository/common/core/RESTModel"],function (a){return a.extend({options:{url:"/tvselfhelp/portal/ecommerce/customer/:customerId/orders",rest:{defaults:{method:"GET"}}}})});
define("businesswidget/repository_l9_common/common/model/TvSelfHelpCustomerProductOrderProductOrderItemsModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{rest:{"delete":{method:"DELETE",url:"tvselfhelp/portal/commerce/customer/:customerId/product-order/:productOrderId/product-order-items"},read:{method:"GET"},defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}},url:"tvselfhelp/portal/commerce/customer/:customerId/product-order/:productOrderId/product-order-items",id:"productOrderId"})});
define("businesswidget/repository_l9_common/common/viewmodel/business/TvSelfHelpViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/TvSelfHelpViewServiceListModel","businesswidget/repository_l9_common/common/model/TvSelfHelpViewServiceDetailModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/TvSelfHelpFindCallerByContactModel","businesswidget/repository_l9_common/common/model/TvSelfHelpViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/TvSelfHelpSearchAddressinCRMModel","businesswidget/repository_l9_common/common/model/TvSelfHelpSubmitProductConfigurationModel","businesswidget/repository_l9_common/common/model/TvSelfHelpCustomerSubmitOrderModel","businesswidget/repository_l9_common/common/model/TvSelfHelpUpdateProductConfigurationModel","businesswidget/repository_l9_common/common/model/TvSelfHelpCustomerProductOrdersModel","businesswidget/repository_l9_common/common/model/TvSelfHelpCreateInteractionModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/model/TvSelfHelpCheckPendingOnPendingOrderModel","businesswidget/repository_l9_common/common/model/TvSelfHelpCustomerProductOrderProductOrderItemsModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){
var t=a.Core.ObservableViewModel.extend({models:{viewServiceListModel:d,viewUpdateCustomerProfileModel:h,viewServiceDetailModel:e,findCallerModel:g,searchAddressinCRMModel:j,submitProductConfigurationModel:k,customerSubmitOrderModel:l,updateProductOrderModel:m,cancelOrderModel:n,CreateInteractionModel:o,updateContactModel:p,checkPendingOnPendingOrderModel:r,tvSelfHelpCustomerProductOrderProductOrderItemsModel:s},subViewModels:{orderInContextTopicViewModel:f,onePassTopicViewModel:i,getCustomerIdValueViewModel:q},defaults:{tvSelfHelpVMStatus:"",personalDetails:null,tvSubscriptionDetails:null,customerIds:null,inputDetails:null,networkDetails:[],refNumber:null,productRefNumber:null,productOrderItemID:null,productId:null,contactId:null,reason:null,pendingOrderData:null,pendingOrderVmStatus:""},initialize:function(a){this._super(a);var b=this;c.bindAll(b,"getPersonalDetails","getAllProducts","initServices","getAllAddress","getNetworkTechnology","createInputPayloadForCreateOrder","updateProductConfig","setHeaders","setDefaultQueryParams","setDefaultHeader","createInputPayloadforUpdate","cancelOrder","submitOrder","addCustomerContact","updateSelectedBillingOffer","loadBillingOffers","generateTemporaryId","getBillingOfferToBeAdded","doSubmitTvProduct","getPendingOrdersForCustomer","onCheckPendingOnPendingOrderSuccess","onCheckPendingOnPendingOrderError","checkPendingOrders","cancelPendingOrders"),b.set("tvSelfHelpVMStatus","initialized","createInteraction"),b.on("ordersDeleted",b.doSubmitTvProduct,b)},setDefaultHeader:function(a){var b=this,c=b.get("inputDetails"),d={HTTP_CUST_ID:c.nric,HTTP_CUST_ID_TYPE:b.subViewModels.getCustomerIdValueViewModel.getCustomerIdCode(c.customerIdType),HTTP_BILL_PAYER:"1"};for(var e in d)d.hasOwnProperty(e)&&a.setRequestHeader(e,d[e])},fetchUserInfo:function(){var a=this,b=a.get("inputDetails");if(a.set("tvSelfHelpVMStatus","fetchUserInfo"),b.nric){var d={implContactDetails:{indentValue:b.nric,indentType:b.customerIdType}};a.models.findCallerModel=a.create("findCallerByContactModel",g),a.models.findCallerModel.save({ImplFindCallerByContactInput:d},{beforeSend:a.setDefaultHeader,success:c.bind(a.onFindCallerSuccess,a),error:c.bind(a.onFindCallerFailure,a)})}},createInteraction:function(a,b){var c=this,d={title:"TV Self Help",medium:"Self Service",channel:"Web",notes:a||this.get("notes"),userId:"sa",direction:{value:"1"},endTime:(new Date).getTime()+9999,startTime:(new Date).getTime(),topic:null,contactId:b};this.models.createInteractionModel=this.create("CreateInteractionModel",o),this.models.createInteractionModel.save({contactId:b,ImplCreateInteractionInput:d,beforeSend:c.setDefaultHeader,success:function(){console.log("Case created")},error:function(){console.log("Error Occured")}})},onFindCallerSuccess:function(a,b){var d=b.ImplFindCallerByContactOutput;if(d&&d.contactDetails&&d.contactDetails.contactId){this.set("contactId",d.contactDetails.contactId);var e="Singtel TV Self Dealer has accessed your Account for TV Services",f=d.contactDetails,g=this.get("inputDetails");g&&(this.set("startTime",g.startTime),this.set("endTime",g.endTime)),this.createInteraction(e,f.contactId);var h={name:f.registeredName,dob:f.dateOfBirth,phoneNumber:f.phone},i=[];c.each(d.contactCustomerDetails,function(a){i.push(a.customerId)}),this.set("customerIds",i),this.getPersonalDetails(h,f.contactId)}else this.set("tvSelfHelpVMStatus","failure")},onFindCallerFailure:function(a,b){this.set("tvSelfHelpVMStatus","failure")},getPersonalDetails:function(a,b){var d=this,e=this.getModel("viewUpdateCustomerProfileModel");e.set("id",b),e.fetch({beforeSend:d.setDefaultHeader,id:b,success:c.bind(d.onFetchPersonalDetailsSuccess,d,a),error:c.bind(d.onFetchPersonalDetailsError,d)})},onFetchPersonalDetailsSuccess:function(a,b,c){var d=c.ImplContactPersonOutput.implContactPerson;d?(a.contactEmail=d.emailId,a.salutation=d.salutation,this.set("personalDetails",a),this.getAllProducts()):this.set("tvSelfHelpVMStatus","failure")},onFetchPersonalDetailsError:function(a,b){this.set("tvSelfHelpVMStatus","failure")},getAllProducts:function(){var a=this;a.set("tvSelfHelpVMStatus","getAllProducts"),this.set("tvSubscriptionDetails",[]);var b=a.get("customerIds");if(b&&b.length>0){var d=[];c.each(b,function(b){var e=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:b,beforeSend:a.setDefaultHeader,success:c.bind(a.onLoadServicesSuccess,a,e,b),error:function(b){return function(c){a.set("tvSelfHelpVMStatus","failure"),b.reject(c)}}(e)}),d.push(e)}),$.when.apply(a,d).done(function(){var b=a.get("tvSubscriptionDetails");if("undefined"!=typeof b&&null!==b&&b.length>0){var d=c.groupBy(b,"lob"),e=d.TV,f={TV:e},g=c.flatten(c.map(f,c.values));a.set("tvSelfHelpVMStatus","getAllProductsDone"),a.getAllAddress(g)}else a.set("tvSelfHelpVMStatus","productsDetailsFailure")})}else a.set("tvSelfHelpVMStatus","failure")},onLoadServicesSuccess:function(a,b,d,e){if("undefined"!=typeof e.Products){this.set("tvSelfHelpVMStatus","onLoadServicesSuccess");var f=e.Products.products,g=this.get("tvSubscriptionDetails")||{};if("undefined"!=typeof f&&f.length>0){var h=this.initServices(f,b);g&&g.length>0?c.each(h,function(a){g.push(a)}):g=h,this.set("tvSubscriptionDetails",g)}a.resolve()}else this.set("tvSelfHelpVMStatus","failure"),a.reject()},initServices:function(a,b){var d=[],e=this.subViewModels.orderInContextTopicViewModel.get("customerID");return a&&c.each(a,function(a){"TV"===a.lob&&(a.customerId=b,a.isDisplayFlag=!0,"undefined"!=typeof e&&null!==e&&e!==b&&(a.isDisplayFlag=!1),a.plan?a.planName=a.plan.displayName:a.planName=a.offeringName,d.push(a))}),d},getAllAddress:function(a){var b=this,d=[];if(c.each(a,function(a){a.address.id&&d.push(a.address.id)}),d.length>0){var e=b.getModel("searchAddressinCRMModel");e.setQueryParams({addressIds:d}),e.fetch({beforeSend:b.setDefaultHeader,success:c.bind(b.setAddressForAllProducts,b,a),error:c.bind(b.getErrorMessage,b)})}},setAddressForAllProducts:function(a,b,d){var e=this,f=d.HashMap;c.each(a,function(a){a.address=f[a.address.id],a.address.blockOrHouseNum=a.address.unitNumber,a.address.floorNo=a.address.floor,a.address.postCode=a.address.postcode}),e.getNetworkTechnology(a)},getErrorMessage:function(a,b){this.set("tvSelfHelpVMStatus","failure")},getNetworkTechnology:function(a){var b=this,d=b.getModel("viewServiceDetailModel");b.set("networkDetails",[]);var e=[];c.each(a,function(a){if("TV"===a.lob){var f=$.Deferred();d.set({customerId:a.customerId,productId:a.id}),d.setQueryParams({allParams:!1}),d.fetch({beforeSend:b.setDefaultHeader,success:c.bind(b.onGetNetworkTechnologySuccess,b,f,a),error:function(a){return function(c){b.set("tvSelfHelpVMStatus","failure"),a.reject(c)}}(f)}),e.push(f)}else{var g=b.get("networkDetails");g.push(a),b.set("networkDetails",g)}}),$.when.apply(b,e).done(function(){b.set("tvSubscriptionDetails",b.get("networkDetails")),b.set("tvSelfHelpVMStatus","productsDetailsFetched")})},onGetNetworkTechnologySuccess:function(a,b,d,e){var f=this,g=[],h=f.get("networkDetails")||[];e.Product.services&&e.Product.services.length>0?(c.each(e.Product.services,function(a){if("8632892"==a.catalogItemID){var d={};c.filter(a.parameters,function(a){"8631732"==a.catalogId?a.valueName&&(d.stbType=a.valueName):"8631922"==a.catalogId?a.valueName&&(d.serialNumber=a.valueName):"8629542"==a.catalogId?a.valueName&&(d.guidNumber=a.valueName):"8629532"==a.catalogId?a.valueName&&(d.stbSequence=a.valueName):"8629512"==a.catalogId?a.valueName&&(d.stbBrandAndModel=a.valueName):"8609772"==a.catalogId?a.valueName&&(d.accessLinkageID=a.valueName):"9477623"==a.catalogId&&a.valueName&&(d.emailFwdIndicator=a.valueName)}),g.push(d)}"8611292"==a.catalogItemID&&c.each(a.parameters,function(a){"8609342"==a.catalogId&&(b.serviceTech=a.valueName)})}),g&&g.length>0&&(b.setTopBoxes=g),h.push(b),f.set("networkDetails",h),a.resolve()):(a.resolve(),f.set("tvSelfHelpVMStatus","failure"))},submitTvProduct:function(){var a=this,b=a.getValueByPath("inputDetails.selectedTVService"),c=a.getPendingOrdersForCustomer(b);$.when(c).done(function(b){b&&("noPendingOrders"===b?a.doSubmitTvProduct():a.cancelPendingOrders())}.bind(a))},doSubmitTvProduct:function(){var a=this,b=a.getValueByPath("inputDetails.selectedTVService"),d=a.createInputPayloadForCreateOrder();a.getModel("submitProductConfigurationModel").set({contactId:b.personId,customerId:b.customerId,productId:b.id}),a.getModel("submitProductConfigurationModel").save(d,{beforeSend:a.setDefaultHeader,success:c.bind(a._submitProductConfigSuccess,a),error:c.bind(a._submitProductConfigFailure,a)})},getPendingOrdersForCustomer:function(a){var b=this;a=a||b.getValueByPath("inputDetails.selectedTVService"),b.set("pendingOrderVmStatus","getPendingProductsForCustomer");var d=$.Deferred(),e=a.id||a.productId,f=b.getModel("checkPendingOnPendingOrderModel");return f.set({contactId:b.get("contactId"),customerId:a.customerId}),b.set("customerId",a.customerId),f.setQueryParams({apid:e}),f.fetch({success:c.bind(b.onCheckPendingOnPendingOrderSuccess,b,a,d),error:c.bind(b.onCheckPendingOnPendingOrderError,b,d)}),d},onCheckPendingOnPendingOrderSuccess:function(a,b,c,d){this.set("pendingOrderVmStatus","pendingOnPendingOrderSuccess");var e=this.checkPendingOrders(a,d);b.resolve(e)},onCheckPendingOnPendingOrderError:function(a,b,c){a.reject("pendingOnPendingOrderError"),this.set("pendingOrderVmStatus","ordersDeletionFailed")},checkPendingOrders:function(a,b){var d="noPendingOrders";if(b&&b.ImplContactCustomerOrdersResponse&&b.ImplContactCustomerOrdersResponse.implOrderHeaderList&&b.ImplContactCustomerOrdersResponse.implOrderHeaderList.length>0){var e=b.ImplContactCustomerOrdersResponse.implOrderHeaderList,f=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),g=a.id||a.productId,h=c.filter(e,function(a){var b=c.filter(a.implOrderActionHeaderList,function(a){var b=!1;return c.contains(c.pluck(f,"productOrderItemID"),a.orderActionId)||(b=!0),"NE"===a.orderStatus&&a.assignedProductId===g&&"RECON"!==a.reasonCode&&b});return a.implOrderActionHeaderList=b,!0});h&&h.length>0&&(this.set("pendingOrderData",h),d="isOrderPending")}return d},cancelPendingOrders:function(){var a=this,b=a.get("pendingOrderData");a.set("pendingOrderVmStatus","cancelPendingOrders");var d=a.get("customerId"),e=a.models.tvSelfHelpCustomerProductOrderProductOrderItemsModel,f=[];c.each(b,function(b){var g=$.Deferred();e.set("customerId",d),e.set("productOrderId",b.orderId),a.setDefaultQueryParams(e);var h=a.subViewModels.orderInContextTopicViewModel.get(),i=[];c.each(b.implOrderActionHeaderList,function(a){b.orderId===h.productOrderID?c.contains(c.pluck(h.currentOrderActions,"productOrderItemID"),a.orderActionId)||i.push(a.orderActionId):i.push(a.orderActionId)}),e.setQueryParams({poi:i}),e.set("id",i[0]),e.destroy({success:function(b){return function(c){a.set("pendingOrderVmStatus","success"),b.resolve([])}}(g),error:function(b){return function(b){a.set("pendingOrderVmStatus","failure"),g.resolve(["fail"])}}(g)}),f.push(g)}),$.when.apply(a,f).done(function(b){var d=c.find(b,function(a){return"fail"===a});a.get("eCareFlow");d?a.set("pendingOrderVmStatus","ordersDeletionFailed"):(a.set("pendingOrderVmStatus","ordersDeleted"),a.trigger("ordersDeleted"))})},createInputPayloadForCreateOrder:function(){var a=this.get("inputDetails"),b={updateProductConfigurationRequest:{returnRemovedItems:!1,configurationLevel:"FULL",runCompatibilityRules:!1,confirmationMessagesApproved:!1,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0},submitProductOrder:!1,settingsView:"FULL",productChanges:[{links:[],resumedContainedProducts:[],changedContainedProducts:[],newContainedProducts:[],removedContainedProducts:[],suspendedContainedProducts:[]}],orderActionReasonX8:"CREQ",orderActionTypeX8:"CH",vendorCodeX8:a.vendorCodeX8,dealerCodeX8:a.dealerCode},subscriberId:a.selectedTVService.subscriptionId};return{ImplSubmitProductConfigurationRestInput:b}},_submitProductConfigSuccess:function(a,b){var d,e,f,g,h=b.ImplSubmitProductConfigurationRestOutput.updateProductConfigurationResponse,i=c.filter(h.productConfiguration.displayableItems,function(a){return"10797291"===a.productSpecContainmentID}),j=h.productConfiguration.serviceID,k=this.getValueByPath("inputDetails"),l=k.replaceFaulty;l&&i&&i.length>0&&(g="You have successfully replaced your Faulty "+l.existingSTBType+" Set-Top Box for your Singtel TV Services (Service ID :"+j+")",c.each(i,function(a){c.each(a.displayableCharacteristics,function(b){"8631922"===b.productSpecCharacteristicID&&b.value===l.existingSTBNumber&&(e={productID:a.productID,stbNumber:l.newSTBSerialNumber})})}));var m=k.buyAdd;if(m){var n=0,o=k.selectedTVService;o.setTopBoxes&&o.setTopBoxes.length>0&&c.each(o.setTopBoxes,function(a){a.stbSequence>n&&(n=a.stbSequence)}),g="You have purchased New "+m.additionalNewSTBType+" Set-Top Box for your Singtel TV Services (Service ID :"+j+")",f={stbNumber:m.additionalNewSTBNumber,stbType:"DVR"===m.additionalNewSTBType?"DVR":"HD",stbSequence:Number(n)+1}}var p=k.upgdDowngd;p&&i&&i.length>0&&(g="You have replaced your existing Set-Top Box with New "+p.upgdExistingSTBType+" Set-Top Box for your Singtel TV Services (Service ID :"+j+")",c.each(i,function(a){var b=c.find(a.displayableCharacteristics,function(a){return"8631922"===a.productSpecCharacteristicID});b.value===p.existingSTBNumber&&(d=a.productID)}),f={stbNumber:p.upgdNewSTBSerialNumber,stbType:"DVR"===p.upgdExistingSTBType?"HD":"DVR",stbSequence:p.stbSequence}),this.set("notes",g),this.set("refNumber",h.productOrderID),this.set("productRefNumber",h.productOrderReferenceNumber),this.set("productOrderItemID",h.productOrderItemID),this.set("productId",h.productID),this.set("tvSelfHelpVMStatus","submitProductConfigSuccess"),this.updateProductConfig(h,d,f,e)},_submitProductConfigFailure:function(a,b){this.set("tvSelfHelpVMStatus","failure")},updateProductConfig:function(a,b,d,e){var f,g=this,h=g.get("inputDetails"),i=[];h.upgdDowngd&&i.push(h.upgdDowngd.upgdDiscountOffer),h.buyAdd&&i.push(h.buyAdd.additionalDiscountOffer);var j=g.createInputPayloadforUpdate(a.productID,b,d,e);if(i.length>0){var k=j.UpdateProductInOrderConfigurationRequest.productChanges[0].newContainedProducts;f=this.updateSelectedBillingOffer(a,i,h.addComponentList,k),f&&(f.newAssignedBillingOffers&&f.newAssignedBillingOffers.length>0&&(j.UpdateProductInOrderConfigurationRequest.productChanges[0].newAssignedBillingOffers=f.newAssignedBillingOffers),f.newContainedProducts&&f.newContainedProducts.length>0&&(j.UpdateProductInOrderConfigurationRequest.productChanges[0].newContainedProducts=f.newContainedProducts))}var l=this.getModel("updateProductOrderModel");l.set({customerId:h.selectedTVService.customerId,productOrderItemId:a.productOrderItemID}),g.setHeaders(l),g.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(j,{beforeSend:g.setDefaultHeader,success:c.bind(g._updateProductConfigSuccess,g),error:c.bind(g._updateProductConfigFailure,g)})},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc||b.get("salesChannel")})},createInputPayloadforUpdate:function(a,b,c,d){var e=[],f=[],g=[];if(b&&e.push({productID:b}),c){var h=[{characteristicID:8631732,value:c.stbType},{characteristicID:8631922,value:c.stbNumber},{characteristicID:8629542,value:c.guidNumber},{characteristicID:8629532,value:c.stbSequence}];c.emailFwdIndicator&&h.push({characteristicID:9477623,value:c.emailFwdIndicator}),c.accessLinkageID&&h.push({characteristicID:8609772,value:c.accessLinkageID}),c.stbBrandAndModel&&h.push({characteristicID:8629512,value:c.stbBrandAndModel}),f.push({productSpecContainmentID:"10797291",changedCharacteristics:h,temporaryID:"c"+Math.random().toString(36).substr(2,9)})}var i=[{productID:a,changedCharacteristics:[{characteristicID:8182,value:"Not Applicable"},{characteristicID:8710102,value:"Not Applicable"}]}];d&&i.push({productID:d.productID,changedCharacteristics:[{characteristicID:8631922,value:d.stbNumber}]});var j={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:e,changedContainedProducts:i,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:g,newContainedProducts:f,newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return j},_updateProductConfigSuccess:function(a,b){var c=b.UpdateProductInOrderConfigurationResponse;return c&&c.productConfiguration&&"BLOCKING"===c.productConfiguration.compatibilityStatus?(this.set("tvSelfHelpVMStatus","failure"),!1):(c.productConfiguration.totalOneTimeCalculatedPrice&&this.set("penaltyCharges",b.UpdateProductInOrderConfigurationResponse.productConfiguration.totalOneTimeCalculatedPrice.finalAmountIncludingTax||0),this.set("submitOrderFlag",!1),this.set("tvSelfHelpVMStatus","planUpdatedSuccessfully"),void this.addCustomerContact(b.UpdateProductInOrderConfigurationResponse))},addCustomerContact:function(a){var b,d=this,e=d.get("personalDetails"),f=d.get("inputDetails"),g=[],h=[],i=f.behalfDetails,j=d.getValueByPath("inputDetails.selectedTVService");b=i?i.behalfContactName:e.name,g.push({orderActionId:a.productOrderItemID,contactId:d.get("contactId"),userOnBehalf:b}),h.push(a.productOrderItemID);var k={ImplAddCustomerContactRestInput:{orderAction:g}},l=d.getModel("updateContactModel");l.setQueryParams({isAnonymous:!1}),l.set({customerId:j.customerId,orderId:d.get("productRefNumber")}),l.save(k,{success:c.bind(d.submitOrder,d),error:function(){return function(a){d.set("tvSelfHelpVMStatus","failure")}}()})},_updateProductConfigFailure:function(a,b){this.set("tvSelfHelpVMStatus","failure")},submitOrder:function(){var a=this,b=a.get("inputDetails"),d=a.getModel("customerSubmitOrderModel");d.setQueryParams({id:b.selectedTVService.customerId,orderIds:a.get("productRefNumber")}),d.set({customerId:b.selectedTVService.customerId}),d.save(null,{beforeSend:a.setDefaultHeader,success:c.bind(a.submitOrderSuccess,a),error:function(b,c){a.set("tvSelfHelpVMStatus","failure")}})},submitOrderSuccess:function(a,b){if(b){this.set("submitOrderFlag",!0),this.set("tvSelfHelpVMStatus","planSubmittedSuccessfully");var c=this.get("notes");this.createInteraction(c,this.get("contactId"))}},cancelOrder:function(){var a=this,b=a.get("refNumber");if(null!==b){var d=a.getModel("cancelOrderModel");d.set("productOrderId",b),a.setDefaultQueryParams(d);var e=[];e.push(a.get("productOrderItemID")),d.setQueryParams({poi:e}),d.set("id",e),d.destroy({beforeSend:a.setDefaultHeader,success:c.bind(a.processOutput,a),error:function(b,c){a.set("tvSelfHelpVMStatus","failure")}})}},updateSelectedBillingOffer:function(a,b,d,e){var f,g,h=this;f=a.productConfiguration.displayableItems,g=a.productOrderItemID;var i,j=[],k=[],l=[];return h.loadBillingOffers(f,b,j,k),j.length>0&&(c.each(j,function(a){var b=h.getBillingOfferToBeAdded(a,e[0].temporaryID,d);l.push(b)}),i={newContainedProducts:e,newAssignedBillingOffers:l}),i},loadBillingOffers:function(a,b,d,e){var f=this;c.each(a,function(a){d.length<b.length&&(a.displayableBillingOffers&&a.displayableBillingOffers.length>0&&c.each(a.displayableBillingOffers,function(f){if(f){var g=f.productSpecPricing.childPricingSchema.id;c.contains(b,g)&&!c.contains(e,g)&&(d.push({productSpecPricingID:f.productSpecPricingID,productSpecContainmentID:a.productSpecContainmentID,productID:a.productID,parentProductSpecContainmentID:a.parentProductSpecContainmentID,parentProductID:a.parentProductID}),e.push(f.productSpecPricing.childPricingSchema.id))}}),a.displayableItems&&a.displayableItems.length>0&&f.loadBillingOffers(a.displayableItems,b,d,e))})},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},getBillingOfferToBeAdded:function(a,b,c){var d={productSpecPricingID:a.productSpecPricingID,parentProductSpecContainmentID:a.productSpecContainmentID,parentTemporaryID:b};return d}});return t});
define("businesswidget/repository_l9_common/common/model/GetValidWhiteListModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/cce/mange-whiteList-phone",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/ValidateRoiTokenModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/cce/validate-get-sku",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/ValidatecisOtpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/cce/validate-otp",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/WhiteListInputViewModel",["lightsaber","underscore","Configuration","businesswidget/repository_l9_common/common/model/SaveWhiteListInputModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/GetValidWhiteListModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/ValidateRoiTokenModel","businesswidget/repository_l9_common/common/model/ValidatecisOtpModel"],function (a,b,c,d,e,f,g,h,j,k,l,m){var n=a.Core.ObservableViewModel.extend({models:{saveWhiteListOrderModel:d,validWhiteListModel:g,customerProductOrderProductOrderItemsModel:h,validateRoiTokenModel:l,validatecisOtpModel:m},subViewModels:{orderInContextTopicViewModel:e,onePassTopicViewModel:f,clearContextInContextTopic:j,deviceIdAndPlanIdInContextTopic:k},defaults:{whiteListStatus:"",whiteListDetails:null,phoneDetails:[],roiDetails:null},initialize:function(){b.bindAll(this,"getValidWhitelist","cancelOrder","doValidatePhoneList","setDefaultQueryParams","validateRoiToken","checkLoginStatus","validateCisOtp"),setTimeout(function(){this.set("whiteListStatus","Initialized"),this.checkLoginStatus()}.bind(this),0)},checkLoginStatus:function(){var a=this.subViewModels.onePassTopicViewModel.get("nric"),b=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("roiDetails");if(a||b&&b.nric){var c=a||b&&b.nric,b=this.get("roiDetails")||{};b.loggedInNric=c,this.set("roiDetails",b),this.set("whiteListStatus","loginDataFound")}else this.set("whiteListStatus","loginDataNotFound")},getValidWhitelist:function(){var a=this;a.set("whiteListStatus","");var c,d=a.get("whiteListInput");c=d.nric?d.nric:a.subViewModels.onePassTopicViewModel.get("nric");var e=a.getModel("validWhiteListModel");e.setQueryParams({nric:c,campaignID:d.campaignID,sku:d.sku}),e.fetch({success:b.bind(a.onValidWhitelistSuccess,a),error:function(){a.set("whiteListStatus","failure")}})},onValidWhitelistSuccess:function(a,c){var d=c.ImplisValidWhiteListRestOutput;if("undefined"!=typeof d){var e=this.getValueByPath("whiteListInput.sku");if(this.set("validWhiteList",f),d.campaigns){var f=d.campaigns;if(f&&f.length>0){var g=b.find(f,function(a){return a.stockCode===e});g?this.set("whiteListStatus","success"):this.set("whiteListStatus","noQuota")}else this.set("whiteListStatus","notFound")}else d.hasRecord?this.set("whiteListStatus","success"):d.hasRecord===!1?this.set("whiteListStatus","notFound"):this.set("whiteListStatus","failure")}else this.set("whiteListStatus","failure")},validateWhiteListPhoneOrder:function(a){var c=this;c.set("whiteListStatus","");var d,e=c.get("whiteListInput"),f=(c.getModel("validWhiteListModel"),c.subViewModels.onePassTopicViewModel.get("nric"),e.length);for(i=0;i<f;i++)void 0===a?(a=0,d=$.Deferred(),c.doValidatePhoneList(a,d)):i==a&&0!==a&&(d=$.Deferred(),c.doValidatePhoneList(a,d));d&&d.done(function(a,d){if("undefined"!=typeof a)if(a.campaigns){var e=a.campaigns;if(e&&e.length>0){var f=c.get("whiteListInput"),g=c.get("phoneDetails");b.each(e,function(a){g.push({queueNo:a.queueNo,stockCode:a.stockCode,campaignId:f[d].campaignID,deviceId:f[d].deviceId})}),c.set("phoneDetails",g),d++,c.validateWhiteListPhoneOrder(d)}else c.set("whiteListStatus","cceNotFound"),c.cancelOrder()}else if(a.hasRecord){var f=c.get("whiteListInput"),g=c.get("phoneDetails");g.push({campaignId:f[d].campaignID,deviceId:f[d].deviceId}),c.set("phoneDetails",g),d++,c.validateWhiteListPhoneOrder(d)}else a.hasRecord===!1?(c.set("whiteListStatus","cceNotFound"),c.cancelOrder()):c.set("whiteListStatus","failure");else c.set("whiteListStatus","failure")}.bind(c)),a&&a===f&&(c.subViewModels.deviceIdAndPlanIdInContextTopic.set("priorityPhoneDetails",c.get("phoneDetails")),c.set("whiteListStatus","proceedForPayment"))},doValidatePhoneList:function(a,c){var d=this;d.set("whiteListStatus","");var e=d.get("whiteListInput"),f=d.getModel("validWhiteListModel"),g=d.subViewModels.onePassTopicViewModel.get("nric");f.setQueryParams({nric:g,campaignID:e[a].campaignID,sku:e[a].sku}),f.fetch({success:b.bind(d.onFetchtWhitelistSuccess,d,c,a),error:function(a,b){d.set("whiteListStatus","failure"),c.reject(b)}})},onFetchtWhitelistSuccess:function(a,b,c,d){var e=d.ImplisValidWhiteListRestOutput;a.resolve(e,b)},onFetchtWhitelistFailure:function(a,b,c){a.reject(response),this.set("whiteListStatus","failure")},cancelOrder:function(){var a=this;a.set("whiteListStatus","");var c=a.subViewModels.orderInContextTopicViewModel.get();if(c.orderActions&&c.orderActions.length>0){var d=(c.customerID,c.productOrderID),e=a.models.customerProductOrderProductOrderItemsModel,f=[];b.each(c.orderActions,function(a){f.push(a.productOrderItemID)}),e.set("productOrderId",d),a.setDefaultQueryParams(e),e.setQueryParams({poi:f}),e.set("id",f),e.destroy({success:b.bind(a.processOutput,a),error:b.bind(a.setError,a)})}},processOutput:function(){this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("whiteListStatus","orderCancelled")},setError:function(){this.subViewModels.clearContextInContextTopic.clearCurrentContextTopic(!0),this.set("whiteListStatus","failure")},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},validateRoiToken:function(){var a=this;a.set("whiteListStatus","validateRoiToken");var c,d=a.get("roiDetails"),e=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("roiDetails");c=d&&d.nric?d.nric:a.subViewModels.onePassTopicViewModel.get("nric");var f;d&&d.token?f=d.token:e&&(f=e.token);var g;d?g=d.campaignID:e&&(g=e.campaignId);var h=a.models.validateRoiTokenModel;h.setQueryParams({nric:c,campaignId:g,token:f}),d&&d.emailId?h.setQueryParams({nric:c,campaignId:g,token:f,emailId:d.emailId}):h.setQueryParams({nric:c,campaignId:g,token:f}),h.fetch({success:b.bind(a.onValidateRoiTokenSuccess,a),error:function(){a.set("whiteListStatus","inValidRoiToken")}})},onValidateRoiTokenSuccess:function(a,b){var c=b.ImplValidateAndGetSKUByCustIdAndTokenResponse;c&&"true"===c.status?(this.set("roiDetails",c.product),this.set("whiteListStatus","validRoiToken")):this.set("whiteListStatus","inValidRoiToken")},validateCisOtp:function(){var a=this,b=a.get("roiDetails");a.set("whiteListStatus","validateCisOtp");var c=a.models.validatecisOtpModel;c.setQueryParams({otpCode:b.cisOtp,emailId:b.emailId}),c.fetch({success:function(b,c){var d=c.ImplValidateSessionTokenOutput;if(!d||"true"!==d.resultStatus&&d.resultStatus!==!0)a.set("whiteListStatus","inValidOtp");else{var e={companyId:d.parentCompanyBRN,companyName:d.parentCompanyName,childCompanyName:d.childCompanyName,childCompanyId:d.childCompanyBRN},f=d.rates;a.subViewModels.deviceIdAndPlanIdInContextTopic.set("cisRates",f),a.subViewModels.deviceIdAndPlanIdInContextTopic.set("cisDetails",e),a.subViewModels.deviceIdAndPlanIdInContextTopic.set("customerType","cis"),a.set("whiteListStatus","otpValidated")}},error:function(){a.set("whiteListStatus","otpRestFailure")}})}});return n});
define("businesswidget/repository_l9_common/common/viewmodel/business/WifiMeshViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f,g,h,i,j){var k=a.Core.ObservableViewModel.extend({subViewModels:{updateProductConfigurationViewModel:d,orderInContextTopicViewModel:e,shoppingCartViewModel:h,getCustomerIdValueViewModel:i,deviceIdAndPlanIdInContextTopic:j},models:{customerUPCModel:f,anonymousUPCModel:g},defaults:{premiumAddonVmStatus:"",selectedPremiumAddon:null,previousAddons:null,productOrderItemID:null,actionType:null,updatedAddOn:null,premiumAddonProductId:null,blockingMessages:null,promoOrderDetails:[],isFreeBOProductPresent:!1,resetChargableEmailData:!1},initialize:function(){b.bindAll(this,"getAddons","getProductConfigurationPayload","onRetrieveProductConfig","saveSelectedAddon","createPayload","generateTemporaryId","setHeaders","setDefaultQueryParams","updateOrderToRunRules","callUpdateOrder","onUpdateOrderToRunRulesError");var a=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");a&&a.length>0&&(a=b.filter(a,function(a){return"BB"===a.lob}),a&&a.length>0&&(this.set("productOrderItemID",a[0].productOrderItemID),this.getAddons())),this.set("premiumAddonVmStatus","initialize")},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getAddons:function(){var a=this,b=a.getProductConfigurationPayload(),c=a.subViewModels.updateProductConfigurationViewModel._retrieveProductConfiguration("BB",b);
c.done(function(b){"undefined"!=typeof b.RetrieveProductInOrderConfigurationResponse&&a.onRetrieveProductConfig(b.RetrieveProductInOrderConfigurationResponse)}.bind(a)),c.fail(function(b){a.set("premiumAddonVmStatus","failure")}.bind(a))},getProductConfigurationPayload:function(){var a={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return a},onRetrieveProductConfig:function(a){var c=this,d=a.productConfiguration.displayableItems,e={};e.customerType="public",e.productOrderItemId=this.get("productOrderItemID");var f=null;"CH"===a.productOrderItemType?f="recon":"PR"===a.productOrderItemType&&(f="new"),e.transactionType=f;var g=a.productConfiguration.rootProductOfferingID;e.productOffer=g,e.customerType=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");var h=[],i=[];i=c.subViewModels.getCustomerIdValueViewModel.getSelectedAddonIDs(d,i);var j=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails");d&&d.length>0&&b.each(d,function(a){if(j&&j.freeEmailIdFlag&&j.productID===a.productID&&c.set("isFreeBOProductPresent",!0),"8704182"===a.productSpecContainmentID){c.set("premiumAddonProductId",a.productID);var d=a.displayableSimpleProductReferences;if(d&&d.length>0){var e=d.length;b.each(d,function(b){"8704172"===b.productSpecContainmentID&&(1===e&&(b.allowedActions=a.allowedActions),h.push(b))})}}}),e.selectedAddonIds=i;var k={spsAddons:h};c.set("previousAddons",k),c.set("premiumAddonVmStatus","DataLoaded");var l=c.get("promoOrderDetails");l.push(e),c.set("promoOrderDetails",l)},saveSelectedAddon:function(){var a=this,c=a.get("productOrderItemID"),d=this.createPayload(c),e=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("BB",d,c);e.done(function(c){if("undefined"!=typeof c.UpdateProductInOrderConfigurationResponse){var d=c.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===d.compatibilityStatus){var e=[];b.each(d.messages,function(a){"ERROR"===a.severity&&e.push(a.text)}),a.set("blockingMessages",e),a.set("premiumAddonVmStatus","failure")}else{var f=a.subViewModels.orderInContextTopicViewModel.get("promoOrderActions")||[],g=a.subViewModels.orderInContextTopicViewModel.get("currentOrderActions"),h=!1;if(b.each(g,function(a){b.contains(f,a.productOrderItemID)||("BB"===a.lob&&(h=!0),f.push(a.productOrderItemID))}),h){var i=a.subViewModels.orderInContextTopicViewModel.get("orderActions");b.find(i,function(a){if(a.isFreeMBB&&!b.contains(f,a.productOrderItemID))return f.push(a.productOrderItemID),!0})}a.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",f),a.set("premiumAddonVmStatus","addonDataUpdated")}}else a.set("premiumAddonVmStatus","failure")}.bind(a)),e.fail(function(b){a.set("premiumAddonVmStatus","failure")}.bind(a))},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a},createPayload:function(a){var c=this,d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=c.generateTemporaryId(),m=c.get("selectedPremiumAddon");if("add"===m.actionType){var n=c.get("premiumAddonProductId");"undefined"!=typeof n&&null!==n||f.push({productSpecContainmentID:"8704182",temporaryID:l});var o=m.selectedAddon.selectedMonthlySubscription||"1";o=Number(o);var p,q=m.selectedAddon.originalCount||0;if(o>q)for(p=0;p<o-q;p++){var r={productSpecContainmentID:"8704172",temporaryID:c.generateTemporaryId(),simpleProductSpecID:m.selectedAddon.productSpecID,parentProductSpecContainmentID:"8704182",parentProductID:n,changedCharacteristics:[{characteristicID:13897781,value:"Instalments"}]};"undefined"!=typeof n&&null!==n||(r.parentTemporaryID=l),h.push(r)}else{var s=c.get("previousAddons");for(s=b.filter(s.spsAddons,function(a){return a.simpleProductSpecID===m.selectedAddon.productSpecID}),p=0;p<q-o;p++)d.push({productID:s[p].productID})}}else{var s=c.get("previousAddons");s&&s.spsAddons&&1===s.spsAddons.length&&d.push({productID:c.get("premiumAddonProductId")}),d.push({productID:m.selectedAddon.productID})}var t={removedContainedProducts:d,changedContainedProducts:e,suspendedContainedProducts:[],changedSimpleProducts:k,newAssignedBillingOffers:g,newContainedProducts:f,newSimpleProducts:h,removedSimpleProducts:i,removedAssignedBillingOffers:j,resumedContainedProducts:[]},u={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[t],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return u},updateOrderToRunRules:function(a,c,d){var e=this;if("undefined"!=typeof a&&null!==a||(a=e.subViewModels.orderInContextTopicViewModel.get("orderActions")),c&&b.each(a,function(a){a.productOrderItemID===c&&(a.updated=!0)}),a=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus)return e.set("premiumAddonVmStatus","failure"),!1;e.get("resetChargableEmailData")&&e.subViewModels.deviceIdAndPlanIdInContextTopic.set("chargeableEmailDetails",null)}if(a&&a.length>0)e.callUpdateOrder(a);else{var f=e.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts");f.done(function(a){if("SUCCESS"===a){var c=d.productOrderItemID,f=e.subViewModels.orderInContextTopicViewModel.get("promoOrderActions");f&&f.length>0&&(f=b.without(f,c),e.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",f)),e.set("premiumAddonVmStatus","orderUpdated")}}.bind(e)),f.fail(function(a){e.set("premiumAddonVmStatus","failure")}.bind(e))}},callUpdateOrder:function(a){var c=this,d=[],e=[],f="SD Add Comp Stage";f+="+++promoCode+++EMPTY";var g,h,i,j=c.get("promoOrderDetails"),k=c.subViewModels.orderInContextTopicViewModel.get(),l=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});l&&l.length>0&&(h=l[0].productOrderItemID,i=l[0].productID,d.push({productID:i}));var m=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("chargeableEmailDetails"),n=c.get("isFreeBOProductPresent");if(n&&m&&m.productOrderItemID===h&&m.productID?(e.push({productID:m.productID}),c.set("resetChargableEmailData",!0)):c.set("resetChargableEmailData",!1),j&&j.length>0&&(g=b.find(j,function(a){return a.productOrderItemId===h})),g){var o=c.subViewModels.getCustomerIdValueViewModel.createPromoString(g.productOffer,g.brand,g.model,g.transactionType,g.ciTier,g.customerType,g.subSegment,g.selectedAddonIds);o&&""!==o&&(f+=o)}var p={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:f,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:e,changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};d.length>0&&(p.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=d);var q=k.customerID;if(q){var r=c.getModel("customerUPCModel");r.set({customerId:q,productOrderItemId:h}),c.setHeaders(r),c.setDefaultQueryParams(r),r.setQueryParams({rp:!1,rpc:!1}),r.save(p,{success:function(b,d){c.updateOrderToRunRules(a,h,d.UpdateProductInOrderConfigurationResponse)},error:c.onUpdateOrderToRunRulesError})}else{var s=c.getModel("anonymousUPCModel");s.set({productOrderItemId:h}),c.setHeaders(s),c.setDefaultQueryParams(s),s.setQueryParams({rp:!1,rpc:!1}),s.save(p,{success:function(b,d){c.updateOrderToRunRules(a,h,d.UpdateProductInOrderConfigurationResponse)},error:c.onUpdateOrderToRunRulesError})}},onUpdateOrderToRunRulesError:function(a,b){this.set("premiumAddonVmStatus","failure")}});return k});
define("businesswidget/repository_l9_common/common/viewmodel/business/GetOrderInContextDataViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c){return a.Core.ObservableViewModel.extend({defaults:{orderContextDataVmStatus:""},subViewModels:{orderInContextTopicViewModel:c},initialize:function(){var a=this;a._super(),setTimeout(function(){var b=a.subViewModels.orderInContextTopicViewModel.get();b.productOrderID&&b.productOrderReferenceNumber||a.set("orderContextDataVmStatus","dataIsNotPresent")},0)}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/AccessoriesViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic"],function (a,b,c,d,e,f,g,h,i,j,k){var l=a.Core.ObservableViewModel.extend({subViewModels:{updateProductConfigurationViewModel:d,orderInContextTopicViewModel:e,shoppingCartViewModel:h,getCustomerIdValueViewModel:i,deviceIdAndPlanIdInContextTopic:j,clearContextInContextTopic:k},models:{customerUPCModel:f,anonymousUPCModel:g},defaults:{accessoriesVmStatus:"",selectedAccessory:null,previousAddons:null,productOrderItemID:null,accessoryProductId:null,blockingMessages:null,promoOrderDetails:[],simAdded:!1,simProductId:null},initialize:function(){b.bindAll(this,"getAddons","getProductConfigurationPayload","onRetrieveProductConfig","saveSelectedAccessory","createPayload","generateTemporaryId","setHeaders","setDefaultQueryParams","updateOrderToRunRules","callUpdateOrder","onUpdateOrderToRunRulesError","getProductConfigurationInput","updateSimComponent");var a=this.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");a&&a.length>0&&(a=b.find(a,function(a){return"WS"===a.lob}),a&&this.set("productOrderItemID",a.productOrderItemID),setTimeout(function(){this.set("accessoriesVmStatus","initialized")}.bind(this),0))},setHeaders:function(a){var c=a.getDataSource().methods.defaults.headers;c||(c={}),a.getDataSource().methods.defaults.headers=b.extend(c,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getAddons:function(){var a=this,b=a.getProductConfigurationPayload(),c=a.subViewModels.updateProductConfigurationViewModel._retrieveProductConfiguration("WS",b);c.done(function(b){"undefined"!=typeof b.RetrieveProductInOrderConfigurationResponse&&a.onRetrieveProductConfig(b.RetrieveProductInOrderConfigurationResponse)}.bind(a)),c.fail(function(b){a.set("accessoriesVmStatus","failure")}.bind(a))},getProductConfigurationPayload:function(){var a={activityForConfiguration:"NegotiateProductConfiguration",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return a},onRetrieveProductConfig:function(a){var c=this,d=a.productConfiguration.displayableItems,e={};e.customerType="public",e.productOrderItemId=this.get("productOrderItemID");var f=a.productConfiguration.rootProductOfferingID;e.productOffer=f,e.customerType=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");var g=[],h=[];h=c.subViewModels.getCustomerIdValueViewModel.getSelectedAddonIDs(d,h);var i=!1;d&&d.length>0&&b.each(d,function(a){if(!a.selected||"10482"!==a.productSpecContainmentID&&"Device Information"!==a.name)if("8363682"===a.productSpecContainmentID&&a.selected)b.find(a.displayableCharacteristics,function(a){if("8469052"===a.productSpecCharacteristicID)return e.ciTier=a.value,!0});else if("8363722"===a.productSpecContainmentID){var d=b.filter(a.displayableBillingOffers,function(a){return"SIM Card Fee"===a.name&&a.selected});d&&d.length>0&&c.set("simAdded",!0),c.set("simProductId",a.productID)}else a.selected&&"11812"===a.productSpecContainmentID?i=!0:a.selected&&"11822"===a.productSpecContainmentID?e.customerType=e.customerType||"staff":a.selected&&"11762"===a.productSpecContainmentID&&(e.customerType=e.customerType||"cis");else a.displayableSimpleProductReferences&&b.find(a.displayableSimpleProductReferences,function(a){"DEVICE"===a.businessType&&"AD"===a.action&&a.displayableCharacteristics&&b.each(a.displayableCharacteristics,function(a){"9012912"===a.productSpecCharacteristicID?a.value&&a.value.toUpperCase().indexOf("TABLET")>-1?e.deviceType="Tablet":e.deviceType="Mobile":"8852"===a.productSpecCharacteristicID?e.model=a.value:"8842"===a.productSpecCharacteristicID&&(e.brand=a.value)})})});var j=null;"CH"===a.productOrderItemType?j="recon":"PR"===a.productOrderItemType?j=i?"port-in":"new":"CW"===a.productOrderItemType&&(j="new"),e.transactionType=j;var k;a.productConfiguration.displayableSimpleProductReferences&&a.productConfiguration.displayableSimpleProductReferences.length>0&&b.each(a.productConfiguration.displayableSimpleProductReferences,function(a){"17987931"!==a.productSpecContainmentID&&"Accessory"!==a.name||(a.selected&&g.push(a),k=a.productSpecContainment.maximumQuantity)}),"undefined"!=typeof k&&null!==k||b.find(a.productConfiguration.displayableItems,function(a){if("17987931"===a.productSpecContainmentID||"Accessory"===a.name)return k=a.productSpecContainment.maximumQuantity,!0}),e.selectedAddonIds=h;var l={spsAddons:g,maxCardinality:k};setTimeout(function(){c.set("previousAddons",l),c.set("accessoriesVmStatus","DataLoaded");var a=c.get("promoOrderDetails");a.push(e),c.set("promoOrderDetails",a)}.bind(c),0)},saveSelectedAccessory:function(){var a=this,c=a.get("selectedAccessory"),d=c.productorderItemId||a.get("productOrderItemID"),e=this.createPayload(d),f=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("WS",e,d);f.done(function(c){if("undefined"!=typeof c.UpdateProductInOrderConfigurationResponse){var d=c.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===d.compatibilityStatus){var e=[];b.each(d.messages,function(a){"ERROR"===a.severity&&e.push(a.text)}),a.set("blockingMessages",e),a.set("accessoriesVmStatus","failure")}else{var f=c.UpdateProductInOrderConfigurationResponse.productOrderItemID,g=a.subViewModels.orderInContextTopicViewModel.get("promoOrderActions");g&&g.length>0&&(g=b.without(g,f),a.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",g)),a.set("accessoriesVmStatus","addonDataUpdated")}}else a.set("accessoriesVmStatus","failure")}.bind(a)),f.fail(function(b){a.set("accessoriesVmStatus","failure")}.bind(a))},generateTemporaryId:function(){var a=Math.random().toString(36).substr(2);return"C-"+a+Math.random().toString(36).substr(2)},createPayload:function(a){var b=this,c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=b.generateTemporaryId(),l=b.get("selectedAccessory");"add"===l.actionType?g.push({productSpecContainmentID:"17987931",temporaryID:k,simpleProductSpecID:l.selectedAddon.productSpecID}):c.push({productID:l.selectedAddon.productID});var m={removedContainedProducts:c,changedContainedProducts:d,suspendedContainedProducts:[],changedSimpleProducts:j,newAssignedBillingOffers:f,newContainedProducts:e,newSimpleProducts:g,removedSimpleProducts:h,removedAssignedBillingOffers:i,resumedContainedProducts:[]},n={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:null,confirmationMessagesApproved:!0,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[m],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!0,quotedTaxInd:!0,summaryInd:!0}}};return n},updateOrderToRunRules:function(a,c,d,e){var f=this;if(b.isUndefined(e)||b.isNull(e)||f.subViewModels.orderInContextTopicViewModel.set("promoRulesUpdated",e),"undefined"!=typeof a&&null!==a||(a=f.subViewModels.orderInContextTopicViewModel.get("orderActions")),c&&b.each(a,function(a){a.productOrderItemID===c&&(a.updated=!0)}),a=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),d&&d.productConfiguration&&"BLOCKING"===d.productConfiguration.compatibilityStatus)return f.set("accessoriesVmStatus","failure"),!1;if(a&&a.length>0)f.callUpdateOrder(a);else{var g=f.subViewModels.shoppingCartViewModel.loadShoppingCartData(!1,"QuoteSDAllDiscounts");g.done(function(a){if("SUCCESS"===a){var c=f.subViewModels.orderInContextTopicViewModel.get("promoOrderActions")||[],d=f.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");b.each(d,function(a){b.contains(c,a.productOrderItemID)||c.push(a.productOrderItemID)}),f.subViewModels.orderInContextTopicViewModel.set("promoOrderActions",c),f.set("accessoriesVmStatus","orderUpdated")}}.bind(f)),g.fail(function(a){f.set("accessoriesVmStatus","failure")}.bind(f))}},callUpdateOrder:function(a){var c=this,d=[],e="SD Add Comp Stage";e+="+++promoCode+++EMPTY";var f,g,h,i=c.get("promoOrderDetails"),j=!1,k=c.subViewModels.orderInContextTopicViewModel.get(),l=b.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});if(l&&l.length>0&&(g=l[0].productOrderItemID,h=l[0].productID,d.push({productID:h})),i&&i.length>0&&(f=b.find(i,function(a){return a.productOrderItemId===g})),f){var m=c.subViewModels.getCustomerIdValueViewModel.createPromoString(f.productOffer,f.brand,f.model,f.transactionType,f.ciTier,f.customerType,f.subSegment,f.selectedAddonIds);m&&""!==m&&(e+=m),j=!0}var n={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:e,confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};d.length>0&&(n.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=d);var o=k.customerID;if(o){var p=c.getModel("customerUPCModel");p.set({customerId:o,productOrderItemId:g}),c.setHeaders(p),c.setDefaultQueryParams(p),p.setQueryParams({rp:!1,rpc:!1}),p.save(n,{success:function(b,d){c.updateOrderToRunRules(a,g,d.UpdateProductInOrderConfigurationResponse,j)},error:b.bind(c.onUpdateOrderToRunRulesError,c,!1)})}else{var q=c.getModel("anonymousUPCModel");q.set({productOrderItemId:g}),c.setHeaders(q),c.setDefaultQueryParams(q),q.setQueryParams({rp:!1,rpc:!1}),q.save(n,{success:function(b,d){c.updateOrderToRunRules(a,g,d.UpdateProductInOrderConfigurationResponse,j)},error:b.bind(c.onUpdateOrderToRunRulesError,c,!1)})}},onUpdateOrderToRunRulesError:function(a,b,c){a===!0&&c&&0!==c.status&&this.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("accessoriesVmStatus",""),this.set("accessoriesVmStatus","failure")},updateSimComponent:function(){var a=this,c=this.get("simProductId");if(a.set("accessoriesVmStatus","updateSimComponent"),c){var d=a.getProductConfigurationInput(c),e=a.subViewModels.orderInContextTopicViewModel.get(),f=e.customerID,g=a.subViewModels.orderInContextTopicViewModel.get("orderActions");if(f){var h=a.getModel("customerUPCModel");h.set({customerId:f,productOrderItemId:a.get("productOrderItemID")}),a.setHeaders(h),a.setDefaultQueryParams(h),h.setQueryParams({rp:!1,rpc:!1}),h.save({UpdateProductInOrderConfigurationRequest:d},{success:function(b,c){a.updateOrderToRunRules(g)},error:b.bind(a.onUpdateOrderToRunRulesError,a,!0)})}else{var i=a.getModel("anonymousUPCModel");i.set({productOrderItemId:a.get("productOrderItemID")}),a.setHeaders(i),a.setDefaultQueryParams(i),i.setQueryParams({rp:!1,rpc:!1}),i.save({UpdateProductInOrderConfigurationRequest:d},{success:function(b,c){a.updateOrderToRunRules(g)},error:b.bind(a.onUpdateOrderToRunRulesError,a,!0)})}}},getProductConfigurationInput:function(a){var b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=!0;if(a){var k={productID:a,changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:"8858992",value:null},{characteristicID:8022652,value:"3IN1"},{characteristicID:132395,value:null}]};c.push(k),j=!0}var l={removedContainedProducts:b,changedContainedProducts:c,suspendedContainedProducts:[],changedSimpleProducts:i,newAssignedBillingOffers:e,newContainedProducts:d,newSimpleProducts:f,removedSimpleProducts:g,removedAssignedBillingOffers:h,resumedContainedProducts:[]},m={runCompatibilityRules:j,activityForConfiguration:"SD Add Comp Stage",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[l],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!1,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return m}});return l});
define("businesswidget/repository_l9_common/common/viewmodel/business/ExtendReservationViewModel",["lightsaber","underscore","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateEquipmentStatusModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel"],function (a,b,c,d,e,f,g,h,i){return a.Core.ObservableViewModel.extend({models:{updateEquipmentStatusModel:e,customerProductOrderProductOrderItemsModel:h,anonymousProductOrderProductOrderItemsModel:i},subViewModels:{orderInContextTopicViewModel:d,deviceIdAndPlanIdInContextTopic:f,individualInContextTopicViewModel:g},dataBindings:[{customerId:"subViewModels.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{extendStatus:"",customerId:null,contactId:null,mtposReservationTime:null,cancelOrderActions:null},initialize:function(a){this._super(a),b.bindAll(this,"extendReservation","extendReservationSuccess","extendReservationFailed","_cancelOrder","processCancelOutput","processCancelFailed","setDefaultQueryParams"),this.set("extendStatus","vmInitialized")},extendReservation:function(){var a=this;a.set("extendStatus","startExtendReservation");var c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get(),d=a.getModel("updateEquipmentStatusModel");d.set("contactId",a.get("contactId"));var e;if(c.reservationIDs||c.allocationIDs){var f=c.selectedOption;if("singtel-store"===f){if(c.reservationIDs&&c.reservationIDs.length>0){var g=[];b.each(c.reservationIDs,function(b){g.push({reservationID:b,reservationStatus:"Extend",newExpirationTime:a.get("mtposReservationTime"),sessExpirationMins:a.get("mtposSessExpTime")})}),e={ImplUpdateEquipmentStatusRestInput:{reservationStatusInfo:g}}}}else if(c.allocationIDs&&c.allocationIDs.length>0){var g=[];b.each(c.allocationIDs,function(b){g.push({allocationID:b,allocationStatus:"Extend",newExpirationTime:a.get("mtposReservationTime"),sessExpirationMins:a.get("mtposSessExpTime")})}),e={ImplUpdateEquipmentStatusRestInput:{allocationStatusInfo:g}}}d.save(e,{success:function(d,e){if(e&&e.ImplUpdateEquipmentStatusRestOutput&&e.ImplUpdateEquipmentStatusRestOutput.allocationStatusResponse&&e.ImplUpdateEquipmentStatusRestOutput.allocationStatusResponse.length>0||e.ImplUpdateEquipmentStatusRestOutput.reservationStatusResponse&&e.ImplUpdateEquipmentStatusRestOutput.reservationStatusResponse.length>0){var g;"singtel-store"===f?g=b.find(e.ImplUpdateEquipmentStatusRestOutput.reservationStatusResponse,function(a){return a.updateStatus===!1}):c.allocationIDs&&c.allocationIDs.length>0&&(g=b.find(e.ImplUpdateEquipmentStatusRestOutput.allocationStatusResponse,function(a){return a.updateStatus===!1})),g?a.extendReservationFailed():a.extendReservationSuccess()}else a.extendReservationSuccess()},error:function(){a.set("extendStatus","failure")}})}else a.extendReservationSuccess()},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=b.extend(d,{lo:c.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},_cancelOrder:function(){var a=this;a.set("extendStatus","startExtendReservation");var c=a.get("cancelOrderActions");if(c&&c.length>0){var d,e=a.subViewModels.orderInContextTopicViewModel,f=e.get("customerID"),g=e.get("productOrderID");f?(d=a.models.customerProductOrderProductOrderItemsModel,d.set("customerId",f)):d=a.models.anonymousProductOrderProductOrderItemsModel,d.set("productOrderId",g),a.setDefaultQueryParams(d);var h=b.clone(c);d.setQueryParams({poi:c}),d.set("id",c[0]),d.destroy({success:b.bind(a.processCancelOutput,a,h),error:b.bind(a.processCancelFailed,a)})}},processCancelOutput:function(a){var c=this;if(a&&a.length>0){var d=c.subViewModels.orderInContextTopicViewModel.get("orderActions")||[];if(d&&d.length===a.length){c.subViewModels.orderInContextTopicViewModel.emptyTopic();var e=[];if(e.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),e.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),window.localStorage.removeItem("LightsaberSessionToken"),window.localStorage.setItem("clearSessionStorage",!0),e.length>0)for(var f=0;f<e.length;f++){var g=e[f];window.sessionStorage.removeItem(g)}window.localStorage.removeItem("clearSessionStorage"),c.set("extendStatus","cancelSuccess")}else d&&d.length>0?(d=b.filter(d,function(c){return!b.contains(a,c.productOrderItemID)}),c.subViewModels.orderInContextTopicViewModel.set("orderActions",d),c.set("extendStatus","cancelSuccess")):c.set("extendStatus","cancelSuccess")}else c.set("extendStatus","cancelSuccess")},processCancelFailed:function(){var a=this;a.set("extendStatus","cancelFailed")},extendReservationSuccess:function(){var a=this;a.set("extendStatus","success")},extendReservationFailed:function(){var a=this;a.set("extendStatus","failure")}})});
define("businesswidget/repository_l9_common/common/model/EnergyContactModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/energy/customer-management/find-contact",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplFindCallerByContactInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/EnergySendOtpModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/energy/user/send-otp",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplSendOTPForAnonymousInput"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/EnergyAccountValidateModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/energy/customer-management/find-account",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplAccountDetailsForEnergyInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/model/EnergyOTPValidateModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/energy/verify/otp",rest:{defaults:{qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ImplVerifyEnergyOTPInput"]}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","businesswidget/repository_l9_common/common/model/EnergyContactModel","businesswidget/repository_l9_common/common/model/EnergySendOtpModel","businesswidget/repository_l9_common/common/model/VerifyOnePassOtpModel","businesswidget/repository_l9_common/common/model/EnergyAccountValidateModel","businesswidget/repository_l9_common/common/model/EnergyOTPValidateModel","businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.Core.ObservableViewModel.extend({defaults:{singtelEnergyVmStatus:null,contactDetails:null,contactExists:!1,loginVmStatus:null,nric:null,newcustomer:!1,userInfo:null,accountNumberRequired:!1,customerIds:null,contactId:null},models:{energyContactModel:h,energySendOtpModel:i,verifyOnePassOtpModel:j,energyAccountValidateModel:k,energyOTPValidateModel:l,findCallerByContactModel:m},subViewModels:{getCustomerIdValueViewModel:d,implUserContextTopicViewModel:e,onePassTopicViewModel:f,contactInContextTopicViewModel:g,individualInContextTopicViewModel:n,customerInContextTopicViewModel:o,onePassDetailsViewModel:p,deviceIdAndPlanIdInContextTopic:q
},initialize:function(a){this._super(a),c.bindAll(this,"setHeaders","setDefaultQueryParams","getErrorMessage","validateContactDetails","sendOTP","validateOtp","validateAccount","fetchUserInfo","setOnePassFields","onOnePassInfoSuccess","onOnePassInfoFailure","setUserInfoDetails","setFormData");var b=this;setTimeout(function(){b.set("singtelEnergyVmStatus","vmInitialized");var a=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId"),c=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType");"ENERGY"===c&&"undefined"!=typeof a&&null!==a||b.set("singtelEnergyVmStatus","dataIsNotPresent"),b.on("change:nric",b.fetchUserInfo,b)},0)},setUserInfoDetails:function(a,b){var c=this;if(b){var d=c.get("contactId");d&&(c.subViewModels.individualInContextTopicViewModel.set("personId",d),c.subViewModels.contactInContextTopicViewModel.set("ID",d))}else c.subViewModels.implUserContextTopicViewModel.set("userInfo",a),c.subViewModels.individualInContextTopicViewModel.set("personId",a.contactDetails.contactId),c.subViewModels.contactInContextTopicViewModel.set("ID",a.contactDetails.contactId)},setOnePassFields:function(){var a=this;a.subViewModels.onePassDetailsViewModel.setOnePassFields().then(c.bind(a.onOnePassInfoSuccess,a),c.bind(a.onOnePassInfoFailure,a))},onOnePassInfoSuccess:function(a){var b=this,c=a.ImplLoginHeaderResOutput.headersMap;if(c.HTTP_CUST_ID&&null!==c.HTTP_CUST_ID&&""!==c.HTTP_CUST_ID){this.subViewModels.onePassTopicViewModel.set("loginVmStatus","OnePassInfoLoadedSuccessfully");var d=this.subViewModels.getCustomerIdValueViewModel.getCustomerIdType(c.HTTP_CUST_ID_TYPE);this.subViewModels.onePassTopicViewModel.set("nickName",c.HTTP_GIVEN_NAME),this.subViewModels.onePassTopicViewModel.set("userId",c.HTTP_LOGIN_ID),this.subViewModels.onePassTopicViewModel.set("customerIdType",d),this.subViewModels.onePassTopicViewModel.set("status",c.HTTP_LHTTP_CUST_STATUSOGIN_ID),this.subViewModels.onePassTopicViewModel.set("email",c.HTTP_CUST_EMAIL),this.subViewModels.onePassTopicViewModel.set("familyName",c.HTTP_SSO_FAMILY_NAME),this.subViewModels.onePassTopicViewModel.set("billPayer",c.HTTP_BILL_PAYER),this.subViewModels.onePassTopicViewModel.set("nric",c.HTTP_CUST_ID);var e=c.HTTP_CUST_ID,f=b.get("contactDetails")||{};f.guestIdNumberPrefix=e.substring(0,1),f.guestIdNumber=e.substring(1,e.length),f.guestIdType=d,f.mobileNumber="99999999",b.set("contactDetails",f),b.validateContactDetails(e)}else this.set("loginVmStatus","anonymous")},onOnePassInfoFailure:function(){this.set("loginVmStatus","anonymous")},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getErrorMessage:function(){return this.set("singtelEnergyVmStatus","failure"),!0},validateContactDetails:function(a){var b=this,c=b.get("contactDetails"),d=b.getModel("energyContactModel");b.set("contactExists",!1);var e={implContactDetails:{indentValue:c.guestIdNumberPrefix+c.guestIdNumber,indentType:c.guestIdType,phone:c.mobileNumber}};b.set("singtelEnergyVmStatus","beforeValidation"),d.save({ImplFindCallerByContactInput:e},{success:function(c,d){if(d.ImplFindCallerOutput){var e=d.ImplFindCallerOutput;a||(b.set("newcustomer",!0),b.set("customerIds",e.customerIds),b.set("contactId",e.contactId)),b.set("contactExists",e.contactExist);var f=!0;e.contactExist&&e.subscriptionExist&&(f=!1),b.subViewModels.deviceIdAndPlanIdInContextTopic.set("customerExists",f),a?e.contactExist&&e.subscriptionExist?b.set("nric",a):b.set("singtelEnergyVmStatus","customerMissing"):(e.contactExist&&e.baExist&&!e.mobileNumberExists&&b.set("accountNumberRequired",!0),b.sendOTP())}else b.set("contactExists",!1),b.getErrorMessage()},error:function(a){b.set("contactExists",!1),b.getErrorMessage()}})},sendOTP:function(){var a=this;a.set("singtelEnergyVmStatus","sending OTP");var b=a.get("contactDetails"),c=a.get("contactExists"),d="65-"+b.mobileNumber,e={ImplSendOTPForAnonymousInput:{msisdn:d,indentValue:b.guestIdNumberPrefix+b.guestIdNumber,indentType:b.guestIdType,purpose:"Register"}},f=a.getModel("energySendOtpModel");f.save(e,{success:function(b,d){a.set("contactExists",c),a.set("singtelEnergyVmStatus","otpSent")},error:function(b,c){a.set("contactExists",!1),a.getErrorMessage()}})},validateOtp:function(){var a=this;a.set("singtelEnergyVmStatus","validatingOtp");var b=a.get("contactDetails"),c=b.guestIdNumberPrefix+b.guestIdNumber,d={ImplVerifyEnergyOTPInput:{otp:b.otpNumber,indentValue:c,indentType:b.guestIdType,mobileNumber:b.mobileNumber}},e=a.getModel("energyOTPValidateModel");e.save(d,{success:function(c,d){d.ImplVerifyEnergyOTPOutput&&d.ImplVerifyEnergyOTPOutput.otpVerified?a.get("accountNumberRequired")?a.set("singtelEnergyVmStatus","accountNumberDetailsRequired"):(a.set("singtelEnergyVmStatus","validOtp"),a.setCustomerData(b)):a.set("singtelEnergyVmStatus","invalidOtp")},error:function(b,c){a.getErrorMessage()}})},validateAccount:function(){var a=this;a.set("singtelEnergyVmStatus","validatingAccount");var b=a.get("contactDetails"),c={ImplAccountDetailsForEnergyInput:{faId:b.accountNumber,indentValue:b.guestIdNumberPrefix+b.guestIdNumber,indentType:b.guestIdType}},d=a.getModel("energyAccountValidateModel");d.save(c,{success:function(c,d){d.ImplAccountDetailsForEnergyOutput&&d.ImplAccountDetailsForEnergyOutput.accountExist?(a.set("singtelEnergyVmStatus","validAccount"),a.setCustomerData(b)):a.set("singtelEnergyVmStatus","invalidAccount")},error:function(b,c){a.getErrorMessage()}})},setCustomerData:function(a){var b=this;b.set("nric",null);var c=a.guestIdNumberPrefix+a.guestIdNumber,d=this.subViewModels.onePassTopicViewModel;d.set("newcustomer",b.get("newcustomer")),d.set("nric",c),d.set("customerIdType",a.guestIdType),b.set("nric",c)},fetchUserInfo:function(){var a=this,b=a.get("nric"),d=a.get("contactExists"),e=a.get("newcustomer");if(e){a.setUserInfoDetails(null,e);var f=a.get("customerIds");f&&f.length>0&&(a.subViewModels.customerInContextTopicViewModel.set("customerIds",f),a.subViewModels.customerInContextTopicViewModel.set("ID",f[0])),a.set("singtelEnergyVmStatus","findCallerSuccess")}else if(b&&d){var g={implContactDetails:{indentValue:b,indentType:a.subViewModels.onePassTopicViewModel.get("customerIdType")}};a.models.findCallerModel=a.create("findCallerByContactModel",m),a.models.findCallerModel.save({ImplFindCallerByContactInput:g},{success:c.bind(a.onFindCallerSuccess,a),error:c.bind(a.getErrorMessage,a)})}else a.set("singtelEnergyVmStatus","findCallerSuccess")},onFindCallerSuccess:function(a,b){var d=this;d.set("userInfo",b.ImplFindCallerByContactOutput);var e=d.get("userInfo");d.setUserInfoDetails(e,!1);var f=[];c.each(e.contactCustomerDetails,function(a){f.push(a.customerId)}),d.subViewModels.customerInContextTopicViewModel.set("customerIds",f),d.subViewModels.customerInContextTopicViewModel.set("ID",f[0]),d.set("singtelEnergyVmStatus","findCallerSuccess")},setFormData:function(){var a=this;a.set("singtelEnergyVmStatus","startingFormData");var b=a.get("contactDetails"),c=b.guestIdNumberPrefix+b.guestIdNumber,d={user:c};a.subViewModels.deviceIdAndPlanIdInContextTopic.set("energyAddress",d),a.set("singtelEnergyVmStatus","formDataUpdated")}});return r});
define("businesswidget/repository_l9_common/common/viewmodel/business/EnergyEmailNotificationViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/ImplSendNotificationModel","moment","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic"],function (a,b,c,d,e,f,g){return a.Core.ObservableViewModel.extend({subViewModels:{onePassTopicViewModel:e,deviceIdAndPlanIdInContextTopic:f,clearContextInContextTopic:g},models:{implSendNotificationModel:c},defaults:{customerRoiData:null,notificationVmstatus:"",customerCallbackData:null,customerNonAccData:null},initialize:function(a){this._super(a),b.bindAll(this,"sendNotificationRequest","triggerEnergyRoiEmail","triggerEnergyCallbackEmail","triggerEnergyNonAccountEmail");var c=this;setTimeout(function(){c.set("notificationVmstatus","vmInitialized")},0)},triggerEnergyRoiEmail:function(){var a=$.Deferred(),b=this.get("customerRoiData"),c=b.parameters,e=this;e.set("notificationVmstatus","processing");var f=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("energyAddress");c.push({key:"customerIC",value:e.subViewModels.onePassTopicViewModel.get("nric")},{key:"createdDate",value:d().format("YYYY-MM-DD hh:mm:ss a")},{key:"lastModifiedDate",value:d().format("YYYY-MM-DD hh:mm:ss a")},{key:"serviceAddress",value:f.serviceAddress});var g={ImplSendNotificationRequest:{target:b.emailId,templateId:b.templateId,notificationChannel:"EMAIL",templateSimpleParameters:c,templateURLParameters:[]}};return e.sendNotificationRequest(g,a),a},triggerEnergyCallbackEmail:function(){var a=$.Deferred(),b=this,c=this.get("customerCallbackData"),e=c.parameters;b.set("notificationVmstatus","processing");var f=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("energyAddress"),g=f&&f.user?f.user:b.subViewModels.onePassTopicViewModel.get("nric");e.push({key:"customerIC",value:d().format("DD/MM/YYYY")+"_"+g});var h={ImplSendNotificationRequest:{target:c.emailId,templateId:c.templateId,notificationChannel:"EMAIL",templateSimpleParameters:e,templateURLParameters:[]}};return b.sendNotificationRequest(h,a),a},triggerEnergyNonAccountEmail:function(){var a=$.Deferred(),b=this.get("customerRoiData"),c=b.parameters,e=this,f=e.subViewModels.deviceIdAndPlanIdInContextTopic.get("energyAddress");e.set("notificationVmstatus","processing"),c.push({key:"customerIC",value:d().format("DD/MM/YYYY")+"_"+e.subViewModels.onePassTopicViewModel.get("nric")},{key:"spAccountNumber",value:f.accountNo},{key:"spName",value:f.accountHolderName},{key:"preferredServiceStartDate",value:f.startDate},{key:"ServiceAddress",value:f.serviceAddress},{key:"billingAddress",value:f.billingAddress},{key:"residentialAddress",value:f.billingAddress},{key:"typeOfHousing",value:f.housingDetails});var g={ImplSendNotificationRequest:{target:b.emailId,templateId:b.templateId,notificationChannel:"EMAIL",templateSimpleParameters:c,templateURLParameters:[]}};return e.sendNotificationRequest(g,a),a},sendNotificationRequest:function(a,b){var c=this;c.getModel("implSendNotificationModel").save(a,{success:function(a,d){c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("notificationVmstatus","mailSent"),b.resolve("success")},error:function(a,d){c.subViewModels.clearContextInContextTopic.clearAllTopics(!0),c.set("notificationVmstatus","error"),b.reject("error")}})}})});
define("businesswidget/repository_l9_common/common/model/EnergyCreateCustomerModel",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return a.Core.RESTModel.extend({options:{url:"/energy/customer-management/create-customer",rest:{defaults:{method:"POST"},create:{contentType:"application/json",qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyLoadServicesViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","businesswidget/repository_l9_common/common/model/viewServiceListModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/UpdateContactDetailsModel","businesswidget/repository_l9_common/common/model/EnergyContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/model/BillingAccountDetailedListModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository_l9_common/common/model/EnergyCreateCustomerModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=a.Core.ObservableViewModel.extend({defaults:{singtelEnergyServicesVmStatus:null,customerIds:null,accounts:null,servicesDetails:[],finalServiceList:[],customerDetails:null,contactData:null,contactId:null,nric:null,customerIdType:null,customerId:null},models:{viewServiceListModel:f,updateContactDetailsModel:h,energyContactModel:i,billingAccountDetailedListModel:m,createCustomerModel:o},subViewModels:{customerInContextTopicViewModel:d,billingAccountsViewModel:e,onePassTopicViewModel:g,individualInContextTopicViewModel:j,orderInContextTopicViewModel:l,deviceIdAndPlanIdInContextTopic:k,clearContextInContextTopic:n},dataBindings:[{customerIds:"subViewModels.customerInContextTopicViewModel.customerIds",options:{twoWay:!1,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"setHeaders","setDefaultQueryParams","getErrorMessage","loadServices","getDetails","populateBADetails","registerCustomer","updateContact","onUpdateSuccess","findBillingAccount","createBillAddress","updateContactDetails","notOwner","isLocalCustomer","serviceUnavailable","convertAddressToString");var b=this;setTimeout(function(){b.set("singtelEnergyServicesVmStatus","vmInitialized");var a=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId"),c=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType"),d=b.subViewModels.onePassTopicViewModel.get("nric");"ENERGY"!==c||"undefined"==typeof a||null===a||"undefined"==typeof d||null===d||""===d?b.set("singtelEnergyServicesVmStatus","dataIsNotPresent"):b.loadServices()},0)},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getErrorMessage:function(){var a=this;a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),this.set("singtelEnergyServicesVmStatus","failure")},loadServices:function(){var a=this,b=a.get("customerIds"),c=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerExists");if("undefined"!=typeof b&&null!==b&&b.length>0&&!c){var d=this.subViewModels.billingAccountsViewModel.getBillingAccountDetails();d.done(function(b){a.set("accounts",b);var c={newcustomer:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerExists"),nric:a.get("nric"),isLocalCustomer:a.isLocalCustomer(a.get("nric"))};a.set("customerDetails",c),a.set("singtelEnergyServicesVmStatus","DataLoaded")}.bind(a)),d.fail(function(b){a.getErrorMessage()}.bind(a))}else{var e={newcustomer:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerExists"),nric:a.get("nric"),isLocalCustomer:a.isLocalCustomer(a.get("nric"))};a.set("customerDetails",e),a.set("accounts",[]),a.set("singtelEnergyServicesVmStatus","DataLoaded")}},getDetails:function(){var a=this;a.set("singtelEnergyServicesVmStatus","loading");var b=a.get("customerIds"),d=[];c.each(b,function(b){var e=$.Deferred();a.getModel("viewServiceListModel").fetch({customerId:b,success:c.bind(a.onLoadServicesSuccess,a,e,b),error:function(b){return function(c){a.set("singtelEnergyServicesVmStatus","failure"),b.reject(c)}}(e)}),d.push(e)}),$.when.apply(a,d).done(function(){var b=a.get("servicesDetails")||[],d=c.groupBy(b,function(a){return a.address.postCode+"_"+a.address.addressLine2+"_"+a.address.floor}),e=[],f=a.get("accounts");c.map(d,function(b,d){var g={customerIds:[],subscriptionIds:[],productIds:[]};c.each(b,function(a){g.address=a.address,c.contains(g.customerIds,a.customerId)||g.customerIds.push(a.customerId),c.contains(g.subscriptionIds,a.subscriptionId)||g.subscriptionIds.push(a.subscriptionId),c.contains(g.productIds,a.productId)||g.productIds.push(a.productId)}),a.populateBADetails(g,f),e.push(g)}),a.set("finalServiceList",e);var g={newcustomer:a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerExists"),nric:a.get("nric"),isLocalCustomer:a.isLocalCustomer(a.get("nric"))};a.set("customerDetails",g),a.set("singtelEnergyServicesVmStatus","DataLoaded")})},populateBADetails:function(a,b){if(b&&b.length>0){c.find(b,function(b){var d=c.find(b.subscribers,function(d){if(c.contains(a.subscriptionIds,d.subscriberResourceVal))return a.barNumber=b.billingAccountNumber,!0});if(d)return!0})}},onLoadServicesSuccess:function(a,b,d,e){var f=this;if("undefined"!=typeof e.Products){f.set("singtelEnergyServicesVmStatus","reContractListFetched");var g=e.Products.products,h=f.get("servicesDetails")||[];c.each(g,function(a){if(a.address&&a.address.postCode){var b={address:a.address,customerId:a.customerId,productId:a.id,subscriptionId:a.subscriptionId};h.push(b)}}),f.set("servicesDetails",h)}else f.getErrorMessage()},registerCustomer:function(){var a=this,b=a.get("contactId");b?a.updateContact():a.onUpdateSuccess()},updateContactDetails:function(){var a=this,b=a.get("contactData"),c={ImplContactPerson:{phone:b.phone,emailId:b.email}},d=a.getModel("updateContactDetailsModel");d.save(c,{id:a.get("contactId"),success:function(b,c){a.findBillingAccount()},error:function(b,c){a.getErrorMessage()}})},updateContact:function(){var a=this,d=a.get("contactData"),e=a.get("contactId"),f=a.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");f="staff"===f?"Staff":"cis"===f?"CIS - IDD":null;var g=(a.get("nric").substring(0,1),d.billingAddress);"Select"===g.floorNo&&(g.floorNo=""),"Select"===g.unitNo&&(g.unitNo="");var h={ImplContactPerson:{birthDate:d.birthDate,emailId:d.email,name:d.registeredName,phone:d.phone,nationality:"Singaporean",salutation:d.salutation,personGender:d.gender,address:{apartment:g.apartment||g.floorNo,city:g.city,floor:g.floorNo,postcode:g.postCode||g.postCode,room:g.unitNo,unitNumber:g.apartment||g.floorNo,houseNumber:g.blockOrHouseNum,state:g.state,country:g.country,streetName:g.streetName,blockOrHouseNum:g.blockOrHouseNum,blockOrHouseAddr:b.get("IS_BLOCKORHOUSEADDR")?g.blockOrHouseAddr:"",buildingName:g.buildingName,countryCode:g.country,unstructAddress:!1,buildingClassification:g.buildingClassification,addressType:"Standard"}}};f&&(h.ImplContactPerson.personVipCodeX9=f);var i=a.getModel("updateContactDetailsModel");i.save(h,{id:e,success:c.bind(a.onUpdateSuccess,a),error:c.bind(a.getErrorMessage,a)})},onUpdateSuccess:function(a,c){var d=this,e=d.get("contactData"),f=d.get("customerIds"),g=e.billingAddress,h=d.get("contactId"),i=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");i="staff"===i?"Staff":"cis"===i?"CIS - IDD":null;d.get("nric").substring(0,1);if("Select"===g.floorNo&&(g.floorNo=""),"Select"===g.unitNo&&(g.unitNo=""),f&&f.length>0)d.subViewModels.customerInContextTopicViewModel.set("ID",f[0]),d.findBillingAccount();else{var j={personIdentificationDetails:{type:d.get("customerIdType"),docNumber:d.get("nric")},givenName:e.registeredName,familyName:e.registeredName,custType:"D",custSubType:"N",phone:e.phone,email:e.email,address:{apartment:g.apartment||g.floorNo,city:g.city,floor:g.floorNo,postcode:g.postCode||g.postCode,room:g.unitNo,unitNumber:g.apartment||g.floorNo,houseNumber:g.blockOrHouseNum,state:g.state,country:g.country,streetName:g.streetName,blockOrHouseNum:g.blockOrHouseNum,blockOrHouseAddr:b.get("IS_BLOCKORHOUSEADDR")?g.blockOrHouseAddr:"",buildingName:g.buildingName,countryCode:g.country,unstructAddress:!1,buildingClassification:g.buildingClassification,addressType:"Standard"},billingAddressSame:!0,salutation:e.salutation,gender:e.gender,birthDate:e.birthDate,nationality:"Singaporean",race:"Others",customerOwningEntity:"Singapore",customerAccountCategory:"Non In-house",timeZone:"GMT+8",language:"zh-TW",contactId:h};i&&(j.contactVipCodeX9=i),d.models.createCustomerModel.save({ImplCreateCustomerInput:j},{success:function(a,b){"undefined"!=typeof b.ImplCreateCustomerOutput?(d.subViewModels.customerInContextTopicViewModel.set("ID",b.ImplCreateCustomerOutput.customerId),b.ImplCreateCustomerOutput.conatctId&&d.subViewModels.individualInContextTopicViewModel.set("personId",b.ImplCreateCustomerOutput.conatctId),d.set("singtelEnergyServicesVmStatus","CustomerCreated"),d.findBillingAccount()):d.getErrorMessage()},error:function(){d.getErrorMessage()}})}},findBillingAccount:function(){var a=this,b=a.get("accounts"),d=a.get("contactData");a.set("singtelEnergyServicesVmStatus","findingAccount");var e=d.billingAddress;if(b&&b.length>0){var f=c.find(b,function(a){var b=a.physicalAddress;if(b.postcode===e.postCode&&b.houseNumber===e.blockOrHouseNum&&(b.floor===e.apartment||b.floor===e.floorNo||b.room===e.apartment||b.room===e.floorNo||b.unitNumber===e.apartment||b.unitNumber===e.floorNo)){if(!(a.subscribers&&a.subscribers.length>0))return!0;var d=c.find(a.subscribers,function(a){return"ENRG"===a.subscriberType&&(65===a.subscrStatus||83===a.subscrStatus)});if(!d)return!0}});f?(a.subViewModels.orderInContextTopicViewModel.set("customerID",f.customerId),a.subViewModels.orderInContextTopicViewModel.set("barId",f.billingAccountNumber),a.set("singtelEnergyServicesVmStatus","BarIdentified")):a.createBillAddress("METH_NON_PAPER",e)}else{var g=a.subViewModels.customerInContextTopicViewModel.get("ID");if("undefined"==typeof g||null===g){var h=a.get("customerIds");g=h[0]}a.subViewModels.orderInContextTopicViewModel.set("customerID",g),a.createBillAddress("METH_NON_PAPER",e)}},createBillAddress:function(a,b){var c=this;c.subViewModels.deviceIdAndPlanIdInContextTopic.set("isNewBar",!0);var d=b.unitNo||b.unitNumber||b.apartment,e={ImplBillingAccountCreateRequest:{deliveryMethod:a,nickName:b.nickName||"singtelAccount",isEasyMobile:!1,physicalAddress:{floor:d,room:d,houseNumber:b.blockOrHouseNum,postcode:b.postcode||b.postCode,streetName:b.streetName,unitNumber:d,blockOrHouseAddr:"APT Blk",state:b.state,apartment:d,country:b.country,buildingName:b.buildingName}}},f=c.getModel("billingAccountDetailedListModel"),g=c.subViewModels.orderInContextTopicViewModel.get("customerID")||c.subViewModels.customerInContextTopicViewModel.get("ID");if("undefined"==typeof g||null===g){var h=c.get("customerIds");g=h[0]}c.subViewModels.orderInContextTopicViewModel.set("customerID",g),f.save(e,{customerId:c.subViewModels.orderInContextTopicViewModel.get("customerID"),success:function(a,b){b.ImplBillingAccountCreateResponse?(c.subViewModels.orderInContextTopicViewModel.set("barId",b.ImplBillingAccountCreateResponse.billingArangmentId),c.set("singtelEnergyServicesVmStatus","BarIdentified")):c.getErrorMessage()},error:function(){c.getErrorMessage()}})},notOwner:function(){var a=this;a.set("singtelEnergyServicesVmStatus","EnteringnotOwner");var b=a.get("contactData"),c=b.accountNo,d=b.accountHolderName,e=b.startDate,f=b.installationAddress,g=b.billingAddress,h=a.convertAddressToString(g),i=a.convertAddressToString(f),j=b.housingDetails,k={accountNo:c,accountHolderName:d,startDate:e,billingAddress:h,serviceAddress:i,housingDetails:j};a.subViewModels.deviceIdAndPlanIdInContextTopic.set("energyAddress",k),a.set("singtelEnergyServicesVmStatus","notOwnerDataSet")},serviceUnavailable:function(){var a=this;a.set("singtelEnergyServicesVmStatus","EnteringServiceUnavailable");var b=a.get("contactData"),c=a.convertAddressToString(b.installationAddress),d={serviceAddress:c};a.subViewModels.deviceIdAndPlanIdInContextTopic.set("energyAddress",d),a.set("singtelEnergyServicesVmStatus","serviceUnavailableSet")},isLocalCustomer:function(a){var b=!1;return a&&(a.toUpperCase().startsWith("S")||a.toUpperCase().startsWith("T"))&&(b=!0),b},convertAddressToString:function(a){var b=a.blockOrHouseNum+" "+a.streetName;return(a.apartment||a.floorNo||a.floor)&&(b=b+" "+(a.apartment||a.floorNo||a.floor)),a.postCode&&(b=b+" "+a.postCode),b}});return p});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderConfirmationViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic"],function (a,b,c,d,e,f,g,h,i){var j=a.Core.ObservableViewModel.extend({defaults:{contactId:null,nric:null,customerIdType:null,orderStaticDetails:null,singtelEnergyConfirmVmStatus:null,orderData:null,productOrderReferenceNumber:null,productOrderID:null},models:{},subViewModels:{customerInContextTopicViewModel:d,onePassTopicViewModel:e,individualInContextTopicViewModel:f,orderInContextTopicViewModel:h,clearContextInContextTopic:i,deviceIdAndPlanIdInContextTopic:g},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{productOrderReferenceNumber:"subViewModels.orderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"clearData");var b=this;setTimeout(function(){b.set("singtelEnergyConfirmVmStatus","vmInitialized");var a=b.subViewModels.orderInContextTopicViewModel.get("productOrderID");a?(b.set("productOrderID",a),b.set("singtelEnergyConfirmVmStatus","DataLoaded"),b.clearData()):(b.set("singtelEnergyConfirmVmStatus","DataMissing"),b.clearData())},0)},clearData:function(){var a=this;a.subViewModels.clearContextInContextTopic.clearAllTopics(!0)}});return j});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderSummaryViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/model/GetBillingAccountDetailedListModel","businesswidget/repository_l9_common/common/model/CustomerSubmitOrderModel","moment","businesswidget/repository_l9_common/common/model/GenerateAndDisplayContractModel","businesswidget/repository_l9_common/common/model/SearchAddressinCRMModel","businesswidget/repository_l9_common/common/model/IdUploadDocumentPersistModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.Core.ObservableViewModel.extend({defaults:{contactId:null,nric:null,customerIdType:null,orderStaticDetails:null,singtelEnergySummaryVmStatus:null,orderData:null,productOrderReferenceNumber:null},models:{viewUpdateCustomerProfileModel:k,getBillingAccountDetailedListModel:l,customerSubmitOrderModel:m,generateAndDisplayContractModel:o,searchAddressinCRMModel:p,idUploadDocumentPersistModel:q},subViewModels:{customerInContextTopicViewModel:d,onePassTopicViewModel:e,individualInContextTopicViewModel:f,updateProductConfigurationViewModel:i,orderInContextTopicViewModel:h,clearContextInContextTopic:j,deviceIdAndPlanIdInContextTopic:g},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}},{productOrderReferenceNumber:"subViewModels.orderInContextTopicViewModel.productOrderReferenceNumber",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"setHeaders","setDefaultQueryParams","getErrorMessage","getPersonDetails","activateLoadData","onPersonalDetailsSuccess","onRetrieveProductConfig","getBillingAddress","getProductConfigurationPayload","getInstallationAddress","setAddress","submitOrder","checkAllDataPopulated","generateContract","finalOrderSubmission");var b=this;setTimeout(function(){b.set("singtelEnergySummaryVmStatus","vmInitialized");var a=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("planId"),c=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("numberType");if("ENERGY"!==c||"undefined"==typeof a||null===a)b.set("singtelEnergyServicesVmStatus","dataIsNotPresent");else{var d=b.subViewModels.orderInContextTopicViewModel.get("barId");d?b.getBillingAddress(d):b.getErrorMessage();var e=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("installationAddressID");e?b.getInstallationAddress(e):b.getErrorMessage(),b.getPersonDetails(),b.activateLoadData()}},0)},checkAllDataPopulated:function(a){if(a.billingAccount&&a.installationAddress&&a.personalInfo&&a.order){var b=a.installationAddress,c=a.billingAccount.physicalAddress;return b.postcode!==c.postcode||b.blockOrHouseNum!==c.houseNumber||b.unitNumber!==c.unitNumber&&b.unitNumber!==c.floor&&b.unitNumber!==c.room&&b.floor!==c.unitNumber&&b.floor!==c.floor&&b.floor!==c.room||(a.hasSameBAIA=!0),!0}return!1},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},getErrorMessage:function(){var a=this;a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("singtelEnergySummaryVmStatus","failure")},getPersonDetails:function(){var a=this.get("contactId"),b=this;if("undefined"!=typeof a&&null!==a){var d=(this.get("orderData")||{},this.getModel("viewUpdateCustomerProfileModel"));d.set("id",this.get("contactId")),d.fetch({success:c.bind(this.onPersonalDetailsSuccess,this),error:c.bind(this.getErrorMessage,this)})}else b.getErrorMessage()},onPersonalDetailsSuccess:function(a,b){var c=this,d={},e=b.ImplContactPersonOutput.implContactPerson;void 0!=e.implPhysicalAddressDetails&&(d.postalCode=e.implPhysicalAddressDetails.postcode),
d.gender=e.personGender,d.fullName=e.name,d.firstName=e.firstName,d.lastName=e.lastName,d.dateOfBirth=e.birthDate,d.emailId=e.emailId,d.contactNumber=e.phone,"undefined"!=typeof e.nricNumber&&(d.nricNumber=e.nricNumber,d.nricType=e.nricType),"undefined"!=typeof e.documentId&&(d.nricNumber=e.documentId,d.nricType=e.documentType);var f=this.get("orderData")||{};f.personalInfo=d;var g=c.checkAllDataPopulated(f);c.set("orderData",f),g&&c.set("singtelEnergySummaryVmStatus","DataLoaded")},activateLoadData:function(a){var b=this,c=b.get("productOrderReferenceNumber");if("undefined"!=typeof c&&null!==c&&""!==c){var d=b.getProductConfigurationPayload(),e=b.subViewModels.updateProductConfigurationViewModel._retrieveProductConfiguration("WL",d);e.done(function(a){"undefined"!=typeof a.RetrieveProductInOrderConfigurationResponse&&b.onRetrieveProductConfig(a.RetrieveProductInOrderConfigurationResponse)}.bind(b)),e.fail(function(a){b.getErrorMessage()}.bind(b))}else b.getErrorMessage()},onRetrieveProductConfig:function(a){var b=this,d=a.productConfiguration.displayableItems,e={};if(d&&d.length>0){c.each(d,function(a){"18628731"===a.productSpecContainmentID||"Singtel Energy Main"===a.name?a.displayableCharacteristics&&c.each(a.displayableCharacteristics,function(a){"18611511"===a.productSpecCharacteristicID&&a.value?e.preferredSrd=n.unix(a.value/1e3).format("DD-MM-YYYY"):"18611491"===a.productSpecCharacteristicID&&a.value&&(e.spAccountNumber=a.value)}):"18645531"===a.productSpecContainmentID||"Dwelling Info"===a.name?c.each(a.displayableCharacteristics,function(a){"18611501"===a.productSpecCharacteristicID&&a.value&&(e.typeOfHousing=a.value)}):"18645511"===a.productSpecContainmentID||"Singtel Energy Plan"===a.name?c.each(a.displayableBillingOffers,function(a){a.selected&&!c.contains(["Energy Services","Product Holding Discount","Singtel Energy Plan - Technical Price Plan"],a.name)&&(e.planName=a.name,e.planId=a.productSpecPricing.childPricingSchema.id)}):!a.selected||"18650061"!==a.productSpecContainmentID&&"Singtel Energy Rebate"!==a.name||c.each(a.displayableBillingOffers,function(a){a.selected&&(e.singtelDiscount=a.name)})});var f=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerExists");f||(e.singtelDiscount="Additional 5% Discount")}var g=b.get("orderData")||{};g.order=e;var h=b.checkAllDataPopulated(g);b.set("orderData",g),h&&(b.generateContract(),b.set("singtelEnergySummaryVmStatus","DataLoaded"))},getProductConfigurationPayload:function(){var a={activityForConfiguration:"QuoteSDOrderSummary",configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};return a},getBillingAddress:function(a){var b=this,d=b.subViewModels.orderInContextTopicViewModel.get("customerID"),e=this.getModel("getBillingAccountDetailedListModel"),f=["X","T"];e.setQueryParams({includeBAStatus:f}),e.set("type","CUSTOMER"),e.fetch({id:d,success:function(d,e){if("undefined"!=typeof e.ImplBillingAccountDetailsResponse){var f=b.get("orderData")||{},g=c.find(e.ImplBillingAccountDetailsResponse.billingAccountDetails,function(b){return b.billingAccountNumber===a});f.billingAccount=g;var h=g.physicalAddress;f.billingAddressDisplay=h.houseNumber+" "+h.streetName,h.buildingName&&(f.billingAddressDisplay=f.billingAddressDisplay+", "+h.buildingName),h.unitNumber&&(f.billingAddressDisplay=f.billingAddressDisplay+", "+h.unitNumber),h.city?f.billingAddressDisplay=f.billingAddressDisplay+", "+h.city:f.billingAddressDisplay=f.billingAddressDisplay+", Singapore",f.billingAddressDisplay=f.billingAddressDisplay+" "+h.postcode;var i=b.checkAllDataPopulated(f);b.set("orderData",f),i&&(b.generateContract(),b.set("singtelEnergySummaryVmStatus","DataLoaded"))}else b.getErrorMessage()},error:function(){b.getErrorMessage()}})},getInstallationAddress:function(a){var b=this,d=b.getModel("searchAddressinCRMModel");d.setQueryParams({addressIds:[a]}),d.fetch({success:c.bind(b.setAddress,b,a),error:c.bind(b.getErrorMessage,b)})},setAddress:function(a,b,c){var d=this,e=c.HashMap,f=d.get("orderData")||{};f.installationAddress=e[a],f.installationAddressDisplay=f.installationAddress.blockOrHouseNum+" "+f.installationAddress.streetName,f.installationAddress.buildingName&&(f.installationAddressDisplay=f.installationAddressDisplay+", "+f.installationAddress.buildingName),f.installationAddress.apartment&&(f.installationAddressDisplay=f.installationAddressDisplay+", "+f.installationAddress.apartment),f.installationAddress.city?f.installationAddressDisplay=f.installationAddressDisplay+", "+f.installationAddress.city:f.installationAddressDisplay=f.installationAddressDisplay+", Singapore",f.installationAddressDisplay=f.installationAddressDisplay+" "+f.installationAddress.postcode;var g=d.checkAllDataPopulated(f);d.set("orderData",f),g&&(d.generateContract(),d.set("singtelEnergySummaryVmStatus","DataLoaded"))},generateContract:function(){var a=this,b=a.getModel("generateAndDisplayContractModel"),d=a.subViewModels.orderInContextTopicViewModel;b.set("orderId",d.get("productOrderID")),b.set("barId",d.get("barId")),b.fetch({success:function(b,e){if(e.ImplGenerateAndDisplayContractRestOutput){var f=e.ImplGenerateAndDisplayContractRestOutput;if(f.contractList&&f.contractList.length>0){var g=[];c.each(f.contractList,function(a){g.push({documentID:a.documentId})})}d.set("contractList",g)}else a.getErrorMessage()},error:function(b,c){a.getErrorMessage()}})},submitOrder:function(){var a=this,b=a.getModel("idUploadDocumentPersistModel");b.set({orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),contactId:a.get("contactId")}),b.save(null,{success:function(b,c){a.finalOrderSubmission()},error:function(b){a.getErrorMessage()}})},finalOrderSubmission:function(){var a=this,b=a.getModel("customerSubmitOrderModel");b.set("customerId",a.subViewModels.orderInContextTopicViewModel.get("customerID")),b.setQueryParams({orderIds:a.get("productOrderReferenceNumber"),us:!0}),b.save(null,{success:function(b,c){a.set("singtelEnergySummaryVmStatus","orderSuccess")},error:function(){a.set("singtelEnergySummaryVmStatus","orderFailure"),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0)}})}});return r});
define("businesswidget/repository_l9_common/common/model/UpdateProductOrderDetailsModels",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/energy/customer/:customerId/order/:orderId/update-order-details",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},update:{contentType:"application/json",method:"POST",payload:["ImplProductOrderDetails"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderingViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/CreateAddressModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository_l9_common/common/viewmodel/NewProductInOfferingInstanceViewModel","businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel","businesswidget/repository_l9_common/common/model/UpdateProductOrderDetailsModels","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","businesswidget/repository/common/model/CommerceCustomerProductOrderPayChannelModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=a.Core.ObservableViewModel.extend({defaults:{contactId:null,nric:null,customerIdType:null,orderStaticDetails:null,singtelEnergyOrderingVmStatus:null,address:null,orderingData:null},models:{createAddressModel:d,billSpecIdPayChannelModel:l,updateProductOrderDetailsModels:m,productOrderPayChannelModel:o},subViewModels:{customerInContextTopicViewModel:e,onePassTopicViewModel:f,individualInContextTopicViewModel:g,newProductInOfferingInstanceViewModel:j,updateProductConfigurationViewModel:k,orderInContextTopicViewModel:i,clearContextInContextTopic:n,deviceIdAndPlanIdInContextTopic:h},dataBindings:[{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{customerIdType:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(a){this._super(a),c.bindAll(this,"setHeaders","setDefaultQueryParams","getErrorMessage","createAddress","onCreateAddressSuccess","_saveOrderData","getProductConfigurationPayload","getBillSpecIdPayChannel","updateProductOrder");var b=this;b.subViewModels.newProductInOfferingInstanceViewModel.on("dataSet",b._saveOrderData,b),b.subViewModels.newProductInOfferingInstanceViewModel.on("orderFailure",b.getErrorMessage,b),setTimeout(function(){b.set("singtelEnergyOrderingVmStatus","vmInitialized")},0)},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},createAddress:function(){var a=this,b=a.get("address");if(void 0!==typeof b&&null!==b){var c=(b.unitNo||b.apartment,b.floorNo||b.floor,{CreateAddressRequest:{address:{apartment:b.apartment||b.floorNo||b.floor,floor:b.floor||b.floorNo,postalCode:b.postCode,street:b.streetName,streetNumber:b.blockOrHouseNum,address2:b.blockOrHouseNum,country:b.country,state:b.state,city:b.city,address1:b.blockOrHouseAddr,address3:b.buildingName,buildingClassificationX8:b.buildingClassification}}});a.getModel("createAddressModel").save(c,{success:a.onCreateAddressSuccess,error:function(){a.getErrorMessage()}})}},getErrorMessage:function(){var a=this;a.subViewModels.clearContextInContextTopic.clearAllTopics(!0),a.set("singtelEnergyOrderingVmStatus","failure")},onCreateAddressSuccess:function(a,b){var c=this;this.subViewModels.deviceIdAndPlanIdInContextTopic.set("installationAddressID",b.CreateAddressResponse.address.ID);var d=c.get("orderStaticDetails"),e=this.subViewModels.deviceIdAndPlanIdInContextTopic.get("addonDetails");e&&e.length>0&&this.subViewModels.newProductInOfferingInstanceViewModel.set("addonDetails",e),this.subViewModels.newProductInOfferingInstanceViewModel.set("orderingData",this.get("orderingData")),this.subViewModels.newProductInOfferingInstanceViewModel.set("flowType",d.flowType),this.subViewModels.newProductInOfferingInstanceViewModel.set("dealerID",d.dealerID),this.subViewModels.newProductInOfferingInstanceViewModel.set("vendorID",d.vendorID),this.subViewModels.newProductInOfferingInstanceViewModel.createOrder(!0,b.CreateAddressResponse.address.ID),this.set("singtelEnergyOrderingVmStatus","addressCreated")},_saveOrderData:function(){var a=this,b=a.subViewModels.orderInContextTopicViewModel.get("currentOrderActions");if(b&&b.length>0){var d=b[0].productOrderItemID,e=b[0].productID,f=a.getProductConfigurationPayload(e),g=a.subViewModels.updateProductConfigurationViewModel._updateProductConfiguration("WL",f,d);g.done(function(b){if("undefined"!=typeof b.UpdateProductInOrderConfigurationResponse){var d=b.UpdateProductInOrderConfigurationResponse.productConfiguration;if("BLOCKING"===d.compatibilityStatus){var e=[];c.each(d.messages,function(a){"ERROR"===a.severity&&e.push(a.text)}),a.set("blockingMessages",e),a.getErrorMessage()}else a.getBillSpecIdPayChannel()}else a.getErrorMessage()}.bind(a)),g.fail(function(b){a.getErrorMessage()}.bind(a))}else a.getErrorMessage()},getProductConfigurationPayload:function(a){var b={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:[],changedContainedProducts:[{productID:a}],suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}};return b},getBillSpecIdPayChannel:function(){var a=this,b=a.subViewModels.orderInContextTopicViewModel.get("barId");if(void 0!==typeof b||null!==b){var c=this.getModel("billSpecIdPayChannelModel");c.set("customerBillSpecId",b),c.fetch({success:function(b,c){a.updateProductOrderPayChannel(c)},error:function(){a.getErrorMessage()}})}else a.getErrorMessage()},updateProductOrderPayChannel:function(a){var b=this;if(void 0!==typeof a&&null!==a){var d=b.subViewModels.orderInContextTopicViewModel.get("orderActions"),e=[];c.each(d,function(b){e.push({paymentCatergory:"POST",pcnId:a,productOrderItemId:b.productOrderItemID})});var f={PayChannelProductOrderDetails:{productOrderDetails:e}},g=b.getModel("productOrderPayChannelModel");g.save(f,{productOrderId:b.subViewModels.orderInContextTopicViewModel.get("productOrderID"),customerId:b.subViewModels.orderInContextTopicViewModel.get("customerID"),success:c.bind(b.updateProductOrder,b),error:function(){b.getErrorMessage()}})}else b.getErrorMessage()},updateProductOrder:function(){var a=this,b=a.get("orderingData"),d=a.subViewModels.orderInContextTopicViewModel.get("orderActions"),e=[],f=a.get("contactId")||a.subViewModels.individualInContextTopicViewModel.get("personId");c.each(d,function(a){e.push({productOrderItemId:a.productOrderItemID,contactId:f,userOnBehalf:"Online",srdDate:b.startDate,orderActionType:"Change"===a.orderType?"CH":"PR"})});var g={ImplProductOrderDetails:{orderActionDetails:e}},h=a.getModel("updateProductOrderDetailsModels");h.save(g,{orderId:a.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber"),customerId:a.subViewModels.orderInContextTopicViewModel.get("customerID"),success:function(b,c){a.set("singtelEnergyOrderingVmStatus","OrderSuccess")},error:function(){a.getErrorMessage()}})}});return p});
define("businesswidget/repository_l9_common/common/viewmodel/business/SingtelOneClickViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic"],function (a,b,c,d){return a.Core.ObservableViewModel.extend({defaults:{oneClickVmStatus:"",oneClickData:null},subViewModels:{deviceIdAndPlanIdInContextTopic:c,clearContextInContextTopic:d},initialize:function(){this._super();var a=this;b.bindAll(a,"setOneClickData","clearAllTopics"),a.subViewModels.clearContextInContextTopic.clearAllTopics(!0,!0),setTimeout(function(){a.set("oneClickVmStatus","vmInitialized")}.bind(a),0)},setOneClickData:function(){var a=this;a.set("oneClickVmStatus","settingData");var b=a.get("oneClickData");a.subViewModels.deviceIdAndPlanIdInContextTopic.set("oneClickData",b),a.set("oneClickVmStatus","oneClickDataSet")},clearAllTopics:function(){var a=this;a.subViewModels.clearContextInContextTopic.clearAllTopics(!0,!0),a.set("oneClickVmStatus","dataCleared")}})});
define("businesswidget/repository_l9_common/common/model/ImplServiceAgreementModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/crm/type/:type/id/:docId/getdocumentList",rest:{defaults:{method:"GET"}}}});return b});
define("businesswidget/repository_l9_common/common/model/ImplDownloadDocumentModel",["businesswidget/repository/common/core/RESTModel"],function (a){var b=a.extend({options:{url:"/customer/:custId/download-document",rest:{defaults:{method:"GET"}}}});return b});
define("businesswidget/repository_l9_common/common/viewmodel/ImplServiceAgreementViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/ImplServiceAgreementModel","businesswidget/repository_l9_common/common/model/ImplDownloadDocumentModel"],function (a,b,c,d,e,f,g){var h=a.Core.ObservableViewModel.extend({models:{implServiceAgreementModel:f,implDownloadDocumentModel:g},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}},{nric:"subViewModels.onePassTopicViewModel.nric",options:{twoWay:!1,setOnBind:!0}},{type:"subViewModels.onePassTopicViewModel.customerIdType",options:{twoWay:!1,setOnBind:!0}}],subViewModels:{customerInContextTopicViewModel:d,onePassTopicViewModel:e},defaults:{customerId:null,nric:null,type:null,docId:null,docList:[],serviceAgreementVmStatus:null},initialize:function(a){this.set("serviceAgreementVmStatus","serviceAgreementVmInitialized"),this.on("change:nric",this.getDocumentList,this),this.on("change:type",this.getDocumentList,this)},getDocumentList:function(){if(this.get("nric")&&this.get("type")){this.set("serviceAgreementVmStatus","getDocumentListInitialized");var a=new Date,b=a;b=new Date(b.setMonth(a.getMonth()-3)),this.models.implServiceAgreementModel.setQueryParams({isContractX9:"All"}),this.models.implServiceAgreementModel.set({type:this.getCustomerType(this.get("type")),docId:this.get("nric")}),this.models.implServiceAgreementModel.fetch({success:c.bind(this.documentListSuccess,this),error:c.bind(this.documentListError,this)})}},getCustomerType:function(a){switch(a){case"National Registration ID Card (NRIC)":a="NRIC";break;case"Foreign Identification Number":a="NRIC";break;case"Foreign Identification Number (FIN)":a="FIN";break;case"Foreigner Dependent Pass":a="FDP";break;case"Foreigner Employment Pass":a="FEP";break;case"Foreigner S Pass":a="FSP";break;case"Foreigner Student Pass":a="FSTP";break;case"Passport Number":a="PASSPORT";break;case"Foreigner Social Visit Pass":a="VSVP";break;case"Foreigner Work Permit":a="FWP";break;case"Diplomat":a="DIPLOMAT";break;case"Entre Pass":a="EPASS"}return a},documentListSuccess:function(a,b){b&&b["ImplRetrieveDocumentListOutput[]"]?(this.set("serviceAgreementVmStatus","getDocumentListSuccess"),this.set("docList",b["ImplRetrieveDocumentListOutput[]"])):this.set("serviceAgreementVmStatus","getDocumentListEmpty")},documentListError:function(a,b){this.set("serviceAgreementVmStatus","getDocumentListFailed")},downloadDocument:function(){var a=this;this.set("serviceAgreementVmStatus","downloadDocInitialized");var b=a.get("docId");this.models.implDownloadDocumentModel.setQueryParams({id:b}),a.models.implDownloadDocumentModel.set({custId:a.get("customerId")}),a.models.implDownloadDocumentModel.fetch({success:c.bind(a.downloadDocSuccess,a),error:c.bind(a.downloadDocError,a)})},downloadDocSuccess:function(a,b){this.set("serviceAgreementVmStatus","downloadDocSuccess");var c=b.ImplDownloadDocRestOutput.fileBytes;if(c){for(var d=Date.now()+"_"+this.get("docId")+".pdf",e="application/pdf",f=window.Blob||window.MozBlob||window.WebKitBlob,g=atob(c),h=g.length,i=new Uint8Array(h),j=0;j<h;j++)i[j]=g.charCodeAt(j);var k=new f([i],{type:e});if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(k,d);else{var l=window.URL||window.webkitURL,m=l.createObjectURL(k),n=document.createElement("a");if(navigator.userAgent.match("CriOS")){var o=new FileReader;o.onload=function(a){n.href=o.result,n.download=d,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},o.readAsDataURL(k)}else n.href=m,n.download=d,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}},downloadDocError:function(a,b){this.set("serviceAgreementVmStatus","downloadDocError")}});return h});
define("businesswidget/repository_l9_common/common/viewmodel/business/ConsolidateAppointmentViewModel",["lightsaber","underscore","moment","single!businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel","businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel"],function (a,b,c,d,e){var f=a.Core.ObservableViewModel.extend({models:{},subViewModels:{logisticsDispatchAppointmetSlotViewModel:d,storeEAppointmentViewModel:e},defaults:{exisitingAppointmentStatus:"",orderConsolidationResponse:[]},initialize:function(){b.bindAll(this,"getExisitingAppointment")},getExisitingAppointment:function(){var a=this,b=a.subViewModels.logisticsDispatchAppointmetSlotViewModel.checkForOrderConsolidation(),c=a.subViewModels.storeEAppointmentViewModel.retrieveExistingAppointment();a.set({orderConsolidationResponse:[],exisitingAppointmentStatus:"retrievingConsolidationSlots"}),$.when(b,c).done(function(b,c){if(b&&c){var d=a.subViewModels.logisticsDispatchAppointmetSlotViewModel.get("orderConsolidationResponse")||[],e=a.subViewModels.storeEAppointmentViewModel.get("existingAptDetails")||[],f=d.concat(e);0===f.length?a.set("exisitingAppointmentStatus","consolidationSlotsNotFound"):a.set({orderConsolidationResponse:f,exisitingAppointmentStatus:"consolidationSlotsRetrieved"})}})}});return f});
define("businesswidget/repository_l9_common/common/model/RetrievePrepaidSubscriptionsModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/contact-person/:contactId/retrievePrepaidSubscriptions",rest:{defaults:{method:"GET",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/model/FindCustomerModel",["businesswidget/repository/common/core/RESTModel","lightsaber"],function (a,b){var c=a.extend({options:{url:"/contact/:contactId/findCustomer",rest:{defaults:{method:"GET",qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}});return c});
define("businesswidget/repository_l9_common/common/viewmodel/business/PrepaidServicesViewModel",["lightsaber","Configuration","underscore","businesswidget/repository_l9_common/common/model/RetrievePrepaidSubscriptionsModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","businesswidget/repository_l9_common/common/model/FindCustomerModel","businesswidget/repository_l9_common/common/model/UpdateContactDetailsModel","businesswidget/repository_l9_common/common/model/createCustomerModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","businesswidget/repository_l9_common/common/model/viewServiceDetailModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository_l9_common/common/model/SubmitProductConfigurationModel","businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SimOnlyPlanViewModel","businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","single!businesswidget/repository_l9_common/common/viewmodel/business/PreTickAddonViewModel","single!businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository_l9_common/common/model/UpdateContactModel","single!businesswidget/repository_l9_common/common/viewmodel/business/CheckPendingOnPendingOrderViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D=a.Core.ObservableViewModel.extend({defaults:{prepaidServicesVmStatus:null,contactId:null,prepaidDetails:[],gomoDetails:[],customerDetails:null,customerMinimalInformation:null,validateNumberDetails:null,retrieveContactId:null,finalNumberDetails:null,deviceInformationContainment:null,vendorCode:null,dealerCode:null,flowType:null,isContactUpdated:!1,isUpdateOrderReq:!1,addComponentList:null,preTickAddonDetails:null,customerID:null},subViewModels:{individualInContextTopicViewModel:e,onePassTopicViewModel:f,worryFreeContextTopicViewModel:j,deviceIdAndPlanIdInContextTopic:k,orderInContextTopicViewModel:m,pickAndGoViewModel:q,simOnlyPlanViewModel:r,clearContextInContextTopic:s,preTickAddonViewModel:t,checkPendingOnPendingOrderViewModel:x,miniCartInContextTopic:y,customerInContextTopicViewModel:A,contactInContextTopicViewModel:B,implUserContextTopicViewModel:C},models:{retrievePrepaidSubscriptionsModel:d,findCustomerModel:g,updateContactDetailsModel:h,createCustomerModel:i,viewServiceDetailModel:l,customerProductOrderProductOrderItemsModel:o,anonymousProductOrderProductOrderItemsModel:n,submitProductConfigurationModel:p,updateProductConfigurationModel:u,anonymousUpdateProductConfigurationModel:v,updateContactModel:w,findCallerByContactModel:z},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(){c.bindAll(this,"getPrepaidServices","onGetPrepaidServicesSuccess","onGetPrepaidServicesFailure","checkNumber","wrapUpdateContact","getCustomerDetails","onUpdateFailure","onGetCustomerDetailsSuccess","onGetCustomerDetailsFailure","updateContact","onUpdateSuccess","getPrepaidDetails","createInputPayload","createChangeOwnershipOrder","handleOrder","processOutput","updateSimOnlyPlan","setHeaders","setDefaultQueryParams","getSuccessMessage","updateOrderContact","checkPendingOrders","fetchAcceptorUserInfo"),this.subViewModels.checkPendingOnPendingOrderViewModel.on("prepaidOrdersDeleted",this.handleOrder,this)},checkNumber:function(){var a=this,b=a.get("validateNumberDetails");if(a.set("prepaidServicesVmStatus","checkNumber"),b&&b.number&&b.type){var d,e=a.get("retrieveContactId"),f=a.subViewModels.worryFreeContextTopicViewModel.get("otpData");if(d="prepaid"===b.type&&f&&f.passportDetails&&f.passportDetails.contactId?f.passportDetails.contactId:a.get("contactId"),e&&e===d){var g;if(g="gomo"===b.type?a.get("gomoDetails"):a.get("prepaidDetails"),g&&g.length>0){var h=c.find(g,function(a){return a.serviceId===b.number});h?(h.contactIdX8=d,a.getPrepaidDetails(h)):(a.set("finalNumberDetails",null),a.set("prepaidServicesVmStatus","checkNumberFailed"))}else a.set("finalNumberDetails",null),a.set("prepaidServicesVmStatus","checkNumberFailed")}else{var i=a.getPrepaidServices(d);i.done(function(e){if("success"===e){var f;if(f="gomo"===b.type?a.get("gomoDetails"):a.get("prepaidDetails"),f&&f.length>0){var g=c.find(f,function(a){return a.serviceId===b.number});g?(g.contactIdX8=d,a.getPrepaidDetails(g)):(a.set("finalNumberDetails",null),a.set("prepaidServicesVmStatus","checkNumberFailed"))}else a.set("finalNumberDetails",null),a.set("prepaidServicesVmStatus","checkNumberFailed")}else a.set("prepaidServicesVmStatus","getServicesAPIFailed")}.bind(a))}}else a.set("prepaidServicesVmStatus","checkNumberFailed")},getPrepaidDetails:function(a){var b=this,d=b.getModel("viewServiceDetailModel");d.set({customerId:a.customerIdX8,productId:a.id}),d.setQueryParams({allParams:!1}),d.fetch({success:c.bind(b.onGetPrepaidDetailsSuccess,b,a),error:c.bind(b.onGetPrepaidServicesFailure,b,null)})},onGetPrepaidDetailsSuccess:function(a,b,d){var e=this;if(d.Product.services&&d.Product.services.length>0){var f;c.find(d.Product.services,function(a){if("SIM"===a.catalogItemName||"8027872"===a.catalogItemID)return f=a.id,!0}),a.simProductID=f,e.set("finalNumberDetails",a);var g=e.subViewModels.onePassTopicViewModel.get(),h=e.subViewModels.worryFreeContextTopicViewModel.get("otpData");!g||"Passport Number"===g.customerIdType||h&&h.passportDetails&&h.passportDetails.contactId?e.set("prepaidServicesVmStatus","PrepaidServicesSuccess"):e.getCustomerDetails()}},getPrepaidServices:function(b){var d=$.Deferred(),e=this;if(e.set("prepaidServicesVmStatus","getdetails"),b=b||e.get("contactId")){var f=e.getModel("retrievePrepaidSubscriptionsModel");f.set({contactId:b});var g={sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")};f.setQueryParams(g),f.fetch({success:c.bind(e.onGetPrepaidServicesSuccess,e,d),error:c.bind(e.onGetPrepaidServicesFailure,e,d)})}else e.onGetPrepaidServicesFailure(d);return d},onGetPrepaidServicesFailure:function(a){this.set("prepaidServicesVmStatus","failed"),a&&a.resolve("failed")},onGetPrepaidServicesSuccess:function(a,d,e){var f=this;if(e&&e.ImplRetrievePrepaidSubsOutput){var g=[],h=[],i=b.get("gomoOfferIds");c.each(e.ImplRetrievePrepaidSubsOutput.products,function(a){c.contains(i,a.offeringId)?h.push(a):g.push(a)}),f.set("prepaidDetails",g),f.set("gomoDetails",h),f.set("retrieveContactId",f.get("contactId")),f.set("prepaidServicesVmStatus","GetPrepaidServicesSuccess"),a.resolve("success")}else f.onGetPrepaidServicesFailure(a)},getCustomerDetails:function(){var b=this;b.set("prepaidServicesVmStatus","getCustomer");var d=b.get("contactId");if(d){var e=b.getModel("findCustomerModel"),f=b.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");f="staff"===f?"Staff":"cis"===f?"CIS - IDD":null,f&&e.setQueryParams({customerType:f}),e.set({contactId:d});var g={sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")};e.setQueryParams(g),e.fetch({success:c.bind(b.onGetCustomerDetailsSuccess,b),error:c.bind(b.onGetCustomerDetailsFailure,b)})}else b.onGetCustomerDetailsFailure()},onGetCustomerDetailsFailure:function(){this.set("prepaidServicesVmStatus","customerServiceFailed")},onGetCustomerDetailsSuccess:function(a,b){var c=this;if(b&&b.ImplFindCustomerOutput){var d={customerExists:b.ImplFindCustomerOutput.customerExists,postpaidCustomerId:b.ImplFindCustomerOutput.customerId};c.set("customerDetails",d),c.set("prepaidServicesVmStatus","customerDetailsSuccess"),c.checkPendingOrders()}else c.onGetCustomerDetailsFailure()},checkPendingOrders:function(){var a=this,b=a.subViewModels.checkPendingOnPendingOrderViewModel;b.set("isPrepaidScenario",!0);var c=b.getPendingOrdersForCop(a.get("finalNumberDetails"));
$.when(c).done(function(c){if(c){var d=a.get("customerDetails"),e=a.subViewModels.worryFreeContextTopicViewModel.get("otpData");if(("undefined"==typeof d||null===d&&e&&e.passportDetails&&e.contactId&&e.passportDetails.contactId!==e.contactId)&&(d={postpaidCustomerId:a.subViewModels.customerInContextTopicViewModel.get("ID")},a.set("customerDetails",d)),"noPendingOrders"===c)a.handleOrder();else if("futureDatedSuspend"===c)a.set("prepaidServicesVmStatus",c);else if("pendingPayment"===c)a.set("isPaymentPending",!0),a.set("prepaidServicesVmStatus",c);else{var f=a.get("finalNumberDetails");b.cancelPendingOrders(f.customerIdX8)}}}.bind(a))},wrapUpdateContact:function(){var a=this;a.set("prepaidServicesVmStatus","register");var b=a.subViewModels.worryFreeContextTopicViewModel.get("acceptorData");b&&b.contactId?a.updateContact(b.contactId):a.onUpdateSuccess()},updateContact:function(a){var d=this,e=d.subViewModels.worryFreeContextTopicViewModel.get("acceptorData"),f=(e&&e.customerIds?e.customerIds:null,d.get("customerMinimalInformation")),g=f.personalInfo,h=f.address,i=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");i="staff"===i?"Staff":"cis"===i?"CIS - IDD":null;var j=(g.guestIdNumber.substring(0,1),{ImplContactPerson:{birthDate:g.birthDate,emailId:g.email,name:g.registeredName,phone:g.phone,nationality:"Singaporean",salutation:g.salutation,personGender:g.gender,address:{apartment:h.apartment||h.floorNo,city:h.city,floor:h.floorNo,postcode:h.postCode||h.postCode,room:h.unitNo,unitNumber:h.apartment||h.floorNo,houseNumber:h.blockOrHouseNum,state:h.state,country:h.country,streetName:h.streetName,blockOrHouseNum:h.blockOrHouseNum,blockOrHouseAddr:b.get("IS_BLOCKORHOUSEADDR")?h.blockOrHouseAddr:"",buildingName:h.buildingName,countryCode:h.country,unstructAddress:!1,buildingClassification:h.buildingClassification||"HDB",addressType:"Standard"}}});i&&(j.ImplContactPerson.personVipCodeX9=i);var k=d.getModel("updateContactDetailsModel");k.save(j,{id:a,success:c.bind(d.onUpdateSuccess,d),error:c.bind(d.onUpdateFailure,d)})},onUpdateFailure:function(a,b){var c=this;c.set("prepaidServicesVmStatus","prepaidScenarioFailed"),c.subViewModels.clearContextInContextTopic.clearAllTopics(!0)},onUpdateSuccess:function(a){var c=this,d=c.get("customerMinimalInformation"),e=d.personalInfo,f=d.address,g=c.subViewModels.deviceIdAndPlanIdInContextTopic.get("customerType");g="staff"===g?"Staff":"cis"===g?"CIS - IDD":null;var h=(e.guestIdNumber.substring(0,1),c.subViewModels.worryFreeContextTopicViewModel.get("acceptorData"));if(h&&h.customerIds&&h.customerIds.length>0){var i={customerExists:!0,postpaidCustomerId:h.customerIds[0]};c.set("customerDetails",i);var j=c.subViewModels.onePassTopicViewModel;j.set("newcustomer",!0),j.set("isWorryFreeLogin",!0),j.set("customerIdType",e.guestIdTypeSelected),j.set("nric",e.guestIdNumber),c.fetchAcceptorUserInfo(e.guestIdNumber,e.guestIdTypeSelected),c.set("prepaidServicesVmStatus","customerDetailsSuccess")}else{var k={personIdentificationDetails:{type:e.guestIdTypeSelected,docNumber:e.guestIdNumber},givenName:e.registeredName,familyName:e.registeredName,custType:"D",custSubType:"N",phone:e.phone,email:e.email,address:{apartment:f.apartment||f.floorNo,city:f.city,floor:f.floorNo,postcode:f.postCode||f.postCode,room:f.unitNo,unitNumber:f.apartment||f.floorNo,houseNumber:f.blockOrHouseNum,state:f.state,country:f.country,streetName:f.streetName,blockOrHouseNum:f.blockOrHouseNum,blockOrHouseAddr:b.get("IS_BLOCKORHOUSEADDR")?f.blockOrHouseAddr:"",buildingName:f.buildingName,countryCode:f.country,unstructAddress:!1,buildingClassification:f.buildingClassification||"HDB",addressType:"Standard"},billingAddressSame:!0,salutation:e.salutation,gender:e.gender,birthDate:e.birthDate,nationality:"Singaporean",race:"Others",customerOwningEntity:"Singapore",customerAccountCategory:"Non In-house",timeZone:"GMT+8",language:"zh-TW",contactId:a};g&&(k.contactVipCodeX9=g),c.models.createCustomerModel.save({ImplCreateCustomerInput:k},{success:function(a,b){if("undefined"!=typeof b.ImplCreateCustomerOutput){var d=c.subViewModels.onePassTopicViewModel;d.set("newcustomer",!0),d.set("isWorryFreeLogin",!0),d.set("customerIdType",e.guestIdTypeSelected),d.set("nric",e.guestIdNumber);var f={customerExists:!0,postpaidCustomerId:b.ImplCreateCustomerOutput.customerId};h={customerIds:b.ImplCreateCustomerOutput.customerId,contactId:b.ImplCreateCustomerOutput.conatctId},c.subViewModels.worryFreeContextTopicViewModel.set("acceptorData",h),c.set("customerDetails",f),c.set("prepaidServicesVmStatus","customerDetailsSuccess"),c.fetchAcceptorUserInfo(e.guestIdNumber,e.guestIdTypeSelected)}else c.set("prepaidServicesVmStatus","createCustomerFailed")},error:function(){c.set("prepaidServicesVmStatus","createCustomerFailed")}})}},handleOrder:function(){var a=this,b=a.get("finalNumberDetails"),d=a.subViewModels.orderInContextTopicViewModel.get(),e=d.customerID||b.customerIdX8,f=d.productOrderID,g=d.currentOrderActions,h=[];if(!d.isChangeUserScenario&&g&&g.length>0){c.each(g,function(a){h.push(a.productOrderItemID)});var i;e?(i=a.models.customerProductOrderProductOrderItemsModel,i.set("customerId",e)):i=a.models.anonymousProductOrderProductOrderItemsModel,i.set("productOrderId",f),a.setDefaultQueryParams(i);var j=c.clone(h);i.setQueryParams({poi:h}),i.set("id",h[0]),i.destroy({success:c.bind(a.createChangeOwnershipOrder,a,b,j),error:c.bind(a.onUpdateFailure,a)})}else d.isChangeUserScenario&&(h.push({lob:"WS"}),a.subViewModels.orderInContextTopicViewModel.set("orderActions",h),a.subViewModels.orderInContextTopicViewModel.set("isChangeUserScenario",!1)),a.createChangeOwnershipOrder(b,h)},createChangeOwnershipOrder:function(a,b){var d=this;d.set("prepaidServicesVmStatus","createChangeOwnershipOrder");var e=!1;if(b&&b.length>0){var f=d.subViewModels.orderInContextTopicViewModel.get("orderActions")||[];if(f=c.filter(f,function(a){return a.lob}),f&&f.length===b.length){d.subViewModels.orderInContextTopicViewModel.emptyTopic();var g=[];if(g.push("businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"),g.push("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),this.subViewModels.onePassTopicViewModel.get("isWorryFreeLogin")||window.localStorage.removeItem("LightsaberSessionToken"),window.localStorage.setItem("clearSessionStorage",!0),g.length>0)for(var h=0;h<g.length;h++){var i=g[h];window.sessionStorage.removeItem(i)}window.localStorage.removeItem("clearSessionStorage"),e=!0}}var j=d.createInputPayload(a),k=d.getModel("submitProductConfigurationModel");d.set("customerID",a.customerIdX8),k.set({contactId:a.contactIdX8,customerId:a.customerIdX8,productId:a.id}),k.setQueryParams({enableHardCancellation:!0}),d.set("isUpdateOrderReq",e),k.save(j,{success:c.bind(d.onsaveChangeOwershipSuccess,d,a,b,a),error:c.bind(d.onUpdateFailure,d)})},onsaveChangeOwershipSuccess:function(a,b,a,d,e){var f=this,g=e.ImplSubmitProductConfigurationRestOutput;if(g.errorInfo&&g.errorInfo.length>0){var h=c.find(g.errorInfo,function(a){return"EntityAlreadyExists"===a.errorCode});if(h)return void this.set("prepaidServicesVmStatus","tbcOrderFound")}f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutOrderID",null),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutServiceID",null),f.subViewModels.deviceIdAndPlanIdInContextTopic.set("expressCheckoutRulesCompleted",!1),f.processOutput(g,b)},createInputPayload:function(a){var b=this,c=b.subViewModels.deviceIdAndPlanIdInContextTopic.get(),d=[],e=[],f=[];if("staff"===c.customerType&&c.staffDetails&&d.push({productSpecContainmentID:"11822",temporaryID:"c"+Math.random().toString(36).substr(2,9)}),"cis"===c.customerType&&c.cisDetails){var g=c.cisDetails,h=[{characteristicID:8480012,value:g.companyId},{characteristicID:8582,value:g.companyName},{characteristicID:8592,value:g.childCompanyName}];d.push({productSpecContainmentID:"11762",changedCharacteristics:h,temporaryID:"c"+Math.random().toString(36).substr(2,9)})}if(a.simProductID){var i={productID:a.simProductID,changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:"8858992",value:null},{characteristicID:8022652,value:"3IN1"},{characteristicID:132395,value:null}]};f.push(i)}var j=[];if(null!==c.deviceId&&""!==c.deviceId){var k={businessType:"DEVICE",simpleProductSpecID:c.deviceId,temporaryID:"c"+Math.random().toString(36).substr(2,9)};if(c.installmentPayment||c.installmentDuration&&c.isIppPlan){var h=[];h.push({characteristicID:8272,value:c.installmentDuration||"24"}),h.push({characteristicID:13897781,value:"Instalments"}),k.changedCharacteristics=h}j.push(k);var l=b.get("deviceInformationContainment")||"10482";d.push({productSpecContainmentID:l,temporaryID:"c"+Math.random().toString(36).substr(2,9)})}var m=b.get("customerDetails"),n={ImplSubmitProductConfigurationRestInput:{subscriberId:a.subscriptionId,updateProductConfigurationRequest:{runCompatibilityRules:!1,activityForConfiguration:null,addDefaultChildItemsImplicitly:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{newProductOfferingProductSpecID:c.relationId,productID:a.id,newBasicPriceScehmaID:c.priceSchemaId,orderActionReasonX8:"PREPOS",orderActionTypeX8:"CW",vendorCodeX8:b.get("vendorCode"),dealerCodeX8:b.get("dealerCode"),productChanges:{removedSimpleProducts:[],changedContainedProducts:f,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:d,newSimpleProducts:j,removedAssignedBillingOffers:[],resumedContainedProducts:[],removedContainedProducts:e}}],newProductOfferingID:c.planId,newCustomerIDX8:m.postpaidCustomerId}],productChanges:[]}}};c.priceSchemaId&&(n.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.replaceProductOfferingConfiguration[0].productForReplacement[0].newBasicPriceScehmaID=c.priceSchemaId);var o=b.subViewModels.orderInContextTopicViewModel.get("productOrderID");return o&&(n.ImplSubmitProductConfigurationRestInput.updateProductConfigurationRequest.productOrderID=o),n},processOutput:function(a,b){var d=this,e=[],f=[];if("undefined"!=typeof a.updateProductConfigurationResponse){var g=a.updateProductConfigurationResponse,h=this.subViewModels.orderInContextTopicViewModel,i=h.get("orderActions")||[];i&&i.length>0&&(i=c.filter(i,function(a){return!c.contains(b,a.productOrderItemID)}));var j,k,l,m=[],n=d.subViewModels.deviceIdAndPlanIdInContextTopic.get(),o=n.planId;"8480002"===o?j="8494592":"11627591"===o?j="11621331":"11640191"===o?j="11633931":"11621291"===o&&(j="11615031"),c.each(g.productsInReplaceProductOffering,function(a){c.each(a.products,function(a){var b=!1;d.subViewModels.deviceIdAndPlanIdInContextTopic.get("isIppPlan")&&d.subViewModels.deviceIdAndPlanIdInContextTopic.get("installmentDuration")&&(b=!0);var g={productOrderItemID:a.productOrderItemID,productID:a.productID,level:a.productConfiguration.productSpecification.level,lob:a.productConfiguration.lineOfBusiness,flowType:d.get("flowType"),orderType:"Change Ownership",isPPOrder:b};if(m.push(g),i.push(g),a.productConfiguration.displayableItems&&a.productConfiguration.displayableItems.length>0){if(j){var h=c.find(a.productConfiguration.displayableItems,function(a){return a.productSpecContainmentID===j});h&&(l=h.productID,d.subViewModels.deviceIdAndPlanIdInContextTopic.set("easyMobileId",h.productOrderItemID))}var o=c.find(a.productConfiguration.displayableItems,function(a){if("10482"!==a.productSpecContainmentID&&"11264181"!==a.productSpecContainmentID&&"11259761"!==a.productSpecContainmentID&&"11261971"!==a.productSpecContainmentID||!a.selected||"AD"!==a.action)return!1;if(a.displayableSimpleProductReferences){var b=c.find(a.displayableSimpleProductReferences,function(a){return a.selected&&"DEVICE"===a.businessType&&"Device"===a.name});return!!b}return!1});o&&(k=o.productID);var p=[];if("cis"!==n.customerType){var q=c.find(a.productConfiguration.displayableItems,function(a){return a.productID&&"11762"===a.productSpecContainmentID});q&&p.push(q)}if("staff"!==n.customerType){var r=c.find(a.productConfiguration.displayableItems,function(a){return a.productID&&"11822"===a.productSpecContainmentID});r&&p.push(r)}p&&p.length>0&&c.each(p,function(a){e.push({productID:a.productID})});var s;if(c.find(a.productConfiguration.displayableItems,function(a){if("SIM"===a.name||"8363722"===a.productSpecContainmentID)return s=a.productID,!0}),s){var t={productID:s,changedCharacteristics:[{characteristicID:10382891,value:"No"},{characteristicID:"8858992",value:null},{characteristicID:8022652,value:"3IN1"},{characteristicID:132395,value:null}]};f.push(t)}}})});var p=d.get("customerDetails"),q=p.postpaidCustomerId;h.set("orderActions",i),h.set("currentOrderActions",m),h.set("customerID",q),h.set("productID",g.productID),h.set("productOrderReferenceNumber",g.productOrderReferenceNumber),h.set("productOrderID",g.productOrderID),h.set("productOrderItemID",g.productOrderItemID),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("reContractFlag",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("miniCartChange",!1),this.subViewModels.deviceIdAndPlanIdInContextTopic.set("mobileReContractFlag",!1);var r=this.subViewModels.miniCartInContextTopic.get("id"),s=this.get("addonDetails")||this.subViewModels.deviceIdAndPlanIdInContextTopic.get("addonDetails"),t=this.get("addComponentList"),u=d.get("finalNumberDetails");u.easyMobileUnits&&l&&f.push({productID:l,changedCharacteristics:[{characteristicID:8192,value:selectedRecontractDetails.easyMobileUnits.talkTimeUnit},{characteristicID:8202,value:selectedRecontractDetails.easyMobileUnits.smsUnit},{characteristicID:8212,value:selectedRecontractDetails.easyMobileUnits.dataUnit}]}),k&&e.push({productID:k});var v=d.get("isUpdateOrderReq"),w=d.subViewModels.deviceIdAndPlanIdInContextTopic.get("pgInfo");if(v&&w&&(w.code||w.campaign&&w.parentLine)){var x=d.subViewModels.pickAndGoViewModel.updateCode(w,!1);x.done(function(b){"pickAndGoUpdated"===b?d.updateSimOnlyPlan(r,s,a,t,q,m,f,e):"pickAndGoFailed"===b&&d.onUpdateFailure()})}else d.updateSimOnlyPlan(r,s,a,t,q,m,f,e)}},updateSimOnlyPlan:function(a,b,d,e,f,g,h,i){var j=this,k=["simOnlyPlan","tabletPlanFirst","tabletFirst"];if(c.contains(k,a)&&b&&b.length>0){var l=this.subViewModels.simOnlyPlanViewModel.updateAddonDetailsOrder(d,b,e,f);l.done(function(a){"failed"!==a?j.getSuccessMessage(g,null,null,h,i):j.onUpdateFailure()}.bind(j))}else this.getSuccessMessage(g,null,null,h,i)},getSuccessMessage:function(a,b,d,e,f){var g=this;if(g.set("prepaidServicesVmStatus",""),g.set("blockingMessages",null),d&&d.productConfiguration){if("BLOCKING"===d.productConfiguration.compatibilityStatus){var h=d.productConfiguration.messages,i=!1;if(h=c.filter(h,function(a){return a.text&&a.text.indexOf("PENDING_SUBMITTED_ORDER_FORM")>-1&&(i=!0),"ERROR"===a.severity}),h&&h.length>0){var j={orderActionId:b,messages:h};g.set("blockingMessages",j),g.set("prepaidServicesVmStatus","blockingErrorFound")}return i?(g.set("prepaidServicesVmStatus","submittedReconOrderFound"),g.subViewModels.clearContextInContextTopic.clearAllTopics(!0)):g.set("prepaidServicesVmStatus","failure"),!1}var k=g.get("preTickAddonDetails");if(k&&k.preTickAddons){var l=g.subViewModels.preTickAddonViewModel;l.set("preTickAddons",k.preTickAddons),l.createInputPayload(d,k.addComponentList)}}if(b&&c.each(a,function(a){a.productOrderItemID===b&&(a.updated=!0)}),a=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated}),a&&a.length>0)g.updateOrderToRunRules(a,e,f);else{var l=g.subViewModels.preTickAddonViewModel,m=l._updateProductConfiguration();m.done(function(a){l.set("actionList",[]),g.updateOrderContact()}.bind(g))}},updateOrderToRunRules:function(a,b,d){var e=this;"undefined"!=typeof b&&null!==b||(b=[]),"undefined"!=typeof d&&null!==d||(d=[]);var f,g,h={UpdateProductInOrderConfigurationRequest:{runCompatibilityRules:!0,addDefaultChildItemsImplicitly:!0,activityForConfiguration:"NPCFirstLoad",confirmationMessagesApproved:!1,returnRemovedItems:!1,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!1,returnConfiguration:"ALL",productChanges:[{removedContainedProducts:d,changedContainedProducts:b,suspendedContainedProducts:[],changedSimpleProducts:[],newAssignedBillingOffers:[],newContainedProducts:[],newSimpleProducts:[],removedAssignedBillingOffers:[],resumedContainedProducts:[]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!1,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},i=e.subViewModels.orderInContextTopicViewModel.get(),j=c.filter(a,function(a){return"undefined"==typeof a.updated||null===a.updated});j&&j.length>0&&(f=j[0].productOrderItemID,g=j[0].productID,b.push({productID:g})),b.length>0&&(h.UpdateProductInOrderConfigurationRequest.productChanges[0].changedContainedProducts=b);var k=i.customerID;if(k){var l=e.getModel("updateProductConfigurationModel");l.set({customerId:k,productOrderItemId:f}),e.setHeaders(l),e.setDefaultQueryParams(l),l.setQueryParams({rp:!1,rpc:!1}),l.save(h,{success:function(b,c){var d=[],g=[];e.getSuccessMessage(a,f,c.UpdateProductInOrderConfigurationResponse,d,g)},error:e.onUpdateFailure})}else{var m=e.getModel("anonymousUpdateProductConfigurationModel");m.set({productOrderItemId:f}),e.setHeaders(m),e.setDefaultQueryParams(m),m.setQueryParams({rp:!1,rpc:!1}),m.save(h,{success:function(b,c){var d=[],g=[];e.getSuccessMessage(a,f,c.UpdateProductInOrderConfigurationResponse,d,g)},error:e.onUpdateFailure})}},setHeaders:function(a){var b=a.getDataSource().methods.defaults.headers;b||(b={}),a.getDataSource().methods.defaults.headers=c.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},setDefaultQueryParams:function(a){var d=a.getDataSource().methods.defaults.qParams;d||(d={}),a.getDataSource().methods.defaults.qParams=c.extend(d,{lo:b.get("defaultLocale")||d.locale,sc:this.get("sc")||d.sc})},updateOrderContact:function(){var a=this;if(a.get("isContactUpdated")){var b=a.getModel("updateContactModel");b.setQueryParams({isAnonymous:!0});var d=a.subViewModels.orderInContextTopicViewModel.get("productOrderReferenceNumber");b.set({customerId:a.get("customerDetails").postpaidCustomerId,orderId:d});var e=a.subViewModels.orderInContextTopicViewModel.get("orderActions"),f=this.subViewModels.orderInContextTopicViewModel.get("updatedOrderActions");e=c.filter(e,function(a){return!c.contains(f,a.productOrderItemID)});var g=[],h=[];if(c.each(e,function(b){g.push({orderActionId:b.productOrderItemID,contactId:a.subViewModels.individualInContextTopicViewModel.get("personId"),userOnBehalf:"Online"}),h.push(b.productOrderItemID)}),g.length>0){var i={ImplAddCustomerContactRestInput:{orderAction:g}};b.save(i,{success:c.bind(a.updateContactSuccess,a,h),error:c.bind(a.updateContactFailure,a)})}}else a.set("prepaidServicesVmStatus","successful")},updateContactSuccess:function(a){var b=this,d=b.subViewModels.orderInContextTopicViewModel.get("updatedOrderActions")||[];c.each(a,function(a){d.push(a)}),b.subViewModels.orderInContextTopicViewModel.set("updatedOrderActions",d),b.set("prepaidServicesVmStatus","successful")},updateContactFailure:function(){var a=this;a.set("prepaidServicesVmStatus","successful")},fetchAcceptorUserInfo:function(a,b){var d=this;if(this.set("loginVmStatus","fetchAcceptorUserInfo"),a){var e={implContactDetails:{indentValue:a,indentType:b}};d.models.findCallerModel=d.create("findCallerByContactModel",z),d.models.findCallerModel.save({ImplFindCallerByContactInput:e},{success:c.bind(this.onFindAcceptorCallerSuccess,this),error:c.bind(this.onUpdateFailure,this)})}},onFindAcceptorCallerSuccess:function(a,b){var d=this,e=[],f=b.ImplFindCallerByContactOutput.contactCustomerDetails;c.each(f,function(a){e.push(a.customerId)}),d.subViewModels.customerInContextTopicViewModel.set("customerIds",e),d.subViewModels.customerInContextTopicViewModel.set("ID",e[0]),b.ImplFindCallerByContactOutput.contactDetails?(d.subViewModels.contactInContextTopicViewModel.set("ID",b.ImplFindCallerByContactOutput.contactDetails.contactId),d.subViewModels.implUserContextTopicViewModel.set("userInfo",b.ImplFindCallerByContactOutput),d.subViewModels.individualInContextTopicViewModel.set("personId",b.ImplFindCallerByContactOutput.contactDetails.contactId),d.checkPendingOrders()):d.onUpdateFailure()}});return D});
define("l9_common.commerceWidgets",{"RRPOrderViewModel":"businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderViewModel","RRPShoppingCartViewModel":"businesswidget/repository_l9_common/common/viewmodel/rrp/RRPShoppingCartViewModel","RRPCustomerRegistrationViewModel":"businesswidget/repository_l9_common/common/viewmodel/rrp/RRPCustomerRegistrationViewModel","RRPAppointmentManagerViewModel":"businesswidget/repository_l9_common/common/viewmodel/rrp/RRPAppointmentManagerViewModel","RRPPaymentGatewayViewModel":"businesswidget/repository_l9_common/common/viewmodel/rrp/RRPPaymentGatewayViewModel","MyProductsAndServicesWidgetCupons":"businesswidget/repository_l9_common/widgetsLibrary/myProductsAndServicesWidgetCupons/web/ViewProductsAndServicesWidget","PlanDetailsWidget":"businesswidget/repository_l9_common/widgetsLibrary/PlanDetailsWidget/web/PlanDetailsWidget","DeviceDetailsWidget":"businesswidget/repository_l9_common/widgetsLibrary/DeviceDetailsWidget/web/DeviceDetailsWidget","miniCartWidget":"businesswidget/repository_l9_common/widgetsLibrary/miniCartWidget/web/miniCartWidget","ShippingAddressWidget":"businesswidget/repository_l9_common/widgetsLibrary/shippingAddressWidget/web/shippingAddressWidget","BillingAddressWidget":"businesswidget/repository_l9_common/widgetsLibrary/BillingAddressWidget/web/BillingAddressWidget","InstallationAddressWidget":"businesswidget/repository_l9_common/widgetsLibrary/InstallationAddressWidget/web/InstallationAddressWidget","PersonalInformationWidget":"businesswidget/repository_l9_common/widgetsLibrary/PersonalInformationWidget/web/PersonalInformationWidget","GeneralConfirmationWidget":"businesswidget/repository_l9_common/widgetsLibrary/GeneralConfirmationWidget/web/GeneralConfirmationWidget","shoppingCartWidget":"businesswidget/repository_l9_common/widgetsLibrary/shoppingCartWidget/web/shoppingCartWidget","orderSummaryWidget":"businesswidget/repository_l9_common/widgetsLibrary/orderSummaryWidget/web/orderSummaryWidget","networkCoverageWidget":"businesswidget/repository_l9_common/widgetsLibrary/networkCoverageWidget/web/networkCoverageWidget","eligibilityCheckWidget":"businesswidget/repository_l9_common/widgetsLibrary/eligibilityCheckWidget/web/eligibilityCheckWidget","eligibilityCheckoutWidget":"businesswidget/repository_l9_common/widgetsLibrary/eligibilityCheckoutWidget/web/eligibilityCheckoutWidget","ScheduleTechnicalAppointmentWidget":"businesswidget/repository_l9_common/widgetsLibrary/ScheduleTechnicalAppointmentWidget/web/ScheduleTechnicalAppointmentWidget","customerViewAppointmentsWidget":"businesswidget/repository_l9_common/widgetsLibrary/customerViewAppointmentsWidget/web/CustomerViewAppointmentsWidget","OrderConfirmationWidget":"businesswidget/repository_l9_common/widgetsLibrary/OrderConfirmationWidget/web/OrderConfirmationWidget","implLoginViewModel":"businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","planAndDeviceIdCatalogueViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/PlanAndDeviceIdCatalogueViewModel","shoppingCartViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ShoppingCartViewModel","implMicroCartWidget":"businesswidget/repository_l9_common/widgetsLibrary/microCartWidget/web/MicroCartWidget","AddOnsRetrieveUpdateConfigurationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/AddOnsRetrieveUpdateConfigurationViewModel","CheckoutFullfillmentDetailsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/CheckoutFullfillmentDetailsViewModel","IdDocumentUploadViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/IdDocumentUploadViewModel","OrderSummaryViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/OrderSummaryViewModel","LogisticsDispatchAppointmetSlotViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel","SelfCollectionTimeSlotsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectionTimeSlotsViewModel","GuestCheckoutViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GuestCheckoutViewModel","CheckoutFulfillmentWidget":"businesswidget/repository_l9_common/widgetsLibrary/checkoutFulfillmentWidget/web/CheckoutFulfillmentWidget","PdpaViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/PdpaViewModel","ScheduleTechnicalAppointmentViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ScheduleTechnicalAppointmentViewModel","GetNetworkCoverageViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetNetworkCoverageViewModel","MobileShareViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/MobileShareViewModel","StockAvailabilityViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/StockAvailabilityViewModel","PaymentGateway":"businesswidget/repository_l9_common/common/viewmodel/business/PaymentGatewayViewModel","InboxViewmodel":"businesswidget/repository_l9_common/common/viewmodel/business/InboxViewmodel","TradeInViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/TradeInViewModel","GetBillingAccountDetailedListViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","ReContractDetailsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ReContractDetailsViewModel","ClearContextInContextTopic":"businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","UpdateProductConfigurationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationViewModel","GetCartOrderItemsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetCartOrderItemsViewModel","SetupBoxSetupViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SetupBoxSetupViewModel","ReserveAllocateMTPOSEquipmentsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ReserveAllocateMTPOSEquipmentsViewModel","HandleLoginStatusVieWModel":"businesswidget/repository_l9_common/common/viewmodel/business/HandleLoginStatusVieWModel","PremiumAddonsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/PremiumAddonsViewModel","ProductConfigurationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ProductConfigurationViewModel","FindTvSubscriptionViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/FindTvSubscriptionViewModel","FreeMBBViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/FreeMBBViewModel","TvSelfHelpViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/TvSelfHelpViewModel","ValidateSessionTokenViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel","WhiteListInputViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/WhiteListInputViewModel","WifiMeshViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/WifiMeshViewModel","UpdateProductConfigurationCustomizedViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","RetrieveAddressViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel","GetCustomerIdValueViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","SubmitRegisterInterestViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SubmitRegisterInterestViewModel","StoreContextDataViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel","GetOrderInContextDataViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetOrderInContextDataViewModel","CheckPendingOnPendingOrderViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/CheckPendingOnPendingOrderViewModel","GetDmpCommerceViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetDmpCommerceViewModel","AccessoriesViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/AccessoriesViewModel","PickAndGoViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","GetPromoDataViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetPromoDataViewModel","ExtendReservationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ExtendReservationViewModel","ExpressCheckoutViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ExpressCheckoutViewModel","SingtelEnergyViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyViewModel","EnergyEmailNotificationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/EnergyEmailNotificationViewModel","SingtelEnergyLoadServicesViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyLoadServicesViewModel","SingtelEnergyOrderConfirmationViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderConfirmationViewModel","SingtelEnergyOrderSummaryViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderSummaryViewModel","SingtelEnergyOrderingViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderingViewModel","WorryFreeViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/WorryFreeViewModel","UpdateOrderActionAttributesViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/UpdateOrderActionAttributesViewModel","SingtelOneClickViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelOneClickViewModel","ImplServiceAgreementViewModel":"businesswidget/repository_l9_common/common/viewmodel/ImplServiceAgreementViewModel","SelfCollectNowViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel","GetFulfillmentDetailsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/GetFulfillmentDetailsViewModel","StoreAvailabilityDetailsViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/StoreAvailabilityDetailsViewModel","BillMethodPreferenceViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/BillMethodPreferenceViewModel","SingtelStoreEAppointmentViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel","ConsolidateAppointmentViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/ConsolidateAppointmentViewModel","PrepaidServicesViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/PrepaidServicesViewModel"});
define("l9_common.commerceTopics",{"RRPOrderContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderContextTopic","vmKeys":{"data.rrpOrderId":"rrpOrderId","data.rrpOrderActionIds":"rrpOrderActionIds","data.skuIds":"skuIds","data.appointmentId":"appointmentId"},"mode":"pubsub"},"RRPOrderTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPOrderViewModel","vmKeys":{"data.rrpOrderId":"rrpOrderId","data.newOrderItems":"newOrderItems","data.removeOrderItems":"removeOrderItems","data.orderDetails":"orderDetails","data.withQuote":"withQuote","data.orderSummary":"orderSummary","data.rrpOrderVmStatus":"rrpOrderVmStatus","data.rrpSubmitOrderOutput":"rrpSubmitOrderOutput","data.pgInfo":"pgInfo","data.rrpOrderCouponVmStatus":"rrpOrderCouponVmStatus","data.couponCode":"couponCode","action.addOrderItems":"addOrderItems","action.removeOrderItems":"removeOrderItems","action.retrieveOrderDetails":"retrieveOrderDetails","action.retrieveShoppingCart":"retrieveShoppingCart","action.extendSessionTimeout":"extendSessionTimeout","action.submitRrpOrder":"submitRrpOrder","action.applyCoupon":"applyCoupon","action.removeCoupon":"removeCoupon"},"mode":"pubsub"},"RRPCustomerRegTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPCustomerRegistrationViewModel","vmKeys":{"data.rrpCustomerRegVmStatus":"rrpCustomerRegVmStatus","data.sendOTPResponse":"sendOTPResponse","data.isOtpSend":"isOtpSend","data.customerDetails":"customerDetails","data.customerDetailsWithOTP":"customerDetailsWithOTP","action.sendOTP":"sendOTP","action.resendOTP":"resendOTP","action.verifyOTPAndRegister":"verifyOTPAndRegister"},"mode":"pubsub"},"RRPAppointmentManagerTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPAppointmentManagerViewModel","vmKeys":{"data.checkoutFullfillmentVMStatus":"checkoutFullfillmentVMStatus","data.popStations":"popStations","data.popStationPostalCode":"popStationPostalCode","action.reservePopComAppointment":"reservePopComAppointment","action.getPOPStations":"getPOPStations","data.appointmentSlotsCom":"appointmentSlotsCom","data.selfCollection":"selfCollection","action.getComTimeSlots":"getComTimeSlots","data.reserveLogisticData":"reserveLogisticData","data.reserveLogisticStatus":"reserveLogisticStatus","action.reserveLogisticDispatch":"reserveLogisticDispatch","data.deliveryDetailsData":"deliveryDetailsData","data.deliveryDetailsStatus":"deliveryDetailsStatus","action.orderDeliveryDetails":"orderDeliveryDetails","data.appointmentSlots":"appointmentSlots","data.appointmentSlotsVmStatus":"appointmentSlotsVmStatus","data.courierDetails":"courierDetails","action.onRetrieveAppointmentsSlots":"onRetrieveAppointmentsSlots"},"mode":"pubsub"},"RRPShoppingCartTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPShoppingCartViewModel","vmKeys":{"data.rrpShoppingCartVmStatus":"rrpShoppingCartVmStatus","data.rrpEshopRedirectiontVmStatus":"rrpEshopRedirectiontVmStatus","action.clearCart":"clearCart","action.clearContext":"clearContext","action.cancelOrderOnEshopRedirection":"cancelOrderOnEshopRedirection"},"mode":"pubsub"},"RRPPaymentGatewayTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/rrp/RRPPaymentGatewayViewModel","vmKeys":{"data.pgData":"pgData","data.paymentGatewayWithDBStatus":"paymentGatewayWithDBStatus","data.paymentGatewayOutput":"paymentGatewayOutput","action.startPayment":"startPayment"},"mode":"pubsub"},"ImplCustomerInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"ImplUserContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","vmKeys":{"data.userInfo":"userInfo","data.permissions":"permissions"},"mode":"pubsub"},"ImplIndividualInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","vmKeys":{"data.personId":"personId","data.contactFirstName":"contactFirstName","data.contactLastName":"contactLastName","data.contactFormattedName":"contactFormattedName"},"mode":"pubsub"},"ImplOrderInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel","vmKeys":{"data.orderId":"orderId","data.productOrderID":"productOrderID","data.productOrderReferenceNumber":"productOrderReferenceNumber","data.isOrderAccepted":"isOrderAccepted","data.accountId":"accountId","data.barId":"barId","data.methodType":"methodType","data.productID":"productID","data.currentOrderActions":"currentOrderActions","data.orderActions":"orderActions","data.mobileFlow":"mobileFlow","data.contnueShoppingFlag":"contnueShoppingFlag","data.contractList":"contractList","data.emailNotificationRequired":"emailNotificationRequired","data.freebiesFailed":"freebiesFailed","data.promoRulesUpdated":"promoRulesUpdated"},"mode":"pubsub"},"AccountInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","vmKeys":{"data.barId":"barId","data.faId":"faId","data.accountName":"accountName"},"mode":"pubsub"},"MiniCartInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/MiniCartInContextTopic","vmKeys":{"data.id":"id","data.currentStepNumber":"currentStepNumber","data.initialSteps":"initialSteps","data.monthlyCharges":"monthlyCharges","data.flowData":"flowData","data.changeFlag":"changeFlag","data.reverse":"reverse","data.oneTimePrice":"oneTimePrice"},"mode":"pubsub"},"MiniCartViewModelTopics":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/MiniCartViewModel","vmKeys":{"data.initialSteps":"initialSteps","data.miniCartVmStatus":"miniCartVmStatus","data.previousStepNumber":"previousStepNumber","data.addOrRemoveFlag":"addOrRemoveFlag","data.reverse":"reverse","data.prices":"prices","data.customerNric":"customerNric","data.mobileContentList":"mobileContentList","action.onAddAndRemoveAddon":"onAddAndRemoveAddon","action.getMiniCartData":"getMiniCartData"},"mode":"pubsub"},"GeneralConfirmationTopicViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/GeneralConfirmationViewModel","vmKeys":{"data.orderId":"orderId","data.orderStatuses":"orderStatuses","data.customerProblemId":"customerProblemId"},"mode":"pubsub"},"OrderConfirmationTopicViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/OrderConfirmationViewModel","vmKeys":{"data.contactFirstName":"contactFirstName","data.orderId":"orderId","data.isOrderAccepted":"isOrderAccepted","data.customerProblemId":"customerProblemId","data.customerProblemState":"customerProblemState","data.orderData":"orderData","data.paymentData":"paymentData","action.verifyPayment":"verifyPayment","data.paymentStatus":"paymentStatus","data.orderStatus":"orderStatus","data.templateId":"templateId","data.attachmentsList":"attachmentsList","data.documentId":"documentId","data.billPayer":"billPayer","data.distributePromoData":"distributePromoData","data.rrpDistributePromoVmStatus":"rrpDistributePromoVmStatus","action.distributePromoCode":"distributePromoCode","data.rrpEmailPromoVmStatus":"rrpEmailPromoVmStatus","data.emailPromoData":"emailPromoData","data.emailId":"emailId","action.emailPromoCode":"emailPromoCode","data.broadbandInstallationIds":"broadbandInstallationIds","action.submitOrder":"submitOrder","data.customerNric":"customerNric","data.fhbSelfCollectionDetails":"fhbSelfCollectionDetails","data.emailIndicator":"emailIndicator","data.smsIndicator":"smsIndicator","data.mobileContentList":"mobileContentList","action.sendEmailToCustomer":"sendEmailToCustomer","action.fetchAttachedDocument":"fetchAttachedDocument"},"mode":"pubsub"},"DeviceDetailsTopicViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/DeviceDetailsViewModel","vmKeys":{"data.deviceId":"deviceId","data.doi":"doi","data.cpi":"cpi","data.opi":"opi","data.srp":"srp","data.salesChannel":"salesChannel","data.locale":"locale","action.deviceIdSetInTopic":"deviceIdSetInTopic"},"mode":"pubsub"},"amdocs.customerorder.FullCart":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ShoppingCartTopicViewModel","vmKeys":{"action.cartDeleted":"cartDeleted","action.continueShopping":"continueShopping","action.editCart":"editCart","action.removeBundle":"removeBundle","action.checkout":"checkout","data.productOrderItemID":"productOrderItemID","data.productOrderID":"productOrderID","action.ChangeResource":"ChangeResource","data.CurrentResourceValue":"CurrentResourceValue","action.replaceDevice":"replaceDevice","action.changePlan":"changePlan","action.removeOffer":"removeOffer"},"mode":"pubsub"},"PlanDetailsTopicViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/PlanDetailsViewModel","vmKeys":{"action.refreshPage":"refreshPage","data.catalogPlanId":"catalogPlanId","data.locale":"locale","data.sc":"sc","data.customerId":"customerId","data.po":"po","data.opi":"opi","data.cpi":"cpi","data.ci":"ci","data.rch":"rch","action.planIdDeviceIdSetInTopic":"planIdDeviceIdSetInTopic"},"mode":"pubsub"},"FileDownloadTopicViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/FileDownloadViewModel","vmKeys":{"action.getFileDownload":"getFileDownload","data.customerId":"customerId","data.locale":"locale","data.salesChannel":"salesChannel","data.url":"url"},"mode":"pubsub"},"EligibilityCheckTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/eligibilityCheckViewModel","vmKeys":{"data.nricId":"nricId","data.nricType":"nricType","data.selectedNricType":"selectedNricType","data.nricValid":"nricValid","action.validateNRIC":"validateNRIC"},"mode":"pubsub"},"ProductOrderTopicViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ProductOrderTopicViewModel","vmKeys":{"data.productOrderReferenceNumber":"productOrderReferenceNumber"},"mode":"pubsub"},"IdDocumentsUploadActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/IdDocumentUploadViewModel","vmKeys":{"action.fileUpload":"fileUpload","action.removeSelectedFile":"removeSelectedFile","action.previewImage":"previewImage"},"mode":"pubsub"},"IdDocumentsUploadDataTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/IdDocumentUploadViewModel","vmKeys":{"data.userType":"userType","data.file":"file","data.fileList":"fileList","data.isFileSelected":"isFileSelected","data.isFileRemoved":"isFileRemoved","data.errors":"errors","data.fileTypes":"fileTypes","data.documentNeeded":"documentNeeded","data.uploadedDocumentVmStatus":"uploadedDocumentVmStatus","data.documentId":"documentId","data.maxImageForResize":"maxImageForResize","data.fileToRemove":"fileToRemove","data.previewImage":"previewImage","data.orderId":"orderId","data.fileName":"fileName","data.myInfoEntry":"myInfoEntry"},"mode":"pubsub"},"networkCoverageTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/eligibilityCheckViewModel","vmKeys":{"data.customerId":"customerId","data.locale":"locale","data.contactId":"contactId","data.addresses":"addresses","data.selectedAddressId":"selectedAddressId","action.retrieveAddress":"retrieveAddress","action.fibreAvailability":"fibreAvailability"},"mode":"pubsub"},"EligibilityCheckoutTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/EligibilityCheckoutViewModel","vmKeys":{"data.message":"message","data.insideOfficehours":"insideOfficehours","action.checkEligibility":"checkEligibility"},"mode":"pubsub"},"CustomerViewAppointmentsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/CustomerViewAppointmentsViewModel","vmKeys":{"data.contactId":"contactId","data.appointments":"appointments","data.currentAppointment":"currentAppointment","data.isSystemDown":"isSystemDown","data.isEULAChecked":"isEULAChecked","data.lastRecivedAppointmentsTimestamp":"lastRecivedAppointmentsTimestamp","action.selectAppointmentToCancel ":"selectAppointmentToCancel ","action.cancelAppointment":"cancelAppointment","action.selectAppointmentToChange":"selectAppointmentToChange","action.updateAppointments":"updateAppointments"},"mode":"pubsub"},"shoppingCartViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/MicroCartWidgetViewModel","vmKeys":{"data.orderData":"orderData","data.emailInput":"emailInput","data.cartSaveStatus":"cartSaveStatus","data.checkoutStatus":"checkoutStatus","data.emptyCartStatus":"emptyCartStatus","data.continueShoppingStatus":"continueShoppingStatus","data.catalogItemEligibilityInfo":"catalogItemEligibilityInfo","data.catalogOfferEligibilityInfo":"catalogOfferEligibilityInfo","data.eligibilityCheckDone":"eligibilityCheckDone","data.customerId":"customerId","data.customerIds":"customerIds","data.emailNotificationRequired":"emailNotificationRequired","data.validationMessages":"validationMessages","data.lobs":"lobs","data.microCartVmStatus":"microCartVmStatus","data.changeDeviceStatus":"changeDeviceStatus","data.selectedDevices":"selectedDevices","data.selectedDevicesSkuIds":"selectedDevicesSkuIds","data.shoppingCartStatus":"shoppingCartStatus","data.saveCartParams":"saveCartParams","data.selectedVoucher":"selectedVoucher","data.selectedOrderItemId":"selectedOrderItemId","data.removeMultiCartItemId":"removeMultiCartItemId","data.customerNric":"customerNric","data.isFullCheckoutScenario":"isFullCheckoutScenario","data.displayModalWindowFlag":"displayModalWindowFlag","data.removedItemDetails":"removedItemDetails"},"mode":"sub"},"shoppingCartActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/MicroCartWidgetViewModel","vmKeys":{"action.emptyCart":"emptyCart","action.saveCart":"saveCart","action.checkout":"checkout","action.reserveEquipments":"reserveEquipments","action.continueShopping":"continueShopping","action.saveTradeInDetails":"saveTradeInDetails","action.removeTradeInDetails":"removeTradeInDetails","data.emailInput":"emailInput","data.emailNotificationRequired":"emailNotificationRequired","data.tradeInDetails":"tradeInDetails","data.saveCartParams":"saveCartParams","data.tvSelectData":"tvSelectData","data.mbbDetails":"mbbDetails","data.selectedShoppingCartVouchers":"selectedShoppingCartVouchers","data.selectedAddons":"selectedAddons","data.selectedSettopBox":"selectedSettopBox","data.removeComponents":"removeComponents","data.selectedDevicesSkuIds":"selectedDevicesSkuIds","data.selectedOrderItemId":"selectedOrderItemId","data.allAddons":"allAddons","data.specialDiscounts":"specialDiscounts","data.reservedVouchersList":"reservedVouchersList","data.isGoToAccessory":"isGoToAccessory","action.onSaveCartParams":"onSaveCartParams","action.onCartItemChange":"onCartItemChange","action.updateVouchers":"updateVouchers","action.createFreeMBB":"createFreeMBB","action.removeSelectedAddons":"removeSelectedAddons","action.createTVSelectOrder":"createTVSelectOrder","action.removeMultiCartItem":"removeMultiCartItem","action.removeSelectedSetTopBox":"removeSelectedSetTopBox","data.orderToBeRemoved":"orderToBeRemoved","data.registerInterest":"registerInterest","action.sendEmailToCustomer":"sendEmailToCustomer","action.removeFreebieFromOrder":"removeFreebieFromOrder","action.cancelOutOfStockItem":"cancelOutOfStockItem","action.unReserveVouchersAction":"unReserveVouchersAction","action.removeAccessoriesFromOrder":"removeAccessoriesFromOrder","data.broadbandInstallationIds":"broadbandInstallationIds","data.deliveryOptions":"deliveryOptions"},"mode":"pub"},"ViewExistingOrderSummaryWidgetTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ExistingOrderSummaryWidgetViewModel","vmKeys":{"data.orderData":"orderData","data.selectedDevices":"selectedDevices","data.selectedDevicesSku":"selectedDevicesSku"},"mode":"sub"},"ExistingOrderSummaryWidgetTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ExistingOrderSummaryWidgetViewModel","vmKeys":{"data.itemIdToRemove":"itemIdToRemove","data.methodType":"methodType","data.orderStatus":"orderStatus","data.newAddress":"newAddress","data.currentAccountId":"currentAccountId","data.orderSummaryVMStatus":"orderSummaryVMStatus","data.couponCode":"couponCode","data.broadbandInstallationIds":"broadbandInstallationIds"},"mode":"pubsub"},"ActionsExistingOrderSummaryWidgetTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ExistingOrderSummaryWidgetViewModel","vmKeys":{"action.submitOrder":"submitOrder","action.removeLOB":"removeLOB","action.updateAccountAddress":"updateAccountAddress","action.applyPromoCode":"applyPromoCode","action.removePromoCode":"removePromoCode"},"mode":"pub"},"PlanAndDeviceIdCatalogueViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PlanAndDeviceIdCatalogueViewModel","vmKeys":{"data.deviceAndPlan":"deviceAndPlan","data.planOnly":"planOnly","data.planAndDevice":"planAndDevice","data.staffDetails":"staffDetails","data.customerType":"customerType","data.dataMissing":"dataMissing","data.orderStatus":"orderStatus","data.easyMobilePlans":"easyMobilePlans","data.deviceId":"deviceId","data.installationAddressId":"installationAddressId","data.updateDevice":"updateDevice","data.addonDetails":"addonDetails","data.vendorID":"vendorID","data.dealerID":"dealerID","data.installmentPayment":"installmentPayment","data.userId":"userId","data.flowType":"flowType","data.currentOrderActions":"currentOrderActions","data.orderActions":"orderActions","data.pgInfo":"pgInfo","data.cisDetails":"cisDetails","data.addComponentList":"addComponentList","data.vmStatus":"vmStatus","data.preTickAddonDetails":"preTickAddonDetails","action.createOrUpdateOrder":"createOrUpdateOrder","action.setCISAndStaffDetails":"setCISAndStaffDetails"},"mode":"pubsub"},"DeviceIdAndPlanIdInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/DeviceIdAndPlanIdInContextTopic","vmKeys":{"data.deviceId":"deviceId","data.planId":"planId","data.relationId":"relationId","data.bbRelationIds":"bbRelationIds","data.orderData":"orderData","data.numberType":"numberType","data.planType":"planType","data.packType":"packType","data.priceSchemaId":"priceSchemaId","data.changeCartflag":"changeCartflag","data.tradeInDetails":"tradeInDetails","data.installationAddressID":"installationAddressID","data.mobileReContractFlag":"mobileReContractFlag","data.mobilePortinFlag":"mobilePortinFlag","data.miniCartChange":"miniCartChange","data.tradeInFlag":"tradeInFlag","data.reContractFlag":"reContractFlag","data.selectedOption":"selectedOption","data.isBackClicked":"isBackClicked","data.warehouseId":"warehouseId","data.customerType":"customerType","data.cisDetails":"cisDetails","data.flowType":"flowType","data.easyMobileId":"easyMobileId","data.tempDeviceId":"tempDeviceId","data.priorityPhoneDetails":"priorityPhoneDetails","data.reservationIDs":"reservationIDs","data.recontractNumber":"recontractNumber","data.cisRates":"cisRates","data.staffDetails":"staffDetails","data.allocationIDs":"allocationIDs","data.selectedPlanAddonDetails":"selectedPlanAddonDetails","data.tvSourceOfferId":"tvSourceOfferId","data.deviceResDetails":"deviceResDetails","data.isNewBar":"isNewBar","data.addonDetails":"addonDetails","data.dashPayment":"dashPayment","data.installmentPayment":"installmentPayment","data.roiDetails":"roiDetails","data.pgInfo":"pgInfo","data.selectPayment":"selectPayment","data.blockOrderID":"blockOrderID","data.energyAddress":"energyAddress","data.energyPlanName":"energyPlanName","data.customerExists":"customerExists","data.oneClickData":"oneClickData","data.isStoreScenario":"isStoreScenario","data.isExpressRequired":"isExpressRequired","data.skipOF":"skipOF","data.chargeableEmailDetails":"chargeableEmailDetails","data.gomoSkuId":"gomoSkuId","data.selectedBillOption":"selectedBillOption","data.portinNumber":"portinNumber","data.comboPlan":"comboPlan","data.isNewPP":"isNewPP","data.isIppPlan":"isIppPlan","data.installmentDuration":"installmentDuration","data.ippPlanName":"ippPlanName","data.isRemoveTVScenario":"isRemoveTVScenario"},"mode":"pubsub"},"ImplLoginViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"data.implLoginVmStatus":"implLoginVmStatus","data.userInfo":"userInfo"},"mode":"sub"},"ImplLoginActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"action.login":"login"},"mode":"pub"},"OnePassDetailsViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","vmKeys":{"data.onePassVmStatus":"onePassVmStatus","data.nric":"nric","data.nickName":"nickName","data.userId":"userId","data.customerIdType":"customerIdType","data.status":"status","data.email":"email","data.GTMUserData":"GTMUserData","data.isWorryFreeLogin":"isWorryFreeLogin","data.isWorryFreeFaVerfied":"isWorryFreeFaVerfied","data.billPayer":"billPayer","data.familyName":"familyName","data.headers":"headers","data.newcustomer":"newcustomer"},"mode":"pubsub"},"OnePassDetailsActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","vmKeys":{"action.setOnePassFields":"setOnePassFields","action.sendOnePassDetails":"sendOnePassDetails"},"mode":"pubsub"},"EasyMobileTweakingInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/EasyMobileTweakingTopicViewModel","vmKeys":{"data.easyMobilePlans":"easyMobilePlans"},"mode":"pubsub"},"ImplBreadcrumbTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplBreadcrumbTopicViewModel","vmKeys":{"data.displayState":"displayState","data.defaultRoute":"defaultRoute","data.bcConfig":"bcConfig","data.stepToAdd":"stepToAdd","action.addStep":"addStep"},"mode":"pubsub"},"CheckOutFulfillmentDetailsTopicView":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/CheckoutFullfillmentDetailsViewModel","vmKeys":{"data.fulfilmentOptions":"fulfilmentOptions","data.paperBill":"paperBill","data.netLink":"netLink","data.singTelInstallation":"singTelInstallation","data.storeIds":"storeIds","data.selectedStore":"selectedStore","data.deliveryDetails":"deliveryDetails","data.popStation":"popStation","data.singTelStore":"singTelStore","data.addressData":"addressData","data.selectedOption":"selectedOption","data.billingDetails":"billingDetails","data.addressesLoaded":"addressesLoaded","data.checkoutFullfillmentVMStatus":"checkoutFullfillmentVMStatus","data.cartPurchaseDetails":"cartPurchaseDetails","data.installationAddress":"installationAddress","data.existingWirelineAppointments":"existingWirelineAppointments","data.existingWirelessAppointments":"existingWirelessAppointments","data.popStationPostalCode":"popStationPostalCode","data.popStations":"popStations","data.confirmAppointment":"confirmAppointment","data.selectedInstalOption":"selectedInstalOption","data.documentRequired":"documentRequired","data.easyMobileInd":"easyMobileInd","data.singtelStoreList":"singtelStoreList","data.selectedDevices":"selectedDevices","data.selectedAccessories":"selectedAccessories","data.validationMessages":"validationMessages","data.shoppingCartOrderData":"shoppingCartOrderData","data.broadbandInstallationIds":"broadbandInstallationIds","data.plansData":"plansData","data.selectedPromotion":"selectedPromotion","data.pickNGoCodeList":"pickNGoCodeList","data.billType":"billType","data.showStoreOption":"showStoreOption","data.eAppointmentCrOn":"eAppointmentCrOn","data.contactUpdateNeeded":"contactUpdateNeeded"},"mode":"pubsub"},"CheckOutFulfillmentDetailsTopicAction":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/CheckoutFullfillmentDetailsViewModel","vmKeys":{"action.updateOrder":"updateOrder","action.cancelOutOfStockItem":"cancelOutOfStockItem","action.onCartItemChange":"onCartItemChange","action.getPOPStations":"getPOPStations","action.checkStoreAvailablity":"checkStoreAvailablity","action.reserveDeviceInStore":"reserveDeviceInStore","action.updateBillPreference":"updateBillPreference","action.checkAvailableSingtelStore":"checkAvailableSingtelStore"},"mode":"pubsub"},"AddOnsRetrieveUpdateConfiguration":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/AddOnsRetrieveUpdateConfigurationViewModel","vmKeys":{"data.customerId":"customerId","data.productOrderID":"productOrderID","data.newContainedProducts":"newContainedProducts","data.changedContainedProducts":"changedContainedProducts","data.newAssignedBillingOffers":"newAssignedBillingOffers","data.removedAssignedBillingOffers":"removedAssignedBillingOffers","data.removedContainedProducts":"removedContainedProducts","data.isConfirmationMessagesApprovedByUser":"isConfirmationMessagesApprovedByUser","data.retrieveProductConfigurationOsgResponse":"retrieveProductConfigurationOsgResponse","data.update":"update","data.isAllAddonsDisplayed":"isAllAddonsDisplayed","data.productConfiguration":"productConfiguration","data.addonsVmStatus":"addonsVmStatus","data.addonToRemove":"addonToRemove","data.completedAddon":"completedAddon","data.retrieveProductConfigurationError":"retrieveProductConfigurationError","data.retrieveProductConfigResponse":"retrieveProductConfigResponse","action.retrieveProductConfiguration":"retrieveProductConfiguration","action.updateProductConfiguration":"updateProductConfiguration","action.createOrderRemoveAddon":"createOrderRemoveAddon","action.removeAddon":"removeAddon","data.addonToAdd":"addonToAdd","action.createOrderAddAddon":"createOrderAddAddon","action.cancelOrder":"cancelOrder","action.submitOrder":"submitOrder"},"mode":"pubsub"},"AddOnsRetrieveUpdateConfigurationReadWrite":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/AddOnsRetrieveUpdateConfigurationViewModel","vmKeys":{"data.interactionData":"interactionData","data.addonsVmStatus":"addonsVmStatus"},"mode":"pubsub"},"AddOnsRetrieveUpdateConfigurationRead":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/AddOnsRetrieveUpdateConfigurationViewModel","vmKeys":{"data.addonsVmStatus":"addonsVmStatus","data.productConfiguration":"productConfiguration","data.completedAddon":"completedAddon","data.retrieveProductConfigurationError":"retrieveProductConfigurationError","data.retrieveProductConfigResponse":"retrieveProductConfigResponse","data.isAnonymous":"isAnonymous","data.planAndContractDetails":"planAndContractDetails"},"mode":"sub"},"AddOnsRetrieveUpdateConfigurationWrite":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/AddOnsRetrieveUpdateConfigurationViewModel","vmKeys":{"data.addonToRemove":"addonToRemove","data.addonToAdd":"addonToAdd","data.reactivationData":"reactivationData","action.retrieveProductConfiguration":"retrieveProductConfiguration","action.updateProductConfiguration":"updateProductConfiguration","action.createOrderRemoveAddon":"createOrderRemoveAddon","action.createOrderUpgradeAddon":"createOrderUpgradeAddon","action.removeAddon":"removeAddon","action.createOrderAddAddon":"createOrderAddAddon","action.createOrderExpressOtpAddAddon":"createOrderExpressOtpAddAddon","action.createOrderExpressOtpRemoveAddon":"createOrderExpressOtpRemoveAddon","action.submitOrderExpressOtpAddon":"submitOrderExpressOtpAddon","action.cancelOrder":"cancelOrder","action.submitOrder":"submitOrder","action.reactivateAddonLink":"reactivateAddonLink"},"mode":"pub"},"ImplExpressOTPReadWriteTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ImplExpressOTPViewModel","vmKeys":{"data.implExpressOTPVmStatus":"implExpressOTPVmStatus","data.otpData":"otpData","data.otp":"otp","data.mobileNo":"mobileNo","data.addonToAdd":"addonToAdd","data.isMstaFlow":"isMstaFlow","data.mstaLoginToken":"mstaLoginToken","action.validateVas":"validateVas","action.sendExpressOtp":"sendExpressOtp","action.validateExpressOtp":"validateExpressOtp","action.mstaLogin":"mstaLogin"},"mode":"pubsub"},"GuestCheckoutTopicData":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GuestCheckoutViewModel","vmKeys":{"data.customerMinimalInformation":"customerMinimalInformation","data.guestData":"guestData","data.guestCheckoutVmStatus":"guestCheckoutVmStatus","data.guestIdTypeOptions":"guestIdTypeOptions","data.guestIdTypeSelected":"guestIdTypeSelected","data.loginStatus":"loginStatus","data.implLoginVmStatus":"implLoginVmStatus","data.loginVmStatus":"loginVmStatus","data.validationMessages":"validationMessages","data.askForTVSubScription":"askForTVSubScription","data.loggedInData":"loggedInData","data.registerInterest":"registerInterest","data.cisCustomerDetails":"cisCustomerDetails"},"mode":"pubsub"},"GuestCheckoutTopicAction":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GuestCheckoutViewModel","vmKeys":{"data.tvSelectData":"tvSelectData","action.checkUserExists":"checkUserExists","action.register":"register","action.anonymousUpdateOrder":"anonymousUpdateOrder","action.getOnePassOtp":"getOnePassOtp","action.validateOtp":"validateOtp","action.createTVSelectOrder":"createTVSelectOrder","action.continueShopping":"continueShopping","action.processRequest":"processRequest","action.sendEmailToCustomer":"sendEmailToCustomer","action.cancelOutOfStockItem":"cancelOutOfStockItem","action.removeAccessoriesFromOrder":"removeAccessoriesFromOrder"},"mode":"pubsub"},"SelfCollectionTimeSlotsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectionTimeSlotsViewModel","vmKeys":{"data.appointmentSlots":"appointmentSlots","data.collectionTimeSlotVmStatus":"collectionTimeSlotVmStatus","data.popStationData":"popStationData","data.selfCollection":"selfCollection","action.retrieveTimeSlots":"retrieveTimeSlots","action.reserveTimeSlot":"reserveTimeSlot"},"mode":"pubsub"},"LogisticsDispatchAppointmetSlotTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/LogisticsDispatchAppointmetSlotViewModel","vmKeys":{"data.availableAppointmentsSlots":"availableAppointmentsSlots","data.appointmentSlotsVmStatus":"appointmentSlotsVmStatus","data.courierDetails":"courierDetails","action.onRetrieveAppointmentsSlots":"onRetrieveAppointmentsSlots","action.onRetrieveRedeliveryAppointmentsSlots":"onRetrieveRedeliveryAppointmentsSlots","action.onReserveAppointmentSlots":"onReserveAppointmentSlots","action.checkForOrderConsolidation":"checkForOrderConsolidation","data.appointmentSlots":"appointmentSlots","data.orderConsolidationInput":"orderConsolidationInput","data.orderConsolidationResponse":"orderConsolidationResponse","data.orderConsolidationResult":"orderConsolidationResult"},"mode":"pubsub"},"personalDataProtectionActTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PdpaViewModel","vmKeys":{"data.pdpaData":"pdpaData","data.pdpaStatus":"pdpaStatus","data.savePdpaData":"savePdpaData","data.pdpaVmStatus":"pdpaVmStatus","data.configData":"configData","data.onepassInfo":"onepassInfo","action.saveDataProtectionDetails":"saveDataProtectionDetails","action.getConsentManagementSystemDetails":"getConsentManagementSystemDetails"},"mode":"pubsub"},"GetNetworkCoverageTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetNetworkCoverageViewModel","vmKeys":{"data.officeHours":"officeHours","data.networkCoverageVmstatus":"networkCoverageVmstatus","data.address":"address","data.installationAddress":"installationAddress","data.result":"result","data.s6Data":"s6Data","data.dealerID":"dealerID","data.vendorID":"vendorID","data.loginVmStatus":"loginVmStatus","data.registerInterest":"registerInterest","data.selectedAddress":"selectedAddress","data.flowType":"flowType","data.defaultSTBType":"defaultSTBType","data.isBlockOrder":"isBlockOrder","data.gaTaggingPayload":"gaTaggingPayload","data.preTickAddonDetails":"preTickAddonDetails","action.onCheckServiceCoverage":"onCheckServiceCoverage","action.createAddress":"createAddress","action.getInstallationAppointment":"getInstallationAppointment","action.sendEmailToCustomer":"sendEmailToCustomer","action.setOnePassFields":"setOnePassFields","action.cancelPendingOrder":"cancelPendingOrder","action.updateOrder":"updateOrder","action.getInstallationAddress":"getInstallationAddress"},"mode":"pubsub"},"ScheduleTechnicalAppointmentTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ScheduleTechnicalAppointmentViewModel","vmKeys":{"data.scheduleAppStatus":"scheduleAppStatus","data.confirmAppointmentPayload":"confirmAppointmentPayload","data.confirmAppointmentObject":"confirmAppointmentObject","data.manageAppointmentObject":"manageAppointmentObject","data.productDetails":"productDetails","action.confirmAppointment":"confirmAppointment","data.customerId":"customerId","data.previousAppointmentId":"previousAppointmentId","action.manageAppointment":"manageAppointment","action.cancelPreviousAppointment":"cancelPreviousAppointment","data.schedulePayload":"schedulePayload","data.scheduleResponse":"scheduleResponse"},"mode":"pubsub"},"OrderSummaryTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/OrderSummaryViewModel","vmKeys":{"data.productOrderId":"productOrderId","data.orderData":"orderData","data.billingAddress":"billingAddress","data.deliveryDetails":"deliveryDetails","data.submitOrderStatus":"submitOrderStatus","data.billingAddressStatus":"billingAddressStatus","data.deliveryDetailsStatus":"deliveryDetailsStatus","data.pgData":"pgData"},"mode":"pubsub"},"MobileShareTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/MobileShareViewModel","vmKeys":{"data.existingLines":"existingLines","data.mainLineSelectionVmStatus":"mainLineSelectionVmStatus","data.selectedLine":"selectedLine","data.existingPlanId":"existingPlanId","action.saveMainLineSelected":"saveMainLineSelected"},"mode":"pubsub"},"MtposStockAvailabilityTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/StockAvailabilityViewModel","vmKeys":{"data.itemsCodes":"itemsCodes","data.stockAvailabilityVmStatus":"stockAvailabilityVmStatus","data.availableStocks":"availableStocks","action.getAvailableItemsList":"getAvailableItemsList"},"mode":"pubsub"},"PaymentGatewayTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/PaymentGatewayViewModel","vmKeys":{"data.paymentgateWayVmStatus":"paymentgateWayVmStatus","data.selectedAccount":"selectedAccount","data.selectedPaymentMethod":"selectedPaymentMethod","data.purchaseToken":"purchaseToken","data.confirmationNumber":"confirmationNumber","data.pgData":"pgData","data.emailId":"emailId","action.startPayment":"startPayment","action.failedPaymentgateWay":"failedPaymentgateWay"},"mode":"pubsub"},"InboxTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/InboxViewmodel","vmKeys":{"data.inboxVmStatus":"inboxVmStatus","data.saveCategories":"saveCategories","data.activeMessages":"activeMessages","data.unReadCount":"unReadCount","data.readStatus":"readStatus","data.readCount":"readCount","data.accountDetails":"accountDetails","data.deleteUpdateMessage":"deleteUpdateMessage","action.deleteMessage":"deleteMessage","action.updateReadMessageCount":"updateReadMessageCount","action.saveCategorySettings":"saveCategorySettings"},"mode":"pubsub"},"TradeInTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/TradeInViewModel","vmKeys":{"data.tradeInDetails":"tradeInDetails","data.tradeInVmStatus":"tradeInVmStatus","action.saveTradeInDetails":"saveTradeInDetails","action.removeTradeInDetails":"removeTradeInDetails"},"mode":"pubsub"},"GetBillingAccountDetailedListViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetBillingAccountDetailedListViewModel","vmKeys":{"data.accounts":"accounts"},"mode":"pubsub"},"ReContractDetailsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ReContractDetailsViewModel","vmKeys":{"data.customerReContractDetails":"customerReContractDetails","data.reContractVMStatus":"reContractVMStatus","data.selectedRecontractDetails":"selectedRecontractDetails","data.selectedVouchers":"selectedVouchers","data.existingAddress":"existingAddress","data.reContractFlag":"reContractFlag","data.flowType":"flowType","data.freeMBBData":"freeMBBData","data.finalContractEndDetails":"finalContractEndDetails","data.isPaymentPending":"isPaymentPending","data.recontractBarId":"recontractBarId","action.saveRecontractDetails":"saveRecontractDetails","action.loadServices":"loadServices","action.cancelOrderActions":"cancelOrderActions","action.triggerBuyFlow":"triggerBuyFlow","data.pendingProductsByCatlogId":"pendingProductsByCatlogId","action.updateOrder":"updateOrder","action.onVmInitialize":"onVmInitialize","action.addCustomerContact":"addCustomerContact","action.updateOrderSuccess":"updateOrderSuccess","data.blockingMessages":"blockingMessages","data.preTickAddonDetails":"preTickAddonDetails"},"mode":"pubsub"},"clearContextInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ClearContextInContextTopic","vmKeys":{"action.clearAllTopics":"clearAllTopics","action._cancelOrder":"_cancelOrder","data.clearMiniCartStatus":"clearMiniCartStatus","data.cancelOrderActions":"cancelOrderActions","action.onContinueShopping":"onContinueShopping","action.clearAllTopicsAction":"clearAllTopicsAction"},"mode":"pubsub"},"UpdateProductConfigurationTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateProductConfigurationCustomizedViewModel","vmKeys":{"data.upcStatus":"upcStatus"},"mode":"pubsub"},"GetCartOrderItemsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetCartOrderItemsViewModel","vmKeys":{"data.cartItems":"cartItems","data.cartItemsVmStatus":"cartItemsVmStatus","data.userDetails":"userDetails","data.anonymousUser":"anonymousUser"},"mode":"pubsub"},"SetTopBoxTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SetupBoxSetupViewModel","vmKeys":{"data.manageTopupVmStatus":"manageTopupVmStatus","data.topupData":"topupData","data.actionType":"actionType","data.selectedValue":"selectedValue","data.updatedValue":"updatedValue","action.updateProductConfiguration":"updateProductConfiguration","action.updateOrderToRunRules":"updateOrderToRunRules"},"mode":"pubsub"},"ReserveAllocatePOSEquipmentsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ReserveAllocateMTPOSEquipmentsViewModel","vmKeys":{"data.reserveEquipmentVmStatus":"reserveEquipmentVmStatus","data.selectedDevicesSkuIds":"selectedDevicesSkuIds","data.selectedFreebiesSkuIds":"selectedFreebiesSkuIds","data.selectedAccessoriesSkuIds":"selectedAccessoriesSkuIds","action._reserveEquipment":"_reserveEquipment","action.setSelectedDevices":"setSelectedDevices"},"mode":"pubsub"},"HandleLoginStatusTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/HandleLoginStatusVieWModel","vmKeys":{"data.loginVmStatus":"loginVmStatus","data.checkCIS":"checkCIS","action.setOnePassFields":"setOnePassFields"},"mode":"pubsub"},"WifiMeshTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/WifiMeshViewModel","vmKeys":{"data.premiumAddonVmStatus":"premiumAddonVmStatus","data.selectedPremiumAddon":"selectedPremiumAddon","data.previousAddons":"previousAddons","data.actionType":"actionType","data.updatedAddOn":"updatedAddOn","data.blockingMessages":"blockingMessages","action.saveSelectedAddon":"saveSelectedAddon","action.updateOrderToRunRules":"updateOrderToRunRules"},"mode":"pubsub"},"PremiumAddonsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PremiumAddonsViewModel","vmKeys":{"data.premiumAddonVmStatus":"premiumAddonVmStatus","data.selectedPremiumAddon":"selectedPremiumAddon","data.previousAddons":"previousAddons","data.actionType":"actionType","data.updatedAddOn":"updatedAddOn","data.blockingMessages":"blockingMessages","action.saveSelectedAddon":"saveSelectedAddon"},"mode":"pubsub"},"AccessoriesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/AccessoriesViewModel","vmKeys":{"data.accessoriesVmStatus":"accessoriesVmStatus","data.selectedAccessory":"selectedAccessory","data.previousAddons":"previousAddons","data.blockingMessages":"blockingMessages","data.simAdded":"simAdded","action.saveSelectedAccessory":"saveSelectedAccessory","action.updateSimComponent":"updateSimComponent","action.updateOrderToRunRules":"updateOrderToRunRules","action.getAddons":"getAddons"},"mode":"pubsub"},"ProductConfiguration":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ProductConfigurationViewModel","vmKeys":{"data.customerId":"customerId","data.productOrderID":"productOrderID","data.isAllAddonsDisplayed":"isAllAddonsDisplayed","data.productConfigurationVmStatus":"productConfigurationVmStatus","data.addOnOrderDetails":"addOnOrderDetails","data.lobs":"lobs","data.updatedAddOn":"updatedAddOn","data.addonToRemove":"addonToRemove","data.actionType":"actionType","data.simProductId":"simProductId","data.simAdded":"simAdded","data.currentOrderActions":"currentOrderActions","data.selectedContentPack":"selectedContentPack","data.blockingMessages":"blockingMessages","data.tvContentPacks":"tvContentPacks","data.updateOrderDetails":"updateOrderDetails","data.bbUserNames":"bbUserNames","data.planId":"planId","data.mobileContentPacks":"mobileContentPacks","data.specialDiscounts":"specialDiscounts","data.aemAddonIds":"aemAddonIds","data.finalAemAddons":"finalAemAddons","data.aemAddons":"aemAddons","data.deviceCareBOs":"deviceCareBOs","data.deviceBenefits":"deviceBenefits","action.setAemAddons":"setAemAddons","action.doUpdateProductConfiguration":"doUpdateProductConfiguration","action.updateSimComponent":"updateSimComponent","action.updateOrderToRunRules":"updateOrderToRunRules"},"mode":"pubsub"},"GlobalErrorTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplGlobalErrorViewModel","vmKeys":{"data.timestamp":"timestamp","data.modelName":"modelName","data.requestType":"requestType","data.errorObj":"errorObj"},"mode":"sub"},"TvSubscriptionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/FindTvSubscriptionViewModel","vmKeys":{"data.tvStatus":"tvStatus","data.askForTVSubScription":"askForTVSubScription","action.findTvSubsription":"findTvSubsription"},"mode":"pubsub"},"FreeMBBTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/FreeMBBViewModel","vmKeys":{"action.createFreeMBBOrder":"createFreeMBBOrder"},"mode":"pubsub"},"WhiteListTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/WhiteListInputViewModel","vmKeys":{"data.whiteListStatus":"whiteListStatus","data.whiteListInput":"whiteListInput","data.validWhiteList":"validWhiteList","data.roiDetails":"roiDetails","action.getValidWhitelist":"getValidWhitelist","action.submitWhiteListPhoneOrder":"submitWhiteListPhoneOrder","action.validateWhiteListPhoneOrder":"validateWhiteListPhoneOrder","action.validateRoiToken":"validateRoiToken","action.cancelOrder":"cancelOrder","action.validateCisOtp":"validateCisOtp"},"mode":"pubsub"},"TvSelfHelpTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/TvSelfHelpViewModel","vmKeys":{"data.tvSelfHelpVMStatus":"tvSelfHelpVMStatus","data.personalDetails":"personalDetails","data.tvSubscriptionDetails":"tvSubscriptionDetails","data.inputDetails":"inputDetails","action.fetchUserInfo":"fetchUserInfo","action.submitTvProduct":"submitTvProduct"},"mode":"pubsub"},"ValidateSessionTokenTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ValidateSessionTokenViewModel","vmKeys":{"data.validateTokenStatus":"validateTokenStatus","data.cisDetails":"cisDetails","data.sessionToken":"sessionToken","data.appType":"appType","action.validateToken":"validateToken"},"mode":"pubsub"},"GetAddressTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/RetrieveAddressViewModel","vmKeys":{"data.address":"address","data.addressList":"addressList","data.postalCode":"postalCode","data.addressError":"addressError","data.addressVMStatus":"addressVMStatus","action.getAddress":"getAddress"}},"GetCustomerIdValueViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetCustomerIdValueViewModel","vmKeys":{"data.customerIdVmStatus":"customerIdVmStatus"},"mode":"pubsub"},"SubmitRegisterInterestTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SubmitRegisterInterestViewModel","vmKeys":{"data.registerInterestVmStatus":"registerInterestVmStatus","data.registerInterest":"registerInterest","action.sendEmailToCustomer":"sendEmailToCustomer","action.sendEmailToCRC":"sendEmailToCRC"},"mode":"pubsub"},"StoreContextDataViewModel":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/StoreContextDataViewModel","vmKeys":{"data.storeContextDataVmStatus":"storeContextDataVmStatus","data.deviceTopicValues":"deviceTopicValues","data.miniCartTopicValues":"miniCartTopicValues","data.orderContextValues":"orderContextValues"},"mode":"pubsub"},"GetOrderInContextDataTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetOrderInContextDataViewModel","vmKeys":{"data.orderContextDataVmStatus":"orderContextDataVmStatus"},"mode":"pubsub"},"CheckPendingOnPendingOrderTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/CheckPendingOnPendingOrderViewModel","vmKeys":{"data.pendingOrderVmStatus":"pendingOrderVmStatus","data.pendingOrderData":"pendingOrderData","action.cancelPendingOrders":"cancelPendingOrders"},"mode":"pubsub"},"GetDmpCommerceTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetDmpCommerceViewModel","vmKeys":{"data.phoneData":"phoneData","data.gtmViewStatus":"gtmViewStatus","action.onPhoneSelection":"onPhoneSelection","action.onPhoneDetailsSelection":"onPhoneDetailsSelection","action.getPlanSelectionData":"getPlanSelectionData"},"mode":"pubsub"},"GATopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","vmKeys":{"data.gtmData":"gtmData","data.gtmViewStatus":"gtmViewStatus","action.publishData":"publishData"},"mode":"pubsub"},"PickAndGoTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PickAndGoViewModel","vmKeys":{"data.pickAndGoStatus":"pickAndGoStatus","action.updateCode":"updateCode"},"mode":"pubsub"},"GetPromoDataTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetPromoDataViewModel","vmKeys":{"data.upcStatus":"upcStatus","action.getPromoData":"getPromoData"},"mode":"pubsub"},"ExtendReservationTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ExtendReservationViewModel","vmKeys":{"data.mtposReservationTime":"mtposReservationTime","data.cancelOrderActions":"cancelOrderActions","data.extendStatus":"extendStatus","data.mtposSessExpTime":"mtposSessExpTime","action.extendReservation":"extendReservation","action._cancelOrder":"_cancelOrder"},"mode":"pubsub"},"ExpressCheckoutTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ExpressCheckoutViewModel","vmKeys":{"data.expressCheckoutVmStatus":"expressCheckoutVmStatus","data.selectedRecontractDetails":"selectedRecontractDetails","data.newContactDetails":"newContactDetails","data.isEbillCus":"isEbillCus","action.getSuccessMessage":"getSuccessMessage","action.updateContactDetails":"updateContactDetails"},"mode":"pubsub"},"SingtelEnergyTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyViewModel","vmKeys":{"data.singtelEnergyVmStatus":"singtelEnergyVmStatus","data.contactDetails":"contactDetails","data.loginVmStatus":"loginVmStatus","action.validateContactDetails":"validateContactDetails","action.validateOtp":"validateOtp","action.validateAccount":"validateAccount","action.sendOTP":"sendOTP","action.setOnePassFields":"setOnePassFields","action.setFormData":"setFormData"},"mode":"pubsub"},"SingtelEnergyEmailTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/EnergyEmailNotificationViewModel","vmKeys":{"data.customerRoiData":"customerRoiData","data.notificationVmstatus":"notificationVmstatus","data.customerCallbackData":"customerCallbackData","action.triggerEnergyRoiEmail":"triggerEnergyRoiEmail","action.triggerEnergyCallbackEmail":"triggerEnergyCallbackEmail","action.triggerEnergyNonAccountEmail":"triggerEnergyNonAccountEmail"},"mode":"pubsub"},"SingtelEnergyLoadServicesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyLoadServicesViewModel","vmKeys":{"data.singtelEnergyServicesVmStatus":"singtelEnergyServicesVmStatus","data.contactData":"contactData","data.customerDetails":"customerDetails","data.servicesDetails":"servicesDetails","action.registerCustomer":"registerCustomer","action.onUpdateSuccess":"onUpdateSuccess","action.findBillingAccount":"findBillingAccount","action.updateContactDetails":"updateContactDetails","action.notOwner":"notOwner","action.serviceUnavailable":"serviceUnavailable"},"mode":"pubsub"},"SingtelEnergyOrderConfirmationTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderConfirmationViewModel","vmKeys":{"data.singtelEnergyConfirmVmStatus":"singtelEnergyConfirmVmStatus","data.productOrderID":"productOrderID"},"mode":"pubsub"},"SingtelEnergyOrderSummaryTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderSummaryViewModel","vmKeys":{"data.singtelEnergySummaryVmStatus":"singtelEnergySummaryVmStatus","data.orderData":"orderData","action.submitOrder":"submitOrder"},"mode":"pubsub"},"SingtelEnergyOrderingTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelEnergyOrderingViewModel","vmKeys":{"data.singtelEnergyOrderingVmStatus":"singtelEnergyOrderingVmStatus","data.orderStaticDetails":"orderStaticDetails","data.address":"address","data.orderingData":"orderingData","action.createAddress":"createAddress"},"mode":"pubsub"},"WorryFreeTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/WorryFreeViewModel","vmKeys":{"data.worryFreeVMStatus":"worryFreeVMStatus","data.otpInput":"otpInput","data.isOTPResend":"isOTPResend","action.sendWorryFreeOtp":"sendWorryFreeOtp","action.verifyWorryFreeOtp":"verifyWorryFreeOtp","action.verifyBillingActWorryFreeOtp":"verifyBillingActWorryFreeOtp","action.deleteWorryFree":"deleteWorryFree","action.sendWorryFreePostcode":"sendWorryFreePostcode","action.sendAcceptorWorryFreeOtp":"sendAcceptorWorryFreeOtp","action.verifyAcceptorWorryFreeOtp":"verifyAcceptorWorryFreeOtp"},"mode":"pubsub"},"UpdateOrderActionAttributesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/UpdateOrderActionAttributesViewModel","vmKeys":{"data.upaStatus":"upaStatus","action._updateOrderCustomized":"_updateOrderCustomized"},"mode":"pubsub"},"WorryFreeContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/WorryFreeContextTopicViewModel","vmKeys":{"data.otpData":"otpData"},"mode":"pubsub"},"SingtelOneClickViewModelTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelOneClickViewModel","vmKeys":{"data.oneClickVmStatus":"oneClickVmStatus","data.oneClickData":"oneClickData","action.setOneClickData":"setOneClickData","action.clearAllTopics":"clearAllTopics"},"mode":"pubsub"},"documentListTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplServiceAgreementViewModel","vmKeys":{"data.docList":"docList","data.docId":"docId","data.serviceAgreementVmStatus":"serviceAgreementVmStatus","action.downloadDocument":"downloadDocument"},"mode":"pubsub"},"SelfCollectNowTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SelfCollectNowViewModel","vmKeys":{"data.selfCollectNowVmStatus":"selfCollectNowVmStatus","data.selfCollectNowInputInfo":"selfCollectNowInputInfo","data.selfCollectNowStoresList":"selfCollectNowStoresList","action.retrieveCollectNowStores":"retrieveCollectNowStores","action.createAppointment":"createAppointment","action.extendAppointment":"extendAppointment","action.cancelAppointment":"cancelAppointment"},"mode":"pubsub"},"GetFulfillmentDetailsTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/GetFulfillmentDetailsViewModel","vmKeys":{"data.fulfillmentDetailsVmStatus":"fulfillmentDetailsVmStatus","data.isFulFillmentRequired":"isFulFillmentRequired","action.checkIfFulFillmentRequired":"checkIfFulFillmentRequired","action.getBillSpecIdPayChannel":"getBillSpecIdPayChannel","data.selectedBar":"selectedBar"},"mode":"pubsub"},"SingtelShopEAppointmentTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel","vmKeys":{"data.storeEAppointmentSlots":"storeEAppointmentSlots","data.singtelStoreAptVmStatus":"singtelStoreAptVmStatus","data.singtelShopData":"singtelShopData","data.selectedStoreDetails":"selectedStoreDetails","data.exisitingAppointmentInput":"exisitingAppointmentInput","data.viewAptData":"viewAptData","data.shopOrderConsolidationResult":"shopOrderConsolidationResult","data.newAppointmentInput":"newAppointmentInput","data.newAppointmentDetails":"newAppointmentDetails","data.errorObj":"errorObj","data.storeAptDetails":"storeAptDetails","data.hideStore":"hideStore","action.retrieveStoreTimeSlots":"retrieveStoreTimeSlots","action.retrieveStoreAppointment":"retrieveStoreAppointment","action.cancelStoreAppointment":"cancelStoreAppointment","action.createStoreAppointment":"createStoreAppointment","action.createEShopStoreAppointment":"createEShopStoreAppointment","action.createECareStoreAppointment":"createECareStoreAppointment","action.anonymousRetrieveStoreTimeSlots":"anonymousRetrieveStoreTimeSlots","action.updateExistingStoreAppointment":"updateExistingStoreAppointment"},"mode":"pubsub"},"ConsolidateAppointmentTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/ConsolidateAppointmentViewModel","vmKeys":{"data.orderConsolidationResponse":"orderConsolidationResponse","data.exisitingAppointmentStatus":"exisitingAppointmentStatus","action.getExisitingAppointment":"getExisitingAppointment"},"mode":"pubsub"},"PrepaidServicesTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/PrepaidServicesViewModel","vmKeys":{"data.prepaidServicesVmStatus":"prepaidServicesVmStatus","data.validateNumberDetails":"validateNumberDetails","data.customerMinimalInformation":"customerMinimalInformation","data.finalNumberDetails":"finalNumberDetails","data.deviceInformationContainment":"deviceInformationContainment","data.vendorCode":"vendorCode","data.dealerCode":"dealerCode","data.flowType":"flowType","data.addComponentList":"addComponentList","data.preTickAddonDetails":"preTickAddonDetails","action.checkNumber":"checkNumber","action.wrapUpdateContact":"wrapUpdateContact","action.handleOrder":"handleOrder","action.checkPendingOrders":"checkPendingOrders","action.getPrepaidServices":"getPrepaidServices"},"mode":"pubsub"}});
define("l9_common.commerceTopicsBinding",{"binding":[]});
define("l9_common.commerceExpPackage",["l3_common.commerceExpPackage","l9_common.commerceWidgets","l9_common.commerceTopics","l9_common.commerceTopicsBinding","text!businesswidget/repository_l9_common/common/config/l9_common.commercePackage.config.json","single!businesswidget/repository_l9_common/common/core/ImplRepositoryGlobalErrorHandler"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l9_common/common/i18n/commerce/web/nls/l9_common.commerceStrings")});
define("l3_common.commerce.custom",["replace","l9_common.commerce.custom"],function() {});
define("l3_common.commerceWidgets",{});
define("l3_common.commerceTopics",{});
define("l3_common.commerceTopicsBinding",{"binding":[]});
define("l3_common.commerceExpPackage",["l0.commerceExpPackage","l3_common.commerceWidgets","l3_common.commerceTopics","l3_common.commerceTopicsBinding","text!businesswidget/repository_l3_common/common/config/l3_common.commercePackage.config.json"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l3_common/common/i18n/commerce/web/nls/l3_common.commerceStrings")});
define("text!businesswidget/repository/common/config/commercePackage.config.json",function (){return'({\n\t"experiencePackage": "commerce",\n\t"NPCWidget_displayFormatEnum": {\n\t\t"CALENDAR": "date",\n\t\t"CHECKBOX": "checkbox",\n\t\t"DATE_ONLY": "date",\n\t\t"DROPDOWN_LISTBOX": "select",\n\t\t"LISTBOX": "select",\n\t\t"MULTI_LINE_TEXTBOX": "textarea",\n\t\t"RADIO_BUTTON": "radio",\n\t\t"TEXTBOX": "text",\n\t\t"CALENDAR_AND_TIME": "timedate"\n\t},\n\t"NPCWidget_unassociatedStepId": "0",\n\t// NPC widget default parameters\n\t"NPCWidget_IngeterType": ["NU", "INTEGER"],\n\t"NPCWidget_DoubleType": ["DB", "DOUBLE"],\n\t"NPCWidget_DiscreteType": ["DI", "DISCRETE"],\n\t"NPCWidget_RangeType": ["RA", "RANGE"],\n\t"NPCWidget_displayableControls": {\n\t\t"Save": false,\n\t\t"Revert": false,\n\t\t"Continue": false,\n\t\t"CancelLink": true\n\t},\n\t"NPCWidget_displayableControls_ContinueAction": "Validate", //options: Validate/ValidateAndSave/Save\n\t"NPCWidget_displayableControls_ContinueLabel": "Continue",\n\t"NPCWidget_displayableControls_showBackButton": false,\n\t"NPCWidget_PlanBusiness_DynamicPropertiesName": "Component Business Type",\n\t"NPCWidget_PlanBusiness_DynamicPropertiesValue": "Plan",\n\t"NPCWidget_validateSteps": true,\n\t"NPCWidget_itemCollapsed": "allOpen", // define the inital state of the containers. valid values: allClosed, allOpen, firstOpen\n\t"NPCWidget_DisableExpandCollapsed": false, // true means expand/collapsed will not be presented for containers, and itemCollapsed will be forced to allOpen. default is false.\n\t"NPCWidget_F&F_businessType": "FRIENDS_AND_FAMILY",\n\t"NPCWidget_TV_NewLOBFlow_PageSize": 20,\n\t"NPCWidget_TV_businessType" : "TV_STB",\n    "NPCWidget_SERVICE_businessType" : "SERVICE",\n\t"NPCWidget_StepType": {\n\t\t"TV": {\n\t\t\t"Services": 5576651,\n\t\t\t"Receivers": 5576661\n\t\t}\n\t},\n\t"NPCWidget_showUnassociatedSettingsWarning": true,\n\t"NPCWidget_quoteRecurringPriceFrequency": "Monthly",\n\t"NPCWidget_supportedResourcesForReserve": [\'C\'],\n\t"NPCWidget_reservationIdCharacteristicID": "56671131",\n\t"NPCWidget_storeIdCharacteristicID": "56671141",\n\t"NPCWidget_acquisitionTypeCharacteristicID": "8022622",\n\t"NPCWidget_deviceSNCharacteristicID": "5436369",\n\t"NPCWidget_skuIdCharacteristicID": "4505468",\n\n\t//Micro Cart\n\t"MicroCart_ConfigurationDisplayLevel_HideComponent": false,\n\t"MicroCart_ManagePricing_isManagePricingLinkVisible": true,\n\t"MicroCart_AgentView_payChannelType": 1, // PREPAID-0, POSTPAID-1\n\t"PrepaidPlansCategoryStructureID": 5584431,\n\t"PostpaidPlansCategoryStructureID": 5556111,\n\t// Reserve Resource\n\t"allowFilterResourcesByCategory": true,\n\t"defaultNumberOfProposedResources": 5,\n\t"isTempNumberSupported": true,\n\n\t// OrderList default parameters\n\t"presentMonthlyAlways": false,\n\n\t"MyStuffMultiLobMenuItems": {\n\t\t"wirelessMenuItems": {\n\t\t\t"PLAN": {\n\t\t\t\t"key": "plan",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_plan_title",\n\t\t\t\t"order": 1,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"DEVICES": {\n\t\t\t\t"key": "devices",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_devices_title",\n\t\t\t\t"order": 2,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"SERVICES": {\n\t\t\t\t"key": "services",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_services_title",\n\t\t\t\t"order": 3,\n\t\t\t\t"isVisible": true\n\t\t\t}\n\t\t},\n\t\t"wirelessGLPMenuItems": {\n\t\t\t"PLAN": {\n\t\t\t\t"key": "plan",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_plan_title",\n\t\t\t\t"order": 1,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"SERVICES": {\n\t\t\t\t"key": "services",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_services_title",\n\t\t\t\t"order": 2,\n\t\t\t\t"isVisible": true\n\t\t\t}\n\t\t},\n\t\t"homePhoneMenuItems": {\n\t\t\t"PLAN": {\n\t\t\t\t"key": "plan",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_plan_title",\n\t\t\t\t"order": 1,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"SERVICES": {\n\t\t\t\t"key": "services",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_services_title",\n\t\t\t\t"order": 2,\n\t\t\t\t"isVisible": true\n\t\t\t}\n\t\t},\n\t\t"internetMenuItems": {\n\t\t\t"PLAN": {\n\t\t\t\t"key": "plan",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_plan_title",\n\t\t\t\t"order": 1,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"SERVICES": {\n\t\t\t\t"key": "services",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_services_title",\n\t\t\t\t"order": 2,\n\t\t\t\t"isVisible": true\n\t\t\t}\n\t\t},\n\t\t"TVMenuItems": {\n\t\t\t"PLAN": {\n\t\t\t\t"key": "plan",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_plan_title",\n\t\t\t\t"order": 1,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"PACKAGES": {\n\t\t\t\t"key": "packages",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_packages_title",\n\t\t\t\t"order": 2,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"CHANNELS": {\n\t\t\t\t"key": "channels",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_channels_title",\n\t\t\t\t"order": 3,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"SERVICES": {\n\t\t\t\t"key": "services",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_services_title",\n\t\t\t\t"order": 4,\n\t\t\t\t"isVisible": true\n\t\t\t},\n\t\t\t"RECEIVERS": {\n\t\t\t\t"key": "receivers",\n\t\t\t\t"name": "cm_myProductsAndServicesWidget_receivers_title",\n\t\t\t\t"order": 5,\n\t\t\t\t"isVisible": true\n\t\t\t}\n\t\t}\n\t},\n\t"customCharge_formatter": "customChargeFormatter",\n\t"customPricePreparation_formatter": "customPricePreparationFormatter",\n\t"addColon_formatter": "addColonFormatter",\n\t"addCommas_formatter": "addCommasFormatter",\n\t"searchResultHighlight_formatter": "searchResultHighlightFormatter",\n\n\n\t//item list Widget\n\t"itemListWidget_listPageSize": 10,\n\t"itemListWidget_defaultRecurringFrequency": "MONTH",\n\t"itemListWidget_showCurrency": true,\n\t"itemListWidget_maxItemsNumberToCompare": 3,\n\t"itemListWidget_minItemsNumberToCompare": 2,\n\t"itemListWidget_maxTopItemsToShow": 3,\n\t"itemListWidget_topItemsBundleCategoryID": "5563078",\n\t"itemListWidget_topItemsBundleBusinessType": "OFFERING",\n\t"itemListWidget_maximumVariantsToDisplayURL": 6,\n\t"itemListWidget_maximumVariantsToDisplayNOTURL": 3,\n\t"itemListWidget_returnOffers": false,\n\n\t// Item list widget - CPD check\n\t"itemListWidget_mobileHG": {\n\t\t"MD": "MobileDevice",\n\t\t"AC": "MobileAccessory"\n\t},\n\n\t"itemListWidget_lobImageTypes": {\n\t\t"mobile.png": "WS",\n\t\t"LOB_WS_small.png": "WS",\n\t\t"wireline.png": "WL",\n\t\t"LOB_WL_small.png": "WL",\n\t\t"tv.png": "TV",\n\t\t"LOB_TV_small.png": "TV",\n\t\t"internet.png": "IN",\n\t\t"LOB_IN_small.png": "IN"\n\t},\n\n\t"itemListWidget_sortEnum": [{\n\n\n\t\t\t\'type\': \'NAME\',\n\t\t\t\'ascending\': true,\n\t\t\t\'sortNameToDisplay\': "cm_itemListWidget_sortBy_Name_A-Z"\n\n\t\t},\n\n\t\t{\n\t\t\t\'type\': \'NAME\',\n\t\t\t\'ascending\': false,\n\t\t\t\'sortNameToDisplay\': "cm_itemListWidget_sortBy_Name_Z-A"\n\t\t}, {\n\n\t\t\t\'type\': \'PRICE\',\n\t\t\t\'ascending\': true,\n\t\t\t\'sortNameToDisplay\': "cm_itemListWidget_sortBy_Pricing_Low_to_High"\n\n\t\t}, {\n\n\t\t\t\'type\': \'PRICE\',\n\t\t\t\'ascending\': false,\n\t\t\t\'sortNameToDisplay\': "cm_itemListWidget_sortBy_Pricing_High_to_Low"\n\n\t\t}\n\t],\n\t"itemListWidget.sortPriceTypes": {\n\t\t"default": \'RECURRING_CHARGE\',\n\t\t"DEVICE": \'ONETIME_CHARGE\',\n\t\t"PLAN": \'RECURRING_CHARGE\',\n\t\t"PRICE_PACKAGE": \'RECURRING_CHARGE\',\n\t\t"F_N_F_SERVICE": \'RECURRING_CHARGE\',\n\t\t"OFFERING": \'RECURRING_CHARGE\',\n\t\t"SERVICE": \'RECURRING_CHARGE\',\n\t\t"TV_PACKAGE": \'RECURRING_CHARGE\',\n\t\t"TV_CHANNEL": \'RECURRING_CHARGE\',\n\t\t"MD": \'ONETIME_CHARGE\',\n\t\t"AC": \'ONETIME_CHARGE\'\n\t},\n\t//following configuration is applicable when when multipleLOBs query parameter for REST is set to false. \'true\' value will return Bundle Offers e.g. Family Offers, which has multiple products.\n\t"itemListWidget_returnBundleWithSingleLOB": false,\n\t// Include product offering details for each item in the item list\n\t"itemListWidget_includeProductOfferingDetails": false,\n\n\t"CatalogCategoriesModel.rff": true,\n\n\t//serach widget\n\t"searchWidget_resultsSize": 2,\n\t"searchWidget_moreResultsSize": 5,\n\t"searchWidget_showCurrency": true,\n\t"searchWidget_maximumVariantsToDisplayURL": 6,\n\t"searchWidget_maximumVariantsToDisplayNOTURL": 3,\n\n\t//Compatible Plans List\n\t"compatiblePlanListWidget_maxItemsNumberToCompare": 3,\n\t"compatiblePlanListWidget_showCurrency": true,\n\t"compatiblePlanListWidget_returnOnlySPOItems": true,\n\t"compatiblePlanListWidget_maxUpSaleItemsToShow": 3, //max value is 3\n\t"compatiblePlanListWidget_targetType_Catalog": "Catalog",\n\t"compatiblePlanListWidget_targetType_Customer": "Customer",\n\n\t//Comapre Items\n\t"compareItemsWidget_businessType_DEVICE": "DEVICE",\n\t"compareItemsWidget_businessType_PLAN": "PLAN",\n\t"compareItemsWidget_businessType_OFFERING": "OFFERING",\n\t"compareItemsWidget_entityType_default": "HARDGOODS",\n\t"compareItemsWidget_entityType_PLAN": "PLAN",\n\t"compareItemsWidget_entityType_PLANOFFER": "PLANOFFER",\n\t"compareItemsWidget_entityType_BUNDLE": "BUNDLE",\n\t"compareItemsWidget_entityType": {\n\t\t"HARDGOODS": "HARDGOODS",\n\t\t"PLAN": "PLAN",\n\t\t"PLANOFFER": "PLANOFFER",\n\t\t"BUNDLE": "BUNDLE"\n\t},\n\n\t//Business Type\n\t"businessType_DEVICE_MD": "MD",\n\t"businessType_ACCESSORY": "AC",\n\t\n\t// IndividualEmailAddresses\n\t"EmailLength": 80,\n\t"EmailMask": "******",\n\n\t//Serviceability Widget\n\t"mode": "Serviceability",\n\t"ZipCodeFormat": "#####-####",\n\t"ZipCodeFormatString": "^\\\\d{5}(-\\\\d{4})?$",\n\t//create Address widget for Serviceability Widget\n\t"AddressLinesLength": 200,\n\t"CityLength": 40,\n\t"PostalLength": 20,\n\t"countryDefault": "US",\n\n\t//Hard Good Details Widget\n\t"numberOfCharacters": 60,\n\t"selectAccessories": "Select Accessories",\n\n\t//Hard Good Widget Events\n\t"hard_goodDetails_planDetails_action": {\n\t\t"actionType": "OpenWidget",\n\t\t"actionTarget": "",\n\t\t"actionParams": {}\n\t},\n\t"hard_goodDetails_matchingAccessories_action": {\n\t\t"actionType": "OpenWidget",\n\t\t"actionTarget": "",\n\t\t"actionParams": {}\n\t},\n\t"hard_goodDetails_backButton_action": {\n\t\t"actionType": "OpenWidget",\n\t\t"actionTarget": "",\n\t\t"actionParams": {}\n\t},\n\t"defaultImageForCrossSellRecommnededItem": "https://portfolio1srv.corp.amdocs.com/HBO.png",\n\t"lowerThresholdDefaultValue": 10,\n\t"upperThresholdDefaultValue": 100,\n\n\t//social share widget\n\t"facebook_config": {\n\t\t"appId": "707929789328788",\n\t\t"version": "v2.2",\n\t\t"xfbml": "false"\n\t},\n\n\t//Tagging Manager\n\t"useDataManipulationForTagging": false,\n\n\t// Recommend target plan widget\n\t"recommendTargetPlanWidget_supportCustomerPlan": false,\n\n\t/*\n\t * Configuration items for adopting applications\n\t * These are application-wide changes\n\t * Override these parameters in adopting application\n\t */\n\t//configuration item for ARIM to display pay in store amount in order summary widget.\n\t//the possible value for this "on" or "off". default value is "Off" for omni channel widget\n\t"ToPayInStore": "off",\n\t"fetchDynamicAttrs": false,\n\t"CheckDeviceAvailibility": false,\n\t//configuration to allow item list widget opened from NPC to enable reservation of devices\n\t//when set to true, item list will show link "check in other store links"\n\t"allowReserveItemsInNPC": false,\n\t//if displayStockAvailabilityInNpc is true, check StockAvailability. it is collision with arim stock availability hence will be deprecated in next version\n\t"displayStockAvailabilityInNpc": false,\n\t"lobs": {\n\t\tTV: "TV",\n\t\tWS: "WS",\n\t\tIN: "IN",\n\t\tWL: "WL"\n\t},\n\t"orderActionStatusEnum": {\n\t\t"INITIAL": "IN",\n\t\t"NEGOTIATION": "NE"\n\t},\n\n\t// Report Found widget\n\t"found_config" : {\n\t\t"allowManualIMEI": false,  // false for SS, and true for all other\n\t\t"allowUnBlockDeviceOnlySelection" : true,\n\t\t"defaultReasonCode" : \'\',\n\t\t"IMEIValidation" : "15,17",\n\t\t"maxAllowedFreeText" : 512,\n\t\t"reasonCodeLabel" : "Reason:",\n\t\t"recentDeviceMaxNumber" : 3,\n\t\t"showImages" : true,\n\t\t"showReasonCodeSelection" : false,\n\t\t"showReasonFreeText" : false,\n\t\t"supportDeviceManagementIntegration" : true,\n\t\t"showHideTitle":true\n\t},\n\n\t//Report Lost Widget\n\t"report_config" : {\n\t    "supportDeviceManagementIntegration": true,\n\t    "allowChangeDevice": true,\n\t    "allowBlockDeviceOnlySelection": true,\n\t    "allowSearchDeviceByDate": true,\n\t    "allowManualIMEI": false,\n\t    "maxAllowedFreeText": 512,\n\t    "allowReasonFreeText": false,\n\t    "recentDeviceMaxNumber":3,\n\t    "IMEIValidation":"15,17",\n\t    "maxIMEIValidationNumber": 17, //It should be in aligned with IMEIValidation entries\n\t    "showReasonCodeSelection": true,\n\t    "showHideTitle":true,\n\t    "useWhiteListForSuspend": true,\n\t    "showImages": true\n\t},\n\t//tv channel, package, flow error\n\t"tvChannelPackageFlowExceedMaximumQuantity":"exeeded its maximum quantity",\n\t"NPCWidget_Actions" : {\n\t\t"Change_Action" : "CH",\n\t\t"Remove_Action" : "RM",\n\t\t"Add_Action" : "AD", \n\t\t"Resume_Action" : "RS",\n\t\t"Suspend_Action" : "SU", \n\t\t"Reestablish_Action" : "ES"\n\t}\n})'});
define("commerceWidgets",{"addressServiceabilityWidget":"businesswidget/repository/widgetsLibrary/addressServiceabilityWidget/AddressServiceabilityWidget","bundleCatalogDetailsWidget":"businesswidget/repository/widgetsLibrary/bundleCatalogDetailsWidget/web/BundleCatalogDetailsWidget","channelCatalogDetailsWidget":"businesswidget/repository/widgetsLibrary/channelCatalogDetailsWidget/web/ChannelCatalogDetailsWidget","compareItemsWidget":"businesswidget/repository/widgetsLibrary/compareItemsWidget/web/CompareItemsWidget","compatiblePlanListWidget":"businesswidget/repository/widgetsLibrary/compatiblePlanListWidget/web/CompatiblePlanListWidget","ConfigureMultiProductsWidget":"businesswidget/repository/widgetsLibrary/configureMultiProductsWidget/web/ConfigureMultiProductsWidget","contactWidget":"businesswidget/repository/widgetsLibrary/externalWidgets/testingWidgets/ContactSampleWidget/web/ContactWidget","crossSellItemWidget":"businesswidget/repository/widgetsLibrary/crossSellItemWidget/web/CrossSellItemWidget","customerEligibilityWidget":"businesswidget/repository/widgetsLibrary/customerEligibilityWidget/web/CustomerEligibilityWidget","customerHardGoodsDetailsWidget":"businesswidget/repository/widgetsLibrary/customerHardGoodsDetailsWidget/web/CustomerHardGoodsDetailsWidget","customerHardGoodsWidget":"businesswidget/repository/widgetsLibrary/customerHardGoodsWidget/web/CustomerHardGoodsWidget","createIndividualWidget":"businesswidget/repository/widgetsLibrary/createIndividualWidget/web/createIndividualWidget","customerOrderListDetails":"businesswidget/repository/widgetsLibrary/customerOrderListDetailsWidget/web/CustomerOrderListDetailsWidget","DLsWidget":"businesswidget/repository/widgetsLibrary/externalWidgets/testingWidgets/TNsSampleWidget/web/TNsWidget","existingOrderSummaryWidget":"businesswidget/repository/widgetsLibrary/existingOrderSummaryWidget/ExistingOrderSummaryWidget","facebookShareWidget":"businesswidget/repository/widgetsLibrary/facebookShareWidget/FacebookShareWidget","hardGoodCatalogDetailsWidget":"businesswidget/repository/widgetsLibrary/hardGoodCatalogDetailsWidget/web/HardGoodCatalogDetailsWidget","itemListWidget":"businesswidget/repository/widgetsLibrary/itemListWidget/web/ItemListWidget","microCartWidget":"businesswidget/repository/widgetsLibrary/microCartWidget/web/MicroCartWidget","MultiProductsWidget":"businesswidget/repository/widgetsLibrary/multiProductsWidget/web/MultiProductsWidget","myOrdersWidget":"businesswidget/repository/widgetsLibrary/myorderswidget/web/MyOrdersWidget","MyProductsAndServicesWidget":"businesswidget/repository/widgetsLibrary/myProductsAndServicesWidget/web/MyProductsAndServicesWidget","NPCWidget":"businesswidget/repository/widgetsLibrary/NPCwidget/web/NPCWidget","orderListWidget":"businesswidget/repository/widgetsLibrary/orderListWidget/web/OrderListWidget","OrderSummaryWidget":"businesswidget/repository/widgetsLibrary/orderSummaryWidget/web/OrderSummaryWidget","packageCatalogDetailsWidget":"businesswidget/repository/widgetsLibrary/packageCatalogDetailsWidget/web/PackageCatalogDetailsWidget","planCatalogDetailsWidget":"businesswidget/repository/widgetsLibrary/planCatalogDetailsWidget/web/PlanCatalogDetailsWidget","ProductsNavigationDropDownWidget":"businesswidget/repository/widgetsLibrary/productsNavigationDropDownWidget/web/ProductsNavigationDropDownWidget","reserveResourceWidget":"businesswidget/repository/widgetsLibrary/reserveResourceWidget/web/ReserveResourceWidget","searchWidget":"businesswidget/repository/widgetsLibrary/searchWidget/web/SearchWidget","subscriptionsSearchWidget":"businesswidget/repository/widgetsLibrary/subscriptionsSearchWidget/web/subscriptionsSearchWidget","TNsWidget":"businesswidget/repository/widgetsLibrary/externalWidgets/testingWidgets/TNsSampleWidget/web/TNsWidget","topItemWidget":"businesswidget/repository/widgetsLibrary/topItemWidget/web/TopItemWidget","orderConfirmationWidget":"businesswidget/repository/widgetsLibrary/orderConfirmationWidget/web/OrderConfirmationWidget","displayRateAndReviewWidget":"businesswidget/repository/widgetsLibrary/displayRateAndReviewWidget/web/DisplayRateAndReviewWidget","reservedItemListWidget":"businesswidget/repository/widgetsLibrary/reservedItemListWidget/web/ReservedItemListWidget","reserveItemWidget":"businesswidget/repository/widgetsLibrary/reserveItemWidget/web/ReserveItemWidget","shopWidget":"businesswidget/repository/widgetsLibrary/shopWidget/web/ShopWidget","individualEmailAddressesWidget":"businesswidget/repository/widgetsLibrary/individualEmailAddressesWidget/web/IndividualEmailAddressesWidget","sendServiceAgreementWidget":"businesswidget/repository/widgetsLibrary/sendServiceAgreementWidget/web/SendServiceAgreementWidget","recommendTargetPlanWidget":"businesswidget/repository/widgetsLibrary/recommendTargetPlanWidget/web/RecommendTargetPlanWidget","reportLostStolenWidget":"businesswidget/repository/widgetsLibrary/reportLostStolenWidget/web/ReportLostStolenWidget","foundLostStolenWidget":"businesswidget/repository/widgetsLibrary/foundLostStolenWidget/web/FoundLostStolenWidget","bundleProgressBarWidget":"businesswidget/repository/widgetsLibrary/bundleProgressBarWidget/web/BundleProgressBarWidget","bundleStepNavigationWidget":"businesswidget/repository/widgetsLibrary/bundleStepNavigationWidget/web/BundleStepNavigationWidget"});
define("commerceTopics",{"CustomerInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","vmKeys":{"data.customerId":"customerId"},"mode":"pubsub"},"amdocs.customer.CustomerInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","vmKeys":{"data.ID":"ID","data.readyForCart":"readyForCart","data.subscriptionGroupID":"subscriptionGroupID","data.isAuthenticated":"isAuthenticated","data.allowedSubscriptions":"allowedSubscriptions","action.dataReady":"dataReady","action.itemSelected":"itemSelected","action.changePlanClicked":"changePlanClicked"}},"amdocs.commerce.SendServiceAgreement":{"vmId":"single!businesswidget/repository/common/viewmodel/SendServiceAgreementTopicViewModel","vmKeys":{"data.status":"status","action.EmailSent":"EmailSent"},"mode":"pubsub"},"amdocs.commerce.CancelLink":{"vmId":"single!businesswidget/repository/common/viewmodel/CancelLinkViewModel","vmKeys":{"action.LinkClicked":"LinkClicked","data.widgetID":"widgetID","data.widgetName":"widgetName","data.identifier":"identifier"},"mode":"pubsub"},"amdocs.commerce.DevicesAccessoriesInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/DevicesAccessoriesTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.selectedDeviceList":"selectedDeviceList","data.payChannelType":"payChannelType","data.eligibleSubscriptions":"eligibleSubscriptions","data.enforceEligibility":"enforceEligibility","data.numOfSubscriptions":"numOfSubscriptions","action.clearCart":"clearCart","data.planCategories":"planCategories","data.planCategoryId":"planCategoryId"},"mode":"pubsub"},"amdocs.common.MyProducts":{"vmId":"single!businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel","vmKeys":{"data.sharedProductId":"sharedProductId","data.catalogItemID":"catalogItemID","data.assignedProductID":"assignedProductID","data.lobCode":"lobCode","data.supportNavigationIndicator":"supportNavigationIndicator","data.internetMenuItems":"internetMenuItems","data.TVMenuItems":"TVMenuItems","data.wirelessMenuItems":"wirelessMenuItems","data.homePhoneMenuItems":"homePhoneMenuItems","data.defaultMenuItem":"defaultMenuItem","data.includeSuspended":"includeSuspended","data.includeTopItemsWidget":"includeTopItemsWidget","data.includeCrossSellWidget":"includeCrossSellWidget","data.includeBundleAddOns":"includeBundleAddOns","action.changePlanClicked":"changePlanClicked","action.addSubscription":"addSubscription","action.replaceDevice":"replaceDevice","action.viewTopItemPlanDetails":"viewTopItemPlanDetails"},"mode":"pubsub"},"amdocs.common.ProductNavigationParameters":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductsNavigationDropDownWidgetViewModel","vmKeys":{"data.lobCode":"lobCode","data.assignedProductID":"assignedProductID","data.includeSuspended":"includeSuspended","data.includeEntireAccount":"includeEntireAccount","data.presentOneProduct":"presentOneProduct","data.navigationHeaderTitle":"navigationHeaderTitle","data.includeBundle":"includeBundle","data.isTitleClickable":"isTitleClickable","data.subscriptionId":"subscriptionId","action.productSelected":"productSelected","action.productsNavigationDropDownWidget:initialized":"productsNavigationDropDownWidget:initialized"},"mode":"pubsub"},"amdocs.common.ApplicationContext":{"vmId":"single!businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel","vmKeys":{"data.locale":"locale","data.salesChannel":"salesChannel","action.dataReady":"dataReady"},"mode":"pubsub"},"amdocs.customerorder.OrderingContext":{"vmId":"single!businesswidget/repository/common/viewmodel/OrderingContextTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.frameworkId":"frameworkId","data.clientId":"clientId","action.dataReady":"dataReady"}},"myOrdersWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/MyOrdersWidgetViewModel","vmKeys":{"data.draftOrderSelected":"draftOrderSelected","data.orderSelected":"orderSelected","action.viewAllDrafts":"viewAllDrafts","action.viewAllOrders":"viewAllOrders"},"mode":"sub"},"amdocs.customerorder.ProductConfiguration":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.productOfferingID":"productOfferingID","data.productOfferingProductSpecID":"productOfferingProductSpecID","data.productSpecID":"productSpecID","data.productOfferingType":"productOfferingType","data.productOrderItemID":"productOrderItemID","data.productOrderItemType":"productOrderItemType","data.productOrderItemReason":"productOrderItemReason","data.productOrderItemReasonText":"productOrderItemReasonText","data.serviceRequiredDate":"serviceRequiredDate","data.flowName":"flowName","data.installationAddressID":"installationAddressID","data.activityName":"activityName","data.lobCode":"lobCode","data.configurationToDisplay":"configurationToDisplay","data.productID":"productID","data.deviceAssignedProductID":"deviceAssignedProductID","data.containedProductID":"containedProductID","data.containedProductParentID":"containedProductParentID","data.productSpecContainmentID":"productSpecContainmentID","data.containedProductType":"containedProductType","data.parentProductSpecContainmentID":"parentProductSpecContainmentID","data.containedProductSpecID":"containedProductSpecID","data.additionalBillingOfferID":"additionalBillingOfferID","data.priceSchemaID":"priceSchemaID","data.isReplacedOffer":"isReplacedOffer","data.quantity":"quantity","data.sellableWithoutPlan":"sellableWithoutPlan","data.businessType":"businessType","data.name":"name","data.description":"description","data.lobs":"lobs","data.orderItemRefID":"orderItemRefID","data.reserveItemDetails":"reserveItemDetails","action.dataReady":"dataReady","action.compareWithMyPlan":"compareWithMyPlan","action.itemSelected":"itemSelected","action.changePlanClicked":"changePlanClicked","action.buyPlanClicked":"buyPlanClicked","action.changePlanActionPerformed":"changePlanActionPerformed","action.upgradeDevice":"upgradeDevice","action.buyHardGoodWithExitingPlan":"buyHardGoodWithExitingPlan","action.addOutofStockItemToCart":"addOutofStockItemToCart","action.ReserveItem":"ReserveItem","action.upgradeDeviceActionPerformed":"upgradeDeviceActionPerformed","action.compatiblePlanList":"compatiblePlanList","action.relatedDevicesUpgrade":"relatedDevicesUpgrade","action.addItemToCart":"addItemToCart","action.relatedPlans":"relatedPlans","action.relatedDevices":"relatedDevices","action.changeSucceed":"changeSucceed","action.changeSucceedHavingNoPriceImpact":"changeSucceedHavingNoPriceImpact","action.changeSucceedWithExistingOrder":"changeSucceedWithExistingOrder"}},"amdocs.customerorder.ProductConfigurationBehavior":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationBehaviorTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.readOnlyMode":"readOnlyMode","data.showContinueButton":"showContinueButton","data.continueButtonLabel":"continueButtonLabel","data.continueButtonAction":"continueButtonAction","data.showCancelLink":"showCancelLink","data.displayNotifications":"displayNotifications","data.itemCollapsed":"itemCollapsed","data.disableExpandCollapsed":"disableExpandCollapsed","data.showOptionalBillingOfferPrice":"showOptionalBillingOfferPrice","data.showOptionalComponentPrice":"showOptionalComponentPrice","data.showSaveButton":"showSaveButton","data.showRevertButton":"showRevertButton","data.validateSteps":"validateSteps","data.toggleRefreshConfigurationButton":"toggleRefreshConfigurationButton","action.dataReady":"dataReady"}},"amdocs.customerorder.ProductOrder":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.productOrderID":"productOrderID","data.productOrderReferenceNumber":"productOrderReferenceNumber","data.productOrderItems":"productOrderItems","action.dataReady":"dataReady","action.productOrder":"productOrder"}},"amdocs.customerorder.OrderConfirmation":{"vmId":"single!businesswidget/repository/common/viewmodel/OrderConfirmationTopicViewModel","vmKeys":{"action.viewOrder":"viewOrder","action.backToShop":"backToShop"}},"amdocs.customerorder.ProductConfigurationAction":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationActionTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.succeeded":"succeeded","data.validateResponse":"validateResponse","data.exceptions":"exceptions","data.ValidateProductConfigurationResponse":"ValidateProductConfigurationResponse","data.productChanges":"productChanges","data.isASCFEvent":"isASCFEvent","data.itemReservationResult":"itemReservationResult","action.dataReady":"dataReady","data.productsBar":"productsBar","action.Save":"Save","action.Validate":"Validate","action.ValidateAndSave":"ValidateAndSave","action.ValidateAndSaveAllProducts":"ValidateAndSaveAllProducts","action.Revert":"Revert","action.Continue":"Continue","action.Cancel":"Cancel","action.RefreshConfigurationAndPrices":"RefreshConfigurationAndPrices","action.saveAndRefreshConfiguration":"saveAndRefreshConfiguration","action.SaveResults":"SaveResults","action.ValidateResult":"ValidateResult","action.ValidateAndSaveResults":"ValidateAndSaveResults","action.RevertResults":"RevertResults","action.ContinueResult":"ContinueResult","action.BackResult":"BackResult","action.CancelResult":"CancelResult","action.ValidateAndSaveAllProductsResults":"ValidateAndSaveAllProductsResults","action.InternalConfigurationSelectionStarted":"InternalConfigurationSelectionStarted","action.InternalConfigurationSelectionEnded":"InternalConfigurationSelectionEnded","action.InternalConfigurationAllocateNumberSelectionStarted":"InternalConfigurationAllocateNumberSelectionStarted","action.InternalConfigurationAllocateNumberSelectionEnded":"InternalConfigurationAllocateNumberSelectionEnded","action.RefreshPricesFailed":"RefreshPricesFailed","action.FetchDone":"FetchDone","action.ActionStart":"ActionStart","action.UpdateFinished":"UpdateFinished","action.OpenItemListTVChannels":"OpenItemListTVChannels","action.OpenItemListTVPackages":"OpenItemListTVPackages","action.ViewFullConfiguration":"ViewFullConfiguration","action.ViewMinimalConfiguration":"ViewMinimalConfiguration","action.GetItemReservation":"GetItemReservation","action.GetItemReservationResult":"GetItemReservationResult"}},"amdocs.customerorder.ProductConfigurationData":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationDataTopicViewModel","vmKeys":{"data.configuration":"configuration","data.productChanges":"productChanges","action.dataReady":"dataReady","action.refreshPrices":"refreshPrices"}},"amdocs.customerorder.ProductConfigurationStatus":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationStatusTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.status":"status","action.SetStatus":"SetStatus"}},"amdocs.customerorder.ProductConfigurationParameters":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationParametersTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.customerID":"customerID","data.subscriptionGroupID":"subscriptionGroupID","data.locale":"locale","data.salesChannel":"salesChannel","data.productOfferingID":"productOfferingID","data.productOfferingProductSpecID":"productOfferingProductSpecID","data.productOrderItemID":"productOrderItemID","data.productOrderItemType":"productOrderItemType","data.productOrderItemReason":"productOrderItemReason","data.productOrderItemReasonText":"productOrderItemReasonText","data.serviceRequiredDate":"serviceRequiredDate","data.flowName":"flowName","data.installationAddressID":"installationAddressID","data.activityName":"activityName","data.readOnlyMode":"readOnlyMode","data.stepID":"stepID"}},"amdocs.customerorder.ComponentConfiguration":{"vmId":"single!businesswidget/repository/common/viewmodel/ComponentConfigurationTopicViewModel","vmKeys":{"data.ID":"ID","data.productSpecContainment":"productSpecContainment","data.temporaryID":"temporaryID","data.Characteristics":"Characteristics"}},"amdocs.customerorder.WidgetDataAction":{"vmId":"single!businesswidget/repository/common/viewmodel/WidgetDataActionTopicViewModel","vmKeys":{"data.succeeded":"succeeded","action.Save":"Save","action.Revert":"Revert","action.ValidateAndSave":"ValidateAndSave","action.Validate":"Validate","action.Report":"Report","action.saveResult":"saveResult","action.ValidateAndSaveResult":"ValidateAndSaveResult","action.revertResult":"revertResult","action.validateResult":"validateResult","action.ReportResult":"ReportResult"}},"amdocs.customerorder.MultiProductsWidgetDataAction":{"vmId":"single!businesswidget/repository/common/viewmodel/MultiProductsWidgetDataActionTopicViewModel","vmKeys":{"data.succeeded":"succeeded","action.saveResult":"saveResult","action.validateResult":"validateResult","action.reportResult":"reportResult","action.reloadProductOrderItems":"reloadProductOrderItems"}},"IndividualInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/IndividualInContextTopicViewModel","vmKeys":{"data.personId":"personId"},"mode":"pubsub"},"topItemInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/TopItemWidgetViewModel","vmKeys":{"data.topItemID":"topItemID","data.businessType":"businessType","data.containingOfferings":"containingOfferings","data.parentCatalogItemID":"parentCatalogItemID","data.type":"type","action.topItemSelected":"topItemSelected","action.addedItem":"addedItem"},"mode":"sub"},"CrossItemSelected":{"vmId":"single!businesswidget/repository/common/viewmodel/CrossSellItemWidgetViewModel","vmKeys":{"data.itemID":"crossSellItemID","data.businessType":"businessType","data.containingOfferings":"containingOfferings","data.parentCatalogItemID":"parentCatalogItemID","data.type":"type","action.crossSellItemSelected":"crossSellItemSelected"},"mode":"pubsub"},"CrossSellSelection":{"vmId":"single!businesswidget/repository/common/viewmodel/CrossSellTopicViewModel","vmKeys":{"data.itemID":"itemID","data.removeItemID":"removeItemID","data.businessType":"businessType","data.containingOfferings":"containingOfferings","data.parentCatalogItemID":"parentCatalogItemID","data.type":"type","data.sourceId":"sourceId","data.productID":"productID","data.crossSellItemDefaultBanner":"crossSellItemDefaultBanner","action.defaultBannerSelected":"defaultBannerSelected","action.crossSellItemSelected":"crossSellItemSelected","action.itemAdded":"itemAdded","action.addedToCart":"addedToCart","action.removeFromCart":"removeFromCart","action.itemRemoved":"itemRemoved"},"mode":"pubsub"},"defaultBannerInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/TopItemWidgetViewModel","vmKeys":{"action.defaultBannerSelected":"defaultBannerSelected"},"mode":"sub"},"amdocs.customer.customerOrders":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerOrdersViewModel","vmKeys":{"data.orderId":"orderId","data.orderStatuses":"orderStatuses","data.timePeriodUOM":"timePeriodUOM","data.timePeriodNumberOfUnits":"timePeriodNumberOfUnits","data.originalSalesChannel":"originalSalesChannel"}},"ContactDetail":{"vmId":"single!businesswidget/repository/common/viewmodel/ContactDetailTopicViewModel","vmKeys":{"data.firstName":"firstName","data.lastName":"lastName","data.phoneNumber":"phoneNumber"}},"TNsTopicWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/TNsTopicViewModel","vmKeys":{"data.phoneNumbers":"phoneNumbers"}},"amdocs.customerorder.ValidationMessages":{"vmId":"single!businesswidget/repository/common/viewmodel/ValidationMessagesTopicViewModel","vmKeys":{"data.stepID":"stepID","data.validationMessages":"validationMessages"}},"amdocs.common.Exception":{"vmId":"single!businesswidget/repository/common/viewmodel/ExceptionTopicViewModel","vmKeys":{"data.widgetID":"widgetID","data.errorCode":"errorCode","data.errorMessage":"errorMessage"}},"amdocs.customerorder.DeviceInfo":{"vmId":"single!businesswidget/repository/common/viewmodel/DeviceInfoTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.deviceCatalogID":"deviceCatalogID","data.deviceName":"deviceName","data.deviceImageURL":"deviceImageURL","action.SelectDevice":"SelectDevice","action.DeviceSelected":"DeviceSelected"}},"amdocs.customerorder.PhoneNumberInfo":{"vmId":"single!businesswidget/repository/common/viewmodel/PhoneNumberInfoTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.phoneNumber":"phoneNumber","action.SelectPhoneNumber":"SelectPhoneNumber","action.PhoneNumberSelected":"PhoneNumberSelected"}},"amdocs.customerorder.DeviceAndPhoneInfo":{"vmId":"single!businesswidget/repository/common/viewmodel/DeviceAndPhoneInfoTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","data.deviceCatalogID":"deviceCatalogID","data.deviceName":"deviceName","data.deviceImageURL":"deviceImageURL","data.phoneNumber":"phoneNumber","action.DeviceAndPhoneInfo":"DeviceAndPhoneInfo","action.DeviceAndPhoneInfoResult":"DeviceAndPhoneInfoResult"}},"amdocs.customerorder.ProductConfigurationStepDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/ProductConfigurationStepDetailsTopicViewModel","vmKeys":{"data.stepName":"stepName"}},"amdocs.customerorder.WidgetAvailability":{"vmId":"single!businesswidget/repository/common/viewmodel/WidgetAvailabilityTopicViewModel","vmKeys":{"data.widgetInstanceID":"widgetInstanceID","action.OnHold":"OnHold","action.Release":"Release","action.NoAction":"NoAction"}},"amdocs.customerorder.MicroCart":{"vmId":"single!businesswidget/repository/common/viewmodel/MicroCartTopicViewModel","vmKeys":{"data.cartMode":"cartMode","action.setCartVisible":"setCartVisible","action.cartVisibilityChange":"cartVisibilityChange","action.RefreshPricesFailed ":"refreshPricesFailed","action.onHold":"onHold","action.releaseLoadSign":"releaseLoadSign","action.dataReady":"dataReady","action.refreshPrices":"refreshPrices","action.activeProductChanged":"activeProductChanged","action.disableOMSFooter":"disableOMSFooter","action.enableOMSFooter":"enableOMSFooter","action.editBundleProductConfiguration":"editBundleProductConfiguration","action.bundleProductMissingMandatoryConfiguration":"bundleProductMissingMandatoryConfiguration"},"mode":"pubsub"},"amdocs.itemList.relatedItems":{"vmId":"single!businesswidget/repository/common/viewmodel/ItemListRelatedItemsTopicViewModel","vmKeys":{"data.productSpecID":"productSpecID","data.productOfferingID":"productOfferingID","data.productOfferingProductSpecID":"productOfferingProductSpecID","data.relationID":"relationID","action.dataReady":"dataReady"},"mode":"pubsub"},"amdocs.itemList.browsingCategory":{"vmId":"single!businesswidget/repository/common/viewmodel/ItemListBrowsingCategoryTopicViewModel","vmKeys":{"data.browsingCategoryStructureID":"browsingCategoryStructureID","data.browsingCategoryID":"browsingCategoryID","action.changeCategoryId":"changeCategoryId","action.changeCategoryStructureId":"changeCategoryStructureId"},"mode":"pubsub"},"amdocs.customerorder.ConfigureMultiProducts":{"vmId":"single!businesswidget/repository/common/viewmodel/ConfigureMultiProductsTopicViewModel","vmKeys":{"data.expandCartByDefault":"expandCartByDefault","data.preLoadMessages":"preLoadMessages","action.dataReady":"dataReady","action.releaseInitialLock":"releaseInitialLock"},"mode":"pubsub"},"amdocs.customerorder.NotificationPanel":{"vmId":"single!businesswidget/repository/common/viewmodel/NotificationPanelTopicViewModel","vmKeys":{"data.orderMessages":"orderMessages","data.messages":"messages","data.stepsOrder":"stepsOrder","data.fixErrorsToContinue":"fixErrorsToContinue","data.settingsWereNotSaved":"settingsWereNotSaved","data.settingsWereSaved":"settingsWereSaved","data.notificationsArray":"notificationsArray"},"mode":"pubsub"},"amdocs.shop.ItemList":{"vmId":"single!businesswidget/repository/common/viewmodel/ItemListTopicViewModel","vmKeys":{"data.removedItem":"removedItem","data.selectedItem":"selectedItem","data.itemsSelectedDeltaStatus":"itemsSelectedDeltaStatus","data.maxNumberOfSelectedItems":"maxNumberOfSelectedItems","data.itemsStatusList":"itemsStatusList","data.browsingCategoryStructureID":"browsingCategoryStructureID","data.browsingCategoryID":"browsingCategoryID","data.currentCategoryStructureId":"currentCategoryStructureId","data.activeFilterFacets":"activeFilterFacets","data.productSpecID":"productSpecID","data.productOfferingID":"productOfferingID","data.productOfferingProductSpecID":"productOfferingProductSpecID","data.relationID":"relationID","data.InstallationAddressId":"InstallationAddressId","data.productId":"productId","data.itemsToCompare":"itemsToCompare","data.itemsToCompareBrowsingCategoryStructureID":"itemsToCompareBrowsingCategoryStructureID","data.searchText":"searchText","data.HGPresentmentLevel":"HGPresentmentLevel","data.deviceName":"deviceName","data.reserveItemDetails":"reserveItemDetails","action.onItemSelected":"onItemSelected","action.onItemRemoved":"onItemRemoved","action.onItemListDone":"onItemListDone","action.onItemListCancel":"onItemListCancel","action.onExternalItemListDone":"onExternalItemListDone","action.onSelectedSkipPlan":"onSelectedSkipPlan","action.onSelectedSkipDevice":"onSelectedSkipDevice","action.changeCategoryId":"changeCategoryId","action.changeCategoryStructureId":"changeCategoryStructureId","action.changeFilter":"changeFilter","action.changeRelationData":"changeRelationData","action.changeInstallationAddressId":"InstallationAddressId","action.changeProductId":"productId","action.onMoreDetailsAction":"onMoreDetailsAction","action.onNewCategorySelectedAction":"onNewCategorySelectedAction","action.onCompareItemsAction":"onCompareItemsAction","action.changeSearchText":"changeSearchText","action.dataReady":"dataReady","action.SelectDeviceForRelatedAccessories":"SelectDeviceForRelatedAccessories","action.resetTopicData":"resetTopicData","action.ItemListOutOfStockPurchase":"ItemListOutOfStockPurchase","action.ReserveItem":"ReserveItem","action.CreateChangeOrderActionForProduct ":"CreateChangeOrderActionForProduct ","action.changeSucceed":"changeSucceed","action.changeSucceedHavingNoPriceImpact":"changeSucceedHavingNoPriceImpact","action.deviceSelectedForBundleProduct":"deviceSelectedForBundleProduct"},"mode":"pubsub"},"amdocs.customerorder.reserveResource":{"vmId":"single!businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel","vmKeys":{"data.publishedSelectedResource":"publishedSelectedResource","data.selectedResourceCategory":"selectedResourceCategory","data.logicalResources":"logicalResources","data.prevNumbers":"prevNumbers","data.prevData":"prevData","data.proposeResourceStatus":"proposeResourceStatus","action.onReserveResourceDone":"onReserveResourceDone","action.onReserveResourceCancel":"onReserveResourceCancel","action.onReserveResourceAdditionalNumbers":"onReserveResourceAdditionalNumbers"},"mode":"pubsub"},"amdocs.supportPortinInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel","vmKeys":{"data.supportPortinInContext":"supportPortinInContext"},"mode":"pubsub"},"amdocs.reserveditemlist":{"vmId":"single!businesswidget/repository/common/viewmodel/ReservedItemListTopicViewModel","vmKeys":{"data.pickupDevices":"pickupDevices","data.pickupSuccessful":"pickupSuccessful","data.pickupErrorMsg":"pickupErrorMsg","data.ready":"ready","action.Done":"Done","action.Cancel":"Cancel"},"mode":"pubsub"},"amdocs.customerorder.FullCart":{"vmId":"single!businesswidget/repository/common/viewmodel/FullCartTopicViewModel","vmKeys":{"action.cartDeleted":"cartDeleted","action.continueShopping":"continueShopping","action.editCart":"editCart","action.removeBundle":"removeBundle","action.checkout":"checkout","data.productOrderItemID":"productOrderItemID","data.productOrderID":"productOrderID","action.ChangeResource":"ChangeResource","data.currentWSResourceValue":"currentWSResourceValue","action.replaceDevice":"replaceDevice","action.changePlan":"changePlan","action.removeOffer":"removeOffer","action.editHardGood":"editHardGood","data.orderDetails":"orderDetails","data.editHardGoodData":"editHardGoodData","data.noRemainingItemsInCart":"noRemainingItemsInCart","action.validationFinishedWithBlocking":"validationFinishedWithBlocking"},"mode":"pubsub"},"amdocs.customerorder.OrderSummaryInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/OrderSummaryTopicViewModel","vmKeys":{"data.orderData":"orderData","data.items":"items","data.orderStatus":"orderStatus","action.OrderSummarySubmitAction":"OrderSummarySubmitAction","action.OrderSubmitted":"OrderSubmitted","action.TermsAndConditions":"TermsAndConditions","action.LearnMoreAboutTotals":"LearnMoreAboutTotals","action.EmailSent":"EmailSent","action.ChangeResource":"ChangeResource","action.onItemsReady":"onItemsReady","action.onSubmitOrderSuccess":"onSubmitOrderSuccess"},"mode":"pubsub"},"amdocs.customerorder.SubmitOrder":{"vmId":"single!businesswidget/repository/common/viewmodel/OrderSummaryTopicViewModel","vmKeys":{"action.OrderSummarySubmitAction":"OrderSummarySubmitAction"},"mode":"pub"},"com.amdocs.serviceabilityInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/ServiceabilityTopicViewModel","vmKeys":{"data.serviceabilityType":"serviceabilityType","data.serviceabilityInfo":"serviceabilityInfo","data.postalCode":"serviceabilityInfo.postalCode","data.address1":"serviceabilityInfo.address1","data.address2":"serviceabilityInfo.address2","data.city":"serviceabilityInfo.city","data.state":"serviceabilityInfo.state","data.country":"serviceabilityInfo.country","action.changeServiceability":"changeServiceability","action.register":"register","action.login":"login"},"mode":"pubsub"},"amdocs.location.GeographicAddressInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/addressDetailsViewModel","vmKeys":{"data.addressID":"addressID","data.postalCode":"postalCode","data.validationErrors":"validationErrors","data.address":"address","action.createAddress":"createAddress","action.saved":"saved","action.clearAddress":"clearAddress","action.register":"register","action.login":"login"},"mode":"pubsub"},"amdocs.browse.search":{"vmId":"single!businesswidget/repository/common/viewmodel/SearchTopicViewModel","vmKeys":{"data.searchText":"searchText","data.resultsSize":"resultsSize","data.moreResultsSize":"moreResultsSize","data.totalSearchResults":"totalSearchResults","data.selectedCategoryId":"selectedCategoryId","data.selectedStructureId":"selectedStructureId","data.selectedItem":"selectedItem","data.installationAddressId":"installationAddressId","data.HGPresentmentLevel":"HGPresentmentLevel","action.changeSearchText":"changeSearchText","action.onItemSelected":"onItemSelected","action.gotoCategory":"gotoCategory","action.searchDataReady":"searchDataReady","action.changeInstallationAddressId":"installationAddressId","action.changeSucceed":"changeSucceed","action.changeSucceedHavingNoPriceImpact":"changeSucceedHavingNoPriceImpact","action.SelectSubscription":"SelectSubscription","action.changeSucceedWithExistingOrder":"changeSucceedWithExistingOrder"},"mode":"pubsub"},"amdocs.commerce.compatiblePlanList":{"vmId":"single!businesswidget/repository/common/viewmodel/CompatiblePlanListTopicViewModel","vmKeys":{"data.currentProductID":"currentProductID","data.currentPriceSchemaID":"currentPriceSchemaID","data.orderRefID":"orderRefID","data.orderItemRefID":"orderItemRefID","data.categoryId":"categoryId","data.currentProducts":"currentProducts","data.targetType":"targetType","data.selectedItem":"selectedItem","data.itemsToCompare":"itemsToCompare","data.itemsToCompareCategoryId":"itemsToCompareCategoryId","action.planSelected":"planSelected","action.viewPlanDetails":"viewPlanDetails","action.compareItems":"compareItems","action.dataReady":"dataReady"},"mode":"pubsub"},"amdocs.commerce.compare":{"vmId":"single!businesswidget/repository/common/viewmodel/CompareTopicViewModel","vmKeys":{"data.entityType":"entityType","data.compareIDs":"compareIDs","data.selectedItem":"selectedItem","action.viewItemDetails":"viewItemDetails","action.compare":"compare"},"mode":"pubsub"},"amdocs.common.InstallationAddressInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/InstallationAddressTopicViewModel","vmKeys":{"data.installationAddress":"installationAddress","action.setInstallationAddress":"setInstallationAddress"},"mode":"pubsub"},"amdocs.customerOrder.nonEligibleitems":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","vmKeys":{"data.messageInfo":"messageInfo","data.catalogOfferEligibilityInfo":"catalogOfferEligibilityInfo","data.catalogItemEligibilityInfo":"catalogItemEligibilityInfo","action.close":"close","action.success":"success"},"mode":"sub"},"amdocs.commerce.customerHardGoodsWidget":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerHardGoodsWidgetTopicViewModel","vmKeys":{"data.productID":"productID","data.catalogID":"catalogID","data.relationID":"relationID","action.noItemToDisplay":"noItemToDisplay","action.viewDetails":"viewDetails","action.cancel":"cancel","action.selectRelatedAccessories":"selectRelatedAccessories"},"mode":"pubsub"},"amdocs.commerce.selectedCatalogItems":{"vmId":"single!businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","vmKeys":{"data.selectedItems":"selectedItems","data.productDetails":"productDetails","action.productDetailsDataReady":"productDetailsDataReady","data.buyItems":"buyItems","data.clickedItem":"clickedItem","action.onItemClicked":"onItemClicked"},"mode":"pubsub"},"amdocs.shop.rateAndReview":{"vmId":"single!businesswidget/repository/common/viewmodel/RateAndReviewTopicViewModel","vmKeys":{"data.productOfferingId":"productOfferingId","action.reviewDetails":"reviewDetails"},"mode":"pubsub"},"amdocs.commerce.RecommendTargetPlan":{"vmId":"single!businesswidget/repository/common/viewmodel/SelectedRecommendTargetPlanTopicViewModel","vmKeys":{"data.sourceProducts":"sourceProducts","data.replaceData":"replaceData","data.moreDetailsData":"moreDetailsData","action.selectTargetPlan":"selectTargetPlan","action.ShowMoreDetails":"ShowMoreDetails","action.targetDataReady":"targetDataReady","action.Back":"Back","data.selectedSourceProduct":"selectedSourceProduct","action.showMoreTargets":"showMoreTargets"},"mode":"pubsub"},"amdocs.commerce.SaveReservation":{"vmId":"single!businesswidget/repository/common/viewmodel/ReserveItemTopicViewModel","vmKeys":{"data.reservationID":"reservationID","data.itemSku":"itemSku","data.storeID":"storeID","data.reservedQuantity":"reservedQuantity","data.status":"status","data.itemName":"itemName","data.catalogID":"catalogID","data.reservationItemInfo":"reservationItemInfo","data.ReservedItems":"ReservedItems","action.reservationCreated":"reservationCreated","action.reservationUpdated":"reservationUpdated","action.reservationCancelled":"reservationCancelled","action.reservationNone":"reservationNone","action.ReservedItems":"ReservedItems"},"mode":"pubsub"},"amdocs.commerce.SaveReservationRequest":{"vmId":"single!businesswidget/repository/common/viewmodel/ReserveItemRequestTopicViewModel","vmKeys":{"data.reservationID":"reservationID","data.itemSku":"itemSku","data.reservedQuantity":"reservedQuantity","data.storeID":"storeID","data.storeName":"storeName","data.itemName":"itemName","action.ChangeStatus":"ChangeStatus","action.Save":"Save"},"mode":"pubsub"},"amdocs.shop.shopHome":{"vmId":"single!businesswidget/repository/common/viewmodel/ShopTopicViewModel","vmKeys":{"action.navigateToPhone":"navigateToPhone","action.navigateToWireLine":"navigateToWireLine","action.navigateToPlan":"navigateToPlan","action.navigateToBundle":"navigateToBundle","action.navigateToInternet":"navigateToInternet","action.navigateToTV":"navigateToTV","action.navigateToiPhone":"navigateToiPhone","action.navigateToBestSeller":"navigateToBestSeller","action.navigateToNewArrival":"navigateToNewArrival","action.navigateToIndividualPlans":"navigateToIndividualPlans","action.navigateTosharedPlan":"navigateTosharedPlan","action.navigateToPayAsYouGo":"navigateToPayAsYouGo","action.navigateToTalkAndGoBuy":"navigateToTalkAndGoBuy","action.navigateToTalkAndTextGoldBuy":"navigateToTalkAndTextGoldBuy","action.navigateToBrowseBundle":"navigateToBrowseBundle","action.navigateToInternetUnlimited":"navigateToInternetUnlimited","action.navigateTo4GNetworkHandler":"navigateTo4GNetworkHandler","action.navigateToSafeSurfing":"navigateToSafeSurfing","action.navigateToBrowseOffers":"navigateToBrowseOffers","action.navigateToBrowseTablet":"navigateToBrowseTablet","action.navigateToiphoneBuyNow":"navigateToiphoneBuyNow","action.navigateToTVBrowse":"navigateToTVBrowse","action.navigateToBrowseChannel":"navigateToBrowseChannel","action.navigateToBrowseSports":"navigateToBrowseSports","action.navigateToBrowseiPad":"navigateToBrowseiPad"},"mode":"pubsub"}});
define("commerceTopicsBinding",{"binding":[]});
define("l0.commerceExpPackage",["experiencePackage","commerceWidgets","commerceTopics","commerceTopicsBinding","text!businesswidget/repository/common/config/commercePackage.config.json","repository.lightsaber.custom"],function (a,b,c,d,e){"use strict";return new a(b,c,d,e,"businesswidget/repository/common/i18n/commerce/web/nls/commerceStrings")});
define("commerceExpPackage",["l9_common.commerceExpPackage","l3_common.commerce.custom"],function (a){"use strict";return a});
define("businesswidget/repository/common/viewmodel/ServiceabilityTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["serviceabilityType","serviceabilityInfo"],defaults:{serviceabilityType:null,serviceabilityInfo:{state:null,country:null,postalCode:null,address1:null,address2:null,city:null}}})});
define("businesswidget/repository/common/model/CMCustomerAddressesModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"/commerce/customer/:customerId/installation-addresses",rest:{read:{url:"/commerce/customer/:customerId/installation-addresses"}}},validations:[{check:"notEmpty",fieldName:"streetNumber"},{check:"notEmpty",fieldName:"postalCode"},{check:"notEmpty",fieldName:"streetName"},{check:"notEmpty",fieldName:"city"},{check:"notEmpty",fieldName:"state"}],toJson:function(){return{address:{postalCode:this.get("postalCode"),streetNumber:this.get("streetNumber"),streetName:this.get("street"),city:this.get("city"),state:this.get("state")}}}})});
define("businesswidget/repository/common/viewmodel/addressDetailsViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["addressID"],defaults:{addressID:null,postalCode:null,validationErrors:null,address:null}}).extend({})});
define("businesswidget/repository/common/viewmodel/InstallationAddressTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["installationAddress","installationAddressIDs"],defaults:{installationAddress:{addressId:null,address1:null,address2:null,city:null,state:null,country:null,postalCode:null},installationAddressIDs:null}})});
define("businesswidget/repository/common/model/CustomerAddressDetailsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"customer/address-details",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},read:{url:"customer/address-details"}}},validations:[{check:"notEmpty",fieldName:"streetNumber"},{check:"notEmpty",fieldName:"postalCode"},{check:"notEmpty",fieldName:"streetName"},{check:"notEmpty",fieldName:"city"},{check:"notEmpty",fieldName:"state"}],toJson:function(){return{address:{postalCode:this.get("postalCode"),streetNumber:this.get("streetNumber"),streetName:this.get("street"),city:this.get("city"),state:this.get("state")}}}})});
define("businesswidget/repository/common/model/CommerceProductOfferingModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/commerce/product-offering/:productOfferingID",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}})});
define("businesswidget/repository/common/viewmodel/CompatiblePlanListTopicViewModel",["underscore","lightsaber","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"],function (a,b,c,d){return b.Core.ObservableViewModel.extend({persistent:["selectedItem","categoryId","itemsToCompare","itemsToCompareCategoryId"],historyAttrs:["categoryId","itemsToCompare","itemsToCompareCategoryId"],defaults:{currentProductID:null,currentPriceSchemaID:null,orderRefID:null,orderItemRefID:null,currentProducts:null,targetType:null,categoryId:null,InstallationAddressId:null,itemsToCompare:null,itemsToCompareCategoryId:null,selectedItem:null},subViewModels:{productConfigurationTopicViewModel:c,productOrderTopicViewModel:d},dataBindings:[{currentProductID:"subViewModels.productConfigurationTopicViewModel.productID",options:{twoWay:!0,setOnBind:!0}},{orderRefID:"subViewModels.productOrderTopicViewModel.productOrderID",options:{twoWay:!0,setOnBind:!0}},{currentPriceSchemaID:"subViewModels.productConfigurationTopicViewModel.priceSchemaID",options:{twoWay:!0,setOnBind:!0}}]})});
define("businesswidget/repository/common/model/CatalogItemRetrieveRelatedItemsModel",["lightsaber","businesswidget/repository/common/core/RESTCollection","underscore","Configuration"],function (a,b,c,d){function e(a){return 0==a.SearchResults.items.totalResults||0==a.SearchResults.items.results.length?{pageStart:0,totalSize:0,data:[]}:(f(a.SearchResults.items.results,a.SearchResults.items.startIndex),{pageStart:a.SearchResults.items.startIndex,pageSize:a.SearchResults.items.itemsPerPage,totalSize:a.SearchResults.items.totalResults,data:a.SearchResults.items.results})}function f(a,b){}return a.Core.Model.extend({idAttribute:"catalogItemID"}),b.extend({options:{url:"commerce/customer/:customerId/catalog-item/:catalogItemId/retrieve-related-items",pagination:{pageSize:d.get("itemListWidget_listPageSize")},rest:{defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},readPage:{contentType:"application/json",method:"POST",supportsPagination:!0,supportsSorting:!0,parse:e,names:{pageStart:"st",pageSize:"ps"}}}},handleResponseParse:f})});
define("businesswidget/repository/common/model/BrowsingCategoryStructuresModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"commerce/browsing-category-structures",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel"),rff:c.get("CatalogCategoriesModel.rff")}}}}})});
define("businesswidget/repository/common/model/AnonymousCatalogItemRetrieveRelatedItemsModel",["lightsaber","businesswidget/repository/common/core/RESTCollection","underscore","Configuration"],function (a,b,c,d){function e(a){return 0==a.SearchResults.items.totalResults||0==a.SearchResults.items.results.length?{pageStart:0,totalSize:0,data:[]}:(f(a.SearchResults.items.results,a.SearchResults.items.startIndex),{pageStart:a.SearchResults.items.startIndex,pageSize:a.SearchResults.items.itemsPerPage,totalSize:a.SearchResults.items.totalResults,data:a.SearchResults.items.results})}function f(a,b){}return b.extend({options:{url:"anonymous/catalog-item/:catalogItemId/retrieve-related-items",pagination:{pageSize:d.get("itemListWidget_listPageSize")},rest:{defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},readPage:{contentType:"application/json",method:"POST",supportsPagination:!0,supportsSorting:!0,parse:e,names:{pageStart:"st",pageSize:"ps"}}}},handleResponseParse:f})});
define("businesswidget/repository/common/model/CancelReservationModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"commerce/item-reservation/:reservationId",rest:{"delete":{method:"DELETE",url:"commerce/item-reservation/:reservationId"},defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}},idAttribute:"reservationId"})});
define("businesswidget/repository/common/viewmodel/ReserveItemTopicViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ViewModel.extend({defaults:{reservationID:null,itemSku:null,storeId:null,reservedQuantity:null,status:null,reserveItemDetails:null,storeName:null,itemName:null,catalogID:null}})});
define("businesswidget/repository/common/viewmodel/OrderingContextTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{frameworkId:null,clientId:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"OrderingContextTopicViewModel",path:"businesswidget/repository/common/viewmodel/OrderingContextTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{frameworkId:{key:"frameworkId",value:"null"},clientId:{key:"clientId",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/ConfigureMultiProductsTopicViewModel",["lightsaber"],function (a){return a.Core.ViewModel.extend({defaults:{expandCartByDefault:!0,preLoadMessages:null}})});
define("businesswidget/repository/common/viewmodel/MicroCartTopicViewModel",["lightsaber"],function (a){return a.Core.ViewModel.extend({defaults:{setCartVisible:null,cartVisibilityChange:null,refreshPricesFailed:null,cartMode:null,oneTimePrice:null,recurringPrice:null,currencySymbol:null,activeProductChanged:null}})});
define("businesswidget/repository/common/viewmodel/ProductConfigurationActionTopicViewModel",["lightsaber","underscore"],function (a,b){var c=a.Core.ViewModel.extend({defaults:{validateResponse:null,flowName:null,ValidateProductConfigurationResponse:null,isASCFEvent:null,productsBar:null}}),d=c.extend({}),e={path:"businesswidget/repository/common/viewmodel/ProductConfigurationActionTopicViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductConfigurationActionTopicViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"_",pathName:"underscore"}],models:null,viewModels:null,dataBindings:null,defaults:{validateResponse:{key:"validateResponse",value:"null"},flowName:{key:"flowName",value:"null"}},methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/NotificationPanelTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({defaults:{stepsOrder:null,fixErrorsToContinue:!1,settingsWereNotSaved:!1,settingsWereSaved:!1,notificationsArray:null}})});
define("businesswidget/repository/common/viewmodel/ProductConfigurationDataTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({}),c=b.extend({}),d={path:"businesswidget/repository/common/viewmodel/ProductConfigurationDataTopicViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductConfigurationDataTopicViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/ProductConfigurationBehaviorTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{readOnlyMode:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductConfigurationBehaviorTopicViewModel",path:"businesswidget/repository/common/viewmodel/ProductConfigurationBehaviorTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{readOnlyMode:{key:"readOnlyMode",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/WidgetAvailabilityTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({})});
define("businesswidget/repository/common/viewmodel/ContactDetailTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({defaults:{}})});
define("businesswidget/repository/common/viewmodel/ProductConfigurationParametersTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductConfigurationParametersTopicViewModel",path:"businesswidget/repository/common/viewmodel/ProductConfigurationParametersTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/ComponentConfigurationTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{widgetInstanceID:null,ID:null,productSpecContainment:null,temporaryID:null,Characteristics:[],Changed:!1},commitChanges:function(){this.set("Changed",!this.get("Changed"))},update:function(a,b,c,d,e){this.set("widgetInstanceID",a),this.set("ID",b),this.set("productSpecContainment",c),this.set("temporaryID",d),this.set("Characteristics",e),this.commitChanges()},clearAll:function(){this.set("widgetInstanceID",void 0),this.set("ID",void 0),this.set("productSpecContainment",void 0),this.set("temporaryID",void 0),this.set("Characteristics",[])}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ComponentConfigurationTopicViewModel",path:"businesswidget/repository/common/viewmodel/ComponentConfigurationTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetInstanceID:{key:"widgetInstanceID",value:"null"},ID:{key:"ID",value:"null"},productSpecContainment:{key:"productSpecContainment",value:"null"},temporaryID:{key:"temporaryID",value:"null"},Characteristics:{key:"Characteristics",value:"[]"},Changed:{key:"Changed",value:"false"}},methods:{commitChanges:{name:"commitChanges",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},update:{name:"update",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},clearAll:{name:"clearAll",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/WidgetDataActionTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{widgetInstanceID:null,eventRelatedWidgetInstanceIDs:null,succeeded:!1,validationMessages:[],saveMessages:[],exceptions:[],isDirty:!1,Save:!1,Validate:!1,Revert:!1,Report:!1,SaveResult:!1,ValidateResult:!1,ValidateAndSaveResult:!1,RevertResult:!1,ReportResult:!1},clearAll:function(){this.set("eventRelatedWidgetInstanceIDs",void 0),this.clear()},clear:function(){this.set("widgetInstanceID",null),this.set("succeeded",!1),this.set("validationMessages",[]),this.set("saveMessages",[]),this.set("exceptions",[])},save:function(a){this.clearAll(),this.set("eventRelatedWidgetInstanceIDs",a),this.get("eventRelatedWidgetInstanceIDs")&&this.set("Save",!this.get("Save"))},validate:function(a){this.clearAll(),this.set("eventRelatedWidgetInstanceIDs",a),this.get("eventRelatedWidgetInstanceIDs")&&this.set("Validate",!this.get("Validate"))},revert:function(a){this.clearAll(),this.set("eventRelatedWidgetInstanceIDs",a),this.get("eventRelatedWidgetInstanceIDs")&&this.set("Revert",!this.get("Revert"))},report:function(a){this.clearAll(),this.set("eventRelatedWidgetInstanceIDs",a),this.get("eventRelatedWidgetInstanceIDs")&&this.set("Report",!this.get("Report"))},saveResult:function(a,b,c){this.clear(),this.set("widgetInstanceID",a),this.set("succeeded",b),this.set("saveMessages",c),this.get("widgetInstanceID")&&this.set("SaveResult",!this.get("SaveResult"))},validateResult:function(a,b,c,d){this.clear(),this.set("widgetInstanceID",a),this.set("succeeded",b),this.set("validationMessages",c),this.set("exceptions",d),this.get("widgetInstanceID")&&this.set("ValidateResult",!this.get("ValidateResult"))},revertResult:function(a,b){this.clear(),this.set("widgetInstanceID",a),this.set("succeeded",b),this.get("widgetInstanceID")&&this.set("RevertResult",!this.get("RevertResult"))},reportResult:function(a,b){this.clear(),this.set("widgetInstanceID",a),this.set("isDirty",b),this.get("widgetInstanceID")&&this.set("ReportResult",!this.get("ReportResult"))}}),c=b.extend({}),d={path:"businesswidget/repository/common/viewmodel/WidgetDataActionTopicViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"WidgetDataActionTopicViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetInstanceID:{key:"widgetInstanceID",value:"null"},eventRelatedWidgetInstanceIDs:{key:"eventRelatedWidgetInstanceIDs",value:"null"},succeeded:{key:"succeeded",value:"false"},validationMessages:{key:"validationMessages",value:"[]"},exceptions:{key:"exceptions",value:"[]"},Save:{key:"Save",value:"false"},Validate:{key:"Validate",value:"false"},Revert:{key:"Revert",value:"false"},SaveResult:{key:"SaveResult",value:"false"},ValidateResult:{key:"ValidateResult",value:"false"},ValidateAndSaveResult:{key:"ValidateAndSaveResult",value:"false"},RevertResult:{key:"RevertResult",value:"false"}},methods:{clearAll:{name:"clearAll",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},clear:{name:"clear",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},save:{name:"save",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},validate:{name:"validate",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},revert:{name:"revert",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},saveResult:{name:"saveResult",privacyLevel:"public",isEventTriggered:!1,desc:"@param widgetInstanceID - identifies the external widget. the ID should be generated by the consumer when publishing events to external widgets.\n@param succeeded -  boolean indication if action succeeded\n",isChangeEventTriggered:!1},validateResult:{name:"validateResult",privacyLevel:"public",isEventTriggered:!1,desc:"@param widgetInstanceID - identifies the external widget. the ID should be generated by the consumer when publishing events to external widgets.\n@param succeeded -  boolean indication if action succeeded.\n@param validationMessages[] - retruns in case validation issues occured in the external widget after Validate and ValidateAndSave events were publish\n stepID - the Id of the step the messages are relared to\n messages[] -\n  message - message text\n  severity - severity of the messages. Valid Values: COMPATIBLE, NOT_CHECKED, INFORMATION, CONFIRMATION, BLOCKING\n@param exceptions[] - returns in case technical errors occring in the external widget\n errorCode - This is error code which occurred on widget\n errorMessage - This is error message widget is getting from from framework\n",isChangeEventTriggered:!1},revertResult:{name:"revertResult",privacyLevel:"public",isEventTriggered:!1,desc:"@param widgetInstanceID - identifies the external widget. the ID should be generated by the consumer when publishing events to external widgets.\n@param succeeded -  boolean indication if action succeeded\n",isChangeEventTriggered:!1}}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/ValidationMessagesTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({defaults:{stepID:""}})});
define("businesswidget/repository/common/model/CrossSellItemModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"commerce/retrieve-cross-sell-catalog-items",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}})});
define("businesswidget/repository/common/viewmodel/CrossSellItemViewModel",["underscore","lightsaber","Configuration","businesswidget/repository/common/model/CrossSellItemModel"],function (a,b,c,d){return b.Core.ViewModel.extend({models:{CrossSellItemModel:d},defaults:{numberOfCrossSellItems:2},initialize:function(b){this._super(),a.bindAll(this,"loadData","_onCrossSellItemFetchSuccess","_onCrossSellItemFetchError")},loadData:function(){return this.models.CrossSellItemModel.save(this.CrossSellItemsRequest,{success:this._onCrossSellItemFetchSuccess,error:this._onCrossSellItemFetchError})},_onCrossSellItemFetchSuccess:function(a,b){var c;a.get("CrossSellItemsResponse")&&(c=a.get("CrossSellItemsResponse").items),this.set("crossSellItems",c),c&&c.length>0||this.set("noCrossSellItem",!0),this.trigger("CrossSellItemDataLoaded")},_onCrossSellItemFetchError:function(a){this.models.CrossSellItemModel.set({hidePopUp:!0,global:!1}),this.set("crossSellItems",!1),this.set("noCrossSellItem",!0),this.trigger("CrossSellItemDataLoaded")}})});
define("businesswidget/repository/common/viewmodel/CrossSellItemWidgetViewModel",["underscore","lightsaber","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","businesswidget/repository/common/viewmodel/CrossSellItemViewModel"],function (a,b,c,d,e){return b.Core.ViewModel.extend({initialize:function(b){this._super(),a.bindAll(this,"getCrossSellItem","_createSubViewModel","getDefaultImageInForNoCrossItem","_setModel","setCrossSellItemInContextTopic","_createCrossSellItemCollection","findCatalogItemById","_crossSellItemDataLoaded"),this._createSubViewModel()},_createSubViewModel:function(){this.subViewModels.crossSellItemViewModel=this.create("cm_crossSellItemWidgetViewModel_crossSellItemViewModel",e),this.subViewModels.crossSellItemViewModel.on("CrossSellItemDataLoaded",this._crossSellItemDataLoaded)},_crossSellItemDataLoaded:function(){this.set("noCrossSellItem",this.subViewModels.crossSellItemViewModel.get("noCrossSellItem")),this.set("crossSellItems",this.subViewModels.crossSellItemViewModel.get("crossSellItems")),this._createCrossSellItemCollection(),this.trigger("CrossSellItemDataLoaded")},getCrossSellItem:function(a){var b=this.subViewModels.crossSellItemViewModel.get("crossSellItems")[a-1];return b.catalogItemImage||(b.catalogItemImage=null),b.oneTimePrice&&(b.oneTimePrice.originalAmount!==b.oneTimePrice.finalAmount?b.originalAmount=b.oneTimePrice.originalAmount:b.originalAmount=null,b.finalAmount=b.oneTimePrice.finalAmount),b.recurringPrice&&(b.recurringPrice.originalAmount!==b.recurringPrice.finalAmount?b.originalAmount=b.recurringPrice.originalAmount:b.originalAmount=null,b.finalAmount=b.recurringPrice.finalAmount),b},getCrossSellItemBanner:function(a,b,c){var d=this.subViewModels.crossSellItemViewModel.get("crossSellItems")[a-1];return"SimpleAndBanner"===c?d.catalogItemBanner?(d.catalogItemBanner=this._getBannerURL(d.catalogItemBanner,b),{crossSellItem:d,bannerAvailable:!0}):{crossSellItem:this.getCrossSellItem(a),bannerAvailable:!1}:(d.catalogItemBanner=this._getBannerURL(d.catalogItemBanner,b),d)},_getBannerURL:function(a,b){if(!a)return null;var c=a.lastIndexOf("."),d=a.substring(0,c)+"_"+b+".html";return d=d.replace("http://","https://")},getDefaultImageInForNoCrossItem:function(a){a?this.set("crossSellItemDefaultBanner",a):this.set("crossSellItemDefaultBanner",c.get("defaultImageForCrossSellRecommnededItem"))},findCatalogItemById:function(b){var c,d=this.subViewModels.crossSellItemViewModel.get("crossSellItems");return d&&(c=a.find(d,function(a){if(a.catalogItemID==b)return a},this)),c},setCrossSellItemInContextTopic:function(a){this.set("crossSellItemID",a.catalogItemID),this.set("businessType",a.businessType),this.set("containingOfferings",a.containingOfferings),this.set("parentCatalogItemID",a.parentCatalogItemID),this.set("type",a.type),this.trigger("action:crossSellItemSelected",{crossSellItemID:a.catalogItemID,businessType:a.businessType,containingOfferings:a.containingOfferings,parentCatalogItemID:a.parentCatalogItemID,type:a.type})},_setModel:function(){var a={};if(this.subViewModels.crossSellItemViewModel=this.create("cm_crossSellItemWidgetViewModel_crossSellItemViewModel",e),this.subViewModels.crossSellItemViewModel.on("CrossSellItemDataLoaded",this._crossSellItemDataLoaded),"string"==typeof this.get("sourceId")){var b=this.get("sourceId").split(",");this.set("sourceId",b)}if(a.customerID=this.get("customerId"),a.sourceCatalogItemIDs=this.get("sourceId"),this.get("lobCode")&&"string"==typeof this.get("lobCode")){var b=this.get("lobCode").split(",");this.set("lobCode",b)}if(this.get("lobCode")&&(a.lob=this.get("lobCode")),this.get("crossSellBusinessTypes")&&"string"==typeof this.get("crossSellBusinessTypes")){var b=this.get("crossSellBusinessTypes").split(",");this.set("crossSellBusinessTypes",b)}this.get("crossSellBusinessTypes")&&(a.targetItemsTypes=this.get("crossSellBusinessTypes")),this.get("productID")&&(a.productID=this.get("productID")),this.get("activityForRecommendation")&&(a.activityForRecommendation=this.get("activityForRecommendation"));var c={CrossSellItemsRequest:a};this.subViewModels.crossSellItemViewModel.CrossSellItemsRequest=c},loadData:function(){return this._setModel(),this.crossSellPromise=this.subViewModels.crossSellItemViewModel.loadData(),this.crossSellPromise},_createCrossSellItemCollection:function(){var a=this.subViewModels.crossSellItemViewModel.get("crossSellItems");if(a){this.crossSellItemsCollection=new b.Core.Collection;for(var c=1;c<=a.length;c++){var d=this.getCrossSellItem(c);d.catalogItemBanner?(d.catalogItemBannerWeb=this._getBannerURL(d.catalogItemBanner,"web"),d.catalogItemBannerTablet=this._getBannerURL(d.catalogItemBanner,"tablet"),d.catalogItemBannerMobile=this._getBannerURL(d.catalogItemBanner,"mobile"),d.bannerAvailable=!0):d.bannerAvailable=!1,this.crossSellItemsCollection.add(this.getCrossSellItem(c))}this.subViewModels.crossSellItemsCollectionViewModel=new b.CollectionViewModel({idAttribute:"catalogItemID",models:{items:this.crossSellItemsCollection}})}},setDefaultBannerInContext:function(){this.trigger("action:defaultBannerSelected")}})});
define("businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["catalogOfferEligibilityInfo","catalogItemEligibilityInfo","eligibilityCheckDone"],defaults:{catalogItemEligibilityInfo:null,catalogOfferEligibilityInfo:null,eligibilityCheckDone:null}})});
define("businesswidget/repository/common/viewmodel/FullCartTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["nonHardGoodProductOrderItems"],defaults:{nonHardGoodProductOrderItems:null}})});
define("businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","single!businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository/common/viewmodel/InstallationAddressTopicViewModel","single!businesswidget/repository/common/viewmodel/MyProductsAndServicesWidgetViewModel","single!businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","single!businesswidget/repository/common/viewmodel/CompatiblePlanListTopicViewModel","single!businesswidget/repository/common/viewmodel/FullCartTopicViewModel"],function (a,b,c,d,e,f,g){"use strict";return a.Core.ObservableViewModel.extend({models:{},defaults:{},initialize:function(a){this.LOB_CODE={WS:c.get("lobs").WS,WL:c.get("lobs").WL,IN:c.get("lobs").IN,TV:c.get("lobs").TV},this.ITEM_BUSINESS_TYPE={PLAN:"PLAN",DEVICE:"DEVICE",OFFERING:"OFFERING",MD:c.get("businessType_DEVICE_MD"),AC:c.get("businessType_ACCESSORY")},this.productSpecificationLevel={G:"G",S:"S"},this.NON_ELIGIBILE_REASON_CODE="DD",this.OUTCOME_ID={INSTALLATION_ADDRESS_REQUIRED:"INSTALLATION_ADDRESS_REQUIRED",MANDATORY_CONFIGURATION_REQUIRED:"MANDATORY_CONFIGURATION_REQUIRED",CONFIGURATION_REQUIRED_FOR_MANDATORY_WITHOUT_DEFAULT:"CONFIGURATION_REQUIRED_FOR_MANDATORY_WITHOUT_DEFAULT",CUSTOMER_REQUIRED:"CUSTOMER_REQUIRED",ELIGIBILITY_CHECK_REQUIRED:"ELIGIBILITY_CHECK_REQUIRED",EQUIPMENT_CONFIGURATION_REQUIRED:"EQUIPMENT_CONFIGURATION_REQUIRED",CART_READY:"CART_READY",EXECUTE_NEXT:"EXECUTE_NEXT",BREAK_EXECUTION:"BREAK_EXECUTION",CHECKOUT_VALIDATION_FAILED:"CHECKOUT_VALIDATION_FAILED",CHECKOUT_SUCCESS:"CHECKOUT_SUCCESS",AUTO_PAY_REQUIRED:"AUTO_PAY_REQUIRED",MANDATORY_BUNDLE_CONFIGURATION_REQUIRED:"MANDATORY_BUNDLE_CONFIGURATION_REQUIRED",BUNDLE_PRODUCT_MISSING_MANDATORY_CONFIGURATION:"BUNDLE_PRODUCT_MISSING_MANDATORY_CONFIGURATION"}},isNullOrUndefined:function(a){return null===a||void 0===a||""===a},serOrderDetailsInContext:function(a,b,c){var d;a?(d=a.getVM("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel"),d.set("productOrderID",b),d.set("productOrderReferenceNumber",c)):(g.set("productOrderID",b),g.set("productOrderReferenceNumber",c))},serOrderItemDetailsInContext:function(a,b,c){var d=a.getVM("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel");d.set("productOrderItemID",b),d.set("productOrderItemRefNumber",c)},setFlowNameInContext:function(a,b){a.getVM("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel").set("flowName",b)},setMissingConfigurationOrderActionIDsInContext:function(a,b){a.getVM("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel").set("missingConfigurationOrderActionIDs",b)},getMissingConfigurationOrderActionIDsInContext:function(a,b){return a.getVM("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel").get("missingConfigurationOrderActionIDs")},setProductOfferingID:function(a,b){a.getVM("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel").set("productOfferingID",b)},getCustomerIdFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","ID")},checkIfCustomerIsAuthenticated:function(a){return a.getData("businesswidget/repository/common/viewmodel/CustomerInContextTopicViewModel","isAuthenticated")},dataCleanUpForChangePlanFromCart:function(a){a&&a.setData("businesswidget/repository/common/viewmodel/CompatiblePlanListTopicViewModel","categoryId",void 0)},dataCleanupForInstallationAddress:function(a){a.setData("businesswidget/repository/common/viewmodel/InstallationAddressTopicViewModel","installationAddress",{})},setProductIDInContext:function(a,b){a&&a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productID",b)},getAddressFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/InstallationAddressTopicViewModel","installationAddress")},getOrderIdFromAppContext:function(a){return a?a.getData("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","productOrderID"):g.get("productOrderID")},getProductOfferingIdFromAppContext:function(a){return a?a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","offeringId"):g.get("offeringId")},getOrderReferenceNumberFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","productOrderReferenceNumber")},getOrderItemIdFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productOrderItemID")},getOrderItemRefNoFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productOrderItemRefNumber")},checkAddressRequiredForPurchase:function(a,b){return!this.isNullOrUndefined(b)&&!this.isWirelessPurchaseFlow(b)},checkAddressRequiredForBundlePurchase:function(a,b){return!(this.isNullOrUndefined(b)||!this.isNonWSBundle(b))},isNonWSBundle:function(a){for(var b=!1,c=0;c<a.lob.length;c++)if(a.lob[c]===this.LOB_CODE.IN||a.lob[c]===this.LOB_CODE.TV||a.lob[c]===this.LOB_CODE.WL){b=!0;break}return b},isWirelessPurchaseFlow:function(a){return a.lob[0]===this.LOB_CODE.WS},getCustomerAddressId:function(a){return a.id},getSalesChannel:function(a){return c.get("salesChannel")},getLocale:function(a){return c.get("locale")},getIsMandatoryFieldExistsFromProductConfig:function(a){return a.mandatoryConfigRequired},dataCleanup:function(a,b){a.setData("businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","buyItems",void 0),b||(a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","priceSchemaID",void 0),a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productID",void 0),a.setData("businesswidget/repository/common/viewmodel/CompatiblePlanListTopicViewModel","categoryId",void 0)),a.setData("businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","selectedItems",void 0)},dataCleanUpforReservedResource:function(){a.Core.StorageUtil.deleteKey("businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel")},dataCleanUpforOrderItemDetail:function(a){a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productOrderItemID",void 0),a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productOrderItemRefNumber",void 0)},dataCleanUpforOrderDetail:function(a){a.setData("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","productOrderID",void 0),a.setData("businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","productOrderReferenceNumber",void 0)},dataCleanUpforUpgradeDevice:function(a){a&&(a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productID",void 0),a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","containedProductID",void 0))},dataCleanUpforSearch:function(a){a&&(a.setData("businesswidget/repository/common/viewmodel/SearchTopicViewModel","searchText",void 0),a.setData("businesswidget/repository/common/viewmodel/SearchTopicViewModel","selectedItem",void 0))},getSelectedItems:function(a){return a.getData("businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","buyItems")},getSelectedItemsFromContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","selectedItems")},isChangePlanFlow:function(a,b,c){var d=this.getAssignedProductIDFromAppContext(a),e=this.getCustomerIdFromAppContext(a);return!(this.isNullOrUndefined(e)||this.isNullOrUndefined(d)||this.isNullOrUndefined(b)||!this.isNullOrUndefined(c))},isUpgradeDeviceFlow:function(a,b,c){var d=(this.getAssignedProductIDFromAppContext(a),this.getDeviceAssignedProductIDFromAppContext(a)),e=this.getContainedProductIDFromAppContext(a),f=this.getCustomerIdFromAppContext(a);return!(this.isNullOrUndefined(f)||this.isNullOrUndefined(d)||this.isNullOrUndefined(b)||this.isNullOrUndefined(e)||!this.isNullOrUndefined(c))},isUpgradeDeviceAndChangePlanFlow:function(a,b,c){var d=(this.getAssignedProductIDFromAppContext(a),this.getDeviceAssignedProductIDFromAppContext(a)),e=this.getContainedProductIDFromAppContext(a),f=this.getCustomerIdFromAppContext(a);return!(this.isNullOrUndefined(f)||this.isNullOrUndefined(d)||this.isNullOrUndefined(b)||this.isNullOrUndefined(e)||this.isNullOrUndefined(c))},getAssignedProductIDFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productID")},getDeviceAssignedProductIDFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","deviceAssignedProductID")},getContainedProductIDFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","containedProductID")},getProductSpecContainmentIDFromAppContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productSpecContainmentID")},isAddressNotAvailable:function(a){var b=!0;if(this.isNullOrUndefined(a))return!0;for(var c in a)a.hasOwnProperty(c)&&(this.isNullOrUndefined(a[c])||(b=!1));return b},getReservedResourceValue:function(a){return a.getData("businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel","publishedSelectedResource")},getReservedResourceCategory:function(a){return a.getData("businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel","selectedResourceCategory")},checkIfEquipmentNeeded:function(a){var b=[];if(a){var c=a.equipmentToAdd;if(c&&c.length>0)for(var d=0;d<c.length;d++)c[d].orderActionID&&b.push(c[d].orderActionID)}return b},checkIfCustomerIsAssociated:function(a){return!this.isNullOrUndefined(a)&&"99999999"!==a},retrieveCustomerInOrder:function(a){var b=a.AnonymousCartHeader;return this.isNullOrUndefined(b)?null:b.customerId},parseEligibilityMessage:function(a,b){var c=a.CheckEligibilityOutput;if(c){var d=[],e=[],f=[],g=c.productOfferingEligibilityList,h=c.catalogItemEligibilityList;g&&g.length>0&&(e=this.parseEligibilityMessageArr(g,b)),h&&h.length>0&&(f=this.parseEligibilityMessageArr(h,b)),d=e.concat(f)}return d},parseEligibilityMessageArr:function(a,b){var c,d,e=[];for(c=0;c<a.length;c++){var f=a[c];if(f.eligibilityCode===this.NON_ELIGIBILE_REASON_CODE){var g=f.eligibilityReason;if(g){var h=b[f.catalogItemId];for(d=0;d<g.length;d++){var i=g[d];e.push({severity:"ERROR",text:this.getFormattedEligibityMessage(h.name,i)})}}}}return e},getFormattedEligibityMessage:function(a,b){var c=a+" - ";return b.eligibilityReasonValue&&(c=c+b.eligibilityReasonValue+". "),c},getHardGoodDetailsToUpdate:function(a){var b={productSpecID:a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productSpecID"),productOfferingID:a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productOfferingID"),productOfferingProductSpecID:a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productOfferingProductSpecID"),businessType:a.getData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","businessType")},c=!1;for(var d in b)b.hasOwnProperty(d)&&(this.isNullOrUndefined(b[d])||(c=!0));return c?b:null},getCatalogItemEligibilityInfo:function(a){return a.getData("businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","catalogItemEligibilityInfo")},getCatalogOfferEligibilityInfo:function(a){return a.getData("businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","catalogOfferEligibilityInfo")},checkIfNonElegibleItemsOrOffersExist:function(a,b){return!this.isNullOrUndefined(a)&&a.length>0||!this.isNullOrUndefined(b)&&b.length>0},objectHasValues:function(a){if(this.isNullOrUndefined(a))return!1;var b=!1;for(var c in a)a.hasOwnProperty(c)&&(this.isNullOrUndefined(a[c])||(b=!0));return b},checkIfEligibilityCheckDone:function(a){return a.getData("businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","eligibilityCheckDone")},dataCleanUpforEligibilityCheckDone:function(a){},dataCleanUpforEligibilityDetail:function(a){a.setData("businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","catalogItemEligibilityInfo",void 0),a.setData("businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","catalogOfferEligibilityInfo",void 0)},setNonHardGoodOrderItemsInContext:function(a,b){a.setData("businesswidget/repository/common/viewmodel/FullCartTopicViewModel","nonHardGoodProductOrderItems",b)},getNonHardGoodOrderItemsInContext:function(a){return a.getData("businesswidget/repository/common/viewmodel/FullCartTopicViewModel","nonHardGoodProductOrderItems")},dataCleanUpforNonHardGoodOrderItems:function(a){a.setData("businesswidget/repository/common/viewmodel/FullCartTopicViewModel","nonHardGoodProductOrderItems",void 0)},checkIfValidationSeverityBlocking:function(a){for(var b=!1,c=0;c<a.length;c++)if("BLOCKING"===a[c].productConfiguration.compatibilityStatus){b=!0;break}return b},dataCleanUpforChangePlanOrderItems:function(a){a.setData("businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","productID",void 0)},retrieveOrderInfoFromCookie:function(){return a.Core.StorageUtil.getStorage("securedPersistentCookie").get("orderIDRef")},saveOrderInfoInCookie:function(b){var c={productOrderID:b};a.Core.StorageUtil.getStorage("securedPersistentCookie").set("orderIDRef",c)},deleteOrderInfoFromCookie:function(){a.Core.StorageUtil.getStorage("securedPersistentCookie").deleteKey("orderIDRef")},isAddProductToBundleFlow:function(a){return!e.isEmpty(a.productOfferingInstanceID)&&!e.isUndefined(a.productOfferingInstanceID)},isBundleFlow:function(a){var b=this.getOrderItemIdFromAppContext(a),c=this.getMissingConfigurationOrderActionIDsInContext(a),d=!1;if(b&&c&&c.length>0)for(var e=0;e<c.length;e++)if(c[e]&&c[e].id&&b===c[e].id&&c[e].deviceSelectedEnabled){d=!0;break}return d}})});
define("businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){return a.extend({options:{url:"commerce/anonymous/product-order-item/:productOrderItemId/product-configuration",rest:{defaults:{qParams:{locale:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"PUT",payload:["UpdateProductInOrderConfigurationRequest"]},update:{payload:["UpdateProductInOrderConfigurationRequest"]}}}}).extend({})});
define("businesswidget/repository/common/model/ProposeLogicalResourceModel",["underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{url:"commerce/propose-logical-resources",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["ProposeLogicalResourcesRequest"]}}}})});
define("businesswidget/repository/common/model/ReserveLogicalResourceModel",["underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{url:"commerce/reserve-logical-resource",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},create:{method:"POST",contentType:"application/json"}}}})});
define("businesswidget/repository/common/model/CustomerProductOfferingInstanceModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d){var e=a.extend({options:{url:"commerce/customer/:customerId/product-offering/:productOfferingId/product-order",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")},payload:["CreateNewOfferingConfigurationRequest"]}}},parse:function(a,b){return d.setAnonymousRequestHeaderInCookie(b.xhr),this._super(a,b)}}),f=e.extend({}),g={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductOfferingInstanceModel",path:"businesswidget/repository/common/model/CustomerProductOfferingInstanceModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product-offering/:productOfferingId/product-order"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"sc",value:'Configuration.get("salesChannel")'},{key:"lo",value:'Configuration.get("locale")'}],isJSON:!0},payload:{value:["CreateNewOfferingConfigurationRequest"]}}}},validations:[],methods:{}};return f.prototype.getMetaData=function(){return g},f});
define("businesswidget/repository/common/model/CommerceCustomerHardGoodSpecProductOrderModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration","businesswidget/repository_l9_common/common/utils/ImplUtil"],function (a,b,c,d){return b.extend({options:{url:"/commerce/customer/:customerId/hard-good-spec/:hardGoodSpecId/product-order",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},create:{method:"POST",contentType:"application/json",payload:["CreateNewHardGoodOrderRequest"]}}},parse:function(a,b){return d.setAnonymousRequestHeaderInCookie(b.xhr),this._super(a,b)}})});
define("businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product-order-item/:productOrderItemId/retireve-product-configuration-options",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["RetrieveProductInOrderConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductOrderItemProductConfigurationOptionsModel",path:"businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product-order-item/:productOrderItemId/retireve-product-configuration-options"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"sc",value:'Configuration.get("salesChannel")'},{key:"locale",value:'Configuration.get("locale")'}],isJSON:!0}},read:{method:{value:"POST",isDefault:!0,isMandatory:!0},contentType:{value:"application/json"},payload:{value:["RetrieveProductInOrderConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){return a.extend({options:{url:"commerce/anonymous/product-order-item/:productOrderItemId/retrieve-product-configuration-options",rest:{defaults:{qParams:{sc:c.get("salesChannel"),locale:c.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["RetrieveProductInOrderConfigurationRequest"]}}}}).extend({})});
define("businesswidget/repository/common/model/CustomerOrderAddressRecommendedEquipmentModel",["businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b){return a.extend({options:{url:"/commerce/customer/:customerId/product-order/:productOrderId/installation-address/:installationAddressId/recommended-equipment",rest:{read:{url:"/commerce/customer/:customerId/product-order/:productOrderId/installation-address/:installationAddressId/recommended-equipment"},defaults:{qParams:{lo:b.get("locale"),sc:b.get("salesChannel")}}}}})});
define("businesswidget/repository/common/model/CustomerProductOrderCheckEligibilityModel",["underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{
url:"commerce/customer/:customerId/product-order/:productOrderId/check-eligibility",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")},payload:["CheckEligibilityInput"]},create:{url:"commerce/customer/:customerId/product-order/:productOrderId/check-eligibility",method:"POST",contentType:"application/json"}}}})});
define("businesswidget/repository/common/model/CustomerProductOrderIdValidateProductConfigurationsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product-order-id/:productOrderId/validate-product-configurations",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["ValidateMultiProductsConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductOrderIdValidateProductConfigurationsModel",path:"businesswidget/repository/common/model/CustomerProductOrderIdValidateProductConfigurationsModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product-order-id/:productOrderId/validate-product-configurations"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"sc",value:"Configuration.get('salesChannel')"},{key:"lo",value:"Configuration.get('locale')"}],isJSON:!0}},read:{method:{value:"POST",isDefault:!0,isMandatory:!0},contentType:{value:"application/json"},payload:{value:["ValidateMultiProductsConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CommerceCustomerAnonymousProductOrderIdValidateProductConfigurationsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){return a.extend({options:{url:"commerce/customer/anonymous/product-order-id/:productOrderId/validate-product-configurations",rest:{defaults:{qParams:{sc:c.get("salesChannel"),lo:c.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["ValidateMultiProductsConfigurationRequest"]}}}})});
define("businesswidget/repository/common/model/CMCommerceCustomerRetrieveOrderSummaryModel",["lightsaber","underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c,d){return d.extend({options:{url:"/commerce/customer/:customerId/product-order/:productOrderId",rest:{read:{url:"/commerce/customer/:customerId/product-order/:productOrderId"}}}})});
define("businesswidget/repository/common/model/CustomerProductOrderProductOrderItemModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{rest:{"delete":{method:"DELETE",url:"commerce/customer/:customerId/product-order/:productOrderId/product-order-item/:productOrderItemId"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}}},url:"commerce/customer/:customerId/product-order/:productOrderId/product-order-item/:productOrderItemId",id:"productOrderItemId"})});
define("businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{rest:{"delete":{method:"DELETE",url:"commerce/anonymous/product-order/:productOrderId/product-order-item/:productOrderItemId"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}}},url:"commerce/anonymous/product-order/:productOrderId/product-order-item/:productOrderItemId",id:"productOrderItemId"})});
define("businesswidget/repository/common/model/CreateProvideOrderModel",["underscore","lightsaber"],function (a,b){return b.Core.RESTModel.extend({options:{url:"/commerce/customer/:customerID/product-order",rest:{create:{method:"POST",contentType:"application/json",payload:["CreateNewProductOrderRequest"]}}},initialize:function(){a.bindAll(this),this._super()}})});
define("businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/CustomerProductProductConfigurationModel","businesswidget/repository/common/model/ProposeLogicalResourceModel","businesswidget/repository/common/model/ReserveLogicalResourceModel","businesswidget/repository/common/model/CustomerProductOfferingInstanceModel","businesswidget/repository/common/model/CommerceAnonymousHardGoodSpecProductOrderModel","businesswidget/repository/common/model/CommerceCustomerHardGoodSpecProductOrderModel","businesswidget/repository/common/model/AnonymousCustomerProductOfferingInstanceModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","businesswidget/repository/common/model/AnonymousProductOrderItemRetrieveProductConfigurationOptionsModel","businesswidget/repository/common/model/CMCustomerAddressesModel","businesswidget/repository/common/model/CustomerOrderAddressRecommendedEquipmentModel","businesswidget/repository/common/model/AnonymousCartResModel","businesswidget/repository/common/model/CustomerProductOrderCheckEligibilityModel","businesswidget/repository/common/model/CustomerProductOrderIdValidateProductConfigurationsModel","businesswidget/repository/common/model/CommerceCustomerAnonymousProductOrderIdValidateProductConfigurationsModel","businesswidget/repository/common/model/CMCommerceCustomerRetrieveOrderSummaryModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemModel","businesswidget/repository/common/model/CreateProvideOrderModel","businesswidget/repository/common/model/CustomerProductOfferingInstanceIdModel","businesswidget/repository/common/model/AnonymousProductOfferingInstanceIdModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D){"use strict";return a.Core.ObservableViewModel.extend({models:{anonymousProductConfigurationModel:i,productConfigurationModel:h,customerProductConfigurationModel:j,productOfferingInstanceModel:m,proposeLogicalResourceModel:k,reserveLogicalResourceModel:l,anonymousHardGoodSpecProductOrderModel:n,customerHardGoodSpecProductOrderModel:o,anonymousProductOfferingInstanceModel:p,productConfigurationOptionsModel:q,anonymousProductConfigurationOptionsModel:r,customerAddressesModel:s,recommendedEquipmentModel:t,anonymousCartResModel:u,productOrderCheckEligibilityModel:v,validateMultiProductConfigurationModel:w,validateAnonymousMultiProductConfigurationModel:x,commerceCustomerRetrieveOrderSummaryModel:y,customerProductOrderProductOrderItemModel:z,commerceAnonymousProductOrderProductOrderItemModel:A,createProvideOrderModel:B,customerProductOfferingInstanceIdModel:C,anonymousProductOfferingInstanceIdModel:D},defaults:{},initialize:function(a){e.bindAll(this,"updateProdInOrderSuccessCallBack","updateProdInOrderErrorCallBack","retrieveCustomerAddressesSuccess","retrieveCustomerAddressesError","handleRecommendedEquipmentFetchSuccess","handleRecommendedEquipmentFetchError","checkOrderEligibilitySuccessCallBack","checkOrderEligibilityErrorCallBack","onConfigurationValidationSuccess","onConfigurationValidationError","getOrderData","onRetrieveOrderSummarySuccess","onRetrieveOrderSummaryError"),this.rulesHelperVM=this.create("cartRulesBackendInvokerViewModel_CartRulesInvokerHelperViewModel",g)},removeOrderItemForAnonymous:function(a,b,c,d,f){this.models.commerceAnonymousProductOrderProductOrderItemModel.set({productOrderId:b,productOrderItemId:c}),this.models.commerceAnonymousProductOrderProductOrderItemModel.setQueryParams({lo:d||this.getLocale(a),sc:f||this.getSalesChannel(a)}),this.models.commerceAnonymousProductOrderProductOrderItemModel.destroy({success:e.bind(this._onRemoveCartSuccess,this),error:e.bind(this._onRemoveCartError,this)})},_onRemoveCartSuccess:function(){},_onRemoveCartError:function(){},removeOrderItemForCustomer:function(a,b,c,d,f,g){this.models.customerProductOrderProductOrderItemModel.set({customerId:b,productOrderId:c,productOrderItemId:d}),this.models.customerProductOrderProductOrderItemModel.setQueryParams({lo:f||this.getLocale(a),sc:g||this.getSalesChannel(a)}),this.models.customerProductOrderProductOrderItemModel.destroy({success:e.bind(this._onRemoveCartSuccess,this),error:e.bind(this._onRemoveCartError,this)})},getOrderData:function(a,b,c,d,e){return this.models.commerceCustomerRetrieveOrderSummaryModel.set({productOrderId:c,customerId:b}),this.models.commerceCustomerRetrieveOrderSummaryModel.setQueryParams({retrieveContactInd:!0,retrieveCrossProductDiscounts:!0,retrieveBarInfo:!0,lo:d||this.getLocale(a),sc:e||this.getSalesChannel(a)}),this.models.commerceCustomerRetrieveOrderSummaryModel.fetch({success:this.onRetrieveOrderSummarySuccess,error:this.onRetrieveOrderSummaryError})},onRetrieveOrderSummarySuccess:function(a,b){},onRetrieveOrderSummaryError:function(a,b){},getProdConfigForAllocatePhoneNumber:function(a,b){var c,d=a.productConfiguration,e=d.displayableItems,f={};if(e)a:for(var g=0;g<e.length;g++){var h=e[g],i=h.displayableCharacteristics;if(i)for(var j=0;j<i.length;j++)if((c=i[j])&&c.productSpecCharacteristic&&c.productSpecCharacteristic.dynamicProperties)for(var k=c.productSpecCharacteristic.dynamicProperties,l=0;l<k.length;l++){var m=k[l];if("Attribute Business Type"==m.name&&m.value&&"MSISDN"==m.value.stringValue){f.characteristicID=c.productSpecCharacteristic.ID,f.productSpecContainmentID=h.productSpecContainmentID,f.productID=h.productID;break a}}}return f.productOrderItemID=a.productOrderItemID,f.serviceId=b,f},allocateNumber:function(a,b,c,d,e,f){return d?this.allocateNumberForAnonymous(a,c,e,f):this.allocateNumberForRegistered(a,b,c,e,f)},allocateNumberForAnonymous:function(a,b,c,d){var e=this.updateProductInOrderConfigurationRequest(b);return this.models.anonymousProductConfigurationModel.set({productOrderItemId:b.productOrderItemID}),this.models.anonymousProductConfigurationModel.setQueryParams({locale:d||this.getLocale(a),sc:c||this.getSalesChannel(a)}),this.models.anonymousProductConfigurationModel.save({UpdateProductInOrderConfigurationRequest:e},{success:this.updateProdInOrderSuccessCallBack,error:this.updateProdInOrderErrorCallBack})},allocateNumberForRegistered:function(a,b,c,d,e){var f=this.updateProductInOrderConfigurationRequest(c);return this.models.productConfigurationModel.set({customerId:b,productOrderItemId:c.productOrderItemID}),this.models.productConfigurationModel.setQueryParams({locale:e||this.getLocale(a),sc:d||this.getSalesChannel(a)}),this.models.productConfigurationModel.save({UpdateProductInOrderConfigurationRequest:f},{success:this.updateProdInOrderSuccessCallBack,error:this.updateProdInOrderErrorCallBack})},updateProdInOrderSuccessCallBack:function(a,b){console.log("setUpdateSuccess")},updateProdInOrderErrorCallBack:function(a,b){console.log("setUpdateError")},updateProductInOrderConfigurationRequest:function(a){return{returnConfiguration:"ALL",returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},runCompatibilityRules:!1,activityForConfiguration:null,confirmationMessagesApproved:!1,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",productChanges:[{newContainedProducts:[],changedContainedProducts:[{changedCharacteristics:[{characteristicID:a.characteristicID,value:a.serviceId}],productSpecContainmentID:a.productSpecContainmentID,productID:a.productID}],removedContainedProducts:[],newAssignedBillingOffers:[],removedAssignedBillingOffers:[],resumedContainedProducts:[],suspendedContainedProducts:[],newSimpleProducts:[]}]}},createChangePlanOrder:function(a,b,c,d,e,f,g){var h=this.updateProductConfigurationRequestForChangePlan(c,d,e),i=this.getCommonQueryParams(a,g,f);return this.models.customerProductConfigurationModel.setQueryParams(i),this.models.customerProductConfigurationModel.set("customerId",b),this.models.customerProductConfigurationModel.set("productId",c),this.models.customerProductConfigurationModel.save({UpdateProductConfigurationRequest:h},{success:this.handleProductConfigurationSaveSuccess,error:this.handleProductConfigurationSaveError})},updateProductConfigurationRequestForChangePlan:function(a,b,c){return b===c.productOfferingID?this.createReplacePlanRequest(a,c):this.createReplaceOfferRequest(a,c)},createReplacePlanRequest:function(a,b){return{basicPriceSchemaID:b.priceSchemaID,runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0}}},createReplaceOfferRequest:function(a,b){return{runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{newProductOfferingProductSpecID:b.productOfferingProductSpecID,productID:a,newBasicPriceScehmaID:b.priceSchemaID||b.catalogItemID}],newProductOfferingID:b.productOfferingID}]}},createUpgradeAndChangePlanOrder:function(a,b,c,d,e,f,g,h,i,j,k){var l=this.updateProductConfigurationRequestForUpgradeDeviceAndChangePlan(c,d,f,g,h,i),m=this.getCommonQueryParams(a,k,j);return this.models.customerProductConfigurationModel.setQueryParams(m),this.models.customerProductConfigurationModel.set("customerId",b),this.models.customerProductConfigurationModel.set("productId",i),this.models.customerProductConfigurationModel.save({UpdateProductConfigurationRequest:l},{success:this.handleProductConfigurationSaveSuccess,error:this.handleProductConfigurationSaveError})},updateProductConfigurationRequestForUpgradeDeviceAndChangePlan:function(a,b,c,d,e,f){return d===e.productOfferingID?this.createUpgradeDeviceAndReplacePlanRequest(a,b,c,e):this.createUpgradeDeviceAndReplaceOfferRequest(a,b,c,e,f)},createUpgradeDeviceAndReplacePlanRequest:function(a,b,c,d){return{basicPriceSchemaID:d.priceSchemaID,runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},productChanges:[{newSimpleProducts:[{simpleProductSpecID:b.catalogItemID||b.productSpecID,temporaryID:this.getRequestRandomNumber(),businessType:b.itemBussinessType,productSpecContainmentID:c}],removedSimpleProducts:[{productID:a}]}]}},createUpgradeDeviceAndReplaceOfferRequest:function(a,b,c,d,e){return{runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{newProductOfferingProductSpecID:d.productOfferingProductSpecID,productID:e,newBasicPriceScehmaID:d.priceSchemaID||d.catalogItemID}],newProductOfferingID:d.productOfferingID}],productChanges:[{newSimpleProducts:[{simpleProductSpecID:b.catalogItemID||b.productSpecID,temporaryID:this.getRequestRandomNumber(),businessType:b.itemBussinessType,productSpecContainmentID:c}],removedSimpleProducts:[{productID:a}]}]}},handleProductConfigurationSaveSuccess:function(){console.log("Success")},handleProductConfigurationSaveError:function(){console.log("Error")},updateChangePlanOrder:function(a,b,c,d,e,f,g,h,i){if(c){var j=this.updateProductInOrderConfigurationRequestForChangePlan(c,d),k=this.getCommonQueryParams(a,f,e);return this.models.productConfigurationModel.setQueryParams(k),this.models.productConfigurationModel.set("customerId",b),this.models.productConfigurationModel.set("productOrderItemId",c),this.models.productConfigurationModel.save({UpdateProductInOrderConfigurationRequest:j},{success:this.updateChangePlanOrderSuccessCallBack,error:this.updateChangePlanOrderErrorCallBack})}var j=this.updateProductConfigurationRequestForChangePlan(g,h,d);j.productOrderID=i;var k=this.getCommonQueryParams(a,f,e);return this.models.customerProductConfigurationModel.setQueryParams(k),this.models.customerProductConfigurationModel.set("customerId",b),this.models.customerProductConfigurationModel.set("productId",g),this.models.customerProductConfigurationModel.save({UpdateProductConfigurationRequest:j},{success:this.handleProductConfigurationSaveSuccess,error:this.handleProductConfigurationSaveError})},updateProductInOrderConfigurationRequestForChangePlan:function(a,b){return this.updatePlanReplaceOfferRequest(a,b)},updatePlanReplaceOfferRequest:function(a,b){return{returnConfiguration:"ALL",runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},replaceProductOfferingConfiguration:[{productForReplacement:[{productOrderItemID:a,newProductOfferingProductSpecID:b.productOfferingProductSpecID,newBasicPriceScehmaID:b.priceSchemaID}],newProductOfferingID:b.productOfferingID}]}},updateChangePlanOrderSuccessCallBack:function(){console.log("Success")},updateChangePlanOrderErrorCallBack:function(){console.log("Error")},createUpgradeDeviceRequest:function(a,b,c){return{runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},productChanges:[{newSimpleProducts:[{simpleProductSpecID:b.catalogItemID||b.productSpecID,temporaryID:this.getRequestRandomNumber(),businessType:b.itemBussinessType,productSpecContainmentID:c}],removedSimpleProducts:[{productID:a}]}]}},createUpgradeDeviceOrder:function(a,b,c,d,e,f,g,h){var i=this.createUpgradeDeviceRequest(c,d,h),j=this.getCommonQueryParams(a,f,e);return this.models.customerProductConfigurationModel.setQueryParams(j),this.models.customerProductConfigurationModel.set("customerId",b),this.models.customerProductConfigurationModel.set("productId",g),this.models.customerProductConfigurationModel.save({UpdateProductConfigurationRequest:i},{success:this.handleProductConfigurationSaveSuccess,error:this.handleProductConfigurationSaveError})},updateUpgradeDeviceOrder:function(a,b,c,d,e,f,g,h,i,j){if(j){var k=this.updateProductInOrderConfigurationRequestForUpgradeDevice(j,d,c,h),l=this.getCommonQueryParams(a,f,e);return this.models.productConfigurationModel.setQueryParams(l),this.models.productConfigurationModel.set("customerId",b),this.models.productConfigurationModel.set("productOrderItemId",j),this.models.productConfigurationModel.save({UpdateProductInOrderConfigurationRequest:k},{success:this.updateChangePlanOrderSuccessCallBack,error:this.updateChangePlanOrderErrorCallBack})}var k=this.createUpgradeDeviceRequest(c,d,h);k.productOrderID=i;var l=this.getCommonQueryParams(a,f,e);return this.models.customerProductConfigurationModel.setQueryParams(l),this.models.customerProductConfigurationModel.set("customerId",b),this.models.customerProductConfigurationModel.set("productId",g),this.models.customerProductConfigurationModel.save({UpdateProductConfigurationRequest:k},{success:this.handleProductConfigurationSaveSuccess,error:this.handleProductConfigurationSaveError})},updateProductInOrderConfigurationRequestForUpgradeDevice:function(a,b,c,d){return{runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0},productChanges:[{newSimpleProducts:[{simpleProductSpecID:b.catalogItemID||b.productSpecID,temporaryID:this.getRequestRandomNumber(),businessType:b.itemBussinessType,productSpecContainmentID:d}],removedSimpleProducts:[{productID:c}]}]}},getCommonQueryParams:function(a,b,c){return{lo:b||this.getLocale(a),sc:c||this.getSalesChannel(a)}},retrieveCustomerAddresses:function(a,b,c,d){return this.models.customerAddressesModel.set({customerId:this.rulesHelperVM.getCustomerIdFromAppContext(a)}),this.models.customerAddressesModel.setQueryParams({isanonymous:b,lo:d||this.getLocale(a),sc:c||this.getSalesChannel(a)}),this.models.customerAddressesModel.fetch({success:this.retrieveCustomerAddressesSuccess,error:this.retrieveCustomerAddressesError})},retrieveCustomerAddressesSuccess:function(a,b,c){this.set("customerAddresses",b["InstallationAddress[]"]),b["InstallationAddress[]"]&&b["InstallationAddress[]"].length>0&&this.set("customerAddress",this.get("customerAddresses")[0])},retrieveCustomerAddressesError:function(a,b,c){},createProductOrderItems:function(a,b,c){var d={productOrderItemID:this.getOrderItemIdFromAppContext(a)};c.push(d)},createPayloadForValidation:function(a){return{activityForConfiguration:null,returnRemovedItems:!1,settingsView:"FULL",productOrderItems:a,retrieveComponentPricing:!1,retrieveSchemaPricing:!1,performSave:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0,topLevelProductData:!0}}},createOrderWithNewWirelessSubscriptionForCustomer:function(a,b,c,d,e){var f=this.getCreateCommonNewOfferingConfigRequestForWS(b,c);return this.createNewOfferingOrderForCustomer(a,b,f,d,e)},createOrderWithNewWirelessSubscriptionForAnonymous:function(a,b,c,d,e){var f=this.getCreateCommonNewOfferingConfigRequestForWS(b,c);return this.createNewOfferingOrderForAnonymous(a,b,f,d,e)},updateOrderWithNewWirelessSubscriptionForAnonymous:function(a,b,c,d,e,f){var g=this.getCreateCommonNewOfferingConfigRequestForWS(b,c);return g.productOrderID=d,this.createNewOfferingOrderForAnonymous(a,b,g,e,f)},updateOrderWithNewWirelessSubscriptionForCustomer:function(a,b,c,d,e,f){var g=this.getCreateCommonNewOfferingConfigRequestForWS(b,c);return g.productOrderID=d,this.createNewOfferingOrderForCustomer(a,b,g,e,f)},createNewOfferingOrderForAnonymous:function(a,b,c,d,e){var f=this;return this.models.anonymousProductOfferingInstanceModel.set({productOfferingId:b.catalogOfferingID||b.productOfferingID}),this.models.anonymousProductOfferingInstanceModel.setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a)}),this.models.anonymousProductOfferingInstanceModel.save({CreateNewOfferingConfigurationRequest:c},{success:function(b,c,d){f.createNewOfferingOrderSuccess(a,b,c,d)},error:this.createNewOfferingOrderError})},getCreateCommonNewOfferingConfigRequestForWS:function(a,b){var c=this.getCreateCommonNewOfferingConfigurationRequest(),d=this.getNewProductWithDeviceToOfferingConfigurationRequest(a,b);return c.newProducts=d,c},getCreateCommonNewOfferingConfigurationRequest:function(){return{returnConfiguration:"ALL",newProducts:[],runCompatibilityRules:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1,topLevelProductData:!0}}},getNewProductWithDeviceToOfferingConfigurationRequest:function(a,b){var c={productOfferingProductSpecID:a.offeringToProductID||a.offeringToProductSpecId||a.productOfferingProductSpecID,temporaryID:this.getRequestRandomNumber(),productChanges:{newSimpleProducts:[]}};if(c.basicPriceSchemaID=a.priceSchemaID,!this.isNullOrUndefined(b)){var d={businessType:b.itemBussinessType,simpleProductSpecID:b.catalogItemID||b.catalogID||b.productSpecID,temporaryID:this.getRequestRandomNumber(),replaceDefault:!0};c.productChanges.newSimpleProducts.push(d)}return[c]},createAddNewSubscriptionInSharedPlanOrderForCustomer:function(a,b,c,d,e){var f=this,g=this.createAddNewSubscriptionInSharedPlanRequest(b,c);return this.models.createProvideOrderModel.set("customerID",this.rulesHelperVM.getCustomerIdFromAppContext(a)),this.models.createProvideOrderModel.setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a)}),this.models.createProvideOrderModel.save({CreateNewProductOrderRequest:g},{success:function(b,c,d){f._onAddNewSubscriptionInSharedPlanOrderForCustomerFetchSuccess(a,b,c,d)},error:this._onAddNewSubscriptionInSharedPlanOrderForCustomerFetchError})},_onAddNewSubscriptionInSharedPlanOrderForCustomerFetchSuccess:function(a,b,c,d){},_onAddNewSubscriptionInSharedPlanOrderForCustomerFetchError:function(){},createAddNewSubscriptionInSharedPlanRequest:function(a,b){var c=[],d=[],e={},g={},h={newSimpleProducts:[{businessType:"DEVICE",simpleProductSpecID:b.catalogItemID||b.catalogID||b.productSpecID,replaceDefault:!0,temporaryID:f.generateTemporaryId()}]};return c.push({productOfferingProductSpecID:a.offeringToProductID,temporaryID:f.generateTemporaryId(),productChanges:h}),e.id=a.offeringInstanceID,e.newProducts=c,d.push(e),g.newProductsInOfferingInstances=d,g.returnConfiguration="ALL",g.returnConfigurationData={catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1},g},updateAddNewSubscriptionInSharedPlanOrderForCustomer:function(a,b,c,d,e,f){var g=this,h=this.createAddNewSubscriptionInSharedPlanRequest(b,c);return h.productOrderID=d,this.models.createProvideOrderModel.set("customerID",this.rulesHelperVM.getCustomerIdFromAppContext(a)),this.models.createProvideOrderModel.setQueryParams({lo:f||this.getLocale(a),sc:e||this.getSalesChannel(a)}),this.models.createProvideOrderModel.save({CreateNewProductOrderRequest:h},{success:function(b,c,d){g._onAddNewSubscriptionInSharedPlanOrderForCustomerFetchSuccess(a,b,c,d)},error:this._onAddNewSubscriptionInSharedPlanOrderForCustomerFetchError})},createNewOfferingOrderForCustomer:function(a,b,c,d,e){var f=this;return this.models.productOfferingInstanceModel.setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a)}),this.models.productOfferingInstanceModel.save({CreateNewOfferingConfigurationRequest:c,productOfferingId:b.catalogOfferingID||b.offeringID||b.productOfferingID,customerId:this.rulesHelperVM.getCustomerIdFromAppContext(a)},{success:function(b,c,d){f.createNewOfferingOrderSuccess(a,b,c,d)},error:this.createNewOfferingOrderError})},createNewOfferingOrderSuccess:function(a,b,c,d){},handleCheckMandatoryConfigurationOutcome:function(a,b){var c=a.getVM("businesswidget/repository/common/viewmodel/CartRulesExecutorViewModel");b?c.set("mandatoryConfigRequired",!0):c.set("mandatoryConfigRequired",!1),c.handleAction("checkMandatoryConfiguration")},createNewOfferingOrderError:function(a,b,c){},proposeLogicalResource:function(a,b,c,d,e){var f=this;this.models.proposeLogicalResourceModel.getDataSource().setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a),type:c,numberOfResources:b});var g={};return this.models.proposeLogicalResourceModel.save({ProposeLogicalResourcesRequest:g},{success:function(b,c,d){f.onSaveProposeResourceSuccess(a,b,c,d)},error:this.onSaveProposeResourceError})},onSaveProposeResourceSuccess:function(a,b,c,d){},onSaveProposeResourceError:function(a,b,c,d){},reserveLogicalResource:function(a,b,c,d,e){var f=this;return this.models.reserveLogicalResourceModel.getDataSource().setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a),type:c,value:b}),this.models.reserveLogicalResourceModel.save({},{success:function(b,c,d){f.onSaveReserveResourceSuccess(a,b,c,d)},error:this.onSaveReserveResourceError})},onSaveReserveResourceSuccess:function(a,b,c,d){},onSaveReserveResourceError:function(a,b,c){},getRequestRandomNumber:function(){return f.generateTemporaryId()},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)},createOrderWithNewStandAloneHardGoodForCustomer:function(a,b,c,d,e,f){var g={};return this.isNullOrUndefined(e)||(g.quantity=e),this.createStandAloneHardGoodOrderForCustomer(a,b,g,c,d,f)},updateOrderWithNewStandAloneHardGoodForCustomer:function(a,b,c,d,e,f,g){var h={};return this.isNullOrUndefined(f)||(h.quantity=f),h.orderId=c,this.createStandAloneHardGoodOrderForCustomer(a,b,h,d,e,g)},updateOrderWithNewStandAloneHardGoodForAnonymous:function(a,b,c,d,e,f){var g={};return this.isNullOrUndefined(f)||(g.quantity=f),g.orderId=c,this.createStandAloneHardGoodOrderForAnonymous(a,b,g,d,e)},createStandAloneHardGoodOrderForCustomer:function(a,b,c,d,e,f){var g=this,h=b.catalogItemID||b.productSpecID;return a?this.models.customerHardGoodSpecProductOrderModel.set("customerId",this.rulesHelperVM.getCustomerIdFromAppContext(a)):this.models.customerHardGoodSpecProductOrderModel.set("customerId",f),this.models.customerHardGoodSpecProductOrderModel.set("hardGoodSpecId",h),this.models.customerHardGoodSpecProductOrderModel.setQueryParams({sc:d||this.getSalesChannel(a),lo:e||this.getLocale(a)}),this.models.customerHardGoodSpecProductOrderModel.save({CreateNewHardGoodOrderRequest:c},{success:function(b,c,d){g.createNewHardGoodOrderSuccess(a,b,c,d)},error:this.createNewHardGoodOrderError})},updateStandAloneHardGoodForCustomer:function(a,b,c,d,e,f,g,h,i){var j={};b.quantity&&(j.quantity=b.quantity);var k=f;return this.isNullOrUndefined(k)&&(k=e+"A"),j.orderActionId=k,j.orderId=c,j.orderReferenceNumber=d,this.createStandAloneHardGoodOrderForCustomer(a,b,j,g,h)},updateStandAloneHardGoodForAnonymous:function(a,b,c,d,e,f,g,h,i){var j={};b.quantity&&(j.quantity=b.quantity);var k=f;return this.isNullOrUndefined(k)&&(k=e+"A"),j.orderActionId=k,j.orderId=c,j.orderReferenceNumber=d,this.createStandAloneHardGoodOrderForAnonymous(a,b,j,g,h)},createOrderWithNewStandAloneHardGoodForAnonymous:function(a,b,c,d,e){var f={};return this.isNullOrUndefined(e)||(f.quantity=e),this.createStandAloneHardGoodOrderForAnonymous(a,b,f,c,d)},createStandAloneHardGoodOrderForAnonymous:function(a,b,c,d,e){var f=this,g=b.catalogItemID||b.productSpecID;return this.models.anonymousHardGoodSpecProductOrderModel.set("hardGoodSpecId",g),this.models.anonymousHardGoodSpecProductOrderModel.setQueryParams({sc:d||this.getSalesChannel(a),lo:e||this.getLocale(a)}),this.models.anonymousHardGoodSpecProductOrderModel.save({CreateNewHardGoodOrderRequest:c},{success:function(b,c,d){f.createNewHardGoodOrderSuccess(a,b,c,d)},error:this.createNewHardGoodOrderError})},createNewHardGoodOrderSuccess:function(a,b,c,d){c&&c.CreateNewHardGoodOrderResponse&&(console.log("productOrderID : "+c.CreateNewHardGoodOrderResponse.productOrderID),console.log("productOrderReferenceNumber : "+c.CreateNewHardGoodOrderResponse.productOrderReferenceNumber))},createNewHardGoodOrderError:function(a,b,c,d){
console.log("createNewOfferingOrderError")},getRetrieveProductInOrderConfigurationRequest:function(){return{activityForConfiguration:null,returnRemovedItems:!1,settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}}},retrieveProductConfigOptionsForCustomer:function(a,b,c){var d=this.getRetrieveProductInOrderConfigurationRequest();return this.models.productConfigurationOptionsModel.set({customerId:b,productOrderItemId:c}),this.models.productConfigurationOptionsModel.set("RetrieveProductInOrderConfigurationRequest",d),this.models.productConfigurationOptionsModel.setQueryParams({locale:this.getLocale(a),sc:this.getSalesChannel(a)}),this.models.productConfigurationOptionsModel.fetch({success:this.onFetchProductConfigurationSuccess,error:this.onFetchProductConfigurationError})},retrieveProductConfigOptionsForAnonymous:function(a,b){var c=this.getRetrieveProductInOrderConfigurationRequest();return this.models.anonymousProductConfigurationOptionsModel.set({productOrderItemId:b}),this.models.anonymousProductConfigurationOptionsModel.setQueryParams({locale:this.getLocale(a),sc:this.getSalesChannel(a)}),this.models.anonymousProductConfigurationOptionsModel.set("RetrieveProductInOrderConfigurationRequest",c),this.models.anonymousProductConfigurationOptionsModel.fetch({success:this.onFetchProductConfigurationSuccess,error:this.onFetchProductConfigurationError})},onFetchProductConfigurationSuccess:function(a,b,c){},onFetchProductConfigurationError:function(a,b,c){},createOrderWithNewNonWirelessSubsForAnonymous:function(a,b,c,d,e){var f=this.getCreateCommonNewOfferingConfigReqForForNonWS(a,b,c);return this.createNewOfferingOrderForAnonymous(a,b,f,d,e)},createOrderForAddingNewProductToBundle:function(a,b){var c=this.getNewProductInOfferingInstanceConfigurationRequestPayLoad(b);return this.createNewOfferingOrderInstanceForCustomer(a,b,c)},getNewProductInOfferingInstanceConfigurationRequestPayLoad:function(a){var b=this.getCreateCommonNewOfferingConfigurationRequest(),c={productOfferingProductSpecID:a.productOfferingProductSpecID,temporaryID:this.getRequestRandomNumber()};return b.newProducts.push(c),b},updateOrderForAddingNewProductToBundle:function(a,b,c){var d=this.getNewProductInOfferingInstanceConfigurationRequestPayLoad(b);return d.productOrderID=c,this.createNewOfferingOrderInstanceForCustomer(a,b,d)},createOrderWithNewNonWirelessSubsForCustomer:function(a,b,c,d,e){var f=this.getCreateCommonNewOfferingConfigReqForForNonWS(a,b,c);return this.createNewOfferingOrderForCustomer(a,b,f,d,e)},getCreateCommonNewOfferingConfigReqForForNonWS:function(a,b,c){var d=this.getCreateCommonNewOfferingConfigurationRequest();return this.rulesHelperVM.checkAddressRequiredForPurchase(a,b)&&(d.installationAddressID=c),d},updateOrderWithNewNonWirelessSubsForAnonymous:function(a,b,c,d,e,f){var g=this.getCreateCommonNewOfferingConfigReqForForNonWS(a,b,f);return g.productOrderID=c,this.createNewOfferingOrderForAnonymous(a,b,g,d,e)},updateOrderWithNewNonWirelessSubsForCustomer:function(a,b,c,d,e,f){var g=this.getCreateCommonNewOfferingConfigReqForForNonWS(a,b,f);return g.productOrderID=c,this.createNewOfferingOrderForCustomer(a,b,g,d,e)},fetchRecommendedEquipment:function(a,b,c,d,e,f){return this.models.recommendedEquipmentModel.set("customerId",b),this.models.recommendedEquipmentModel.set("productOrderId",c),this.models.recommendedEquipmentModel.set("installationAddressId",d),this.models.recommendedEquipmentModel.setQueryParams({lo:f||this.getLocale(a),sc:e||this.getSalesChannel(a)}),this.models.recommendedEquipmentModel.fetch({success:this.handleRecommendedEquipmentFetchSuccess,error:this.handleRecommendedEquipmentFetchError})},handleRecommendedEquipmentFetchSuccess:function(a,b,c,d){},handleRecommendedEquipmentFetchError:function(a,b,c){},checkCustomerInOrder:function(a,b,c,d){return this.models.anonymousCartResModel.set({productOrderId:b}),this.models.anonymousCartResModel.setQueryParams({lo:d||this.getLocale(a),sc:c||this.getSalesChannel(a)}),this.models.anonymousCartResModel.fetch({success:this.checkCustomerInOrderSuccessCallBack,error:this.checkCustomerInOrderErrorCallBack})},checkCustomerInOrderSuccessCallBack:function(a,b,c){},checkCustomerInOrderErrorCallBack:function(a,b,c){},checkOrderEligibility:function(a,b,c,d,e,f,g){var h=this.getCheckEligibilityInputRequest(d,e);return this.models.productOrderCheckEligibilityModel.set({customerId:b}),this.models.productOrderCheckEligibilityModel.set({productOrderId:c}),this.models.productOrderCheckEligibilityModel.setQueryParams({lo:g||this.getLocale(a),sc:f||this.getSalesChannel(a)}),this.models.productOrderCheckEligibilityModel.save({CheckEligibilityInput:h},{success:this.checkOrderEligibilitySuccessCallBack,error:this.checkOrderEligibilityErrorCallBack})},getCheckEligibilityInputRequest:function(a,b){return{productOfferings:a,hardgoods:b}},checkOrderEligibilitySuccessCallBack:function(a,b,c){},checkOrderEligibilityErrorCallBack:function(a,b,c){},getSalesChannel:function(a){return this.rulesHelperVM.getSalesChannel(a)},getLocale:function(a){return this.rulesHelperVM.getLocale(a)},validateConfigurationForAnonymous:function(a,b,c,d){var e;return this.models.validateAnonymousMultiProductConfigurationModel.set({productOrderId:a}),this.models.validateAnonymousMultiProductConfigurationModel.setQueryParams({sc:c||this.getSalesChannel(),lo:d||this.getLocale()}),e=this.createPayloadForValidation(b),this.models.validateAnonymousMultiProductConfigurationModel.set("ValidateMultiProductsConfigurationRequest",e),this.models.validateAnonymousMultiProductConfigurationModel.fetch({success:this.onConfigurationValidationSuccess,error:this.onConfigurationValidationError})},validateConfigurationForNonAnonymous:function(a,b,c,d,e){var f;return this.models.validateMultiProductConfigurationModel.setQueryParams({sc:d||this.getSalesChannel(),lo:e||this.getLocale()}),this.models.validateMultiProductConfigurationModel.set({customerId:a,productOrderId:b}),f=this.createPayloadForValidation(c),this.models.validateMultiProductConfigurationModel.set("ValidateMultiProductsConfigurationRequest",f),this.models.validateMultiProductConfigurationModel.fetch({success:this.onConfigurationValidationSuccess,error:this.onConfigurationValidationError})},onConfigurationValidationSuccess:function(a,b,c){},onConfigurationValidationError:function(a,b,c){},getNewOfferingConfigReqForBundle:function(a,b,c){var d=this.getCreateCommonNewOfferingConfigurationRequest();return this.rulesHelperVM.checkAddressRequiredForBundlePurchase(a,b)&&(d.installationAddressID=c),d},createBundleOrder:function(a,b,c,d,e){var f=this.rulesHelperVM.getCustomerIdFromAppContext(a),g=this.getNewOfferingConfigReqForBundle(a,b,c);return this.rulesHelperVM.isNullOrUndefined(f)?this.createNewOfferingOrderForAnonymous(a,b,g,d,e):this.createNewOfferingOrderForCustomer(a,b,g,d,e)},updateBundleOrder:function(a,b,c,d,e,f){var g=this.rulesHelperVM.getCustomerIdFromAppContext(a),h=this.getNewOfferingConfigReqForBundle(a,b,c);return h.productOrderID=d,this.rulesHelperVM.isNullOrUndefined(g)?this.createNewOfferingOrderForAnonymous(a,b,h,e,f):this.createNewOfferingOrderForCustomer(a,b,h,e,f)},updateBundleOrderForAddNewSubscriptionForCustomer:function(a,b,c,d,e,f){var g=this.payLoadForUpdateBundleOrderInstance(b,d);return this.createNewOfferingOrderInstanceForCustomer(a,b,g,e,f,d)},updateBundleOrderForAddNewSubscriptionForAnonymous:function(a,b,c,d,e,f){var g=this.payLoadForUpdateBundleOrderInstance(b,d);return this.createNewOfferingOrderInstanceForAnonymous(a,b,g,e,f)},payLoadForUpdateBundleOrderInstance:function(a,b){var c=this.getCreateCommonNewOfferingConfigurationRequest(),d=[{productOfferingProductSpecID:a.productOfferingProductSpecID,temporaryID:this.getRequestRandomNumber()}];return c.newProducts=d,c.productOrderID=b,c},createNewOfferingOrderInstanceForCustomer:function(a,b,c,d,e,f){var g=this;return this.models.customerProductOfferingInstanceIdModel.setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a)}),this.models.customerProductOfferingInstanceIdModel.save({NewProductInOfferingInstanceConfigurationRequest:c,productOfferingInstanceId:b.productOfferingInstanceID,custId:this.rulesHelperVM.getCustomerIdFromAppContext(a)||b.customerID,productOrderID:f},{success:function(b,c,d){g.createNewOfferingOrderSuccess(a,b,c,d)},error:this.createNewOfferingOrderError})},createNewOfferingOrderInstanceForAnonymous:function(a,b,c,d,e){var f=this;return this.models.anonymousProductOfferingInstanceIdModel.setQueryParams({lo:e||this.getLocale(a),sc:d||this.getSalesChannel(a)}),this.models.anonymousProductOfferingInstanceIdModel.save({NewProductInOfferingInstanceConfigurationRequest:c,productOfferingInstanceId:b.productOfferingInstanceID},{success:function(b,c,d){f.createNewOfferingOrderSuccess(a,b,c,d)},error:this.createNewOfferingOrderError})},handleBundleSaveSuccess:function(a,b,c){console.log("handleBundleSaveSuccess")},handleBundleSaveError:function(a,b,c){console.log("handleBundleSaveError")},updateDeviceAfterChangePlanAndOffer:function(a,b,c,d,e,f){var g={returnConfigurationData:{topLevelProductData:!0,quotedPricesInd:!0},productInOrderConfiguration:[{productOrderItemID:c,productChanges:{newSimpleProducts:[{simpleProductSpecID:d.catalogItemID||d.productSpecID,temporaryID:this.getRequestRandomNumber(),businessType:d.itemBussinessType,productSpecContainmentID:e}],removedSimpleProducts:[{productID:f}]}}]},h=this.getCommonQueryParams(a);return this.models.productConfigurationModel.setQueryParams(h),this.models.productConfigurationModel.set("customerId",b),this.models.productConfigurationModel.set("productOrderItemID",c),this.models.productConfigurationModel.save({UpdateProductInOrderConfigurationRequest:g},{success:this.updateChangePlanOrderSuccessCallBack,error:this.updateChangePlanOrderErrorCallBack})}})});
define("businesswidget/repository/common/viewmodel/CrossSellTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["sourceId","productID","crossSellItemDefaultBanner","itemID"],defaults:{itemID:null,removeItemID:null,businessType:null,containingOfferings:null,parentCatalogItemID:null,type:null,sourceId:null,productID:null,crossSellItemDefaultBanner:null}})});
define("businesswidget/repository/common/model/CustomerEligibilityWidgetModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{rest:{put:{url:"/commerce/anonymous/product-order/:productOrderId/associate-customer",method:"PUT"},defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")},payload:["CommerceProductOrderCustomerEligibilityInput"]}}},url:"/commerce/anonymous/product-order/:productOrderId/associate-customer",id:"productOrderId"})});
define("businesswidget/repository/common/viewmodel/CustomerHardGoodsWidgetTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({defaults:{productID:null,catalogID:null,relationID:null}})});
define("businesswidget/repository/common/viewmodel/CustomerOrdersViewModel",["lightsaber","underscore"],function (a,b){var c=a.Core.ObservableViewModel.extend({persistent:["currentPage"],historyAttrs:["currentPage"],defaults:{locale:null,salesChannel:null,currentPage:0},restoreFromUrl:function(a){a||(a={});var b=requirejs.urlVM&&requirejs.urlVM.get("currentPage")||a.getPage;this.set("currentPage",b)}}),d=c.extend({}),e={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerOrdersViewModel",path:"businesswidget/repository/common/viewmodel/CustomerOrdersViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"},{variable:"_",pathName:"underscore"}],models:null,viewModels:null,dataBindings:null,defaults:{locale:{key:"locale",value:"null"},salesChannel:{key:"salesChannel",value:"null"}},methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/TNsTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({defaults:{}})});
define("businesswidget/repository/common/model/CMCustomerSubmitOrderModel",["businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c){return a.extend({options:{url:"/commerce/customer/:customerId/submit-product-orders",rest:{defaults:{method:"POST"}}}})});
define("businesswidget/repository/widgetsLibrary/existingOrderSummaryWidget/common/ExistingOrderSummaryWidgetMetadataEngine",["underscore","lightsaber","knockout"],function (a,b,c){function d(b,c){if(c&&a.isArray(c))for(var d=0;d<c.length;d++)for(x in b)if(x==c[d]&&a.isObject(b[x]))for(y in b[x])b[x+"."+y]=b[x][y];return b}function e(b,f,g){var h,i,j={};return function(k,l,m){function n(a,b){return a.position&&b.position?Number(a.position)-Number(b.position):a.position&&!b.position?a.position:!a.position&&b.position?b.position:100}if("object"!=typeof k||Array.isArray(k)){if("object"==typeof k&&Array.isArray(k)&&k.length>0){m=m?m+"[]":l?l+"[]":"[]";for(var o=0;o<k.length;o++){var p=e(b,f,g);subComponent=p(k[o],l,m),subComponent&&!a.isEmpty(subComponent)&&(j.components||(j.components=[]),j.components.push(subComponent)),m&&b[m]&&(j=a.extend(j,b[m]))}}}else{for(x in k){var q=e(b,f,g);h=m?m+"."+x:l?l+"."+x:x,subComponent=q(k[x],x,h),subComponent&&!a.isEmpty(subComponent)&&(j.components||(j.components=[]),j.components.push(subComponent))}if((void 0==l||b[l])&&(finalPath=l),m&&-1!==m.indexOf("[]",m.length-"[]".length)?finalPath=m.substring(0,m.length-"[]".length):finalPath=m,finalPath&&b[finalPath]){if(b[finalPath].mergeToThisLevel){var r=d(k,b[finalPath].mergeToThisLevel);i=a.extend(r,b[finalPath])}else i=a.extend(k,b[finalPath]);if(b[finalPath].map)for(mapID in b[finalPath].map)if(i[b[finalPath].map[mapID]])i[mapID]=i[b[finalPath].map[mapID]];else{for(var s=b[finalPath].map[mapID].split("."),t=f,u=0;u<s.length;u++)t=t[s[u]];i[mapID]=t}if(b[finalPath].observable)for(observableID in b[finalPath].observable)i[observableID]=c.observable(b[finalPath].observable[observableID]);for(y in i)"object"==typeof i[y]&&delete i[y];j=a.extend(j,i,g)}if(j.components)for(var o=0;o<j.components.length;o++)if(j.components[o].position){j.components.sort(n);break}}return j}}return{createExistingOrderSummaryMetadata:e}});
define("businesswidget/repository/widgetsLibrary/existingOrderSummaryWidget/common/ExistingOrderSummaryWidgetTemplateConfig",["underscore","knockout"],function (a,b){return{Order:{_id:"Order",template:"existingOrderSummaryOrderTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"]},"Order.primaryContactPerson":{_id:"Order.primaryContactPerson",template:"existingOrderSummaryCustomerDetailsTemplate",position:"1"},"Order.autoPaymentInformation":{_id:"Order.autoPaymentInformation",template:"existingOrderSummaryAutoPayDetailsTemplate",position:"5"},"Order.otherDiscounts[]":{_id:"Order.otherDiscounts[]",template:"existingOrderSummaryDiscountHeaderTemplate",headerTitle:"cm_existingOrderSummaryWidget_ExistingDiscounts",position:"4"},"Order.otherDiscounts":{_id:"Order.otherDiscounts",template:"existingOrderSummaryDiscountTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[]":{_id:"Order.orderItems[]",template:"existingOrderSummaryItemsListTemplate",position:"3"},"Order.orderItems":{_id:"Order.orderItems",template:"existingOrderSummaryItemTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice","person"],map:{currency:"Order.currency"},isBundle:!1},"Order.hardGoodDevices":{_id:"Order.hardGoodDevices",template:"existingOrderSummaryHardGoodItemsListTemplate",position:"4",headerTitle:"cm_existingOrderSummaryWidget_HardGoodsDevices",map:{currency:"Order.currency"},mergeToThisLevel:["oneTimePrice"]},"Order.hardGoodDevices.items[]":{_id:"Order.hardGoodDevices.items[]",template:"existingOrderSummaryItemsListTemplate"},"Order.hardGoodDevices.items":{_id:"Order.hardGoodDevices.items",template:"existingOrderSummaryItemsListTemplate"},"Order.hardGoodDevices.items[].devices[]":{_id:"Order.hardGoodDevices.items[].devices[]",template:"existingOrderSummaryItemsListTemplate"},"Order.hardGoodDevices.items[].devices":{_id:"Order.hardGoodDevices.items[].devices",mergeToThisLevel:["oneTimePrice"],template:"existingOrderSummaryHardGoodItemTemplate",map:{currency:"Order.currency"}},"Order.hardGoodAccessories":{_id:"Order.hardGoodAccessories",template:"existingOrderSummaryHardGoodItemsListTemplate",position:"5",headerTitle:"cm_existingOrderSummaryWidget_HardGoodsAccessories",map:{currency:"Order.currency"},mergeToThisLevel:["oneTimePrice"]},"Order.hardGoodAccessories.items[]":{_id:"Order.hardGoodAccessories.items[]",template:"existingOrderSummaryItemsListTemplate"},"Order.hardGoodAccessories.items":{_id:"Order.hardGoodAccessories.items",template:"existingOrderSummaryItemsListTemplate"},"Order.hardGoodAccessories.items[].accessories[]":{_id:"Order.hardGoodAccessories.items[].accessories[]",template:"existingOrderSummaryItemsListTemplate"},"Order.hardGoodAccessories.items[].accessories":{_id:"Order.hardGoodAccessories.items[].accessories",mergeToThisLevel:["oneTimePrice"],template:"existingOrderSummaryHardGoodItemTemplate",map:{currency:"Order.currency"}},"Order.orderItems[].devices[]":{_id:"Order.orderItems[].devices[]",template:"existingOrderSummaryDeviceAndReceiversComponentHeaderTitleTemplate",position:"1",headerTitle:"cm_existingOrderSummaryWidget_Device"},"Order.orderItems[].devices":{_id:"Order.orderItems[].devices",template:"existingOrderSummaryItemDeviceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].oldDevices[]":{_id:"Order.orderItems[].oldDevices[]",template:"existingOrderSummaryOldDeviceComponentHeaderTitleTemplate",position:"2",headerTitle:"cm_existingOrderSummaryWidget_oldDevice"},"Order.orderItems[].oldDevices":{_id:"Order.orderItems[].oldDevices",template:"existingOrderSummaryItemDeviceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].plans[]":{_id:"Order.orderItems[].plans[]",template:"existingOrderSummaryPlanTitleTemplate",position:"3",headerTitle:"cm_existingOrderSummaryWidget_Plan"},"Order.orderItems[].plans":{_id:"Order.orderItems[].plans",template:"existingOrderSummaryItemPlanTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].plans[].services[]":{_id:"Order.orderItems[].plans[].services[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].plans[].services":{_id:"Order.orderItems[].plans[].services",template:"existingOrderSummaryItemServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].plans[].services[].pricePackages[]":{_id:"Order.orderItems[].plans[].services[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].plans[].services[].pricePackages":{_id:"Order.orderItems[].plans[].services[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].plans[].services[].paramters[]":{_id:"Order.orderItems[].plans[].services[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].plans[].services[].paramters":{_id:"Order.orderItems[].plans[].services[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.orderItems[].plans[].services[].containedServices[]":{_id:"Order.orderItems[].plans[].services[].containedServices[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].plans[].services[].containedServices":{_id:"Order.orderItems[].plans[].services[].containedServices",template:"existingOrderSummaryItemContainedServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].plans[].services[].containedServices[].pricePackages[]":{_id:"Order.orderItems[].plans[].services[].containedServices[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].plans[].services[].containedServices[].pricePackages":{_id:"Order.orderItems[].plans[].services[].containedServices[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].plans[].services[].containedServices[].paramters[]":{_id:"Order.orderItems[].plans[].services[].containedServices[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].plans[].services[].containedServices[].paramters":{_id:"Order.orderItems[].plans[].services[].containedServices[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.orderItems[].services[]":{_id:"Order.orderItems[].services[]",template:"existingOrderSummaryServicesListTemplate",position:"4",headerTitle:"cm_existingOrderSummaryWidget_Services"},"Order.orderItems[].services":{_id:"Order.orderItems[].services",template:"existingOrderSummaryItemServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].removedServices":{_id:"Order.orderItems[].removedServices",template:"existingOrderSummaryRemovedServicesListTemplate",headerTitle:"cm_existingOrderSummaryWidget_RemovedServices",position:"7"},"Order.orderItems[].removedServices.services[]":{_id:"Order.orderItems[].removedServices.services[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].removedServices.services":{_id:"Order.orderItems[].removedServices.services",template:"existingOrderSummaryItemServiceTemplate",removedServices:!0,mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].services[].pricePackages[]":{_id:"Order.orderItems[].services[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].services[].pricePackages":{_id:"Order.orderItems[].services[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].removedServices.services[].pricePackages[]":{_id:"Order.orderItems[].removedServices[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].removedServices.services[].pricePackages":{_id:"Order.orderItems[].removedServices[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",removedServices:!0,mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].services[].paramters[]":{_id:"Order.orderItems[].services[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].services[].paramters":{_id:"Order.orderItems[].services[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.orderItems[].removedServices.services[].paramters[]":{_id:"Order.orderItems[].removedServices.services[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].removedServices.services[].paramters":{_id:"Order.orderItems[].removedServices.services[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.orderItems[].services[].containedServices[]":{_id:"Order.orderItems[].services[].containedServices[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].services[].containedServices":{_id:"Order.orderItems[].services[].containedServices",template:"existingOrderSummaryItemContainedServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].removedServices.services[].containedServices[]":{_id:"Order.orderItems[].removedServices.services[].containedServices[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].removedServices.services[].containedServices":{_id:"Order.orderItems[].removedServices.services[].containedServices",template:"existingOrderSummaryItemContainedServiceTemplate",removedServices:!0,mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].services[].containedServices[].pricePackages[]":{_id:"Order.orderItems[].services[].containedServices[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].services[].containedServices[].pricePackages":{_id:"Order.orderItems[].services[].services[].containedServices[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].removedServices.services[].containedServices[].pricePackages[]":{_id:"Order.orderItems[].removedServices.services[].containedServices[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].removedServices.services[].containedServices[].pricePackages":{_id:"Order.orderItems[].removedServices.services[].containedServices[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",removedServices:!0,mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].services[].containedServices[].paramters[]":{_id:"Order.orderItems[].services[].containedServices[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].services[].containedServices[].paramters":{_id:"Order.orderItems[].services[].containedServices[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.orderItems[].removedServices.services[].containedServices[].paramters[]":{
_id:"Order.orderItems[].removedServices.services[].containedServices[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].removedServices.services[].containedServices[].paramters":{_id:"Order.orderItems[].removedServices.services[].containedServices[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.orderItems[].channels[]":{_id:"Order.orderItems[].channels[]",template:"existingOrderSummaryComponentHeaderTitleTemplate",position:"5",headerTitle:"cm_existingOrderSummaryWidget_Channels"},"Order.orderItems[].channels":{_id:"Order.orderItems[].channels",template:"existingOrderSummaryItemChannelTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].channels[].pricePackages[]":{_id:"Order.orderItems[].channels[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].channels[].pricePackages":{_id:"Order.orderItems[].channels[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].packages[]":{_id:"Order.orderItems[].packages[]",template:"existingOrderSummaryComponentHeaderTitleTemplate",position:"6",headerTitle:"cm_existingOrderSummaryWidget_ThemePacks"},"Order.orderItems[].packages":{_id:"Order.orderItems[].packages",template:"existingOrderSummaryItemPackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.orderItems[].packages[].pricePackages[]":{_id:"Order.orderItems[].packages[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.orderItems[].packages[].pricePackages":{_id:"Order.orderItems[].packages[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[]":{_id:"Order.groups[]",template:"existingOrderSummaryItemsGenericTemplate",position:"2"},"Order.groups":{_id:"Order.groups",template:"existingOrderSummaryBundleItemTemplate"},"Order.groups[].items[]":{_id:"Order.groups[].items[]",template:"existingOrderSummaryItemsListTemplate"},"Order.groups[].items":{_id:"Order.groups[].items",template:"existingOrderSummaryItemTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice","person"],map:{currency:"Order.currency"},isBundle:!0},"Order.groups[].items[].devices[]":{_id:"Order.groups[].items[].devices[]",template:"existingOrderSummaryDeviceAndReceiversComponentHeaderTitleTemplate",position:"1",headerTitle:"cm_existingOrderSummaryWidget_Device"},"Order.groups[].items[].devices":{_id:"Order.groups[].items[].devices",template:"existingOrderSummaryItemDeviceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].oldDevices[]":{_id:"Order.groups[].items[].oldDevices[]",template:"existingOrderSummaryOldDeviceComponentHeaderTitleTemplate",position:"2",headerTitle:"cm_existingOrderSummaryWidget_oldDevice"},"Order.groups[].items[].oldDevices":{_id:"Order.groups[].items[].oldDevices",template:"existingOrderSummaryItemDeviceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].plans[]":{_id:"Order.groups[].items[].plans[]",template:"existingOrderSummaryPlanTitleTemplate",position:"3",headerTitle:"cm_existingOrderSummaryWidget_Plan"},"Order.groups[].items[].plans":{_id:"Order.groups[].items[].plans",template:"existingOrderSummaryItemPlanTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].plans[].services[]":{_id:"Order.groups[].items[].plans[].services[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].plans[].services":{_id:"Order.groups[].items[].plans[].services",template:"existingOrderSummaryItemServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].plans[].services[].pricePackages[]":{_id:"Order.groups[].items[].plans[].services[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].plans[].services[].pricePackages":{_id:"Order.groups[].items[].plans[].services[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].plans[].services[].paramters[]":{_id:"Order.groups[].items[].plans[].services[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].plans[].services[].paramters":{_id:"Order.groups[].items[].plans[].services[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.groups[].items[].plans[].services[].containedServices[]":{_id:"Order.groups[].items[].plans[].services[].containedServices[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].plans[].services[].containedServices":{_id:"Order.groups[].items[].plans[].services[].containedServices",template:"existingOrderSummaryItemContainedServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].plans[].services[].containedServices[].pricePackages[]":{_id:"Order.groups[].items[].plans[].services[].containedServices[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].plans[].services[].containedServices[].pricePackages":{_id:"Order.groups[].items[].plans[].services[].services[].containedServices[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].plans[].services[].containedServices[].paramters[]":{_id:"Order.groups[].items[].plans[].services[].containedServices[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].plans[].services[].containedServices[].paramters":{_id:"Order.groups[].items[].plans[].services[].containedServices[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.groups[].items[].services[]":{_id:"Order.groups[].items[].services[]",template:"existingOrderSummaryServicesListTemplate",position:"4",headerTitle:"cm_existingOrderSummaryWidget_Services"},"Order.groups[].items[].services":{_id:"Order.groups[].items[].services",template:"existingOrderSummaryItemServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].services[].pricePackages[]":{_id:"Order.groups[].items[].services[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].services[].pricePackages":{_id:"Order.groups[].items[].services[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].services[].paramters[]":{_id:"Order.groups[].items[].services[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].services[].paramters":{_id:"Order.groups[].items[].services[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.groups[].items[].services[].containedServices[]":{_id:"Order.groups[].items[].services[].containedServices[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].services[].containedServices":{_id:"Order.groups[].items[].services[].containedServices",template:"existingOrderSummaryItemContainedServiceTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].services[].containedServices[].pricePackages[]":{_id:"Order.groups[].items[].services[].containedServices[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].services[].containedServices[].pricePackages":{_id:"Order.groups[].items[].services[].containedServices[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].services[].containedServices[].paramters[]":{_id:"Order.groups[].items[].services[].containedServices[].paramters[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].services[].containedServices[].paramters":{_id:"Order.groups[].items[].services[].containedServices[].paramters",template:"existingOrderSummaryItemCommitmentTemplate",map:{id:"catalogId"}},"Order.groups[].items[].channels[]":{_id:"Order.groups[].items[].channels[]",template:"existingOrderSummaryComponentHeaderTitleTemplate",position:"5",headerTitle:"cm_existingOrderSummaryWidget_Channels"},"Order.groups[].items[].channels":{_id:"Order.groups[].items[].channels",template:"existingOrderSummaryItemChannelTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].channels[].pricePackages[]":{_id:"Order.groups[].items[].channels[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].channels[].pricePackages":{_id:"Order.groups[].items[].channels[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].packages[]":{_id:"Order.groups[].items[].packages[]",template:"existingOrderSummaryComponentHeaderTitleTemplate",position:"6",headerTitle:"cm_existingOrderSummaryWidget_ThemePacks"},"Order.groups[].items[].packages":{_id:"Order.groups[].items[].packages",template:"existingOrderSummaryItemPackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}},"Order.groups[].items[].packages[].pricePackages[]":{_id:"Order.groups[].items[].packages[].pricePackages[]",template:"existingOrderSummaryItemsGenericTemplate"},"Order.groups[].items[].packages[].pricePackages":{_id:"Order.groups[].items[].packages[].pricePackages",template:"existingOrderSummaryItemPricePackageTemplate",mergeToThisLevel:["recurringPrice","oneTimePrice"],map:{currency:"Order.currency"}}}});
define("businesswidget/repository/common/util/AmountCustomBinding",["jquery","underscore","lightsaber","businesswidget/repository_l9_common/common/utils/ImplUtil","knockout"],function (a,b,c,d,e){var f=function(a,b,c,f,g){a.innerHTML=d.formatNumberString(e.unwrap(b()))};e.bindingHandlers.formatAmount={init:f,update:f}});
define("businesswidget/repository/common/viewmodel/OrderSummaryTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ViewModel.extend({defaults:{orderData:{ProductOrderID:null,ProductOrderItems:[]},orderStatus:null,items:[]}})});
define("businesswidget/repository/common/model/CustomerContactPersonsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"customer/contact-persons",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},read:{url:"customer/contact-persons"}}}})});
define("businesswidget/repository/common/model/CustomerCustomerBillSpecIdPayChannel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{rest:{read:{method:"GET"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}},url:"customer/customer-bill-spec/:customerBillSpecId/pay-channel"}})});
define("businesswidget/repository/common/model/CommerceCustomerProductOrderPayChannelModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"commerce/customer/:customerId/product-order/:productOrderId/pay-channel",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"PUT",payload:["PayChannelProductOrderDetails"]}}}})});
define("businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel"],function (a,b,c,d,e,f,g){"use strict";return a.Core.ObservableViewModel.extend({defaults:{},initialize:function(a){this.initVariables(a),this.initializeExecutor(a),this.rulesHelperVM=this.create("baseRulesExecutorViewModel_CartRulesInvokerHelperViewModel",g)},processRules:function(){},shouldRegister:function(){return!1},initVariables:function(a){this.data.outcomeNotifier=b.observable(!1),this.initOutputObject(),this.initRuleDataObject()},initializeExecutor:function(a){},initOutputObject:function(){this.set("outcomeDataObject",{currentOutcome:null})},initRuleDataObject:function(){this.set("ruleDataObject",{currentRuleContext:null})},triggerOutcomeNotifier:function(){var a=this.getCurrentOutcome();this.rulesHelperVM.isNullOrUndefined(a)||this.data.outcomeNotifier(!0)},getOutcomeNotifier:function(){return this.data.outcomeNotifier},getOutcomeObject:function(){return this.get("outcomeDataObject")},getCurrentOutcome:function(){return this.getOutcomeObject().currentOutcome},setCurrentOutcome:function(a){var b=this.getOutcomeObject();b.currentOutcome=a,this.setCurrentOutcomeObject(b)},resetCurrentOutcome:function(){this.setCurrentOutcome(null)},setCurrentOutcomeObject:function(a){this.set("outcomeDataObject",a)},startExecution:function(a){!this.rulesHelperVM.isNullOrUndefined(this.rules)&&this.rules.length>0&&this.executeNext(a,0)},executeNext:function(a,b){var c=this;if(this.rules.length>b){var d=this.rules[b].handleAsync;if(!0===d){this.initAsyncRuleContext(this.rules[b]);var e=this.getCurrentRulePromise()}else this.initRuleContext(this.rules[b]);this[this.rules[b].ruleEvaluator](a),!0===d?e.done(function(d){c[c.rules[b].outcomeProcessor](a)?c.executeNext(a,++b):c.triggerOutcomeNotifier()}).fail(function(a){console.log("Error in rule execution")}):this[this.rules[b].outcomeProcessor](a)?this.executeNext(a,++b):this.triggerOutcomeNotifier()}},initRuleContext:function(a){var b={currentRuleId:a.ruleId};this.setCurrentRuleContext(b)},initAsyncRuleContext:function(a){this.initRuleContext(a);var b=$.Deferred(),c=this.getCurrentRuleContext();c.ruleDeferredObject=b,this.setCurrentRuleContext(c)},getCurrentRuleObject:function(){return this.get("ruleDataObject")},setCurrentRuleObject:function(a){this.set("ruleDataObject",a)},setCurrentRuleContext:function(a){var b=this.getCurrentRuleObject();b.currentRuleContext=a,this.setCurrentRuleObject(b)},getCurrentRuleContext:function(){return this.getCurrentRuleObject().currentRuleContext},setStartRuleId:function(a){var b=this.getCurrentRuleObject();b.startRuleId=a,this.setCurrentRuleObject(b)},getStartRuleId:function(){return this.getCurrentRuleObject().startRuleId},getCurrentRuleId:function(){return this.getCurrentRuleContext().currentRuleId},setCurrentRuleDeferredObject:function(a){var b=this.getCurrentRuleContext();b.ruleDeferredObject=a,this.setCurrentRuleContext(b)},getCurrentRuleDeferredObject:function(){return this.getCurrentRuleContext().ruleDeferredObject},getCurrentRulePromise:function(){return this.getCurrentRuleDeferredObject().promise()},resolveCurrentRuleDeferredIfAny:function(){if(this.getCurrentRuleDeferredObject())return this.getCurrentRuleDeferredObject().resolve()},setOutcomeByOutcomeId:function(a){this.isNullOrUndefined(a)||(this.setCurrentOutcome(a),this.resolveCurrentRuleDeferredIfAny())},setExecuteNextTaskOutcome:function(){this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)},processOutcome:function(a){var b=this.getCurrentOutcome();return!(!this.isNullOrUndefined(b)&&b!==this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)},setSalesChannel:function(a){var b=this.getCurrentRuleObject();b.salesChannel=a,this.setCurrentRuleObject(b)},getSalesChannel:function(){return this.getCurrentRuleObject().salesChannel},setLocale:function(a){var b=this.getCurrentRuleObject();b.locale=a,this.setCurrentRuleObject(b)},getLocale:function(){return this.getCurrentRuleObject().locale}})});
define("businesswidget/repository/common/viewmodel/cart/AddSubscriptionRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel"],function (a,b,c,d,e,f,g,h,i){"use strict";return g.extend({models:{},defaults:{},initializeExecutor:function(a){this.initRules(a),this.rulesBackendInvokerVM=this.create("addSubscriptionRulesExecutorViewModel_CartRulesBackendInvokerViewModel",i)},initRules:function(a){this.rules=[{handleAsync:!1,ruleEvaluator:"checkInstallationAddressEvaluator",outcomeProcessor:"processInstallationAddressOutcome"},{handleAsync:!0,ruleEvaluator:"checkMandatoryConfigurationEvaluator",outcomeProcessor:"processMandatoryConfigurationOutcome"},{handleAsync:!0,ruleEvaluator:"checkEquipmentNeededEvaluator",outcomeProcessor:"processEquipmentNeededOutcome"}]},getCustomerId:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},setAssignedProductId:function(a){var b=this.getCurrentRuleObject();b.assignedProductId=a,this.setCurrentRuleObject(b)},setSelectedPlan:function(a){var b=this.getCurrentRuleObject();b.selectedPlan=a,this.setCurrentRuleObject(b)},getSelectedPlan:function(){return this.get("ruleDataObject").selectedPlan},setSelectedDevice:function(a){var b=this.getCurrentRuleObject();b.selectedDevice=a,this.setCurrentRuleObject(b)},getSelectedDevice:function(){return this.get("ruleDataObject").selectedDevice},checkMandatoryConfigurationEvaluator:function(a){var b=this.getSelectedPlan();this.getSelectedDevice(),this.setIfAddressRequiredForPurchase(a,b),this.checkAddressAndStartFlow(a)},setIfAddressRequiredForPurchase:function(a,b){this.rulesHelperVM.checkAddressRequiredForPurchase(a,b)?this.setAddressRequired(!0):this.setAddressRequired(!1)},checkAddressRequired:function(){return this.get("isAddressRequired")},setAddressRequired:function(a){this.set("isAddressRequired",a)},checkInstallationAddressEvaluator:function(a){var b=this.getSelectedPlan(),c=(this.getCustomerId(a),this.rulesHelperVM.getAddressFromAppContext(a));this.rulesHelperVM.checkAddressRequiredForPurchase(a,b)&&!this.rulesHelperVM.isAddProductToBundleFlow(b)&&this.rulesHelperVM.isAddressNotAvailable(c)?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.INSTALLATION_ADDRESS_REQUIRED):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)},checkAddressAndStartFlow:function(a){var b=this;if(this.getCustomerId(a),this.checkAddressRequired()){var c=this.rulesHelperVM.getAddressFromAppContext(a),d=c.addressId||c.id;d?(this.setCustomerAddressId(d),this.startPurchaseFlow(a)):$.when(this.rulesBackendInvokerVM.retrieveCustomerAddresses(a,this.rulesHelperVM.isNullOrUndefined(this.getCustomerId(a)),this.getSalesChannel(),this.getLocale())).done(function(c){b.setCustomerAddresses(c),b.startPurchaseFlow(a)}).fail(function(a){console.log("Error in retrieving Customer Addresses")})}else this.startPurchaseFlow(a)},setCustomerAddresses:function(a){this.set("customerAddresses",a["InstallationAddress[]"]),a["InstallationAddress[]"]&&a["InstallationAddress[]"].length>0&&(this.set("customerAddress",this.get("customerAddresses")[0]),this.setCustomerAddressId(this.getCustomerAddress().id))},startPurchaseFlow:function(a){var b=this.getSelectedPlan(),c=this.getSelectedDevice();this.createOrUpdateOrder(a,b,c)},createOrUpdateOrder:function(a,b,c){var d=this.rulesHelperVM.getOrderIdFromAppContext(a),e=this.rulesHelperVM.retrieveOrderInfoFromCookie();this.rulesHelperVM.isNullOrUndefined(d)&&this.rulesHelperVM.isNullOrUndefined(e)?this.createOrder(a,b,c):this.updateOrder(a,b,c)},updateOrder:function(a,b,d){var e,f=this.rulesHelperVM.getOrderIdFromAppContext(a),g=this,h=this.getCustomerId(a),i=this.rulesHelperVM.retrieveOrderInfoFromCookie();if(!f&&i&&(f=i.productOrderID),this.rulesHelperVM.isAddProductToBundleFlow(b))this.setIsAddProductsToBundleFlow(),e=this.rulesBackendInvokerVM.updateOrderForAddingNewProductToBundle(a,b,f);else if(this.rulesHelperVM.isWirelessPurchaseFlow(b))e=this.rulesHelperVM.isNullOrUndefined(h)?this.rulesBackendInvokerVM.updateOrderWithNewWirelessSubscriptionForAnonymous(a,b,d,f,this.getSalesChannel(),this.getLocale()):b.isSharedPlan?this.rulesBackendInvokerVM.updateAddNewSubscriptionInSharedPlanOrderForCustomer(a,b,d,f,this.getSalesChannel(),this.getLocale()):this.rulesBackendInvokerVM.updateOrderWithNewWirelessSubscriptionForCustomer(a,b,d,f,this.getSalesChannel(),this.getLocale());else{var j=this.getCustomerAddressId();e=this.rulesHelperVM.isNullOrUndefined(h)?this.rulesBackendInvokerVM.updateOrderWithNewNonWirelessSubsForAnonymous(a,b,f,this.getSalesChannel(),this.getLocale(),j):this.rulesBackendInvokerVM.updateOrderWithNewNonWirelessSubsForCustomer(a,b,f,this.getSalesChannel(),this.getLocale(),j)}e.done(function(d){var e=g.rulesHelperVM.getOrderItemIdFromAppContext(a);if(e){var i=g.rulesHelperVM.getSelectedItemsFromContext(a);if(i)for(var j in i)if(j&&(j===c.get("businessType_ACCESSORY")||j===c.get("businessType_DEVICE_MD"))&&i[j].isRecent){h?g.rulesBackendInvokerVM.removeOrderItemForCustomer(a,h,f,e,g.getLocale(),g.getSalesChannel()):g.rulesBackendInvokerVM.removeOrderItemForAnonymous(a,f,e,g.getLocale(),g.getSalesChannel());break}}g.rulesHelperVM.isWirelessPurchaseFlow(b)?g.handleNewSubscriptionSuccessForWS(a,d):g.handleNewSubscriptionSuccessForNonWS(a,d)}).fail(function(a){console.log("Error in Update Order")})},createOrder:function(a,b,c){var d,e=(this.rulesHelperVM.getOrderIdFromAppContext(a),this),f=this.getCustomerId(a);if(this.rulesHelperVM.isAddProductToBundleFlow(b))this.setIsAddProductsToBundleFlow(),d=this.rulesBackendInvokerVM.createOrderForAddingNewProductToBundle(a,b);else if(this.rulesHelperVM.isWirelessPurchaseFlow(b))d=this.rulesHelperVM.isNullOrUndefined(f)?this.rulesBackendInvokerVM.createOrderWithNewWirelessSubscriptionForAnonymous(a,b,c,this.getSalesChannel(),this.getLocale()):b.isSharedPlan?this.rulesBackendInvokerVM.createAddNewSubscriptionInSharedPlanOrderForCustomer(a,b,c,this.getSalesChannel(),this.getLocale()):this.rulesBackendInvokerVM.createOrderWithNewWirelessSubscriptionForCustomer(a,b,c,this.getSalesChannel(),this.getLocale());else{var g=this.getCustomerAddressId();d=this.rulesHelperVM.isNullOrUndefined(f)?this.rulesBackendInvokerVM.createOrderWithNewNonWirelessSubsForAnonymous(a,b,g,this.getSalesChannel(),this.getLocale()):this.rulesBackendInvokerVM.createOrderWithNewNonWirelessSubsForCustomer(a,b,g,this.getSalesChannel(),this.getLocale())}d.done(function(c){e.rulesHelperVM.isWirelessPurchaseFlow(b)?e.handleNewSubscriptionSuccessForWS(a,c):e.handleNewSubscriptionSuccessForNonWS(a,c)}).fail(function(a){console.log("Error in creating Order")})},handleNewSubscriptionSuccessForWS:function(a,b){this.rulesHelperVM.dataCleanup(a);var c,d;this.getSelectedPlan(),b&&b.CreateNewOfferingConfigurationResponse?(c=b.CreateNewOfferingConfigurationResponse,d=b.CreateNewOfferingConfigurationResponse.newProductsInNewOfferings[0]):b&&b.CreateNewProductOrderResponse?(c=b.CreateNewProductOrderResponse,d=b.CreateNewProductOrderResponse.newProductsInOfferingInstances[0]):b&&b.NewProductInOfferingInstanceConfigurationResponse&&(c=b.NewProductInOfferingInstanceConfigurationResponse,d=b.NewProductInOfferingInstanceConfigurationResponse.newProductsInNewOfferingInstance[0]),this.getCustomerId(a)||this.rulesHelperVM.retrieveOrderInfoFromCookie()||this.rulesHelperVM.saveOrderInfoInCookie(c.productOrderID),this.setOrderAndOrderItemDetail(a,c.productOrderID,c.productOrderReferenceNumber,d.productOrderItemID,d.productOrderItemReferenceNumber),this.proposeAndAllocateLogicalResource(a,d)},handleNewSubscriptionSuccessForNonWS:function(b,c){this.rulesHelperVM.dataCleanup(b),this.rulesHelperVM.dataCleanupForInstallationAddress(b);var d,f,g=this.getSelectedPlan();c&&c.CreateNewOfferingConfigurationResponse?(d=c.CreateNewOfferingConfigurationResponse,f=c.CreateNewOfferingConfigurationResponse.newProductsInNewOfferings[0]):c&&c.NewProductInOfferingInstanceConfigurationResponse&&(d=c.NewProductInOfferingInstanceConfigurationResponse,f=d.newProductsInNewOfferingInstance[0]),this.setOrderAndOrderItemDetail(b,d.productOrderID,d.productOrderReferenceNumber,f.productOrderItemID,f.productOrderItemReferenceNumber),this.getCustomerId(b)||this.rulesHelperVM.retrieveOrderInfoFromCookie()||this.rulesHelperVM.saveOrderInfoInCookie(d.productOrderID);var h=this.rulesHelperVM.getIsMandatoryFieldExistsFromProductConfig(f.productConfiguration),i=a.Core.StorageUtil.getStorage("session").get("cachedLobDetailData"),j=!0;e.each(i,function(a){g.lob!=a.code||a.mandatoryConfigurationCheck||(j=!1)},this),j?h?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CONFIGURATION_REQUIRED_FOR_MANDATORY_WITHOUT_DEFAULT)},getOutComeObject:function(){return this.get("outcomeDataObject")},setOutComeObject:function(a){this.set("outcomeDataObject",a)},resetOutcomeObject:function(a,b,c){var d=this.getOutComeObject();d.installationAddressRequired=a,d.isMandatoryConfigRequired=b,d.isCartReady=c,this.setOutComeObject(d)},setMandatoryConfigRequiredOutcome:function(a){this.resetOutcomeObject(!1,a,!1)},setInstallationAddressRequiredOutcome:function(a){this.resetOutcomeObject(a,!1,!1)},setCartReadyOutcome:function(a){this.resetOutcomeObject(!1,!1,a)},getInstallationAddressRequiredOutcome:function(){return this.getOutComeObject().installationAddressRequired},getCartReadyOutcome:function(){return this.getOutComeObject().isCartReady},getMandatoryConfigRequiredOutcome:function(){return this.getOutComeObject().isMandatoryConfigRequired},getResourceType:function(){return"C"},proposeAndAllocateLogicalResource:function(a,b){var c=this;$.when(this.rulesBackendInvokerVM.proposeLogicalResource(a,1,this.getResourceType(),this.getSalesChannel(),this.getLocale())).done(function(d){c.saveProposeResourceOnSuccess(d),c.allocateResourceAndCheckMandatoryConfig(a,b)}).fail(function(a){console.log("Error in allocateNumberForWS")})},allocateResourceAndCheckMandatoryConfig:function(a,b){var c=this.getCustomerId(a),d=this,e=this.rulesBackendInvokerVM.getProdConfigForAllocatePhoneNumber(b,this.getSelectedResources()[0].value);$.when(d.rulesBackendInvokerVM.reserveLogicalResource(a,d.getSelectedResources()[0].value,this.getResourceType(),this.getSalesChannel(),this.getLocale()),d.rulesBackendInvokerVM.allocateNumber(a,c,e,d.isNullOrUndefined(c),this.getSalesChannel(),this.getLocale())).done(function(a,b){d.rulesHelperVM.getIsMandatoryFieldExistsFromProductConfig(b[0].UpdateProductInOrderConfigurationResponse.productConfiguration)?d.getIsAddProductsToBundleFlow.call(d)?(d.setIsNotAddProductsToBundleFlow.call(d),d.setOutcomeByOutcomeId(d.rulesHelperVM.OUTCOME_ID.BUNDLE_PRODUCT_MISSING_MANDATORY_CONFIGURATION)):d.setOutcomeByOutcomeId(d.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED):d.setOutcomeByOutcomeId(d.rulesHelperVM.OUTCOME_ID.CART_READY)}).fail(function(a){console.log("Error in allocateNumberForWS")})},saveProposeResourceOnSuccess:function(a){a.LogicalResources&&(a.LogicalResources.resources,this.set("selectedResources",a.LogicalResources.resources))},getSelectedResources:function(){return this.get("selectedResources")},setOrderAndOrderItemDetail:function(a,b,c,d,e){this.rulesHelperVM.serOrderDetailsInContext(a,b,c),this.rulesHelperVM.serOrderItemDetailsInContext(a,d,e)},checkInstallationAddressOutcomeProcessor:function(a){return!!this.getInstallationAddressRequiredOutcome()},processInstallationAddressOutcome:function(a){return this.processOutcome(a)},processMandatoryConfigurationOutcome:function(a){return this.processOutcome(a)},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)},getCustomerAddress:function(){return this.get("customerAddress")},getCustomerAddressId:function(){return this.get("customerAddressId")},setIsAddProductsToBundleFlow:function(){this.set("isAddProductToBundle",!0)},setIsNotAddProductsToBundleFlow:function(){this.set("isAddProductToBundle",!1)},getIsAddProductsToBundleFlow:function(){return this.get("isAddProductToBundle")},setCustomerAddressId:function(a){this.set("customerAddressId",a)},checkEquipmentNeededEvaluator:function(a){var b=this.getCustomerId(a);if(this.rulesHelperVM.isNullOrUndefined(b))this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY);else{var c=this,d=this.getCustomerAddressId(),e=this.rulesHelperVM.getOrderReferenceNumberFromAppContext(a),b=this.getCustomerId(a);this.rulesBackendInvokerVM.fetchRecommendedEquipment(a,b,e,d,this.getSalesChannel(),this.getLocale()).done(function(b){c.handleRecommendedEquipmentFetchSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})}},handleRecommendedEquipmentFetchSuccess:function(a,b){var c=this.rulesHelperVM.checkIfEquipmentNeeded(b.RecommendedEquipmentResponse);this.setNumberOfEquipmentsNeeded(c),c||0===c.length?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY):c.length>0&&this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},getNumberOfEquipmentsNeeded:function(){return this.getOutcomeObject().numberOfEquipmentsNeeded},setNumberOfEquipmentsNeeded:function(a){var b=this.getOutcomeObject();b.numberOfEquipmentsNeeded=a,this.setCurrentOutcomeObject(b)},processEquipmentNeededOutcome:function(a){return this.processOutcome(a)}})});
define("businesswidget/repository/common/viewmodel/cart/PurchaseEditHardGoodRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel"],function (a,b,c,d,e,f,g,h,i){"use strict";return g.extend({models:{},defaults:{},initializeExecutor:function(a){this.rules=[{handleAsync:!0,ruleEvaluator:"createOrUpdateOrder",outcomeProcessor:"processCreateOrUpdateOrderOutcome"}],this.rulesBackendInvokerVM=new i},getCustomerId:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},setSelectedDevice:function(a){var b=this.getCurrentRuleObject();b.selectedDevice=a,this.setCurrentRuleObject(b)},getSelectedDevice:function(){return this.get("ruleDataObject").selectedDevice},createOrUpdateOrder:function(b){var c=this.getSelectedDevice(),d=this.rulesHelperVM.getOrderItemIdFromAppContext(b),e=this.rulesHelperVM.getOrderIdFromAppContext(b),f=this.rulesHelperVM.retrieveOrderInfoFromCookie(),g=a.Core.StorageUtil.getStorage("session").get("cachedProductConfigurationData");this.rulesHelperVM.isNullOrUndefined(g)?this.rulesHelperVM.isNullOrUndefined(e)||this.rulesHelperVM.isNullOrUndefined(d)||!this.rulesHelperVM.isNullOrUndefined(g)?this.rulesHelperVM.isNullOrUndefined(e)&&this.rulesHelperVM.isNullOrUndefined(f)?this.createOrder(b,c):this.updateOrder(b,c):this.editHardGood(b,c):this.rulesHelperVM.dataCleanup(b)},editHardGood:function(a,b,c,d){var e,f=this,g=this.getCustomerId(a),h=this.rulesHelperVM.getOrderReferenceNumberFromAppContext(a),d=this.rulesHelperVM.getOrderItemIdFromAppContext(a),i=this.rulesHelperVM.getOrderIdFromAppContext(a),j=this.rulesHelperVM.getOrderItemRefNoFromAppContext(a);e=this.isNullOrUndefined(g)?this.updateStandAloneHardGoodForAnonymous(a,b,i,h,d,j,this.getSalesChannel(),this.getLocale(),null):this.updateStandAloneHardGoodForCustomer(a,b,i,h,d,j,this.getSalesChannel(),this.getLocale(),null),e.done(function(b){f.createNewHardGoodOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},createOrder:function(a,b){var c,c,d=this,e=this.getCustomerId(a);this.isNullOrUndefined(b)||(c=this.isNullOrUndefined(e)?this.createOrderWithNewStandAloneHardGoodForAnonymous(a,b,this.getSalesChannel(),this.getLocale()):this.createOrderWithNewStandAloneHardGoodForCustomer(a,b,this.getSalesChannel(),this.getLocale())),c.done(function(b){d.createNewHardGoodOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},updateOrder:function(a,b,c){var d,e=this,f=this.getCustomerId(a),g=this.rulesHelperVM.getOrderIdFromAppContext(a),h=this.rulesHelperVM.retrieveOrderInfoFromCookie();!g&&h&&(g=h.productOrderID),this.isNullOrUndefined(b)||(d=this.isNullOrUndefined(f)?this.updateOrderWithNewStandAloneHardGoodForAnonymous(a,b,g,this.getSalesChannel(),this.getLocale()):this.updateOrderWithNewStandAloneHardGoodForCustomer(a,b,g,this.getSalesChannel(),this.getLocale())),d.done(function(b){e.createNewHardGoodOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},createNewHardGoodOrderSuccess:function(a,b){this.rulesHelperVM.dataCleanup(a),b&&b.CreateNewHardGoodOrderResponse&&(console.log("productOrderID : "+b.CreateNewHardGoodOrderResponse.productOrderID),console.log("productOrderReferenceNumber : "+b.CreateNewHardGoodOrderResponse.productOrderReferenceNumber),this.getCustomerId(a)||this.rulesHelperVM.retrieveOrderInfoFromCookie()||this.rulesHelperVM.saveOrderInfoInCookie(b.CreateNewHardGoodOrderResponse.productOrderID)),this.rulesHelperVM.serOrderDetailsInContext(a,b.CreateNewHardGoodOrderResponse.productOrderID,b.CreateNewHardGoodOrderResponse.productOrderReferenceNumber),this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},createOrderWithNewStandAloneHardGoodForAnonymous:function(a,b,c,d){return this.rulesBackendInvokerVM.createOrderWithNewStandAloneHardGoodForAnonymous(a,b,c,d,b.quantity)},createOrderWithNewStandAloneHardGoodForCustomer:function(a,b,c,d){return this.rulesBackendInvokerVM.createOrderWithNewStandAloneHardGoodForCustomer(a,b,c,d,b.quantity)},updateOrderWithNewStandAloneHardGoodForAnonymous:function(a,b,c,d,e){return this.rulesBackendInvokerVM.updateOrderWithNewStandAloneHardGoodForAnonymous(a,b,c,d,e,b.quantity)},updateOrderWithNewStandAloneHardGoodForCustomer:function(a,b,c,d,e){return this.rulesBackendInvokerVM.updateOrderWithNewStandAloneHardGoodForCustomer(a,b,c,d,e,b.quantity)},setOrderAndOrderItemDetail:function(a,b,c,d,e){this.rulesHelperVM.serOrderDetailsInContext(a,b,c),this.rulesHelperVM.serOrderItemDetailsInContext(a,d,e)},processCreateOrUpdateOrderOutcome:function(a){return this.processOutcome(a)},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)},updateStandAloneHardGoodForCustomer:function(a,b,c,d,e,f,g,h,i){return this.rulesBackendInvokerVM.updateStandAloneHardGoodForCustomer(a,b,c,d,e,f,g,h,i)},updateStandAloneHardGoodForAnonymous:function(a,b,c,d,e,f,g,h,i){return this.rulesBackendInvokerVM.updateStandAloneHardGoodForAnonymous(a,b,c,d,e,f,g,h,i)}})});
define("businesswidget/repository/common/viewmodel/cart/EditSubscriptionRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel"],function (a,b,c,d,e,f,g,h,i){"use strict";return g.extend({models:{},defaults:{},HARD_GOODS_PAYMENT_TYPE:"POST",EQUIPMENT_ORDER_ACTION_PAYMENT_TYPE:"POST",initializeExecutor:function(a){e.bindAll(this,"checkCustomerInOrderSuccessCallBack","onRetrieveOrderSummarySuccess","retrievePayInstructionsFromOrder","retrievePayInstructionsFromOrderAction","retrievePayInstructionsFromHardGoods"),this.initRules(a),this.rulesBackendInvokerVM=this.create("editSubscriptionRulesExecutorViewModel_CartRulesBackendInvokerViewModel",i)},initRules:function(a){this.rules=[{handleAsync:!0,ruleEvaluator:"allocateResourceEvaluator",outcomeProcessor:"processAllocateResourceOutcome"},{handleAsync:!0,ruleEvaluator:"requiredEligibilityCheckEvaluator",outcomeProcessor:"requiredEligibilityCheckOutcome"},{handleAsync:!0,ruleEvaluator:"validateConfigurationEvaluator",outcomeProcessor:"processValidateConfigurationOutcome"},{handleAsync:!0,ruleEvaluator:"autoPayRequiredEvaluator",outcomeProcessor:"processAutoPayRequiredOutcome"}]},getCustomerId:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},setReservedResource:function(a){var b=this.getCurrentRuleObject();b.reserverResource=a,this.setCurrentRuleObject(b)},getReservedResource:function(){return this.get("ruleDataObject").reserverResource},setReservedResourceCategory:function(a){var b=this.getCurrentRuleObject();b.reserverResourceCategory=a,this.setCurrentRuleObject(b)},getReservedResourceCategory:function(){return this.get("ruleDataObject").reserverResourceCategory},setOrderId:function(a){var b=this.getCurrentRuleObject();b.orderId=a,this.setCurrentRuleObject(b)},getOrderId:function(){return this.get("ruleDataObject").orderId},setOrderReferenceNumber:function(a){var b=this.getCurrentRuleObject();b.orderReferenceNumber=a,this.setCurrentRuleObject(b)},getOrderReferenceNumber:function(){return this.get("ruleDataObject").orderReferenceNumber},setOrderItemID:function(a){var b=this.getCurrentRuleObject();b.orderItemId=a,this.setCurrentRuleObject(b)},getOrderItemID:function(){return this.get("ruleDataObject").orderItemId},allocateResourceEvaluator:function(a){return this.isNullOrUndefined(this.getReservedResource())||this.isNullOrUndefined(this.getOrderItemID())?void this.setExecuteNextTaskOutcome():this.getProductConfigAndAllocateResource(a)},checkIfMissingConfigurationOrderActionIDsExists:function(a){var b=this.rulesHelperVM.getMissingConfigurationOrderActionIDsInContext(a);if(this.isNullOrUndefined(b))return!1;for(var c=0,d=0;d<b.length;d++)b[d].valid&&c++;return c!=b.length},getProductConfigAndAllocateResource:function(a){var b,c=this.getCustomerId(a),d=this;b=this.isNullOrUndefined(c)?this.rulesBackendInvokerVM.retrieveProductConfigOptionsForAnonymous(a,this.getOrderItemID()):this.rulesBackendInvokerVM.retrieveProductConfigOptionsForCustomer(a,c,this.getOrderItemID()),b.done(function(b){d.allocateResource(a,b)}).fail(function(a){console.log("Error in creating Order")})},allocateResource:function(a,b){var c=this,d=this.getCustomerId(a),e=this.getReservedResource(),f=this.rulesBackendInvokerVM.getProdConfigForAllocatePhoneNumber(b.RetrieveProductInOrderConfigurationResponse,e);$.when(this.rulesBackendInvokerVM.allocateNumber(a,d,f,this.isNullOrUndefined(d),this.getSalesChannel(),this.getLocale())).done(function(a){c.rulesHelperVM.dataCleanUpforReservedResource(),c.setOutcomeByOutcomeId(c.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)}).fail(function(a){console.log("Error in allocateNumber")})},requiredEligibilityCheckEvaluator:function(a){var b=this,c=this.rulesHelperVM.getOrderIdFromAppContext(a),d=this.getCustomerId(a);this.isNullOrUndefined(d)?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY):$.when(this.rulesBackendInvokerVM.checkCustomerInOrder(a,c,this.getSalesChannel(),this.getLocale())).done(function(c){b.checkCustomerInOrderSuccessCallBack(a,c)}).fail(function(a){console.log("Error Check Customer In Order")})},checkCustomerInOrderSuccessCallBack:function(a,b){var c=this.rulesHelperVM.retrieveCustomerInOrder(b);this.rulesHelperVM.checkIfCustomerIsAssociated(c)?!0===this.rulesHelperVM.checkIfEligibilityCheckDone(a)?(this.rulesHelperVM.dataCleanUpforEligibilityCheckDone(a),this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.ELIGIBILITY_CHECK_REQUIRED);
},validateConfigurationEvaluator:function(a){var b=this.rulesHelperVM.getNonHardGoodOrderItemsInContext(a),c=this.rulesHelperVM.getCatalogItemEligibilityInfo(a),d=this.rulesHelperVM.getCatalogOfferEligibilityInfo(a);this.rulesHelperVM.checkIfNonElegibleItemsOrOffersExist(c,d)?(this.postEligibilityDataCleanup(a),this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)):!this.isNullOrUndefined(b)&&b.length>0?this.validateConfiguration(a,b):(this.postEligibilityDataCleanup(a),this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT))},autoPayRequiredEvaluator:function(a){if(this.rulesHelperVM.checkIfCustomerIsAuthenticated(a))this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CHECKOUT_SUCCESS);else{var b=this.rulesHelperVM.getOrderReferenceNumberFromAppContext(a),c=this.getCustomerId(a),d=this;$.when(this.rulesBackendInvokerVM.getOrderData(a,c,b,this.getLocale(),this.getSalesChannel())).done(function(b){d.onRetrieveOrderSummarySuccess(a,b)}).fail(function(a){console.log("Error Retrieving Order Information")})}},onRetrieveOrderSummarySuccess:function(a,b){b&&b.Order&&(this.retrievePayInstructionsFromOrder(b),console.log(this.planPaymentArr)),e.contains(this.planPaymentArr,"POST")?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.AUTO_PAY_REQUIRED):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CHECKOUT_SUCCESS)},retrievePayInstructionsFromOrder:function(a){if(this.planPaymentArr=[],this.retrievePayInstructionsFromOrderAction(a.Order.orderItems),a.Order.hasOwnProperty("groups"))for(var b=0;b<a.Order.groups.length;b++)this.retrievePayInstructionsFromOrderAction(a.Order.groups[b].items);a.Order.hardGoodAccessories&&a.Order.hardGoodAccessories.items&&this.retrievePayInstructionsFromHardGoods(a.Order.hardGoodAccessories.items),a.Order.hardGoodDevices&&a.Order.hardGoodDevices.items&&this.retrievePayInstructionsFromHardGoods(a.Order.hardGoodDevices.items)},retrievePayInstructionsFromHardGoods:function(a){if(void 0!=a)for(var b=0;b<a.length;b++)a[b]&&this.planPaymentArr.push(this.HARD_GOODS_PAYMENT_TYPE)},retrievePayInstructionsFromOrderAction:function(a){if(void 0!=a)for(var b=0;b<a.length;b++)a[b]&&a[b].plans&&a[b].plans[0]&&!a[b].changePlanOA?this.planPaymentArr.push(a[b].plans[0].paymentType):!0===a[b].equipment&&this.planPaymentArr.push(this.EQUIPMENT_ORDER_ACTION_PAYMENT_TYPE)},validateConfiguration:function(a,b){var c=this,d=this.getCustomerId(a),e=this.rulesHelperVM.getOrderIdFromAppContext(a);this.rulesBackendInvokerVM.validateConfigurationForNonAnonymous(d,e,b,this.getSalesChannel(),this.getLocale()).done(function(b){c.postEligibilityDataCleanup(a),c.rulesHelperVM.checkIfValidationSeverityBlocking(b.ValidateMultiProductConfigurationsResponse.productConfigurations)?c.setOutcomeByOutcomeId(c.rulesHelperVM.OUTCOME_ID.CART_READY):c.setOutcomeByOutcomeId(c.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)}).fail(function(a){console.log("Error in validate config")})},postEligibilityDataCleanup:function(a){this.rulesHelperVM.dataCleanUpforEligibilityDetail(a),this.rulesHelperVM.dataCleanUpforNonHardGoodOrderItems(a)},processValidateConfigurationOutcome:function(a){return this.processOutcome(a)},processAllocateResourceOutcome:function(a){return this.processOutcome(a)},requiredEligibilityCheckOutcome:function(a){return this.processOutcome(a)},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)},processAutoPayRequiredOutcome:function(a){return this.processOutcome(a)}})});
define("businesswidget/repository/common/viewmodel/cart/ChangePlanRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel"],function (a,b,c,d,e,f,g,h,i){"use strict";return g.extend({models:{},defaults:{},initializeExecutor:function(a){this.rules=[{handleAsync:!0,ruleEvaluator:"createOrUpdateOrder",outcomeProcessor:"processCreateOrUpdateOrderOutcome"}],this.rulesBackendInvokerVM=new i},getCustomerId:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},setSelectedPlan:function(a){var b=this.getCurrentRuleObject();b.selectedPlan=a,this.setCurrentRuleObject(b)},setAssignedProductId:function(a){var b=this.getCurrentRuleObject();b.assignedProductId=a,this.setCurrentRuleObject(b)},getSelectedPlan:function(){return this.get("ruleDataObject").selectedPlan},getAssignedProductId:function(){return this.get("ruleDataObject").assignedProductId},setSelectedDevice:function(a){var b=this.getCurrentRuleObject();b.selectedDevice=a,this.setCurrentRuleObject(b)},setProductSpecContainmentID:function(a){var b=this.getCurrentRuleObject();b.productSpecContainmentID=a,this.setCurrentRuleObject(b)},setPlanDetailsProductId:function(a){var b=this.getCurrentRuleObject();b.assignedPlanDetailsProductId=a,this.setCurrentRuleObject(b)},setDeviceAssignedProductId:function(a){var b=this.getCurrentRuleObject();b["deviceAssignedProductId "]=a,this.setCurrentRuleObject(b)},getSelectedDevice:function(){return this.get("ruleDataObject").selectedDevice},getPlanDetailsProductId:function(){return this.get("ruleDataObject").assignedPlanDetailsProductId},getProductSpecContainmentID:function(){return this.get("ruleDataObject").productSpecContainmentID},getDeviceAssignedProductId:function(){return this.get("ruleDataObject")["deviceAssignedProductId "]},createOrUpdateOrder:function(a){var b=this.getSelectedPlan(),c=this.getAssignedProductId(),d=this.rulesHelperVM.getProductOfferingIdFromAppContext(a),e=this.rulesHelperVM.getOrderIdFromAppContext(a),f=this.getSelectedDevice(),g=this.getProductSpecContainmentID(),h=this.getPlanDetailsProductId(),i=this.getDeviceAssignedProductId();f&&b&&(this.rulesHelperVM.isNullOrUndefined(e)?this.createOrderforUpgradeAndChange(a,i,f,h,g,b,d,c):this.updateOrderforUpgradeAndChange(a,i,f,h,g,b,d,c,e)),!f&&b&&(this.rulesHelperVM.isNullOrUndefined(e)?this.createOrder(a,c,d,b):this.updateOrder(a,b,c,d,e))},createOrder:function(a,b,c,d){var e,e,f=this,g=this.getCustomerId(a);this.isNullOrUndefined(d)||this.isNullOrUndefined(g)||(e=this.createChangePlanOrder(a,g,b,c,d,this.getSalesChannel(),this.getLocale())),e.done(function(b){f.createChangePlanOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},createOrderforUpgradeAndChange:function(a,b,c,d,e,f,g,h){var i,i,j,k,l,m,n,o=this,p=this.getCustomerId(a);this.isNullOrUndefined(f)||this.isNullOrUndefined(c)||this.isNullOrUndefined(p)||(i=this.createChangePlanOrder(a,p,h,g,f,this.getSalesChannel(),this.getLocale()),i.done(function(d){if(k=d.UpdateProductConfigurationResponse.productsInReplaceProductOffering[0].products[0].productOrderItemID,l=d.UpdateProductConfigurationResponse,o.rulesHelperVM.serOrderDetailsInContext(a,l.productOrderID,l.productOrderReferenceNumber),l.productsInReplaceProductOffering)for(var e=0;e<l.productsInReplaceProductOffering[0].products.length;e++){var f=l.productsInReplaceProductOffering[0].products[e];n=f.productID;for(var g=0;g<f.productConfiguration.displayableSimpleProductReferences.length;g++)if(f.productConfiguration.displayableSimpleProductReferences[g].productID==b){m=f.productConfiguration.displayableSimpleProductReferences[g];break}}j=o.updateDeviceAfterChangePlanAndOffer(a,p,k,c,m.productSpecContainmentID,b),j.done(function(b){o.createOrderforUpgradeAndChangeSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})}).fail(function(a){console.log("Error in creating Order")}))},createOrderforUpgradeAndChangeSuccess:function(a,b){this.rulesHelperVM.dataCleanup(a);var c=b.UpdateProductInOrderConfigurationResponse;return this.rulesHelperVM.serOrderItemDetailsInContext(a,c.productOrderItemID,c.productOrderItemReferenceNumber),c.productOrderID&&c.productOrderReferenceNumber&&this.rulesHelperVM.serOrderDetailsInContext(a,c.productOrderID,c.productOrderReferenceNumber),this.isMandatoryConfigRequiredForReplacePlan(c)?void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED):void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},updateDeviceAfterChangePlanAndOffer:function(a,b,c,d,e,f){return this.rulesBackendInvokerVM.updateDeviceAfterChangePlanAndOffer(a,b,c,d,e,f)},updateOrder:function(a,b,c,d,e){var f,g=this,h=this.getCustomerId(a),i=this.rulesHelperVM.getOrderItemIdFromAppContext(a);this.isNullOrUndefined(b)||this.isNullOrUndefined(h)||(f=this.updateChangePlanOrder(a,h,i,b,this.getSalesChannel(),this.getLocale(),c,d,e)),f.done(function(b){g.updateChangePlanOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},updateOrderforUpgradeAndChange:function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p=this,q=this.getCustomerId(a);this.isNullOrUndefined(f)||this.isNullOrUndefined(c)||this.isNullOrUndefined(q)||(j=this.updateChangePlanOrder(a,q,null,f,this.getSalesChannel(),this.getLocale(),h,g,i),j.done(function(d){if(l=d.UpdateProductConfigurationResponse.productsInReplaceProductOffering[0].products[0].productOrderItemID,m=d.UpdateProductConfigurationResponse,m.productsInReplaceProductOffering)for(var e=0;e<m.productsInReplaceProductOffering[0].products.length;e++){var f=m.productsInReplaceProductOffering[0].products[e];o=f.productID;for(var g=0;g<f.productConfiguration.displayableSimpleProductReferences.length;g++)if(f.productConfiguration.displayableSimpleProductReferences[g].productID==b){n=f.productConfiguration.displayableSimpleProductReferences[g];break}}k=p.updateDeviceAfterChangePlanAndOffer(a,q,l,c,n.productSpecContainmentID,b),k.done(function(b){p.createOrderforUpgradeAndChangeSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})}).fail(function(a){console.log("Error in creating Order")}))},createChangePlanOrderSuccess:function(a,b){if(this.rulesHelperVM.dataCleanup(a,!0),!e.isUndefined(b)&&null!=b){var c=b.UpdateProductConfigurationResponse;if(this.rulesHelperVM.getProductOfferingIdFromAppContext(a)===this.getSelectedPlan().productOfferingID){if(this.rulesHelperVM.serOrderItemDetailsInContext(a,c.productOrderItemID,c.productOrderItemReferenceNumber),this.rulesHelperVM.serOrderDetailsInContext(a,c.productOrderID,c.productOrderReferenceNumber),this.isMandatoryConfigRequiredForReplacePlan(c))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}else{var d=c.productsInReplaceProductOffering[0].products[0].productOrderItemID,f=c.productsInReplaceProductOffering[0].products[0].productOrderItemReferenceNumber;if(this.rulesHelperVM.serOrderItemDetailsInContext(a,d,f),this.rulesHelperVM.serOrderDetailsInContext(a,c.productOrderID,c.productOrderReferenceNumber),this.isMandatoryConfigRequired(c))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}}this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},updateChangePlanOrderSuccess:function(a,b){this.rulesHelperVM.dataCleanup(a);var c=this.rulesHelperVM.getOrderItemIdFromAppContext(a);if(!e.isUndefined(b)&&null!=b)if(this.rulesHelperVM.isNullOrUndefined(c)){var d=b.UpdateProductConfigurationResponse,f=this.rulesHelperVM.getProductOfferingIdFromAppContext(a),g=this.getSelectedPlan();if(f===g.productOfferingID){if(this.rulesHelperVM.serOrderItemDetailsInContext(a,d.productOrderItemID,d.productOrderItemReferenceNumber),this.rulesHelperVM.serOrderDetailsInContext(a,d.productOrderID,d.productOrderReferenceNumber),this.isMandatoryConfigRequiredForReplacePlan(d))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}else{var h=d.productsInReplaceProductOffering[0].products[0].productOrderItemID,i=d.productsInReplaceProductOffering[0].products[0].productOrderItemReferenceNumber;if(this.rulesHelperVM.serOrderItemDetailsInContext(a,h,i),this.rulesHelperVM.serOrderDetailsInContext(a,d.productOrderID,d.productOrderReferenceNumber),this.isMandatoryConfigRequired(d))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}}else{var d=b.UpdateProductInOrderConfigurationResponse,h=d.productsInReplaceProductOffering[0].products[0].productOrderItemID,i=d.productsInReplaceProductOffering[0].products[0].productOrderItemReferenceNumber;if(this.rulesHelperVM.serOrderItemDetailsInContext(a,h,i),this.isMandatoryConfigRequired(d))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},createChangePlanOrder:function(a,b,c,d,e,f){return this.rulesBackendInvokerVM.createChangePlanOrder(a,b,c,d,e,f)},updateChangePlanOrder:function(a,b,c,d,e,f,g,h,i){return this.rulesBackendInvokerVM.updateChangePlanOrder(a,b,c,d,e,f,g,h,i)},createUpgradeAndChangePlanOrder:function(a,b,c,d,e,f,g,h,i,j,k){return this.rulesBackendInvokerVM.createUpgradeAndChangePlanOrder(a,b,c,d,e,f,g,h,i,j,k)},processCreateOrUpdateOrderOutcome:function(a){return this.processOutcome(a)},isMandatoryConfigRequired:function(a){return a.productsInReplaceProductOffering[0].products[0].productConfiguration.mandatoryConfigRequired},isMandatoryConfigRequiredForReplacePlan:function(a){return a.productConfiguration.mandatoryConfigRequired},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)}})});
define("businesswidget/repository/common/model/CustomerProductOrderQuoteModel",["underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{url:"commerce/customer/:customerId/product-order/:productOrderId/quote",rest:{defaults:{qParams:{sc:b.get("salesChannel"),lo:b.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["RetrieveQuoteRequest"]}}}})});
define("businesswidget/repository/common/viewmodel/cart/UpgradeDeviceRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel","businesswidget/repository/common/model/CustomerProductOrderQuoteModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l){"use strict";return g.extend({models:{customerProductOrderQuoteModel:j},subViewModels:{productOrderTopicViewModel:k,customerInContextTopicViewModel:l},defaults:{},initializeExecutor:function(a){this.rules=[{handleAsync:!0,ruleEvaluator:"createOrUpdateOrder",outcomeProcessor:"processCreateOrUpdateOrderOutcome"}],this.rulesBackendInvokerVM=new i},getCustomerId:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},setSelectedDevice:function(a){var b=this.getCurrentRuleObject();b.selectedDevice=a,this.setCurrentRuleObject(b)},setAssignedProductId:function(a){var b=this.getCurrentRuleObject();b.assignedProductId=a,this.setCurrentRuleObject(b)},setDeviceAssignedProductId:function(a){var b=this.getCurrentRuleObject();b["deviceAssignedProductId "]=a,this.setCurrentRuleObject(b)},setProductSpecContainmentID:function(a){var b=this.getCurrentRuleObject();b.productSpecContainmentID=a,this.setCurrentRuleObject(b)},setPlanDetailsProductId:function(a){var b=this.getCurrentRuleObject();b.assignedPlanDetailsProductId=a,this.setCurrentRuleObject(b)},getSelectedDevice:function(){return this.get("ruleDataObject").selectedDevice},getAssignedProductId:function(){return this.get("ruleDataObject").assignedProductId},getDeviceAssignedProductId:function(){return this.get("ruleDataObject")["deviceAssignedProductId "]},getPlanDetailsProductId:function(){return this.get("ruleDataObject").assignedPlanDetailsProductId},getProductSpecContainmentID:function(){return this.get("ruleDataObject").productSpecContainmentID},createOrUpdateOrder:function(a){var b=this.getSelectedDevice(),c=this.getDeviceAssignedProductId(),d=this.getProductSpecContainmentID(),e=this.getPlanDetailsProductId(),f=this.rulesHelperVM.getOrderIdFromAppContext(a);this.rulesHelperVM.isNullOrUndefined(f)?this.createOrder(a,c,b,e,d):this.updateOrder(a,c,b,e,d)},createOrder:function(a,b,c,d,e){var f,f,g=this,h=this.getCustomerId(a);this.isNullOrUndefined(c)||this.isNullOrUndefined(h)||(f=this.createUpgradeDeviceOrder(a,h,b,c,this.getSalesChannel(),this.getLocale(),d,e)),f.done(function(b){g.createUpgradeOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},updateOrder:function(a,b,c,d,f){var g=this.fetchProductOrderItemsForRegisteredUser(),h=this;g.done(function(g){if(g&&g.RetrieveQuoteResponse&&g.RetrieveQuoteResponse.order&&g.RetrieveQuoteResponse.order.productOfferings&&g.RetrieveQuoteResponse.order.productOfferings.length>0){var i=h.get("ruleDataObject").assignedPlanDetailsProductId,j=!0;e.each(g.RetrieveQuoteResponse.order.productOfferings,function(b,g){j&&e.each(b.productOrderItems,function(b,g){if(b.productID==i&&"CHANGE_PRODUCT"==b.actionType&&j){var k=b.productOrderItemID;e.each(b.displayableSimpleProductReferences,function(b,e){"AD"==b.action&&j&&(j=!1,h.updateOrderWithAnotherUpgradeDevice(a,b.productID,c,d,f,k))})}})}),j&&h.updateOrderWithNewOrderItem(a,b,c,d,f)}}).fail(function(a){console.log("Error in fetching Order items")})},fetchProductOrderItemsForRegisteredUser:function(a,b,c,d,e){this.models.customerProductOrderQuoteModel.set({customerId:this.subViewModels.customerInContextTopicViewModel.get("ID"),productOrderId:this.subViewModels.productOrderTopicViewModel.get("productOrderID")});var f={activityForConfiguration:null,productOrderReferenceNumber:null,returnQuoteData:{catalogDataInd:!0,quotedItemsInd:!1,taxInformationInd:!0,configurationItemsInd:!0,crossProductDiscountsInd:!1,returnRemovedItems:!1,returnToBeCancelItems:!1}};return this.models.customerProductOrderQuoteModel.set("RetrieveQuoteRequest",f),this.models.customerProductOrderQuoteModel.setQueryParams({lo:this.getLocale(),sc:this.getSalesChannel()}),this.models.customerProductOrderQuoteModel.fetch({success:this.onProductOrderItemsFetchSuccess,error:this.onProductOrderItemsFetchError})},onProductOrderItemsFetchSuccess:function(a,b,c){console.log("success : fetching Order items")},updateOrderWithNewOrderItem:function(a,b,c,d,e){var f,g=this,h=this.getCustomerId(a),i=this.rulesHelperVM.getOrderIdFromAppContext(a);this.isNullOrUndefined(c)||this.isNullOrUndefined(h)||(f=this.updateUpgradeDeviceOrder(a,h,b,c,this.getSalesChannel(),this.getLocale(),d,e,i)),f.done(function(b){g.updateUpgradeDeviceOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})},updateOrderWithAnotherUpgradeDevice:function(a,b,c,d,e,f){var g,h=this,i=this.subViewModels.customerInContextTopicViewModel.get("ID"),j=this.get("ruleDataObject").assignedPlanDetailsProductId;this.isNullOrUndefined(c)||this.isNullOrUndefined(i)||(g=this.updateUpgradeDeviceOrder(a,i,b,c,this.getSalesChannel(),this.getLocale(),d,e,j,f)),g.done(function(b){h.updateUpgradeDeviceOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")}),console.log("double upgrade orders merge")},createUpgradeOrderSuccess:function(a,b){if(this.rulesHelperVM.dataCleanup(a),!e.isUndefined(b)&&null!=b){var c=b.UpdateProductConfigurationResponse,d=c.productOrderItemID,f=c.productOrderItemReferenceNumber;if(this.rulesHelperVM.serOrderItemDetailsInContext(a,d,f),this.rulesHelperVM.serOrderDetailsInContext(a,c.productOrderID,c.productOrderReferenceNumber),this.isMandatoryConfigRequired(c))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},updateUpgradeDeviceOrderSuccess:function(a,b){if(this.rulesHelperVM.dataCleanup(a),!e.isUndefined(b)&&null!=b){var c=b.UpdateProductConfigurationResponse||b.UpdateProductInOrderConfigurationResponse,d=c.productOrderItemID,f=c.productOrderItemReferenceNumber;if(this.rulesHelperVM.serOrderItemDetailsInContext(a,d,f),this.isMandatoryConfigRequired(c))return void this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED)}this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)},createUpgradeDeviceOrder:function(a,b,c,d,e,f,g,h){return this.rulesBackendInvokerVM.createUpgradeDeviceOrder(a,b,c,d,e,f,g,h)},updateUpgradeDeviceOrder:function(a,b,c,d,e,f,g,h,i,j){return this.rulesBackendInvokerVM.updateUpgradeDeviceOrder(a,b,c,d,e,f,g,h,i,j)},processCreateOrUpdateOrderOutcome:function(a){return this.processOutcome(a)},isMandatoryConfigRequired:function(a){return a.productConfiguration.mandatoryConfigRequired},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)}})});
define("businesswidget/repository/common/viewmodel/cart/PurchaseBundleRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel"],function (a,b,c,d,e,f,g,h,i){"use strict";return g.extend({models:{},defaults:{},initializeExecutor:function(a){this.rules=[{handleAsync:!1,ruleEvaluator:"checkInstallationAddressEvaluator",outcomeProcessor:"processInstallationAddressOutcome"},{handleAsync:!0,ruleEvaluator:"checkMandatoryConfigurationEvaluator",outcomeProcessor:"processMandatoryConfigurationOutcome"}],this.rulesBackendInvokerVM=new i},getCustomerId:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},setSelectedOffering:function(a){var b=this.getCurrentRuleObject();b.selectedOffering=a,this.setCurrentRuleObject(b)},getSelectedOffering:function(){return this.get("ruleDataObject").selectedOffering},checkInstallationAddressEvaluator:function(a){var b=this.getSelectedOffering(),c=(this.getCustomerId(a),this.rulesHelperVM.getAddressFromAppContext(a));this.rulesHelperVM.checkAddressRequiredForBundlePurchase(a,b)&&this.rulesHelperVM.isAddressNotAvailable(c)?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.INSTALLATION_ADDRESS_REQUIRED):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.EXECUTE_NEXT)},processInstallationAddressOutcome:function(a){return this.processOutcome(a)},checkMandatoryConfigurationEvaluator:function(a){var b=this.getSelectedOffering();this.setIfAddressRequiredForPurchase(a,b),this.checkAddressAndStartFlow(a)},setIfAddressRequiredForPurchase:function(a,b){this.rulesHelperVM.checkAddressRequiredForBundlePurchase(a,b)?this.set("isAddressRequired",!0):this.set("isAddressRequired",!1)},checkAddressAndStartFlow:function(a){var b=this;if(this.getCustomerId(a),this.get("isAddressRequired")){var c=this.rulesHelperVM.getAddressFromAppContext(a),d=c.addressId||c.id;d?(this.set("customerAddressId",d),this.createOrUpdateOrder(a)):$.when(this.rulesBackendInvokerVM.retrieveCustomerAddresses(a,this.rulesHelperVM.isNullOrUndefined(this.getCustomerId(a)),this.getSalesChannel(),this.getLocale())).done(function(c){b.setCustomerAddresses(c),b.createOrUpdateOrder(a)}).fail(function(a){console.log("Error in retrieving Customer Addresses")})}else this.createOrUpdateOrder(a)},setCustomerAddresses:function(a){this.set("customerAddresses",a["InstallationAddress[]"]),a["InstallationAddress[]"]&&a["InstallationAddress[]"].length>0&&(this.set("customerAddress",this.get("customerAddresses")[0]),this.set("customerAddressId",this.getCustomerAddress().id))},getCustomerAddress:function(){return this.get("customerAddress")},processMandatoryConfigurationOutcome:function(a){return this.processOutcome(a)},createOrUpdateOrder:function(a){var b=this.getSelectedOffering(),c=this.rulesHelperVM.getOrderIdFromAppContext(a),d=this.rulesHelperVM.retrieveOrderInfoFromCookie();this.rulesHelperVM.isNullOrUndefined(c)&&this.rulesHelperVM.isNullOrUndefined(d)?this.createOrderForBundle(a,b):this.updateOrderForBundle(a,b,c)},createOrderForBundle:function(a,b){if(!this.rulesHelperVM.isNullOrUndefined(b)){var c,d=this,e=this.getSalesChannel(),f=this.getLocale(),g=this.get("customerAddressId");c=this.rulesBackendInvokerVM.createBundleOrder(a,b,g,e,f),c.done(function(b){d.bundleOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})}},updateOrderForBundle:function(a,b,c){if(!this.rulesHelperVM.isNullOrUndefined(b)&&!this.rulesHelperVM.isNullOrUndefined(c)){var d,e=this,f=this.getSalesChannel(),g=this.getLocale(),h=this.get("customerAddressId");d=this.rulesBackendInvokerVM.updateBundleOrder(a,b,h,c,f,g),d.done(function(b){e.bundleOrderSuccess(a,b)}).fail(function(a){console.log("Error in creating Order")})}},bundleOrderSuccess:function(a,b){this.rulesHelperVM.dataCleanup(a),this.rulesHelperVM.dataCleanupForInstallationAddress(a);var c=this.getSelectedOffering();if(b&&b.CreateNewOfferingConfigurationResponse){var d=b.CreateNewOfferingConfigurationResponse,f=d.newProductsInNewOfferings;this.getCustomerId(a)||this.rulesHelperVM.retrieveOrderInfoFromCookie()||this.rulesHelperVM.saveOrderInfoInCookie(d.productOrderID);var g=c.productOfferingID,h=this.calculateMissingConfigurationOrderActionIDs(f);this.setMissingConfigurationOrderActionIDs(h),this.setOrderAndOrderItemDetail(a,d.productOrderID,d.productOrderReferenceNumber,h[0],h[0]+"A",h,g),this.rulesHelperVM.setFlowNameInContext(a,"InProductOrderItem");var i=this,j=[];e.each(f,function(a){a.productConfiguration.lineOfBusiness==i.rulesHelperVM.LOB_CODE.WS&&j.push(a)}),j.length>0?this.handleForWSProduct(a,j):this.handleBunderOrderOutcome()}},handleForWSProduct:function(a,b){var c=$.Deferred(),d=[],f=this;return e.each(b,function(b){b.productConfiguration.productSpecification.level!=f.rulesHelperVM.productSpecificationLevel.G&&d.push(f.proposeAndAllocateLogicalResource(a,b))}),$.when.apply($,d).done(function(){c.resolve()}),c.promise()},handleBunderOrderOutcome:function(a,b){var c=this.getSelectedOffering(),d=this.getMissingConfigurationOrderActionIDs(),b=b;if(b&&b.productConfiguration.serviceID||!b)if(d.length>0)this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.MANDATORY_BUNDLE_CONFIGURATION_REQUIRED);else{var e=this.checkIfLOBNeedsMandatoryConfiguration(c);e?this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CONFIGURATION_REQUIRED_FOR_MANDATORY_WITHOUT_DEFAULT):this.setOutcomeByOutcomeId(this.rulesHelperVM.OUTCOME_ID.CART_READY)}else this.proposeAndAllocateLogicalResource(a,b)},setMissingConfigurationOrderActionIDs:function(a){this.set("missingConfigurationOrderActionIDs",a)},getMissingConfigurationOrderActionIDs:function(a){return this.get("missingConfigurationOrderActionIDs")},proposeAndAllocateLogicalResource:function(a,b){var c=this;$.when(this.rulesBackendInvokerVM.proposeLogicalResource(a,1,this.getResourceType(),this.getSalesChannel(),this.getLocale())).done(function(d){c.saveProposeResourceOnSuccess(d),c.allocateResourceAndCheckMandatoryConfig(a,b)}).fail(function(a){console.log("Error in allocateNumberForWS")})},allocateResourceAndCheckMandatoryConfig:function(a,b){var c=this.getCustomerId(a),d=this,e=this.rulesBackendInvokerVM.getProdConfigForAllocatePhoneNumber(b,this.getSelectedResources()[0].value);$.when(d.rulesBackendInvokerVM.reserveLogicalResource(a,d.getSelectedResources()[0].value,this.getResourceType(),this.getSalesChannel(),this.getLocale()),d.rulesBackendInvokerVM.allocateNumber(a,c,e,d.isNullOrUndefined(c),this.getSalesChannel(),this.getLocale())).done(function(b,c){d.handleBunderOrderOutcome(a,c[0].UpdateProductInOrderConfigurationResponse)}).fail(function(a){console.log("Error in allocateNumberForWS")})},saveProposeResourceOnSuccess:function(a){a.LogicalResources&&(a.LogicalResources.resources,this.set("selectedResources",a.LogicalResources.resources))},getResourceType:function(){return"C"},getSelectedResources:function(){return this.get("selectedResources")},checkIfLOBNeedsMandatoryConfiguration:function(b){var c=a.Core.StorageUtil.getStorage("session").get("cachedLobDetailData"),d=!1;return e.each(c,function(a){b.lob==a.code&&a.mandatoryConfigurationCheck&&(d=!0)},this),d},calculateMissingConfigurationOrderActionIDs:function(a){var b,c=[],d=this;return e.each(a,function(a){(b=d.rulesHelperVM.getIsMandatoryFieldExistsFromProductConfig(a.productConfiguration))&&c.push(a.productOrderItemID)},this),c},setOrderAndOrderItemDetail:function(a,b,c,d,e,f,g){this.rulesHelperVM.serOrderDetailsInContext(a,b,c),this.rulesHelperVM.serOrderItemDetailsInContext(a,d,e),this.rulesHelperVM.setMissingConfigurationOrderActionIDsInContext(a,f),this.rulesHelperVM.setProductOfferingID(a,g)},processMandatoryBundleConfMissingOutcome:function(a){return this.processOutcome(a)}})});
define("businesswidget/repository/common/viewmodel/CartRulesExecutorViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/viewmodel/cart/CartRulesInvokerHelperViewModel","businesswidget/repository/common/viewmodel/cart/AddSubscriptionRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/PurchaseEditHardGoodRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/EditSubscriptionRulesExecutorViewModel","single!businesswidget/repository/common/viewmodel/FullCartTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerDetailsViewModel","businesswidget/repository/common/viewmodel/cart/ChangePlanRulesExecutorViewModel","single!businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","single!businesswidget/repository/common/viewmodel/InstallationAddressTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerEligibilityTopicViewModel","businesswidget/repository/common/viewmodel/cart/UpgradeDeviceRulesExecutorViewModel","businesswidget/repository/common/viewmodel/cart/PurchaseBundleRulesExecutorViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";return a.Core.ObservableViewModel.extend({models:{},defaults:{},initialize:function(a){e.bindAll(this,"purchaseNewSubscriptionOutcomeListener"),this.rulesHelperVM=this.create("cartRulesExecutorViewModel_CartRulesInvokerHelperViewModel",g),p.off("success"),p.on("success",this.onCustomerEligibilitySucceed,this),n.off("isReadyForOrder"),n.on("isReadyForOrder",this.onBuyItemsChanged,this)},onCustomerIdentified:function(){this.retrieveSelectedItems(requirejs.appContext)},onBuyItemsChanged:function(){this.retrieveSelectedItems(requirejs.appContext)},onInstallationAddresChanged:function(){this.retrieveSelectedItems(requirejs.appContext)},onCustomerEligibilitySucceed:function(){a.Core.StorageUtil.getStorage("securedPersistentCookie").deleteKey("orderIDRef"),this.retrieveSelectedItems(requirejs.appContext)},retrieveSelectedItems:function(a,b){var c,d,e,f=(this.rulesHelperVM.getOrderItemIdFromAppContext(a),this.getSelectedItems(a));if(!this.isNullOrUndefined(f))for(var g in f)f.hasOwnProperty(g)&&(g===this.rulesHelperVM.ITEM_BUSINESS_TYPE.PLAN?c=f[g]:g===this.rulesHelperVM.ITEM_BUSINESS_TYPE.DEVICE||g===this.rulesHelperVM.ITEM_BUSINESS_TYPE.MD||g===this.rulesHelperVM.ITEM_BUSINESS_TYPE.AC?(d=f[g],d.itemBussinessType="DEVICE"):g===this.rulesHelperVM.ITEM_BUSINESS_TYPE.OFFERING&&(e=f[g]));this.evaluatePreconditions(a,c,d,e)},evaluatePreconditions:function(a,b,c,d){var e=this.rulesHelperVM.getOrderIdFromAppContext(a),f=this.rulesHelperVM.getOrderItemIdFromAppContext(a),g=(this.rulesHelperVM.getReservedResourceValue(a),this.getCustomerIdFromAppContext(a),this.rulesHelperVM.getAssignedProductIDFromAppContext(a)),h=this.rulesHelperVM.getDeviceAssignedProductIDFromAppContext(a),i=this.rulesHelperVM.getContainedProductIDFromAppContext(a),j=this.rulesHelperVM.getProductSpecContainmentIDFromAppContext(a);
if(this.isNullOrUndefined(b)&&this.isNullOrUndefined(d)&&this.isNullOrUndefined(c)){if(this.rulesHelperVM.isBundleFlow(a))return;if(this.isNullOrUndefined(e)&&this.isNullOrUndefined(f))return this.executeCartReadyRule();this.startEditSubscriptionFlow(a)}else this.isChangePlanFlow(a,b,c)?this.startChangePlanFlow(a,b,g):this.isUpgradeDeviceFlow(a,c,b)?this.startUpgradeDeviceFlow(a,c,h,i,j):this.isUpgradeDeviceAndChangePlanFlow(a,c,b)?this.startUpgradeDeviceAndChangePlanFlow(a,c,h,i,j,b,g):this.startPurchaseFlow(a,b,c,d)},startChangePlanFlow:function(a,b,c){this.initExecutorForChangePlan(a,b,c)},initExecutorForChangePlan:function(a,b,c){var d=this,e=this.create("cartRulesExecutorViewModel_ChangePlanRulesExecutorViewModel",m);this.setDefaultFlowExecutorData(e),e.getOutcomeNotifier().subscribe(function(b){!0===b&&d.changePlanOutcomeListener(a,e,b)},this),e.setSelectedPlan(b),e.setAssignedProductId(c),e.startExecution(a)},startUpgradeDeviceFlow:function(a,b,c,d,e){this.initExecutorForUpgradeDevice(a,b,c,d,e)},initExecutorForUpgradeDevice:function(a,b,c,d,e){var f=this,g=this.create("cartRulesExecutorViewModel_UpgradeDeviceRulesExecutorViewModel",q);this.setDefaultFlowExecutorData(g),g.getOutcomeNotifier().subscribe(function(b){!0===b&&f.upgradeDeviceOutcomeListener(a,g,b)},this),g.setSelectedDevice(b),g.setDeviceAssignedProductId(c),g.setProductSpecContainmentID(e),g.setPlanDetailsProductId(d),g.startExecution(a)},startUpgradeDeviceAndChangePlanFlow:function(a,b,c,d,e,f,g){this.initExecutorForUpgradeDeviceAndChangePlan(a,b,c,d,e,f,g)},initExecutorForUpgradeDeviceAndChangePlan:function(a,b,c,d,e,f,g){var h=this,i=this.create("cartRulesExecutorViewModel_UpgradeDeviceAndChangePlanRulesExecutorViewModel",m);this.setDefaultFlowExecutorData(i),i.getOutcomeNotifier().subscribe(function(b){!0===b&&h.changePlanOutcomeListener(a,i,b)},this),i.setSelectedDevice(b),i.setSelectedPlan(f),i.setDeviceAssignedProductId(c),i.setAssignedProductId(g),i.setProductSpecContainmentID(e),i.setPlanDetailsProductId(d),i.startExecution(a)},executeCartReadyRule:function(){this.setCartReadyToRender(!0),this.handleAction("checkCartReady")},startEditSubscriptionFlow:function(a){this.initExecutorForEditSubscription(a)},startPurchaseFlow:function(a,b,c,d){this.getCustomerIdFromAppContext(a),this.isNullOrUndefined(b)?this.isNullOrUndefined(c)?this.isNullOrUndefined(d)||this.initExecutorForPurchaseBundle(a,d):this.initExecutorForPurchaseHardGood(a,c):this.initExecutorForAddSubscription(a,b,c)},initExecutorForAddSubscription:function(a,b,c){var d=this,e=this.create("cartRulesExecutorViewModel_AddSubscriptionRulesExecutorViewModel",h);this.setDefaultFlowExecutorData(e),e.getOutcomeNotifier().subscribe(function(b){!0===b&&d.purchaseNewSubscriptionOutcomeListener(a,e,b)},this),e.setSelectedPlan(b),e.setSelectedDevice(c),e.startExecution(a)},initExecutorForPurchaseHardGood:function(a,b){var c=this,d=this.create("cartRulesExecutorViewModel_PurchaseEditHardGoodRulesExecutorViewModel",i);this.setDefaultFlowExecutorData(d),d.getOutcomeNotifier().subscribe(function(b){!0===b&&c.purchaseHardGoodOutcomeListener(a,d,b)},this),d.setSelectedDevice(b),d.startExecution(a)},initExecutorForEditSubscription:function(a){var b=this,c=this.rulesHelperVM.getReservedResourceValue(a),d=this.rulesHelperVM.getOrderIdFromAppContext(a),e=this.rulesHelperVM.getOrderReferenceNumberFromAppContext(a),f=this.rulesHelperVM.getReservedResourceCategory(a),g=this.rulesHelperVM.getOrderItemIdFromAppContext(a),h=this.create("cartRulesExecutorViewModel_EditSubscriptionRulesExecutorViewModel",j);this.setDefaultFlowExecutorData(h),h.getOutcomeNotifier().subscribe(function(c){!0===c&&b.editSubscriptionOutcomeListener(a,h,c)},this),h.setReservedResource(c),h.setReservedResourceCategory(f),h.setOrderId(d),h.setOrderReferenceNumber(e),h.setOrderItemID(g),h.startExecution(a)},initExecutorForPurchaseBundle:function(a,b){var c=this,d=this.create("cartRulesExecutorViewModel_PurchaseEditHardGoodRulesExecutorViewModel",r);this.setDefaultFlowExecutorData(d),d.getOutcomeNotifier().subscribe(function(b){!0===b&&c.purchaseBundleOutcomeListener(a,d,b)},this),d.setSelectedOffering(b),d.startExecution(a)},purchaseBundleOutcomeListener:function(a,b,c){this.evaluateOutcome(a,b,c)},editSubscriptionOutcomeListener:function(a,b,c){this.evaluateOutcome(a,b,c)},purchaseNewSubscriptionOutcomeListener:function(a,b,c){this.evaluateOutcome(a,b,c)},purchaseHardGoodOutcomeListener:function(a,b,c){this.evaluateOutcome(a,b,c)},changePlanOutcomeListener:function(a,b,c){this.evaluateOutcome(a,b,c)},upgradeDeviceOutcomeListener:function(a,b,c){this.evaluateOutcome(a,b,c)},evaluateOutcome:function(a,b,c){var d=b.getCurrentOutcome();this.evaluateOutcomeById(a,d,c)},evaluateOutcomeById:function(a,b,c){var d=a.getVM("businesswidget/repository/common/viewmodel/CartRulesExecutorViewModel");switch(b){case this.rulesHelperVM.OUTCOME_ID.INSTALLATION_ADDRESS_REQUIRED:d.handleAction("checkInstallationAddress");break;case this.rulesHelperVM.OUTCOME_ID.MANDATORY_CONFIGURATION_REQUIRED:this.rulesHelperVM.setFlowNameInContext(a,"InProductOrderItem"),d.handleAction("checkMandatoryConfiguration");break;case this.rulesHelperVM.OUTCOME_ID.CONFIGURATION_REQUIRED_FOR_MANDATORY_WITHOUT_DEFAULT:d.handleAction("checkConfigurationRequiredForMandatoryWithoutDefault");break;case this.rulesHelperVM.OUTCOME_ID.EQUIPMENT_CONFIGURATION_REQUIRED:d.handleAction("checkEquipmentNeeded");break;case this.rulesHelperVM.OUTCOME_ID.ELIGIBILITY_CHECK_REQUIRED:d.handleAction("checkEligibility");break;case this.rulesHelperVM.OUTCOME_ID.CART_READY:this.executeCartReadyRule();break;case this.rulesHelperVM.OUTCOME_ID.CUSTOMER_REQUIRED:d.handleAction("checkCustomer");break;case this.rulesHelperVM.OUTCOME_ID.CHECKOUT_VALIDATION_FAILED:console.log("validation failed");break;case this.rulesHelperVM.OUTCOME_ID.CHECKOUT_SUCCESS:k.handleAction("checkout");break;case this.rulesHelperVM.OUTCOME_ID.AUTO_PAY_REQUIRED:d.handleAction("autoPay");break;case this.rulesHelperVM.OUTCOME_ID.MANDATORY_BUNDLE_CONFIGURATION_REQUIRED:d.handleAction("mandatoryBundleConfMissing");break;case this.rulesHelperVM.OUTCOME_ID.BUNDLE_PRODUCT_MISSING_MANDATORY_CONFIGURATION:k.handleAction("bundleProductMissingMandatoryConfiguration");break;default:console.log("No match found")}},setCartReadyToRender:function(a){this.set("cartReadyToRender",a)},isCartReadyToRender:function(){return this.get("cartReadyToRender")},isNullOrUndefined:function(a){return this.rulesHelperVM.isNullOrUndefined(a)},getCustomerIdFromAppContext:function(a){return this.rulesHelperVM.getCustomerIdFromAppContext(a)},getAssignedProductIDFromAppContext:function(a){return this.rulesHelperVM.getAssignedProductIDFromAppContext(a)},getDeviceAssignedProductIDFromAppContext:function(a){return this.rulesHelperVM.getDeviceAssignedProductIDFromAppContext(a)},getSelectedItems:function(a){return this.rulesHelperVM.getSelectedItems(a)},isChangePlanFlow:function(a,b,c){return this.rulesHelperVM.isChangePlanFlow(a,b,c)},isUpgradeDeviceFlow:function(a,b,c){return this.rulesHelperVM.isUpgradeDeviceFlow(a,b,c)},isUpgradeDeviceAndChangePlanFlow:function(a,b,c){return this.rulesHelperVM.isUpgradeDeviceAndChangePlanFlow(a,b,c)},getSalesChannel:function(){return this.get("salesChannel")},setSalesChannel:function(a){this.set("salesChannel",a)},getLocale:function(){return this.get("locale")},setLocale:function(a){this.set("locale",a)},setDefaultFlowExecutorData:function(a){a.setSalesChannel(this.getSalesChannel()),a.setLocale(this.getLocale())},getHardGoodDetailsToUpdate:function(a){return this.rulesHelperVM.getHardGoodDetailsToUpdate(a)}})});
define("businesswidget/repository/common/viewmodel/MicroCartCustomizedDynamicViewModel",["lightsaber","knockout","Configuration","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/BrowsingCategoryStructuresModel","single!businesswidget/repository/common/viewmodel/CartRulesExecutorViewModel","single!businesswidget/repository/common/viewmodel/ItemListTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel"],function (a,b,c,d,e,f,g,h){return b.extenders.numeric=function(a,c){var d=b.computed({read:a,write:function(b){var c=a();/^\d*(\.\d{0,2})?$/.test(b)&&b>=0?a(b):(a(null),a(c))}}).extend({notify:"always"});return d(a()),d},a.UI.DynamicViewModel.extend({models:{customerProductOrderItemProductConfigurationModel:d,browsingCategoryStructuresModel:e},config:{mapping:{observe:["infoTooltipVisible, isManagePricingLinkEnabled","overrideNewPriceValidated","overrideReasonValidated"]}},subViewModels:{cartRulesExecutorViewModel:f,itemListTopicVM:g,productConfigurationTopicVM:h},defaults:{managePricingMicroCartMode:!1,infoTooltipVisible:!1,isManagePricingLinkDisabled:!1,isManagePricingLinkVisible:c.get("MicroCart_ManagePricing_isManagePricingLinkVisible"),productLevelDisableManagePriceLink:!1,overrideReason:null,allowedOverrideType:null,overrideNewPriceValidated:!0,overrideReasonValidated:!0,patternTxtBox:b.observable().extend({numeric:0}),CART_INFO:{PACKAGE:"TV_PACKAGE",CHANNEL:"TV_CHANNEL",SERVICE:"SERVICE",ACTION_TYPE_CHANGE_PRODUCT:"CHANGE_PRODUCT",ACTION_TYPE_ADD_PRODUCT:"ADD_PRODUCT"}},showBundleToolTip:function(a,b,c,d,e){c.isBalloonBundleName(!b.isBalloonBundleName)},showProductToolTip:function(a,b,c,d,e){c.isBalloonProductName(!b.isBalloonProductName)},showSubComponentToolTip:function(a,b,c,d,e){c.isBalloonComponentName(!b.isBalloonComponentName)},showBOToolTip:function(a,b,c,d,e){c.isBalloonBOName(!b.isBalloonBOName)},refreshCart:function(a,b,c,d,e){this.trigger("RefreshMicroCart")},inverseToolTip:function(a,b){var c=$(a).offset().top-$(window).scrollTop(),d=$("#managePricing_"+b.billingOfferTooltipID);return $(d).innerHeight()+$(a).height()<=c-60},setFlowNameInContext:function(){this.subViewModels.productConfigurationTopicVM.set("flowName","InProductOrderItem"),this.subViewModels.productConfigurationTopicVM.set("containedProductSpecID",null)},resetWaiveOverridePrice:function(a,b,c,d,e){var f,g,h,i=e&&e.overridePriceType;"onetime"==i?(b.oneTimeOverrideReason,h=b.oneTimePriceOverrideType,f=b.oneTimeOriginalAmount,g=f):"recurring"==i&&(b.recurringCalculatedOverrideReason,h=b.recurringCalculatedPriceOverrideType,f=b.recurringCalculatedOriginalAmount,g=f);var j={billingOfferID:b.managePricingID,parentTemporaryID:b.parentTemporaryID,parentProductSpecContainmentID:b.parentProductSpecContainmentID,productSpecPricingID:b.productSpecPricingID,productOrderItemID:b.productOrderItemID,productID:b.productID,overridePriceType:i,allowedOverrideType:h,originalAmount:f,newPrice:g,billingOfferIdentifier:b.billingOfferID};this.trigger("resetWaiveOrOverride",j)},updateWaiveOrOverride:function(a,b,c,d){if(""==this.get("patternTxtBox")?this.set("overrideNewPriceValidated",!1):this.set("overrideNewPriceValidated",!0),"default"==c.reason?this.set("overrideReasonValidated",!1):this.set("overrideReasonValidated",!0),""!=this.get("patternTxtBox")&&"default"!=c.reason){var e=this.get("waiveOrOverrideData");e&&(e.newPrice=this.get("patternTxtBox"),e.overrideReasonFreeText=c.AddedComment,e.overrideReason=c.reason),this.trigger("updateAndCloseWaiveOrOverride",e)}},renderWaiveOverridePopUp:function(a,b,c,d,e){var f,g,h,i,j=e&&e.overridePriceType;"onetime"==j?(f=b.oneTimeOverrideReason,i=b.oneTimePriceOverrideType,g=b.oneTimeOriginalAmount,h=b.oneTimeOverrideAmount):"recurring"==j&&(f=b.recurringCalculatedOverrideReason,i=b.recurringCalculatedPriceOverrideType,g=b.recurringCalculatedOriginalAmount,h=b.recurringCalculatedOverrideAmount),f||(f="O");var k={billingOfferID:b.id,billingOfferIdentifier:b.billingOfferID,parentTemporaryID:b.parentTemporaryID,parentProductSpecContainmentID:b.parentProductSpecContainmentID,productSpecPricingID:b.productSpecPricingID,productOrderItemID:b.productOrderItemID,productID:b.productID,overridePriceType:j,allowedOverrideType:i,originalAmount:g,managePricingID:b.managePricingID};this.set("originalAmount",g),this.set("overrideAmount",h),this.set("waiveAndOverrideHeader",this.getString("cm_ManagePricing_WaiveAndOverride_Title_"+i)),this.set("allowedOverrideType",i),this.set("waiveOrOverrideData",k,!0),"W"==i?this.set("patternTxtBox","0"):"O"==i&&this.set("patternTxtBox",""),this.trigger("renderWaiveOverridePopUp",b.id+"_"+j)},addChannelOrPackage:function(a,b,c){var d={lo:this.get("locale"),sc:this.get("salesChannel")};this.set("isChannel",a),this.subViewModels.productConfigurationTopicVM.set("productID",c),this.models.browsingCategoryStructuresModel.setQueryParams(d),this.models.browsingCategoryStructuresModel.fetch({success:_.bind(this._onBrowsingCategoryStructuresFetchSuccess,this),error:_.bind(this._onBrowsingCategoryStructuresFetchError,this)})},_onBrowsingCategoryStructuresFetchSuccess:function(a,b){var c=a.get("Categories");c.categories&&0!=c.categories.length&&this._parseCategoryStructure(c.categories)},_onBrowsingCategoryStructuresFetchError:function(a,b){this.set("loadingState",!1)},_parseCategoryStructure:function(a){var b,c,d=this;this.get("isChannel")?(b=this.getString("cm_MyProductandServices_aLaCarteChannels"),c="addAnotherTvChannel"):(b=this.getString("cm_MyProductandServices_themePacks"),c="addAnotherTvPackage");for(var e=0;e<a.length;e++)if(a[e].name===d.getString("TV"))for(var f=a[e].childCategories,g=0;g<f.length;g++)if(f[g].name===b)return d.subViewModels.itemListTopicVM.set("browsingCategoryStructureID",f[g].structureID),void this.subViewModels.cartRulesExecutorViewModel.trigger(c)},isNewlyAdded:function(a){var b=a.header;return!(b!=this.get("CART_INFO").CHANNEL&&b!=this.get("CART_INFO").PACKAGE&&!a.isReceiver||_.isEmpty(a.action))},isNewlyAddedReceiver:function(a){return!(!a.isReceiver||_.isEmpty(a.action)||a.actionType!==this.get("CART_INFO").ACTION_TYPE_CHANGE_PRODUCT)},isNewlyAddedService:function(a){return!(a.actionType!=this.get("CART_INFO").ACTION_TYPE_CHANGE_PRODUCT||!a.isInnerLevelDisplayableitem&&a.businessType!==this.get("CART_INFO").SERVICE)},showTVChannelOrPackage:function(a){var b,c,d,e,f,g;b="function"==typeof a.isTV?a.isTV():a.isTV,c="function"==typeof a.isReceiver?a.isReceiver():a.isReceiver,d="function"==typeof a.isLeafComponent?a.isLeafComponent():a.isLeafComponent,e="function"==typeof a.components?a.components():a.components,f="function"==typeof a.promotions?a.promotions():a.promotions,g="function"==typeof a.displayableBillingOffers?a.displayableBillingOffers():a.displayableBillingOffers;var h=!1;return b?(_.each(e,function(a){_.isEmpty(a.action)||(h=!0)}),h):c?this.showReceiver(e):a.isDevice?!!e[0].action:a.actionType===this.get("CART_INFO").ACTION_TYPE_CHANGE_PRODUCT?!(!(a.action||f&&f.length>0)&&(e&&e.length>0||g&&g.length?a.isDevice&&!e[0].action:!a.isComponentPricePresent)):a.actionType===this.get("CART_INFO").ACTION_TYPE_ADD_PRODUCT||!_.isUndefined(d)&&!d||!(!this.isService(a)||!a.action)},showReceiver:function(a){var b=!1;return _.each(a,function(a){_.isEmpty(a.action)||(b=!0)}),b},isService:function(a){return!!(!_.isEmpty(a.action)&&a.isInnerLevelDisplayableitem||a.businessType==this.get("CART_INFO").SERVICE||a.displayableBillingOffers&&a.displayableBillingOffers.length>0)},isChangedReceiver:function(a){return!(!a.isDevice&&!a.isReceiver||_.isEmpty(a.action))||!(!(a.displayableBillingOffers&&a.displayableBillingOffers.length>0)||_.isEmpty(a.action))}})});
define("businesswidget/repository/common/model/CustomerProductOrdersModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({id:"customerId",options:{url:"commerce/customer/:customerId/product-orders",rest:{"delete":{method:"DELETE",url:"commerce/customer/:customerId/product-orders"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},readPage:{supportsPagination:!0,supportsSorting:!0,names:{pageSize:"pageSize",pageStart:"start"}}}}})});
define("businesswidget/repository/common/model/CustomerProductOrderIdProductConfigurationsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/customer/:customerId/product-order-id/:productOrderId/product-configurations",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"PUT",payload:["ValidateAndUpdateMultiProductsConfigurationRequest"]},update:{payload:["ValidateAndUpdateMultiProductsConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerProductOrderIdProductConfigurationsModel",path:"businesswidget/repository/common/model/CustomerProductOrderIdProductConfigurationsModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/customer/:customerId/product-order-id/:productOrderId/product-configurations"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:'Configuration.get("locale")'},{key:"sc",value:'Configuration.get("salesChannel")'}],isJSON:!0}},create:{method:{value:"PUT",isDefault:!0,isMandatory:!0},payload:{value:["ValidateAndUpdateMultiProductsConfigurationRequest"]}},update:{payload:{value:["ValidateAndUpdateMultiProductsConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CommerceAnonymousProductOrderQuoteModel",["jquery","lightsaber","underscore","Configuration","businesswidget/repository/common/core/RESTModel"],function (a,b,c,d,e){return e.extend({options:{url:"commerce/anonymous/product-order/:productOrderId/quote",rest:{defaults:{qParams:{sc:d.get("salesChannel"),lo:d.get("locale")}},read:{method:"POST",contentType:"application/json",payload:["RetrieveQuoteRequest"]}}}})});
define("businesswidget/repository/common/model/CommerceAnonymousProductOrdersModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{url:"commerce/anonymous/product-orders",rest:{"delete":{method:"DELETE",url:"commerce/anonymous/product-orders"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}},readPage:{supportsPagination:!0,supportsSorting:!0,names:{pageSize:"pageSize",pageStart:"start"}}}},id:"productOrderId"})});
define("businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["publishedSelectedResource","selectedResourceCategory","supportPortinInContext","logicalResources","prevData","patternOper","patternTxtBox","proposeResourceStatus","isReserveResourceSucceed"],historyAttrs:["publishedSelectedResource","logicalResources","prevData","proposeResourceStatus","isReserveResourceSucceed"],defaults:{publishedSelectedResource:null,selectedResourceCategory:null,supportPortinInContext:!1,logicalResources:null,prevNumbers:null,patternOper:null,patternTxtBox:null,prevData:null,proposeResourceStatus:null,isReserveResourceSucceed:!0},restoreFromUrl:function(a){var b=a.prevData,c=a.publishedSelectedResource;b&&(this.set("prevData",b),this.set("logicalResources",b.logicalResources)),this.set("publishedSelectedResource",c)}})});
define("businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{url:"commerce/anonymous/product-order/:productOrderId/product-order-items",rest:{"delete":{method:"DELETE",url:"commerce/anonymous/product-order/:productOrderId/product-order-items"},read:{method:"GET",url:"commerce/anonymous/product-order/:productOrderId/product-order-items"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")}}}},id:"productOrderId"})});
define("businesswidget/repository/common/model/DomainModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){return c.extend({options:{url:"commerce/reference-data/domain/:domainName",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}}})});
define("businesswidget/repository/common/model/AnonymousProductOrderIdProductConfigurationsModel",["businesswidget/repository/common/core/RESTModel","underscore","businesswidget/repository/common/core/Configuration"],function (a,b,c){var d=a.extend({options:{url:"commerce/anonymous/product-order-id/:productOrderId/product-configurations",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}},create:{method:"PUT",payload:["ValidateAndUpdateMultiProductsConfigurationRequest"]},update:{payload:["ValidateAndUpdateMultiProductsConfigurationRequest"]}}}}),e=d.extend({}),f={parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"AnonymousProductOrderIdProductConfigurationsModel",path:"businesswidget/repository/common/model/AnonymousProductOrderIdProductConfigurationsModel.js",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"},{variable:"_",pathName:"underscore"},{variable:"Configuration",pathName:"exclude!businesswidget/repository/common/core/Configuration"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"commerce/anonymous/product-order-id/:productOrderId/product-configurations"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{qParams:{value:[{key:"lo",value:'Configuration.get("locale")'},{key:"sc",value:'Configuration.get("salesChannel")'}],isJSON:!0}},create:{method:{value:"PUT",isDefault:!0,isMandatory:!0},payload:{value:["ValidateAndUpdateMultiProductsConfigurationRequest"]}},update:{payload:{value:["ValidateAndUpdateMultiProductsConfigurationRequest"]}}}},validations:[],methods:{}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/DevicesAccessoriesTopicViewModel",["lightsaber"],function (a){return a.Core.ObservableViewModel.extend({defaults:{widgetID:null,widgetName:null,selectedDeviceList:null,numOfSubscriptions:0,customerID:null,eligibleSubscriptions:0,payChannelType:null,enforceEligibility:!0,planCategories:[],planCategoryId:null}})});
define("businesswidget/repository/common/viewmodel/SelectPlanFromDeviceViewModel",["underscore","jquery","lightsaber","knockout","businesswidget/repository_l9_common/common/core/Configuration","businesswidget/repository/common/model/CommerceProductOfferingModel","businesswidget/repository/common/model/CatalogItemRetrieveRelatedItemsModel","businesswidget/repository/common/model/AnonymousCatalogItemRetrieveRelatedItemsModel","single!businesswidget/repository/common/viewmodel/DevicesAccessoriesTopicViewModel","single!businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k){return c.Core.ObservableViewModel.extend({defaults:{addedItem:[],showBack:!1,showStartOver:!1,showItemList:!0,showCompareItems:!1,showDetails:!1,showErrorMsg:!1,isDoneButtonDisable:!0,applyAll:!1,planSelectionErrorMsg:"",customeID:null,locale:null,salesChannel:null,payChannelType:1},config:{actions:{cancelClick:function(a){this.onCancelClick(a)},continueClick:function(a){this.onContinueCilck(a)},onDoneClick:this.onDoneClick}},models:{commerceProductOfferingModel:f,catalogItemRetrieveRelatedItemsModel:g,anonymousCatalogItemRetrieveRelatedItemsModel:h},subViewModels:{customerInContextTopicVM:k,applicationInContextTopicVM:j,devicesAccessoriesTopicViewModel:i},dataBindings:[{customerId:"subViewModels.customerInContextTopicVM.ID",options:{twoWay:!0,setOnBind:!0}},{locale:"subViewModels.applicationInContextTopicVM.locale",options:{twoWay:!0,setOnBind:!0}},{salesChannel:"subViewModels.applicationInContextTopicVM.salesChannel",options:{twoWay:!0,setOnBind:!0}},{payChannelType:"subViewModels.devicesAccessoriesTopicViewModel.payChannelType",options:{twoWay:!0,setOnBind:!0}},{planCategories:"subViewModels.devicesAccessoriesTopicViewModel.planCategories",options:{twoWay:!1,setOnBind:!0}},{planCategoryId:"subViewModels.devicesAccessoriesTopicViewModel.planCategoryId",options:{twoWay:!1,setOnBind:!0}}],initialize:function(b){this._super(b),a.bindAll(this,"onDoneClick","addItem","removeItem","_getRelatedItemsRequest","getWirelessProduct","onYesClick","onNoClick","getSelectedPlansArray","_setProductOfferingInfo","resetData","_onRetrieveRelateditemsFetchSuccess","_onRetrieveRelateditemsFetchError","_onProductOfferingDetailsSuccess","_onProductOfferingDetailsError","_onRetrieveProductOfferingDetailsSuccess","setConfigurations"),this.CATALOG_ITEM={BUSINESS_TYPE:{PLAN:"PLAN",OFFERING:"OFFERING"}}},setConfigurations:function(){var b=this.get("payChannelType");(a.isNull(b)||a.isEmpty(b))&&this.set("payChannelType",e.get("MicroCart_AgentView_payChannelType"))},onDoneClick:function(a,c){var d=this.options.___parent.get("selectedDeviceList"),e=this.options.___parent.get("currentIndex"),f=d[e].quantity,c=c&&b.isArray(c)?c:this.get("addedItem");this.set("addedItem",c);var g,h,i=(c[0].productOffering.products,this.getWirelessProduct(c[0])),j=(this.options.___parent.get("enforceEligibility"),this.options.___parent.get("eligibleSubscriptions"),this.options.___parent.get("numOfSubscriptions"),d[e]),a=1==a?a:this.get("applyAll");if(this.isMultiLineItem(c[0])&&(g=i.maximumQuantity),c.length>1)this.set("planSelectionErrorMsg",this.getString("ShoppingBasket_selectPlanErrorMsgOnePlan")),this.trigger("validationFailed");else if(f>g&&this.isMultiLineItem(c[0]))this.set("planSelectionErrorMsg",this.getString("ShoppingBasket_selectPlanErrorMsgOnePlanMoreDevices",[g,f,f])),this.trigger("validationFailed");else if(c[0].bundle&&this.options.___parent.isPlanAlreadyUsed(c[0],e))this.options.___parent.canAddMoreLineToBundle(c[0],f)?this.trigger("showWarning"):(this.set("planSelectionErrorMsg",this.getString("ShoppingBasket_selectPlanErrorMsgSamePlanMoreDevices",[i.maximumQuantity,h])),this.trigger("validationFailed"));else if(1==a||"true"===a)j.planSelected||this.options.___parent.removeAddPlanItem(e,c[0]),this.fetchOfferDetails(this.getItemOfferingID(c[0]));else{var k=this;setTimeout(function(){k.trigger("close:popup")},10),this.options.___parent.removeAddPlanItem(e,c[0])}},isMultiLineItem:function(b){return b.businessType===this.CATALOG_ITEM.BUSINESS_TYPE.PLAN?"YES"===b.sharedPlan||!!a.find(b.products,function(a){return a.maximumQuantity>a.minimumQuantity}):b.bundle},isBundleInUse:function(a){for(var b,c=!1,d=this.options.___parent.get("selectedDeviceList"),e=this.get("addedItem")[0],f=0;f<d.length;f++)if(d[f].planSelected&&d[f].planSelected.catalogItemID===e.catalogItemID){b=d[f],c=!0;break}return a?b:c},applyToAll:function(a){return!0},fetchOfferDetails:function(a){this.models.commerceProductOfferingModel.set({productOfferingID:a}),this.models.commerceProductOfferingModel.setQueryParams({sc:"RT"}),this.models.commerceProductOfferingModel.fetch({success:this._onProductOfferingDetailsSuccess,error:this._onProductOfferingDetailsError})},_onProductOfferingDetailsSuccess:function(b,c){var d=c.ProductOffering;d.catalogItemID=c.ProductOffering.id;for(var e=this.get("addedItem"),f=(this.getWirelessProduct(e[0]),0);f<d.products.length;f++)"WS"===d.products[f].lob&&(e[0].WLProductId=d.products[f].id,e[0].offeringToProductId=d.products[f].offeringToProductId);var g=this._getRelatedItemsQueryParams(e[0]);if(this.options.___parent.isAnonymousCustomer()){var h=this._getRelatedItemsRequest(e[0]);this.models.anonymousCatalogItemRetrieveRelatedItemsModel.setAttribute("catalogItemId",e[0].WLProductId),this.models.anonymousCatalogItemRetrieveRelatedItemsModel.dataSource.setQueryParams(g),this.models.anonymousCatalogItemRetrieveRelatedItemsModel.payload={RelatedItemsRequest:h},this.models.anonymousCatalogItemRetrieveRelatedItemsModel.fetch({success:a.bind(this._onRetrieveRelateditemsFetchSuccess,this),error:a.bind(this._onRetrieveRelateditemsFetchError,this)})}else{var h=this._getRelatedItemsRequest(e[0]);this.models.catalogItemRetrieveRelatedItemsModel.setAttribute("customerId",this.get("customerId")),this.models.catalogItemRetrieveRelatedItemsModel.setAttribute("catalogItemId",e[0].WLProductId),this.models.catalogItemRetrieveRelatedItemsModel.dataSource.setQueryParams(g),this.models.catalogItemRetrieveRelatedItemsModel.payload={RelatedItemsRequest:h},this.models.catalogItemRetrieveRelatedItemsModel.fetch({success:a.bind(this._onRetrieveRelateditemsFetchSuccess,this),error:a.bind(this._onRetrieveRelateditemsFetchError,this)})}this.get("addedItem",e)},_onProductOfferingDetailsError:function(){},_onRetrieveRelateditemsFetchSuccess:function(b,c,d){this.set("moreResultsAvailable",d.moreSearchResultsAvailable);var f,g=this.options.___parent.get("selectedDeviceList"),h=[],i=this.options.___parent.get("currentIndex"),j=(g[i].quantity,this.get("addedItem")[0]),k=c;if(this.options.___parent.get("numOfSubscriptions"),this.options.___parent.get("eligibleSubscriptions"),j.bundle){f=this.getWirelessProduct(j),f.maximumQuantity,g[i].planSelected=j,f.quantity=g[i].quantity;for(var l=0;l<g.length;l++)if(a.isEmpty(g[l].planSelected)||a.isNull(g[l].planSelected))for(var m=0;m<k.length;m++)g[l].planSelected||g[l].catalogItem.catalogItemID!==k[m].catalogItemID||g[l].catalogItem.businessType!==e.get("businessType_DEVICE_MD")||(g[l].planSelected=j,g[l].idx=l,h.push(g[l]))}else for(var l=0;l<g.length;l++)if(!g[l].planSelected)for(var m=0;m<k.length;m++)g[l].planSelected||g[l].catalogItem.catalogItemID!==k[m].catalogItemID||g[l].catalogItem.businessType!==e.get("businessType_DEVICE_MD")||(g[l].planSelected=j,g[l].idx=l,h.push(g[l]));for(var n=0;n<h.length;n++){var i=h[n].idx;delete h[n].idx,this.options.___parent.set("currentIndex",i),this.options.___parent.removeAddPlanItem(i,j)}this.trigger("close:popup")},getWirelessProduct:function(a){for(var b,c=a.productOffering.products,d=0;d<c.length;d++)"WS"===c[d].lob&&!1===c[d].sharedProduct&&(b=c[d]);return b},_onRetrieveRelateditemsFetchError:function(){},_getRelatedItemsRequest:function(a){return{text:null,filterFacets:[],offeringId:this.getItemOfferingID(a),offeringToProductId:this.getItemOfferingToProductID(a),browsingCategoryStructureId:"5567898",includeEligibleOfferingOnly:!0,sortType:"NAME",sortAscending:!0,hgpresentmentLevel:null}},_getRelatedItemsQueryParams:function(){return{relation:"SELECT_DEVICE",lo:this.get("locale"),sc:this.get("salesChannel")}},onCancelClick:function(){this.trigger("close:popup")},isItemAdded:function(a){for(var b=this.get("addedItem"),c=0;c<b.length;c++)if(b[c].catalogItemID===a)return!0;return!1},addItem:function(a){var b=this,c=a;if(a.catalogItemID&&c.productOffering){var d=c.productOffering;d.catalogItemID=c.productOffering.id,this._setProductOfferingInfo(d);var e=b.get("addedItem");c.familyPlan=!(!this.isMultiLineItem(a)||1!==a.lob.length),e.push(c),this.set("addedItem",e),this.set("isDoneButtonDisable",e.length<=0)}else a.businessType===this.CATALOG_ITEM.BUSINESS_TYPE.PLAN&&(this.models.commerceProductOfferingModel.set({productOfferingID:this.getItemOfferingID(a)}),this.models.commerceProductOfferingModel.fetch({success:this._onRetrieveProductOfferingDetailsSuccess,error:this._onProductOfferingDetailsError
}),this.set("itemToAdd",c))},_onRetrieveProductOfferingDetailsSuccess:function(a,b){var c=this.get("itemToAdd");c.productOffering=b.ProductOffering,c.productOffering.catalogItemID=b.ProductOffering.id,this._setProductOfferingInfo(c.productOffering);var d=this.get("addedItem");c.familyPlan=!(!this.isMultiLineItem(c)||1!==c.lob.length),d.push(c),this.set("addedItem",d),this.set("isDoneButtonDisable",d.length<=0)},removeItem:function(a){for(var b=this,c=b.get("addedItem"),d=0;d<c.length;d++)c[d].catalogItemID===a.catalogItemID&&(c[d],c.splice(d,1));b.set("addedItem",c),this.set("isDoneButtonDisable",c.length<=0)},_setProductOfferingInfo:function(a){var b=0,c=0;for(var e in a.products){!1===a.products[e].sharedProduct&&c++;var f=a.products[e];a.products[e].lob&&!a.products[e].sharedProduct&&(b=Number(b)+Number(f.minimumQuantity)),a.products[e].quantity=Number(a.products[e].minimumQuantity),a.products[e].minimumQuantity=Number(a.products[e].minimumQuantity),a.products[e].maximumQuantity=Number(a.products[e].maximumQuantity),a.products[e].catalogItemID=a.catalogItemID,a.products[e].showButtons=a.products[e].minimumQuantity!=a.products[e].maximumQuantity,"Equipment"===a.products[e].name&&(a.products[e].lob="EQ",a.products[e].lobImage="resources/images/lob/Equipment.svg",a.products[e].lobName="Equipment")}a.selected=d.observable(!1),a.quantity=b},getItemOfferingID:function(a){return a.businessType===this.CATALOG_ITEM.BUSINESS_TYPE.PLAN&&a.containingOfferings&&a.containingOfferings.length>0&&a.containingOfferings[0].offeringId?a.containingOfferings[0].offeringId:a.catalogItemID},getItemOfferingToProductID:function(a){return a.businessType===this.CATALOG_ITEM.BUSINESS_TYPE.PLAN&&a.containingOfferings&&a.containingOfferings.length>0&&a.containingOfferings[0].offeringToProductIds&&a.containingOfferings[0].offeringToProductIds.length>0?a.containingOfferings[0].offeringToProductIds[0]:a.offeringToProductId},getSelectedPlansArray:function(){var a=this.get("addedItem"),b=[];for(var c in a)b.push(a[c].catalogItemID);return b},onYesClick:function(a){var b=this.get("addedItem"),a=1==a?a:this.get("applyAll"),c=this.options.___parent.get("currentIndex"),d=this.options.___parent.get("selectedDeviceList"),e=d[c];if(1==a||"true"===a)e.planSelected||this.options.___parent.removeAddPlanItem(c,b[0]),this.fetchOfferDetails(this.getItemOfferingID(b[0]));else{var f=this;setTimeout(function(){f.trigger("close:popup")},10),this.options.___parent.removeAddPlanItem(c,b[0])}},onNoClick:function(){this.trigger("close:warningPopup")},resetData:function(){this.set({addedItem:[],showBack:!1,showStartOver:!1,showItemList:!0,showCompareItems:!1,showDetails:!1,showErrorMsg:!1,isDoneButtonDisable:!0,applyAll:!1,planCategoryId:this.subViewModels.devicesAccessoriesTopicViewModel.get("planCategoryId"),planSelectionErrorMsg:""})},destroy:function(){this.resetData(),this._super()}})});
define("businesswidget/repository/common/model/CreateProvideOrderAnonymousModel",["underscore","lightsaber"],function (a,b){return b.Core.RESTModel.extend({options:{url:"/commerce/anonymous/product-order",rest:{create:{method:"POST",contentType:"application/json",payload:["CreateNewProductOrderRequest"]}}},initialize:function(){a.bindAll(this),this._super()}})});
define("businesswidget/repository/common/viewmodel/ShoppingBasketViewModel",["lightsaber","underscore","knockout","knockout.mapping","businesswidget/repository_l9_common/common/core/Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","businesswidget/repository_l9_common/common/utils/ImplUtil","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","businesswidget/repository/common/viewmodel/SelectPlanFromDeviceViewModel","single!businesswidget/repository/common/viewmodel/DevicesAccessoriesTopicViewModel","single!businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","single!businesswidget/repository/common/viewmodel/ExceptionTopicViewModel","single!businesswidget/repository/common/viewmodel/ReserveItemTopicViewModel","businesswidget/repository/common/model/CreateProvideOrderModel","businesswidget/repository/common/model/CreateProvideOrderAnonymousModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationOptionsModel","businesswidget/repository/common/model/CustomerProductOrdersModel","businesswidget/repository/common/model/CommerceAnonymousProductOrdersModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderQuoteModel","businesswidget/repository/common/model/CustomerProductOrderQuoteModel","businesswidget/repository/common/model/CommerceCustomerHardGoodSpecProductOrderModel","businesswidget/repository/common/model/CommerceAnonymousHardGoodSpecProductOrderModel","businesswidget/repository/common/model/CancelReservationModel"],function (a,b,c,d,e,f,g,h,i,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){return a.Core.ObservableViewModel.extend({defaults:{widgetTitleSmall:null,eligibleSubscriptions:0,selectedDeviceList:[],itemsAvailQty:{},allowedSubscriptions:0,numOfSubscriptions:0,currentIndex:-1,customerId:null,locale:null,salesChannel:null,payChannelType:null,selectedDeviceList:[],enforceEligibility:!1,eligibleSubscriptions:0,orderID:null,orderRefID:null,showWidgetTitle:!1,devicesPanelExpand:!1,displayPriceOnly:!1,displayPlanOnly:!1,displayActions:!1,displayall:!1,accessoriesPanelExpand:!0,totalSummaryPrice:0,totalAccessoriesPrice:0,totalDevicePrices:0,totalrecurringPrice:0},subViewModels:{customerInContextTopicVM:h,applicationInContextTopicVM:m,devicesAccessoriesTopicViewModel:l,productOrderTopicViewModel:n,exceptionTopicViewModel:o},dataBindings:[{customerId:"subViewModels.customerInContextTopicVM.ID",options:{twoWay:!0,setOnBind:!0}},{locale:"subViewModels.applicationInContextTopicVM.locale",options:{twoWay:!1,setOnBind:!0}},{salesChannel:"subViewModels.applicationInContextTopicVM.salesChannel",options:{twoWay:!1,setOnBind:!0}},{payChannelType:"subViewModels.devicesAccessoriesTopicViewModel.payChannelType",options:{twoWay:!0,setOnBind:!0}},{selectedDeviceAccList:"subViewModels.devicesAccessoriesTopicViewModel.selectedDeviceList",options:{twoWay:!0,setOnBind:!0}},{enforceEligibility:"subViewModels.devicesAccessoriesTopicViewModel.enforceEligibility",options:{twoWay:!0,setOnBind:!0}},{eligibleSubscriptions:"subViewModels.devicesAccessoriesTopicViewModel.eligibleSubscriptions",options:{twoWay:!0,setOnBind:!0}},{orderID:"subViewModels.productOrderTopicViewModel.productOrderID",options:{twoWay:!0,setOnBind:!0}},{orderRefID:"subViewModels.productOrderTopicViewModel.productOrderReferenceNumber",options:{twoWay:!0,setOnBind:!0}}],initialize:function(a){this._super(a),b.bindAll(this,"setWidgetParameters","setSummaryPrices","getTotalPrice","setDisplayPricePlanMode","toggleMoreActionDropdown","clearMoreActionDropdown","splitLine","changePlan","removePlan","applyPlanToOtherDevice","updateSelectedDevice","deleteLine","setBehaviorParameters","getShowActions","getDeleteAction","selectPlanStatus","selectPlan","incrementQuantity","decrementQuantity","enableDecreaseBtn","enableIncreaseBtn","isPlanSingle","getPlanMaxSubscriptions","getPlanMinSubscriptions","getPlanTotalDeviceCount","getTotalDeviceCount","addCatalogItem","removeCatalogItem","usedSubscriptions","currentDeviceList","_onCreateProvideOrderFetchSuccess","getPlanTotalDeviceCount","sortSelectedDeviceList","addIncreaseAndPlanFlagToSelectedDeviceList","getPlanProductID","getNewOrderItems","publishDeviceAccessoriesTopic","isPlanAlreadyUsed","canAddMoreLineToBundle","getWLProduct","setOrdeItemToDeviceList","getAddProductToPlanRequest","removeCartForNonAnonymous","removeCartForAnonymous","getPayloadForSingleLinePlan","_publishError","setConfigurations","isAnonymousCustomer","getWLOrderItemsDeviceCount","updateAllPlanRelatedDevices","getPlanRelatedDevice","removeDeviceAction","removeAllProductOrderItems","clearCartForNonAnonymous","clearCart","clearCartForAnonymous","_onClearCartSuccess","_onClearCartError","getProductOrderItemsNonAnonymous","getProductOrderItemsAnonymous","addDeleteSubscriptionDeviceAnonymous","_onRetrieveRelateditemsFetchSuccess","_onRetrieveRelateditemsFetchError","_publishOrderDetail","isArrayOfHardGoodToBeAdded","setHardGoodOrderItems","_onFetchProductOrderQuoteSuccess","_onFetchProductOrderQuoteError","fetchProductOrderQuoteModel","setOrderItemsPrices","_onRemoveCartSuccess","_onRemoveCartError","getSamePlanDevices","planHasMinDevices","deleteNonDeviceLines"),this.CATALOG_ITEM={BUSINESS_TYPE:{PLAN:"PLAN",OFFERING:"OFFERING"}},this.setWidgetParameters(),this.createSubViewModels(),this.createModels(),this.off("change:selectedDeviceAccList",this.cartItemsChanged,this),this.on("change:selectedDeviceAccList",this.cartItemsChanged,this),this.subViewModels.devicesAccessoriesTopicViewModel.off("action:clearCart",null,this),this.subViewModels.devicesAccessoriesTopicViewModel.on("action:clearCart",this.clearCart,this)},createModels:function(){this.models.createOrderModel=this.create("cm_microCartWidget_CreateOrderModel",q,{}),this.models.createProvideOrderAnonymousModel=this.create("cm_microCartWidget_CreateProvideOrderAnonymousModel",r,{}),this.models.customerProductOrderProductOrderItemsModel=this.create("cm_microCartWidget_CustomerProductOrderProductOrderItemsModel",s,{}),this.models.customerProductOrderItemProductConfigurationModel=this.create("cm_CustomerProductOrderItemProductConfigurationModel",u,{}),this.models.anonymousProductOrderItemProductConfigurationModel=this.create("cm_AnonymousProductOrderItemProductConfigurationModel",v,{}),this.models.customerProductOrderItemProductConfigurationOptionsModel=this.create("cm_CustomerProductOrderItemProductConfigurationOptionsModel",w,{}),this.models.commerceAnonymousProductOrderProductOrderItemModel=this.create("cm_CommerceAnonymousProductOrderProductOrderItemModel",z,{}),this.models.customerProductOrderQuoteModel=this.create("cm_CustomerProductOrderQuoteModel",B,{}),this.models.commerceAnonymousProductOrderQuoteModel=this.create("cm_CommerceAnonymousProductOrderQuoteModel",A,{}),this.models.commerceCustomerHardGoodSpecProductOrderModel=this.create("cm_CommerceCustomerHardGoodSpecProductOrderModel",C,{}),this.models.commerceAnonymousHardGoodSpecProductOrderModel=this.create("cm_CommerceAnonymousHardGoodSpecProductOrderModel",D,{}),this.models.cancelReservationModel=this.create("cm_cancelReservationModel",E,{})},cartItemsChanged:function(){if(this.set("currentIndex",-1),this.get("selectedDeviceAccList")){var a=this.getCreateNewProductOrderRequest(this.get("selectedDeviceAccList"));this.createUpdateOrder(a),a&&(this.addIncreaseAndPlanFlagToSelectedDeviceList(this.get("selectedDeviceAccList")),this.currentDeviceList(),this.usedSubscriptions())}},setConfigurations:function(){var a=this.get("locale"),c=this.get("salesChannel"),d=this.get("payChannelType");(b.isNull(a)||b.isEmpty(a))&&this.set("locale",e.get("locale")),(b.isNull(c)||b.isEmpty(c))&&this.set("salesChannel",e.get("salesChannel")),(b.isNull(d)||b.isEmpty(d))&&this.set("payChannelType",e.get("MicroCart_AgentView_payChannelType"))},createUpdateOrder:function(a){if(null!==a)return this.createUpdateOrderPromise=$.Deferred(),this.isAnonymousCustomer()?(this.models.createProvideOrderAnonymousModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),this.get("orderRefID")&&(a.orderReferenceNumber=this.get("orderRefID")),console.log("createProvideOrderAnonymousModel -save"),this.models.createProvideOrderAnonymousModel.save({CreateNewProductOrderRequest:a},{success:this._onCreateProvideOrderFetchSuccess,error:this._onCreateProvideOrderFetchError})):(this.models.createOrderModel.set("customerID",this.get("customerId")),this.models.createOrderModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),this.get("orderRefID")&&(a.orderReferenceNumber=this.get("orderRefID")),console.log("createOrderModel -save"),this.models.createOrderModel.save({CreateNewProductOrderRequest:a},{success:this._onCreateProvideOrderFetchSuccess,error:this._onCreateProvideOrderFetchError})),this.createUpdateOrderPromise.promise()},incrementDevice:function(a){return this.createUpdateOrder(this.getCreateNewProductOrderRequest([a],1))},createDeviceOrderItems:function(a){return this.createUpdateOrder(this.getCreateNewProductOrderRequest([a]))},getCreateNewProductOrderRequest:function(a,b){var c={},d=[],e=[],f=(this.get("eligibleSubscriptions"),this.get("numOfSubscriptions"),this.get("enforceEligibility"),this.get("currentIndex"));if($.isEmptyObject(a))return null;for(var h=a.length-1;h>=0;h--){var i=[],j=b||a[h].quantity,k=a[h].availableQuantity,l=a[h].planSelected;if(null==a[h].reservationDetails&&j>k)return this._publishError(this.getString("ShoppingBasket_selectPlan_ErrorMsg3")),null;if(l&&!$.isEmptyObject(l)){var m=l.productOffering.products;if(this.getWLProduct(l).minimumQuantity,!this.isPlanSingle(l)&&this.isPlanAlreadyUsed(l)&&!this.canAddMoreLineToBundle(l,j))return this._publishError(this.getString("ShoppingBasket_selectPlan_ErrorMsg1")),null;if(this.isPlanAlreadyUsed(l,f)&&!this.isPlanSingle(l))return this.getAddProductToPlanRequest(a[h],b);if(this.isPlanSingle(l))d=this.getPayloadForSingleLinePlan(a[h],j),j-=d.length;else{for(var n=0;n<m.length;n++){var o=m[n].minimumQuantity;j>m[n].minimumQuantity&&j<=m[n].maximumQuantity&&(o=j);for(var p=0;p<o;p++)if(m[n].sharedProduct||"WS"!==m[n].lob)i.push(this.getNewProductRequest(l,m[n],null));else{var q={},r=[{characteristicID:"56671131",value:a[h].reservationDetails?a[h].reservationDetails.reservationID:""},{characteristicID:"56671141",value:a[h].reservationDetails?a[h].reservationDetails.storeID:""}];j>0&&(q={newSimpleProducts:[{businessType:"DEVICE",simpleProductSpecID:a[h].catalogItem.catalogItemID,replaceDefault:!0,temporaryID:g.generateTemporaryId(),changedCharacteristics:a[h].reservationDetails?r:[]}]}),i.push(this.getNewProductRequest(l,m[n],q)),j--}}d.push({ID:this.getItemOfferingID(a[h].planSelected),newProducts:i})}if(j>0)throw"InvalidInput"}else for(var s=0;s<j;s++){var t=[{characteristicID:"56671131",value:a[h].reservationDetails?a[h].reservationDetails.reservationID:""},{characteristicID:"56671141",value:a[h].reservationDetails?a[h].reservationDetails.storeID:""}];e.push({simpleProductSpecID:a[h].catalogItem.catalogItemID,changedCharacteristics:a[h].reservationDetails?t:[]})}}return c.newOfferings=d,c.newSimpleProducts=e,c.returnConfiguration="ALL",c.returnConfigurationData={topLevelProductData:!0,catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0},c},getItemOfferingID:function(a){return a.businessType===this.CATALOG_ITEM.BUSINESS_TYPE.PLAN&&a.containingOfferings&&a.containingOfferings.length>0&&a.containingOfferings[0].offeringId?a.containingOfferings[0].offeringId:a.catalogItemID},getPlanPriceSchemaID:function(a){return a.businessType===this.CATALOG_ITEM.BUSINESS_TYPE.PLAN?a.catalogItemID:null},getNewProductRequest:function(a,b,c){var d=this.getPlanPriceSchemaID(a),e={productOfferingProductSpecID:b.offeringToProductId,temporaryID:g.generateTemporaryId()};if(c&&(e.productChanges=c),d){var f=a.productOffering.products;1===f.length?e.basicPriceSchemaID=d:f.length>1&&"WS"===b.lob&&b.sharedProduct&&(e.basicPriceSchemaID=d)}return e},createHardGoodOrder:function(a){a&&this.set("hardGoodDeviceCount",a),this.models.commerceCustomerHardGoodSpecProductOrderModel.set("customerId",this.get("customerId")),this.models.commerceCustomerHardGoodSpecProductOrderModel.set("hardGoodSpecId",this.get("selectedDeviceList")[this.getSelectedDeviceIndex()].catalogItem.catalogItemID);var c={quantity:1};this.get("orderID")&&(c.orderId=this.get("orderID")),console.log("commerceCustomerHardGoodSpecProductOrderModel - save"),this.models.commerceCustomerHardGoodSpecProductOrderModel.save({CreateNewHardGoodOrderRequest:c},{success:b.bind(this._onHardGoodOrderSuccess,this),error:b.bind(this._onHardGoodOrderError,this)})},_onHardGoodOrderSuccess:function(a,b){if(console.log("Success - _onHardGoodOrderSuccess commerceCustomerHardGoodSpecProductOrderModel - save"),b.CreateNewHardGoodOrderResponse){var c=b.CreateNewHardGoodOrderResponse.productOrderID,d=b.CreateNewHardGoodOrderResponse.productOrderReferenceNumber;this.set("orderRefID",d),this.set("orderID",c),this.set("hardGoodDeviceCount",this.get("hardGoodDeviceCount")-1),this.get("hardGoodDeviceCount")>0||this.loadProductOrderItemsData()}},_onHardGoodOrderError:function(a,b){console.error("Failed - _onHardGoodOrderSuccess commerceCustomerHardGoodSpecProductOrderModel - save")},getPayloadForSingleLinePlan:function(a,b){for(var c=b||a.quantity,d=[],e=this.getWLProduct(a.planSelected),f=[{characteristicID:"56671131",value:a.reservationDetails?a.reservationDetails.reservationID:""},{characteristicID:"56671141",value:a.reservationDetails?a.reservationDetails.storeID:""}],h=0;h<c;h++){var i={},j=[];i={newSimpleProducts:[{businessType:"DEVICE",simpleProductSpecID:a.catalogItem.catalogItemID,replaceDefault:!0,temporaryID:g.generateTemporaryId(),changedCharacteristics:a.reservationDetails?f:[]}]},j.push(this.getNewProductRequest(a.planSelected,e,i)),d.push({ID:this.getItemOfferingID(a.planSelected),newProducts:j})}return d},_onCreateProvideOrderFetchError:function(){console.error("Error - _onCreateProvideOrderFetchSuccess createProvideOrderAnonymousModel, createOrderModel- save")},_onCreateProvideOrderFetchSuccess:function(a,b){console.log("Success - _onCreateProvideOrderFetchSuccess createProvideOrderAnonymousModel, createOrderModel- save");var c=this;if(b.CreateNewProductOrderResponse){var d=b.CreateNewProductOrderResponse.productOrderID,e=b.CreateNewProductOrderResponse.productOrderReferenceNumber;this.set("orderRefID",e),this.set("orderID",d),this.trigger("order:created",{orderRefID:e,orderID:d});var f=this.get("selectedDeviceList"),g=this.get("currentIndex"),h=null;g>=0&&f[g].oldOrderItems&&(h=this.isAnonymousCustomer()?this.removeCartForAnonymous(f[g].oldOrderItems):this.removeCartForNonAnonymous(f[g].oldOrderItems),delete f[g].oldOrderItems,this.set("selectedDeviceList",f));var c=this;h?h.done(function(){c.loadProductOrderInfo(b,g)}):this.loadProductOrderInfo(b,g),this.createUpdateOrderPromise&&this.createUpdateOrderPromise.resolve()}},loadProductOrderInfo:function(a,b){if(a.CreateNewProductOrderResponse.newSimpleProductSpecInstances){a.CreateNewProductOrderResponse.productOfferingInstances=a.CreateNewProductOrderResponse.newSimpleProductSpecInstances;for(var c in a.CreateNewProductOrderResponse.productOfferingInstances)a.CreateNewProductOrderResponse.productOfferingInstances[c].productOfferingInstanceID=a.CreateNewProductOrderResponse.productOfferingInstances[c].productID}a.CreateNewProductOrderResponse.productOfferingInstances?(this.setOrdeItemToDeviceList(a,b),this.fetchProductOrderQuoteModel()):a.CreateNewProductOrderResponse.newProductsInOfferingInstances?(this.setOrdeItemToSelectedDevice(a,b),this.fetchProductOrderQuoteModel()):this.isAnonymousCustomer()?this.getProductOrderItemsAnonymous():this.getProductOrderItemsNonAnonymous()},_onRetrieveRelateditemsFetchSuccess:function(a,b){var c=this.get("selectedDeviceList"),d=!1,e=[];for(var f in b.ProductOrderItemHeaders.productOrderItemHeaders)"CANCELED"!=b.ProductOrderItemHeaders.productOrderItemHeaders[f].status&&e.push(b.ProductOrderItemHeaders.productOrderItemHeaders[f]);var g=this.get("currentIndex");if(g>=0)c[g].orderItems=this.getNewOrderItems(e);else for(var f=0;f<c.length;f++)if(c[f].orderItems||(d=!0),d){c[f].orderItems=this.getNewOrderItems(e),c[f].productID=e[0].productOfferingInstanceID;break}c[this.getSelectedDeviceIndex()].orderItems=this.getNewOrderItems(e),c[this.getSelectedDeviceIndex()],this.fetchNewOrderItemDetails(c[this.getSelectedDeviceIndex()].orderItems),this.currentDeviceList(),this.usedSubscriptions(),this.addIncreaseAndPlanFlagToSelectedDeviceList(),this._publishOrderDetail(e)},_publishOrderDetail:function(a,b){a=a||[];var c=this.subViewModels.productOrderTopicViewModel.get("productOrderItems");if(b){for(var d=0;d<b.length;d++)for(var e=0;e<c.length;e++)b[d]===c[e].productOrderItemID&&c.splice(e,1);a=c}else c&&$.merge(a,c);for(var e=0;e<a.length;e++)delete a[e].productConfiguration;var f={productOrderID:this.get("orderID"),productOrderReferenceNumber:this.get("orderRefID"),productOrderItems:a};this.subViewModels.productOrderTopicViewModel.set(f)},getNewOrderItems:function(a){var b,c=this.get("selectedDeviceList"),d=[],e=[],f=this.get("currentIndex");if(f>=0){b=c[f].productID;for(var g=0;g<c.length;g++)if(c[g].productID===a[g].productOfferingInstanceID){c[g].orderItems=c[g].orderItems||[],$.merge(e,c[g].orderItems);break}}else for(var g=0;g<c.length;g++)if(c[g].productID===a[g].productOfferingInstanceID){e=c[g].orderItems||[],b=c[g].productID;break}if(void 0!==b)for(j=0;j<a.length;j++)a[j].productOfferingInstanceID===b&&$.inArray(a[j].id,e)<0&&d.push(a[j].id);return $.merge(d,e),d.sort()},_onRetrieveRelateditemsFetchError:function(){console.error("_onRetrieveRelateditemsFetchError eror")},fetchNewOrderItemDetails:function(a){for(var c=0;c<a.length;c++)if(!this.isOrderItemDetailsExists(a[c])){this.models.customerProductOrderItemProductConfigurationOptionsModel.set({customerId:this.get("customerId"),productOrderItemId:a[c]}),this.models.customerProductOrderItemProductConfigurationOptionsModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")});var d={activityForConfiguration:"NegotiateProductConfiguration",returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",loadFirstStep:!1,stepIDs:[],serviceRequiredDate:null,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!1,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!1}};this.models.customerProductOrderItemProductConfigurationOptionsModel.set("RetrieveProductInOrderConfigurationRequest",d),console.log("customerProductOrderItemProductConfigurationOptionsModel - fetch"),this.models.customerProductOrderItemProductConfigurationOptionsModel.fetch({success:b.bind(this.onNewOrderItemDetailsSuccess,this),error:b.bind(this.onNewOrderItemDetailsError,this)})}},onNewOrderItemDetailsSuccess:function(a,b){console.log("Success - onNewOrderItemDetailsSuccess -> customerProductOrderItemProductConfigurationOptionsModel - fetch");var c=this.get("selectedDeviceList"),d=c[this.getSelectedDeviceIndex()];if(d.orderItemsDetails||(d.orderItemsDetails=[]),b&&b.RetrieveProductInOrderConfigurationResponse){var e=this.prepareSimpleProductInfo(b.RetrieveProductInOrderConfigurationResponse)[0];d.orderItems=d.orderItems||[],d.orderItems.push(e.productOrderItemID),d.orderItemsDetails.push(e),!1===e.selected&&(this.isAnonymousCustomer()?this.addDeleteSubscriptionDeviceAnonymous(d):this.addDeleteSubscriptionDevice(d))}this.updateAllPlanRelatedDevices(d,c)},onNewOrderItemDetailsError:function(a,b){console.error("Error - onNewOrderItemDetailsError customerProductOrderItemProductConfigurationOptionsModel - >orderItemsDetails retrieve failed for order-item-id: "+a.get("productOrderItemId"))},isOrderItemDetailsExists:function(a){var b=this.get("selectedDeviceList"),c=this.getSelectedDeviceIndex(),d=b[c];if(d.orderItemsDetails)for(var e=0;e<d.orderItemsDetails.length;e++)if(d.orderItemsDetails[e].productOrderItemID==a)return!0;return!1},getSelectedDeviceIndex:function(){var a=this.get("currentIndex");return a<0&&(a=this.get("selectedDeviceList").length-1),a},getAddProductToPlanRequest:function(a,b){var c=a.planSelected,d=0==b?b:b||a.quantity,e=this.getWLProduct(c),f=[],h=[],i={},j={};if(d>0)for(var k=0;k<d;k++){var l=[{characteristicID:"56671131",value:a.reservationDetails?a.reservationDetails.reservationID:""},{characteristicID:"56671141",value:a.reservationDetails?a.reservationDetails.storeID:""}],m={newSimpleProducts:[{businessType:"DEVICE",simpleProductSpecID:a.catalogItem.catalogItemID,replaceDefault:!0,temporaryID:g.generateTemporaryId(),changedCharacteristics:a.reservationDetails?l:[]}]};f.push(this.getNewProductRequest(c,e,m))}else f.push(this.getNewProductRequest(c,e,null));return i.id=this.getPlanProductID(c),i.newProducts=f,h.push(i),j.newProductsInOfferingInstances=h,j.returnConfiguration="ALL",j.returnConfigurationData={topLevelProductData:!0,catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0},console.log("--->Adding lines to existing plan New Lines Device Qty= "+d),j},isPlanAlreadyUsed:function(a,b){var c=this.get("selectedDeviceList"),d=!1;if(c)for(var e=0;e<c.length;e++)if(c[e].planSelected&&a.catalogItemID===c[e].planSelected.catalogItemID&&c[e].orderItems&&b!=e)return!0;return d},canAddMoreLineToBundle:function(a,b){for(var c=this.get("selectedDeviceList"),d=this.getWLProduct(a),e=d.maximumQuantity,f=(d.minimumQuantity,0);f<c.length;f++){var g=c[f].planSelected;g&&a.catalogItemID===g.catalogItemID&&(e-=c[f].quantity)}return b<=e},getWLProduct:function(a){for(var b=a.productOffering.products,c=0;c<b.length;c++)if("WS"===b[c].lob&&!b[c].sharedProduct)return b[c];return null},getWLOrderItemsCount:function(a,b){var c=0;a=a||this.getSamePlanOrderItemDetails(b);for(var d=0;d<a.length;d++)a[d]&&a[d].lineOfBusiness&&"WS"===a[d].lineOfBusiness&&a[d].selected&&(c+=1);return c},getPlanProductID:function(a){for(var b=this.get("selectedDeviceList"),c=0;c<b.length;c++)if(b[c].planSelected&&a.catalogItemID===b[c].planSelected.catalogItemID&&b[c].productID)return b[c].productID;return null},setOrdeItemToSelectedDevice:function(a,b){var c=this.get("selectedDeviceList");console.log("Order items updating to device 0 base index ="+b);for(var d=c[b||this.getSelectedDeviceIndex()],e=a.CreateNewProductOrderResponse.newProductsInOfferingInstances,f=this.prepareSimpleProductInfo(e),g=0;g<e.length;g++)d.orderItems.push(e[g].productOrderItemID);if(f&&f.length>0)for(var h in f)d.orderItemsDetails.push(f[h]);this.updateAllPlanRelatedDevices(d,c),c[this.getSelectedDeviceIndex()]=d,this.set("selectedDeviceList",c)},setOrdeItemToDeviceList:function(a){for(var b,c,d,e=this.get("selectedDeviceList"),f=!1,g=a.CreateNewProductOrderResponse.productOfferingInstances,h=0;h<e.length;h++){if(this.isArrayOfHardGoodToBeAdded()){d=this.setHardGoodOrderItems(e,g),f=!0;break}if(e[h].orderItems?e[h].productID==g[0].productOfferingInstanceID&&(b=e[h].orderItems,f=!0):(b=[],f=!0),f){for(var i=0;i<g.length;i++)b.push(g[i].productOrderItemID);e[h].orderItems=b,e[h].orderItemsDetails=this.prepareSimpleProductInfo(g),e[h].productID=g[0].productOfferingInstanceID,c=e[h];break}}if(f||(e[this.getSelectedDeviceIndex()].orderItems.push(g[0].productOrderItemID),e[this.getSelectedDeviceIndex()].orderItemsDetails.push(this.prepareSimpleProductInfo(g)[0])),this._publishOrderDetail(g),d&&f)for(var j=0;j<d.length;j++)this.updateAllPlanRelatedDevices(d[j],e);else c=c||e[this.getSelectedDeviceIndex()],this.updateAllPlanRelatedDevices(c,e);this.currentDeviceList(),this.usedSubscriptions(),this.addIncreaseAndPlanFlagToSelectedDeviceList()},isArrayOfHardGoodToBeAdded:function(){for(var a=this.get("selectedDeviceList"),b=0,c=0;c<a.length;c++)a[c].orderItems||(b+=1);return b>1},setHardGoodOrderItems:function(a,b){for(var c=[],d=0;d<a.length;d++)if(!a[d].orderItems)for(var e=0;e<b.length;e++)if(a[d].catalogItem.catalogItemID===b[e].simpleProductSpecID&&!b[e].readFlag){var f=[];b[e].readFlag=!0,f.push(b[e].productOrderItemID),a[d].orderItems=f,a[d].orderItemsDetails=this.prepareSimpleProductInfo(b[e]),a[d].productID=b[e].productOfferingInstanceID,c.push(a[d]);break}return c},prepareSimpleProductInfo:function(a){var c=[];b.isArray(a)||(a=[a]);for(var d=0;d<a.length;d++){var e=this.getSimpleProductInfo(a[d]);if(e)c.push({productOrderItemID:a[d].productOrderItemID,productSpecContainmentID:e.productSpecContainmentID,simpleProductSpecID:e.simpleProductSpecID,parentProductSpecContainmentID:e.parentProductSpecContainmentID,parentProductID:e.parentProductID,productID:e.productID,selected:e.selected,lineOfBusiness:a[d].productConfiguration.lineOfBusiness,planDisplayName:a[d].productConfiguration.planDisplayName});else if(a[d]){var f={productOrderItemID:a[d].productOrderItemID,planDisplayName:a[d].productConfiguration?a[d].productConfiguration.planDisplayName:void 0};a.length>1&&(f.sharedProduct=!0),c.push(f)}}return c},getSimpleProductInfo:function(a){if(a&&a.productConfiguration&&a.productConfiguration.steps)for(var b=a.productConfiguration.steps,c=0;c<b.length;c++)if("5576531"==b[c].ID||"Device"===b[c].name)return b[c].displayableItems[0].displayableSimpleProductReferences[0]},publishDeviceAccessoriesTopic:function(){var a={widgetInstanceID:this.get("widgetInstanceId"),numOfSubscriptions:this.get("numOfSubscriptions"),eligibleSubscriptions:this.get("eligibleSubscriptions"),payChannelType:this.get("payChannelType"),enforceEligibility:this.get("enforceEligibility")};this.subViewModels.devicesAccessoriesTopicViewModel.set(a)},sortSelectedDeviceList:function(){var a=this.get("selectedDeviceList"),b=[];if(a){for(var c=0;c<a.length;c++)a[c].catalogItem.businessType==e.get("businessType_ACCESSORY")&&(b.push(a[c]),a.splice(c,1));b&&b.length>0&&(a=a.concat(b))}this.set("selectedDeviceList",a)},addIncreaseAndPlanFlagToSelectedDeviceList:function(a){var b;if(this.get("selectedDeviceList")&&this.get("selectedDeviceList").length>0){if(b=this.get("selectedDeviceList"),a)for(var c=0;c<a.length;c++)b.push(a[c])}else b=a;if(b)for(var c=0;c<b.length;c++){var d=this.enableIncreaseBtn(b[c]);b[c].enableIncreaseBtn=d,b[c].enableApplyPlan=b[c].planSelected&&d}this.set("selectedDeviceList",b)},enableDecreaseBtn:function(a){return 1!=a},hasPlanSubscriptionNoDevice:function(a){return!!(a&&this.getPlanTotalDeviceCount(a)<this.getWLProduct(a).minimumQuantity)},enableIncreaseBtn:function(a){var b=a.catalogItem.catalogItemID,c=a.availableQuantity,d=this.get("devices");void 0==d&&(this.currentDeviceList(),d=this.get("devices"));for(var f=0;f<d.length;f++)if(d[f].deviceId==b&&d[f].quantity>=c)return!1;if(a.catalogItem.businessType==e.get("businessType_ACCESSORY")||!a.planSelected)return!0;if(-1==this.get("numOfSubscriptions")&&this.usedSubscriptions(),!(this.get("numOfSubscriptions")<this.get("eligibleSubscriptions"))&&this.get("enforceEligibility")&&!this.hasPlanSubscriptionNoDevice(a.planSelected))return!1;var g=a.planSelected.catalogItemID,h=this.get("plans");if(h){if(this.get("enforceEligibility")&&this.get("numOfSubscriptions")>=this.get("eligibleSubscriptions")){if(!$.isEmptyObject(a.planSelected)&&this.isPlanSingle(a.planSelected))return!1;for(var f=0;f<h.length;f++)if(h[f].catalogItemID==g)return!(h[f].deviceQty>=this.getPlanMinSubscriptions(a.planSelected))}else{if(!$.isEmptyObject(a.planSelected)&&this.isPlanSingle(a.planSelected))return!0;if(h)for(var f=0;f<h.length;f++)if(h[f].catalogItemID==g)return!(h[f].deviceQty>=this.getPlanMaxSubscriptions(a.planSelected))}return!0}},currentDeviceList:function(){var a=[],b=this.get("selectedDeviceList");if(b)for(var c=0;c<b.length;c++){for(var d=b[c].catalogItem.catalogItemID,e=b[c].quantity,f=!0,g=0;g<a.length;g++)if(a[g].deviceId==d){a[g].deviceQty+=b[c].quantity,f=!1;break}f&&a.push({deviceId:d,quantity:e})}this.set("devices",a)},usedSubscriptions:function(){var a=0,b=this.get("selectedDeviceList"),c=[];if(b)for(var d=0;d<b.length;d++)if(b[d].planSelected)if(this.isPlanSingle(b[d].planSelected))a+=b[d].quantity;else{
for(var e=!0,f=b[d].planSelected.catalogItemID,g=0;g<c.length;g++)if(c[g].catalogItemID==f){c[g].deviceQty+=b[d].quantity,e=!1;break}if(e){var h=this.getPlanMinSubscriptions(b[d].planSelected),i=this.getWLProduct(b[d].planSelected).minimumQuantity;this.getWLProduct(b[d].planSelected).minimumQuantity,c.push({catalogItemID:f,minQuantity:h,deviceQty:b[d].quantity,wlProductMin:i})}}for(var g=0;g<c.length;g++){var j=0;if(c[g].wlProductMin<c[g].minQuantity){var j=c[g].wlProductMin;a+=c[g].minQuantity-j}c[g].wlProductMin>c[g].deviceQty?(a+=c[g].wlProductMin,j=c[g].wlProductMin):(a+=c[g].deviceQty,j=c[g].deviceQty)}this.set("numOfSubscriptions",a),this.set("plans",c),this.publishDeviceAccessoriesTopic()},createSubViewModels:function(){this.subViewModels.selectPlanFromDeviceViewModel=this.create("selectPlanFromDeviceVM",i)},deleteLine:function(a,b,c,d){this.clearMoreActionDropdown();var e=d.$index(),f=b.catalogItem.businessType;this.removeDevice(f,e)},removeDevice:function(a,b){this.updateSelectedDevice(b,!1,!0);var c=this.get("selectedDeviceList"),d=!1;if(c)for(var f=0;f<c.length;f++)if(c[f].catalogItem.businessType==a){d=!0;break}a!=e.get("businessType_DEVICE_MD")||d?a!=e.get("businessType_ACCESSORY")||d||this.set("accessoriesPanelExpand",d):this.set("devicesPanelExpand",!1),this.currentDeviceList(),this.usedSubscriptions(),this.addIncreaseAndPlanFlagToSelectedDeviceList(),this.publishDeviceAccessoriesTopic()},incrementQuantity:function(a,b,c,d){if(!this.get("readOnly")){this.clearMoreActionDropdown();var e=d.$index();this.set("currentIndex",e),this.set("isIncrementDevice",!0);var f=this.get("selectedDeviceList");this.handleIncrement(f[e]),this.updateSelectedDevice(e,!0)}},handleIncrement:function(a){if(a.planSelected&&!this.isPlanSingle(a.planSelected)){var b=this.getPlanTotalDeviceCount(a.planSelected);b<this.getWLProduct(a.planSelected).minimumQuantity?this.isAnonymousCustomer()?this.addDeleteSubscriptionDeviceAnonymous(a):this.addDeleteSubscriptionDevice(a):b<this.getWLProduct(a.planSelected).maximumQuantity?this.createUpdateOrder(this.getAddProductToPlanRequest(a,1)):this.incrementDevice(a)}else this.incrementDevice(a)},prepareDeviceSubscriptionPayload:function(a,b){if(this.get("isIncrementDevice")){var c=[{characteristicID:"56671131",value:b.reservationDetails?b.reservationDetails.reservationID:""},{characteristicID:"56671141",value:b.reservationDetails?b.reservationDetails.storeID:""}];simpleProductData={productSpecContainmentID:a.productSpecContainmentID,simpleProductSpecID:b.catalogItem.catalogItemID,parentProductSpecContainmentID:a.parentProductSpecContainmentID,temporaryID:g.generateTemporaryId(),parentProductID:a.parentProductID,changedCharacteristics:b.reservationDetails?c:[]}}else simpleProductData={productSpecContainmentID:a.productSpecContainmentID,productID:a.productID,simpleProductSpecID:a.simpleProductSpecID};var d={runCompatibilityRules:!0,activityForConfiguration:"NegotiateProductConfiguration",confirmationMessagesApproved:!1,returnRemovedItems:!0,configurationLevel:"FULL",settingsView:"FULL",updateEvenIfNotValid:!0,returnConfiguration:"ALL",productChanges:[{newContainedProducts:[],changedContainedProducts:[],removedContainedProducts:[],newAssignedBillingOffers:[],removedAssignedBillingOffers:[],resumedContainedProducts:[],suspendedContainedProducts:[],newSimpleProducts:this.get("isIncrementDevice")?[simpleProductData]:[],changedSimpleProducts:[],removedSimpleProducts:this.get("isIncrementDevice")?[]:[simpleProductData]}],returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}};return console.log("--->Adding or updating plan line"),d},decrementQuantity:function(a,b,c,d){if(!this.get("readOnly")&&1!=b.quantity){this.clearMoreActionDropdown();var e=d.$index();this.set("currentIndex",e);var f=this.get("selectedDeviceList");this.set("isIncrementDevice",!1),this.handleDecrement(f[e]),this.updateSelectedDevice(e)}},handleDecrement:function(a){a.planSelected&&!this.isPlanSingle(a.planSelected)&&this.getPlanTotalDeviceCount(a.planSelected)<=this.getWLProduct(a.planSelected).minimumQuantity?this.isAnonymousCustomer()?this.addDeleteSubscriptionDeviceAnonymous(a):this.addDeleteSubscriptionDevice(a):this.removeProductOrderItem()},addDeleteSubscriptionDevice:function(a,c){var d=c||this.findValidSubscriptionDeviceInfo(a.orderItemsDetails);d&&(this.models.customerProductOrderItemProductConfigurationModel.set({customerId:this.get("customerId"),productOrderItemId:d.productOrderItemID}),this.models.customerProductOrderItemProductConfigurationModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("customerProductOrderItemProductConfigurationModel - save"),this.models.customerProductOrderItemProductConfigurationModel.save({UpdateProductInOrderConfigurationRequest:this.prepareDeviceSubscriptionPayload(d,a)},{success:b.bind(this.onAddDeleteProductSuccess,this),error:b.bind(this.onAddDeleteProductError,this)}))},addDeleteSubscriptionDeviceAnonymous:function(a,c){var d=c||this.findValidSubscriptionDeviceInfo(a.orderItemsDetails);d&&(this.models.anonymousProductOrderItemProductConfigurationModel.set({productOrderItemId:d.productOrderItemID}),this.models.anonymousProductOrderItemProductConfigurationModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("anonymousProductOrderItemProductConfigurationModel - save"),this.models.anonymousProductOrderItemProductConfigurationModel.save({UpdateProductInOrderConfigurationRequest:this.prepareDeviceSubscriptionPayload(d,a)},{success:b.bind(this.onAddDeleteProductSuccess,this),error:b.bind(this.onAddDeleteProductError,this)}))},onAddDeleteProductSuccess:function(a,b){console.log("Success - onAddDeleteProductSuccess -> customerProductOrderItemProductConfigurationModel, anonymousProductOrderItemProductConfigurationModel - save");var c=this.get("selectedDeviceList"),d=c[this.get("currentIndex")];console.log("Adding Product for device 0 base index ="+this.get("currentIndex")),d=d&&d.planSelected?d:this.getPlanRelatedDevice(b.UpdateProductInOrderConfigurationResponse.productOrderItemID);for(var e=0;e<d.orderItemsDetails.length;e++)d.orderItemsDetails[e].productOrderItemID==a.get("productOrderItemId")&&(d.orderItemsDetails[e]=this.prepareSimpleProductInfo(b.UpdateProductInOrderConfigurationResponse)[0]);this.updateAllPlanRelatedDevices(d,c),this.fetchProductOrderQuoteModel(),this.addDeleteSubscriptionDevicePromise&&this.addDeleteSubscriptionDevicePromise.resolve()},updateAllPlanRelatedDevices:function(a,b){if(a.planSelected&&!this.isPlanSingle(a.planSelected))for(var c=0;c<b.length;c++)b[c].planSelected&&a.planSelected.catalogItemID===b[c].planSelected.catalogItemID&&(b[c].orderItems=a.orderItems,b[c].orderItemsDetails=a.orderItemsDetails);console.log(" selectedDeviceList AFTER");for(var d in b)console.log(" selectedDeviceList "+d+" "+b[d].orderItems),console.log(" selectedDeviceList "+d+" "+(b[d].orderItemsDetails||[]).length);this.set("selectedDeviceList",b)},onAddDeleteProductError:function(a,b){console.error("Error - onAddDeleteProductError ->anonymousProductOrderItemProductConfigurationModel customerProductOrderItemProductConfigurationModel- save"),console.error((this.get("isIncrementDevice")?"Increment":"Decrement")+"Device Action Failed"),this.addDeleteSubscriptionDevicePromise&&this.addDeleteSubscriptionDevicePromise.resolve()},getPlanRelatedDevice:function(a){for(var b=this.get("selectedDeviceList"),c=0;c<b.length;c++)if(b[c].orderItems&&b[c].orderItems.indexOf(a)>=0)return b[c]},findValidSubscriptionDeviceInfo:function(a){if(a&&a.length>0)if(this.get("isIncrementDevice")){for(var b=0;b<a.length;b++)if(!1===a[b].selected)return a[b]}else for(var b=a.length-1;b>=0;b--)if(a[b].selected)return a[b]},removeProductOrderItem:function(a){var b=this.get("selectedDeviceList");console.log("REMOVE ALL for device 0 base index ="+this.get("currentIndex"));var c=b[this.get("currentIndex")],d=[];if(a)d=c.orderItems,delete c.planSelected,delete c.orderItems,delete c.orderItemsDetails,delete c.productID,b[this.get("currentIndex")]=c,this.set("selectedDeviceList",b);else{d=[c.orderItems.pop()];var e=this.getOrderItemsDetailsIndex(c.orderItemsDetails,d[0]);e>=0&&c.orderItemsDetails.splice(e,1),this.updateAllPlanRelatedDevices(c,b)}return this.removeCartItems(d)},removeCartItems:function(a){var b=null;return this.get("customerId")?(this._publishOrderDetail(null,a),b=this.removeCartForNonAnonymous(a)):(this._publishOrderDetail(null,a),b=this.removeCartForAnonymous(a)),b},getOrderItemsDetailsIndex:function(a,b){if(a)for(var c=0;c<a.length;c++)if(b==a[c].productOrderItemID)return c},removeCartForAnonymous:function(a){return this.deleteOrderItemsPromise=$.Deferred(),this.models.CommerceAnonymousProductOrderProductOrderItemsModel=this.create("CommerceAnonymousProductOrderProductOrderItemsModel",t),this.models.CommerceAnonymousProductOrderProductOrderItemsModel.errorHandler=null,this.models.CommerceAnonymousProductOrderProductOrderItemsModel.set({productOrderId:this.get("orderID")}),this.models.CommerceAnonymousProductOrderProductOrderItemsModel.setQueryParams({poi:[a],sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("CommerceAnonymousProductOrderProductOrderItemsModel-destroy productOrderItems"+a),this.models.CommerceAnonymousProductOrderProductOrderItemsModel.destroy({success:this._onRemoveCartSuccess,error:this._onRemoveCartError},this),this.deleteOrderItemsPromise.promise()},removeCartForNonAnonymous:function(a){return this.deleteOrderItemsPromise=$.Deferred(),this.models.customerProductOrderProductOrderItemsModel.errorHandler=null,this.models.customerProductOrderProductOrderItemsModel.set({customerId:this.get("customerId"),productOrderId:this.get("orderID")}),this.models.customerProductOrderProductOrderItemsModel.setQueryParams({poi:[a],sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("customerProductOrderProductOrderItemsModel-destroy productOrderItems"+a),this.models.customerProductOrderProductOrderItemsModel.destroy({success:this._onRemoveCartSuccess,error:this._onRemoveCartError},this),this.deleteOrderItemsPromise.promise()},_onRemoveCartSuccess:function(a,b){console.log("Success _onRemoveCartSuccess ->CommerceAnonymousProductOrderProductOrderItemsModel,customerProductOrderProductOrderItemsModel -destroy"),this.fetchProductOrderQuoteModel(),this.deleteOrderItemsPromise&&this.deleteOrderItemsPromise.resolve()},_onRemoveCartError:function(a,b){console.error("in Failed _onRemoveCartSuccess ->CommerceAnonymousProductOrderProductOrderItemsModel,customerProductOrderProductOrderItemsModel -destroy"),this.deleteOrderItemsPromise&&this.deleteOrderItemsPromise.resolve()},getProductOrderItemsNonAnonymous:function(){this.models.customerProductOrderProductOrderItemsModel.errorHandler=null,this.models.customerProductOrderProductOrderItemsModel.set({customerId:this.get("customerId"),productOrderId:this.get("orderID")}),this.models.customerProductOrderProductOrderItemsModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("customerProductOrderProductOrderItemsModel -Fetch"),this.models.customerProductOrderProductOrderItemsModel.fetch({success:this._onRetrieveRelateditemsFetchSuccess,error:this._onRetrieveRelateditemsFetchError})},getProductOrderItemsAnonymous:function(){this.models.CommerceAnonymousProductOrderProductOrderItemsModel=this.create("CommerceAnonymousProductOrderProductOrderItemsModel",t),this.models.CommerceAnonymousProductOrderProductOrderItemsModel.errorHandler=null,this.models.CommerceAnonymousProductOrderProductOrderItemsModel.set({productOrderId:this.get("orderID")}),this.models.CommerceAnonymousProductOrderProductOrderItemsModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("CommerceAnonymousProductOrderProductOrderItemsModel -Fetch"),this.models.CommerceAnonymousProductOrderProductOrderItemsModel.fetch({success:this._onRetrieveRelateditemsFetchSuccess,error:this._onRetrieveRelateditemsFetchError})},removeItem:function(a,b,c){var d=kocontext.$index();this.updateSelectedDevice(d,!1,!0)},addCatalogItem:function(a,b,c){var d=this.get("selectedDeviceList"),e={moreActionDropdownHide:!0},f=1,g=this.get("itemsAvailQty");g[a.sku]&&(f=g[a.sku]),d.push({catalogItem:a,quantity:b,availableQuantity:f,paymentType:c,viewParameters:e}),this.set("selectedDeviceList",d)},removeCatalogItem:function(a){var b,c=this.get("selectedDeviceList");for(var d in c)b=c[d].catalogItem,b.catalogItemID==a.catalogItem.catalogItemID&&c.splice(d,1);this.set("selectedDeviceList",null),this.set("selectedDeviceList",c)},updateSelectedDevice:function(a,b,c){this.set("currentIndex",a);var d=this.get("selectedDeviceList");if(d){var e=d[a],f=e.planSelected;if(b)if(f){if(this.getTotalDeviceCount(e.catalogItem.catalogItemID)<e.availableQuantity)if(this.get("numOfSubscriptions")<this.get("eligibleSubscriptions")||!this.get("enforceEligibility")){if(this.isPlanSingle(f)){e.quantity+=1;var g=this.get("numOfSubscriptions");this.set("numOfSubscriptions",g+1)}else if(this.getPlanTotalDeviceCount(f)<this.getPlanMaxSubscriptions(f)){var g=this.get("numOfSubscriptions");this.set("numOfSubscriptions",g+1),e.quantity+=1}}else this.hasPlanSubscriptionNoDevice(f)&&(e.quantity+=1)}else this.getTotalDeviceCount(e.catalogItem.catalogItemID)<e.availableQuantity&&(e.quantity+=1);else{if(c)return void this.removeDeviceAction(a);if(e.quantity>1&&(e.quantity-=1),f&&(this.isPlanSingle(f)||!this.isPlanSingle(f)&&this.getPlanTotalDeviceCount(f)>this.getPlanMinSubscriptions(f))){var g=this.get("numOfSubscriptions");this.set("numOfSubscriptions",g-1)}}}this.set("selectedDeviceList",d),this.currentDeviceList(),this.usedSubscriptions(),this.addIncreaseAndPlanFlagToSelectedDeviceList(),this.publishDeviceAccessoriesTopic()},isEnableMinusButton:function(a){return a.quantity>1},isEnablePlusButton:function(a){},isPlanSingle:function(a){var b=!0,c=a.productOffering.products;if(c&&c.length>1){var d;c.length;for(var e in c)d=c[e],0==d.sharedProduct&&"WS"==d.lob&&d.maximumQuantity>d.minimumQuantity&&(b=!1)}return b},getPlanMaxSubscriptions:function(a){var b=1,c=a.productOffering.products;if(c.length>1){var d;c.length;for(var e in c)if(d=c[e],0==d.sharedProduct&&"WS"==d.lob&&d.maximumQuantity){b=d.maximumQuantity;break}}return b},getPlanMinSubscriptions:function(a){var b=0,c=a.productOffering.products;if(c&&c.length>1){var d;c.length;for(var e in c)d=c[e],0==d.sharedProduct&&"EQ"!=d.lob&&d.minimumQuantity&&(b+=d.minimumQuantity)}return b},getPlanTotalDeviceCount:function(a){var b=this.get("selectedDeviceList"),c=0;if(b){var d,e=a.catalogItemID;for(var f in b)d=b[f],d.planSelected&&d.planSelected.catalogItemID==e&&(c+=d.quantity)}return c},getPlanTotalLineCount:function(a){var b=this.get("selectedDeviceList"),c=0;if(b){var d,e=a.catalogItemID;for(var f in b)d=b[f],d.planSelected&&d.planSelected.catalogItemID==e&&(c+=d.orderItemsDetails.length)}return c},getTotalDeviceCount:function(a){var b=this.get("selectedDeviceList"),c=0;if(b){var d;for(var e in b)d=b[e],d.catalogItem.catalogItemID==a&&(c+=d.quantity)}return c},toggleMoreActionDropdown:function(a,b,c,d){console.log(b.catalogItem.catalogItemID+b.catalogItem.catalogItemDisplayName);var e=this.get("selectedDeviceList");if(e)for(var f=0;f<e.length;f++)f==d.$index()?e[f].viewParameters.moreActionDropdownHide=!e[f].viewParameters.moreActionDropdownHide:void 0!==e[f].viewParameters&&(e[f].viewParameters.moreActionDropdownHide=!0);this.set("selectedDeviceList",e)},clearMoreActionDropdown:function(){var a=this.get("selectedDeviceList");if(a)for(var b=0;b<a.length;b++)void 0!==a[b].viewParameters&&(a[b].viewParameters.moreActionDropdownHide=!0);this.set("selectedDeviceList",a)},splitLine:function(a,b,c,d){console.log("split for "+b.catalogItem.catalogItemID+b.catalogItem.catalogItemDisplayName);var e=this.get("selectedDeviceList"),f=d.$index();if(f<e.length){var g=e[f];if(g.quantity>1){var h=g.quantity-1,i=g.orderItems,j=g.orderItemsDetails,k=g.planSelected,l=!1;k&&!this.isPlanSingle(k)&&(l=!0),g.quantity=1;for(var m=0;m<h;m++){var n=jQuery.extend(!0,{},g);l||(n.orderItems=i.splice(0,1),n.orderItemsDetails=j.splice(0,1)),e.splice(f,0,n)}}}this.addIncreaseAndPlanFlagToSelectedDeviceList(e),this.set("selectedDeviceList",e),this.clearMoreActionDropdown(),this.currentDeviceList(),this.usedSubscriptions(),this.publishDeviceAccessoriesTopic(),this.setOrderItemsPrices()},changePlan:function(a,b,c,d){console.log("change plan for "+b.catalogItem.catalogItemID+b.catalogItem.catalogItemDisplayName);var e=d.$index();this.set("currentIndex",e),this.trigger("selectPlanClicked",b),this.clearMoreActionDropdown()},removePlan:function(a,b,c,d){var e=d.$index();this.set("currentIndex",e),this.removePlanAction(e)},removePlanAction:function(a,b){var c=this.get("selectedDeviceList"),d=null;if(1===c.length)return void this.handleLastRowRemove(a);var e=c[a],f=e.planSelected;if(f&&!this.isPlanSingle(f)&&this.isPlanAlreadyUsed(f,a)){var g=this.getWLProduct(f).minimumQuantity,h=this.getSamePlanDevice(f,a),i=this.getWLOrderItems(h),j=[];for(var k in e.orderItemsDetails)e.orderItemsDetails[k].simpleProductSpecID==e.catalogItem.catalogItemID&&j.length<e.quantity&&j.push(e.orderItemsDetails[k]);var l=[],m=i-g;if((m=m>j.length?j.length:m)>0){for(var k=0;k<m;k++){var n=j.splice(0,1);l.push(n[0].productOrderItemID)}for(var k in l)for(var o in e.orderItemsDetails)e.orderItemsDetails[o].productOrderItemID==l[k]&&(e.orderItemsDetails.splice(o,1),e.orderItems.splice(o,1));this.updateAllPlanRelatedDevices(e,c)}(j.length>0||m>0)&&(delete e.orderItemsDetails,delete e.orderItems,delete e.planSelected,c[a]=e,this.set("selectedDeviceList",c));var p=null;if(j.length>0){this.set("isIncrementDevice",!1);var q=this.getSamePlanDeviceIndex(f,a),h=this.getSamePlanDevice(f,a);this.set("prevIndex",a),this.set("currentIndex",q),console.log("CURRENT INDEX ="+a+" CHANGED to "+q),p=this.updatePlanLineWithDevice(h,j.length,j)}var r=null;if(p){var s=this;p.done(function(c){console.log("CURRENT INDEX BACK TO ="+a+" FROM "+s.get("currentIndex")),s.set("currentIndex",s.get("prevIndex")),r=s.removeCartItems(l),d=r,b||(d=s.createDeviceItems(r))})}else r=this.removeCartItems(l),d=r,b||(d=this.createDeviceItems(r))}else{var r=this.removeAllProductOrderItems(e,!0);d=r,b||(d=this.createDeviceItems(r))}return this.clearMoreActionDropdown(),d},createDeviceItems:function(a){var b=null,c=this.get("selectedDeviceList")[this.get("currentIndex")];if(a){var d=this;a.done(function(a){b=d.createDeviceOrderItems(c)})}else b=this.createDeviceOrderItems(c);return b},handleLastRowRemove:function(a,b){var c=this.get("selectedDeviceList");c[a].oldOrderItems=c[a].orderItems,this.removeAllProductOrderItems(c[a],!1),b&&(c[a].planSelected=b),this.set("selectedDeviceList",c),this.createDeviceOrderItems(c[a]),this.currentDeviceList(),this.usedSubscriptions(),this.addIncreaseAndPlanFlagToSelectedDeviceList(),this.clearMoreActionDropdown()},removeAddPlanItem:function(a,b){var c=this.get("selectedDeviceList");if(1===c.length)return void this.handleLastRowRemove(a,b);var d=this.removePlanAction(a,!0);c=this.get("selectedDeviceList");var e=c[a],f=!1;if(b&&!this.isPlanSingle(b)&&this.isPlanAlreadyUsed(b,a)){var g=this.getWLProduct(b).minimumQuantity,h=this.getSamePlanDevice(b,a),i=this.getWLOrderItemsDeviceCount(h),j=this;e.orderItems=h.orderItems,e.orderItemsDetails=h.orderItemsDetails,e.productID=h.productID,e.planSelected=b,c[a]=e,this.set("selectedDeviceList",c);var k=g-i,l=k>e.quantity?e.quantity:k,m=null;this.set("isIncrementDevice",!0),l>0?(f=!0,d&&d.done(function(){m=j.updatePlanLineWithDevice(e,l);var a=e.quantity-l;a>0&&m.done(function(){j.createUpdateOrder(j.getAddProductToPlanRequest(e,a))})})):(f=!0,e.quantity>0&&d&&d.done(function(){j.createUpdateOrder(j.getAddProductToPlanRequest(e,e.quantity))}))}this.currentDeviceList(),this.usedSubscriptions(),this.addIncreaseAndPlanFlagToSelectedDeviceList(),this.publishDeviceAccessoriesTopic(),this.clearMoreActionDropdown(),b&&!f&&(c=this.get("selectedDeviceList"),c[a].planSelected=b,this.set("selectedDeviceList",c));var j=this;if(!f){var n=this.get("selectedDeviceList")[a];d?d.done(function(a){j.createDeviceOrderItems(n)}):this.createDeviceOrderItems(n)}},addSubscriptionLine:function(a,b,c){var c=a.quantity-devicesToBeAssigned;c>0&&(isActionDone=!0,b?b.done(function(){self.createUpdateOrder(self.getAddProductToPlanRequest(a,c))}):this.createUpdateOrder(self.getAddProductToPlanRequest(a,c)))},canRemoveAllOrderItems:function(a,b,c){var d=a.planSelected?a.planSelected:c,e=this.get("selectedDeviceList"),f=!0;if(d&&!this.isPlanSingle(d)&&this.isPlanAlreadyUsed(d,b)){var g=this.getWLProduct(d).minimumQuantity,h=this.getSamePlanDevice(d);g>this.getWLOrderItemsCount(h.orderItemsDetails,d)&&(a.orderItems=h.orderItems,a.orderItemsDetails=h.orderItemsDetails,a.productID=h.productID,a.planSelected=c,e[b]=a,this.set("selectedDeviceList",e),this.set("isIncrementDevice",!0),f=!1)}else f=!0;return f},getWLOrderItemsDeviceCount:function(a){for(var b=0,c=0;c<a.orderItemsDetails.length;c++)"WS"===a.orderItemsDetails[c].lineOfBusiness&&a.orderItemsDetails[c].selected&&(b+=1);return b},getWLOrderItems:function(a){for(var b=0,c=0;c<a.orderItemsDetails.length;c++)"WS"===a.orderItemsDetails[c].lineOfBusiness&&(b+=1);return b},getSamePlanDeviceIndex:function(a,b){for(var c=this.get("selectedDeviceList"),d=0;d<c.length;d++)if(b!=d&&c[d].planSelected&&c[d].orderItemsDetails&&a.catalogItemID==c[d].planSelected.catalogItemID)return d},getSamePlanDevice:function(a){for(var b=this.get("selectedDeviceList"),c=0;c<b.length;c++)if(b[c].planSelected&&b[c].orderItemsDetails&&a.catalogItemID==b[c].planSelected.catalogItemID)return b[c]},getSamePlanDevices:function(a,b){for(var c=this.get("selectedDeviceList"),d=[],e=0;e<c.length;e++)b!=e&&c[e].planSelected&&c[e].orderItemsDetails&&a.catalogItemID==c[e].planSelected.catalogItemID&&d.push(c[e]);return d},removeDeviceAction:function(a){var b=this.get("selectedDeviceList"),c=b[a],d=null;if(c.reservationDetails&&c.reservationDetails.reservationID)if(null==this.get("reservationCancelled")||0==this.get("reservationCancelled")){var e=c.reservationDetails;e.catalogID=c.catalogItem.catalogItemID,e.itemName=c.catalogItem.catalogItemName,this.set("ReservationDetails",e),d=this.cancelReservation(c.reservationDetails.reservationID)}else this.set("reservationCancelled",!1);if(1==b.length)if(d){var f=this;d.done(function(){f.clearCart()})}else this.clearCart();else this.removePlanAction(a,!0),b=this.get("selectedDeviceList"),b.splice(a,1),this.set("selectedDeviceList",b)},cancelReservation:function(a){return this.lastRowDeletePromise=$.Deferred(),this.models.cancelReservationModel.set("reservationId",a),this.models.cancelReservationModel.destroy({success:b.bind(this.onCancelReservationSuccess,this),error:b.bind(this.onCancelReservationError,this)}),this.lastRowDeletePromise.promise()},onCancelReservationSuccess:function(a,b){if(null!=b){var c=this.get("ReservationDetails"),d=[];d.push({reservationID:c.reservationID,status:this.getString("reserveItemWidget_reservation_status_cancelled"),storeID:c.storeID,storeName:c.storeName}),p.set("catalogID",c.catalogID),p.set("itemName",c.itemName),p.set("itemSku",c.itemSku),p.set("reservationItemInfo",d),p.handleAction("ReservedItems"),this.lastRowDeletePromise&&this.lastRowDeletePromise.resolve()}},onCancelReservationError:function(a,b){this.handleGenericRestError(a,b),this.lastRowDeletePromise&&this.lastRowDeletePromise.resolve()},updatePlanLineWithDevice:function(a,b,c){b=b||1;for(var d=[],e=0;e<b;e++)d.push($.Deferred());var f=this;console.log(" qty call Begin--->"),this.addDeleteSubscriptionDevicePromise=d[0],this.isAnonymousCustomer()?this.addDeleteSubscriptionDeviceAnonymous(a,c?c[0]:void 0):this.addDeleteSubscriptionDevice(a,c?c[0]:void 0);for(var e=1;e<b;e++)d[e-1].promise().done(function(b){var e=b;return function(){console.log("-->RESOLVED LINE WITH DEVICE qty call qty ="+e),f.addDeleteSubscriptionDevicePromise=d[e],f.isAnonymousCustomer()?f.addDeleteSubscriptionDeviceAnonymous(a,c?c[e]:void 0):f.addDeleteSubscriptionDevice(a,c?c[e]:void 0)}}(e));return d[b-1].promise()},removeAllProductOrderItems:function(a,b){var c=null;return b?c=this.removeProductOrderItem(b):(delete a.planSelected,delete a.orderItems,delete a.orderItemsDetails,delete a.productID),c},applyPlanToOtherDevice:function(a,b,c,d){console.log("apply plan for "+b.catalogItem.catalogItemID+b.catalogItem.catalogItemDisplayName);var e=d.$index(),f=this.get("selectedDeviceList");this.set("currentIndex",e),this.clearMoreActionDropdown(),this.subViewModels.selectPlanFromDeviceViewModel.onDoneClick(!0,new Array(f[e].planSelected))},setBehaviorParameters:function(){this.get("groupHeader")||this.get("devicesOnly")?this.set("groupHeaderLabel",this.getString("ShoppingBasketDevicesLabel")):this.set("groupHeaderLabel",this.getString("ShoppingBasketDeviceAccessoriesLabel")),this.setDisplayPricePlanMode()},selectPlanStatus:function(a){if(-1==this.get("numOfSubscriptions")&&this.usedSubscriptions(),this.get("enforceEligibility")&&this.get("numOfSubscriptions")>=this.get("eligibleSubscriptions")){var b=this.get("selectedDeviceList");for(var c in b)if(b[c].planSelected&&this.hasPlanSubscriptionNoDevice(b[c].planSelected))return!0;return!1}if(this.get("readOnly"))return!1;if(2==a)return!0;if("0"==this.get("payChannelType")){if(0==a)return!0;if(1==a)return!1}else if("1"==this.get("payChannelType")){if(0==a)return!1;if(1==a)return!0}},getDeleteAction:function(a){return!(this.get("readOnly")||a!=e.get("businessType_ACCESSORY")&&this.get("showActions")&&this.get("showPlans")&&a==e.get("businessType_DEVICE_MD")&&this.get("showActions")&&this.get("showPlans"))},getShowActions:function(a){return!(this.get("readOnly")||a==e.get("businessType_ACCESSORY")||!this.get("showActions")||!this.get("showPlans")||a!=e.get("businessType_DEVICE_MD")||!this.get("showActions")||!this.get("showPlans"))},setDisplayPricePlanMode:function(){this.get("showOneTimePrice")||this.get("showReoccurringPrice")||this.get("showPlans")?!this.get("showOneTimePrice")&&!this.get("showReoccurringPrice")||this.get("showPlans")?this.get("showOneTimePrice")||this.get("showReoccurringPrice")||!this.get("showPlans")?(this.set("displayPriceOnly",!0),this.set("displayPlanOnly",!1),this.set("displayall",!0)):(this.set("displayPriceOnly",!1),this.set("displayPlanOnly",!0),this.set("displayall",!1)):(this.set("displayPriceOnly",!0),this.set("displayPlanOnly",!1),this.set("displayall",!1)):(this.set("displayPriceOnly",!1),this.set("displayPlanOnly",!1),this.set("displayall",!1))},getTotalPrice:function(a){return parseFloat(0).toFixed(2)},devicesList:function(){return this.get("selectedDeviceList").length},selectPlan:function(a,b,c,d){this.clearMoreActionDropdown(a,b,c);var e=d.$index();this.set("currentIndex",e),this.trigger("selectPlanClicked",b)},fetchProductOrderQuoteModel:function(){if(this.get("orderID")){var a={};a={activityForConfiguration:null,productOrderReferenceNumber:null,returnQuoteData:{quotedItemsInd:!0,taxInformationInd:!0,configurationItemsInd:!0,crossProductDiscountsInd:!0,returnRemovedItems:!1,returnToBeCancelItems:!1}},this.isAnonymousCustomer()?(this.models.commerceAnonymousProductOrderQuoteModel.set("productOrderId",this.get("orderID")),this.models.commerceAnonymousProductOrderQuoteModel.set("RetrieveQuoteRequest",a),this.models.commerceAnonymousProductOrderQuoteModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("commerceAnonymousProductOrderQuoteModel -Fetch"),this.models.commerceAnonymousProductOrderQuoteModel.fetch({success:b.bind(this._onFetchProductOrderQuoteSuccess,this),error:b.bind(this._onFetchProductOrderQuoteError,this)})):(this.models.customerProductOrderQuoteModel.set("customerId",this.get("customerId")),this.models.customerProductOrderQuoteModel.set("productOrderId",this.get("orderID")),this.models.customerProductOrderQuoteModel.set("RetrieveQuoteRequest",a),this.models.customerProductOrderQuoteModel.setQueryParams({sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("customerProductOrderQuoteModel -Fetch"),this.models.customerProductOrderQuoteModel.fetch({success:b.bind(this._onFetchProductOrderQuoteSuccess,this),error:b.bind(this._onFetchProductOrderQuoteError,this)}))}},_onFetchProductOrderQuoteSuccess:function(a,b){console.log("Success _onFetchProductOrderQuoteSuccess -commerceAnonymousProductOrderQuoteModel, customerProductOrderQuoteModel -fetch"),this.setSummaryPrices(b.RetrieveQuoteResponse.order)},_onFetchProductOrderQuoteError:function(){console.error("Error-> _onFetchProductOrderQuoteError -commerceAnonymousProductOrderQuoteModel, customerProductOrderQuoteModel -fetch")},setSummaryPrices:function(a){var b=a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmount?a.totalOneTimeCalculatedPrice.finalAmount:parseFloat(0),c=parseFloat(0),d=a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmount?a.totalRecurringCalculatedPrice.finalAmount:parseFloat(0);this.set("totalrecurringPrice",d.toFixed(2)),this.get("groupHeader")?(this.set("totalDevicePrices",b.toFixed(2)),this.set("totalSummaryPrice",parseFloat(b+c).toFixed(2)),this.set("totalAccessoriesPrice",c.toFixed(2))):(this.set("totalDevicePrices",(b+c).toFixed(2)),this.set("totalSummaryPrice",(b+c).toFixed(2))),this.set("quoteOrderResponse",a),this.setOrderItemsPrices(a)},setOrderItemsPrices:function(a){for(var a=this.get("quoteOrderResponse"),b=this.get("selectedDeviceList"),c=a.simpleProductsInOrder&&a.simpleProductsInOrder.simpleProductInOrder?a.simpleProductsInOrder.simpleProductInOrder:[],d=a.productOfferings?a.productOfferings:[],e=0;e<b.length;e++){var f=0,g=0,h=b[e].orderItems,i=b[e].quantity;if(console.log("setOrderItemsPrices -->orderItems"+h),h){if(b[e].planSelected)for(var j=0;j<d.length;j++){for(var l=d[j].productOrderItems,m=0;m<l.length;m++){for(k=0;k<h.length;k++)if(l[m].productOrderItemID===h[k]){var n=l[m];if(n.displayableSimpleProductReferences&&b[e].catalogItem&&b[e].catalogItem.catalogItemID==n.displayableSimpleProductReferences[0].simpleProductSpecID&&(i--,f+=n.totalOneTimeCalculatedPrice&&n.totalOneTimeCalculatedPrice.finalAmount?parseFloat(n.totalOneTimeCalculatedPrice.finalAmount):parseFloat(0),g+=n.totalRecurringCalculatedPrice&&n.totalRecurringCalculatedPrice.finalAmount?parseFloat(n.totalRecurringCalculatedPrice.finalAmount):parseFloat(0),i<=0))break}if(i<=0)break}if(i<=0)break}else for(var m=0;m<c.length;m++)for(k=0;k<h.length;k++)if(c[m].productOrderItemID===h[k]){i--;var n=c[m];if(f+=n.simpleProductTotalOneTimeCalculatedPrice&&n.simpleProductTotalOneTimeCalculatedPrice.finalAmount?parseFloat(n.simpleProductTotalOneTimeCalculatedPrice.finalAmount):parseFloat(0),g+=n.simpleProductTotalRecurringCalculatedPrice&&n.simpleProductTotalRecurringCalculatedPrice.finalAmount?parseFloat(n.simpleProductTotalRecurringCalculatedPrice.finalAmount):parseFloat(0),i<=0)break}b[e].oneTimePrice=f.toFixed(2),b[e].recurringPrice=g.toFixed(2)}}this.set("selectedDeviceList",b)},setWidgetParameters:function(){this.set("reservedItems",this.getString("ShoppingBasketReservedItems")),this.set("reservedItem",this.getString("ShoppingBasketReservedItem")),this.set("deviceAccessoriesLabel",this.getString("ShoppingBasketDeviceAccessoriesLabel")),this.set("accessoriesLabel",this.getString("ShoppingBasketAccessoriesLabel")),this.set("totalForCartTitleLabel",this.getString("ShoppingBasketTotalForCartLabel")),this.set("totalTitleLabel",this.getString("ShoppingBasketTotalLabel")),this.set("moreActions",this.getString("ShoppingBasketMoreActions")),this.set("perMonth",this.getString("ShoppingBasketPerMonth")),this.set("shoppingBasketDefaultCurrency",this.getString("ShoppingBasketDefaultCurrency")),this.set("selectPlanLabel",this.getString("ShoppingBasketSelectPlanLabel")),
this.set("shoppingBasketOneTime",this.getString("ShoppingBasketOneTime")),this.set("groupHeaderLabel",this.getString("ShoppingBasketDevicesLabel")),this.set("defaultCurrency",this.getString("ShoppingBasketDefaultCurrency")),this.set("basePriceLabel",this.getString("ShoppingBasketBasePriceLabel")),this.set("shoppingBasketChangePlanLabel",this.getString("ShoppingBasketChangePlan")),this.set("ShoppingBasketRemovePlanLabel",this.getString("ShoppingBasketRemovePlan")),this.set("ShoppingBasketRemoveDeviceLabel",this.getString("ShoppingBasketRemoveDevice")),this.set("ShoppingBasketApplyPlan1Label",this.getString("ShoppingBasketApplyPlan1")),this.set("ShoppingBasketApplyPlan2Label",this.getString("ShoppingBasketApplyPlan2")),this.set("ShoppingBasketSplitLineLabel",this.getString("ShoppingBasketSplitLine"))},clearBasket:function(){this.set({totalSummaryPrice:0,numOfSubscriptions:0,totalAccessoriesPrice:0,totalDevicePrices:0,totalrecurringPrice:0,selectedDeviceList:null,itemsAvailQty:null,selectedDeviceList:[],itemsAvailQty:{},itemsAvailQty:{},orderID:null,orderRefID:null});var a={productOrderID:null,productOrderReferenceNumber:null,productOrderItems:null};this.subViewModels.productOrderTopicViewModel.set(a)},clearCart:function(){this.isAnonymousCustomer()?this.clearCartForAnonymous():this.clearCartForNonAnonymous()},clearCartForNonAnonymous:function(){console.log("cancel click"),this.get("orderID")&&(this.models.CustomerProductOrdersModel=this.create("CustomerProductOrdersModel",x),this.models.CustomerProductOrdersModel.setQueryParams({orderIds:[this.get("orderID")+"A"],sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("CustomerProductOrdersModel - destroy"),this.models.CustomerProductOrdersModel.destroy({customerId:this.get("customerId"),success:b.bind(this._onClearCartSuccess,this),error:b.bind(this._onClearCartError,this)},this))},clearCartForAnonymous:function(){console.log("cancel click"),this.get("orderID")&&(this.models.CommerceAnonymousProductOrdersModel=this.create("CommerceAnonymousProductOrdersModel",y),this.models.CommerceAnonymousProductOrdersModel.setQueryParams({orderIds:[this.get("orderID")+"A"],sc:this.get("salesChannel"),lo:this.get("locale")}),console.log("CommerceAnonymousProductOrdersModel - destroy"),this.models.CommerceAnonymousProductOrdersModel.destroy({success:b.bind(this._onClearCartSuccess,this),error:b.bind(this._onClearCartError,this)},this))},_onClearCartSuccess:function(){console.log("Sucess - _onClearCartSuccess CustomerProductOrdersModel,CommerceAnonymousProductOrdersModel -destroy"),this.clearBasket()},_onClearCartError:function(){console.log("Error - _onClearCartError CustomerProductOrdersModel,CommerceAnonymousProductOrdersModel -destroy")},_publishError:function(a){data={},data.widgetID="",data.errorCode="",data.errorMessage=a,this.subViewModels.exceptionTopicViewModel.set(data)},inverseToolTip:function(a){var b=$(a).position().top,c=$("#NPCContent");return $(c).innerHeight()-b<=$(a).height()+30},isAnonymousCustomer:function(){return!this.get("customerId")},planHasMinDevices:function(a){var b=d.toJS(a);for(var c in b.orderItemsDetails)if(!1===b.orderItemsDetails[c].selected)return this.addIncreaseAndPlanFlagToSelectedDeviceList(),!1;return!0},deleteNonDeviceLines:function(a,c,d,e){this.clearMoreActionDropdown();var f=e.$index();this.set("currentIndex",f);var g=this.get("selectedDeviceList");if(c.planSelected&&!this.isPlanSingle(c.planSelected)){var h=this.getPlanTotalDeviceCount(c.planSelected),i=this.getWLProduct(c.planSelected).minimumQuantity,j=[];if(h>=i&&c.orderItemsDetails.length>i){for(var k=c.orderItemsDetails.length-1;k>=0;k--)!1===c.orderItemsDetails[k].selected&&j.push(c.orderItemsDetails[k].productOrderItemID);this.get("customerId")?(this._publishOrderDetail(null,j),deleteOrderItemsPromise=this.removeCartForNonAnonymous(j)):(this._publishOrderDetail(null,j),deleteOrderItemsPromise=this.removeCartForAnonymous(j));for(var k in j)for(var l in c.orderItemsDetails)j[k]!=c.orderItemsDetails[l].productOrderItemID||0!=c.orderItemsDetails[l].selected||c.orderItemsDetails[l].sharedProduct||(console.log("-----> selectedDevice.orderItemsDetails[j] "+c.orderItemsDetails[l].productOrderItemID),c.orderItemsDetails.splice(l,1));c.orderItems=b.difference(c.orderItems,j)}}g[f]=c,this.set("selectedDeviceList",g)},destroy:function(){this._super()}})});
define("businesswidget/repository/common/model/CustomerProductOfferingHasAddOnsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"/commerce/customer/:customerId/product-offering/:productOfferingId/has-add-ons",rest:{defaults:{qParams:{numOfLOB:1,sc:c.get("salesChannel"),lo:c.get("locale")}}}}})});
define("businesswidget/repository/common/viewmodel/MicroCartWidgetViewModel",["lightsaber","knockout","Configuration","businesswidget/repository_l9_common/common/core/WidgetResourceBundle","underscore","businesswidget/repository_l9_common/common/utils/ImplUtil","single!businesswidget/repository/common/viewmodel/ApplicationInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/ProductOrderTopicViewModel","single!businesswidget/repository/common/viewmodel/OrderingContextTopicViewModel","single!businesswidget/repository/common/viewmodel/MicroCartTopicViewModel","single!businesswidget/repository/common/viewmodel/ExceptionTopicViewModel","single!businesswidget/repository/common/viewmodel/ConfigureMultiProductsTopicViewModel","sync!businesswidget/repository/common/viewmodel/UserInformationViewModel","businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel","businesswidget/repository/common/viewmodel/MicroCartCustomizedDynamicViewModel","businesswidget/repository/common/model/CustomerProductOrderQuoteModel","businesswidget/repository/common/viewmodel/LineOfBusinessDetailViewModel","single!businesswidget/repository/common/util/BusinessHelper","businesswidget/repository/common/model/CustomerProductOrdersModel","businesswidget/repository/common/model/CustomerProductOrderIdProductConfigurationsModel","single!businesswidget/repository/common/viewmodel/FullCartTopicViewModel","businesswidget/repository/common/model/CustomerContactPersonsModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemModel","businesswidget/repository/common/model/CustomerProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderQuoteModel","businesswidget/repository/common/model/CommerceAnonymousProductOrdersModel","businesswidget/repository/common/model/CustomerAddressDetailsModel","single!businesswidget/repository/common/viewmodel/ReserveResourceTopicViewModel","businesswidget/repository/common/model/CommerceAnonymousProductOrderProductOrderItemsModel","businesswidget/repository/common/model/CustomerProductOrderItemProductConfigurationModel","businesswidget/repository/common/model/CustomerProductOrderIdValidateProductConfigurationsModel","businesswidget/repository/common/model/CommerceCustomerAnonymousProductOrderIdValidateProductConfigurationsModel","businesswidget/repository/common/model/AnonymousProductOrderItemProductConfigurationModel","single!businesswidget/repository/common/viewmodel/ProductConfigurationActionTopicViewModel","businesswidget/repository/common/model/DomainModel","businesswidget/repository/common/model/AnonymousProductOrderIdProductConfigurationsModel","single!businesswidget/repository/common/viewmodel/ShoppingBasketViewModel","businesswidget/repository/common/model/CustomerProductOfferingHasAddOnsModel","businesswidget/repository/common/model/AnonymousCustomerOfferingHasAddOnsModel","businesswidget/repository/common/viewmodel/cart/CartRulesBackendInvokerViewModel","businesswidget/repository/common/viewmodel/cart/BaseRulesExecutorViewModel"],function (a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R){return a.Core.ObservableViewModel.extend({models:{customerProductOrderProductOrderItemsModel:z,productConfigurationModel:G,anonymousProductConfigurationModel:J,domainModel:L},subViewModels:{dynamicUI:q,managePricingDynamicUI:q},defaults:{customerId:null,locale:null,sc:null,productOrderId:null,labelBalloonVisible:!1,currency:null,expandCartByDefault:null,clientId:null,frameworkId:null,hideLoader:!1,allowEmptyCart:null,cartMode:null,displayRemoveCart:null,taxOneTime:null,taxRecurring:null,currencySymbol:null,takeover:!1,showAddresses:!1,showContacts:!1,showTotalPricingInfo:!0,showTaxInfo:!0,showImages:!0,enableCartItemActivities:!1,enableCartActivites:!1,enableChangeNumberAllocation:!1,showCart:!1,checkoutFailed:!1,messagesCollection:null,recurringPrice:null,oneTimePrice:null,showCheckOut:!0,showShopMore:!0,refreshConfigurationOnManagePricing:!0,showRemovedItems:!1,showHardGoods:!0,maxItemQuantity:10,managePricingMicroCartMode:!1,isOtherCrossProductDiscountsAvailable:!1,productsBar:null,orderStatuses:{TC:"TC",CA:"CA"},orderStatus:null},initialize:function(a){e.bindAll(this,"removeCart","refreshCart","removeBundle","editCart","sortOrderitemsByLOB","sortSPOffersByLOB","changeTelephoneNo","reservedResourceDone","replaceDevice","changePlan","updateHardGoodsQuantity","checkout","initializeManagePricing","handleCustomerOfferingHasAddOnsSuccess","handleCustomerOfferingHasAddOnsFailure","addSubscription"),this.CART_MODE={FULL_CART:"FULL",MICRO_CART:"MICRO",AGENT_VIEW:"AGENT"},this.setTopicsViewModels(),this.createSubViewModels(),this._createModels(),this.bindData(),this.rb=d,this.set("configurationDisplayLevel_HideComponent",c.get("MicroCart_ConfigurationDisplayLevel_HideComponent")),this.get("configurationDisplayLevel_HideComponent")&&this.subViewModels.dynamicUI.set("productLevelDisableManagePriceLink",!0),this.set("currency",this.rb.getString("cm_MicroCart_totalHeader")),this.set("errorMessages",[]),this.set("allowWaiveOrOverride",!1),this.allProductsInOrder=[],this.subViewModels.dynamicUI.on("RefreshMicroCart",this.refreshCart,this),this.createManagePricingDynamicUIViewModel(),this.subViewModels.reserveResourceTopicViewModel.on("action:onReserveResourceDone",this.reservedResourceDone,this),this.CART_INFO={STB:"TV_STB",PACKAGE:"TV_PACKAGE",CHANNEL:"TV_CHANNEL",PLAN:"PLAN",DEVICE:"DEVICE",SHARED_EQUIPMENT:"SHARED_EQUIPMENT",COMMITMENT:"COMMITMENT",ACTION_RM:"RM",ACTION_AD:"AD",ACTION_SU:"SU",ACTION_RE:"RS",ACTION_UP:"UP",ACTION_TYPE_CHANGE_PRODUCT:"CHANGE_PRODUCT",ACTION_TYPE_ADD_PRODUCT:"ADD_PRODUCT",ACTION_TYPE_REMOVE_PRODUCT:"REMOVE_PRODUCT",TV_LOB:"TV",UPDATE_TV:"Update TV",SERVICE:"SERVICE",BUSINESSTYPE:{AC:c.get("businessType_ACCESSORY"),MD:c.get("businessType_DEVICE_MD")}},this.installationAddressesMap={},this.bundleAddressesMap={},this.bundleAddonMap={},this.contactPersonIDNameMap={},this.addressIDsArray=[],this.personIDsArray=[],this.orderMultipleProductOfferings=0,this.orderMultipleProductItems=0,this.cartHasHardGoods=!1,this.managePricingProductChangesByProductID={},this.managePricingProductChanges={},this.order={},this.bundleAddonDetails={},this.subViewModels.microCart.on("action:validateAndSaveAllProductsSucceeded",this.handleValidateAndSaveAllProductsSuccess,this),this.subViewModels.microCart.on("action:validateAndSaveAllProductsFailed",this.handleValidateAndSaveAllProductsFailure,this)},createManagePricingDynamicUIViewModel:function(){this.subViewModels.managePricingDynamicUI&&(this.subViewModels.managePricingDynamicUI.destroy(),this.subViewModels.managePricingDynamicUI=this.create("cm_MicroCartWidgetViewModel_managePricingDynamicUI_ViewModel",q),this.subViewModels.managePricingDynamicUI.set("allowWaiveOrOverride",this.get("allowWaiveOrOverride")),this.subViewModels.managePricingDynamicUI.set("overrideReason",this.overrideReasonDropDownValues)),this.subViewModels.managePricingDynamicUI.on("RefreshMicroCart",this.refreshCart,this),this.subViewModels.managePricingDynamicUI.on("updateAndCloseWaiveOrOverride",this.updateWaiveOrOverride,this),this.subViewModels.managePricingDynamicUI.on("resetWaiveOrOverride",this.resetWaiveOrOverride,this)},setTopicsViewModels:function(){this.subViewModels.customerInContext=h,this.subViewModels.applicationInContext=g,this.subViewModels.productOrder=j,this.subViewModels.microCart=l,this.subViewModels.exceptionTopicViewModel=m,this.subViewModels.orderingContext=k,this.subViewModels.configureMultiProductsTopicViewModel=n,this.subViewModels.reserveResourceTopicViewModel=E,this.subViewModels.productConfigurationAction=K},createSubViewModels:function(){this.subViewModels.lineOfBusinessDetailViewModel=this.create("cm_MicroCartWidgetViewModel_LineOfBusinessDetailViewModel_ViewModel",s),this.subViewModels.agentViewVM=N},_createModels:function(){this.models.customerProductOrderQuoteModel=this.create("cm_MicroCartWidgetViewModel_CustomerProductOrderQuoteModel_Model",r),this.productConfigurationMultiModel=this.create("cm_MicroCartWidgetViewModel_productConfigurationMultiModel",v),this.anonymousProductConfigurationMultiModel=this.create("cm_MicroCartWidgetViewModel_productConfigurationMultiModel",M),this.models.customerBundleAddOnsModel=this.create("cm_MicroCartWidgetViewModel_customerProductOfferingHasAddOnsModels_Model",O),this.models.anonymousBundleAddOnsModel=this.create("cm_MicroCartWidgetViewModel_anonymousCustomerOfferingHasAddOnsModel_Model",P)},bindData:function(){var b=new a.Core.DataBinding,c={setOnBind:!0,twoWay:!1};b.bindAll({vm:this,shared:this.subViewModels,dataBindings:[{"vm.customerId":"shared.customerInContext.ID",options:c},{"vm.locale":"shared.applicationInContext.locale",options:c},{"vm.sc":"shared.applicationInContext.salesChannel",options:c},{"vm.productOrderId":"shared.productOrder.productOrderID",options:c},{"vm.clientId":"shared.orderingContext.clientId",options:c},{"vm.frameworkId":"shared.orderingContext.frameworkId",options:c},{"vm.cartMode":"shared.microCart.cartMode",options:c},{"vm.productsBar":"shared.productConfigurationAction.productsBar",options:c}]})},loadData:function(){this.subViewModels.lineOfBusinessDetailViewModel.lazyLoadData(this.getLocale(),this.get("sc")),a.Core.StorageUtil.getStorage("session").get("domainValuesKey")?this._createOverrideReasonObject(a.Core.StorageUtil.getStorage("session").get("domainValuesKey")):this.fetchDomainOverrideReason()},loadDataForFullCart:function(){var a=this;this.isOrderAvailable()&&$.when(a.subViewModels.lineOfBusinessDetailViewModel.lazyLoadData(this.getLocale(),this.getSalesChannel())).then(function(){a.fetchCustomerProductOrderQuoteModel()})},loadDataForAnonymousFullCart:function(){var a=this;this.isOrderAvailable()&&$.when(a.subViewModels.lineOfBusinessDetailViewModel.lazyLoadData(this.getLocale(),this.getSalesChannel())).then(function(){a.fetchAnonymousProductOrderQuoteModel()})},isOrderAvailable:function(){return!!this.get("productOrderId")},loadContactPersons:function(){var a=new $.Deferred;return a.promise(),this.loadContactPersonsData()},refreshCart:function(a){this.isAnonymousFlow()?this.fetchAnonymousProductOrderQuoteModel(a):this.fetchCustomerProductOrderQuoteModel(a)},fetchAnonymousProductOrderQuoteModel:function(a){var c,d={},f=a;e.isUndefined(a)||e.isUndefined(a.productChanges)||e.isEmpty(a.productChanges)||(c=!1);var g=!this.get("configurationDisplayLevel_HideComponent");this.set("lobDetailsMap",this.subViewModels.lineOfBusinessDetailViewModel.getLOBCodeLOBDetailsMap()),this.models.commerceAnonymousProductOrderQuoteModel=this.create("cm_microCartWidget_CommerceAnonymousProductOrderQuoteModel",B),this.models.commerceAnonymousProductOrderQuoteModel.set("productOrderId",this.get("productOrderId")),this.get("cartMode")==this.CART_MODE.FULL_CART?this.quotedItemsInd=!1:this.quotedItemsInd=!0;var h=!1;this.data.showRemovedItems()&&(h=!0),d={activityForConfiguration:this.get("activityName")||null,productOrderReferenceNumber:null,returnQuoteData:{quotedItemsInd:this.quotedItemsInd,taxInformationInd:!0,configurationItemsInd:g,crossProductDiscountsInd:!0,catalogDataInd:!0,returnRemovedItems:h,returnToBeCancelItems:!0},productOrderItem:f,addDefaultChildItemsImplicitly:c},f&&f.length>1&&(d.productOrderItemArr=f,d.productOrderItem=null),this.get("cartMode")==this.CART_MODE.FULL_CART&&(d.returnQuoteData.returnToBeCancelItems=!1),this.models.commerceAnonymousProductOrderQuoteModel.set("RetrieveQuoteRequest",d),this.setDefaultQueryParams(this.models.commerceAnonymousProductOrderQuoteModel),this._setOrderingContextHeaders(),this.data.orderHasMultipleProductOfferings=b.observable(!1),this.data.orderHasMultipleProductItems=b.observable(!1),this.subViewModels.microCart.trigger("action:onHold"),this.models.commerceAnonymousProductOrderQuoteModel.fetch({success:e.bind(this._onFetchProductOrderQuoteSuccess,this),error:e.bind(this._onFetchProductOrderQuoteError,this)})},fetchCustomerProductOrderQuoteModel:function(a){var c,d={},f=a;e.isUndefined(a)||e.isUndefined(a.productChanges)||e.isEmpty(a.productChanges)||(c=!1);var g=!this.get("configurationDisplayLevel_HideComponent");this.set("lobDetailsMap",this.subViewModels.lineOfBusinessDetailViewModel.getLOBCodeLOBDetailsMap()),this.models.customerProductOrderQuoteModel.set("customerId",this.get("customerId")),this.models.customerProductOrderQuoteModel.set("productOrderId",this.get("productOrderId")),this.get("cartMode")==this.CART_MODE.FULL_CART?this.quotedItemsInd=!1:this.quotedItemsInd=!0,d={activityForConfiguration:this.get("activityName")||null,productOrderReferenceNumber:null,returnQuoteData:{quotedItemsInd:this.quotedItemsInd,taxInformationInd:!0,configurationItemsInd:g,crossProductDiscountsInd:!0,returnRemovedItems:!0,returnToBeCancelItems:!0},productOrderItem:f,addDefaultChildItemsImplicitly:c},f&&f.length>1&&(d.productOrderItemArr=f,d.productOrderItem=null),this.get("cartMode")==this.CART_MODE.FULL_CART?(d.returnQuoteData.catalogDataInd=!0,d.returnQuoteData.crossProductDiscountsInd=!0,d.returnQuoteData.returnToBeCancelItems=!1,this.data.showRemovedItems()?d.returnQuoteData.returnRemovedItems=!0:d.returnQuoteData.returnRemovedItems=!1):this.data.showHardGoods()&&(d.returnQuoteData.catalogDataInd=!0),this.models.customerProductOrderQuoteModel.set("RetrieveQuoteRequest",d),this.setDefaultQueryParams(this.models.customerProductOrderQuoteModel),this._setOrderingContextHeaders(),this.data.orderHasMultipleProductOfferings=b.observable(!1),this.data.orderHasMultipleProductItems=b.observable(!1),this.subViewModels.microCart.trigger("action:onHold"),this.models.customerProductOrderQuoteModel.fetch({success:e.bind(this._onFetchProductOrderQuoteSuccess,this),error:e.bind(this._onFetchProductOrderQuoteError,this)})},setDefaultQueryParams:function(a){var b=a.getDataSource().methods.defaults.qParams;b||(b={}),a.getDataSource().methods.defaults.qParams=e.extend(b,{lo:c.get("defaultLocale")||b.locale,sc:this.get("sc")||b.sc})},_onFetchProductOrderQuoteSuccess:function(a,b,c){if(this.subViewModels.microCart.trigger("action:releaseLoadSign"),console.log("MicroCartWidget: load quote data success"),this.data.displayRemoveCart(!0),this.data.allowEmptyCart(!0),this.data.checkoutFailed(!1),this.quoteResponseData=b.RetrieveQuoteResponse&&b.RetrieveQuoteResponse.order,this.order.productOrderID=this.quoteResponseData.productOrderID,this.order.productOrderReferenceNumber=this.quoteResponseData.productOrderReferenceNumber,this.get("cartMode")===this.CART_MODE.FULL_CART){var d=b.RetrieveQuoteResponse.order.currentSalesChannel;d&&d!=this.getSalesChannel()?(this.data.takeover(!0),this.data.allowEmptyCart(!1)):(this.data.takeover(!1),this.data.allowEmptyCart(!0)),this.data.showCart(!0);var e=this;if(this.checkBundleAvalable(this.quoteResponseData))$.when(e.callForAddonIfIsBundle(b)).done(function(){var a=e.createSuccessQuoteMetadataForFullCart(b);e.trigger("fullCartloaddata"),e.dynamicUILoad(b,a)});else{var f=this.createSuccessQuoteMetadataForFullCart(b);this.trigger("fullCartloaddata"),this.dynamicUILoad(b,f)}}else{var g,f=this.createSuccessQuoteMetadata(b),h=b.RetrieveQuoteResponse.order.otherCrossProductDiscounts;g=this.getOtherProductOfferingsDiscounts(h),g.length>0?this.set("isOtherCrossProductDiscountsAvailable",!0):this.set("isOtherCrossProductDiscountsAvailable",!1),this.set("otherProductOfferingsCrossProductDiscounts",g),this.dynamicUILoad(b,f)}},dynamicUILoad:function(b,c){a.Core.StorageUtil.get("quoteResponse")&&this.clearValidResponse(),a.Core.StorageUtil.set("quoteResponse",b),this.trigger("quoteDataReady",b),this.getSubViewModel("dynamicUI").load(c,{}),this.managePricingMetadata=c,this.get("managePricingMicroCartMode")&&!this.get("managePricingLockedForInitialization")&&this.trigger("managePricingDataReady"),this.get("waveOrOverrideUpdateMicroCartMode")&&(this.getSubViewModel("managePricingDynamicUI").load(c,{}),this.set("waveOrOverrideUpdateMicroCartMode",!1)),this.getSubViewModel("dynamicUI").get("isManagePricingLinkDisabled")&&this.get("saveProductChangesForManagePricing")&&this.getSubViewModel("dynamicUI").set("isManagePricingLinkDisabled",!1)},getOtherProductOfferingsDiscounts:function(a){var b=[],c=[];e.each(a,function(a){var c={productName:a.productName,id:a.productID,lineOfBusiness:a.productLineOfBusiness,productOfferingID:a.productOfferingInstanceID,productOfferingName:a.productOfferingName,productServiceID:a.productServiceID,crossProductDiscountsArray:[]},d=a.crossProductDiscounts;e.each(d,function(a){var b={name:a.name,reason:a.crossProductDiscountRuleDescription,description:a.productSpecPricing.childPricingSchema&&a.productSpecPricing.childPricingSchema.description,oneTimePrice:a.totalOneTimeCalculatedPrice.finalAmount,action:this.decodeAction(a.action),status:a.status,recurringPrice:a.totalRecurringCalculatedPrice.finalAmount,infoTooltipVisible:!1,billingOfferTooltipID:e.uniqueId("billingOfferTooltip_")};c.crossProductDiscountsArray.push(b)},this),c.crossProductDiscountsArray.length>0&&b.push(c)},this);var d=null;return e.each(b,function(a){var b;a.productOfferingID!=d&&(b={name:a.productOfferingName,id:a.productOfferingID,productOrdersArray:[]},d=a.productOfferingInstanceID,c.push(b)),b.productOrdersArray.push(a)},this),c},_getOfferName:function(a){if(a.id()!=this.currentOfferID){var b=a.name();return this.currentOfferID=a.id(),b}return""},initializeSuccessData:function(a){this.set("currency",a.components[0].currency),this._setLOBNumbering(void 0,!0)},_onFetchProductOrderQuoteError:function(a,b){if(this.subViewModels.microCart.trigger("action:refreshPricesFailed"),this.subViewModels.microCart.trigger("action:releaseLoadSign"),console.log("MicroCartWidget: load quote data error"),this.addErrorMessage(b),401!==b.status&&403!==b.status){var c=this.createCreateMetadataStructure();return this.get("cartMode")===this.CART_MODE.FULL_CART?(this.data.showCheckOut(!1),this.data.showShopMore(!1),this.createFailQuoteMetadataFullCart(a,c,b)):this.createFailQuoteMetadata(a,c,b),this.getSubViewModel("dynamicUI").load(c,{}),!0}},createSuccessQuoteMetadata:function(a){var b=this.createCreateMetadataStructure(),c=a.RetrieveQuoteResponse&&a.RetrieveQuoteResponse.order;this.createTotalsComponents(b,c,null,!1);var d={template:"cartContainer",components:[]};return b.components.push(d),this.createDepositItem(d,c),this.createBundleComponents(d,c,null,!1),this.data.showHardGoods()&&this.createHardGoodsComponents(d,c),this.initializeSuccessData(b),this.orderMultipleProductOfferings>1&&this.data.orderHasMultipleProductOfferings(!0),this.orderMultipleProductItems>1&&this.data.orderHasMultipleProductItems(!0),b},setCartCounters:function(a){var b,c=0,d=0;if(a.productOfferings&&a.productOfferings.length>0){b=a.productOfferings,c=a.productOfferings.length;for(var e=0;e<b.length;e++)d+=b[e].productOrderItems.length}var f,g=0,h=0;this.data.showHardGoods()&&a.simpleProductsInOrder&&(f=a.simpleProductsInOrder,f.simpleProductAggregatePrice&&f.simpleProductAggregatePrice.length>0&&(g=f.simpleProductAggregatePrice.length),f.simpleProductInOrder&&f.simpleProductInOrder.length>0&&(h=f.simpleProductInOrder.length));var i=c+g,j=d+h;i>1&&this.data.orderHasMultipleProductOfferings(!0),j>1&&this.data.orderHasMultipleProductItems(!0),0==j&&(console.log("Cart is empty"),this.setCartEmpty())},createSuccessQuoteMetadataForFullCart:function(a){var b=this.createCreateMetadataStructure(),c=a.RetrieveQuoteResponse&&a.RetrieveQuoteResponse.order,d={template:"cartContainer",components:[]};return b.components.push(d),this.setCartCounters(c),this.createBundleComponentsForFullCart(d,c,null,!1),this.hasHardGoodsInCart(c)&&this.data.showHardGoods()&&this.createHardGoodsComponentForFullCart(d,c,null,!1),this.order.cartHasStandAloneHG=this.cartHasHardGoods,this.createDiscountComponentsForFullCart(d,c,null,!1),this.createTotalsComponentsForFullCart(b,c,null,!1),this.initializeSuccessData(b),this.get("showAddresses")&&this.addressIDsArray.length>0&&this.loadInstallationAddress(),this.get("showContacts")&&this.personIDsArray.length>0&&this.loadContactPersons(),b},checkBundleAvalable:function(a){var b=[];return e.each(a.productOfferings,function(a){a.bundle&&b.push(a.productOfferingInstanceID)},this),b.length>0},callForAddonIfIsBundle:function(a){var b=a.RetrieveQuoteResponse&&a.RetrieveQuoteResponse.order,c=$.Deferred(),d=[];return e.each(b.productOfferings,function(a){a.bundle&&(this.isAnonymousFlow()?d.push(this.fetchAnonymousBundleAddon(a.productOfferingInstanceID)):d.push(this.fetchCustomerBundleAddon(a.productOfferingInstanceID)))},this),$.when.apply($,d).done(function(){c.resolve()}),c.promise()},fetchAnonymousBundleAddon:function(a){return this.models.anonymousBundleAddOnsModel.set({offeringId:a}),this.models.anonymousBundleAddOnsModel.fetch({success:this.handleCustomerOfferingHasAddOnsSuccess,error:this.handleCustomerOfferingHasAddOnsFailure,offeringID:a})},fetchCustomerBundleAddon:function(a){return this.models.customerBundleAddOnsModel.set({customerId:this.get("customerId"),productOfferingId:a}),this.models.customerBundleAddOnsModel.fetch({success:this.handleCustomerOfferingHasAddOnsSuccess,error:this.handleCustomerOfferingHasAddOnsFailure,offeringID:a})},handleCustomerOfferingHasAddOnsSuccess:function(a,b,c){var d=c.offeringID;b&&b.AddOnsDetailsResponse&&(b.AddOnsDetailsResponse.hasAddOns?e.each(b.AddOnsDetailsResponse.addOnsDetails,function(a){this.bundleAddonMap[d]=b.AddOnsDetailsResponse.hasAddOns,this.bundleAddonDetails[d]=a},this):(this.bundleAddonMap[d]=null,this.bundleAddonDetails[d]=null)),console.log("success")},handleCustomerOfferingHasAddOnsFailure:function(a,b,c){console.log("failure")},createFailQuoteMetadata:function(b,c,d){var e,f=!0,g=a.Core.StorageUtil.get("quoteResponse");if(e=g&&b.attributes.productOrderId===g.RetrieveQuoteResponse.order.productOrderID?g:null,this.createTotalsComponents(c,d,e,f),e){var h={template:"cartContainer",components:[]};c.components.push(h),this.createDepositItem(h,e.RetrieveQuoteResponse.order),this.createBundleComponents(h,null,e,f)}},createFailQuoteMetadataFullCart:function(b,c,d){var e,f=!0,g=a.Core.StorageUtil.get("quoteResponse");if(e=g&&b.attributes.productOrderId===g.RetrieveQuoteResponse.order.productOrderID?g:null){var h={template:"cartContainer",components:[]};c.components.push(h),this.createDepositItem(h,e.RetrieveQuoteResponse.order),this.createBundleComponentsForFullCart(h,null,e,f),this.data.showHardGoods()&&this.createHardGoodsComponentForFullCart(h,null,e,f),this.createTotalsComponentsForFullCart(c,d,e,f)}},createHardGoodsComponents:function(a,c,d,f){var g=f?d?d.RetrieveQuoteResponse.order:null:c;if(g.simpleProductsInOrder&&g.simpleProductsInOrder.simpleProductInOrder&&g.simpleProductsInOrder.simpleProductInOrder.length){var h,i=g.simpleProductsInOrder.simpleProductInOrder,j=[],k=[],l=[],m=[],n=g.simpleProductsInOrder.simpleProductAggregatePrice;e.each(i,function(a){var c={};this.getCurrency(c,a),h=c.currencySymbol,subComponents=[{id:e.uniqueId("subHardGood_"),template:"hardGoodsSubComponentTemplate",quantity:a.quantity}],component={id:e.uniqueId("hardGood_"),template:"hardGoodsTemplate",label:a.productSpecification.name,aggregatePrice:a.simpleProductTotalOneTimeCalculatedPrice.finalAmount?a.simpleProductTotalOneTimeCalculatedPrice.finalAmount:"",aggregatePriceWithTax:a.simpleProductTotalOneTimeCalculatedPrice.finalAmountIncludingTax?a.simpleProductTotalOneTimeCalculatedPrice.finalAmountIncludingTax:"",accessoryImage:a.productSpecification&&a.productSpecification.attachments&&a.productSpecification.attachments[0]?a.productSpecification.attachments[0].attachmentLocation:"",editHardGood:this.editHardGood,removeHardGood:this.removeCart,enableCartItemActivities:this.data.enableCartItemActivities,includeTaxInfo:this.includeTaxInfo(),maxItemQuantity:this.data.maxItemQuantity?this.data.maxItemQuantity:1,takeover:this.get("takeover"),isDevice:this.isDevice(a),isAccessory:this.isAccessory(a),currencySymbol:c.currencySymbol,isSubComponentsExpand:b.observable(!0),components:subComponents},component.isDevice?j.push(component):component.isAccessory&&(component.maxQuantity=this.data.maxItemQuantity()>0?this.getMaxQuantityArray(parseInt(this.data.maxItemQuantity())):this.getMaxQuantityArray(10),component.selectedQuantity=[component.quantity],k.push(component))},this),n.length>0&&(this.orderMultipleProductOfferings+=n.length),i.length>0&&(this.orderMultipleProductItems+=i.length);for(var o=0;o<n.length;o++)n[o].businessType.code==this.CART_INFO.BUSINESSTYPE.MD&&j.length?(l=this.createComponentsHeaderForHardGoods(j,this.getString("cm_MicroCart_Device_HG"),n[o].finalAmount,n[o].finalAmountIncludingTax,h),a.components.push(l)):n[o].businessType.code==this.CART_INFO.BUSINESSTYPE.AC&&k.length&&(m=this.createComponentsHeaderForHardGoods(k,this.getString("cm_MicroCart_Accessory_HG"),n[o].finalAmount,n[o].finalAmountIncludingTax,h),a.components.push(m))}},createComponentsHeaderForHardGoods:function(a,c,d,f,g){if(a.length>0)var h={id:e.uniqueId("hardGoodMicrocartHeader_"),balloonLabel:c,template:"hardGoodsHeaderTemplate",isSubComponentsExpand:b.observable(!0),isSubComponentIconVisible:b.observable(!1),includeTaxInfo:this.includeTaxInfo(),finalAmount:b.observable(d),finalAmountIncludingTax:b.observable(f),currencySymbol:g,components:a};return h},createDiscountComponentsForFullCart:function(a,c,d,f){var g=f?d?d.RetrieveQuoteResponse.order:null:c;if(g.otherCrossProductDiscounts){var h,i,j=[];e.each(g.otherCrossProductDiscounts,function(a){i=[];for(var c=0;c<a.crossProductDiscounts.length;c++){h=a.crossProductDiscounts[c],oneTimePrice=h.totalOneTimeCalculatedPrice.finalAmount,recurringPrice=h.totalRecurringCalculatedPrice.finalAmount,name=h.name;var g={};this.getCurrency(g,h);var k={id:e.uniqueId("subComp_"),template:"fullCartDiscountTemplate",oneTimePrice:oneTimePrice,recurringPrice:recurringPrice,currency:g.currencyName,cartTooltipVisible:b.observable(!1),showPrices:f&&!d,isSubComponentsExpand:b.observable(!0),isBalloonComponentName:b.observable(!1),isComponentVisible:!0,isHideComponent:!1,name:name,includeTaxInfo:this.includeTaxInfo(),showTotalPricingInfo:this.data.showTotalPricingInfo,showTaxInfo:this.data.showTaxInfo,currencySymbol:g.currencySymbol,enableCartItemActivities:this.data.enableCartItemActivities};i.push(k)}var l={productName:a.productName,lineOfBusiness:a.productLineOfBusiness,productServiceID:a.productServiceID,installationAddressID:a.installationAddressID?a.installationAddressID:""};this.showContactPersonDetails(a)&&(this.personIDsArray.push(a.person.personID),e.isUndefined(this.contactPersonIDNameMap[a.person.personID])&&(this.contactPersonIDNameMap[a.person.personID]=b.observable("")));var m={id:e.uniqueId("product_"),template:"fullCartDiscountProductTemplate",isProductVisible:b.observable(!1),label:this.setProductLabel(l,""),balloonLabel:this.setLOBDetailsForCPD(l,"",":"),showContactPerson:this.showContactPersonDetails(a),contactPerson:this.showContactPersonDetails(a)?this.contactPersonIDNameMap[a.person.personID]:"",isSubComponentsExpand:b.observable(!0),
components:i,installationAddress:this.getAddressDetails(l),showAddresses:this.showAddressDetails(l)};j.push(m)},this);var k={components:j,name:this.getString("cm_MicroCart_discount"),label:this.getString("cm_MicroCart_discount"),id:e.uniqueId("subComp_"),template:"fullCartDiscountHeaderTemplate",isSubComponentsExpand:b.observable(!1),isBalloonComponentName:b.observable(!1),isComponentVisible:!0,isHideComponent:!1,takeover:this.get("takeover"),enableCartItemActivities:this.data.enableCartItemActivities};a.components.push(k)}},showAddressDetails:function(a){return!(!this.get("showAddresses")||!a.installationAddressID)},getAddressDetails:function(a){var c=b.observable("");return this.showAddressDetails(a)&&(e.isUndefined(this.installationAddressesMap[a.installationAddressID])&&(this.installationAddressesMap[a.installationAddressID]=b.observable("")),this.addressIDsArray.push(a.installationAddressID),c=this.installationAddressesMap[a.installationAddressID]),c},createTotalsComponents:function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o=this.rb.getString("cm_MicroCart_totalHeader"),p=this.setErrorMsg(d,e),q=e?d?d.RetrieveQuoteResponse.order:null:c,r=this.setIsPenalty(q);(!e||e&&d)&&(f=q.totalOneTimeCalculatedPrice.finalAmount,g=q.totalRecurringCalculatedPrice.finalAmount,h=q.totalOneTimeCalculatedPrice.finalAmountIncludingTax,i=q.totalRecurringCalculatedPrice.finalAmountIncludingTax,m=q.totalOneTimeCalculatedPrice.finalTaxAmount,n=q.totalRecurringCalculatedPrice.finalTaxAmount,j=q.totalDeposit.actualAmount,k=q?q.totalPenalty&&q.totalPenalty.finalAmount:null,o=this.rb.getString("cm_MicroCart_totalHeader")+" ("+q.totalOneTimeCalculatedPrice.currency+")",this.set("currencyType",q.totalOneTimeCalculatedPrice.currency),l=q.totalOneTimeCalculatedPrice.currency),this.subViewModels.microCart.set({oneTimePrice:f,recurringPrice:g,currencySymbol:l});var s={id:"CartTotal",template:"cartHeader",oneTimePrice:f,recurringPrice:g,taxOneTime:h,taxRecurring:i,deposit:j,penalty:k,isPenalty:r,currency:o,cartTooltipVisible:b.observable(!1),showErrorMsg:!!p,showPrices:e&&!d,displayRefreshButton:this.get("displayRefreshButton"),cartErrMsg:p,taxOneTimePrice:m,taxRecurringPrice:n,infoTooltipVisible:!1};a.components.push(s)},createTotalsComponentsForFullCart:function(a,c,d,e){var f,g,h,i,j,k={},l=this.setErrorMsg(d,e),m=e?d?d.RetrieveQuoteResponse.order:null:c;this.getCurrency(k,m),(!e||e&&d)&&(f=m.totalOneTimeCalculatedPrice.finalAmount,g=m.totalRecurringCalculatedPrice.finalAmount,h=m.totalOneTimeCalculatedPrice.finalAmountIncludingTax,i=m.totalRecurringCalculatedPrice.finalAmountIncludingTax,taxOneTimePrice=m.totalOneTimeCalculatedPrice.finalTaxAmount,taxRecurringPrice=m.totalRecurringCalculatedPrice.finalTaxAmount,j=m.totalDeposit&&m.totalDeposit.actualAmount?m.totalDeposit.actualAmount:"",this.data.taxOneTime(h),this.data.taxRecurring(i),this.data.currencySymbol(k.currencySymbol),this.data.recurringPrice(g),this.data.oneTimePrice(f)),this.subViewModels.microCart.set({oneTimePrice:f,recurringPrice:g,currencySymbol:this.data.currencySymbol()});var n={id:"CartTotal",template:"cartHeader",oneTimePrice:f,recurringPrice:g,taxOneTime:h,taxRecurring:i,deposit:j,currency:k.currencyName,cartTooltipVisible:b.observable(!1),showErrorMsg:!!l,showPrices:e&&!d,displayRefreshButton:this.get("displayRefreshButton"),cartErrMsg:l,currencySymbol:k.currencySymbol,taxOneTimePrice:taxOneTimePrice,taxRecurringPrice:taxRecurringPrice,takeover:this.get("takeover"),learnAboutTotals:this.learnAboutTotals,showTotalPricingInfo:this.data.showTotalPricingInfo,showTaxInfo:this.data.showTaxInfo,includeTaxInfo:this.includeTaxInfo(),enableCartItemActivities:this.data.enableCartItemActivities,enableCartActivites:this.data.enableCartActivites};a.components.push(n)},createDepositItem:function(a,c){var d=c.productOfferings,f=[],g={id:e.uniqueId("Deposit_"),label:this.rb.getString("cm_MicroCart_Deposit_noColon"),template:"bundlesTemplate",oneTimePrice:c.totalDeposit&&c.totalDeposit.actualAmount?c.totalDeposit.actualAmount:"",isProductsExpand:b.observable(!1),isBalloonBundleName:b.observable(!1),isDeposit:b.observable(!0),deposits:f};this._setLOBNumbering(void 0,!0),g.oneTimePrice&&(e.each(d,function(a){e.each(a.productOrderItems,function(c){if(!c.totalDeposit.actualAmount)return void this.setProductLabel(c,a.name);var d=!this.get("configurationDisplayLevel_HideComponent"),g={id:e.uniqueId("deposit_"),label:this.setProductLabel(c,a.name),oneTimePrice:c.totalDeposit.actualAmount,balloonLabel:this.setLOBName(c),template:"productsTemplate",isSubComponentsExpand:b.observable(!1),isSubComponentIconVisible:b.observable(!1),removeProductIcon:d?b.observable(!1):b.observable(!0),isBalloonProductName:b.observable(!1),productOrderItemType:c.productOrderItemType,components:d&&c.displayableItems?this.createDisplayableItems(c.displayableItems,!0,{productOrderItemID:c.productOrderItemID,productID:c.productID}):[]};f.push(g)},this)},this),a.components.push(g))},createBundleComponents:function(a,c,d,f){var g,h=f?d?d.RetrieveQuoteResponse.order:null:c,i=h.productOfferings,j=0;this._setLOBNumbering(void 0,!0);var k=this.get("showBundleTotalPrice");i&&(i.sort(function(a,b){if(a.productOfferingInstanceID&&b.productOfferingInstanceID)return a.productOfferingInstanceID.localeCompare(b.productOfferingInstanceID)}),e.each(i,function(c){c.productOrderItems&&c.productOrderItems.length&&(j+=c.productOrderItems.length),g={id:e.uniqueId("bundle_"),label:c.name,template:"bundlesTemplate",isProductsExpand:b.observable(!0),isBalloonBundleName:b.observable(!1),oneTimePrice:c.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c.totalRecurringCalculatedPrice.finalAmount,showOfferTotals:"false"!==k&&!this.hasNonProvideOA(c),components:this.createProductsItems(c.productOrderItems,c.name)},a.components.push(g)},this),i&&i.length>0&&(this.orderMultipleProductOfferings+=i.length),j>0&&(this.orderMultipleProductItems+=j))},createBundleComponentsForFullCart:function(a,c,d,f){var g,h=f?d?d.RetrieveQuoteResponse.order:null:c,i=h.productOfferings,j={},k=0;this.order.offers=[],sortedProducts=this.getSortedOrderItems(i),this.isMultipleProduct=!1,sortedProducts&&sortedProducts.length>1&&(this.isMultipleProduct=!0),this._setLOBNumbering(void 0,!0),e.each(sortedProducts,function(c){var d=c.productOrderItems.sort(this.sortOrderitemsByLOB),f=this.bundleAddonDetails[c.productOfferingInstanceID],h=[];this.getCurrency(j,c),this.bundleAddress=b.observable(""),g={id:e.uniqueId("bundle_"),label:this.rb.getString("cm_fullCartWidget_bundle_title")+c.name,template:"bundlesTemplate",isProductsExpand:b.observable(!(this.isMultipleProduct||c.bundle)),isBundleProduct:c.bundle?b.observable(!0):b.observable(!1),isBalloonBundleName:b.observable(!1),currencySymbol:j.currencySymbol,oneTimePrice:c.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c.totalRecurringCalculatedPrice.finalAmount,components:this.createProductsItemsForFullCart(d,c,h,f),removeBundle:this.removeBundle,includeTaxInfo:this.includeTaxInfo(),takeover:this.get("takeover"),enableCartItemActivities:this.data.enableCartItemActivities,bundleAddress:this.bundleAddressesMap[c.id],isBundleAddOn:this.bundleAddonMap[c.productOfferingInstanceID]},a.components.push(g),this.order.offers[k]={isBundle:c.bundle,id:c.id,name:c.name,orderItems:h},k++},this)},createProductsItems:function(a,c){var d=[],f=!1,g=!1,h=!this.get("configurationDisplayLevel_HideComponent"),i=this.subViewModels.productOrder.get("productOrderItems");return this.products=a,e.each(a,function(a){var j={productOrderItemID:a.productOrderItemID,productID:a.productID};this.allProductsInOrder.push(a),"G"===a.productSpecificationLevel&&(g=!0);var k=a.displayableItems?this.createDisplayableItems(a.displayableItems,f,j):[],l=a.displayableSimpleProductReferences?this.createSPSComponents(a.displayableSimpleProductReferences,f,j):[],m=k?k.concat(l):l,n={id:e.uniqueId("product_"),template:"productsTemplate",productOrderItemID:a.productOrderItemID,isProductVisible:b.observable(!1),label:this.setProductLabel(a,c),balloonLabel:this.setBalloonLabel(a,c,a.actionType),isSubComponentsExpand:b.observable(!0),isSubComponentIconVisible:b.observable(!1),removeProductIcon:h?b.observable(!1):b.observable(!0),isBalloonProductName:b.observable(!1),oneTimePrice:a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmount,productSpecificationLevel:a.productSpecificationLevel,removeCart:this.removeCart,productOrderItemID:a.productOrderItemID,isActiveProduct:this.isCurrentProductActive(a),isReadOnlyMode:this.isReadOnlyProduct(i,a),components:h?m:[]};d.push(n)},this),g&&(d=this.sortProductsGLP(d)),d},getMSISDNResource:function(a){var b={characteristicID:"",productSpecContainmentID:"",productID:""};return a&&e.each(a,function(a){if(a.productSpecContainment&&a.productSpecContainment.containedProduct&&a.productSpecContainment.containedProduct.characteristics){var c=a.productSpecContainment.containedProduct.characteristics;e.each(c,function(c){if(c.dynamicProperties){var d=c.dynamicProperties;e.each(d,function(d){"Attribute Business Type"==d.name&&"MSISDN"==d.value.stringValue&&(b.characteristicID=c.ID,b.productSpecContainmentID=a.productSpecContainmentID,b.productID=a.productID)})}})}}),b},createProductsItemsForFullCart:function(a,d,f,g){var h=[],i=!1,j={},k=!this.get("configurationDisplayLevel_HideComponent"),l=0;return e.each(a,function(a){if(this.isChangePlanFlow=b.observable(!1),a){"G"===a.productSpecificationLevel&&(i=!0),this.getCurrency(j,a);var m=!1;a.equipment&&(m=!0);var n=a.lineOfBusiness,o=b.observable(""),p={},q=b.observable(!1),r=d.bundle;switch(n){case c.get("lobs").WS:case c.get("lobs").WL:o=b.observable(t.formatPhoneNumber(a.productServiceID)),p=this.getMSISDNResource(a.displayableItems);break;case c.get("lobs").IN:case c.get("lobs").TV:this.showAddressDetails(a)&&(e.isUndefined(this.installationAddressesMap[a.installationAddressID])&&(this.installationAddressesMap[a.installationAddressID]=b.observable("")),this.addressIDsArray.push(a.installationAddressID),r?e.isUndefined(this.bundleAddressesMap[d.productOfferingInstanceID])&&!e.isUndefined(this.installationAddressesMap[a.installationAddressID])&&(this.bundleAddressesMap[d.id]=this.installationAddressesMap[a.installationAddressID],o=b.observable("")):(q(!0),o=this.installationAddressesMap[a.installationAddressID]))}this.showContactPersonDetails(a)&&(this.personIDsArray.push(a.person.personID),e.isUndefined(this.contactPersonIDNameMap[a.person.personID])&&(this.contactPersonIDNameMap[a.person.personID]=b.observable("")));var s={};s.deviceAdded=[],s.deviceRemoved=[];var u=this.createDisplayableItemsForFullCart(a,!1,s),v=!(!s.isPlanRemoved||!s.isPlanAdded);this.isChangePlanFlow(v);var w=this.getChangedDevices(s),x={id:e.uniqueId("product_"),lob:n,bundleName:d.name,bundleID:d.id,isBundle:r,isAddProductToBundle:1===parseInt(d.productOrderItems.length)?b.observable(!0):b.observable(!1),isActionTypeVisible:a.actionType?b.observable(!0):b.observable(!1),isActionTypeRemove:!(!a.actionType||a.actionType!==this.CART_INFO.ACTION_TYPE_REMOVE_PRODUCT),actionType:a.actionType?this.getDisplayStringLabel(a,q):"",showContactPerson:this.showContactPersonDetails(a),contactPerson:this.showContactPersonDetails(a)?this.contactPersonIDNameMap[a.person.personID]:"",template:"G"===a.productSpecificationLevel?"fullCartSharedProductsTemplate":"fullCartproductsTemplate",showTelNo:a.lineOfBusiness===c.get("lobs").WS&&o?b.observable(!0):b.observable(!1),showAddressInfo:q,addressId:this.installationAddressesMap[a.installationAddressID],installationAddressID:a.installationAddressID?a.installationAddressID:"",isProductVisible:b.observable(!1),label:this.setProductLabel(a,d.name),balloonLabel:this.setBalloonLabelForFullCart(a,d.name,":"),serviceId:o,isSubComponentsExpand:b.observable(!this.data.orderHasMultipleProductItems()),isSubComponentIconVisible:b.observable(!1),removeProductIcon:k?b.observable(!1):b.observable(!0),isBalloonProductName:b.observable(!1),currencySymbol:j.currencySymbol,oneTimePrice:a.totalOneTimeCalculatedPrice?a.totalOneTimeCalculatedPrice.finalAmount:"",oneTimePriceWithTax:a.totalOneTimeCalculatedPrice?a.totalOneTimeCalculatedPrice.finalAmountIncludingTax:"",recurringCalculatedPrice:a.totalRecurringCalculatedPrice?a.totalRecurringCalculatedPrice.finalAmount:"",recurringCalculatedPriceWithTax:a.totalRecurringCalculatedPrice?a.totalRecurringCalculatedPrice.finalAmountIncludingTax:"",productSpecificationLevel:a.productSpecificationLevel,removeCart:this.removeCart,editCart:this.editCart,productOrderItemID:a.productOrderItemID,takeover:this.get("takeover"),enableChangeNumberAllocation:this.get("enableChangeNumberAllocation"),changeTelephoneNo:this.changeTelephoneNo,planName:this.getPlanNameForProduct(a),productOfferingInstanceID:d.productOfferingInstanceID,productID:a.productID,locale:this.getLocale(),salesChannel:this.getSalesChannel(),isEquipment:m,includeTaxInfo:this.includeTaxInfo(),enableCartItemActivities:this.data.enableCartItemActivities,isDeviceChanged:!!(w&&w.length>0),isPlanChanged:this.isChangePlanFlow,devices:w,oldPlan:s.oldPlan?s.oldPlan:"",newPlan:s.newPlan?s.newPlan:"",isChangePlanFlow:this.isChangePlanFlow,MSISDNResourceValue:b.observable(p),showPrice:b.observable(!0),components:k?u:[],addSubscription:this.addSubscription};r&&g&&n==g.lob&&(x.showAddSubscriptionLink=!x.isAddProductToBundle(),x.bundleAddOnProductOfferingProductSpecID=g.productOfferingProductSpecID),h.push(x),f[l]=this.getProductItemDetails(a),l++}},this),i&&(h=this.sortProductsGLPForFullCart(h)),h},getPlanNameForProduct:function(a){if(a&&a.displayableItems&&a.displayableItems.length>0)for(var b=0;b<a.displayableItems.length>0;b++){if(!a.displayableItems[b].businessType||"PLAN"!==a.displayableItems[b].businessType||!a.displayableItems[b].action||a.displayableItems[b].action!==c.get("NPCWidget_Actions").Add_Action)return a.productName;if(!(a.displayableItems[b].displayableBillingOffers&&a.displayableItems[b].displayableBillingOffers.length>0))return a.productName;for(var d=0;d<a.displayableItems[b].displayableBillingOffers.length>0;d++)if(a.displayableItems[b].displayableBillingOffers[d]&&a.displayableItems[b].displayableBillingOffers[d].productSpecPricing&&a.displayableItems[b].displayableBillingOffers[d].productSpecPricing.childPricingSchema&&a.displayableItems[b].displayableBillingOffers[d].productSpecPricing.childPricingSchema.type&&"BASIC"===a.displayableItems[b].displayableBillingOffers[d].productSpecPricing.childPricingSchema.type)return a.displayableItems[b].displayableBillingOffers[d].productSpecPricing.childPricingSchema.name}},getChangedDevices:function(a){if(a.deviceAdded.length>0&&a.deviceRemoved.length>0){var b=a.deviceAdded,c=a.deviceRemoved,d=[];return e.each(b,function(a){e.each(c,function(b){if(a.parentID==b.parentID){var c={};c.newDevice=a.newDevice,c.oldDevice=b.oldDevice,d.push(c)}})}),d}},getProductItemDetails:function(a){var b=null;return e.each(a.displayableItems,function(a){a.displayableBillingOffers&&(a.businessType==this.CART_INFO.PLAN||this.isSharedPlan(a))&&e.each(a.displayableBillingOffers,function(a){a.action!=this.CART_INFO.ACTION_RM&&(b={billingOfferId:a.billingOfferID,productSpecPricingID:a.productSpecPricing.childPricingSchema.id,name:a.name})},this)},this),{lob:a.lineOfBusiness?a.lineOfBusiness:null,isEquipment:a.equipment,productID:a.productID,productOfferingID:a.productOfferingID,productOfferingProductSpecID:a.productOfferingProductSpecID,productOrderItemID:a.productOrderItemID,productSpecificationLevel:a.productSpecificationLevel,plan:b,installationAddressID:a.installationAddressID?a.installationAddressID:null,contactPerson:a.person&&a.person.personID?a.person.personID:null,isChangePlanFlow:this.isChangePlanFlow}},showContactPersonDetails:function(a){return!!(this.get("showContacts")&&a.person&&a.person.personID)},isDevice:function(a){return!!(a&&a.productSpecification&&a.productSpecification.businessType&&a.productSpecification.businessType.code==this.CART_INFO.BUSINESSTYPE.MD)},isAccessory:function(a){return!!(a&&a.productSpecification&&a.productSpecification.businessType&&a.productSpecification.businessType.code==this.CART_INFO.BUSINESSTYPE.AC)},getMaxQuantityArray:function(a){var b,c=[],d=1;for(b=0;b<a;b++)c[b]=d,d++;return c},hasHardGoodsInCart:function(a){return!!(a.simpleProductsInOrder&&a.simpleProductsInOrder.simpleProductInOrder&&a.simpleProductsInOrder.simpleProductInOrder.length>0)&&(this.cartHasHardGoods=!0,!0)},createHardGoodsComponentForFullCart:function(a,b,c,d){var f,g=d?c?c.RetrieveQuoteResponse.order:null:b,h=g.simpleProductsInOrder.simpleProductInOrder,i=[],j=[],k=[],l=[],m=g.simpleProductsInOrder.simpleProductAggregatePrice,n=g.productOrderReferenceNumber,o=0;this.order.hardGoods=[],e.each(h,function(a){var b={};this.getCurrency(b,a),f=b.currencySymbol,component={id:e.uniqueId("hardGood_"),template:"fullCartHardgoodsTemplate",name:a.productSpecification.name,quantity:a.quantity,aggregatePrice:a.simpleProductTotalOneTimeCalculatedPrice.finalAmount?a.simpleProductTotalOneTimeCalculatedPrice.finalAmount:"",aggregatePriceWithTax:a.simpleProductTotalOneTimeCalculatedPrice.finalAmountIncludingTax?a.simpleProductTotalOneTimeCalculatedPrice.finalAmountIncludingTax:"",accessoryImage:a.productSpecification&&a.productSpecification.attachments&&a.productSpecification.attachments[0]?a.productSpecification.attachments[0].attachmentLocation:"",editHardGood:this.editHardGood,removeHardGood:this.removeCart,enableCartItemActivities:this.data.enableCartItemActivities,includeTaxInfo:this.includeTaxInfo(),maxItemQuantity:this.data.maxItemQuantity?this.data.maxItemQuantity():1,takeover:this.get("takeover"),showImages:this.data.showImages(),isDevice:this.isDevice(a),isAccessory:this.isAccessory(a),currencySymbol:b.currencySymbol,updateHardGoodsQuantity:this.updateHardGoodsQuantity,productOrderItemID:a.productOrderItemID,productOrderReferenceNumber:n,productOrderItemReferenceNumber:a.productOrderItemReferenceNumber,orderID:this.data.productOrderId(),businessType:a.productSpecification.businessType.code,catalogID:a.productSpecification.id},component.isDevice?i.push(component):component.isAccessory&&(component.maxQuantity=this.data.maxItemQuantity()>0?this.getMaxQuantityArray(parseInt(this.data.maxItemQuantity())):this.getMaxQuantityArray(10),component.selectedQuantity=[component.quantity],j.push(component)),this.order.hardGoods[o]={catalogID:a.productSpecification.id,name:a.productSpecification.name},o++},this);for(var p=0;p<m.length;p++)m[p].businessType.code==this.CART_INFO.BUSINESSTYPE.MD&&i.length?(isDevice=!0,isAccessory=!1,k=this.createComponentsHeaderForHardGoodsFullCart(i,isDevice,isAccessory,this.getString("cm_fullCart_Device_HG"),m[p].finalAmount,m[p].finalAmountIncludingTax,f),a.components.push(k)):m[p].businessType.code==this.CART_INFO.BUSINESSTYPE.AC&&j.length&&(isDevice=!1,isAccessory=!0,l=this.createComponentsHeaderForHardGoodsFullCart(j,isDevice,isAccessory,this.getString("cm_fullCart_Accessory_HG"),m[p].finalAmount,m[p].finalAmountIncludingTax,f),a.components.push(l))},createComponentsHeaderForHardGoodsFullCart:function(a,c,d,f,g,h,i){if(a.length>0)var j={id:e.uniqueId("hardGoodHeader_"),template:"fullCartHardgoodsHeaderTemplate",isSubComponentsExpand:b.observable(!this.data.orderHasMultipleProductItems()),balloonLabel:f,includeTaxInfo:this.includeTaxInfo(),finalAmount:b.observable(g),finalAmountIncludingTax:b.observable(h),currencySymbol:i,isDevice:c,isAccessory:d,components:a};return j},includeTaxInfo:function(){return!(!this.data.showTaxInfo()||!this.data.showTotalPricingInfo())},editCart:function(a){w.trigger("action:editCart",a)},getDisplayStringLabel:function(a,b){var d=a.lineOfBusiness;if(a.equipment)return this.getDisplayableStringForEquipment(a);switch(d){case c.get("lobs").WS:case c.get("lobs").IN:case c.get("lobs").WL:case c.get("lobs").TV:return this.getDisplayableStringForActionType(a)+" "+this.setLOBName(a);default:return""}},getDisplayableStringForActionType:function(a){return a.actionType==this.CART_INFO.ACTION_TYPE_ADD_PRODUCT?this.getString("cm_fullCartWidget_NewSubscription"):a.actionType==this.CART_INFO.ACTION_TYPE_CHANGE_PRODUCT&&a.productServiceID?this.getString("cm_fullCartWidget_UpdateSubscription"):""},getDisplayableStringForEquipment:function(a){return a.actionType==this.CART_INFO.ACTION_TYPE_REMOVE_PRODUCT?this.getString("cm_fullCartWidget_equipment_removed"):a.actionType==this.CART_INFO.ACTION_TYPE_ADD_PRODUCT?this.getString("cm_fullCartWidget_equipment_add"):a.actionType==this.CART_INFO.ACTION_TYPE_CHANGE_PRODUCT?this.getString("cm_fullCartWidget_equipment_update"):""},createDisplayableItems:function(a,c,d){var f=[];return e.each(a,function(a){var g=a.displayableItems?this.createDisplayableItems(a.displayableItems,c,d):[],h=a.displayableSimpleProductReferences?this.createSPSComponents(a.displayableSimpleProductReferences,c,d):[],i=g?g.concat(h):h,j={productSpecContainmentID:a.productSpecContainmentID,temporaryID:a.temporaryID,productID:d.productID,productOrderItemID:d.productOrderItemID},k={id:e.uniqueId("subComp_"),template:"subComponentTemplate",isSubComponentsExpand:b.observable(!0),isComponentIconRemoved:this.isComponentIconRemoved(a,c),label:a.name,isBalloonComponentName:b.observable(!1),oneTimePrice:c?a.totalDeposit.actualAmount:a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c?void 0:a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmount,displayableBillingOffers:c?null:a.displayableBillingOffers?this.createBillingOffers(a.displayableBillingOffers,j):[],isComponentVisible:!!c||this.isComponentVisible(a),isHideComponent:!c&&!this.isComponentVisible(a),components:i};c&&k.oneTimePrice?f.push(k):c||f.push(k)},this),f},createInnerDisplayableItemsForFullCart:function(a,c,d,f,g){var h=[];return e.each(a,function(a){if(a.businessType==this.CART_INFO.COMMITMENT&&!this.isDisplayableCommitment(a))return!1;var i=a.displayableItems?this.createInnerDisplayableItemsForFullCart(a.displayableItems,c,d,f,g):[],j=a.displayableSimpleProductReferences?this.createSPSComponents(a.displayableSimpleProductReferences,c,d):[],k=i?i.concat(j):j,l=(a.productSpecContainmentID,a.temporaryID,d.productID,d.productOrderItemID,{});this.getCurrency(l,a);var m={id:e.uniqueId("subComp_"),template:"subComponentTemplate",isSubComponentsExpand:b.observable(!0),isComponentIconRemoved:this.isComponentIconRemoved(a,c),label:a.name,isBalloonComponentName:b.observable(!1),oneTimePriceWithTax:a.totalOneTimeCalculatedPrice?a.totalOneTimeCalculatedPrice.finalAmountIncludingTax:"",recurringCalculatedPriceWithTax:a.totalRecurringCalculatedPrice?a.totalRecurringCalculatedPrice.finalAmountIncludingTax:"",oneTimePrice:c?a.totalDeposit.actualAmount:a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c?void 0:a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmount,displayableBillingOffers:c?null:a.displayableBillingOffers?this.createBillingOffersForFullCart(a,f,g):[],isComponentVisible:!!c||this.isComponentVisible(a),isHideComponent:!c&&!this.isComponentVisible(a),currency:l.currencyName,currencySymbol:l.currencySymbol,enableCartItemActivities:this.data.enableCartItemActivities,isChangePlanFlow:this.isChangePlanFlow,showPrice:b.observable(!0),isInnerLevelDisplayableitem:b.observable(!0),components:k,serviceName:a.name,actionType:g?g.actionType:"",isComponentPricePresent:this.isComponentPricePresent(a)};a.action!=this.CART_INFO.ACTION_SU&&a.action!=this.CART_INFO.ACTION_RE&&a.action!=this.CART_INFO.ACTION_UP&&a.action!=this.CART_INFO.ACTION_RM&&a.action!=this.CART_INFO.ACTION_AD||(m.action=this.getLabelForAction(a),m.showAction=!0,m.isChangePlanFlow=this.isChangePlanFlow),a.businessType==this.CART_INFO.COMMITMENT&&(m.template="fullCartPlanCommitmentSubCompTemplate"),this.isPricePresent(a)&&m.displayableBillingOffers&&m.displayableBillingOffers.length>0&&(m.showPrice=b.observable(!1)),h.push(m)},this),h},createDisplayableItemsForFullCart:function(a,c,d){var f=a.displayableItems,g=a.displayableSimpleProductReferences?this.createSPSComponentsForFullCart(a.displayableSimpleProductReferences,c,d,a.productID,a):[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=[],p=[],q=[],r=[],s=[],t=[],u={productOrderItemID:a.productOrderItemID,productID:a.productID};return e.each(f,function(f){var g=f,j={};if(!this.isMainComponent(f))if(f.displayableSimpleProductReferences){var l=this.createSPSComponentsForFullCart(f.displayableSimpleProductReferences,c,d,a.productID,a),n=this.checkIfChangePlanFlow(g,g.displayableBillingOffers,d);k.productActionType=a.actionType,k.isChangePlanFlow=n,o.productActionType=a.actionType,o.isChangePlanFlow=n,l.channels.length>0&&(k=k.concat(l.channels)),l.packages.length>0&&(o=o.concat(l.packages)),l.device.length>0&&(q=q.concat(l.device))}else if(a.equipment&&this.isDisplayableEquipment(f))s=s.concat(this.createEquipmentComponent(f,c,d,a));else{f.businessType==this.CART_INFO.PLAN&&e.each(f.displayableItems,function(a){a.displayableBillingOffers=null},this);var p=f.displayableItems?this.createInnerDisplayableItemsForFullCart(f.displayableItems,c,u,d,a):[],r=f.displayableSimpleProductReferences?this.createSPSComponents(f.displayableSimpleProductReferences,c):[],t=p?p.concat(r):r;this.getCurrency(j,f);var v={id:e.uniqueId("subComp_"),template:"subComponentTemplate",showPrice:b.observable(!0),ShowTitle:b.observable(!1),isSubComponentsExpand:b.observable(!0),isComponentIconRemoved:this.isComponentIconRemoved(f,c),label:f.name,isBalloonComponentName:b.observable(!1),currencySymbol:j.currencySymbol,oneTimePrice:c?f.totalDeposit.actualAmount:f.totalOneTimeCalculatedPrice&&f.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c?void 0:f.totalRecurringCalculatedPrice&&f.totalRecurringCalculatedPrice.finalAmount,displayableBillingOffers:c?null:f.displayableBillingOffers?this.createBillingOffersForFullCart(f,d,a):[],isComponentVisible:!!c||this.isComponentVisible(f),isHideComponent:!c&&!this.isComponentVisible(f),oneTimePriceWithTax:f.totalOneTimeCalculatedPrice?f.totalOneTimeCalculatedPrice.finalAmountIncludingTax:"",recurringCalculatedPriceWithTax:f.totalRecurringCalculatedPrice?f.totalRecurringCalculatedPrice.finalAmountIncludingTax:"",components:t,takeover:this.get("takeover"),includeTaxInfo:this.includeTaxInfo(),showAction:!1,enableCartItemActivities:this.data.enableCartItemActivities,isChangePlanFlow:this.isChangePlanFlow,showPrice:b.observable(!0),productID:a.productID,serviceName:f.name};this.isDisplayableItemPlan(a,f)?(v.template="planComponentTemplate","G"===a.productSpecificationLevel?v.label="Shared "+this.getString("cm_fullCartWidget_Plan"):v.label=this.getString("cm_fullCartWidget_Plan"),v.productID=f.productID,v.productSpecContainmentID=f.productSpecContainmentID,v.changePlan=this.changePlan,v.isChangePlanFlow=this.isChangePlanFlow,v.lob=a.lineOfBusiness,v.showComponent=this.showComponent(f,v,a.actionType),e.each(f.displayableItems,function(a){a.displayableBillingOffers=null,this.isDisplayableCommitment(a)&&(commitmentComponents=this.getPlanCommitmentComponent(a.displayableCharacteristics,c),t[0].displayableBillingOffers=t[0].displayableBillingOffers.concat(commitmentComponents))},this),h.push(v)):f.businessType===this.CART_INFO.STB?(f.productSpecContainment&&f.productSpecContainment.containedProduct&&f.productSpecContainment.containedProduct.attachments?(v.template="deviceComponentTemplate",v.deviceImage=f.productSpecContainment.containedProduct.attachments[0].attachmentLocation,v.showImages=this.data.showImages,v.action=this.getLabelForAction(f),v.showAction=!0,v.isChangePlanFlow=this.isChangePlanFlow,v.isDevice=!1,v.isReceiver=!0,v.actionType=a.actionType):v.template="subComponentTemplate",m.push(v)):f.businessType===this.CART_INFO.SHARED_EQUIPMENT?s.push(v):this.getServiceComponent(f,v,c,i,a)}},this),g.device&&g.device.length>0&&(q=q.concat(g.device)),r=this.createComponentsHeaderForFullCart(q,this.getString("cm_MicroCart_Device")),n=this.createComponentsHeaderForFullCart(m,this.getString("cm_fullCartWidget_Receiver"),a),l=this.createComponentsHeaderForFullCart(this.getChannelComponentsForFullCart(g,k),this.getString("cm_fullCartWidget_Channels"),a),p=this.createComponentsHeaderForFullCart(this.getPackageComponentsForFullCart(g,o),this.getString("cm_fullCartWidget_Packages"),a),t=this.createComponentsHeaderForFullCart(s,this.getString("cm_MicroCart_Device")),grpServiceComponentHeader=this.createComponentsHeaderForFullCart(i,this.getString("cm_fullCartWidget_Services")),n.concat(t).concat(h).concat(r).concat(grpServiceComponentHeader).concat(l).concat(p).concat(j)},isDisplayableCommitment:function(a){return!!(a.businessType===this.CART_INFO.COMMITMENT&&a.displayableCharacteristics&&a.displayableCharacteristics.length>0&&a.action!=this.CART_INFO.ACTION_RM)},showComponent:function(a,b,c){return"TV"!==b.lob||c!=this.CART_INFO.ACTION_TYPE_CHANGE_PRODUCT||!e.isEmpty(b.action)||!e.isEmpty(a.action)},getServiceComponent:function(a,c,d,f,g){c.businessType=this.CART_INFO.SERVICE,c.actionType=g.actionType,(a.action==this.CART_INFO.ACTION_UP||!e.isEmpty(a.displayableItems)&&this.isChildChanged(a.displayableItems)||this.isPricePresent(a))&&(c.showPrice=b.observable(!1),e.isEmpty(a.action)?d&&c.oneTimePrice&&e.isUndefined(a.displayableSimpleProductReferences)?f.push(c):!d&&e.isUndefined(a.displayableSimpleProductReferences)&&f.push(c):(c.action=this.getLabelForAction(a),c.showAction=!0,f.push(c)))},isChildChanged:function(a){for(var b=0;b<a.length;b++)if(!e.isEmpty(a[b].action))return!0;return!1},isPricePresent:function(a){var b=a.totalOneTimeCalculatedPrice,c=a.totalRecurringCalculatedPrice;if(void 0!=b&&!e.isEmpty(b)||void 0!=c&&!e.isEmpty(c))return!0;if(a.action)return!0;if(!(a.displayableItems&&a.displayableItems.length>0))return!1;var d=!1;for(i=0;i<a.displayableItems.length;i++){var f=a.displayableItems[i].totalOneTimeCalculatedPrice,g=a.displayableItems[i].totalRecurringCalculatedPrice;if(void 0!=f&&!e.isEmpty(f)||void 0!=g&&!e.isEmpty(g))return d=!0,!0}return 0!=d&&void 0},getLabelForAction:function(a){return a.action==this.CART_INFO.ACTION_RM?this.getString("cm_fullCartWidget_item_removed"):a.action==this.CART_INFO.ACTION_AD?this.getString("cm_fullCartWidget_item_added"):a.action==this.CART_INFO.ACTION_SU?this.getString("cm_fullCartWidget_item_suspended"):a.action==this.CART_INFO.ACTION_RE?this.getString("cm_fullCartWidget_item_resumed"):a.action==this.CART_INFO.ACTION_UP?this.getString("cm_fullCartWidget_item_updated"):""},getPlanCommitmentComponent:function(a,c){var d=[];return e.each(a,function(a){var c;a.productSpecCharacteristic.name===this.rb.getString("cm_fullCartWidget_commitment_duration")?c=a.value+" Months":(date=new Date(parseInt(a.value)),c=f.getDateString(date,!1,9));var g={id:e.uniqueId("billingOffer_"),template:"billingOfferTemplate",showPrice:b.observable(!1),ShowTitle:b.observable(!1),isSubComponentsExpand:b.observable(!1),label:a.productSpecCharacteristic.name+" : "+c,isBalloonComponentName:b.observable(!1),takeover:this.get("takeover"),includeTaxInfo:this.includeTaxInfo(),enableCartItemActivities:this.data.enableCartItemActivities,isBOVisible:!0,isPlan:!1,isBalloonBOName:b.observable(!1),isChangePlanFlow:this.isChangePlanFlow};d=d.concat(g)},this),d},isDisplayableEquipment:function(a){return!!(a.businessType===this.CART_INFO.SHARED_EQUIPMENT||a.displayableItems&&a.displayableItems[0].businessType===this.CART_INFO.SHARED_EQUIPMENT)},createEquipmentComponent:function(a,c,d,f){var g=a;a.displayableItems&&(g=a.displayableItems[0]);var h={};this.getCurrency(h,g);var i={id:e.uniqueId("subComp_"),template:"subComponentTemplate",isSubComponentsExpand:b.observable(!0),isComponentIconRemoved:this.isComponentIconRemoved(g),label:g.name,isBalloonComponentName:b.observable(!1),currencySymbol:h.currencySymbol,
oneTimePrice:g.totalOneTimeCalculatedPrice?g.totalOneTimeCalculatedPrice.finalAmount:"",recurringCalculatedPrice:g.totalRecurringCalculatedPrice?g.totalRecurringCalculatedPrice.finalAmount:"",displayableBillingOffers:c?null:g.displayableBillingOffers?this.createBillingOffersForFullCart(g,d,f):[],isComponentVisible:!!c||this.isComponentVisible(g),oneTimePriceWithTax:g.totalOneTimeCalculatedPrice?g.totalOneTimeCalculatedPrice.finalAmountIncludingTax:"",recurringCalculatedPriceWithTax:g.totalRecurringCalculatedPrice?g.totalRecurringCalculatedPrice.finalAmountIncludingTax:"",takeover:this.get("takeover"),includeTaxInfo:this.includeTaxInfo(),isChangePlanFlow:!1,enableCartItemActivities:this.data.enableCartItemActivities,showPrice:b.observable(!0),components:[]};return g.productSpecContainment.containedProduct.attachments&&(i.template="deviceComponentTemplate",i.deviceImage=g.productSpecContainment.containedProduct.attachments[0].attachmentLocation,i.showImages=this.data.showImages,i.isDevice=!1),i},isMainComponent:function(a){return!0===a.main},isDisplayableItemPlan:function(a,b){if(e.isUndefined(b.action)&&b.businessType===this.CART_INFO.PLAN)return!!b.benefitsDisplay||!!(b.displayableItems&&b.displayableItems.length>0);if(e.isUndefined(b.displayableBillingOffers)||0===b.displayableBillingOffers.length)return!1;if(b.businessType===this.CART_INFO.PLAN)return!0;if(b.displayableBillingOffers&&b.displayableBillingOffers.length>0&&"G"===a.productSpecificationLevel)for(var c=0;c<b.displayableBillingOffers.length;c++){var d=b.displayableBillingOffers[c];if(d&&d.productSpecPricing&&d.productSpecPricing.childPricingSchema&&"BASIC"===d.productSpecPricing.childPricingSchema.type)return!0}return!1},getChannelComponentsForFullCart:function(a,b){return a.channels&&a.channels.length>0&&(b=b.concat(a.channels)),b},getPackageComponentsForFullCart:function(a,b){return a.packages&&a.packages.length>0&&(b=b.concat(a.packages)),b},createComponentsHeaderForFullCart:function(a,c,d){var f=[];if(a.length>0){var g={id:e.uniqueId("subComp_"),template:"subComponentTemplate",isSubComponentsExpand:b.observable(!0),title:c,label:null,ShowTitle:!0,isBalloonComponentName:b.observable(!1),isComponentVisible:!0,isHideComponent:!1,includeTaxInfo:this.includeTaxInfo(),components:a,takeover:this.get("takeover"),isChangePlanFlow:this.isChangePlanFlow,showPrice:b.observable(!0),enableCartItemActivities:this.data.enableCartItemActivities,showAddLink:this.checkIfContainsChannel(a),addLinkString:this.getStringForAddLink(a[0]),isChannel:this.get("isChannel"),isReceiver:this.isReceiver(c),isLeafComponent:b.observable(!1),isTV:this.get("isTV"),actionType:!!d&&d.actionType,assignedProductId:d&&d.productID?d.productID:void 0};f.push(g)}return f},isReceiver:function(a){var c=this.getString("cm_fullCartWidget_Receiver")===a;return b.observable(c)},getStringForAddLink:function(a){return a.header===this.getString("cm_TV_CHANNEL")?(this.set("isChannel",b.observable(!0)),this.set("isTV",b.observable(!0)),this.getString("cm_FullCart_add_another_TV_channel")):a.header===this.getString("cm_TV_PACKAGE")?(this.set("isChannel",b.observable(!1)),this.set("isTV",b.observable(!0)),this.getString("cm_FullCart_add_another_TV_package")):(this.set("isChannel",b.observable(!1)),void this.set("isTV",b.observable(!1)))},checkIfContainsChannel:function(a){if(this.CART_INFO.ACTION_TYPE_CHANGE_PRODUCT&&!a.isChangePlanFlow)for(var b=0;b<a.length;b++)if(!(a[b].header!==this.getString("cm_TV_CHANNEL")&&a[b].header!==this.getString("cm_TV_PACKAGE")||a[b].action!=this.getString("cm_fullCartWidget_item_added")&&a[b].action!=this.getString("cm_fullCartWidget_item_removed")))return!0},checkIfChangePlanFlow:function(a,b,c){var d=this;return e.each(b,function(b){d.isBillingOfferRemoved(b)&&a.businessType==d.CART_INFO.PLAN?d.getRemovedBillingOfferInfo(c,b):a.businessType==d.CART_INFO.PLAN&&(c.newPlan=b.name,c.isPlanAdded=!0)}),!(!c.isPlanRemoved||!c.isPlanAdded)},getChangePlan:function(a){return"function"==typeof a?a():a},isDisplayableProductRemoved:function(a){return a.action==this.CART_INFO.ACTION_RM&&a.businessType==this.CART_INFO.DEVICE},getRemovedDisplayableProduct:function(a,b){if(b.businessType==this.CART_INFO.DEVICE){var c={};c.parentID=b.parentID,c.oldDevice=b.name,a.deviceRemoved.push(c)}},getAddedDevice:function(a,b){if(b.action=this.CART_INFO.ACTION_AD){var c={};c.newDevice=b.name,c.parentID=b.parentID,a.deviceAdded.push(c)}},getCurrency:function(a,b){b.totalOneTimeCalculatedPrice&&b.totalOneTimeCalculatedPrice.currency?a.currencyName=b.totalOneTimeCalculatedPrice.currency:b.totalRecurringCalculatedPrice&&b.totalRecurringCalculatedPrice.currency?a.currencyName=b.totalRecurringCalculatedPrice.currency:a.currencyName=this.getString("cm_MicroCart_default_currency"),a.currencyName?a.currencySymbol=this.getString(a.currencyName):a.currencySymbol=this.getString("cm_MicroCart_default_currency")},createSPSComponentsForFullCart:function(a,c,d,f,g){var h=[],i=[],j=[],k={};return e.each(a,function(f){if(this.isDisplayableProductRemoved(f))this.getRemovedDisplayableProduct(d,f);else{this.getCurrency(k,a),f.displayableBillingOffers=null,e.each(f.displayableItems,function(a){a.displayableBillingOffers=null},this);var l={id:e.uniqueId("subComp_"),template:"subComponentTemplate",isSubComponentsExpand:b.observable(!0),isNewlyAdded:this.isNewlyAdded(f,g.actionType),actionType:g.actionType,isComponentIconRemoved:this.isComponentIconRemoved(f),label:f.name,isBalloonComponentName:b.observable(!1),currencySymbol:k.currencySymbol,oneTimePrice:c?f.totalDeposit.actualAmount:f.totalOneTimeCalculatedPrice&&f.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c?void 0:f.totalRecurringCalculatedPrice&&f.totalRecurringCalculatedPrice.finalAmount,displayableBillingOffers:c?null:f.displayableBillingOffers?this.createBillingOffersForFullCart(f,d,g):[],isComponentVisible:!!c||this.isComponentVisible(f),header:f.businessType,takeover:this.get("takeover"),enableCartItemActivities:this.data.enableCartItemActivities,oneTimePriceWithTax:f.totalOneTimeCalculatedPrice?f.totalOneTimeCalculatedPrice.finalAmountIncludingTax:"",recurringCalculatedPriceWithTax:f.totalRecurringCalculatedPrice?f.totalRecurringCalculatedPrice.finalAmountIncludingTax:"",includeTaxInfo:this.includeTaxInfo(),replaceDevice:this.replaceDevice,showImages:!1,isChangePlanFlow:!1,showPrice:b.observable(!0),showAction:!1,action:this.getLabelForAction(f),productID:f.productID,components:[],isLeafComponent:b.observable(!0)};switch(f.businessType){case this.CART_INFO.DEVICE:this.getAddedDevice(d,f),l.isChangePlanFlow=this.isChangePlanFlow,l.isDevice=!0,l.deviceId=f.simpleProductSpecID,l.productId=f.productID;case this.CART_INFO.SHARED_EQUIPMENT:l.template="deviceComponentTemplate",l.header=this.getString("cm_MicroCart_Device"),f.productSpecContainment&&f.productSpecContainment.containedProduct&&f.productSpecContainment.containedProduct&&f.productSpecContainment.containedProduct.attachments&&f.productSpecContainment.containedProduct.attachments.length>0&&f.productSpecContainment.containedProduct.attachments[0]&&(l.deviceImage=f.productSpecContainment.containedProduct.attachments[0].attachmentLocation,l.showImages=this.data.showImages),c&&l.oneTimePrice?h.push(l):c||h.push(l);break;case this.CART_INFO.CHANNEL:l.isChangePlanFlow=this.isChangePlanFlow,l.showAction=!0,i.push(l);break;case this.CART_INFO.PACKAGE:l.isChangePlanFlow=this.isChangePlanFlow,l.showAction=!0,j.push(l)}}},this),{device:h,channels:i,packages:j}},createSPSComponents:function(a,c,d){var f=[];return e.each(a,function(a){var g={productSpecContainmentID:a.productSpecContainmentID,temporaryID:a.temporaryID,productOrderItemID:d.productOrderItemID,productID:d.productID},h={id:e.uniqueId("subComp_"),template:"subComponentTemplate",isSubComponentsExpand:b.observable(!0),isComponentIconRemoved:this.isComponentIconRemoved(a),label:a.name,isBalloonComponentName:b.observable(!1),oneTimePrice:c?a.totalDeposit.actualAmount:a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:c?void 0:a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmount,displayableBillingOffers:c?null:a.displayableBillingOffers?this.createBillingOffers(a.displayableBillingOffers,g):[],isComponentVisible:!!c||this.isComponentVisible(a),components:[]};c&&h.oneTimePrice?f.push(h):c||f.push(h)},this),f},createBillingOffers:function(a,c){var d=[];return e.each(a,function(a){var f={managePricingID:c.productID+"_"+c.productSpecContainmentID+"_"+a.productSpecPricingID+"_"+c.temporaryID,id:e.uniqueId("billingOffer_"),billingOfferID:a.billingOfferID,billingOfferTooltipID:e.uniqueId("billingOfferTooltip_"),template:"billingOfferTemplate",label:a.name,oneTimePrice:a.totalOneTimeCalculatedPrice&&a.totalOneTimeCalculatedPrice.finalAmount,oneTimePriceOverrideType:a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices[0].allowedOverrideType,oneTimeOverrideAmount:(a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices[0].overrideAmount)!=(a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices[0].originalAmount)?a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices[0].overrideAmount:null,oneTimeOverrideReason:a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices[0].overrideReason,oneTimeOriginalAmount:a.oneTimeCalculatedPrices&&a.oneTimeCalculatedPrices[0].originalAmount,recurringCalculatedPrice:a.totalRecurringCalculatedPrice&&a.totalRecurringCalculatedPrice.finalAmount,recurringCalculatedPriceOverrideType:a.recurringCalculatedPrices&&a.recurringCalculatedPrices[0].allowedOverrideType,recurringCalculatedOverrideAmount:(a.recurringCalculatedPrices&&a.recurringCalculatedPrices[0].overrideAmount)!=(a.recurringCalculatedPrices&&a.recurringCalculatedPrices[0].originalAmount)?a.recurringCalculatedPrices&&a.recurringCalculatedPrices[0].overrideAmount:null,recurringCalculatedOverrideReason:a.recurringCalculatedPrices&&a.recurringCalculatedPrices[0].overrideReason,recurringCalculatedOriginalAmount:a.recurringCalculatedPrices&&a.recurringCalculatedPrices[0].originalAmount,isBOVisible:this.isBOVisible(a),isBalloonBOName:b.observable(!1),isPenalty:this.isBOPenalty(a),isCrossProductDiscount:a.crossProductDiscount,description:a.productSpecPricing.childPricingSchema.description,reason:a.crossProductDiscount?a.crossProductDiscountRuleDescription:null,status:a.status,action:this.decodeAction(a.action)&&" ; "+this.decodeAction(a.action),CPDIndication:a.crossProductDiscount?this.getString("cm_ManagePricing_CPDindecation",[this.decodeAction(a.action)&&" ; "+this.decodeAction(a.action)]):"",infoTooltipVisible:b.observable(!1),productSpecPricingID:a.productSpecPricingID,parentProductSpecContainmentID:c.productSpecContainmentID,parentTemporaryID:c.temporaryID,productID:c.productID,productOrderItemID:c.productOrderItemID};d.push(f),f.isCrossProductDiscount&&this.subViewModels.microCart.set({isCrossProductDiscount:f.isCrossProductDiscount})},this),d},isSharedPlan:function(a){return"Shared Plan"===a.name},createBillingOffersForFullCart:function(a,c,d){var f=a.displayableBillingOffers,g=[],h={};return e.each(f,function(f){if(f.action)if(this.isBillingOfferRemoved(f)&&a.businessType==this.CART_INFO.PLAN)this.getRemovedBillingOfferInfo(c,f);else{var i=!1;this.getCurrency(h,f),a.businessType==this.CART_INFO.PLAN&&(c.newPlan=f.name,c.isPlanAdded=!0,i=!0),this.isSharedPlan(a)&&(i=!0);var j={id:e.uniqueId("billingOffer_"),template:"billingOfferTemplate",label:f.name,currencySymbol:h.currencySymbol,oneTimePrice:f.totalOneTimeCalculatedPrice&&f.totalOneTimeCalculatedPrice.finalAmount,recurringCalculatedPrice:f.totalRecurringCalculatedPrice&&f.totalRecurringCalculatedPrice.finalAmount,includeTaxInfo:this.includeTaxInfo(),oneTimePriceWithTax:f.totalOneTimeCalculatedPrice?f.totalOneTimeCalculatedPrice.finalAmountIncludingTax:"",recurringCalculatedPriceWithTax:f.totalRecurringCalculatedPrice?f.totalRecurringCalculatedPrice.finalAmountIncludingTax:"",isBOVisible:this.isBOVisible(f),isBalloonBOName:b.observable(!1),isDisplayableBillingOffer:!1,isChangePlanFlow:this.isChangePlanFlow,isPlan:i,enableCartItemActivities:this.data.enableCartItemActivities,action:this.getLabelForAction(f),actionType:d?d.actionType:""};f.action!=this.CART_INFO.ACTION_UP&&f.action!=this.CART_INFO.ACTION_RM&&f.action!=this.CART_INFO.ACTION_AD||a.businessType==this.CART_INFO.PLAN||j.actionType!==this.CART_INFO.ACTION_TYPE_CHANGE_PRODUCT||(j.action=this.getLabelForAction(f),j.isDisplayableBillingOffer=!0,j.isBOVisible=!0),g.push(j)}},this),g},getRemovedBillingOfferInfo:function(a,b){a.oldPlan=b.name,a.isPlanRemoved=!0},isBillingOfferRemoved:function(a){return a.action==this.CART_INFO.ACTION_RM},isComponentVisible:function(a){return!(!a.displayInformation||!a.displayInformation.showStructure)},isComponentPricePresent:function(a){var b=a.totalOneTimeCalculatedPrice,c=a.totalRecurringCalculatedPrice;return void 0!=b&&!e.isEmpty(b)||void 0!=c&&!e.isEmpty(c)},isNewlyAdded:function(a,b){return!(a.businessType!==this.CART_INFO.CHANNEL&&a.businessType!==this.CART_INFO.PACKAGE&&a.businessType!==this.CART_INFO.SERVICE&&!a.isReceiver||e.isEmpty(a.action)||b!==this.CART_INFO.ACTION_TYPE_CHANGE_PRODUCT)},isComponentIconRemoved:function(a,b){var c=!1;return this.isComponentVisible(a)&&(a.displayableItems?e.each(a.displayableItems,function(a){this.isComponentVisible(a)&&(c=!0)},this):a.displayableSimpleProductReferences?e.each(a.displayableSimpleProductReferences,function(a){this.isSPSVisible(a)&&(c=!0)},this):!b&&a.displayableBillingOffers&&e.each(a.displayableBillingOffers,function(a){c=this.isBOVisible(a)},this)),!c},isSPSVisible:function(a){return!(!a.displayInformation||"true"!==a.displayInformation.showStructure)},isBOVisible:function(a){return!(!a.displayInformation||!1===a.displayInformation.visible||!a.totalOneTimeCalculatedPrice&&!a.totalRecurringCalculatedPrice)},_getProductName:function(a){if(a.id()!=this.currentProductID){var b=this._getFormattedProductName(a);return this.currentProductID=a.id(),b}return""},_getFormattedProductName:function(a){var b=e.find(this.get("lobDetailsMap"),function(b){return b.lobDetail.code===a.lineOfBusiness()}),c={productName:a.productName(),productOfferingName:a.productOfferingName(),lineOfBusiness:a.lineOfBusiness(),productServiceID:a.productServiceID()};return productName=b?t.getLOBNameFromReferenceData(b.lobDetail,c):a.productName()?a.productName:bundleName,!productName&&a.productServiceID()&&(productName=t.formatPhoneNumber(a.productServiceID())),productName},isBOPenalty:function(a){return a.penalty},setProductLabel:function(a,b){var d="";if("G"===a.productSpecificationLevel)d=a.productName;else{var e=this._setLOBNumbering(this.setLOBName(a));switch(a.lineOfBusiness){case c.get("lobs").WS:d=this.geProductDisplayName(a);break;case c.get("lobs").WL:d=a.productServiceID;break;case c.get("lobs").TV:case c.get("lobs").IN:d=this.geProductDisplayName(a);break;default:d=a.productName||b}d=d||e}return d},setLOBName:function(a){var b=a.lineOfBusiness,c=this.get("lobDetailsMap"),d=e.find(c,function(a){return a.lobDetail.code===b});return d?d.lobDetail.name:this.getString("Other")},setBalloonLabel:function(a,b,d){var e=a.lineOfBusiness,g="",h=this.isAmend(a.productOrderItemID,this.subViewModels.productOrder.get("productOrderItems")),d=d||a.productOrderItemType;if("G"===a.productSpecificationLevel)g=this.setLOBName(a)+" : "+a.productName;else switch(e){case c.get("lobs").WS:var i=this.geProductDisplayName(a);i&&i.substring(1,2).match("[0-9]")||(i=""),g=i+" "+this.setLOBName(a)+" ("+f.getProductActionType(d,null,h)+")";break;case c.get("lobs").WL:g=this.setLOBName(a)+" ("+f.getProductActionType(d,null,h)+")";break;case c.get("lobs").TV:case c.get("lobs").IN:g=this.setLOBName(a)+" ("+f.getProductActionType(d,null,h)+")";break;default:g=a.productName||b}return g},getServiceId:function(a){t.formatPhoneNumber(a.productServiceID)},setBalloonLabelForFullCart:function(a,b,d){var e=a.lineOfBusiness,f="";if("G"===a.productSpecificationLevel)f=this.setLOBName(a)+" :"+this.rb.getString("cm_fullCartWidget_sharedPlan");else if(this.isChangePlanFlow())f=this.setLOBName(a)+d+" "+this.getString("cm_fullCartWidget_changePlan");else switch(e){case c.get("lobs").WS:case c.get("lobs").WL:var f=this.setLOBName(a)+d+" "+this.getDisplayableStringForActionType(a)+" "+this.getString("cm_fullCart_subscription");break;case c.get("lobs").TV:case c.get("lobs").IN:f=this.setLOBName(a)+d+" "+this.getDisplayableStringForActionType(a)+" "+this.getString("cm_fullCart_subscription");break;default:f=a.productName?a.productName:b}return f},geProductDisplayName:function(a){var b=this.get("productsBar"),c=e.find(b,function(b){if(b.productID===a.productID)return b});if(c)return c.name},isAmend:function(a,b){var c=!1;return e.each(b,function(b){b.productOrderItemID&&b.productOrderItemID==a&&(c=b.productOrderItemAmend)},this),c},setLOBDetailsForCPD:function(a,b,d){var e,f=a.lineOfBusiness;switch(f){case c.get("lobs").WS:case c.get("lobs").WL:e=a.productServiceID?this.setLOBName(a)+d+" "+t.formatPhoneNumber(a.productServiceID):this.setLOBName(a);break;case c.get("lobs").TV:case c.get("lobs").IN:e=this.setLOBName(a);break;default:e=a.productName?a.productName:b}return e},_setLOBNumbering:function(){var a=[];return function(b,c){return!0!==c?(b in a?a[b]++:a[b]=1,b+" "+a[b]):void(a=[])}}(),sortProductsGLP:function(a){var b=[],c={},c=e.find(a,function(a){return"G"===a.productSpecificationLevel});return b=e.without(a,c),b.push(c),b},sortProductsGLPForFullCart:function(a){var b=[],c={},c=e.find(a,function(a){return"G"===a.productSpecificationLevel});return b=e.without(a,c),b.unshift(c),b},setErrorMsg:function(a,b){return b?a?this.rb.getString("cm_MicroCart_refreshCartFailed_errorMsg"):this.rb.getString("cm_MicroCart_loadCartFailed_errorMsg"):null},addErrorMessage:function(a){this.get("errorMessages").indexOf(a)<=-1&&this.get("errorMessages").push(a);var b={widgetID:"microCart",errorCode:a.status,errorMessage:a.statusText};this.subViewModels.exceptionTopicViewModel.set(b),this.trigger("validationFailed")},createCreateMetadataStructure:function(){return{components:[]}},clearValidResponse:function(){a.Core.StorageUtil.deleteKey("quoteResponse")},_setOrderingContextHeaders:function(){var a=this.models.customerProductOrderQuoteModel;modelDefaults=a.getDataSource().defaults;var b=modelDefaults.headers;b||(b={}),modelDefaults.headers=e.extend(b,{frameworkid:this.get("frameworkId"),clientid:this.get("clientId")})},emptyCart:function(){this.isAnonymousFlow()?this.emptyCartForAnonymous():this.emptyCartForNonAnonymous()},emptyCartForNonAnonymous:function(){console.log("cancel click"),this.models.CustomerProductOrdersModel=this.create("CustomerProductOrdersModel",u),this.models.CustomerProductOrdersModel.setQueryParams({orderIds:[this.get("productOrderId")+"A"],sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.CustomerProductOrdersModel.destroy({customerId:this.get("customerId"),success:e.bind(this._handleEmptyCartSuccess,this),error:e.bind(this._handleEmptyCartFailure,this)},this)},emptyCartForAnonymous:function(){console.log("cancel click"),this.models.CommerceAnonymousProductOrdersModel=this.create("CustomerProductOrdersModel",C),this.models.CommerceAnonymousProductOrdersModel.setQueryParams({orderIds:[this.get("productOrderId")+"A"],sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.CommerceAnonymousProductOrdersModel.destroy({success:e.bind(this._handleEmptyCartSuccess,this),error:e.bind(this._handleEmptyCartFailure,this)},this)},_handleEmptyCartSuccess:function(){w.handleAction("cartDeleted"),console.log("EVENT Triggered:cartDeleted"),this.setCartEmpty()},_handleEmptyCartFailure:function(){console.log("_handleEmptyCartFailure")},continueShopping:function(){w.handleAction("continueShopping"),console.log("EVENT Triggered:Shop More")},loadContactPersonsData:function(){var a=this,b=this.personIDsArray.filter(function(b,c){return a.personIDsArray.indexOf(b)==c});this.models.customerContactPersonsModel=this.create("cm_microCartWidget_CustomerContactPersonsModel_CustomerContactPersonsModel",x,{});var c={personIDs:b,sc:this.getSalesChannel(),lo:this.getLocale()};return this.models.customerContactPersonsModel.setQueryParams(c),this.models.customerContactPersonsModel.fetch({success:e.bind(this._setCustomerContactPersonsDataOnSuccess,this),error:e.bind(this._setCustomerContactPersonsDataOnError,this)})},_setCustomerContactPersonsDataOnSuccess:function(a,b,c){console.log("_setCustomerContactPersonsDataOnSuccess"),b.ContactPersons&&b.ContactPersons.contactPersons&&(this.createContactPersonsMap(b.ContactPersons.contactPersons),this.mapPersonIdToContactPerson())},_setCustomerContactPersonsDataOnError:function(){return console.log("_setCustomerContactPersonsDataOnError"),!0},createContactPersonsMap:function(a){this.data.contactPersonsMap={};for(var b=0;b<a.length;b++)this.data.contactPersonsMap[a[b].personID]=a[b]},mapPersonIdToContactPerson:function(){for(var a in this.data.contactPersonsMap)if(this.data.contactPersonsMap.hasOwnProperty(a)){var b=this.data.contactPersonsMap[a].name;this.contactPersonIDNameMap[a](b)}},loadInstallationAddress:function(){var a=new $.Deferred;return a.promise(),this.loadInstallationAddressData()},loadInstallationAddressData:function(){var a=this,b=this.addressIDsArray.filter(function(b,c){return a.addressIDsArray.indexOf(b)==c});this.models.customerAddressDetailsModel=this.create("cm_microCartWidget_CustomerAddressDetailsModel_CustomerAddressDetailsModel",D,{});var c={addressIDs:b,sc:this.getSalesChannel(),lo:this.getLocale()};return this.models.customerAddressDetailsModel.setQueryParams(c),this.models.customerAddressDetailsModel.fetch({success:e.bind(this._onAddressFetchSuccess,this),error:e.bind(this._onAddressFetchError,this)})},_onAddressFetchSuccess:function(a,b,c){console.log("_onAddressFetchSuccess"),this.data.customerAddressesMap={},b["InstallationAddress[]"]&&b["InstallationAddress[]"].length>0&&(this.createCustomerAddressesMap(b["InstallationAddress[]"]),this.mapAddressIdToAddress())},_onAddressFetchError:function(){console.log("_onAddressFetchError")},createCustomerAddressesMap:function(a){for(var b=0;b<a.length;b++)this.data.customerAddressesMap[a[b].id]=a[b]},mapAddressIdToAddress:function(){for(var a in this.data.customerAddressesMap)if(this.data.customerAddressesMap.hasOwnProperty(a)){var b=this.getFormattedAddress(a);this.installationAddressesMap[a](b)}},getFormattedAddress:function(a){var b=this.data.customerAddressesMap[a];return e.isUndefined(b)?"":f.formattedAddress(b,", ")},checkout:function(){this.validateConfiguration()},validateConfiguration:function(){this.isAnonymousFlow()?this.validateConfigurationForAnonymous():this.validateConfigurationForNonAnonymous()},createPayloadForValidation:function(a){return{activityForConfiguration:null,returnRemovedItems:!1,settingsView:"FULL",productOrderItems:a,retrieveComponentPricing:!1,retrieveSchemaPricing:!1,performSave:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}}},createProductOrderItems:function(a){e.each(this.order.offers,function(b){e.each(b.orderItems,function(b){var c;c={productOrderItemID:b.productOrderItemID,productID:b.productID},a.push(c)},this)},this)},handleValidationSuccess:function(a){w.set("orderDetails",this.order),null!==a&&a.isSeverityBlocking?(this.data.checkoutFailed(!0),this.data.messagesCollection(a.validationMessages),w.handleAction("validationFinishedWithBlocking",this.data.messagesCollection),console.log("Validation failed with validationFinishedWithBlocking")):(w.handleAction("checkout"),console.log("Validation Success triggered"))},validateConfigurationForAnonymous:function(){this.validateAnonymousMultiProductConfigurationModel=this.create("MultiProductsNavigatorWidget_MultiProductsNavigatorWidgetViewModel_validateMultiProductConfigurationModel",I);var a,b=[];this.validateAnonymousMultiProductConfigurationModel.set({productOrderId:this.get("productOrderId")}),this.validateAnonymousMultiProductConfigurationModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.createProductOrderItems(b),a=this.createPayloadForValidation(b),b&&b.length>0?(this.validateAnonymousMultiProductConfigurationModel.set("ValidateMultiProductsConfigurationRequest",a),this.validateAnonymousMultiProductConfigurationModel.fetch({success:e.bind(this.onConfigurationValidationSuccess,this),error:e.bind(this.onConfigurationValidationError,this)})):this.handleValidationSuccess({})},validateConfigurationForNonAnonymous:function(){this.validateMultiProductConfigurationModel=this.create("MultiProductsNavigatorWidget_MultiProductsNavigatorWidgetViewModel_validateMultiProductConfigurationModel",H);var a,b=[];this.validateMultiProductConfigurationModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.validateMultiProductConfigurationModel.set({customerId:this.get("customerId"),productOrderId:this.get("productOrderId")}),this.createProductOrderItems(b),a=this.createPayloadForValidation(b),b&&b.length>0?(this.validateMultiProductConfigurationModel.set("ValidateMultiProductsConfigurationRequest",a),this.validateMultiProductConfigurationModel.fetch({success:e.bind(this.onConfigurationValidationSuccess,this),error:e.bind(this.onConfigurationValidationError,this)})):this.handleValidationSuccess({})},onConfigurationValidationSuccess:function(a,b){var c={},d=[],f=!1,g=b.ValidateMultiProductConfigurationsResponse.productConfigurations;e.each(g,function(a){var a=a.productConfiguration;"BLOCKING"===a.compatibilityStatus&&(f||(f=!0)),a.messages&&a.messages.length>0&&e.each(a.messages,function(a){d.push({text:a.text,severity:a.severity})},this)},this),c={isSeverityBlocking:f,validationMessages:d},this.handleValidationSuccess(c)},onConfigurationValidationError:function(){console.log("Validation Falied")},getBlockingValidationMessagesFromCart:function(a){var b=a.items,c=!1,d=[];for(var e in b){var f=b[e].validationMessages;for(var g in f)f[g].severity===this.rb.getString("cm_message_severity_blocking")&&(d.push({text:f[g].text,severity:f[g].severity}),c=!0)}return{validationMessages:d,isSeverityBlocking:c}},getSortedOrderItems:function(a){var b=[],c=[],d=[],e=[];if(a&&a.length>0){for(var f=0;f<a.length;f++)a[f].bundle?c.push(a[f]):"Equipment"===a[f].name?e.push(a[f]):d.push(a[f]);d.sort(this.sortSPOffersByLOB),b=c.concat(d).concat(e)}return b},sortOrderitemsByLOB:function(a,b){var c=this.get("lobDetailsMap"),d=void 0===a.lineOfBusiness?-1:c[a.lineOfBusiness].sortIndex,e=void 0===b.lineOfBusiness?-1:c[b.lineOfBusiness].sortIndex;return-1===d&&-1!==e?1:-1===e&&-1!==d?-1:d-e},sortSPOffersByLOB:function(a,b){var c=this.get("lobDetailsMap"),d=void 0===a.productOrderItems[0].lineOfBusiness?-1:c[a.productOrderItems[0].lineOfBusiness].sortIndex,e=void 0===b.productOrderItems[0].lineOfBusiness?-1:c[b.productOrderItems[0].lineOfBusiness].sortIndex;return-1===d&&-1!==e?1:-1===e&&-1!==d?-1:d-e},isAnonymousFlow:function(){return!this.get("customerId")},isEmptyCart:function(){return!this.data.productOrderId()},changeTelephoneNo:function(a){w.set("currentWSResourceValue",a),w.handleAction("ChangeResource",{currentWSResourceValue:a})},setCartEmpty:function(){this.data.productOrderId(null)},getLocale:function(){return this.get("locale")?this.get("locale"):c.get("locale")},getActiveProductFromTopic:function(a){var b=e.find(a,function(a){return!0===a.active},this);return this.set("activeProductInBar",b),b},isCurrentProductActive:function(a){var b=this.get("productsBar"),c=e.find(b,function(b){return b.productID===a.productID},this);return c&&c.active},setResourceForActiveProduct:function(a){var b=this.get("productsBar");if(b){for(var c=0;c<b.length;c++)b[c].resource="",b[c].active&&(b[c].resource=t.formatPhoneNumber(a),b[c].name=t.formatPhoneNumber(a));this.set("productsBar",b)}},isReadOnlyProduct:function(a,b){var b=e.find(a,function(a){return a.productOrderItemID===b.productOrderItemID},this);return!!b&&!b.productOrderItemActive},setIsPenalty:function(a){return!!a&&!(!a.totalPenalty||0==a.totalPenalty.finalAmount)},reservedResourceDone:function(){if(this.set("onReserveResourceDone",!0),this.get("cartMode")!==this.CART_MODE.MICRO_CART){var a=this.subViewModels.reserveResourceTopicViewModel.get("publishedSelectedResource");this.set("selectedResource",t.formatPhoneNumber(a)),this.setResourceForActiveProduct(a),this.refreshCart()}else this.refreshCart()},removeCart:function(a){this.isAnonymousFlow()?this.removeCartForAnonymous(a):this.removeCartForNonAnonymous(a)},removeCartForAnonymous:function(a){this.models.CommerceAnonymousProductOrderProductOrderItemModel=this.create("CommerceAnonymousProductOrderProductOrderItemModel",A),this.models.CommerceAnonymousProductOrderProductOrderItemModel.errorHandler=null,this.models.CommerceAnonymousProductOrderProductOrderItemModel.set({productOrderId:this.get("productOrderId"),productOrderItemId:a}),this.models.CommerceAnonymousProductOrderProductOrderItemModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.CommerceAnonymousProductOrderProductOrderItemModel.destroy({success:e.bind(this._onRemoveCartSuccess,this),error:e.bind(this._onRemoveCartError,this)})},removeCartForNonAnonymous:function(a){this.models.CustomerProductOrderProductOrderItemModel=this.create("CustomerProductOrderProductOrderItemModel",y),this.models.CustomerProductOrderProductOrderItemModel.errorHandler=null,this.models.CustomerProductOrderProductOrderItemModel.set({customerId:this.get("customerId"),productOrderId:this.get("productOrderId"),productOrderItemId:a}),this.models.CustomerProductOrderProductOrderItemModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.CustomerProductOrderProductOrderItemModel.destroy({success:e.bind(this._onRemoveCartSuccess,this),error:e.bind(this._onRemoveCartError,this)})},_onRemoveCartSuccess:function(a,b){console.log("in success"),this.setOrderStatus(b),this.isOrderCancelled()?(w.handleAction("noRemainingItemsInCart"),this.setCartEmpty()):this.refreshCart(),w.handleAction("removeOffer")},setOrderStatus:function(a){a.CancelOrderResponse&&a.CancelOrderResponse.canceledOrders&&this.set("orderStatus",a.CancelOrderResponse.canceledOrders[0].orderStatus)},isOrderCancelled:function(){return(this.get("orderStatus")==this.get("orderStatuses").TC||this.get("orderStatus")==this.get("orderStatuses").CA)&&(this.data.orderHasMultipleProductItems(!1),!0)},_onRemoveCartError:function(a,b){this.setOrderStatus(b),this.trigger("errorOnRemoveItem"),console.log("in failure")},removeBundle:function(a){this.isAnonymousFlow()?this.removeBundleForAnonymous(a):this.removeBundleForNonAnonymous(a)},addSubscription:function(a,b){var c,d=this,e=requirejs.appContext,f=this.get("productOrderId"),g={productOfferingProductSpecID:b.bundleAddOnProductOfferingProductSpecID,customerID:this.get("customerId"),productId:b.productID,productOfferingInstanceID:b.productOfferingInstanceID};this.rulesBackendInvokerVM=this.create("addSubscriptionRulesExecutorViewModel_CartRulesBackendInvokerViewModel",Q),this.baseRulesExecutorViewModel=this.create("addSubscriptionRulesExecutorViewModel_BaseRulesExecutorViewModel",R),c=this.isAnonymousFlow()?this.rulesBackendInvokerVM.updateBundleOrderForAddNewSubscriptionForAnonymous(e,g,null,f,this.getSalesChannel(),this.getLocale()):this.rulesBackendInvokerVM.updateBundleOrderForAddNewSubscriptionForCustomer(e,g,null,f,this.getSalesChannel(),this.getLocale()),console.log("New Subscription added"),c.done(function(a){var b=a.NewProductInOfferingInstanceConfigurationResponse.newProductsInNewOfferingInstance[0].productConfiguration.mandatoryConfigRequired,c=a.NewProductInOfferingInstanceConfigurationResponse.newProductsInNewOfferingInstance[0].productConfiguration.lineOfBusiness,f=d.cachedLobMandatoryConfigurationCheck(c);b&&f?d.handleAddNewSubscriptionSuccess(e,a,b,c):d.refreshCart();
}).fail(function(a){console.log("Error in Update Order")})},cachedLobMandatoryConfigurationCheck:function(b){var c,d=a.Core.StorageUtil.getStorage("session").get("cachedLobDetailData");return e.each(d,function(a){if(b==a.code&&a.mandatoryConfigurationCheck)return c=!0,!1},this),c},handleAddNewSubscriptionSuccess:function(a,b,c,d){},removeBundleForAnonymous:function(a){this.models.commerceAnonymousProductOrderProductOrderItemsModel=this.create("cm_microCartWidget_CommerceAnonymousProductOrderItemsModel",F),this.models.commerceAnonymousProductOrderProductOrderItemsModel.errorHandler=null,this.models.commerceAnonymousProductOrderProductOrderItemsModel.set({productOrderId:this.get("productOrderId")}),this.models.commerceAnonymousProductOrderProductOrderItemsModel.setQueryParams({poi:[a],sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.commerceAnonymousProductOrderProductOrderItemsModel.destroy({success:e.bind(this._onRemoveBundleSuccess,this),error:e.bind(this._onRemoveBundleError,this)})},removeBundleForNonAnonymous:function(a){this.models.customerProductOrderProductOrderItemsModel.errorHandler=null,this.models.customerProductOrderProductOrderItemsModel.set({customerId:this.get("customerId"),productOrderId:this.get("productOrderId")}),this.models.customerProductOrderProductOrderItemsModel.setQueryParams({poi:[a],sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.customerProductOrderProductOrderItemsModel.destroy({success:e.bind(this._onRemoveBundleSuccess,this),error:e.bind(this._onRemoveBundleError,this)})},_onRemoveBundleSuccess:function(a,b){console.log("In success callback - bundle removed"),this.setOrderStatus(b),this.isOrderCancelled()?(w.handleAction("noRemainingItemsInCart"),this.setCartEmpty()):this.refreshCart(),w.handleAction("removeBundle")},_onRemoveBundleError:function(a,b){this.setOrderStatus(b),this.trigger("errorOnRemoveItem"),console.log("In failure callback - to remove bundle")},replaceDevice:function(a){w.set("orderDetails",this.order),w.set("replacedDeviceId",a),w.handleAction("replaceDevice"),console.log("replace device with new one")},changePlan:function(a){w.set("orderDetails",this.order),w.handleAction("changePlan"),console.log("change plan flow triggered")},setManagePricingMicroCartMode:function(a){this.subViewModels.managePricingDynamicUI.set("managePricingMicroCartMode",a),this.subViewModels.dynamicUI.set("managePricingMicroCartMode",a),this.subViewModels.dynamicUI.set("isManagePricingLinkDisabled",a),this.set("managePricingMicroCartMode",a)},saveProductsForManagePricing:function(){this.set("saveProductChangesForManagePricing",!0);var a=[],b=this.quoteResponseData&&this.quoteResponseData.productOfferings;b&&e.each(b,function(b){var c=b.productOrderItems;c&&e.each(c,function(b){var c={productOrderItemID:b.productOrderItemID};a.push(c)},this)},this),0==a.length?a=null:1==a.length&&(a=a[0]),this.saveManagePricingProductChanges(a)},saveManagePricingChanges:function(){this.saveManagePricingProductChanges(this.getManagePricingProductChanges())},editHardGood:function(a){w.set("editHardGoodData",a),w.handleAction("editHardGood"),console.log("editHardGood action triggered")},loadManagePricingMetadata:function(){this.getSubViewModel("managePricingDynamicUI").load(this.managePricingMetadata,{})},updateHardGoodsQuantity:function(a){this.isAnonymousFlow()?this.updateHardGoodsQuantityForAnonymous(a):this.updateHardGoodsQuantityForNonAnonymous(a)},updateHardGoodsQuantityForAnonymous:function(a){this.models.anonymousProductConfigurationModel.set({productOrderItemId:this.get("productOrderItemID")}),payloadInput={updateSimpleOrderedProducts:[{productOrderItemID:a.productOrderItemID,quantity:a.selectedQuantity[0]}]},this.models.anonymousProductConfigurationModel.setQueryParams({poi:this.get("productOrderId"),sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.anonymousProductConfigurationModel.set("UpdateProductInOrderConfigurationRequest",payloadInput),this.models.anonymousProductConfigurationModel.save({UpdateProductInOrderConfigurationRequest:payloadInput},{success:e.bind(this.onProductConfigurationSuccess,this),error:e.bind(this.onProductConfigurationError,this),actionToPublish:"SaveResults"})},updateHardGoodsQuantityForNonAnonymous:function(a){this.models.productConfigurationModel.set({customerId:this.get("customerId"),productOrderItemId:a.productOrderItemID}),payloadInput={updateSimpleOrderedProducts:[{productOrderItemID:a.productOrderItemID,quantity:a.selectedQuantity[0]}]},this.models.productConfigurationModel.setQueryParams({poi:this.get("productOrderId"),sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.productConfigurationModel.set("UpdateProductInOrderConfigurationRequest",payloadInput),this.models.productConfigurationModel.save({UpdateProductInOrderConfigurationRequest:payloadInput},{success:e.bind(this.onProductConfigurationSuccess,this),error:e.bind(this.onProductConfigurationError,this),actionToPublish:"SaveResults"})},fetchDomainOverrideReason:function(){this.models.domainModel.set({domainName:"OverrideReasonTP"}),this.models.domainModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.models.domainModel.fetch({success:e.bind(this._onFetchDomainOverrideReasonSuccess,this),error:e.bind(this._onFetchDomainOverrideReasonError,this)})},_onFetchDomainOverrideReasonSuccess:function(b,c,d){var e=c.DomainValuesResponse.values;a.Core.StorageUtil.getStorage("session").set("domainValuesKey",e),this._createOverrideReasonObject(e)},_onFetchDomainOverrideReasonError:function(a,b,c){},_createOverrideReasonObject:function(a){var b=[{id:"default",label:this.getString("cm_ManagePricing_WaiveAndOverride_ReasonDropDown_Label")}];e.each(a,function(a){var c={id:a.code,label:a.displayName};b.push(c)},this),this.overrideReasonDropDownValues=b},onProductConfigurationSuccess:function(){this.refreshCart()},onProductConfigurationError:function(){console.log("Could not update the product configuration")},inverseToolTip:function(a){var b=$(a).position().top,c=$("#OtherProducctsContent");return $(c).innerHeight()+$(a).height()<=b-150},hasNonProvideOA:function(a){var b=!1;return e.each(a.productOrderItems,function(a){b="Provide"!=a.productOrderItemType||b},this),b},decodeAction:function(a){var b=a;switch(b){case c.get("NPCWidget_Actions").Change_Action:return this.getString("cm_ManagePricing_Change_Action");case c.get("NPCWidget_Actions").Remove_Action:return this.getString("cm_ManagePricing_Remove_Action");case c.get("NPCWidget_Actions").Add_Action:return this.getString("cm_ManagePricing_Add_Action");case c.get("NPCWidget_Actions").Resume_Action:return this.getString("cm_ManagePricing_Resume_Action");case c.get("NPCWidget_Actions").Suspend_Action:return this.getString("cm_ManagePricing_Suspend_Action");case c.get("NPCWidget_Actions").Reestablish_Action:return this.getString("cm_ManagePricing_Reeastablish_Action");default:return this.getString("cm_ManagePricing_No_Action")}},updateWaiveOrOverride:function(a){a.productID&&(this.set("waveOrOverrideUpdateMicroCartMode",!0),this.currentPriceSchemaProductChanges=null,this.updatePriceSchemaChangesToManagePricingProductChanges(a),this.refreshCart(this.getManagePricingProductChanges()))},resetWaiveOrOverride:function(a){this.set("waveOrOverrideUpdateMicroCartMode",!0),this.currentPriceSchemaProductChanges=null,this.updatePriceSchemaChangesToManagePricingProductChanges(a,"reset"),this.refreshCart(this.getManagePricingProductChanges())},updatePriceSchemaChangesToManagePricingProductChanges:function(a,b){var c=a.parentTemporaryID,d=a.allowedOverrideType,e=a.overridePriceType,f=a.parentProductSpecContainmentID,g=a.productID,h=a.productOrderItemID,i=a.productSpecPricingID,j=a.newPrice,k="Other",l=a.overrideReasonFreeText,m=a.productID+"_"+i+"_"+a.parentTemporaryID,n="FIX_AMOUNT";b&&"reset"==b&&(j=0,n="NONE",k="None",l="");var o={overrideAmount:j,overrideReason:k,overrideAmountType:n,overrideReasonFreeText:l,allowedOverrideType:d},p={productSpecPricingID:i,parentProductSpecContainmentID:f,parentTemporaryID:c,billingOfferID:a.billingOfferIdentifier};"onetime"==e?p.oneTimeChargesOverrideInformation=o:"recurring"==e&&(p.recurringChargesOverrideInformation=o);var q={productOrderItemID:h,productChanges:{changedAssignedBillingOffers:[p]}};this.currentPriceSchemaProductChanges=q,this.managePricingProductChangesByProductID[g]?this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m]?"recurring"==e&&this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m].oneTimeChargesOverrideInformation?this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m].recurringChargesOverrideInformation=o:"onetime"==e&&this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m].recurringChargesOverrideInformation?this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m].oneTimeChargesOverrideInformation=o:this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m]=p:(this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers||(this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers={}),this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m]=p):(this.managePricingProductChangesByProductID[g]={productOrderItemID:h,productID:g,productChanges:{changedAssignedBillingOffers:{}}},this.managePricingProductChangesByProductID[g].productChanges.changedAssignedBillingOffers[m]=p)},getManagePricingProductChanges:function(){var a=[];return e.each(this.managePricingProductChangesByProductID,function(b,c){var d=[];e.each(b.productChanges.changedAssignedBillingOffers,function(a,b){d.push(a)},this),a.push({productOrderItemID:b.productOrderItemID,productChanges:{changedAssignedBillingOffers:d}})},this),0==a.length?a=null:1==a.length&&(a=a[0]),a},saveManagePricingProductChanges:function(a){if(a&&this.get("allowWaiveOrOverride")){if(!a.length||1==a.length){var b=[];b.push(a),a=b}payloadInput={activityForConfiguration:this.get("activityName")||null,confirmationMessagesApproved:!1,returnRemovedItems:!1,settingsView:"FULL",productOrderItems:a,retrieveComponentPricing:!0,retrieveSchemaPricing:!0,saveIfCompatibilityRulesFailed:!0,callQuoteForOtherProducts:!0,returnConfigurationData:{catalogDataInd:!0,crossProductsDiscountsDataInd:!0,previousQuotedRecurringPricesInd:!1,productConfigurationInd:!0,quotedPricesInd:!0,quotedProrationInd:!1,quotedTaxInd:!1,summaryInd:!0}},this.get("saveProductChangesForManagePricing")&&(payloadInput.skipMadatoryChecks=!0),this.isAnonymousFlow()?this.managePrisingForAnonymous(payloadInput):this.managePrisingForRegistered(payloadInput)}else this.get("saveProductChangesForManagePricing")?(this.set("saveProductChangesForManagePricing",!1),this.set("managePricingLockedForInitialization",!1),this.subViewModels.microCart.trigger("action:unlockNextAfterValidateAndSaveForManagePricing")):this.trigger("closeManagePricingAfterSavingProductChanges")},managePrisingForRegistered:function(a){this.productConfigurationMultiModel.set({customerId:this.get("customerId"),productOrderId:this.get("productOrderId")}),this.productConfigurationMultiModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.productConfigurationMultiModel.save({ValidateAndUpdateMultiProductsConfigurationRequest:a},{success:e.bind(this.onProductConfigurationMultiSuccess,this),error:e.bind(this.onProductConfigurationMultiError,this)})},managePrisingForAnonymous:function(a){this.anonymousProductConfigurationMultiModel.set({productOrderId:this.get("productOrderId")}),this.anonymousProductConfigurationMultiModel.setQueryParams({sc:this.getSalesChannel(),lo:this.getLocale()}),this.anonymousProductConfigurationMultiModel.save({ValidateAndUpdateMultiProductsConfigurationRequest:a},{success:e.bind(this.onProductConfigurationMultiSuccess,this),error:e.bind(this.onProductConfigurationMultiError,this)})},initializeManagePricing:function(){this.set("managePricingMicroCartMode",!0),this.managePricingProductChangesByProductID={},this.createManagePricingDynamicUIViewModel(),this.get("refreshConfigurationOnManagePricing")?this.get("allowWaiveOrOverride")?(this.set("managePricingLockedForInitialization",!0),this.set("ValidateAndSaveAllProductsForManagePricing",!0),this.subViewModels.productConfigurationAction.trigger("action:ValidateAndSaveAllProductsForManagePricing")):this.subViewModels.configureMultiProductsTopicViewModel.trigger("action:refreshConfigurationAndPrices"):this.refreshCart()},handleValidateAndSaveAllProductsSuccess:function(){this.get("ValidateAndSaveAllProductsForManagePricing")&&this.get("managePricingLockedForInitialization")&&(this.set("ValidateAndSaveAllProductsForManagePricing",!1),this.saveProductsForManagePricing())},handleValidateAndSaveAllProductsFailure:function(){this.set("ValidateAndSaveAllProductsForManagePricing",!1),this.set("managePricingMicroCartMode",!1),this.subViewModels.microCart.trigger("action:unlockNextAfterValidateAndSaveForManagePricing")},onProductConfigurationMultiSuccess:function(a,b,c){this.refreshCart(),this.managePricingProductChangesByProductID={},this.get("saveProductChangesForManagePricing")?(this.set("saveProductChangesForManagePricing",!1),this.set("managePricingLockedForInitialization",!1),this.subViewModels.microCart.trigger("action:unlockNextAfterValidateAndSaveForManagePricing")):(this.trigger("closeManagePricingAfterSavingProductChanges"),this.subViewModels.microCart.trigger("action:reloadNPCAfterManagePricingChanges"))},onProductConfigurationMultiError:function(a,b,c){this.set("saveProductChangesForManagePricing",!1),this.set("managePricingLockedForInitialization",!1),this.subViewModels.microCart.trigger("action:unlockNextAfterValidateAndSaveForManagePricing")},getSalesChannel:function(){return this.get("sc")?this.get("sc"):c.get("salesChannel")}})});
define("businesswidget/repository/common/viewmodel/MultiProductsWidgetDataActionTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{totalExternalMessagesData:[],topSeverity:null,succeeded:!1,areExternalWidgetsDirty:!1},result:function(a,b,c){this.set("totalExternalMessagesData",b),this.set("topSeverity",c),this.set("succeeded",a)},report:function(a){this.set("areExternalWidgetsDirty",a)}}),c=b.extend({}),d={path:"businesswidget/repository/common/viewmodel/MultiProductsWidgetDataActionTopicViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"MultiProductsWidgetDataActionTopicViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetInstanceID:{key:"widgetInstanceID",value:"null"},eventRelatedWidgetInstanceIDs:{key:"eventRelatedWidgetInstanceIDs",value:"null"},succeeded:{key:"succeeded",value:"false"},validationMessages:{key:"validationMessages",value:"[]"},exceptions:{key:"exceptions",value:"[]"},Save:{key:"Save",value:"false"},Validate:{key:"Validate",value:"false"},Revert:{key:"Revert",value:"false"},SaveResult:{key:"SaveResult",value:"false"},ValidateResult:{key:"ValidateResult",value:"false"},ValidateAndSaveResult:{key:"ValidateAndSaveResult",value:"false"},RevertResult:{key:"RevertResult",value:"false"}},methods:{clearAll:{name:"clearAll",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},clear:{name:"clear",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},save:{name:"save",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},validate:{name:"validate",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},revert:{name:"revert",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},saveResult:{name:"saveResult",privacyLevel:"public",isEventTriggered:!1,desc:"@param widgetInstanceID - identifies the external widget. the ID should be generated by the consumer when publishing events to external widgets.\n@param succeeded -  boolean indication if action succeeded\n",isChangeEventTriggered:!1},validateResult:{name:"validateResult",privacyLevel:"public",isEventTriggered:!1,desc:"@param widgetInstanceID - identifies the external widget. the ID should be generated by the consumer when publishing events to external widgets.\n@param succeeded -  boolean indication if action succeeded.\n@param validationMessages[] - retruns in case validation issues occured in the external widget after Validate and ValidateAndSave events were publish\n stepID - the Id of the step the messages are relared to\n messages[] -\n  message - message text\n  severity - severity of the messages. Valid Values: COMPATIBLE, NOT_CHECKED, INFORMATION, CONFIRMATION, BLOCKING\n@param exceptions[] - returns in case technical errors occring in the external widget\n errorCode - This is error code which occurred on widget\n errorMessage - This is error message widget is getting from from framework\n",isChangeEventTriggered:!1},revertResult:{name:"revertResult",privacyLevel:"public",isEventTriggered:!1,desc:"@param widgetInstanceID - identifies the external widget. the ID should be generated by the consumer when publishing events to external widgets.\n@param succeeded -  boolean indication if action succeeded\n",isChangeEventTriggered:!1}}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/model/BusinessCustomerIdOrdersModel",["underscore","jquery","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c,d){function e(a){return null==a.Orders.orders||0==a.Orders.orders.length?{pageStart:0,totalSize:0,data:[]}:{pageStart:a.Orders.startIndex,totalSize:a.Orders.totalResults,data:a.Orders.orders}}return c.extend({url:"ecommerce/business-customer/:customerId/orders",options:{rest:{save:{method:"POST",contentType:"application/json"},defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel")},payload:["BusinessOrdersRequest"]},readPage:{supportsPagination:!0,supportsSorting:!0,parse:e,names:{pageSize:"pageSize",pageStart:"start"}}}}})});
define("businesswidget/repository/common/viewmodel/MyOrdersWidgetViewModel",["underscore","lightsaber","Configuration","businesswidget/repository/common/model/BusinessCustomerIdOrdersModel","businesswidget/repository/common/model/BusinessCustomerIdDraftOrdersModel","sync!businesswidget/repository/common/viewmodel/UserInformationViewModel"],function (a,b,c,d,e,f){return b.Core.ViewModel.extend({models:{businessCustomerOrdersModel:new d,businessCustomerIdDraftOrdersModel:new e},subViewModels:{draftOrdersViewModel:new b.Core.CollectionViewModel({idAttribute:"referenceNumber",models:{items:new b.Core.Collection},config:{autoUpdate:!0}}),latestOrdersViewModel:new b.Core.CollectionViewModel({idAttribute:"referenceNumber",models:{items:new b.Core.Collection},config:{autoUpdate:!0}})},dataBindings:[{draftOrders:"subViewModels.draftOrdersViewModel.items",options:{twoWay:!1}},{latestOrders:"subViewModels.latestOrdersViewModel.items",options:{twoWay:!1}}],defaults:{customerId:f.getProperty("customerId"),locale:c.get("locale"),ordersStatus:["SUBMITTED","SUBMIT_REQUESTED","CLOSED"],timePeriodUOM:"M",timePeriodNumberOfUnits:12,draftTimePeriodUOM:"W",draftTimePeriodNumberOfUnits:2,ordersSalesChannel:null,draftOriginatedBy:null,ordersOriginatedBy:null,ordersSortBy:"DATE_RECENT_FIRST",draftSortAscending:!1},initialize:function(b){a.bindAll(this,"_createSubViewModels","loadDraftOrders","loadLatestOrders","_retrieveBusinessCustomerOrders","_onDraftOrdersFetchSuccess","_onLatestOrdersFetchSuccess","_onOrdersFetchError","onViewAllDrafts","onViewAllOrders"),this._createSubViewModels(b)},_createSubViewModels:function(a){this.panesModel=new b.Core.Collection,this.subViewModels.ordersViewModel=this.create("smb_myOrdersWidgetViewModel_ordersViewModel",b.CollectionViewModel,{models:{panes:this.panesModel},config:{enable:!0,visible:!0}})},addPane:function(a,b){this.panesModel.add({id:a,name:b})},loadDraftOrders:function(a){this._retrieveBusinessCustomerDraftOrders(a,this._onDraftOrdersFetchSuccess)},loadLatestOrders:function(a){this._retrieveBusinessCustomerOrders(a,this.get("ordersStatus"),this._onLatestOrdersFetchSuccess)},_retrieveBusinessCustomerDraftOrders:function(a,b){var c=this.get();this.models.businessCustomerIdDraftOrdersModel.set("customerId",c.customerId),this.models.businessCustomerIdDraftOrdersModel.setQueryParams({lo:c.locale,st:0,ps:a});var d={sortAscending:c.draftSortAscending,ordersTimePeriod:{timePeriodUOM:c.draftTimePeriodUOM,timePeriodNumberOfUnits:c.draftTimePeriodNumberOfUnits}};c.draftOriginatedBy?(this.set("searchByCreatedByField",!0),d.createdBy=c.draftOriginatedBy):this.set("searchByCreatedByField",!1),this.models.businessCustomerIdDraftOrdersModel.save({BusinessDraftOrdersRequest:d},{success:b,error:this._onDraftOrdersFetchError})},_retrieveBusinessCustomerOrders:function(a,b,c){var d=this.get();this.models.businessCustomerOrdersModel.set("customerId",d.customerId),this.models.businessCustomerOrdersModel.setQueryParams({lo:d.locale,st:0,ps:a});var e={numRowsToRetrieve:a,ordersSortBy:d.ordersSortBy,filterCriteria:{ordersTimePeriod:{timePeriodUOM:d.timePeriodUOM,timePeriodNumberOfUnits:d.timePeriodNumberOfUnits},statuses:b}};d.ordersSalesChannel&&(e.filterCriteria.originalSalesChannel=d.ordersSalesChannel),d.ordersOriginatedBy&&(e.filterCriteria.createdBy=d.ordersOriginatedBy),this.models.businessCustomerOrdersModel.save({BusinessOrdersRequest:e},{success:c,error:this._onOrdersFetchError})},_onDraftOrdersFetchSuccess:function(b,c){this.set("draftOrdersCounts",a.omit(c.DraftOrders,"orderGroups")),this.subViewModels.draftOrdersViewModel.currentModel.reset(c.DraftOrders.orderGroups)},_onLatestOrdersFetchSuccess:function(b,c){this.set("latestOrdersCounts",a.omit(c.Orders,"orders")),this.subViewModels.latestOrdersViewModel.currentModel.reset(c.Orders.orders)},_onOrdersFetchError:function(a){},_onDraftOrdersFetchError:function(a){},onViewAllDrafts:function(){this.trigger("action:viewAllDrafts")},onViewAllOrders:function(){this.trigger("action:viewAllOrders")},onDraftOrderSelected:function(b){var c=this.models.businessCustomerIdDraftOrdersModel.get("DraftOrders").orderGroups,d=a.find(c,function(a,c){return(1===a.ordersCounter?a.orders[0].referenceNumber:a.externalID)==b.itemId});this.set("draftOrderSelected",{orderID:b.itemId,order:d})},onOrderSelected:function(a){this.set("orderSelected",{orderID:a.itemId})},reset:function(){}})});
define("businesswidget/repository/common/model/CommerceCatalogRetrieveTopItemsModel",["underscore","businesswidget/repository/common/core/RESTModel","Configuration"],function (a,b,c){return b.extend({options:{url:"commerce/retrieve-top-catalog-items",rest:{defaults:{qParams:{lo:c.get("locale"),sc:c.get("salesChannel")}}}}})});
define("businesswidget/repository/common/viewmodel/TopItemViewModel",["underscore","lightsaber","Configuration","businesswidget/repository/common/model/CommerceCatalogRetrieveTopItemsModel"],function (a,b,c,d){return b.Core.ObservableViewModel.extend({models:{TopItemModel:d},subViewModels:{},dataBindings:[],defaults:{numberOfTopItems:2},initialize:function(b){this._super(),a.bindAll(this,"loadData","_onFetchSuccess","_onTopItemFetchSuccess","_onTopItemFetchError","_createParamsMap","_checkIfParamsEqual")},loadData:function(){if(this.get("paramsMap"))var a=this._createParamsMap(this.models.TopItemModel.dataSource.dynamicQueryParams),b=this._checkIfParamsEqual(this.get("paramsMap"),a);return b?void this.trigger("TopItemDataLoaded"):void this._onFetchSuccess()},_onFetchSuccess:function(){this.models.TopItemModel.clear();var a={};this.models.TopItemModel.save({ServiceabilityInfo:a},{success:this._onTopItemFetchSuccess,error:this._onTopItemFetchError})},_onTopItemFetchSuccess:function(a,b){var c=this._createParamsMap(a.dataSource.dynamicQueryParams);this.set("paramsMap",c);var d=a.get("TopItems").items;this.set("topItems",d),d&&d.length>0?this.set("noTopItem",!1):this.set("noTopItem",!0),this.trigger("TopItemDataLoaded")},_onTopItemFetchError:function(a){this.set("topItems",!1),this.set("noTopItem",!0),this.trigger("TopItemDataLoaded")},_createParamsMap:function(a){var b="";return b="ci"+a.ci+"pc"+a.pc+"st"+a.st+"ps"+a.ps,a.ibt&&(b+="ibt"+a.ibt),a.lobFilter&&(b+="lobFilter"+a.lobFilter),a.lob&&(b+="lob"+a.lob.sort().join()),b},_checkIfParamsEqual:function(a,b){return a==b}}).extend({})});
define("businesswidget/repository/common/viewmodel/TopItemWidgetViewModel",["underscore","lightsaber","Configuration","single!businesswidget/repository_l9_common/common/viewmodel/CustomerInContextTopicViewModel","single!businesswidget/repository/common/viewmodel/TopItemViewModel","businesswidget/repository/common/util/AmountCustomBinding","single!businesswidget/repository/common/viewmodel/ProductConfigurationTopicViewModel","single!businesswidget/repository/common/viewmodel/SelectedCatalogItemsTopicViewModel","businesswidget/repository_l9_common/common/utils/ImplUtil","businesswidget/repository/common/core/RESTModel","single!businesswidget/repository/common/viewmodel/CustomerSubscriptionsSharedViewModel","single!businesswidget/repository/common/viewmodel/OrderManagerSharedViewModel","single!businesswidget/repository/common/viewmodel/ItemListTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m){return b.Core.ObservableViewModel.extend({persistent:["topItemID","offeringId"],models:{},subViewModels:{customerInContextTopicViewModel:d,productConfigurationTopicViewModel:g,selectedCatalogItemsTopicViewModel:h,customerSubscriptionsSharedViewModel:k,orderManagerSharedViewModel:l,itemListTopicViewModel:m},dataBindings:[{customerId:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0}}],defaults:{topItemID:null,addedItemsClick:!1,moreDetailsClicked:!1,makeWidgetResponsive:!0,checkBussinessTypes:["PLAN"],imgBasePath:null,offeringId:null,noTopItem:!1,locale:c.get("locale"),salesChannel:c.get("salesChannel"),supportChangeOrderCreation:!0},initialize:function(b){this._super(),a.bindAll(this,"getTopItem","_createSubViewModel","getDefaultImageInForNoTopItem","_setModel","_reSetVMParams","setImgBasePath"),this._createSubViewModel(),this.setImgBasePath(),this.bindEvents()},bindEvents:function(){this.subViewModels.orderManagerSharedViewModel.off("action:ChangeSucceedHavingPriceimpact",null),this.subViewModels.orderManagerSharedViewModel.on("action:ChangeSucceedHavingPriceimpact",this.handleChangeSucceedHavingPriceimpact,this),this.subViewModels.orderManagerSharedViewModel.off("action:changeSucceedHavingNoPriceImpact",null),this.subViewModels.orderManagerSharedViewModel.on("action:changeSucceedHavingNoPriceImpact",this.handleChangeSucceedHavingNoPriceImpact,this),this.subViewModels.orderManagerSharedViewModel.off("action:ChangeSucceedWithExistingOrder",null),this.subViewModels.orderManagerSharedViewModel.on("action:ChangeSucceedWithExistingOrder",this.handleChangeSucceedWithExistingOrder,this),this.subViewModels.customerSubscriptionsSharedViewModel.off("action:SelectSubscription",null),this.subViewModels.customerSubscriptionsSharedViewModel.on("action:SelectSubscription",this.handleSelectSubscription,this),this.subViewModels.customerSubscriptionsSharedViewModel.off("action:NoSubscription",null),this.subViewModels.customerSubscriptionsSharedViewModel.on("action:NoSubscription",this.handleNoSubscription,this),this.subViewModels.customerSubscriptionsSharedViewModel.off("action:SingleSubscription",null),this.subViewModels.customerSubscriptionsSharedViewModel.on("action:SingleSubscription",this.handleSingleSubscription,this),this.subViewModels.orderManagerSharedViewModel.off("action:changeFailed",null),this.subViewModels.orderManagerSharedViewModel.on("action:changeFailed",this.handleChangeFailed,this)},_createSubViewModel:function(){this.subViewModels.topItemViewModel=e},getTopItem:function(a){var b=this.subViewModels.topItemViewModel.get("topItems")[a-1];return this.set("bussinessType",b.businessType),b.catalogItemImage||(b.catalogItemImage=null),b.oneTimePrice&&(b.oneTimePrice.originalAmount!==b.oneTimePrice.finalAmount?b.originalAmount=b.oneTimePrice.originalAmount:b.originalAmount=null,b.finalAmount=b.oneTimePrice.finalAmount),b.recurringPrice&&(b.recurringPrice.originalAmount!==b.recurringPrice.finalAmount?b.originalAmount=b.recurringPrice.originalAmount:b.originalAmount=null,b.finalAmount=b.recurringPrice.finalAmount),b},getTopItemBanner:function(a,b,c){var d=this.subViewModels.topItemViewModel.get("topItems")[a-1];return"SimpleAndBanner"===c?d.catalogItemBanner?(d.catalogItemBanner=this._getBannerURL(d.catalogItemBanner,b),{topItem:d,bannerAvailable:!0}):{topItem:this.getTopItem(a),bannerAvailable:!1}:(d.catalogItemBanner=this._getBannerURL(d.catalogItemBanner,b),d)},_getBannerURL:function(a,b){if(!a)return null;var c=a.lastIndexOf(".");return a.substring(0,c)+"_"+b+".html"},getDefaultImageInForNoTopItem:function(a){a?(this.set("topItemDefaultBanner",a),this.set("isBannerUrl",!0)):(this.set("topItemDefaultBanner",c.get("defaultImageForBanner")),this.set("isBannerUrl",!1))},setTopItemInContextTopic:function(a){this.subViewModels.productConfigurationTopicViewModel.set("defaultVariantID",void 0),this.set("topItemID",a.catalogItemID),a.containingOfferings&&(this.set("offeringId",a.containingOfferings[0].offeringId),this.subViewModels.itemListTopicViewModel.set("productOfferingID",a.containingOfferings[0].offeringId));var b={topItemID:a.catalogItemID,businessType:a.businessType,containingOfferings:a.containingOfferings,parentCatalogItemID:a.parentCatalogItemID,type:a.type,lob:a.lob,catalogItemDisplayName:a.catalogItemDisplayName},c="";c=a.businessType&&"OFFERING"===a.businessType?"topItemBundleSelected":a.businessType&&"TV_CHANNEL"===a.businessType?"topItemChannelSelected":a.businessType&&"TV_PACKAGE"===a.businessType?"topItemPackageSelected":a.businessType&&"PLAN"===a.businessType?"topItemPlanSelected":a.businessType&&"MD"===a.businessType?"topItemDeviceSelected":a.businessType&&"AC"===a.businessType?"topItemAccessorySelected":"topItemSelected",this.handleAction(c,b),this.subViewModels.itemListTopicViewModel.handleAction(c,b)},_setModel:function(){var b={};b.ci=this.get("customerId"),b.pc=this.get("paymentCategory"),b.st=0,b.ps=this.subViewModels.topItemViewModel.get("numberOfTopItems"),a.isUndefined(this.get("locale"))||(b.lo=this.get("locale")),a.isUndefined(this.get("salesChannel"))||(b.sc=this.get("salesChannel")),this.get("lobCode")&&!a.isEmpty(this.get("lobCode")[0])?b.lob=this.get("lobCode"):"AllLOBs"===this.get("topItemsFilter")&&(b.lobFilter=!1),this.get("topItemBusinessType")&&(b.ibt=this.get("topItemBusinessType")),this.subViewModels.topItemViewModel.models.TopItemModel.setQueryParams(b),this._reSetVMParams()},loadData:function(){this._retriveAllowShowActionButtonInd(),this._setModel(),this.subViewModels.selectedCatalogItemsTopicViewModel.set("selectedItems",void 0),this.subViewModels.topItemViewModel.loadData()},setDefaultBannerInContext:function(){this.trigger("action:defaultBannerSelected")},_reSetVMParams:function(){this.set("ps",""),this.set("lobCode",""),this.set("topItemsFilter","")},triggerAddedItem:function(a){this.set("topItemID",a.catalogItemID),this.set("topItemBusinessType",a.businessType),this.set("addedItemsClick",!0),this.handleAddNewSubscription(a),this.setProductConfigurationContextParameters(a),this.trigger("action:addedItem"),this.subViewModels.productConfigurationTopicViewModel.handleAction("addedItem")},handleAddNewSubscription:function(a){var b=this.getSelectedItems(a);this.subViewModels.selectedCatalogItemsTopicViewModel.set("selectedItems",b),this.subViewModels.selectedCatalogItemsTopicViewModel.set("buyItems",b)},setProductConfigurationContextParameters:function(a){this.subViewModels.productConfigurationTopicViewModel.set("productOfferingID",a.catalogItemID),this.subViewModels.productConfigurationTopicViewModel.set("name",a.catalogItemDisplayName),
this.subViewModels.productConfigurationTopicViewModel.set("description",a.catalogItemDescription),this.subViewModels.productConfigurationTopicViewModel.set("lobs",a.lob),this.subViewModels.productConfigurationTopicViewModel.set("lob",a.lob),this.subViewModels.productConfigurationTopicViewModel.set("businessType",a.businessType)},getSelectedItems:function(a){var b={},c=a.businessType;return b[c]={},b[c].catalogItemID=a.catalogItemID,b[c].lobCode=a.lob[0],b[c].lob=a.lob,b[c].isSharedPlan=a.sharedPlan,b[c].isRecent=!0,b[c].productOfferingID=a.catalogItemID,a.containingOfferings&&a.containingOfferings.length>0&&(b[c].productOfferingID=a.containingOfferings[0].offeringId,a.containingOfferings[0].offeringToProductIds&&a.containingOfferings[0].offeringToProductIds.length>0&&(b[c].productOfferingProductSpecID=a.containingOfferings[0].offeringToProductIds[0]),a.containingOfferings[0].productSpecIds&&a.containingOfferings[0].productSpecIds.length>0&&(b[c].productSpecID=a.containingOfferings[0].productSpecIds[0])),b},setImgBasePath:function(){var a=i.getImageBaseURL();a&&this.set("imgBasePath",a)},_retriveAllowShowActionButtonInd:function(){return new j(null,{url:"RBA/common/topitem"}).fetch({success:a.bind(function(a){this.set("allowShowActionButton",a.get("allowShowButton"))},this)})},showActionButtons:function(){return!!this.get("allowShowActionButton")},handleChangeSucceedHavingPriceimpact:function(){this.handleAction("changeSucceed")},handleChangeSucceedHavingNoPriceImpact:function(){this.handleAction("changeSucceedHavingNoPriceImpact")},handleChangeSucceedWithExistingOrder:function(){this.handleAction("ChangeSucceedWithExistingOrder")},handleSelectSubscription:function(){this.subViewModels.itemListTopicViewModel.trigger("action:SelectSubscription")},handleNoSubscription:function(){this.handleAction("NoSubscriptionFound")},handleChangeFailed:function(){this.handleAction("maxSizeExceded")},handleSingleSubscription:function(a){var b=a,c=b.item.catalogItemID,d=b.item.businessType,e=this.getPayload(a.assignedProductId,c,d);this.subViewModels.productConfigurationTopicViewModel.set("productID",a.assignedProductId),this.subViewModels.orderManagerSharedViewModel.set("productChanges",e),this.subViewModels.orderManagerSharedViewModel.handleAction("CreateChangeOrderActionForProduct")},getPayload:function(b,c,d){var e={newSimpleProducts:[]},f=this;return"object"==typeof c?a.each(c,function(a){var c=f.getAddProductConfig(b,a,d);e.newSimpleProducts.push(c)}):e.newSimpleProducts.push(this.getAddProductConfig(b,c,d)),e},getAddProductConfig:function(a,b,c){return{simpleProductSpecID:b,temporaryID:this.getRequestRandomNumber(),businessType:c,parentProductID:a}},getRequestRandomNumber:function(){return i.generateTemporaryId()},setSelectedItem:function(a){var b={item:{catalogItemID:a.myStuffTopItems.catalogItemID,businessType:a.myStuffTopItems.businessType,containingOfferings:a.myStuffTopItems.containingOfferings,lob:a.myStuffTopItems.lob,sellableWithoutPlan:a.myStuffTopItems.sellableWithoutPlan}};this.subViewModels.itemListTopicViewModel.set("selectedItem",b),this.subViewModels.customerSubscriptionsSharedViewModel.set("selectedItem",b)}}).extend({})});
define("businesswidget/repository/common/viewmodel/ProductConfigurationStepDetailsTopicViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ViewModel.extend({defaults:{stepName:null}})});
define("businesswidget/repository/common/viewmodel/DeviceInfoTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{widgetInstanceID:null,deviceCatalaogID:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"DeviceInfoTopicViewModel",path:"businesswidget/repository/common/viewmodel/DeviceInfoTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"ViewModel for DeviceInfo Topic","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetInstanceID:{key:"widgetInstanceID",value:"null"},deviceCatlogID:{key:"deviceCatlogID",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/ProductConfigurationStatusTopicViewModel",["lightsaber"],function (a){
var b=a.Core.ViewModel.extend({defaults:{widgetInstanceID:null,Status:null,ConfigurationChange:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ProductConfigurationStatusTopicViewModel",path:"businesswidget/repository/common/viewmodel/ProductConfigurationStatusTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"ViewModel for ProductConfigurationStatus topic","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetInstanceID:{key:"widgetInstanceID",value:"null\n"},Status:{key:"Status",value:"null"},ConfigurationChange:{key:"ConfigurationChange",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/PhoneNumberInfoTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({defaults:{widgetInstanceID:null,phoneNumber:null}}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"PhoneNumberInfoTopicViewModel",path:"businesswidget/repository/common/viewmodel/PhoneNumberInfoTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{widgetInstanceID:{key:"widgetInstanceID",value:"null"},phoneNumber:{key:"phoneNumber",value:"null"}},methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/DeviceAndPhoneInfoTopicViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({}),c=b.extend({}),d={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"DeviceAndPhoneInfoTopicViewModel",path:"businesswidget/repository/common/viewmodel/DeviceAndPhoneInfoTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"ViewModel for DeviceAndPhoneInfo Topic","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/model/SubscriptionDetailsModel",["jquery","businesswidget/repository/common/core/RESTModel","underscore","Configuration"],function (a,b,c,d){return b.extend({options:{url:"ecommerce/customer/:custId/subscription-details",rest:{defaults:{qParams:{lo:d.get("locale"),sc:d.get("salesChannel"),status:d.get("subscriptionStatuses")}}}}})});
define("businesswidget/repository/common/viewmodel/SubscriptionsListViewModel",["jquery","underscore","lightsaber","businesswidget/repository/common/model/CustomerSubscriptionsModel","businesswidget/repository/common/model/SubscriptionDetailsModel","sync!businesswidget/repository/common/viewmodel/UserInformationViewModel","single!businesswidget/repository/common/viewmodel/CancelLinkViewModel","Configuration"],function (a,b,c,d,e,f,g,h){return c.Core.ViewModel.extend({defaults:{entityID:null,entityType:null,widgetName:"searchSubscriptionWidget",widgetID:null,contextID:null,customerID:null,subscriptionDetails:[],pageSize:c.Core.StorageUtil.get("SubscriptionsSearchPageSize")||10},config:{validSmbSearchSubscriptionNameFilterLength:h.get("validSmbSearchSubscriptionNameFilterLength")},initialize:function(a){b.bindAll(this,"fetchSubscriptionsList","_createSubViewModels","subscriptionListSuccessHandler","subscriptionListErrorHandler","createPaginationDropDownViewModel","onPageSizeChange","prepareSubscriptionSearchRequest","getCurrentSelectedColumnSortState","validateFirstLastName","handleErrorResults","createSubscriptionsListItemViewModel","createSelectSubscriptionViewModel","subscriptionDetailsSuccessHandler","subscriptionSelectOnClickHandler","cacheDataforBrowserBack"),this.sortingState={NAME:{tabIndex:1,sortAsc:!0,selected:!1},SUBSCRIPTION_ID:{tabIndex:2,sortAsc:!1,selected:!1},STATUS:{tabIndex:3,sortAsc:!1,selected:!1},BUSINESS_GROUP:{tabIndex:4,sortAsc:!1,selected:!1}},this.subscriptionsSearchrequest=a.data,this.router=a.router,this._createSubViewModels(a),this.isBackScenario=a.config.isBackScenario},validateFirstLastName:function(){var a=this.subscriptionsSearchrequest.firstName?this.subscriptionsSearchrequest.firstName.length:0,b=this.subscriptionsSearchrequest.lastName?this.subscriptionsSearchrequest.lastName.length:0,c=this.getConfig("validSmbSearchSubscriptionNameFilterLength");if(!(a+b>0&&a+b<c))return!0;this.validationFlag=!1;var d=this.getString("searchSubscription_firstLastName_length_value"),e=this.getString("searchSubscription_firstLastName_invalidMessage",[d]);this.errorMessage=e},getCurrentSelectedColumnSortState:function(){return this.sortingState.NAME.selected?this.sortingState.NAME:this.sortingState.SUBSCRIPTION_ID.selected?this.sortingState.SUBSCRIPTION_ID:this.sortingState.STATUS.selected?this.sortingState.STATUS:this.sortingState.BUSINESS_GROUP.selected?this.sortingState.BUSINESS_GROUP:void 0},_createSubViewModels:function(a){this.createPaginationDropDownViewModel(a),this.createSubscriptionsListItemViewModel(),this.createSelectSubscriptionViewModel()},createSelectSubscriptionViewModel:function(){this.subViewModels.selectSubscriptionButtonViewModel=this.create("smb_SubscriptionsSearchViewModel_selectButton_viewModel",c.Core.ViewModel,{data:{label:this.getString("searchSubscription_selectSubscriptionButton_label")},config:{actions:{click:this.subscriptionSelectOnClickHandler}}})},createSubscriptionsListItemViewModel:function(){this.subViewModels.SubscriptionsListItemViewModel=this.create("smb_subscriptionsListViewModel_subscriptionsListItem_CollectionViewModel",c.CollectionViewModel,{models:{items:new c.Core.Collection},config:{autoUpdate:!0,supportsPagination:!0}})},fetchSubscriptionsList:function(){this.models.customerSubscriptionsModel=this.create("smb_subscriptionsListViewModel_subscriptions_CustomerSubscriptionsModel",d),this.models.customerSubscriptionsModel.set("customerId",this.get("customerID"));var a,b;this.isBackScenario?(a=c.Core.StorageUtil.get("searchSubscriptionFilterCache"),void 0!=this.subscriptionsSearchrequest.sortAscending&&a&&(a.sortAscending=this.subscriptionsSearchrequest.sortAscending),this.subscriptionsSearchrequest.sortBy&&a&&(a.sortBy=this.subscriptionsSearchrequest.sortBy),b=!1):(a=this.prepareSubscriptionSearchRequest(),b=this.subscriptionsSearchrequest.limitSize),a.filterBy=this.get("filterBy");var e={ls:b};this.models.customerSubscriptionsModel.setQueryParams(e),this.models.customerSubscriptionsModel.save({SearchSubscriptionRequest:a},{success:this.subscriptionListSuccessHandler,error:this.subscriptionListErrorHandler})},prepareSubscriptionSearchRequest:function(){var a=this.subscriptionsSearchrequest,b={sortAscending:a.sortAscending,sortBy:a.sortBy,status:a.status};return a.firstName&&""!=a.firstName&&(b.firstName=a.firstName),a.lastName&&""!=a.lastName&&(b.lastName=a.lastName),a.mobileNumber&&""!=a.mobileNumber&&(b.resourceId=a.mobileNumber),a.agreementId&&"All"!=a.agreementId&&(b.frameworkAgreementId=a.agreementId),a.groupId&&"All"!=a.groupId&&(b.businessGroupId=a.groupId),a.offerId&&"All"!=a.offerId&&(b.billingOfferTemplateId=a.offerId),c.Core.StorageUtil.set("searchSubscriptionFilterCache",b),b},subscriptionListErrorHandler:function(a){this.trigger("errorOccured")},subscriptionListSuccessHandler:function(a,b){if(this.subViewModels.SubscriptionsListItemViewModel.models.items.length>0&&this.subViewModels.SubscriptionsListItemViewModel.models.items.reset(),b.Subscriptions.errorMessage)this.handleErrorResults(b.Subscriptions.errorMessage.code);else if(b.Subscriptions&&b.Subscriptions.subscriptions&&0!==b.Subscriptions.subscriptions.length)this.subViewModels.SubscriptionsListItemViewModel.models.items.setPagination({pageSize:c.Core.StorageUtil.get("SubscriptionsSearchPageSize")}),this.subViewModels.SubscriptionsListItemViewModel.models.items.reset(),this.subViewModels.SubscriptionsListItemViewModel.models.items.add(b.Subscriptions.subscriptions);else{var d=this.getString("searchSubscription_noSubscriptionsFound_message");this.validationFlag=!1,this.errorMessage=d}this.trigger("subscriptions:loaded")},executeSubscriptionDetailsSvc:function(a,b){this.models.subscriptionDetailsModel=this.create("smb_SubscriptionDetailsViewModel_SubscriptionDetailsModel",e,{});var c={lo:h.get("locale"),sc:h.get("salesChannel"),ri:a,status:h.get("subscriptionStatuses")};b&&(c.pi=b),this.models.subscriptionDetailsModel.setQueryParams(c),this.models.subscriptionDetailsModel.set({custId:this.subscriptionsSearchrequest.customerId}),this.models.subscriptionDetailsModel.fetch({success:this.subscriptionDetailsSuccessHandler})},subscriptionDetailsSuccessHandler:function(a,b){if(c.Core.StorageUtil.set("SearchSubscriptionDetailsResponse",b),null!==b&&b.SubscriptionDetails&&void 0===b.SubscriptionDetails.productID){var d=this.getString("searchSubscription_noSubscriptionsFound_message");this.validationFlag=!1,this.errorMessage=d}this.trigger("singleSubscriptionsDetails:loaded")},subscriptionSelectOnClickHandler:function(a){var c=this,d=this.subViewModels.SubscriptionsListItemViewModel,e=d.get("items");b.each(e,function(a){if(a.get("subscriptionID")===c.get("selectedSubscription")){var b=[{subscriptionID:a.get("subscriptionID"),reference:a.get("subscriptionID"),individualID:a.get("contactDetails").personID,individualFirstName:a.get("contactDetails").firstName,individualLastName:a.get("contactDetails").lastName}];c.set("subscriptionDetails",b);var d={typeStr:c.get("entityType"),id:c.get("entityID")};return g.set("widgetName","searchSubscriptionWidget"),g.set("identifier",d),g.handleAction("LinkClicked"),!1}})},handleErrorResults:function(a){"CRMLargeResults"!==a&&"OrderingLargeResults"!==a||(this.errorMessage=this.getString("searchSubscription_crm_ordering_largeResults_errorMessage"),this.validationFlag=!1)},createPaginationDropDownViewModel:function(a){var b=new c.Core.Collection;if(0===a.config.dropDownList.length)b.add({value:10}),b.add({value:20}),b.add({value:30});else for(var d=0;d<a.config.dropDownList.length;d++)b.add({value:a.config.dropDownList[d]});this.subViewModels.paginationDropDownViewModel=new c.FormElementViewModel({data:{label:""},config:{optionsModelName:"options",optionsValueFieldName:"value",optionsDisplayFieldName:"value"},models:{options:b}}),void 0===c.Core.StorageUtil.get("SubscriptionsSearchPageSize")?c.Core.StorageUtil.set("SubscriptionsSearchPageSize",this.get("pageSize")):this.subViewModels.paginationDropDownViewModel.set("fieldValue",c.Core.StorageUtil.get("SubscriptionsSearchPageSize")),this.subViewModels.paginationDropDownViewModel.on("change:fieldValue",this.onPageSizeChange,this)},onPageSizeChange:function(a){c.Core.StorageUtil.set("SubscriptionsSearchPageSize",parseInt(a.value)),this.fetchSubscriptionsList()},cacheDataforBrowserBack:function(){this.subscriptionsSearchrequest.firstName,this.subscriptionsSearchrequest.lastName,this.subscriptionsSearchrequest.mobileNumber,this.subscriptionsSearchrequest.agreementId,this.subscriptionsSearchrequest.groupId,this.subscriptionsSearchrequest.offerId}})});
define("businesswidget/repository/common/viewmodel/SubscriptionsSearchWidgetViewModel",["jquery","underscore","lightsaber","sync!businesswidget/repository/common/viewmodel/UserInformationViewModel","businesswidget/repository/common/viewmodel/SubscriptionsListViewModel","businesswidget/repository/common/model/FrameworkAgreementsModel","Configuration"],function (a,b,c,d,e,f,g){var h=c.Core.ViewModel.extend({defaults:{customerId:null,locale:g.get("locale"),includeMoreLessLink:!0,numberOfResultsPerPageDropdownList:[10,20,30],displayResultsOnInitialization:!0,searchByFieldsList:["NAME","SUBSCRIPTION_ID","AGREEMENT"],showDetailsLink:!0},initialize:function(a){b.bindAll(this,"_createSubViewModels","createAgreementDropDownViewModel","createGroupDropDownViewModel","createOfferDropDownViewModel","frameworkAgreementsSuccess","loadFwaData","createSubscriptionsSearchData","createAddSubscriptionsViewModel","createTextInputViewModel","isValidationErrorExist","_createValidationList","addSubscriptionButtonClick","resetSubViewModels","getSelectionData","resetSelectionData","setPreselectedDataOnBack"),this.router=a.router,this.userInformationViewModel=d,this.userInformationViewModel&&this.userInformationViewModel.getProperty("customerId")&&this.set("customerId",this.userInformationViewModel.getProperty("customerId")),this.nameRegExp=/^[a-zA-Z0-9']+$|^$/,this._createValidationList(),this._createSubViewModels(a),this.initModels()},_createValidationList:function(){this._validationErrorCollection=this.create("smb_SubscriptionsSearchViewModel_validationErrorCollection_Collection",c.Core.Collection.extend({model:c.Core.Model.extend({idAttribute:"key"})})),this.subViewModels.validationErrorList=this.create("smb_SubscriptionsSearchViewModel_validationErrorListViewModel_CollectionViewModel",c.CollectionViewModel,{models:{items:this._validationErrorCollection}})},addError:function(a,b){this._validationErrorCollection.add({key:a,msg:b})},isValidationErrorExist:function(){return this._validationErrorCollection.models.length>0},removeError:function(a){this._validationErrorCollection.remove(a),this.isValidationErrorExist()||this.trigger("emptyErrors")},initModels:function(){this.models.frameworkAgreementsModel=this.create("smb_smbSelectOfferViewModel_FrameworkAgreementsModel",f)},loadFwaData:function(){this.models.frameworkAgreementsModel.set("customerId",this.get("customerId")),this.models.frameworkAgreementsModel.fetch({success:this.frameworkAgreementsSuccess})},frameworkAgreementsSuccess:function(a,b){this.agreementsData={},this.agreementsData=b.FrameworkAgreements.agreements,this.createFrameworkAgreementData(),this.trigger("agreementsListLoaded")},createFrameworkAgreementData:function(){var a=new c.Core.Collection;if(a.add({name:this.getString("searchSubscription_allAgreements_placeHolder"),value:"All"}),this.agreementsData&&this.agreementsData.length>0)for(var b=0;b<this.agreementsData.length;b++)a.add({name:this.agreementsData[b].name,value:this.agreementsData[b].ID});this.subViewModels.agreementDropDownViewModel.models.options=a,a&&a.length<=2&&this.subViewModels.agreementDropDownViewModel.setConfig("visible",!1),this.selectedFrameworkAgreement="All",this.agreementsData&&(this.createGroupData("All"),this.createOfferData("All"))},createGroupData:function(a){var b=new c.Core.Collection;if(b.add({name:this.getString("searchSubscription_allGroups_placeHolder"),value:"All"}),a)for(var d=0;d<this.agreementsData.length;d++)if((this.agreementsData[d].ID===a||"All"===a)&&this.agreementsData[d].businessGroups)for(var e=0;e<this.agreementsData[d].businessGroups.length;e++)b.add({name:this.agreementsData[d].businessGroups[e].name,value:this.agreementsData[d].businessGroups[e].id});this.groupData=b,this.subViewModels.groupDropDownViewModel.models.options=this.groupData,this.groupData&&this.groupData.length<=2&&this.subViewModels.groupDropDownViewModel.setConfig("visible",!1)},createOfferData:function(a){var b=new c.Core.Collection;if(b.add({name:this.getString("searchSubscription_allOffers_placeHolder"),value:"All"}),a)for(var d=0;d<this.agreementsData.length;d++)for(var e=0;e<this.agreementsData[d].businessGroups.length;e++)if(!("All"!==this.selectedFrameworkAgreement&&this.selectedFrameworkAgreement!==this.agreementsData[d].ID||this.agreementsData[d].businessGroups[e].id!==a&&"All"!==a)&&this.agreementsData[d].businessGroups[e].billingOfferTemplates)for(var f=0;f<this.agreementsData[d].businessGroups[e].billingOfferTemplates.length;f++)b.add({name:this.agreementsData[d].businessGroups[e].billingOfferTemplates[f].name,value:this.agreementsData[d].businessGroups[e].billingOfferTemplates[f].id});this.offerData=b,this.subViewModels.offerDropDownViewModel.models.options=this.offerData,this.offerData&&this.offerData.length<=2&&this.subViewModels.offerDropDownViewModel.setConfig("visible",!1)},_createSubViewModels:function(a){this.createAddSubscriptionsViewModel(),this.createTextInputViewModel(),this.createAgreementDropDownViewModel(),this.createGroupDropDownViewModel(),this.createOfferDropDownViewModel()},createAddSubscriptionsViewModel:function(){this.subViewModels.addSubscriptionButtonViewModel=this.create("smb_SubscriptionsSearchViewModel_selectButton_viewModel",c.Core.ViewModel,{data:{label:this.getString("searchSubscription_addSubscriptionButton_label")},config:{actions:{click:this.addSubscriptionButtonClick}}})},createTextInputViewModel:function(){var a=c.Core.Model.extend({validations:[{check:"regExp",fieldName:"firstName",pattern:this.nameRegExp}]});this.firstNameValidationModel=new a,this.subViewModels.firstNameViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_firstNameViewModel",c.Core.ViewModel,{models:{firstNameModel:this.firstNameValidationModel},dataBindings:[{fieldValue:"models.firstNameModel.firstName",options:{setOnBind:!0,twoWay:!0}}]});var b=c.Core.Model.extend({validations:[{check:"regExp",fieldName:"lastName",pattern:this.nameRegExp}]});this.subViewModels.lastNameViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_lastNameViewModel",c.Core.ViewModel,{models:{lastNameModel:new b},dataBindings:[{fieldValue:"models.lastNameModel.lastName",options:{setOnBind:!0,twoWay:!0}}]});var d=c.Core.Model.extend({validations:[{check:"regExp",fieldName:"mobileNumber",pattern:"^$|"+g.get("phone_number_pattern"),warn:{set:!1}}]});this.mobileNumberValidationModel=new d({fieldName:"mobileNumber"}),this.subViewModels.mobileNumberViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_mobileNumberViewModel",c.Core.ViewModel,{models:{mobileNumberModel:this.mobileNumberValidationModel},dataBindings:[{fieldValue:"models.mobileNumberModel.mobileNumber",options:{setOnBind:!0,twoWay:!0}}]})},createSubscriptionsSearchViewModel:function(a){this.subViewModels.subscriptionsListViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_subscriptionsListViewModel",e,{data:this.searchSubsciptionsInputObj,config:{autoLoad:!1,dropDownList:this.getConfig("numberOfResultsPerPageDropdownList"),isBackScenario:a}}),this.subViewModels.subscriptionsListViewModel.setConfig("displayResultOnInit",this.getConfig("displayResultsOnInitialization")),this.subViewModels.subscriptionsListViewModel.set("customerID",this.get("customerId")),this.subViewModels.subscriptionsListViewModel.set("filterBy",this.get("filterBy"))},createAgreementDropDownViewModel:function(){this.subViewModels.agreementDropDownViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_agreementDropDownViewModel",c.CollectionViewModel,{data:{label:this.getString("searchSubscription_page_agreement_label")},config:{optionsModelName:"options",optionsValueFieldName:"value",optionsDisplayFieldName:"name"},models:{options:new c.Core.Collection}}),this.subViewModels.agreementDropDownViewModel.on("change:fieldValue",this.onFrameworkAgreementChange,this)},createGroupDropDownViewModel:function(){this.subViewModels.groupDropDownViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_groupDropDownViewModel",c.CollectionViewModel,{data:{label:this.getString("searchSubscription_page_group_label")},config:{optionsModelName:"options",optionsValueFieldName:"value",optionsDisplayFieldName:"name"},models:{options:new c.Core.Collection}}),this.subViewModels.groupDropDownViewModel.on("change:fieldValue",this.onBussinessGroupChange,this)},createOfferDropDownViewModel:function(){this.subViewModels.offerDropDownViewModel=this.create("smb_subscriptionListPage_SubscriptionsSearchViewModel_offerDropDownViewModel",c.CollectionViewModel,{data:{label:this.getString("searchSubscription_page_offer_label")},config:{optionsModelName:"options",optionsValueFieldName:"value",optionsDisplayFieldName:"name"},models:{options:new c.Core.Collection}})},onFrameworkAgreementChange:function(a){this.createGroupData(a.value),this.selectedFrameworkAgreement=a.value,this.createOfferData("All"),this.trigger("Groupfilter:updated"),this.trigger("Offerfilter:updated")},onBussinessGroupChange:function(a){this.createOfferData(a.value),this.trigger("Offerfilter:updated")},addSubscriptionButtonClick:function(a){this.trigger("newSubscriptionButtonClicked")},createSubscriptionsSearchData:function(a){var b,d;if(c.Core.StorageUtil.get("searchSubscriptionFilterCache"))this.setPreselectedDataOnBack(),d=!0;else{b=this.getSelectionData(),this.resetSelectionData(),b&&b.agreementId&&this.subViewModels.agreementDropDownViewModel.set("fieldValue",b.agreementId),b&&b.groupId&&this.subViewModels.groupDropDownViewModel.set("fieldValue",b.groupId),b&&b.offerId&&this.subViewModels.offerDropDownViewModel.set("fieldValue",b.offerId),b&&b.mobileNumber&&(this.prepoupaltedMobNo=b.mobileNumber,this.subViewModels.mobileNumberViewModel.set("fieldValue",b.mobileNumber)),b&&b.firstName&&this.subViewModels.firstNameViewModel.set("fieldValue",b.firstName),b&&b.lastName&&this.subViewModels.lastNameViewModel.set("fieldValue",b.lastName);var e={customerId:this.get("customerId"),firstName:this.subViewModels.firstNameViewModel.get("fieldValue"),lastName:this.subViewModels.lastNameViewModel.get("fieldValue"),mobileNumber:this.subViewModels.mobileNumberViewModel.get("fieldValue"),agreementId:this.subViewModels.agreementDropDownViewModel.get("fieldValue"),groupId:this.subViewModels.groupDropDownViewModel.get("fieldValue"),offerId:this.subViewModels.offerDropDownViewModel.get("fieldValue"),sortAscending:!this.sortAscendingFlag||this.sortAscendingFlag,sortBy:"NAME",status:["ACTIVE","SUSPENDED"]},f=!1;(b&&b.agreementId||b&&b.groupId||b&&b.groupId||b&&b.groupId||b&&b.mobileNumber)&&(f=!0),!0===this.get("isSearchClicked")||f?e.limitSize=!1:e.limitSize=!0,this.searchSubsciptionsInputObj=e}this.createSubscriptionsSearchViewModel(d)},resetSubViewModels:function(){this.subViewModels.firstNameViewModel.set("fieldValue"),this.subViewModels.lastNameViewModel.set("fieldValue"),this.subViewModels.mobileNumberViewModel.set("fieldValue"),this.subViewModels.agreementDropDownViewModel.set("fieldValue"),this.subViewModels.groupDropDownViewModel.set("fieldValue"),this.subViewModels.offerDropDownViewModel.set("fieldValue")},getSelectionData:function(){var a={};return a.agreementId=this.get("frameworkAgreementID"),a.groupId=this.get("businessGroupID"),a.offerId=this.get("businessOfferTemplateID"),a.mobileNumber=this.get("subscriptionMobileNumber"),a.firstName=this.get("subscriptionFirstName"),a.lastName=this.get("subscriptionLastName"),a},resetSelectionData:function(){this.set("frameworkAgreementID"),this.set("businessGroupID"),this.set("businessOfferTemplateID"),this.set("subscriptionMobileNumber"),this.set("subscriptionFirstName"),this.set("subscriptionLastName")},setPreselectedDataOnBack:function(){selectedDataOnBack=c.Core.StorageUtil.get("searchSubscriptionFilterCache"),selectedDataOnBack&&selectedDataOnBack.frameworkAgreementId&&this.subViewModels.agreementDropDownViewModel.set("fieldValue",selectedDataOnBack.frameworkAgreementId),selectedDataOnBack&&selectedDataOnBack.businessGroupId&&this.subViewModels.groupDropDownViewModel.set("fieldValue",selectedDataOnBack.businessGroupId),selectedDataOnBack&&selectedDataOnBack.billingOfferTemplateId&&this.subViewModels.offerDropDownViewModel.set("fieldValue",selectedDataOnBack.billingOfferTemplateId),selectedDataOnBack&&selectedDataOnBack.resourceId&&this.subViewModels.mobileNumberViewModel.set("fieldValue",selectedDataOnBack.resourceId),selectedDataOnBack&&selectedDataOnBack.firstName&&this.subViewModels.firstNameViewModel.set("fieldValue",selectedDataOnBack.firstName),selectedDataOnBack&&selectedDataOnBack.lastName&&this.subViewModels.lastNameViewModel.set("fieldValue",selectedDataOnBack.lastName)}}),i=h.extend({}),j={path:"businesswidget/repository/common/viewmodel/SubscriptionsSearchWidgetViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"SubscriptionsSearchWidgetViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:null,methods:{initialize:{name:"initialize",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_createValidationList:{name:"_createValidationList",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},addError:{name:"addError",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},isValidationErrorExist:{name:"isValidationErrorExist",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},removeError:{name:"removeError",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initModels:{name:"initModels",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},loadFwaData:{name:"loadFwaData",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},frameworkAgreementsSuccess:{name:"frameworkAgreementsSuccess",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createFrameworkAgreementData:{name:"createFrameworkAgreementData",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createGroupData:{name:"createGroupData",privacyLevel:"protected",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createOfferData:{name:"createOfferData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},_createSubViewModels:{name:"_createSubViewModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createAddSubscriptionsViewModel:{name:"createAddSubscriptionsViewModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createTextInputViewModel:{name:"createTextInputViewModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createSubscriptionsSearchViewModel:{name:"createSubscriptionsSearchViewModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createAgreementDropDownViewModel:{name:"createAgreementDropDownViewModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createGroupDropDownViewModel:{name:"createGroupDropDownViewModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createOfferDropDownViewModel:{name:"createOfferDropDownViewModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onFrameworkAgreementChange:{name:"onFrameworkAgreementChange",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onBussinessGroupChange:{name:"onBussinessGroupChange",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},addSubscriptionButtonClick:{name:"addSubscriptionButtonClick",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},createSubscriptionsSearchData:{name:"createSubscriptionsSearchData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},resetSubViewModels:{name:"resetSubViewModels",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getSelectionData:{name:"getSelectionData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},resetSelectionData:{name:"resetSelectionData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setPreselectedDataOnBack:{name:"setPreselectedDataOnBack",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return i.prototype.getMetaData=function(){return j},i});
define("businesswidget/repository/common/viewmodel/OrderConfirmationTopicViewModel",["lightsaber"],function (a){return a.Core.ViewModel.extend({persistent:["customerId","orderId"],defaults:{customerId:null,orderId:null}})});
define("businesswidget/repository/common/model/CustomerDetailsModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"customer/:customerId/name",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}},parse:function(a,c){var d=a.CustomerName.name;!0!==b.Core.Configuration.get("isCallCenterView")&&(d="( "+d+" )"),this.set("customerName",d)}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/CustomerDetailsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerDetailsModel",savePath:"businesswidget/repository/common/model",description:"Holds the customerName and customerId","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/:customerId/name"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{method:{value:"GET"}},read:{contentType:{value:"application/json"},payload:{value:["[]"]},qParams:{value:[{key:"sc",value:"Lightsaber.Core.Configuration.get('salesChannel')"},{key:"lo",value:"Lightsaber.Core.Configuration.get('locale')"}],isJSON:!0}}}},validations:[],methods:{parse:{name:"parse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/RateAndReviewTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["productOfferingId"],defaults:{productOfferingId:null}})});
define("businesswidget/repository/common/viewmodel/ReservedItemListTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({defaults:{pickupDevices:null,pickupSuccessful:null,pickupErrorMsg:null,ready:!1}})});
define("businesswidget/repository/common/viewmodel/ReserveItemRequestTopicViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ViewModel.extend({})});
define("businesswidget/repository/common/viewmodel/ShopTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({defaults:{}})});
define("businesswidget/repository/common/viewmodel/SendServiceAgreementTopicViewModel",["underscore","lightsaber"],function (a,b){return b.Core.ObservableViewModel.extend({persistent:["status"],defaults:{status:null}})});
define("businesswidget/repository/common/viewmodel/SelectedRecommendTargetPlanTopicViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ObservableViewModel.extend({persistent:["sourceProducts"],defaults:{sourceProducts:[],replaceData:null,moreDetailsData:null,selectedSourceProduct:null}})});
define("i18n!businesswidget/repository/common/i18n/commerce/web/nls/commerceStrings",{"cm_searchSubscription_header":"Subscriptions_FR","cm_searchSubscription_header_subTitle":"Find Subscription_FR","cm_searchSubscription_columnHeader_name":"Name_FR","cm_searchSubscription_columnHeader_mobileNumber":"Mobile Number_FR","cm_searchSubscription_columnHeader_status":"Status_FR","cm_searchSubscription_columnHeader_group":"Group_FR","cm_searchSubscription_columnHeader_details":"Details_FR","cm_SubscriptionsList_pagination_subText1":"Show_FR","cm_SubscriptionsList_pagination_subText2":" results per page_FR","cm_searchSubscription_moreFilterOptions_label":"More Search Options_FR","cm_searchSubscription_clearSearch":"Clear Search_FR","cm_searchSubscription_addSubscriptionButton_label":"Add Subscription_FR","cm_searchSubscription_firstName":"First Name_FR","cm_searchSubscription_lastName":"Last Name_FR","cm_searchSubscription_mobileNumber":"Mobile Number_FR","cm_searchSubscription_lessFilterOptions_label":"Fewer Search Options_FR","cm_searchSubscription_deviceNumberField_placeHolder":"10-digit number_FR","cm_searchSubscription_allOffers_placeHolder":"All Offers_FR","cm_searchSubscription_allGroups_placeHolder":"All Groups_FR","cm_searchSubscription_allAgreements_placeHolder":"All Agreements_FR","cm_searchSubscription_page_agreement_label":"Agreement_FR","cm_searchSubscription_page_group_label":"Group_FR","cm_searchSubscription_page_offer_label":"Offer_FR","cm_SubscriptionsList_pagination_info":"Showing {0}-{1} of {2} subscriptions_FR","cm_shop_web_nextPage":"Next >","cm_shop_web_prevPage":"< Previous","root":{},"en":true,"fr":true});
define("text!businesswidget/repository_l3_common/common/config/l3_common.commercePackage.config.json",function (){return"({\n\n})\n\n"});
define("i18n!businesswidget/repository_l3_common/common/i18n/commerce/web/nls/l3_common.commerceStrings",{"root":{},"en":true,"fr":true});
define("i18n!businesswidget/repository_l9_common/common/i18n/commerce/web/nls/l9_common.commerceStrings",{"root":{},"en":true,"fr":true});
define("l9_common.support.custom",["replace","businesswidget/repository_l9_common/common/utils/ImplCopySessionStorage"],function() {});
define("businesswidget/repository_l9_common/common/viewmodel/CreateCaseViewModel",["underscore","Configuration","businesswidget/repository/common/model/CreateCustomerProblemModel","businesswidget/repository/common/viewmodel/CreateCustomerProblemViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ContactInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OrderInContextTopicViewModel"],function (a,b,c,d,e,f,g,h){var i=d.extend({models:{createCustomerProblemModel:c,customerInContextTopicViewModel:e,contactInContextTopicViewModel:g,accountInContextTopicViewModel:f,orderInContextTopicViewModel:h},dataBindings:[{customerId:"models.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){var c=b.valueObject.get().data.ID();this.set("customerId",c)}}},{contactId:"models.contactInContextTopicViewModel.ID",
options:{twoWay:!1,setOnBind:!0,setter:function(a,b){var c=b.valueObject.get().data.ID();this.set("contactId",c)}}},{customerProblemId:"models.createCustomerProblemModel.CreateCustomerProblemResponse.customerProblemId",options:{twoWay:!1,setOnBind:!0}},{barId:"models.accountInContextTopicViewModel.barId",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){var c=b.valueObject.get().data.barId();this.set("barId",c)}}},{tempOrderId:"models.orderInContextTopicViewModel.productOrderID",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){var c=b.valueObject.get().data.productOrderID();this.set("tempOrderId",c)}}},{tempBarId:"models.orderInContextTopicViewModel.barId",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){var c=b.valueObject.get().data.barId();this.set("tempBarId",c)}}},{tempCustomerId:"models.orderInContextTopicViewModel.customerID",options:{twoWay:!1,setOnBind:!0,setter:function(a,b){var c=b.valueObject.get().data.customerID();this.set("tempCustomerId",c)}}}],defaults:{barId:"",customerId:"",contactId:"",severity:"",priority:"",problemTypeLevel:"",additionalCustomerProblemDetails:"",reporterIndividualId:"",reporterCustomerId:"",name:"",caseDescription:"",associatedItem:"",status:"",saveOption:"",queueID:"",saveInWorkFolder:"",caseSeverity:"",casePriority:"",caseType1:"",caseType2:"",caseType3:"",customerProblemId:"",caseTitle:"",createCaseVmStatus:"",orderBarId:"",paperBillCaseData:null,createCaseSuccessStatus:null,orderId:null,orderCustomerId:null,tempOrderId:null,tempBarId:null,tempCustomerId:null},initialize:function(a){this._super(a),this.set("createCaseVmStatus","initialized");var b=this;setTimeout(function(){b.get("tempBarId")?b.set("orderBarId",b.get("tempBarId")):b.set("orderBarId",b.models.orderInContextTopicViewModel.get("barId")),b.get("tempOrderId")?b.set("orderId",b.get("tempOrderId")):b.set("orderId",b.models.orderInContextTopicViewModel.get("productOrderID")),b.get("tempCustomerId")?b.set("orderCustomerId",b.get("tempCustomerId")):b.set("orderCustomerId",b.models.orderInContextTopicViewModel.get("customerID"))},0)},submitCase:function(){this.set("createCaseVmStatus","createCaseInProgress"),this._super()},onCaseType2Changed:function(){return!1},_createDefaultCreateCaseView:function(){return!1},setPaperBillData:function(){this.set("createCaseSuccessStatus",null),this.models.createCustomerProblemModel.set("additionalCustomerProblemDetails",{parentProblemId:"",reporterSiteId:"",reporterAddressId:"",reporterOrganizationId:""}),this.set("customerBillSpecId",this.get("barId")),this.set("associatedItemID",this.get("barId")),this.set("associatedItemType","CUSTOMER_BILL_SPEC"),this.set("reporterIndividualId",this.get("contactId")),this.set("individualId",this.get("contactId")),this.set("caseTitle","Paper bill request"),this.set("caseSeverity","Urgent"),this.set("casePriority","Urgent"),this.set("caseType1","SpringDigital"),this.set("caseType2","Billing"),this.set("caseType3","RequestHardCopyBills"),this.set("createCaseSuccessStatus","paperBillCaseSuccess"),this.set("createCaseVmStatus","paperBillDataSet"),this.submitCase()},updateAddressCase:function(){this.set("createCaseSuccessStatus",null),this.models.createCustomerProblemModel.set("additionalCustomerProblemDetails",{parentProblemId:"",reporterSiteId:"",reporterAddressId:"",reporterOrganizationId:""}),this.set("customerBillSpecId",this.get("barId")),this.set("associatedItemID",this.get("barId")),this.set("associatedItemType","CUSTOMER_BILL_SPEC"),this.set("reporterIndividualId",this.get("contactId")),this.set("individualId",this.get("contactId")),this.set("caseDescription","Address Update request"),this.set("caseTitle","Address Update request"),this.set("caseSeverity","Urgent"),this.set("casePriority","Urgent"),this.set("caseType1","SpringDigital"),this.set("caseType2","Billing"),this.set("caseType3","ChangeBillingAddress"),this.set("createCaseVmStatus","addressDetailsSet")},setAccountConsolidationData:function(){this.set("createCaseSuccessStatus",null),this.models.createCustomerProblemModel.set("additionalCustomerProblemDetails",{parentProblemId:"",reporterSiteId:"",reporterAddressId:"",reporterOrganizationId:""}),this.set("customerBillSpecId",this.models.accountInContextTopicViewModel.attributes.get("barId")),this.set("associatedItemID",this.models.accountInContextTopicViewModel.attributes.get("barId")),this.set("associatedItemType","CUSTOMER_BILL_SPEC"),this.set("reporterIndividualId",this.get("contactId")),this.set("reporterCustomerId",this.get("customerId")),this.set("individualId",this.get("contactId")),this.set("caseTitle","Account consolidate request"),this.set("caseSeverity","Urgent"),this.set("casePriority","Urgent"),this.set("caseType1","Billing"),this.set("caseType2","BillAccountAccountConsolidation"),this.set("caseType3","TooManyAccounts"),this.set("createCaseVmStatus","accountConsolidationDataSet"),this.submitCase()},setOrderCreationData:function(){this.set("createCaseSuccessStatus",null),this.models.createCustomerProblemModel.set("additionalCustomerProblemDetails",{parentProblemId:"",reporterSiteId:"",reporterAddressId:"",reporterOrganizationId:""}),this.set("customerBillSpecId",this.get("orderBarId")),this.set("associatedItemID",this.get("orderBarId")),this.set("associatedItemType","CUSTOMER_BILL_SPEC"),this.set("reporterIndividualId",this.get("contactId")),this.set("reporterCustomerId",this.get("orderCustomerId")),this.set("individualId",this.get("contactId"));var a=this.get("orderId")||this.get("tempOrderId");this.set("caseDescription","Your Order Failed,Order Id :"+a),this.set("caseTitle","Create Order request"),this.set("caseSeverity","Urgent"),this.set("casePriority","Urgent"),this.set("caseType1","SpringDigital"),this.set("caseType2","Sales"),this.set("caseType3","PaymentFailed"),this.set("createCaseVmStatus","createOrderCaseDataSet")},relocateServiceCase:function(){this.set("createCaseSuccessStatus",null),this.models.createCustomerProblemModel.set("additionalCustomerProblemDetails",{parentProblemId:"",reporterSiteId:"",reporterAddressId:"",reporterOrganizationId:""}),this.set("customerBillSpecId",b.get("BAR_ID")),this.set("associatedItemID",b.get("BAR_ID")),this.set("associatedItemType","CUSTOMER_BILL_SPEC"),this.set("reporterIndividualId",b.get("CONTACT_ID")),this.set("individualId",b.get("CONTACT_ID")),this.set("caseDescription","Relocate Service request"),this.set("caseTitle","Relocate Service request"),this.set("caseSeverity","Urgent"),this.set("casePriority","Urgent"),this.set("caseType1","SpringDigital"),this.set("caseType2","Care"),this.set("caseType3","Relocation"),this.set("createCaseVmStatus","addressDetailsSet"),this.submitCase()},onBillingEntityChange:function(){try{this._super()}catch(a){}},onCustomerProblemCreated:function(){if(this.get("customerProblemId")){var a=this.get("createCaseSuccessStatus")||"createCaseSuccessful";this.set("createCaseVmStatus",a)}else this.set("createCaseVmStatus","createCaseFailed")}});return i});
define("businesswidget/repository_l9_common/common/model/ManageCallBackAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/manageAppointments/contact-person/:contactId/webcallback/:callbackParam",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},create:{method:"PUT"},read:{method:"GET"}}}});return d});
define("businesswidget/repository_l9_common/common/model/TimeSlotsCallBackAppointmentModel",["lightsaber","businesswidget/repository/common/core/RESTModel","underscore"],function (a,b,c){var d=b.extend({options:{url:"/manageAppointments/contact-person/:contactId/webcallback/:callbackParam",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")},contentType:"application/json",method:"POST"}}}});return d});
define("businesswidget/repository_l9_common/common/model/CancelAvayaAppointment",["lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b){return b.extend({options:{url:"/manageAppointments/contact-person/:contactId/webcallback/:callbackParam",rest:{defaults:{qParams:{sc:a.Core.Configuration.get("salesChannel"),lo:a.Core.Configuration.get("locale")}},"delete":{method:"DELETE"}}}})});
define("businesswidget/repository_l9_common/common/viewmodel/bookCallBackAppointmentViewModel",["lightsaber","Configuration","underscore","single!businesswidget/repository_l9_common/common/model/ManageCallBackAppointmentModel","single!businesswidget/repository_l9_common/common/model/TimeSlotsCallBackAppointmentModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","single!businesswidget/repository_l9_common/common/model/findCallerByContactModel","businesswidget/repository_l9_common/common/model/CancelAvayaAppointment","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","businesswidget/repository_l9_common/common/utils/utility"],function (a,b,c,d,e,f,g,h,i,j,k,l,m){var n=a.Core.ObservableViewModel.extend({models:{manageCallBackAppointmentModel:d,timeSlotsCallBackAppointmentModel:e,onePassInfoModel:h,findCallerModel:i,cancelAvayaAppointment:j},subViewModels:{customerInContextTopicViewModel:f,individualInContextTopicViewModel:g,onePassTopicViewModel:k,onePassDetailsViewModel:l},dataBindings:[{customerID:"subViewModels.customerInContextTopicViewModel.ID",options:{twoWay:!1,setOnBind:!1}},{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{appointmentInfo:null,appointmentBookSuccess:null,bookCallBackVmStatus:"",timeSlots:null,availableTimeSlots:null,callBackQueryParam:null,userInfo:null,appointmentInput:null,slotDetails:null,pendingAppointment:null},onFetchSuccess:function(a,b){console.log("onFetchSuccess : ",a,b)},initialize:function(a){this._super(),c.bindAll(this,"getExistingAppointment","onFetchSuccess","retrieveTimeSlots","onFailure","formatSlots","getCustomerInfo","getCustomerIdType","cancelAppointment");var b=this.subViewModels.onePassTopicViewModel.get("nric");this.on("change:nric",this.getCustomerInfo(b),this)},getCustomerInfo:function(a){"undefined"!=typeof a&&null!==a||this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(c.bind(this.onOnePassInfoSuccess,this),function(){this.set("bookCallBackVmStatus","failure")}.bind(this))},cancelAppointment:function(){var a=this,b=a.models.cancelAvayaAppointment,d=a.get("pendingAppointment");b.set("contactId",a.get("contactId")),b.set("id",""),b.set("callbackParam",d.requestId),b.destroy({id:d.requestId,success:c.bind(a.retrieveTimeSlots,a),error:function(){a.set("bookCallBackVmStatus","failure")}})},onOnePassInfoSuccess:function(a){var b=this,d=a.ImplLoginHeaderResOutput.headersMap,e=b.getCustomerIdType(d.HTTP_CUST_ID_TYPE),f=d.HTTP_CUST_ID;if(f){var g={implContactDetails:{indentValue:f,indentType:e}};b.getModel("findCallerModel").save({ImplFindCallerByContactInput:g},{success:c.bind(this.onFindCallerSuccess,this),error:function(){b.set("bookCallBackVmStatus","failure")}})}},onFindCallerSuccess:function(a,b){var c=this,d=b.ImplFindCallerByContactOutput;c.set("userInfo",b.ImplFindCallerByContactOutput),c.set("contactId",d.contactDetails.contactId),c.set("customerID",d.contactCustomerDetails[0].customerId)},getCustomerIdType:function(a){var b="";switch(a){case"2":b="National Registration ID Card (NRIC)";break;case"6":b="Foreign Identification Number (FIN)";break;case"532":b="Foreigner Dependent Pass";break;case"534":b="Foreigner Employment Pass";break;case"535":b="Foreigner S Pass";break;case"533":b="Foreigner Student Pass";break;case"536":b="Passport Number";break;case"531":b="Foreigner Social Visit Pass";break;case"530":b="Foreigner Work Permit";break;case"600":b="Diplomat";break;case"539":b="Entre Pass"}return b},getExistingAppointment:function(a){var b,d=this,e=d.get("appointmentInput");b="Sales"===e.enquiry&&e.contactNumber?m.appendPhoneNumber(e.contactNumber):e.contactNumber;var f=e.confirmBookingFlow||!1,g=d.getModel("manageCallBackAppointmentModel");g.set("contactId",d.get("contactId")),g.set("callbackParam",b),g.setQueryParams(),g.fetch({success:c.bind(d.onFetchExistingAppointmentSuccess,d,f),error:c.bind(d.onFailure,d)})},onFetchExistingAppointmentSuccess:function(a,b,d){var e=this;this.set("appointmentBookSuccess",""),this.set("bookCallBackVmStatus","");var f=d.ImplPendingWebCallRestOutput,g=!1;f&&f.appointmentList&&c.each(f.appointmentList,function(a){"IN_PROGRESS"!==a.status&&"OUTSTANDING"!==a.status||(g=!0,e.set("pendingAppointment",a))}),g?e.set("bookCallBackVmStatus","blockAppointment"):(e.set("bookCallBackVmStatus","continueAppointment"),a!==!0&&e.retrieveTimeSlots())},retrieveTimeSlots:function(){var a=this,b=a.get("appointmentInput"),d=b.requiredApptDates,e=null,f=c.map(d,function(d){var f=$.Deferred(),g=a.getModel("timeSlotsCallBackAppointmentModel");return g.set({contactId:a.get("contactId"),callbackParam:b.serviceType}),g.setQueryParams({language:b.language,enquiry:b.enquiry,fromDate:d,timeZone:"8.0"}),g.save(null,{success:function(a,b){e=e||b;var d=b.ImplTimeSlotsAppointmentOutput.proposedTimeSlots;c.map(d,function(a,b){e.ImplTimeSlotsAppointmentOutput.proposedTimeSlots[b]=a})}}).always(f.resolve),f}.bind(this));$.when.apply(this,f).done(function(){e?a.onFetchTimeSlotsSuccess(e):this.onFailure()}.bind(this))},onFetchTimeSlotsSuccess:function(a){var b=this;if(a.ImplTimeSlotsAppointmentOutput){b.formatSlots(a.ImplTimeSlotsAppointmentOutput.proposedTimeSlots);var c={userInputKey:a.ImplTimeSlotsAppointmentOutput.calendarRefID,configurationId:a.ImplTimeSlotsAppointmentOutput.configurationId};this.set("callBackQueryParam",c),this.set("bookCallBackVmStatus","fetchSuccess")}},formatSlots:function(a){var b=this,d=[],e={enabledDays:[],dateTimeSlots:{}};c.each(a,function(a,b){e.enabledDays.push(b);var f=e.dateTimeSlots[b];c.each(a,function(a){a.localizedUsed||(a.localizedTextSlot=a.startTime),"undefined"==typeof f&&(f=[]),f.push({title:a.localizedTextSlot,value:a.slotId}),d.push({slotId:a.slotId,slotDate:a.appointmentDate})}),e.dateTimeSlots[b]=f}),e.enabledDays=c.uniq(e.enabledDays),b.set("timeslots",a),b.set("slotDetails",d),b.set("availableTimeSlots",e)},isAllDataAvailable:function(){return!0},submitCallBackAppointmentRequest:function(){var a=this;a.set("appointmentBookSuccess","InProgess"),a.set("bookCallBackVmStatus","InProgess");var b=a.get("appointmentInfo"),d=a.get("slotDetails");d&&(d=c.filter(d,function(a){return a.slotId===b.slotId}));var e=a.getModel("manageCallBackAppointmentModel"),f=a.get("callBackQueryParam");e.set({contactId:a.get("contactId"),callbackParam:f.configurationId});var g;g="Sales"===b.enquiry&&b.contactNumber?m.appendPhoneNumber(b.contactNumber):b.contactNumber,e.setQueryParams({customerId:a.subViewModels.customerInContextTopicViewModel.get("ID"),isNewService:b.isNewService,language:b.language,phone:g,serviceType:b.serviceType,slotId:b.slotId,enquiry:b.enquiry,userInputKey:f.userInputKey,slotDate:d[0].slotDate}),b.isNewService||e.setQueryParams("serviceId",b.serviceId),e.save(null,{success:c.bind(a.onBookAppointmentSuccess,a),error:c.bind(a.onBookAppointmentFailure,a)})},onBookAppointmentSuccess:function(a,b){b.ImplResultAppointmentOutput?this.set("appointmentBookSuccess",b):this.set("bookCallBackVmStatus","failure")},onFailure:function(a,b){this.set("bookCallBackVmStatus","failure")},onBookAppointmentFailure:function(a,b){if(b&&b.responseText){var c=JSON.parse(b.responseText);c&&c.ErrorInfo&&"CustomerHasPendingRequest"===c.ErrorInfo.errorCode?this.set("bookCallBackVmStatus","existingAppointment"):this.set("bookCallBackVmStatus","failure")}else this.set("bookCallBackVmStatus","failure")}});return n});
define("businesswidget/repository_l9_common/common/viewmodel/bookStoreAppointmentViewModel",["lightsaber","underscore","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/OnePassInfoModel","single!businesswidget/repository_l9_common/common/model/findCallerByContactModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","single!businesswidget/repository_l9_common/common/viewmodel/business/SingtelStoreEAppointmentViewModel"],function (a,b,c,d,e,f,g,h,i){var j=a.Core.ObservableViewModel.extend({subViewModels:{individualInContextTopicViewModel:d,onePassTopicViewModel:g,onePassDetailsViewModel:h,singtelStoreEAppointmentViewModel:i},models:{viewUpdateCustomerProfileModel:c,onePassInfoModel:e,findCallerModel:f},dataBindings:[{contactId:"subViewModels.individualInContextTopicViewModel.personId",options:{twoWay:!1,setOnBind:!0}}],defaults:{displayPhoneCatalog:!1,selectedMobileGroupId:"",selectedMobileId:"",contactDetails:null,bookStoreVmStatus:"",userInfo:null,existingApptDetails:null},initialize:function(a){var c=this;c._super(),b.bind(c,"retrieveContactInfo","getCustomerInfo","getCustomerIdType","retrieveStoreAppointments"),this.set("bookStoreVmStatus","vmInitialized");var d=this.subViewModels.onePassTopicViewModel.get("nric");this.on("change:nric",this.getCustomerInfo(d),this)},getCustomerInfo:function(a){var c=this;"undefined"==typeof a||null===a?this.subViewModels.onePassDetailsViewModel.setOnePassFields().then(b.bind(this.onOnePassInfoSuccess,this),function(){c.set("bookStoreVmStatus","failure")}.bind(this)):this.retrieveContactInfo()},onOnePassInfoSuccess:function(a){var c=this,d=a.ImplLoginHeaderResOutput.headersMap,e=c.getCustomerIdType(d.HTTP_CUST_ID_TYPE),f=d.HTTP_CUST_ID;if(f){var g={implContactDetails:{indentValue:f,indentType:e}};c.getModel("findCallerModel").save({ImplFindCallerByContactInput:g},{success:b.bind(this.onFindCallerSuccess,this),error:function(){c.set("bookStoreVmStatus","failure")}})}},onFindCallerSuccess:function(a,b){var c=this,d=b.ImplFindCallerByContactOutput;c.set("userInfo",b.ImplFindCallerByContactOutput),c.retrieveContactInfo(d.contactDetails.contactId)},getCustomerIdType:function(a){var b="";switch(a){case"2":b="National Registration ID Card (NRIC)";break;case"6":b="Foreign Identification Number (FIN)";break;case"532":b="Foreigner Dependent Pass";break;case"534":b="Foreigner Employment Pass";break;case"535":b="Foreigner S Pass";break;case"533":b="Foreigner Student Pass";break;case"536":b="Passport Number";break;case"531":b="Foreigner Social Visit Pass";break;case"530":b="Foreigner Work Permit";break;case"600":b="Diplomat";break;case"539":b="Entre Pass"}return b},retrieveContactInfo:function(a){var c=this,d=c.subViewModels.individualInContextTopicViewModel.get("personId")||a;if(void 0!==d&null!==d){var e=c.getModel("viewUpdateCustomerProfileModel");e.set("id",d),e.fetch({success:b.bind(c.onFetchSuccess,c),error:function(){c.set("bookStoreVmStatus","failure")}})}},onFetchSuccess:function(a,b){var c=b.ImplContactPersonOutput.implContactPerson,d={blacklistReason:c.blacklistReason,ipa:c.ipa,emailId:c.emailId};this.set("contactDetails",d),this.set("bookStoreVmStatus","success")},isAllDataAvailable:function(){return!0},retrieveStoreAppointments:function(){var a=this,c=a.get("exisitingAppointmentInput");a.subViewModels.singtelStoreEAppointmentViewModel.set("exisitingAppointmentInput",c),a.set("bookStoreVmStatus","retrieveStoreAppointments");var d=a.subViewModels.singtelStoreEAppointmentViewModel.retrieveExistingAppointment();return d.done(function(){var d=a.subViewModels.singtelStoreEAppointmentViewModel.get("existingAptDetails");if(c.apptId){var e=b.find(d,function(a){return a.apptId===c.apptId});e&&e.isChangeAllowed?(a.set("existingApptDetails",e),a.set("bookStoreVmStatus","existingApptPresent")):a.set("bookStoreVmStatus","noExistingAppt")}else d&&d.length>0?a.set("bookStoreVmStatus","existingApptPresentForLoggedin"):a.set("bookStoreVmStatus","noExistingApptForLoggedin")}.bind(a)),d}});return j});
define("businesswidget/repository_l9_common/common/model/UploadDocumentModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/customer/:customerId/upload-document",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale"),contentType:"multipart/form-data"}},create:{method:"PUT",payload:["ImplUploadDocumentStoreData"]}}}});return d});
define("businesswidget/repository_l9_common/common/model/SubmitCaseNotificationModel",["businesswidget/repository/common/core/RESTModel","underscore","lightsaber"],function (a,b,c){var d=a.extend({options:{url:"/customer/:customerId/submit-case-notification",rest:{defaults:{qParams:{sc:c.Core.Configuration.get("salesChannel"),lo:c.Core.Configuration.get("locale")}},create:{method:"PUT",payload:["ImplSubmitCaseNotificationRequest"]}}}});return d});
define("businesswidget/repository_l9_common/common/viewmodel/business/SendFeedbackViewModel",["lightsaber","underscore","businesswidget/repository_l9_common/common/model/UploadDocumentModel","businesswidget/repository_l9_common/common/model/SubmitCaseNotificationModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/CustomerInContextTopicViewModel","single!businesswidget/repository_l9_common/common/model/ViewUpdateCustomerProfileModel","single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","Configuration"],function (a,b,c,d,e,f,g,h){return a.Core.ObservableViewModel.extend({models:{UploadDocumentModel:c,SubmitCaseNotificationModel:d,viewUpdateCustomerProfileModel:f},subViewModels:{CustomerInContextTopicViewModel:e,individualInContextTopicViewModel:g},defaults:{documentId:null,sendFeedbackVmStatus:"",terminateEasyMobile:!1,submitCaseDetails:null,userInfo:null,fileList:[],file:{},maxFileSize:h.get("maxSizeForUploadFile"),maxCommentsLength:h.get("maxCommentsLength"),fileTypes:h.get("fileTypesToUpload"),isFileTypeValid:!0,isMaxFileSizeValid:!0,isFileAlreadyUpload:!1},initialize:function(a){b.bindAll(this,"uploadDocument","uploadDocumentSuccess","getErrorMessage","submitCase","onSubmitCaseSuccess","loadCustomerDetails","validateFileUpload","isFileMatch");var c=this.subViewModels.individualInContextTopicViewModel.get("personId");this.on("change:contactId",this.loadCustomerDetails(c),this)},loadCustomerDetails:function(a){var c=this;if(void 0!==a&&null!==a&&""!==a){var d=c.getModel("viewUpdateCustomerProfileModel");d.set("id",a),d.fetch({success:b.bind(c.onFetchProfileSuccess,c),error:function(){c.set("sendFeedbackVmStatus","profileFailed")}})}},onFetchProfileSuccess:function(a,b){var c=b.ImplContactPersonOutput.implContactPerson,d={registeredName:c.name,contactNumber:c.phone,email:c.emailId,salutation:c.salutation};this.set("userInfo",d),this.set("sendFeedbackVmStatus","userDetailsLoaded")},uploadDocument:function(a){var b,c=this.get("file"),d=this;if(window.OSG_UXF&&window.OSG_UXF.BlobStorage?(b=OSG_UXF.BlobStorage[c],delete OSG_UXF.BlobStorage[c]):this.submitCase(),"undefined"!=typeof b){var e=(new FileReader,new FormData);e.append("UploadedFile1",b);var f=d.getModel("UploadDocumentModel");f.save({ImplUploadDocumentStoreData:e},{customerId:d.subViewModels.CustomerInContextTopicViewModel.get("ID"),success:d.uploadDocumentSuccess,error:d.getErrorMessage})}},validateFileUpload:function(){var a=this.get("file");return!!this.isFileMatch(a)&&(a.size>this.get("maxFileSize")?(this.set("isMaxFileSizeValid",!1),this.set("sendFeedbackVmStatus","maxsizeexcedded"),!1):void 0)},isFileMatch:function(a){for(var b=this.get("fileTypes"),c=0;c<b.length;c++)if(a.type.match(b[c]))return!0;return this.set("isFileTypeValid",!1),!1},uploadDocumentSuccess:function(a,b){var c=b.ImplUploadDocumentResponse;"undefined"!=typeof c&&(c.uploadedDocuments&&c.uploadedDocuments.length>0?(this.set("documentId",c.uploadedDocuments[0].documentId),this.set("sendFeedbackVmStatus","success"),this.submitCase()):this.set("sendFeedbackVmStatus","uploadFailed"))},submitCase:function(){var a=this,b=a.getModel("SubmitCaseNotificationModel"),c=a.get("submitCaseDetails");a.set("sendFeedbackVmStatus","submitCaseInitialized");var d={};if(a.get("terminateEasyMobile"))d={ImplSubmitCaseNotificationRequest:{email:c.emailId,registeredName:c.registeredName,contactNumber:c.contactNumber,caseType:"TERMINATE",alternateContactNumber:c.alternateNumber,reasonForTermination:c.reason,userComments:c.userComments}};else{d={ImplSubmitCaseNotificationRequest:{caseType:"FEEDBACK",email:c.emailId,registeredName:c.registeredName,contactNumber:c.contactNumber,natureOfFeedback:c.feedbackNature,areaOfFeedback:c.feedbackArea,userComments:c.userComments}};var e=a.get("documentId");null!=e&&(d.ImplSubmitCaseNotificationRequest.documentId=e)}b.save(d,{customerId:a.subViewModels.CustomerInContextTopicViewModel.get("ID"),success:a.onSubmitCaseSuccess,error:function(){a.set("sendFeedbackVmStatus","caseFailure")}})},onSubmitCaseSuccess:function(a,b){b.ImplSubmitCaseNotificationResponse.notificationStatus&&this.set("sendFeedbackVmStatus","feedbackSubmitted")},getErrorMessage:function(){return this.set("sendFeedbackVmStatus","failure"),!0}})});
define("l9_common.supportWidgets",{"createCase":"businesswidget/repository_l9_common/common/viewmodel/CreateCaseViewModel","implLoginViewModel":"businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","bookCallBackAppointmentViewModel":"businesswidget/repository_l9_common/common/viewmodel/bookCallBackAppointmentViewModel","bookStoreAppointmentViewModel":"businesswidget/repository_l9_common/common/viewmodel/bookStoreAppointmentViewModel","SendFeedbackViewModel":"businesswidget/repository_l9_common/common/viewmodel/business/SendFeedbackViewModel"});
define("l9_common.supportTopics",{"ImplIndividualInContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/IndividualInContextTopicViewModel","vmKeys":{"data.personId":"personId","data.contactFirstName":"contactFirstName","data.contactLastName":"contactLastName","data.contactFormattedName":"contactFormattedName"},"mode":"pubsub"},"ImplUserContext":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/ImplUserContextTopicViewModel","vmKeys":{"data.userInfo":"userInfo","data.permissions":"permissions"},"mode":"pubsub"},"AccountInContextTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/AccountInContextTopicViewModel","vmKeys":{"data.barId":"barId","data.faId":"faId","data.accountName":"accountName"},"mode":"pubsub"},"CreateCaseTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/CreateCaseViewModel","vmKeys":{"data.severity":"severity","data.priority":"priority","data.problemTypeLevel":"problemTypeLevel","data.additionalCustomerProblemDetails":"additionalCustomerProblemDetails","data.reporterIndividualId":"reporterIndividualId","data.reporterCustomerId":"reporterCustomerId","data.name":"name","data.caseDescription":"caseDescription","data.associatedItem":"associatedItem","data.status":"status","data.saveOption":"saveOption","data.queueID":"queueID","data.saveInWorkFolder":"saveInWorkFolder","data.caseSeverity":"caseSeverity","data.casePriority":"casePriority","data.caseType1":"caseType1","data.caseType2":"caseType2","data.caseType3":"caseType3","data.caseTitle":"caseTitle","data.barId":"barId","data.createCaseVmStatus":"createCaseVmStatus","data.customerProblemId":"customerProblemId","action.submitCase":"submitCase","action.setAccountConsolidationData":"setAccountConsolidationData","action.setPaperBillData":"setPaperBillData","action.updateAddressCase":"updateAddressCase","action.relocateServiceCase":"relocateServiceCase","action.setOrderCreationData":"setOrderCreationData"},"mode":"pubsub"},"ImplLoginViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"data.implLoginVmStatus":"implLoginVmStatus","data.userInfo":"userInfo"},"mode":"sub"},"ImplLoginActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplLoginViewModel","vmKeys":{"action.login":"login"},"mode":"pub"},"OnePassDetailsViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/OnePassTopicViewModel","vmKeys":{"data.onePassVmStatus":"onePassVmStatus","data.nric":"nric","data.nickName":"nickName","data.userId":"userId","data.customerIdType":"customerIdType","data.status":"status","data.email":"email","data.GTMUserData":"GTMUserData","data.isWorryFreeLogin":"isWorryFreeLogin","data.isWorryFreeFaVerfied":"isWorryFreeFaVerfied","data.billPayer":"billPayer","data.familyName":"familyName","data.headers":"headers","data.newcustomer":"newcustomer"},"mode":"pubsub"},"OnePassDetailsActionTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/OnePassDetailsViewModel","vmKeys":{"action.setOnePassFields":"setOnePassFields","action.sendOnePassDetails":"sendOnePassDetails"},"mode":"pubsub"},"bookCallBackAppointmentViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/bookCallBackAppointmentViewModel","vmKeys":{"data.appointmentInfo":"appointmentInfo","data.appointmentInput":"appointmentInput","data.appointmentBookSuccess":"appointmentBookSuccess","data.availableTimeSlotsParams":"availableTimeSlotsParams","data.availableTimeSlots":"availableTimeSlots","data.bookCallBackVmStatus":"bookCallBackVmStatus","data.userInfo":"userInfo","action.getExistingAppointment":"getExistingAppointment","action.cancelAppointment":"cancelAppointment","action.submitCallBackAppointmentRequest":"submitCallBackAppointmentRequest","action.retrieveTimeSlots":"retrieveTimeSlots"},"mode":"pubsub"},"bookStoreAppointmentViewTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/bookStoreAppointmentViewModel","vmKeys":{"data.displayPhoneCatalog":"displayPhoneCatalog","data.selectedMobileGroupId":"selectedMobileGroupId","data.selectedMobileId":"selectedMobileId","data.contactDetails":"contactDetails","data.bookStoreVmStatus":"bookStoreVmStatus","data.userInfo":"userInfo","data.existingApptDetails":"existingApptDetails","data.exisitingAppointmentInput":"exisitingAppointmentInput","action.retrieveStoreAppointments":"retrieveStoreAppointments"},"mode":"pubsub"},"SendFeedbackTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/business/SendFeedbackViewModel","vmKeys":{"data.sendFeedbackVmStatus":"sendFeedbackVmStatus","data.terminateEasyMobile":"terminateEasyMobile","data.submitCaseDetails":"submitCaseDetails","data.file":"file","data.userInfo":"userInfo","action.uploadDocument":"uploadDocument","action.submitCase":"submitCase"},"mode":"pubsub"},"GlobalErrorTopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/ImplGlobalErrorViewModel","vmKeys":{"data.timestamp":"timestamp","data.modelName":"modelName","data.requestType":"requestType","data.errorObj":"errorObj"},"mode":"sub"},"GATopic":{"vmId":"single!businesswidget/repository_l9_common/common/viewmodel/contextTopics/GATopicViewModel","vmKeys":{"data.gtmData":"gtmData","data.gtmViewStatus":"gtmViewStatus","action.publishData":"publishData"},"mode":"pubsub"}});
define("l9_common.supportTopicsBinding",{"binding":[]});
define("l9_common.supportExpPackage",["l3_common.supportExpPackage","l9_common.supportWidgets","l9_common.supportTopics","l9_common.supportTopicsBinding","text!businesswidget/repository_l9_common/common/config/l9_common.supportPackage.config.json","businesswidget/repository_l9_common/common/core/ImplRepositoryGlobalErrorHandler"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l9_common/common/i18n/support/web/nls/l9_common.supportStrings")});
define("l3_common.support.custom",["replace","l9_common.support.custom"],function() {});
define("l3_common.supportWidgets",{});
define("l3_common.supportTopics",{});
define("l3_common.supportTopicsBinding",{"binding":[]});
define("l3_common.supportExpPackage",["l0.supportExpPackage","l3_common.supportWidgets","l3_common.supportTopics","l3_common.supportTopicsBinding","text!businesswidget/repository_l3_common/common/config/l3_common.supportPackage.config.json"],function (a,b,c,d,e){"use strict";return a.extend(b,c,d,e,"businesswidget/repository_l3_common/common/i18n/support/web/nls/l3_common.supportStrings")});
define("text!businesswidget/repository/common/config/supportPackage.config.json",function (){return'({\n\t"experiencePackage":"support",\n\n\t"FilterListMaxValue" : 13,\n\t"FilterSelectableDateRange" : 120,\n\t"NumSelectableItemsLow" : 3,\n\t"NumSelectableItemsMed" : 5,\n\t"NumSelectableItemsHigh" : 10,\n\t"FilterListAutoCompleteValue" :100,\n\n\n// Log Notes Widget\n\t"NotesSizeMax" : 512,\n\t"InternalNotesSizeMax" : 255,\t\n\t"LogNoteOpenCondition" : "OPEN",\n//closeCustomerProblem Widget\n     "closeTicketNotesSizeMax" : 255,\n\t// configuration paramaters for Customer Problems widgets\n\t"DisplayRangeDaysControls" : "YES",\n\t"DisplayAgeRangeDays" : 30,\n\t"rangedayslist" : [15,30,45,60],\n\t"numberOfResultsPerPageDropdownList" : [20,50,100],\n\t"customerProblemSortByFields" : [{"id":"CREATION_DATE","title":"Created"}, \n\t\t\t\t\t\t\t\t\t {"id":"LAST_MODIFIED_DATE","title":"Modified"},\n\t\t\t\t\t\t\t\t\t {"id":"CONDITION","title":"Condition"},\n\t\t\t\t\t\t\t\t\t {"id":"PROBLEM_TYPE_LEVEL_1","title":"Type"}],\n\t"customerProblemResidentialSortByFields" : [{"id":"LAST_MODIFIED_DATE","title":"Date Updated"},\n\t\t\t\t\t\t\t\t\t\t\t\t{"id":"CREATION_DATE","title":"Date Created"}, \n\t\t\t\t\t\t\t\t\t \t\t \t{"id":"CONDITION","title":"Status"}],\n\t"ListConditionToDisplay": "OPEN",\n\t"PageSizeCustomerProblem": 20,\n\t"CustomerLevelDetailsRoles": "true", // Show All checkbox is unchecked if false. Will only display customer problems created by reporterId\n\n\t"customerProblemOpenCondition" : "OPEN",\n\t"customerProblemClosedCondition" : "CLOSED",\t\n\t"creationDateToShow": "CREATION_DATE",\n\t"lastModifiedDateToShow": "LAST_MODIFIED_DATE",\n\n    "customerProblems_viewAllLink_action" : {\n    \t\t"actionType" : "OpenWidget",\n    \t\t"actionTarget" : "searchCustomerProblems"\n    },\n\n   "customerProblems_customerProblemTitle_action" : {\n    \t\t"actionType" : "OpenWidget",\n    \t\t"actionTarget" : "CustomerProblemDetailsViewUpdate",\n    \t\t"actionParams" : {}\n    },\n\n    "customerProblems_newTicket_action" : {\n    \t\t"actionType" : "OpenWidget",\n    \t\t"actionTarget" : "CreateCustomerProblemWidget",\n    \t\t"actionParams" : {}\n    },\n\n    "customerProblems_customerProblemViewAll_action" : {\n    \t\t"actionType" : "OpenWidget",\n    \t\t"actionTarget" : "customerProblemSearch",\n    \t\t"actionParams" : {}\n    },\n    "CustomerProblemNoTitleString" : "[No Title]",\n    "CommonLabelSeparator": "–",\n    // CreateCustomerProblemWidget\n    "CustomerProblemWidgetTitle": "Create Ticket",\n    "CustomerProblemSeverityPriority": "SEVERITY", \t\t\t\t\t\t//possible values : SEVERITY / PRIORITY / NONE (will hide drop down)\t\t\n\t"CustomerProblemTitleSizeMax":80,\n\t"CustomerProblemDescSizeMax":2000,\n\t"CustomerProblemTitleDisplay":"SHOW", \t\t\t\t\t\t\t\t//possible values : HIDE / SHOW\n\t"CustomerProblemClietType": "Residential", \t\t\t\t\t\t\t//possible values : SMB / CC / Residential \n\t"CustomerProblemEnableSubscriptionSelectionForPreselected": false,\n\t"CustomerProblemGenericCaseCategoriesDisplayView": "dropdown",\t\t//possible values : list / dropdown / none \n\t"CustomerProblemSubscriptionCaseCategoriesDisplayView": "dropdown",\t//possible values : list / dropdown / none \n\t\t\t\n\t"CustomerProblemDescriptionSize":330,\n\t"CustomerProblemDescriptionSingleLineSize":63,\n\n\t//CreateCustomerProblemWidget Dispatch ( objid of CRM table_queue)\n\t"DefaultQueueIDForDispatch" : "",\n\n\t\t//CustomerProblemDetailsWidget\n\t"customerProblemSeverityPriority" : "SEVERITY",\n\t"includeNoteHistoryWidget" : true,\n\t"EnableReopenNotes" : true,\n\t"numberOfCharacters" : 60,\n\t"customerProblemAddressSeperator" : ",",\n\n\t//SubscriptionSearchWidget\n\t"phone_number_pattern" : "^\\\\d{10}$",\n\n\t//notes log widget\n\t"CustomerProblemTitleDisplayLength":80,\n\t//Similar CustomerProblems Widget\n\t"AutoSearch" : true,\n\t"UpdateSearchKeywords": true,\n\t"CustomerProblemsKeyWordsLength" : 256,\n\t"ActivitiesPerPage" : 20,\n\n\t//Attachment Configurations\n\t"AttachmentTitleMaxLength" : 40,\n\t"AttachmentDescriptionMaxLength" : 255,\n\t"entityTypeMapping" : {\n\t\t"CustomerProblem" :  "cm_attachment_ticket_string"\n\t},\n\t"statusMap" : {\n\t\t"AVAILABLE" : "0",\n\t\t"UPLOADED" : "1",\n\t\t"QUARANTINED" : "7",\n\t\t"DELETED" : "9"\n\t}\n})\n\n'});
define("supportWidgets",{"logNote":"businesswidget/repository/widgetsLibrary/lognotewidget/web/LogNoteWidget","closeCustomerProblem":"businesswidget/repository/widgetsLibrary/closeCustomerProblemWidget/web/CloseCustomerProblemWidget","createCustomerProblem":"businesswidget/repository/widgetsLibrary/createCustomerProblemWidget/web/CreateCustomerProblemWidget","customerProblems":"businesswidget/repository/widgetsLibrary/customerProblemsWidget/web/CustomerProblemsWidget","customerProblemDetails":"businesswidget/repository/widgetsLibrary/customerProblemDetailsWidget/web/CustomerProblemDetailsWidget","customerProblemSearch":"businesswidget/repository/widgetsLibrary/customerProblemSearchWidget/web/CustomerProblemSearchWidget","notesHistory":"businesswidget/repository/widgetsLibrary/notesHistoryWidget/web/NotesHistoryWidget","subscriptionsSearchWidget":"businesswidget/repository/widgetsLibrary/subscriptionsSearchWidget/web/subscriptionsSearchWidget","reopenCustomerProblem":"businesswidget/repository/widgetsLibrary/reopenCustomerProblemWidget/web/ReopenWidget","logPhoneCall":"businesswidget/repository/widgetsLibrary/logPhoneCallWidget/web/LogPhoneCallWidget","similarCustomerProblems":"businesswidget/repository/widgetsLibrary/similarCustomerProblemsWidget/web/SimilarCustomerProblemsWidget","selectQueue":"businesswidget/repository/widgetsLibrary/selectQueueWidget/web/SelectQueueWidget","attachmentCreateEdit":"businesswidget/repository/widgetsLibrary/createEditAttachment/web/CreateEditAttachment","attachmentListWidget":"businesswidget/repository/widgetsLibrary/attachmentListWidget/web/AttachmentListWidget"});
define("supportTopics",{"LogNoteEntityStatusDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/LogNoteViewModel","vmKeys":{"data.entityType":"entityType","data.entityID":"entityID","data.currentStatus":"currentStatus","data.newStatus":"newStatus","action.saveNote":"saveNote"},"mode":"sub"},"CloseCustomerProblemEntityDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/CloseCustomerProblemViewModel","vmKeys":{"data.ticketTitle":"ticketTitle","data.ticketId":"ticketId","data.currentStatus":"currentStatus","data.currentCondition":"currentCondition"},"mode":"pubsub"},"LogNoteEntityDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/LogNoteViewModel","vmKeys":{"data.entityType":"entityType","data.entityID":"entityID","data.currentStatus":"currentStatus","data.currentCondition":"currentCondition"},"mode":"pubsub"},"LogNoteSave":{"vmId":"single!businesswidget/repository/common/viewmodel/LogNoteViewModel","vmKeys":{"data.entityType":"entityType","data.entityID":"entityID","data.currentStatus":"currentStatus","data.newStatus":"newStatus","data.notes":"notes","data.internalNotes":"internalNotes","action.submit":"submit"},"mode":"pubsub"},"amdocs.party.IndividualInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.IndividualInContext":"IndividualInContext"},"mode":"pubsub"},"amdocs.customer.CustomerInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.CustomerInContext":"CustomerInContext"},"mode":"pubsub"},"amdocs.party.OrganizationInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.CurrentOrganizationInContext":"CurrentOrganizationInContext","data.DefaultOrganizationInContext":"DefaultOrganizationInContext"},"mode":"pubsub"},"amdocs.customeraccountactivity.BillingSummaryInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.CustomerBillSpecInContext":"CustomerBillSpecInContext","data.CustomerAccountInContext":"CustomerAccountInContext"},"mode":"pubsub"},"amdocs.product.SubscriptionInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.SubscriptionInContext":"SubscriptionInContext"},"mode":"pubsub"},"amdocs.support.CustomerProblem":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerProblemDetailsTopicViewModel","vmKeys":{"data.ID":"ID"},"mode":"pubsub"},"amdocs.customeraccountactivity.BillingDetailsInContext":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","vmKeys":{"data.BillingDetailsInContext":"BillingDetailsInContext","data.CustomerBillSpecDetailsInContext":"BillingDetailsInContext"},"mode":"pubsub"},"amdocs.support.CloseCustomerProblem":{"vmId":"single!businesswidget/repository/common/viewmodel/CloseCustomerProblemViewModel","vmKeys":{"action.CaseClosed":"CaseClosed","action.SubmitClose":"SubmitClose","action.CloseActionCancelled":"CloseActionCancelled","action.CloseActionFailed":"CloseActionFailed"},"mode":"pubsub"},"amdocs.support.CustomerProblemEntityDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/CreateCustomerProblemViewModel","vmKeys":{"action.SaveCustomerProblem":"SaveCustomerProblem","action.CreatedCustomerProblem":"CreatedCustomerProblem","action.CreateNoDispatchCustomerProblem":"CreateNoDispatchCustomerProblem","action.OneDoneCustomerProblem":"OneDoneCustomerProblem","data.ID":"customerProblemId"},"mode":"pubsub"},"amdocs.support.ReopenCustomerProblem":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerProblemDetailsTopicViewModel","vmKeys":{"action.CaseReopened":"CaseReopened","data.ID":"ID"},"mode":"pubsub"},"amdocs.support.CustomerProblemDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/CustomerProblemsViewModel","vmKeys":{"data.ID":"ticketId","data.widgetName":"widgetName"},"mode":"pubsub"},"amdocs.customer.SelectedSubscriptions":{"vmId":"single!businesswidget/repository/common/viewmodel/SubscriptionsListViewModel","vmKeys":{"data.entityID":"entityID","data.entityType":"entityType","data.widgetID":"widgetID","data.widgetName":"widgetName","data.contextID":"contextID","data.customerID":"customerID","data.subscriptionDetails":"subscriptionDetails"},"mode":"pubsub"},"amdocs.CancelLink":{"vmId":"single!businesswidget/repository/common/viewmodel/CancelLinkViewModel","vmKeys":{"action.LinkClicked":"LinkClicked","data.widgetID":"widgetID","data.widgetName":"widgetName","data.identifier":"identifier"},"mode":"pubsub"},"amdocs.RequestAction":{"vmId":"single!businesswidget/repository/common/viewmodel/ExternalActionViewModel","vmKeys":{"data.actionType":"actionType","data.actionTarget":"actionTarget","data.actionParams":"actionParams","action.requestAction":"requestAction"},"mode":"pubsub"},"amdocs.support.LogPhoneCallEntityDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/LogPhoneCallViewModel","vmKeys":{"action.SuccessPhoneLog":"SuccessPhoneLog","action.SavePhoneLog":"savePhoneLog","data.widgetID":"widgetID","data.widgetName":"widgetName","data.identifier":"identifier"},"mode":"pubsub"},"amdocs.support.SelectQueueEntityDetails":{"vmId":"single!businesswidget/repository/common/viewmodel/SelectQueueTopicsViewModel","vmKeys":{"data.entityType":"entityType","data.entityID":"entityID","data.queueID":"queueID","data.queueName":"queueName","data.widgetName":"widgetName","data.widgetID":"widgetID","data.contextId":"contextId","action.SelectQueueForEntity":"SelectQueueForEntity","action.QueueSelectedForEntity":"QueueSelectedForEntity"},"mode":"pubsub"},"amdocs.support.CreateCustomerProblem":{"vmId":"single!businesswidget/repository/common/viewmodel/CreateCustomerProblemTopicViewModel","vmKeys":{"action.generalTicketSelected":"generalTicketSelected","data.isGeneralTicketSelected":"isGeneralTicketSelected"},"mode":"sub"},"amdocs.enterprise.Attachment":{"vmId":"single!businesswidget/repository/common/viewmodel/AttachmentTopicViewModel","vmKeys":{"data.widgetID":"widgetID","data.attachmentID":"attachmentID","data.attachmentTitle":"attachmentTitle","data.attachmentDescription":"attachmentDescription","data.attachmentFileName":"attachmentFileName","data.internalFlag":"internalFlag","data.originator":"originator","data.creationDate":"creationDate","data.status":"status","data.statusTitle":"statusTitle","data.mimeType":"mimeType","data.internalUseOnly":"internalUseOnly","data.estimatedSize":"estimatedSize","action.Uploaded":"Uploaded","action.Add":"Add","action.Updated":"Updated","action.Edit":"Edit","action.EditRequest":"EditRequest"},"mode":"pubsub"},"amdocs.common.Exception":{"vmId":"single!businesswidget/repository/common/viewmodel/ExceptionTopicViewModel","vmKeys":{"data.widgetID":"widgetID","data.errorCode":"errorCode","data.errorMessage":"errorMessage","action.ExceptionPosted":"ExceptionPosted"}},"amdocs.enterprise.AttachmentList":{"vmId":"single!businesswidget/repository/common/viewmodel/AttachmentListTopicViewModel","vmKeys":{"data.attachmentId":"attachmentId","data.entityId":"entityId","data.entityType":"entityType","action.Uploaded":"Uploaded","action.Add":"Add","action.Delete":"Delete","action.Edit":"Edit","action.Open":"Open"},"mode":"pubsub"},"amdocs.enterprise.AttachmentParentEntity":{"vmId":"single!businesswidget/repository/common/viewmodel/AttachmentParentEntityViewModel","vmKeys":{"data.entityId":"entityId","data.entityType":"entityType"},"mode":"pubsub"}});
define("supportTopicsBinding",{"binding":[]});
define("l0.supportExpPackage",["experiencePackage","supportWidgets","supportTopics","supportTopicsBinding","text!businesswidget/repository/common/config/supportPackage.config.json","repository.lightsaber.custom"],function (a,b,c,d,e){"use strict";return new a(b,c,d,e,"businesswidget/repository/common/i18n/support/web/nls/supportStrings")});
define("supportExpPackage",["l9_common.supportExpPackage","l3_common.support.custom"],function (a){"use strict";return a});
define("businesswidget/repository/common/model/StatusTransitionsModel",["underscore","businesswidget/repository/common/core/RESTModel"],function (a,b){var c=b.extend({options:{url:"support/reference-data/:workItemType/status-transitions",rest:{read:{contentType:"application/json",payload:[]}}},fetch:function(a){var b={},c=this.get("currentStatus"),d=this.get("currentCondition"),e=this.get("workItemId"),f=this.get("conditionReadMask");b.currentStatus=c,e&&(b.workItemId=e),d&&(b.currentCondition=d),f&&(b.conditionReadMask=f),this.setQueryParams(b),this._super(a)}}),d=c.extend({}),e={path:"businesswidget/repository/common/model/StatusTransitionsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"StatusTransitionsModel",savePath:"businesswidget/repository/common/model","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"support/reference-data/:workItemType/status-transitions"},autoSnapshot:{value:"None"}},restDataSourceProperties:{read:{contentType:{value:"application/json"},payload:{value:[]}}}},validations:[],methods:{fetch:{name:"fetch",privacyLevel:"protected",isEventTriggered:!1,desc:"Overrides the default fetch, passing currentStatus, currentCondition, and workItemId, conditionReadMask as query parameter",isChangeEventTriggered:!1}},description:""};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/ConfirmationViewModel",["lightsaber"],function (a){var b=a.Core.ViewModel.extend({config:{actions:{yesHandler:this.yesHandler,noHandler:this.noHandler}},defaults:{confirmationMessage:null,yesBtnLabel:null,noBtnLabel:null,yesHandler:null,noHandler:null},yesHandler:function(a){this.get("yesHandler")&&this.get("yesHandler").apply()},noHandler:function(){this.get("noHandler")&&this.get("noHandler").apply()}}),c=b.extend({}),d={path:"businesswidget/repository/common/viewmodel/ConfirmationViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"ConfirmationViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"Holds handlers for yes and no buttons \n","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{confirmationMessage:{key:"confirmationMessage",value:"null"},yesBtnLabel:{key:"yesBtnLabel",value:"null"},noBtnLabel:{key:"noBtnLabel",value:"null"},yesHandler:{key:"yesHandler",value:"null"},noHandler:{key:"noHandler",value:"null"}},methods:{yesHandler:{name:"yesHandler",privacyLevel:"public",isEventTriggered:!0,desc:"reads yesHandler from configuration and if defined trigger the action",isChangeEventTriggered:!1},noHandler:{name:"noHandler",privacyLevel:"public",isEventTriggered:!0,desc:"reads noHandler from configuration and if defined trigger the action",isChangeEventTriggered:!1}}};return c.prototype.getMetaData=function(){return d},c});
define("businesswidget/repository/common/viewmodel/SelectQueueTopicsViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ViewModel.extend({defaults:{entityType:null,entityID:null,queueID:null,queueName:null,widgetName:null,widgetID:null,contextId:null,test:123}}).extend({})});
define("businesswidget/repository/common/model/CreateCustomerProblemModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"support/customer-problem",rest:{create:{payload:["CreateCustomerProblemRequest"],qParams:{lo:b.Core.Configuration.get("locale"),sc:b.Core.Configuration.get("salesChannel")}}}},validations:[{check:"notEmpty",fieldName:"CreateCustomerProblemRequest.description",warn:{set:!1}}],save:function(a,b,c){var d={severity:this.get("severity"),priority:this.get("priority"),problemTypeLevel:this.get("problemTypeLevel"),additionalCustomerProblemDetails:this.get("additionalCustomerProblemDetails"),reporterIndividualId:a.reporterIndividualId,reporterCustomerId:a.reporterCustomerId,name:a.name,description:a.description,associatedItem:this.get("associatedItem"),status:a.status,saveOption:a.saveOption,queueID:a.queueID,saveInWorkFolder:a.saveInWorkFolder};a=void 0,this.set("CreateCustomerProblemRequest",d),this._super(d,b,c)},initialize:function(a){this.setDefaults(),this._super(a)},setDefaults:function(){var a={ID:"",type:null},c=new Array(4),d=new Array(2),e=new Array(2),f={parentProblemId:"",reporterSiteId:"",reporterAddressId:"",reporterOrganizationId:""};this.set("severity",d),this.set("priority",e),this.set("problemTypeLevel",c),this.set("additionalCustomerProblemDetails",f),this.set("associatedItem",a),this.set("reporterIndividualId",""),this.set("reporterCustomerId",""),this.set("saveOption","SAVE"),this.set("queueID",b.Core.Configuration.get("DefaultQueueIDForDispatch")),this.set("CreateCustomerProblemResponse",{customerProblemId:"",numOfQueues:"",dispatched:null})}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/CreateCustomerProblemModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CreateCustomerProblemModel",savePath:"businesswidget/repository/common/model",description:"","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"support/customer-problem"},autoSnapshot:{value:"None"}},restDataSourceProperties:{create:{payload:{value:["CreateCustomerProblemRequest"]},qParams:{value:[{key:"lo",value:"Lightsaber.Core.Configuration.get('locale')"},{key:"sc",value:"Lightsaber.Core.Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[{id:1,check:'"notEmpty"',fieldName:'"CreateCustomerProblemRequest.description"',warn:'{"set":false}'}],methods:{save:{name:"save",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setDefaults:{name:"setDefaults",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/IndividualDetailsModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"customer/:customerId/individual/:indvId/name",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{lo:b.Core.Configuration.get("locale"),sc:b.Core.Configuration.get("salesChannel")}}}},parse:function(a,b){var c="";a.IndividualName.givenName&&(c=a.IndividualName.givenName),a.IndividualName.familyName&&(c=c+"   "+a.IndividualName.familyName),this.set("individualName",c)}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/IndividualDetailsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"IndividualDetailsModel",savePath:"businesswidget/repository/common/model",description:"Returns the Individual Details for the Individual ID & CustomerID passed","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/:customerId/individual/:indvId/name"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{method:{value:"GET"}},read:{contentType:{value:"application/json"},payload:{value:["[]"]},qParams:{value:[{key:"lo",value:"\"Lightsaber.Core.Configuration.get('locale')\""},{key:"sc",value:"\"Lightsaber.Core.Configuration.get('salesChannel')\""}],isJSON:!0}}}},validations:[],methods:{parse:{name:"parse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/OrganizationDetailsModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"organization/:organizationId/name",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{lo:b.Core.Configuration.get("locale"),sc:b.Core.Configuration.get("salesChannel")}}}},parse:function(a,b){this.set("organizationName",a.OrganizationName.name)}}),e=d.extend({}),f={path:"businesswidget/repository/common/model//OrganizationDetailsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"OrganizationDetailsModel",savePath:"businesswidget/repository/common/model/",description:"Returns the organization name for the id passed","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"organization/:organizationId/name"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{method:{value:"GET"}},read:{contentType:{value:"application/json"},payload:{value:["[]"]},qParams:{value:[{key:"lo",value:"Lightsaber.Core.Configuration.get('locale')"},{key:"sc",value:"Lightsaber.Core.Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[],methods:{parse:{name:"parse",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerAccountDetailsModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"customer/:customerId/customer-account/:customerAccountId/name",rest:{defaults:{method:"GET"},read:{contentType:"application/json",payload:["[]"],qParams:{lo:b.Core.Configuration.get("locale"),sc:b.Core.Configuration.get("salesChannel")}}}},successHandler:function(a){this.trigger("customerAccountDetailsLoaded",a)},fetch:function(a){this._super({success:this.successHandler})},initialize:function(){a.bindAll(this,"successHandler"),this._super()}}),e=d.extend({}),f={path:"businesswidget/repository/common/model//CustomerAccountDetailsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerAccountDetailsModel",savePath:"businesswidget/repository/common/model/",description:"Holds Customer Account name for the given account Id","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/:customerId/customer-account/:customerAccountId/name"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{method:{value:"GET"}},read:{contentType:{value:"application/json"},payload:{value:["[]"]},qParams:{value:[{key:"lo",value:"Lightsaber.Core.Configuration.get('locale')"},{key:"sc",value:"Lightsaber.Core.Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[],methods:{successHandler:{name:"successHandler",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},fetch:{name:"fetch",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/CustomerBillingArrangementDetailsModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"customer/:customerId/customer-bill-spec/:customerBillSpecId/name",rest:{defaults:{method:"GET",contentType:"application/json"},read:{payload:["[]"],qParams:{lo:b.Core.Configuration.get("locale"),sc:b.Core.Configuration.get("salesChannel")}}}},fetch:function(a){this._super({success:this.successHandler})},initialize:function(){a.bindAll(this,"successHandler"),this._super()},successHandler:function(a){this.trigger("billingDetailsLoaded",a)}}),e=d.extend({}),f={path:"businesswidget/repository/common/model/CustomerBillingArrangementDetailsModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"CustomerBillingArrangementDetailsModel",savePath:"businesswidget/repository/common/model",description:"Holds the BillSpec name and ID","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/:customerId/customer-bill-spec/:customerBillSpecId/name"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{method:{value:"GET"},contentType:{value:"application/json"}},read:{payload:{value:["[]"]},qParams:{value:[{key:"lo",value:"Lightsaber.Core.Configuration.get('locale')"},{key:"sc",value:"Lightsaber.Core.Configuration.get('salesChannel')"}],isJSON:!0}}}},validations:[],methods:{fetch:{name:"fetch",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},successHandler:{name:"successHandler",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/model/SubscriptionSummaryModel",["underscore","lightsaber","businesswidget/repository/common/core/RESTModel"],function (a,b,c){var d=c.extend({options:{url:"customer/:customerId/subscription-summary",rest:{defaults:{method:"GET",contentType:"application/json"},read:{payload:["[]"],qParams:{sc:b.Core.Configuration.get("salesChannel"),lo:b.Core.Configuration.get("locale")}}}},successHandler:function(a){this.trigger("subscriptionDetailsLoaded",a)},fetch:function(a){var b={};this.get("subId")&&(b.subId=this.get("subId")),this.get("subRef")&&(b.subRef=this.get("subRef")),this.setQueryParams(b),this._super({success:this.successHandler})},initialize:function(b){a.bindAll(this,"successHandler"),this._super()}}),e=d.extend({}),f={path:"businesswidget/repository/common/model//SubscriptionSummaryModel.js",parent:"businesswidget/repository/common/core/RESTModel",type:"model",name:"SubscriptionSummaryModel",savePath:"businesswidget/repository/common/model/",description:"Holds the subscription details","extends":"RESTModel",extendsClassPath:"businesswidget/repository/common/core/RESTModel",dataSource:"rest",modelType:"model",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"RESTModel",pathName:"businesswidget/repository/common/core/RESTModel"}],modelOptions:{modelProperties:{url:{isMandatory:!0,value:"customer/:customerId/subscription-summary"},autoSnapshot:{value:"None"}},restDataSourceProperties:{defaults:{method:{value:"GET"},contentType:{value:"application/json"}},read:{payload:{value:["[]"]},qParams:{value:[{key:"sc",value:"Lightsaber.Core.Configuration.get('salesChannel')"},{key:"lo",value:"Lightsaber.Core.Configuration.get('locale')"}],isJSON:!0}}}},validations:[],methods:{successHandler:{name:"successHandler",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},fetch:{name:"fetch",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1}}};return e.prototype.getMetaData=function(){return f},e});
define("businesswidget/repository/common/viewmodel/SelectedCustomerDataTopicViewModel",["lightsaber","underscore"],function (a,b){return a.Core.ViewModel.extend({defaults:{individualID:void 0,familyName:void 0,givenName:void 0,billingItemType:void 0,billingItemID:void 0,billingItemRef:void 0,contactMediumType:void 0,contactMediumValue:void 0}})});
define("businesswidget/repository/common/viewmodel/CustomerProblemDetailsTopicViewModel",["underscore","lightsaber"],function (a,b){var c=b.Core.ViewModel.extend({defaults:{ID:void 0}}),d=c.extend({}),e={parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CustomerProblemDetailsTopicViewModel",path:"businesswidget/repository/common/viewmodel/CustomerProblemDetailsTopicViewModel.js",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"}],models:null,viewModels:null,dataBindings:null,defaults:{ID:{key:"ID",value:"undefined"}},methods:{}};return d.prototype.getMetaData=function(){return e},d});
define("businesswidget/repository/common/viewmodel/CreateCustomerProblemViewModel",["underscore","lightsaber","businesswidget/repository/common/model/CreateCustomerProblemModel","businesswidget/repository/common/model/ChoiceListModel","businesswidget/repository/common/model/IndividualDetailsModel","single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel","businesswidget/repository/common/model/CustomerDetailsModel","businesswidget/repository/common/model/OrganizationDetailsModel","businesswidget/repository/common/model/CustomerAccountDetailsModel","businesswidget/repository/common/model/CustomerBillingArrangementDetailsModel","businesswidget/repository/common/model/SubscriptionSummaryModel","sync!businesswidget/repository/common/viewmodel/UserInformationViewModel","businesswidget/repository/common/viewmodel/ConfirmationViewModel","single!businesswidget/repository/common/viewmodel/SubscriptionsSearchWidgetViewModel","single!businesswidget/repository/common/viewmodel/CancelLinkViewModel","businesswidget/repository/common/model/StatusTransitionsModel","single!businesswidget/repository/common/viewmodel/SelectQueueTopicsViewModel","single!businesswidget/repository/common/viewmodel/SelectedCustomerDataTopicViewModel","single!businesswidget/repository/common/viewmodel/CustomerProblemDetailsTopicViewModel"],function (a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b.Core.ViewModel.extend({config:{actions:{setIndividualDetails:this.setIndividualDetails,setSubscriptionReference:this.setSubscriptionReference,submitCase:this.submitCase,saveAndDispatchCase:this.saveAndDispatchCase,isCreatedBySelfUser:this.isCreatedBySelfUser,getAdminRelatedData:this.getAdminRelatedData,publishSelectQueueTopic:this.publishSelectQueueTopic,getBillingParameters:this.getBillingParameters,finalizeWidgetDetails:this.finalizeWidgetDetails,updateSubscriptionReference:this.updateSubscriptionReference,checkSelfUser:this.checkSelfUser}},models:{caseType2Collection:b.Core.Collection,caseType3Collection:b.Core.Collection,entityTypes:b.Core.Collection,createCustomerProblemModel:c,choiceListModel:d,individualDetailsModel:e,customerDetailsModel:g,organizationDetailsModel:h,customerAccountDetailsModel:i,billingSpecDetailsModel:j,subscriptionDetailsModel:k,statusTransitionsModel:p,statusTransitionsCollection:b.Core.Collection,severityChoiceCollection:b.Core.Collection,priorityChoiceCollection:b.Core.Collection},subViewModels:{customerTopicsViewModel:f,ConfirmationViewModel:m,searchSubscriptionViewModel:n,cancelLinkViewModel:o,problemDetailsTopicsViewModel:s,selectQueueTopicsVM:q,selectedCustomerDataTopicViewModel:r},dataBindings:[{individualContext:"subViewModels.customerTopicsViewModel.IndividualInContext",options:{twoWay:!1,setOnBind:!0}},{customerContext:"subViewModels.customerTopicsViewModel.CustomerInContext",options:{twoWay:!1,setOnBind:!0}},{organizationContext:"subViewModels.customerTopicsViewModel.CurrentOrganizationInContext",options:{twoWay:!1,setOnBind:!0}},{subscriptionContext:"subViewModels.customerTopicsViewModel.SubscriptionInContext",options:{twoWay:!0,setOnBind:!0}},{billSpecContext:"subViewModels.customerTopicsViewModel.CustomerBillSpecInContext",options:{twoWay:!1,setOnBind:!0}},{customerAccountContext:"subViewModels.customerTopicsViewModel.CustomerAccountInContext",options:{twoWay:!1,setOnBind:!0}},{customerProblemId:"models.createCustomerProblemModel.CreateCustomerProblemResponse.customerProblemId",options:{twoWay:!1,setOnBind:!0}},{dispatched:"models.createCustomerProblemModel.CreateCustomerProblemResponse.dispatched",options:{twoWay:!1,setOnBind:!0}},{numOfQueues:"models.createCustomerProblemModel.CreateCustomerProblemResponse.numOfQueues",options:{twoWay:!1,setOnBind:!0}},{associatedItemType:"models.createCustomerProblemModel.type",options:{twoWay:!0,setOnBind:!0}},{individualName:"models.individualDetailsModel.individualName",options:{twoWay:!0,setOnBind:!0}},{organizationName:"models.organizationDetailsModel.organizationName",options:{twoWay:!0,setOnBind:!0}},{customerName:"models.customerDetailsModel.customerName",options:{twoWay:!0,setOnBind:!0}}],defaults:{assosiatedItemName:"",associatedItemID:null,customerProblemId:null,individualName:null,customerName:null,organizationName:null,emptyLabel:"",caseTitle:"",caseDescription:"",widgetTitle:"",cancelLinkInd:null,changeLabel:null,workItemType:"CUSTOMERPROBLEM",siteAddress:"",siteFormattedNameId:"",keepInFolder:null,numOfQueues:null,dispatched:null,isLookupCustomerData:!1,salesChannel:b.Core.Configuration.get("salesChannel")},initialize:function(c){this._super(c),a.bindAll(this,"checkSelfUser","getCaseTypeRefernceData","getBillingParameters","isCreatedBySelfUser","setIndividualDetails","setCustomerDetails","setOrganizationDetails","setSubscriptionReference","setBillSpecDetails","setCustomerAccountDetails","onReferenceDataLoaded","onStatusTransitionsModelLoaded","onPriorityChoiceTypeLoaded","fetchStatusTransitions","onChangeSelectedCustomerDataTopicViewModel","onQueueDispatched");var d="",e=b.Core.Configuration.get("CustomerProblemSeverityPriority");if("SEVERITY"===e.toUpperCase()&&(d=this.getString("createCustomerProblem_Severity")),"PRIORITY"===e.toUpperCase()&&(d=this.getString("createCustomerProblem_Priority")),"SHOW"===b.Core.Configuration.get("CustomerProblemTitleDisplay")){var f={check:"notEmpty",fieldName:"CreateCustomerProblemRequest.name"},g={check:"length",fieldName:"CreateCustomerProblemRequest.name",max:b.Core.Configuration.get("CustomerProblemTitleSizeMax")};this.models.createCustomerProblemModel.validations.push(f),this.models.createCustomerProblemModel.validations.push(g)}var h={check:"length",fieldName:"CreateCustomerProblemRequest.description",max:b.Core.Configuration.get("CustomerProblemDescSizeMax")};this.models.createCustomerProblemModel.validations.push(h);var i={submitLabel:this.getString("createCustomerProblem_Submit"),cancelLabel:this.getString("createCustomerProblem_Cancel"),caseDescriptionLabel:this.getString("createCustomerProblem_CaseDescription"),caseTitleLabel:this.getString("createCustomerProblem_CaseTitle"),problemTypeLabel:this.getString("createCustomerProblem_ProblemType"),widgetErrorMessage:this.getString("common_WidgetErrorMessage"),severityPriorityLabel:d,widgetTitle:this.getString("createCustomerProblem_Title"),changeLabel:this.getString("createCustomerProblem_SelectLink"),subscriptionCancelLabel:this.getString("createCustomerProblem_SubscriptionCancelLabel"),subscriptionContinueLabel:this.getString("createCustomerProblem_SubscriptionContinueLabel"),oneAndDoneLabel:this.getString("createCustomerProblemCC_oneAndDoneLabel"),dispatchLabel:this.getString("createCustomerProblemCC_dispatchLabel"),keepInFolderLabel:this.getString("createCustomerProblemCC_keepInFolderLabel"),saveLabel:this.getString("createCustomerProblemCC_saveLabel"),lblAddressLocation:this.getString("createCustomerProblemCC_Address_Location"),lblSite:this.getString("crateCustomerProblem_Site"),lblAddress:this.getString("crateCustomerProblem_Address")};this.set(i),this.subscriptionEntity={value:"SUBSCRIPTION",name:this.getString("createCustomerProblem_Entity_Subscription")},this.billingEntity={value:"CUSTOMER_BILL_SPEC",name:this.getString("createCustomerProblem_Entity_BillSpec")},this.faEntity={value:"CUSTOMER_ACCOUNT",name:this.getString("createCustomerProblem_Entity_CustomerAccount")},this.defaultEntity={value:"additionalItem",name:this.getString("createCustomerProblem_Entity_AdditionalItem")},this.models.createCustomerProblemModel.get("problemTypeLevel")[0]="STANDARD:CASE_TYPE",this.SeverityChoiceListName="Problem Severity Level",this.PriorityChoiceListName="Response Priority Code",this.SelectSubscriptionChoiceCode="Subscription",this.models.choiceListModel.on("OnDataLoaded",this.onCaseTypeDataLoaded,this),this.on("change:caseType2",this.onCaseType2Changed,this),this.on("change:associatedItemType",this.onBillingEntityChange,this),this.models.customerAccountDetailsModel.on("customerAccountDetailsLoaded",this.onReferenceDataLoaded,this),this.models.billingSpecDetailsModel.on("billingDetailsLoaded",this.onReferenceDataLoaded,this),this.models.subscriptionDetailsModel.on("subscriptionDetailsLoaded",this.onSubscriptionDetailsLoaded,this),this.subViewModels.cancelLinkViewModel.on("action:LinkClicked",this.onSubscriptionPopupCloseClicked,this),this.on("change:customerProblemId",this.onCustomerProblemCreated,this),this.subViewModels.selectQueueTopicsVM.on("action:QueueSelectedForEntity",this.onQueueDispatched,this),this.subViewModels.selectedCustomerDataTopicViewModel.on("action:CustomerDataReady",this.onChangeSelectedCustomerDataTopicViewModel,this),this.on("change:customerContext",function(){this.get("customerContext").ID&&(this.getCaseTypeRefernceData(),this.fetchStatusTransitions(),this.off("change:customerContext",this))},this)},fetchStatusTransitions:function(){var a={workItemType:this.get("workItemType"),currentStatus:void 0,currentCondition:void 0,conditionReadMask:void 0,workItemId:void 0};this.models.statusTransitionsModel.set(a),this.models.statusTransitionsModel.fetch({success:this.onStatusTransitionsModelLoaded})},getCaseTypeRefernceData:function(){this.models.choiceListModel.addToQueryParameter("STANDARD","CASE_TYPE",!0),this.models.choiceListModel.fetch()},onCaseTypeDataLoaded:function(){this.casesOfType1=this.models.choiceListModel.getChoiceList(),this.models.choiceListModel.off("OnDataLoaded",this.onCaseTypeDataLoaded,this),this.models.choiceListModel.on("OnDataLoaded",this.onSeverityTypeLoaded,this),this.models.choiceListModel.addToQueryParameter("CRM_LIST",this.SeverityChoiceListName,!1),this.models.choiceListModel.fetch(),this.updateChoicelistData()},updateChoicelistData:function(){if(void 0!==this.casesOfType1){var b=this.models.choiceListModel.getChildren(this.casesOfType1,"Incident");if(this.set("caseType1","Incident"),("SUBSCRIPTION"===this.get("associatedItemType")||this.get("billingEntityCount")>0&&"additionalItem"!==this.get("associatedItemType"))&&(this.set("caseType1","Billing"),b=this.models.choiceListModel.getChildren(this.casesOfType1,"Billing"),b=b.filter(this.filterUnSupportedCases)),this.models.caseType2Collection.reset(b),"SUBSCRIPTION"===this.get("associatedItemType"))a.each(b,function(a){a.ID.toUpperCase()==this.SelectSubscriptionChoiceCode.toUpperCase()&&(this.set("caseType2",this.SelectSubscriptionChoiceCode),this.set("enableCaseType2",!1))},this);else{var c=this.models.choiceListModel.getDefaultValueFromChoiceList(b).ID;this.set("caseType2",c)}b.length<=1&&this.set("enableCaseType2",!1);
}},setCustomerDetails:function(){var a=this.get("alias")?this.get("alias"):this.get("customerContext").alias;this.get("customerId")&&(a?(!0!==b.Core.Configuration.get("isCallCenterView")&&(a="( "+a+" )"),this.set("customerName",a)):(this.models.customerDetailsModel.set("customerId",this.get("customerId")),this.models.customerDetailsModel.fetch()))},setIndividualDetails:function(){var a=this.get("familyName")?this.get("familyName"):this.get("individualContext").familyName,b=this.get("givenName")?this.get("givenName"):this.get("individualContext").givenName;if(this.get("individualId"))if(a||b){var c=this.constructIndividualName(a,b);this.set("individualName",c)}else this.models.individualDetailsModel.set("indvId",this.get("individualId")),this.models.individualDetailsModel.set("customerId",this.get("customerId")),this.models.individualDetailsModel.fetch()},setOrganizationDetails:function(){var a=this.get("orgName")?this.get("orgName"):this.get("organizationContext").name;this.get("organizationId")&&(a?this.set("organizationName",a):(this.models.organizationDetailsModel.set("organizationId",this.get("organizationId")),this.models.organizationDetailsModel.fetch()))},setSubscriptionReference:function(){this.get("reference")&&this.models.subscriptionDetailsModel.set("subRef",this.get("reference")),this.get("subscriptionId")&&this.models.subscriptionDetailsModel.set("subId",this.get("subscriptionId")),(this.get("reference")||this.get("subscriptionId"))&&(this.models.subscriptionDetailsModel.set("customerId",this.get("customerId")),this.models.subscriptionDetailsModel.fetch())},setBillSpecDetails:function(){var a=this.get("customerBillSpecName")?this.get("customerBillSpecName"):this.get("billSpecContext").name;this.get("customerBillSpecId")&&(a?this.set("billSpecName",a):(this.models.billingSpecDetailsModel.set("customerBillSpecId",this.get("customerBillSpecId")),this.models.billingSpecDetailsModel.set("customerId",this.get("customerId")),this.models.billingSpecDetailsModel.fetch()))},setCustomerAccountDetails:function(){var a=this.get("customerAccountName")?this.get("customerAccountName"):this.get("customerAccountContext").name;this.get("customerAccountID")&&(a?this.set("customerAccountName",a):(this.models.customerAccountDetailsModel.set("customerAccountId",this.get("customerAccountID")),this.models.customerAccountDetailsModel.set("customerId",this.get("customerId")),this.models.customerAccountDetailsModel.fetch()))},onSubscriptionDetailsLoaded:function(){var a=this.models.subscriptionDetailsModel.get("SubscriptionSummary").siteName?this.models.subscriptionDetailsModel.get("SubscriptionSummary").siteName:"",b=this.models.subscriptionDetailsModel.get("SubscriptionSummary").siteId?this.models.subscriptionDetailsModel.get("SubscriptionSummary").siteId:"",c=a+"("+this.getString("createCustomerProblem_SiteID")+b+")",d={siteFormattedNameId:c,siteAddress:this.models.subscriptionDetailsModel.get("SubscriptionSummary").formattedAddress,subscriptionName:this.models.subscriptionDetailsModel.get("SubscriptionSummary").name,siteId:b,subscriptionReference:this.models.subscriptionDetailsModel.get("SubscriptionSummary").reference};this.set(d),this.onReferenceDataLoaded()},onReferenceDataLoaded:function(){this.get("isBillSpecExists")&&this.models.billingSpecDetailsModel.get("CustomerBillSpecName")&&this.models.billingSpecDetailsModel.get("CustomerBillSpecName").name&&this.set("billSpecName",this.models.billingSpecDetailsModel.get("CustomerBillSpecName").name),this.get("isCustomerAccountExists")&&this.models.customerAccountDetailsModel.get("CustomerAccountName")&&this.models.customerAccountDetailsModel.get("CustomerAccountName").name&&this.set("customerAccountName",this.models.customerAccountDetailsModel.get("CustomerAccountName").name),this.setAssosiatedIdByType(this.get("associatedItemType")),this.trigger("UpdateAccordionViewData")},onBillingEntityChange:function(a){this.set("enableCaseType2",!0),this.setAssosiatedIdByType(a.value);var b,c,d=this.header;if(d){this.trigger("UpdateAccordionViewData");var e=this.casesOfType1;"additionalItem"===this.get("associatedItemType")?(this.set("caseType1","Incident"),b=this.models.choiceListModel.getChildren(e,"Incident"),this.models.caseType2Collection.reset(b),c=this.models.choiceListModel.getDefaultValueFromChoiceList(b).ID,this.set("caseType2",c),this.trigger("validationFailed")):(this.set("caseType1","Billing"),b=this.models.choiceListModel.getChildren(e,"Billing"),b=b.filter(this.filterUnSupportedCases),this.models.caseType2Collection.reset(b),"SUBSCRIPTION"===this.get("associatedItemType")?(this.get("caseType2")===this.SelectSubscriptionChoiceCode?this.onCaseType2Changed():this.set("caseType2",this.SelectSubscriptionChoiceCode),this.set("enableCaseType2",!1)):(c=this.models.choiceListModel.getDefaultValueFromChoiceList(b).ID,this.set("caseType2",c)))}},saveAndDispatchCase:function(){this.set("saveOption","SAVE_AND_DISPATCH"),this.set("queueID",b.Core.Configuration.get("DefaultQueueIDForDispatch")),this.submitCase()},submitCase:function(){"true"!==this.get("keepInFolder")&&(this.set("saveOption","SAVE_AND_DISPATCH"),this.set("queueID",b.Core.Configuration.get("DefaultQueueIDForDispatch"))),this.set("errorMessages",[]),this.models.createCustomerProblemModel.get("severity")[1]=this.get("caseSeverity"),this.models.createCustomerProblemModel.get("priority")[1]=this.get("casePriority"),this.models.createCustomerProblemModel.get("problemTypeLevel")[1]=this.get("caseType1"),this.models.createCustomerProblemModel.get("problemTypeLevel")[2]=this.get("caseType2"),this.models.createCustomerProblemModel.get("problemTypeLevel")[3]=this.get("caseType3");var a=this.models.createCustomerProblemModel.get("associatedItem");this.get("associatedItemType")&&"additionalItem"!=this.get("associatedItemType")&&"SUBSCRIPTION"!=this.get("associatedItemType")?(a.ID=this.get("associatedItemID"),a.type=this.get("associatedItemType")):"SUBSCRIPTION"===this.get("associatedItemType")&&this.get("isSubscriptionExists")?(a.ID=this.get("subscriptionId"),a.reference=this.get("reference"),a.type=this.get("associatedItemType")):this.models.createCustomerProblemModel.set("associatedItem",null,{silent:!0}),this.set("caseTitle",this.get("caseTitle").trim()),this.set("caseDescription",this.get("caseDescription").trim());var c={reporterIndividualId:this.get("individualId"),reporterCustomerId:this.get("customerId"),name:this.get("caseTitle"),description:this.get("caseDescription"),saveOption:this.get("saveOption"),queueID:this.get("queueID"),status:this.get("caseStatus"),saveInWorkFolder:this.get("keepInFolder")},d={lo:b.Core.Configuration.get("defaultLocale"),sc:this.get("salesChannel")};this.models.createCustomerProblemModel.setQueryParams(d),"SUBSCRIPTION"!==this.get("associatedItemType")||this.get("isSubscriptionExists")?this.models.createCustomerProblemModel.save(c):this.trigger("validationFailed",{message:this.getString("createCusstomerProblem_NoSubscriptionSelectedMsg")})},isBillingEntityExist:function(){var a,b,c,d,e=0,f=[],g=this.get("customerId")?this.get("customerId"):this.get("customerContext")?this.get("customerContext").ID:null,h=this.get("individualId")?this.get("individualId"):this.get("individualContext")?this.get("individualContext").ID:null,i=this.get("organizationId")?this.get("organizationId"):this.get("organizationContext")?this.get("organizationContext").ID:null;if(this.get("isLookupCustomerData")?(a=this.get("customerAccountID"),b=this.get("customerBillSpecId"),c=this.get("subscriptionId"),d=this.get("reference")):(a=this.get("customerAccountID")?this.get("customerAccountID"):this.get("customerAccountContext")?this.get("customerAccountContext").ID:null,b=this.get("customerBillSpecId")?this.get("customerBillSpecId"):this.get("billSpecContext")?this.get("billSpecContext").ID:null,c=this.get("subscriptionId")?this.get("subscriptionId"):this.get("subscriptionContext")?this.get("subscriptionContext").subscriptionId:null,d=this.get("reference")?this.get("reference"):this.get("subscriptionContext")?this.get("subscriptionContext").reference:null),d&&this.set("reference",d),c&&this.set("subscriptionId",c),(c||d)&&(e++,this.set("isSubscriptionExists",!0),f.push(this.subscriptionEntity)),b&&(this.set("customerBillSpecId",b),e++,this.set("isBillSpecExists",!0),f.push(this.billingEntity)),a&&(this.set("customerAccountID",a),e++,this.set("isCustomerAccountExists",!0),f.push(this.faEntity)),g&&(this.set("customerId",g),this.set("isCustomerContextExists",!0)),h&&(this.set("isIndividualContextExists",!0),this.set("individualId",h)),i&&(this.set("organizationId",i),this.set("isOrganizationContextExits",!0)),f.push(this.defaultEntity),f.indexOf(this.subscriptionEntity)<=-1&&f.push(this.subscriptionEntity),this.models.entityTypes.reset(f),f&&f.length>0){var j=f[0].value;this.set("associatedItemType",j,{silent:!0})}return e},addErrorMessage:function(a){this.get("errorMessages").indexOf(a)<=-1&&this.get("errorMessages").push(a),this.trigger("validationFailed")},onCaseType2Changed:function(){var a=this.get("caseType2");if(null!==a&&""!==a){var b=this.getChoiceListFromModel(this.models.caseType2Collection,a);this.models.caseType3Collection.reset(b);var c=this.models.choiceListModel.getDefaultValueFromChoiceList(b).ID;this.set("caseType3",c),b.length<=1?this.set("enableCaseType3",!1):this.set("enableCaseType3",!0)}},getChoiceListFromModel:function(a,b){for(var c=0;c<a.length;c++){var d=a.models[c];if(d.get("ID")==b&&null!==d.get("choices"))return d.get("choices").sort(this.models.choiceListModel.choicesSortFunction)}},constructIndividualName:function(a,b){var c="";return b&&(c=b),a&&(c=c+"   "+a),c},setAssosiatedIdByType:function(a){var b;switch(a){case"SUBSCRIPTION":var c=this.get("reference")?this.get("reference"):this.get("subscriptionId")?this.get("subscriptionId"):null;this.set("associatedItemID",c),this.set("assosiatedItemName",this.get("subscriptionName")),b=this.subscriptionEntity;break;case"CUSTOMER_BILL_SPEC":this.set("associatedItemID",this.get("customerBillSpecId")),this.set("assosiatedItemName",this.get("billSpecName")),b=this.billingEntity;break;case"CUSTOMER_ACCOUNT":this.set("associatedItemID",this.get("customerAccountID")),this.set("assosiatedItemName",this.get("customerAccountName")),b=this.faEntity;break;case"additionalItem":this.set("assosiatedItemName",this.getString("createCustomerProblem_None")),this.set("associatedItemID",""),b=this.defaultEntity}this.header=b},filterUnSupportedCases:function(a){return"Credit"!==a.ID&&"Dispute"!==a.ID},isCreatedBySelfUser:function(){var a=this.isBillingEntityExist();this.set("billingEntityCount",a),this.setAssosiatedIdByType(this.get("associatedItemType")),this.trigger("UpdateAccordionViewData"),this.updateChoicelistData(),this.getBillingParameters(),this.setIndividualDetails(),this.checkSelfUser()},onSeverityTypeLoaded:function(){var a=(b.Core.Configuration.get("CustomerProblemSeverityPriority"),this.models.choiceListModel.getChoiceList());this.models.severityChoiceCollection.reset(a),this.set("caseSeverity",this.models.choiceListModel.getDefaultValueFromChoiceList(a).ID),this.models.createCustomerProblemModel.get("severity")[0]="CRM_LIST:Problem Severity Level",this.on("change:caseTitle change:caseDescription change:caseSeverity change:casePriority change:caseType2 change:caseType3",this.setIsDirty,this),this.models.choiceListModel.off("OnDataLoaded",this.onSeverityTypeLoaded,this),this.models.choiceListModel.on("OnDataLoaded",this.onPriorityChoiceTypeLoaded,this),this.models.choiceListModel.addToQueryParameter("CRM_LIST",this.PriorityChoiceListName,!1),this.models.choiceListModel.fetch()},onPriorityChoiceTypeLoaded:function(){this.models.choiceListModel.off("OnDataLoaded",this.onPriorityChoiceTypeLoaded,this);var a=this.models.choiceListModel.getChoiceList();this.models.priorityChoiceCollection.reset(a),this.set("casePriority",this.models.choiceListModel.getDefaultValueFromChoiceList(a).ID),this.models.createCustomerProblemModel.get("priority")[0]="CRM_LIST:Response Priority Code"},onStatusTransitionsModelLoaded:function(a,b){var c=this.models.statusTransitionsModel.get("StatusTransitionsResponse").statusTransiions;this.models.statusTransitionsCollection.reset(c),this.set("caseStatus",this.models.choiceListModel.getDefaultValueFromChoiceList(c).code)},setIsDirty:function(){this.set("isDirty",!0)},getAdminRelatedData:function(){this.setCustomerDetails(),this.setIndividualDetails(),this.setOrganizationDetails()},getBillingParameters:function(){this.setSubscriptionReference(),this.setBillSpecDetails(),this.setCustomerAccountDetails()},onCustomerProblemCreated:function(){var a={id:this.get("customerProblemId")};this.get("customerProblemId")&&this.trigger("action:CreatedCustomerProblem",a),this.subViewModels.problemDetailsTopicsViewModel.set("ID",this.get("customerProblemId"))},publishSelectQueueTopic:function(){var a={};a.entityType="CUSTOMERPROBLEM",a.entityID=this.get("customerProblemId"),this.subViewModels.selectQueueTopicsVM.set(a)},SaveCustomerProblem:function(){this.submitCase()},finalizeWidgetDetails:function(){return!this.get("isDirty")},onCancelLinkClicked:function(a){a.stopPropagation();var b=(this.get("promptOnCancel"),this.get("isDirty"),{typeStr:"Case",id:"new"});o.set("widgetName","createCustomerProblem"),o.set("identifier",b),o.handleAction("LinkClicked")},removeErrorMessage:function(a){if(this.get("errorMessages")&&this.get("errorMessages").length>0){var b=this.get("errorMessages").indexOf(a);b>-1&&this.get("errorMessages").splice(b,1),this.trigger("validationFailed")}},onSubscriptionPopupCloseClicked:function(a){if("searchSubscriptionWidget"===o.get("widgetName")){this.set("subscriptionLookUpCancel",!0);var b=n.subViewModels.subscriptionsListViewModel.get("subscriptionDetails")[0],c=n.get("customerId");this.set("subscriptionDetails",b),c!=this.get("customerId")?this.trigger("validationFailed",{message:this.getString("createCustomerProblem_InvalidSubscription")}):b.individualID!=this.get("individualId")?this.trigger("differentContactSelected"):this.updateSubscriptionReference()}},updateSubscriptionReference:function(){this.set("reference",this.get("subscriptionDetails").reference),this.set("isSubscriptionExists",!0),this.setSubscriptionReference(),this.trigger("validationFailed")},checkSelfUser:function(){var a=l.get("individualID");this.get("individualId")===a?this.set("isSelfUser",!0):this.set("isSelfUser",!1)},onChangeSelectedCustomerDataTopicViewModel:function(a){console.log(a),this.set("familyName",a.familyName),this.set("givenName",a.givenName),this.set("individualId",a.individualID);var b=this.constructIndividualName(this.get("familyName"),this.get("givenName"));switch(this.set("individualName",b),this.set("reference",void 0),this.set("subscriptionId",void 0),this.set("customerBillSpecId",void 0),this.set("customerAccountID",void 0),this.set("siteAddress",""),a.billingItemType){case"SUBSCRIPTION":this.set("reference",a.billingItemRef),this.set("subscriptionId",a.billingItemID),this.set("subscriptionName",""),this.set("siteFormattedNameId",""),this.set("siteId",""),"Postal"===a.contactMediumType&&this.set("siteAddress",a.contactMediumValue);break;case"CUSTOMER_BILL_SPEC":this.set("customerBillSpecId",a.billingItemID),this.set("billSpecName","");break;case"CUSTOMER_ACCOUNT":this.set("customerAccountName",""),this.set("customerAccountID",a.billingItemID)}this.set("isLookupCustomerData",!0),this.isBillingEntityExist(),a.billingItemType.length>0?(a.billingItemType,this.set("associatedItemType",this.defaultEntity.value),this.set("associatedItemType",a.billingItemType)):(this.set("associatedItemType",this.subscriptionEntity.value),this.set("associatedItemType",this.defaultEntity.value)),this.trigger("lookupCustomerDataDone")},onQueueDispatched:function(a){this.trigger("dispatchSuccess")}}),u=t.extend({}),v={path:"businesswidget/repository/common/viewmodel/CreateCustomerProblemViewModel.js",parent:"Lightsaber.Core.ViewModel",type:"ViewModel",name:"CreateCustomerProblemViewModel",savePath:"businesswidget/repository/common/viewmodel",description:"","extends":"Lightsaber.Core.ViewModel",requires:[{variable:"_",pathName:"underscore"},{variable:"Lightsaber",pathName:"lightsaber"},{variable:"CreateCustomerProblemModel",pathName:"businesswidget/repository/common/model/CreateCustomerProblemModel"},{variable:"ChoiceListModel",pathName:"businesswidget/repository/common/model/ChoiceListModel"},{variable:"IndividualDetailsModel",pathName:"businesswidget/repository/common/model/IndividualDetailsModel"},{variable:"CustomerTopicsDefinitionViewModel",pathName:"single!businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel"},{variable:"CustomerDetailsModel",pathName:"businesswidget/repository/common/model/CustomerDetailsModel"},{variable:"OrganizationDetailsModel",pathName:"businesswidget/repository/common/model/OrganizationDetailsModel"},{variable:"CustomerAccountDetailsModel",pathName:"businesswidget/repository/common/model/CustomerAccountDetailsModel"},{variable:"CustomerBillingArrangementDetailsModel",pathName:"businesswidget/repository/common/model/CustomerBillingArrangementDetailsModel"},{variable:"SubscriptionSummaryModel",pathName:"businesswidget/repository/common/model/SubscriptionSummaryModel"},{variable:"UserInformationViewModel",pathName:"sync!businesswidget/repository/common/viewmodel/UserInformationViewModel"},{variable:"ConfirmationViewModel",pathName:"businesswidget/repository/common/viewmodel/ConfirmationViewModel"},{variable:"SubscriptionsSearchWidgetViewModel",pathName:"single!businesswidget/repository/common/viewmodel/SubscriptionsSearchWidgetViewModel"},{variable:"CancelLinkViewModel",pathName:"single!businesswidget/repository/common/viewmodel/CancelLinkViewModel"},{variable:"StatusTransitionsModel",pathName:"businesswidget/repository/common/model/StatusTransitionsModel"}],models:{caseType2Collection:{name:"caseType2Collection",type:"module",module:"Lightsaber.Core.Collection",moduleId:"Lightsaber.Core.Collection",description:""},caseType3Collection:{name:"caseType3Collection",type:"module",module:"Lightsaber.Core.Collection",moduleId:"Lightsaber.Core.Collection",description:""},entityTypes:{name:"entityTypes",type:"module",module:"Lightsaber.Core.Collection",moduleId:"Lightsaber.Core.Collection",description:""},createCustomerProblemModel:{name:"createCustomerProblemModel",type:"module",module:"CreateCustomerProblemModel",moduleId:"businesswidget/repository/common/model/CreateCustomerProblemModel",description:""},choiceListModel:{name:"choiceListModel",type:"module",module:"ChoiceListModel",moduleId:"businesswidget/repository/common/model/ChoiceListModel",description:""},individualDetailsModel:{name:"individualDetailsModel",type:"module",module:"IndividualDetailsModel",moduleId:"businesswidget/repository/common/model/IndividualDetailsModel",description:""},customerDetailsModel:{name:"customerDetailsModel",type:"module",module:"CustomerDetailsModel",moduleId:"businesswidget/repository/common/model/CustomerDetailsModel",description:""},organizationDetailsModel:{name:"organizationDetailsModel",type:"module",module:"OrganizationDetailsModel",moduleId:"businesswidget/repository/common/model/OrganizationDetailsModel",description:""},customerAccountDetailsModel:{name:"customerAccountDetailsModel",type:"module",module:"CustomerAccountDetailsModel",moduleId:"businesswidget/repository/common/model/CustomerAccountDetailsModel",description:""},billingSpecDetailsModel:{name:"billingSpecDetailsModel",type:"module",module:"CustomerBillingArrangementDetailsModel",moduleId:"businesswidget/repository/common/model/CustomerBillingArrangementDetailsModel",description:""},subscriptionDetailsModel:{name:"subscriptionDetailsModel",type:"module",module:"SubscriptionSummaryModel",moduleId:"businesswidget/repository/common/model/SubscriptionSummaryModel",description:""},statusTransitionsModel:{name:"statusTransitionsModel",type:"module",module:"StatusTransitionsModel",moduleId:"businesswidget/repository/common/model/StatusTransitionsModel",description:""},statusTransitionsCollection:{name:"statusTransitionsCollection",type:"module",module:"Lightsaber.Core.Collection",moduleId:"Lightsaber.Core.Collection",description:""},severityChoiceCollection:{name:"severityChoiceCollection",type:"module",module:"Lightsaber.Core.Collection",moduleId:"Lightsaber.Core.Collection",description:""},priorityChoiceCollection:{name:"priorityChoiceCollection",type:"module",module:"Lightsaber.Core.Collection",moduleId:"Lightsaber.Core.Collection",description:""}},viewModels:{customerTopicsViewModel:{name:"customerTopicsViewModel",type:"module",module:"CustomerTopicsDefinitionViewModel",moduleId:"businesswidget/repository/common/viewmodel/CustomerTopicsDefinitionViewModel",description:""},ConfirmationViewModel:{name:"ConfirmationViewModel",type:"module",module:"ConfirmationViewModel",moduleId:"businesswidget/repository/common/viewmodel/ConfirmationViewModel",description:""},searchSubscriptionViewModel:{name:"searchSubscriptionViewModel",type:"module",module:"SubscriptionsSearchWidgetViewModel",moduleId:"businesswidget/repository/common/viewmodel/SubscriptionsSearchWidgetViewModel",description:""},cancelLinkViewModel:{name:"cancelLinkViewModel",type:"module",module:"CancelLinkViewModel",moduleId:"businesswidget/repository/common/viewmodel/CancelLinkViewModel",description:""}},dataBindings:{individualContext:{target:"individualContext",source:"subViewModels.customerTopicsViewModel.IndividualInContext",options:{twoWay:!1,setOnBind:!0}},customerContext:{target:"customerContext",source:"subViewModels.customerTopicsViewModel.CustomerInContext",options:{twoWay:!1,setOnBind:!0}},organizationContext:{target:"organizationContext",source:"subViewModels.customerTopicsViewModel.CurrentOrganizationInContext",options:{twoWay:!1,setOnBind:!0}},subscriptionContext:{target:"subscriptionContext",source:"subViewModels.customerTopicsViewModel.SubscriptionInContext",options:{twoWay:!0,setOnBind:!0}},billSpecContext:{target:"billSpecContext",source:"subViewModels.customerTopicsViewModel.CustomerBillSpecInContext",options:{twoWay:!1,setOnBind:!0}},customerAccountContext:{target:"customerAccountContext",source:"subViewModels.customerTopicsViewModel.CustomerAccountInContext",options:{twoWay:!1,setOnBind:!0}},customerProblemId:{target:"customerProblemId",source:"models.createCustomerProblemModel.CreateCustomerProblemResponse.customerProblemId",options:{twoWay:!1,setOnBind:!0}},numOfQueues:{target:"numOfQueues",source:"models.createCustomerProblemModel.CreateCustomerProblemResponse.numOfQueues",options:{twoWay:!1,setOnBind:!0}},associatedItemType:{target:"associatedItemType",source:"models.createCustomerProblemModel.type",options:{twoWay:!0,setOnBind:!0}},individualName:{target:"individualName",source:"models.individualDetailsModel.individualName",options:{twoWay:!0,setOnBind:!0}},organizationName:{target:"organizationName",source:"models.organizationDetailsModel.organizationName",options:{twoWay:!0,setOnBind:!0}},customerName:{target:"customerName",source:"models.customerDetailsModel.customerName",options:{twoWay:!0,setOnBind:!0}}},defaults:{assosiatedItemName:{key:"assosiatedItemName",value:"''"},associatedItemID:{key:"associatedItemID",value:"null"},customerProblemId:{key:"customerProblemId",value:"null"},individualName:{key:"individualName",value:"null"},customerName:{key:"customerName",value:"null"},organizationName:{key:"organizationName",value:"null"},emptyLabel:{key:"emptyLabel",value:"''"},caseTitle:{key:"caseTitle",value:"''"},caseDescription:{key:"caseDescription",value:"''"},widgetTitle:{key:"widgetTitle",value:"''"},cancelLinkInd:{key:"cancelLinkInd",value:"null"},changeLabel:{key:"changeLabel",value:"null"},workItemType:{key:"workItemType",value:"CUSTOMERPROBLEM"},keepInFolder:{key:"keepInFolder",value:"null"}},methods:{initialize:{name:"initialize",privacyLevel:"public",isEventTriggered:!1,desc:"Initializes the viewModel",isChangeEventTriggered:!1},getCaseTypeRefernceData:{name:"getCaseTypeRefernceData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onCaseTypeDataLoaded:{name:"onCaseTypeDataLoaded",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},updateChoicelistData:{name:"updateChoicelistData",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setCustomerDetails:{name:"setCustomerDetails",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setIndividualDetails:{name:"setIndividualDetails",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},setOrganizationDetails:{name:"setOrganizationDetails",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setSubscriptionReference:{name:"setSubscriptionReference",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},setBillSpecDetails:{name:"setBillSpecDetails",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setCustomerAccountDetails:{name:"setCustomerAccountDetails",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onSubscriptionDetailsLoaded:{name:"onSubscriptionDetailsLoaded",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onReferenceDataLoaded:{name:"onReferenceDataLoaded",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onBillingEntityChange:{name:"onBillingEntityChange",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},submitCase:{name:"submitCase",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},saveAndDispatchCase:{name:"saveAndDispatchCase",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},isBillingEntityExist:{name:"isBillingEntityExist",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},addErrorMessage:{name:"addErrorMessage",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onCaseType2Changed:{name:"onCaseType2Changed",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getChoiceListFromModel:{name:"getChoiceListFromModel",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},constructIndividualName:{name:"constructIndividualName",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setAssosiatedIdByType:{name:"setAssosiatedIdByType",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},filterUnSupportedCases:{name:"filterUnSupportedCases",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},isCreatedBySelfUser:{name:"isCreatedBySelfUser",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},onSeverityTypeLoaded:{name:"onSeverityTypeLoaded",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onPriorityChoiceTypeLoaded:{name:"onPriorityChoiceTypeLoaded",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},setIsDirty:{name:"setIsDirty",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},getAdminRelatedData:{name:"getAdminRelatedData",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},getBillingParameters:{name:"getBillingParameters",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},onCustomerProblemCreated:{name:"onCustomerProblemCreated",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},SaveCustomerProblem:{name:"SaveCustomerProblem",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},finalizeWidgetDetails:{name:"finalizeWidgetDetails",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},onCancelLinkClicked:{name:"onCancelLinkClicked",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},removeErrorMessage:{name:"removeErrorMessage",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},onSubscriptionPopupCloseClicked:{name:"onSubscriptionPopupCloseClicked",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},updateSubscriptionReference:{name:"updateSubscriptionReference",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1},onStatusTransitionsModelLoaded:{name:"onStatusTransitionsModelLoaded",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},fetchStatusTransitions:{name:"fetchStatusTransitions",privacyLevel:"public",isEventTriggered:!1,desc:"",isChangeEventTriggered:!1},checkSelfUser:{name:"checkSelfUser",privacyLevel:"public",isEventTriggered:!0,desc:"",isChangeEventTriggered:!1}}};return u.prototype.getMetaData=function(){return v},u});
define("i18n!businesswidget/repository/common/i18n/support/web/nls/supportStrings",{"root":{},"en":true,"fr":true,"zh":true,"de":true});
define("text!businesswidget/repository_l3_common/common/config/l3_common.supportPackage.config.json",function (){return"({\n\n})\n\n"});
define("i18n!businesswidget/repository_l3_common/common/i18n/support/web/nls/l3_common.supportStrings",{"root":{},"en":true,"fr":true});
define("i18n!businesswidget/repository_l9_common/common/i18n/support/web/nls/l9_common.supportStrings",{"root":{},"en":true,"fr":true});
define("ResourceBundle", ["businesswidget/repository_l9_common/common/core/WidgetResourceBundle"], function(a) { return a; });
define("LoginViewModel", ["businesswidget/repository/common/viewmodel/LoginViewModel"], function(a) { return a; });
